/*! For license information please see neuroglancer.bundle.js.LICENSE.txt */
var e={4728:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Uo,setupDefaultViewer:()=>Fo});var i,r,o,s,a=n(7528),l=n(8178),c=n.n(l),d=n(8528),u=n.n(d),h=n(984),p=n.n(h),f=n(3162),g=n(233);function m(e){e.registerEventListener(document,"paste",(t=>{if((0,f.Hf)(t.target))return;const n=t.clipboardData;if(null!==n){const t=function(e,t){let n=u()(i||(i=(0,a.A)(["^[[]{}()s,]*"],["^[\\[\\]{}()\\s,]*"])));for(let i=0;i<t;++i)0!==i&&(n+=u()(r||(r=(0,a.A)(["[,s]+"],["[,\\s]+"])))),n+=u()(o||(o=(0,a.A)(["(d+(?:.d+)?)"],["(\\d+(?:\\.\\d+)?)"])));n+=u()(s||(s=(0,a.A)(["[[]{}()s,]*$"],["[\\[\\]{}()\\s,]*$"])));const l=e.match(n);if(null===l)return;const d=new Float32Array(t);for(let i=0;i<t;++i){const e=Number(l[i+1]);if(!c()(e))return;d[i]=e}return d}(n.getData("text/plain"),e.coordinateSpace.value.rank);void 0!==t&&(e.navigationState.position.value=t)}t.preventDefault()}))}var v=n(890),y=n(9176),b=n.n(y),S=n(954),w=n(7562),x=n(858);const C=b()("SingleTextureVolumeChunk.textureUnit"),k=b()("SingleTextureVolumeChunk.textureLayout");class E extends w.O8{constructor(e,t){super(),this.shaderKey=e,this.dataType=t}defineShader(e,t){e.addTextureSampler(this.shaderSamplerType,"uVolumeChunkSampler",C)}beginDrawing(e,t){let n=t.textureUnit(C);e.activeTexture(WebGL2RenderingContext.TEXTURE0+n),t[k]=null}endDrawing(e,t){e.bindTexture(x.ye[this.shaderSamplerType],null),t[k]=null}bindChunk(e,t,n,i,r,o,s){let a=n.textureLayout;(t[k]!==a||s)&&(t[k]=a,this.setupTextureLayout(e,t,a,i,r,o)),e.bindTexture(x.ye[this.shaderSamplerType],n.texture)}beginSource(e,t){}}class T extends S.OM{constructor(e,t){super(e,t),this.texture=null,this.data=t.data}copyToGPU(e){super.copyToGPU(e);let t=this.texture=e.createTexture();const n=x.ye[this.chunkFormat.shaderSamplerType];e.bindTexture(n,t),this.setTextureData(e),e.bindTexture(n,null)}freeGPUMemory(e){super.freeGPUMemory(e),e.deleteTexture(this.texture),this.texture=null,this.textureLayout.dispose(),this.textureLayout=null}}var L=n(7779),P=n(8194),D=n(6098),M=n(2025);class I extends w.O8{constructor(e,t,n){super(),this.chunkDataSize=t,this.textureDims=n,this.textureShape=new Uint32Array(this.textureDims);const i=t.length;let r=0;for(const d of t)1!==d&&++r;const o=this.strides=new Uint32Array(i*n),s=3===n?e.max3dTextureSize:e.maxTextureSize;let a=0,l=1;const c=this.textureShape;c.fill(1);for(let d=0;d<i;++d){const e=t[d];if(1===e)continue;const i=e*l;let u;i>s||1!==l&&a+r<n?(++a,l=e,u=1):(u=l,l=i),o[n*d+a]=u,c[a]=l}}static get(e,t,n){return e.memoize.get("sliceview.UncompressedTextureLayout:".concat(t.join(),":").concat(n),(()=>new I(e,t,n)))}}let R=new Uint32Array(15);class A extends E{constructor(e,t,n,i){super(n,t),this.textureDims=i,(0,M.YY)(this,t),this.shaderSamplerType="".concat(this.samplerPrefix,"sampler").concat(i,"D"),this.textureAccessHelper=new M.Gv("chunkData",i)}static get(e,t,n){const i="sliceview.UncompressedChunkFormat:".concat(t,":").concat(n);return e.memoize.get(i,(()=>new A(e,t,i,n)))}defineShader(e,t){super.defineShader(e,t);const n=this.textureDims,i="ivec".concat(this.textureDims);let r=this.textureAccessHelper;const o=(4+t)*n;R.length<o&&(R=new Uint32Array(o)),e.addUniform("highp ".concat(i),"uVolumeChunkStrides",4+t),e.addFragmentCode(r.getAccessor("readVolumeData","uVolumeChunkSampler",this.dataType));const s=(0,D.mh)(this.dataType);let a="\n".concat(s," getDataValueAt(highp ivec3 p");for(let l=0;l<t;++l)a+=", highp int channelIndex".concat(l);a+=") {\n  highp ".concat(i," offset = uVolumeChunkStrides[0]\n                     + p.x * uVolumeChunkStrides[1]\n                     + p.y * uVolumeChunkStrides[2]\n                     + p.z * uVolumeChunkStrides[3];\n");for(let l=0;l<t;++l)a+="\n  offset += channelIndex".concat(l," * uVolumeChunkStrides[").concat(4+l,"];\n");a+="\n  return readVolumeData(offset);\n}\n",e.addFragmentCode(a)}setupTextureLayout(e,t,n,i,r,o){const s=R,a=o.length,l=n.strides,c=i.length,d=this.textureDims;for(let h=0;h<d;++h){let e=0;for(let t=0;t<c;++t)e+=i[t]*l[t*d+h];s[h]=e}for(let h=0;h<3;++h){const e=r[h];if(!(e>=c))for(let t=0;t<d;++t)s[(h+1)*d+t]=l[e*d+t]}for(let h=0;h<a;++h){const e=o[h];if(-1===e)s.fill(0,(4+h)*d,(4+h+1)*d);else for(let t=0;t<d;++t)s[(4+h)*d+t]=l[e*d+t]}const u=(4+a)*d;3===d?e.uniform3iv(t.uniform("uVolumeChunkStrides"),s,0,u):e.uniform2iv(t.uniform("uVolumeChunkStrides"),s,0,u)}getTextureLayout(e,t){return I.get(e,t,this.textureDims)}setTextureData(e,t,n){const i=t.textureShape;(3===this.textureDims?M.nh:M.PC)(e,this,n,i[0],i[1],i[2])}}class O extends T{setTextureData(e){let t,n=this.source,i=n.chunkFormatHandler,r=i.chunkFormat;this.chunkDataSize===n.spec.chunkDataSize?this.textureLayout=t=i.textureLayout.addRef():this.textureLayout=t=r.getTextureLayout(e,this.chunkDataSize),this.chunkFormat.setTextureData(e,t,this.data)}getValueAt(e){let t=this.chunkFormat;const n=this.chunkDataSize;let i=0,r=1;const o=e.length;for(let l=0;l<o;++l)i+=r*e[l],r*=n[l];let s=t.dataType,a=this.data;switch(s){case L.pe.UINT8:case L.pe.INT8:case L.pe.FLOAT32:case L.pe.UINT16:case L.pe.INT16:case L.pe.UINT32:case L.pe.INT32:return a[i];case L.pe.UINT64:{let e=2*i;return new P.Uint64(a[e],a[e+1])}}}}class N extends w.O8{constructor(e,t){super();let n=0;for(const i of t.chunkDataSize)i>1&&++n;this.chunkFormat=this.registerDisposer(A.get(e,t.dataType,n>=3?3:2)),this.textureLayout=this.registerDisposer(this.chunkFormat.getTextureLayout(e,t.chunkDataSize))}getChunk(e,t){return new O(e,t)}}function _(e,t,n,i,r,o){let s=0,a=0,l=1,c=1;for(let g=0;g<3;++g){let e=r[g],t=i[g],o=e%t;s+=Math.floor(e/t)*l,l*=Math.ceil(n[g]/t),a+=o*c,c*=t}let d=t+2*s,u=e[d],h=e[d+1],p=16777215&u,f=u>>24&255;if(f>0){p+=o*(e[(t+h&16777215)+Math.floor(a*f/32)]>>a*f%32&(1<<f)-1)}return p}function V(e,t,n,i,r){return e[_(e,t,n,i,r,1)+t]}function B(e,t,n,i,r,o){let s=_(t,n,i,r,o,2)+n;return e.low=t[s],e.high=t[s+1],e}(0,S.Iw)(((e,t)=>null==t.compressedSegmentationBlockSize?new N(e,t):null));var F=n(3835);class U extends w.O8{constructor(e,t){super(),this.chunkDataSize=e,this.subchunkSize=t;const n=this.subchunkGridSize=F.eR.create();for(let i=0;i<3;++i)n[i]=Math.ceil(e[i]/t[i])}static get(e,t,n){return e.memoize.get("sliceview.CompressedSegmentationTextureLayout:".concat((0,F.nL)(t),",")+"".concat((0,F.nL)(n)),(()=>new U(t,n)))}}const z=(0,M.YY)(new M.nC,L.pe.UINT32);let j=new Uint32Array(16);class G extends E{constructor(e,t,n,i){super(i,e),this.subchunkSize=t,this.numChannels=n,this.textureAccessHelper=new M.R6("chunkData")}static get(e,t,n,i){let r="sliceview.CompressedSegmentationChunkFormat:".concat(t,":").concat(i),o="".concat(r,":").concat((0,F.nL)(n));return e.memoize.get(o,(()=>new G(t,n,i,r)))}get shaderSamplerType(){return"usampler2D"}defineShader(e,t){super.defineShader(e,t);const n=4*(4+t);j.length<n&&(j=new Uint32Array(n));let i=this.textureAccessHelper;i.defineShader(e);let r=e=>"compressedSegmentationChunkFormat_"+e;e.addUniform("highp ivec3","uSubchunkGridSize"),e.addUniform("highp ivec3","uSubchunkSize"),e.addUniform("highp ivec4","uVolumeChunkStrides",4+t),e.addFragmentCode(D.MX);const o=this.dataType,s=(0,D.mh)(o);o===L.pe.UINT64?e.addFragmentCode(D.sZ):e.addFragmentCode(D.Tm),e.addFragmentCode(i.getAccessor(r("readTextureValue"),"uVolumeChunkSampler",L.pe.UINT32,1));let a="\nuint ".concat(r("getChannelOffset"),"(int channelIndex) {\n  if (channelIndex == 0) {\n    return ").concat(this.numChannels,"u;\n  }\n  return ").concat(r("readTextureValue"),"(uint(channelIndex)).value;\n}\n").concat(s," getDataValueAt(highp ivec3 p");for(let l=0;l<t;++l)a+=", highp int channelIndex".concat(l);a+=") {\n  highp ivec4 chunkPositionFull = uVolumeChunkStrides[0] +\n                     + p.x * uVolumeChunkStrides[1]\n                     + p.y * uVolumeChunkStrides[2]\n                     + p.z * uVolumeChunkStrides[3];\n";for(let l=0;l<t;++l)a+="\n  chunkPositionFull += channelIndex".concat(l," * uVolumeChunkStrides[").concat(4+l,"];\n");a+="\n  highp ivec3 chunkPosition = chunkPositionFull.xyz;\n\n  // TODO: maybe premultiply this and store as uniform.\n  ivec3 subchunkGridPosition = chunkPosition / uSubchunkSize;\n  int subchunkGridOffset = getFortranOrderIndex(subchunkGridPosition, uSubchunkGridSize);\n\n  int channelOffset = int(".concat(r("getChannelOffset"),"(chunkPositionFull[3]));\n\n  // TODO: Maybe just combine this offset into subchunkGridStrides.\n  int subchunkHeaderOffset = subchunkGridOffset * 2 + channelOffset;\n\n  highp uint subchunkHeader0 = ").concat(r("readTextureValue"),"(uint(subchunkHeaderOffset)).value;\n  highp uint subchunkHeader1 = ").concat(r("readTextureValue"),"(uint(subchunkHeaderOffset + 1)).value;\n  highp uint outputValueOffset = (subchunkHeader0 & 0xFFFFFFu) + uint(channelOffset);\n  highp uint encodingBits = subchunkHeader0 >> 24u;\n  if (encodingBits > 0u) {\n    ivec3 subchunkPosition = chunkPosition - subchunkGridPosition * uSubchunkSize;\n    int subchunkOffset = getFortranOrderIndex(subchunkPosition, uSubchunkSize);\n    uint encodedValueBaseOffset = subchunkHeader1 + uint(channelOffset);\n    uint encodedValueOffset = encodedValueBaseOffset + uint(subchunkOffset) * encodingBits / 32u;\n    uint encodedValue = ").concat(r("readTextureValue"),"(encodedValueOffset).value;\n    uint wordOffset = uint(subchunkOffset) * encodingBits % 32u;\n    uint encodedValueShifted = encodedValue >> wordOffset;\n    uint decodedValue = encodedValueShifted - (encodedValueShifted >> encodingBits << encodingBits);\n    outputValueOffset += decodedValue * ").concat(this.dataType===L.pe.UINT64?"2u":"1u",";\n  }\n  ").concat(s," result;\n"),o===L.pe.UINT64?a+="\n  result.value[0] = ".concat(r("readTextureValue"),"(outputValueOffset).value;\n  result.value[1] = ").concat(r("readTextureValue"),"(outputValueOffset+1u).value;\n"):a+="\n  result.value = ".concat(r("readTextureValue"),"(outputValueOffset).value;\n"),a+="\n  return result;\n}\n",e.addFragmentCode(a)}setupTextureLayout(e,t,n,i,r,o){const s=n.subchunkGridSize;e.uniform3i(t.uniform("uSubchunkGridSize"),s[0],s[1],s[2]);const a=j,l=o.length;a.fill(0);for(let c=0;c<3;++c){a[c]=i[c];const e=r[c];-1!==e&&(a[4*(c+1)+e]=1)}for(let c=0;c<l;++c){const e=o[c];-1!==e&&(a[4*(4+c)+e]=1)}e.uniform4iv(t.uniform("uVolumeChunkStrides"),a,0,4*(l+4))}setTextureData(e,t,n){(0,M.pK)(e,z,n)}getTextureLayout(e,t){return U.get(e,t,this.subchunkSize)}beginSource(e,t){super.beginSource(e,t);const n=this.subchunkSize;e.uniform3i(t.uniform("uSubchunkSize"),n[0],n[1],n[2])}}class W extends T{setTextureData(e){let t=this.data,n=this.chunkFormat,i=this.textureLayout=n.getTextureLayout(e,this.chunkDataSize);n.setTextureData(e,i,t)}getValueAt(e){let t=this.chunkDataSize,n=this.chunkFormat,i=this.data,r=i[e[3]||0];if(n.dataType===L.pe.UINT64){let o=new P.Uint64;return B(o,i,r,t,n.subchunkSize,e),o}return V(i,r,t,n.subchunkSize,e)}}class H extends w.O8{constructor(e,t){super();let n=t.dataType;if(n!==L.pe.UINT64&&n!==L.pe.UINT32)throw new Error("Unsupported compressed segmentation data type: ".concat(L.pe[n]));this.chunkFormat=this.registerDisposer(G.get(e,t.dataType,t.compressedSegmentationBlockSize,t.chunkDataSize[3]||1))}getChunk(e,t){return new W(e,t)}}(0,S.Iw)(((e,t)=>null!=t.compressedSegmentationBlockSize?new H(e,t):null));var q=n(9859),Y=n(1434),J=n(1259);function K(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementById("neuroglancer-container");try{let n=new Y.A3(t);return new J.jM(n,e)}catch(Zr){throw q.M.showMessage("Error: ".concat(Zr.message)),Zr}}var X=n(9285),Z=n(3651),Q=n.n(Z),$=n(8176),ee=n(2959),te=n(2686);const ne="DVID";function ie(e){return e.text()}function re(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee.fx;const n="".concat(e.url),i={method:e.method,body:e.payload};return""===e.responseType?(0,te.Bk)(n,i,ie,t):"arraybuffer"===e.responseType?(0,te.Bk)(n,i,te.Rc,t):(0,te.Bk)(n,i,te.cj,t)}function oe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ee.fx;return function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ee.fx;return(0,$.R)(e,t,n,i,((e,t)=>{const n=Q()({},t);return e.token&&(n.headers=Q()(Q()({},n.headers),{Authorization:"Bearer ".concat(e)})),n}),(e=>{const t=e.status;if(504===t)return"retry";throw e}),r)}(e,t.url,{method:t.method,body:t.payload},""===t.responseType?ie:"json"===t.responseType?te.cj:te.Rc,n)}var se=n(7399),ae=n.n(se),le=n(2784);class ce extends le.uw{constructor(e){super(),this.authServer=e,this.get=(0,le.uO)((e=>{if(!this.authServer)return ae().resolve({token:""});const t=new q.M(!0);let n;return new(ae())(((i,r)=>{function o(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DVID authorization required.",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Request authorization.";t.setText(n+" ");let r=document.createElement("button");r.textContent=i,t.element.appendChild(r),r.addEventListener("click",(()=>{let t=e.match(/^[^\/]+\/\/[^\/\.]+\.([^\/]+)/);if(t){const n="https://flyemlogin.".concat(t[1],"/login");window.alert("Please log into ".concat(n," and then refresh the neurogalncer page to try again.\nIf you are unable to log into ").concat(n,", please check your authorization server ").concat(e," to make sure it is correct."))}else window.alert("Please check your authorization server ".concat(e," to make sure it is correct."))})),t.setVisible(!0)}e.add((()=>{void 0!==n&&(n.cancel(),n=void 0,t.dispose(),r(ee.wS))})),function(e){void 0!==n&&n.cancel(),n=new ee.Qi,o(e,"Waiting for DVID authorization...","Retry"),async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee.fx;return{token:await(0,te.Bk)(e,{method:"GET",credentials:"include"},ie,t)}}(e,n).then((e=>{void 0!==n&&(n=void 0,t.dispose(),i(e))}),(t=>{void 0!==n&&(n=void 0,o(e,"DVID authorization failed: ".concat(t,"."),"Retry"))}))}(this.authServer)}))}))}}class de extends le.vy{constructor(e,t){super(new ce(t),{})}}X.X.register(ne,(e=>new de(e.dvidServer,e.authServer)));var ue=n(2982),he=n(1190),pe=n.n(he),fe=n(1274),ge=n.n(fe),me=n(608),ve=n.n(me),ye=n(1767),be=n(5795),Se=n(8332),we=n(6063),xe=n.n(we),Ce=n(5677),ke=n.n(Ce);var Ee=n(7799),Te=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=ke()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&xe()(t,n,s),s};let Le=class extends Ee.T6{constructor(e,t){super(),this.provider=e,this.registerDisposer(e),this.initializeCounterpart(t)}get(e,t){return this.provider.get(e,t)}};Le=Te([(0,Ee.R6)("CredentialsProvider")],Le),(0,Ee.oJ)("CredentialsProvider.get",(function(e,t){return this.get(e.providerId).get(e.invalidCredentials,t).then((e=>({value:e})))}));var Pe=n(2311);function De(){return function(e){return class extends e{constructor(){var e;super(...arguments);const t=arguments.length<=1?void 0:arguments[1];this.credentialsProvider=null===(e=t.credentialsProvider)||void 0===e?void 0:e.addRef()}initializeCounterpart(e,t){const n=this.credentialsProvider;t.credentialsProvider=function(e,t){if(void 0===t)return;const n=e.memoize.get({type:"getSharedCredentialsProvider",credentialsProvider:(0,Pe.R)(t)},(()=>new Le(t.addRef(),e.rpc))),i=n.addCounterpartRef();return n.dispose(),i}(this.chunkManager,n),super.initializeCounterpart(e,t)}static encodeOptions(e){const t=super.encodeOptions(e),n=e.credentialsProvider;return t.credentialsProvider=void 0===n?void 0:(0,Pe.R)(n),t}}}}var Me=n(2579);const Ie=F.eR.fromValues(128,128,128);var Re;!function(e){e[e.JPEG=0]="JPEG",e[e.RAW=1]="RAW",e[e.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION",e[e.COMPRESSED_SEGMENTATIONARRAY=3]="COMPRESSED_SEGMENTATIONARRAY"}(Re||(Re={}));class Ae{}class Oe extends Ae{}Oe.RPC_ID="dvid/VolumeChunkSource";class Ne extends Ae{}Ne.RPC_ID="dvid/SkeletonSource";class _e extends Ae{}_e.RPC_ID="dvid/MeshSource";class Ve extends Ae{constructor(){super(...arguments),this.chunkDataSize=Ie}}class Be extends Ve{}Be.RPC_ID="dvid/AnnotationSource";class Fe extends Ve{}Fe.RPC_ID="dvid/AnnotationChunkSource";var Ue=n(6423),ze=n(1406),je=n(9735),Ge=n(6974),We=n(7970);class He{constructor(e,t){this.numLevels=1;try{if((0,We.verifyObject)(e),"dvid"===t){let t=(0,We.verifyObjectProperty)(e,"Extended",We.verifyObject);if(t.MaxDownresLevel){let e=(0,We.verifyObjectProperty)(t,"MaxDownresLevel",We.verifyPositiveInt);this.numLevels=e+1}this.voxelSize=(0,We.verifyObjectProperty)(t,"VoxelSize",(e=>(0,We.parseIntVec)(F.eR.create(),e))),this.upperVoxelBound=(0,We.verifyObjectProperty)(t,"MaxPoint",(e=>(0,We.parseIntVec)(F.eR.create(),e.map((e=>++e))))),this.lowerVoxelBound=(0,We.verifyObjectProperty)(t,"MinPoint",(e=>(0,We.parseIntVec)(F.eR.create(),e))),this.blockSize=(0,We.verifyObjectProperty)(t,"BlockSize",(e=>(0,We.parseIntVec)(F.eR.create(),e)))}else{if("gs"!==t)throw new Error("unrecognized volume info");{(0,We.verifyObject)(e);const t=(0,We.verifyObjectProperty)(e,"scales",(e=>e));if(0===t.length)throw new Error("Expected at least one scale");const n=t[0];this.voxelSize=(0,We.verifyObjectProperty)(n,"resolution",(e=>(0,We.parseFiniteVec)(F.eR.create(),e))),this.lowerVoxelBound=(0,We.verifyOptionalObjectProperty)(n,"offset",(e=>(0,We.parseIntVec)(F.eR.create(),e)))||F.eR.fromValues(0,0,0);const i=(0,We.verifyObjectProperty)(n,"size",(e=>(0,We.parseIntVec)(F.eR.create(),e)));this.upperVoxelBound=F.eR.add(F.eR.create(),i,this.lowerVoxelBound),this.blockSize=F.eR.fromValues(64,64,64)}}}catch(n){throw new Error("Failed to parse volume geometry: ".concat(n.message))}}}class qe{constructor(e){try{this.scales=[],this.scales.push(e);let t=e.voxelSize,n=e.lowerVoxelBound,i=e.upperVoxelBound;for(let r=1;r<e.numLevels;++r){let r=Q()({},e);r.voxelSize=F.eR.multiply(F.eR.create(),t,F.eR.fromValues(2,2,2)),t=r.voxelSize,r.upperVoxelBound=F.eR.ceil(F.eR.create(),F.eR.divide(F.eR.create(),i,F.eR.fromValues(2,2,2))),i=r.upperVoxelBound,r.lowerVoxelBound=F.eR.ceil(F.eR.create(),F.eR.divide(F.eR.create(),n,F.eR.fromValues(2,2,2))),n=r.lowerVoxelBound,this.scales.push(r)}}catch(t){throw new Error("Failed to parse multiscale volume specification: ".concat(t.message))}}get numChannels(){return 0===this.scales.length?0:this.scales[0].numChannels}}var Ye=n(9063),Je=n(156),Ke=n(6344);let Xe=new(ve());Xe.set("uint8",L.pe.UINT8),Xe.set("uint32",L.pe.UINT32),Xe.set("uint64",L.pe.UINT64);class Ze{constructor(e){this.obj=e,(0,We.verifyObject)(e),(0,We.verifyObjectProperty)(e,"TypeName",We.verifyString)}get typeName(){return this.obj.TypeName}get compressionName(){return this.obj.Compression}get tags(){return this.obj.Tags}}class Qe{constructor(e,t,n){this.name=t,this.base=n,this.volumeInfo=new He(function(e,t){if(!e)return t;const n=t&&t.Extended||{};let i=n.MaxDownresLevel,r=n.MaxPoint,o=n.MinPoint,s=n.VoxelSize,a=n.BlockSize;try{e.MaxDownresLevel&&"string"===typeof e.MaxDownresLevel?(i=parseInt((0,We.verifyObjectProperty)(e,"MaxDownresLevel",We.verifyString)),i<0&&(i=n.MaxDownresLevel)):"number"===typeof e.MaxDownresLevel&&(i=(0,We.verifyObjectProperty)(e,"MaxDownresLevel",We.verifyNonnegativeInt))}catch(l){}try{e.MaxPoint&&"string"===typeof e.MaxPoint?r=JSON.parse((0,We.verifyObjectProperty)(e,"MaxPoint",We.verifyString)):Array.isArray(e.MaxPoint)&&3===e.MaxPoint.length&&(r=e.MaxPoint)}catch(l){}try{e.MinPoint&&"string"===typeof e.MinPoint?o=JSON.parse((0,We.verifyObjectProperty)(e,"MinPoint",We.verifyString)):Array.isArray(e.MinPoint)&&3===e.MinPoint.length&&(o=e.MinPoint)}catch(l){}try{e.VoxelSize&&"string"===typeof e.VoxelSize?s=JSON.parse((0,We.verifyObjectProperty)(e,"VoxelSize",We.verifyString)):Array.isArray(e.VoxelSize)&&3===e.VoxelSize.length&&(s=e.VoxelSize)}catch(l){}try{e.BlockSize&&"string"===typeof e.BlockSize?a=JSON.parse((0,We.verifyObjectProperty)(e,"BlockSize",We.verifyString)):Array.isArray(e.BlockSize)&&3===e.BlockSize.length&&(a=e.BlockSize)}catch(l){}return{Base:t&&t.Base||{},Extended:Q()(Q()({},n),{VoxelSize:s,MinPoint:o,MaxPoint:r,MaxDownresLevel:i,BlockSize:a})}}(n.tags,e),"dvid")}get lowerVoxelBound(){return this.volumeInfo.lowerVoxelBound}get upperVoxelBound(){return this.volumeInfo.upperVoxelBound}get blockSize(){return this.volumeInfo.blockSize}get voxelSize(){return this.volumeInfo.voxelSize}get numLevels(){return this.volumeInfo.numLevels}}class $e extends((0,be.nx)(De()(S.RS),Oe)){}class et extends((0,be.nx)(De()(ze.tr),Ne)){}class tt extends((0,be.nx)(De()(Ue.No),_e)){}class nt extends Qe{constructor(e,t,n,i,r){super(e,t,n),this.encoding=i;let o=(0,We.verifyObjectProperty)(e,"Extended",We.verifyObject),s=(0,We.verifyObjectProperty)(o,"Values",(e=>(0,We.parseArray)(e,We.verifyObject)));if(s.length<1)throw new Error("Expected Extended.Values property to have length >= 1, but received: ${JSON.stringify(extendedValues)}.");let a=new(ge())(r);if(i!==Re.COMPRESSED_SEGMENTATIONARRAY)for(;a.has(t+"_"+this.volumeInfo.numLevels.toString());)this.volumeInfo.numLevels+=1;a.has(t+"_meshes")?this.meshSrc=t+"_meshes":this.meshSrc="",a.has(t+"_skeletons")?this.skeletonSrc=t+"_skeletons":this.skeletonSrc="",this.dataType=(0,We.verifyObjectProperty)(s[0],"DataType",(e=>(0,We.verifyMapKey)(e,Xe)))}get volumeType(){return this.encoding===Re.COMPRESSED_SEGMENTATION||this.encoding===Re.COMPRESSED_SEGMENTATIONARRAY?L.rU.SEGMENTATION:L.rU.IMAGE}getSources(e,t,n,i){const r=this.encoding,o=[];for(let s=0;s<this.numLevels;++s){const a=Math.pow(2,s),l=Math.pow(2,-s),c=F.eR.create(),d=F.eR.create();for(let e=0;e<3;++e){const t=Math.floor(this.lowerVoxelBound[e]*l);c[e]=t-t%64;const n=Math.ceil(this.upperVoxelBound[e]*l);d[e]=n,n%64!==0&&(d[e]+=64-n%64)}let u=t.dataInstanceKey;r!==Re.COMPRESSED_SEGMENTATIONARRAY&&s>0&&(u+="_"+s.toString());const h=Q()(Q()({},t),{dataInstanceKey:u,dataScale:s.toString(),encoding:r}),p=F.pB.create();for(let e=0;e<3;++e)p[5*e]=a,p[12+e]=c[e]*a;const f=(0,L.vn)({rank:3,chunkToMultiscaleTransform:p,dataType:this.dataType,baseVoxelOffset:c,upperVoxelBound:F.eR.subtract(F.eR.create(),d,c),volumeType:this.volumeType,volumeSourceOptions:n,compressedSegmentationBlockSize:r===Re.COMPRESSED_SEGMENTATION||r===Re.COMPRESSED_SEGMENTATIONARRAY?F.eR.fromValues(8,8,8):void 0}).map((t=>({chunkSource:e.getChunkSource($e,{spec:t,parameters:h,credentialsProvider:i}),chunkToMultiscaleTransform:p})));o.push(f)}return(0,je.RO)(o)}}function it(e){let t=(0,We.verifyObjectProperty)(e,"Base",We.verifyObject),n=(0,We.verifyObjectProperty)(t,"Syncs",We.verifyStringArray);return 1===n.length?n[0]:""}class rt extends Qe{get tags(){return(0,We.verifyObjectProperty)(this.base.obj,"Tags",We.verifyObject)}constructor(e,t,n){super(e,t,n)}}function ot(e,t,n){(0,We.verifyObject)(e);let i=e[t],r=(0,We.verifyObjectProperty)(i,"Base",(e=>new Ze(e)));if("annotation"===r.typeName){let n=it(i);return n&&(i=e[n]),new rt(i,t,r)}return function(e,t,n){(0,We.verifyObject)(e);let i=(0,We.verifyObjectProperty)(e,"Base",(e=>new Ze(e)));switch(i.typeName){case"uint8blk":case"grayscale8":let r=-1!==i.compressionName.indexOf("jpeg");return new nt(e,t,i,r?Re.JPEG:Re.RAW,n);case"labels64":case"labelblk":return new nt(e,t,i,Re.COMPRESSED_SEGMENTATION,n);case"labelarray":case"labelmap":return new nt(e,t,i,Re.COMPRESSED_SEGMENTATIONARRAY,n);default:throw new Error("DVID data type ".concat(p()(i.typeName)," is not supported."))}}(i,t,n)}class st{constructor(e){if(this.errors=[],this.dataInstances=new(ve()),this.vnodes=new(ge()),e instanceof st)return this.alias=e.alias,this.description=e.description,this.errors=e.errors,void(this.dataInstances=e.dataInstances);(0,We.verifyObject)(e),this.alias=(0,We.verifyObjectProperty)(e,"Alias",We.verifyString),this.description=(0,We.verifyObjectProperty)(e,"Description",We.verifyString);let t=(0,We.verifyObjectProperty)(e,"DataInstances",We.verifyObject),n=pe()(t);for(let s of n)try{this.dataInstances.set(s,ot(t,s,n))}catch(o){let e="Failed to parse data instance ".concat(p()(s),": ").concat(o.message);console.log(e),this.errors.push(e)}let i=(0,We.verifyObjectProperty)(e,"DAG",We.verifyObject),r=(0,We.verifyObjectProperty)(i,"Nodes",We.verifyObject);for(let s of pe()(r))this.vnodes.add(s)}}class at{constructor(e){this.repositories=function(e){try{let i=(0,We.verifyObjectAsMap)(e,(e=>new st(e))),r=new(ve());for(let e of i){var t=(0,ue.A)(e,2);let n=t[0],i=t[1];r.set(n,i);for(let e of i.vnodes)if(e!==n){let t=new st(i);r.set(e,t)}}for(let e of r){var n=(0,ue.A)(e,2);let t=n[0];n[1].uuid=t}return r}catch(i){throw new Error("Failed to parse DVID repositories info: ".concat(i.message))}}(e)}getNode(e){let t=[];for(let n of this.repositories.keys())n.startsWith(e)&&t.push(n);if(1!==t.length)throw new Error("Node key ".concat(p()(e)," matches ").concat(p()(t)," nodes."));return this.repositories.get(t[0])}}function lt(e,t,n){return e.memoize.getUncounted({type:"dvid:getServerInfo",baseUrl:t},(()=>{const e=oe(n,{url:"".concat(t,"/api/repos/info"),method:"GET",responseType:"json"}).then((e=>new at(e))),i="repository info for DVID server ".concat(t);return q.M.forPromise(e,{initialMessage:"Retrieving ".concat(i,"."),delay:!0,errorPrefix:"Error retrieving ".concat(i,": ")}),e}))}class ct extends S.kg{constructor(e,t,n,i){super(e),this.sourceParameters=t,this.info=n,this.credentialsProvider=i}get dataType(){return this.info.dataType}get volumeType(){return this.info.volumeType}get rank(){return 3}get baseUrl(){return this.sourceParameters.baseUrl}get nodeKey(){return this.sourceParameters.nodeKey}get dataInstanceKey(){return this.sourceParameters.dataInstanceKey}get supervoxels(){return this.sourceParameters.supervoxels||!1}getSegmentPosition(e){const t=this.sourceParameters.dvidService;return t?fetch("".concat(t,"/locate-body?dvid=").concat(this.baseUrl,"&uuid=").concat(this.nodeKey,"&segmentation=").concat(this.dataInstanceKey,"&body=").concat(e.toString()).concat(this.supervoxels?"&supervoxels=true":""),{method:"GET"}).then((e=>e.json())).then((e=>new Float32Array(e))):ae().reject("No locate service is available")}getSources(e){return this.info.getSources(this.chunkManager,this.sourceParameters,e,this.credentialsProvider)}}const dt=/^((?:http|https):\/\/[^\/]+)\/([^\/]+)\/([^\/\?#]+)(?:(?:\?|#)(.*))?$/;function ut(e){return e.startsWith("https")?e+"/api/server/token":void 0}function ht(e,t){let n=e=>{const n=e.lowerVoxelBound,i=e.upperVoxelBound,r=function(e,t,n){return e.usertag?F.eR.sub(F.eR.create(),n,t):e.chunkDataSize}(t,n,i);return{spec:(0,Je._g)({rank:3,chunkDataSize:Uint32Array.from(r),lowerVoxelBound:n,upperVoxelBound:i}),chunkToMultiscaleTransform:F.pB.create()}};if(t.usertag){if(t.user)return[[n(e.scales[0])]];throw"Expecting a valid user"}return[e.scales.map((e=>n(e)))]}const pt=(0,be.nx)(De()(Ye.oZ),Be);class ft extends((0,be.nx)(De()(Ye.eU),Fe)){}class gt extends pt{constructor(e,t){super(e,Q()({rank:3,relationships:["segments"],properties:t.parameters.properties},t)),this.readonly=!1,this.parameters=t.parameters,this.multiscaleVolumeInfo=t.multiscaleVolumeInfo,this.childAdded=this.childAdded||new Ke.HN,this.childUpdated=this.childUpdated||new Ke.HN,this.childDeleted=this.childDeleted||new Ke.HN,this.childRefreshed=this.childRefreshed||new Ke.IY,void 0!==this.parameters.readonly&&(this.readonly=this.parameters.readonly),this.parameters.user||(this.readonly=!0)}getSources(e){let t=ht(this.multiscaleVolumeInfo,this.parameters),n=0;return t[0].length>1&&(n=3),this.chunkSources=t.map((e=>e.map((e=>{let{spec:t,chunkToMultiscaleTransform:i}=e;return{chunkSource:this.chunkManager.getChunkSource(ft,{spec:Q()({limit:n,chunkToMultiscaleTransform:i},t),parent:this,credentialsProvider:this.credentialsProvider,parameters:this.parameters}),chunkToMultiscaleTransform:i}})))),this.chunkSources}invalidateCache(){this.metadataChunkSource.invalidateCache();for(let e of this.chunkSources)for(let t of e)t.chunkSource.invalidateCache();for(let e of this.segmentFilteredSources)e.invalidateCache();this.childRefreshed.dispatch()}}async function mt(e,t,n,i){const r={lowerBounds:new Float64Array(n.lowerVoxelBound),upperBounds:Float64Array.from(n.upperVoxelBound)},o=(0,Se.d)({rank:3,names:["x","y","z"],units:["m","m","m"],scales:Float64Array.from(n.voxelSize,(e=>e/1e9)),boundingBoxes:[(0,Se.T4)(r)]}),s=await async function(e,t,n,i){return r=new qe(n.volumeInfo),o=t,e.chunkManager.getChunkSource(gt,{parameters:o,credentialsProvider:i,multiscaleVolumeInfo:r});var r,o}(e,t,n,i);return{modelTransform:(0,Se.FH)(o),subsources:[{id:"default",subsource:{annotation:s},default:!0}]}}function vt(e){return e.chunkManager.memoize.getUncounted({type:"dvid:MultiscaleVolumeChunkSource",sourceUrl:e.providerUrl},(async()=>{const t=function(e){let t=e.match(dt);if(null===t)throw new Error("Invalid DVID URL: ".concat(p()(e),"."));let n={baseUrl:t[1],nodeKey:t[2],dataInstanceKey:t[3]};const i=t[4];if(i){const e=(0,We.parseQueryStringParameters)(i);"true"===e.usertag&&(n.usertag=!0),e.user&&(n.user=e.user);const t=e.dvidService||e.dvidservice||e["dvid-service"];t&&(n.dvidService=t),(e.forceDvidService||e.forcedividservice||e["force-dvid-service"])&&(n.forceDvidService=!0),n.supervoxels="true"===e.supervoxels}return n.authServer=ut(n.baseUrl),n}(e.providerUrl),n=t.baseUrl,i=t.nodeKey,r=t.dataInstanceKey,o=i.indexOf(":"),s=-1!==o?i.slice(0,o):i,a=e.credentialsManager.getCredentialsProvider(ne,{dvidServer:t.baseUrl,authServer:t.authServer}),l=(await lt(e.chunkManager,n,a)).getNode(s);if(void 0===l)throw new Error("Invalid node: ".concat(p()(i),"."));const c=l.dataInstances.get(r);if(!c)throw new Error("Invalid data instance ".concat(r,"."));if("annotation"===c.base.typeName){if(!(c instanceof rt))throw new Error("Invalid data instance ".concat(r,"."));let n=Q()(Q()({},new Be),t);return c.blockSize&&(n.chunkDataSize=c.blockSize),n.syncedLabel=it({Base:c.base.obj}),n.properties=[{identifier:"rendering_attribute",description:"rendering attribute",type:"int32",default:0,min:0,max:5,step:1},{identifier:"confidence",description:"confidence",type:"float32",default:0,min:0,max:1,step:.01}],mt(e,n,c,a)}if(!(c instanceof nt))throw new Error("Invalid data instance ".concat(r,"."));return function(e,t,n,i){const r=n,o={lowerBounds:new Float64Array(r.lowerVoxelBound),upperBounds:Float64Array.from(r.upperVoxelBound)},s=(0,Se.d)({rank:3,names:["x","y","z"],units:["m","m","m"],scales:Float64Array.from(r.voxelSize,(e=>e/1e9)),boundingBoxes:[(0,Se.T4)(o)]}),a=new ct(e.chunkManager,t,r,i),l={modelTransform:(0,Se.FH)(s),subsources:[{id:"default",subsource:{volume:a},default:!0}]};if(r.meshSrc){const n=F.pB.create();for(let e=0;e<3;++e)n[5*e]=1/r.voxelSize[e];l.subsources.push({id:"meshes",default:!0,subsource:{mesh:e.chunkManager.getChunkSource(tt,{parameters:Q()(Q()({},t),{segmentationName:r.name,dataInstanceKey:r.meshSrc}),credentialsProvider:i})},subsourceToModelSubspaceTransform:n})}return r.skeletonSrc&&l.subsources.push({id:"skeletons",default:!0,subsource:{mesh:e.chunkManager.getChunkSource(et,{parameters:Q()(Q()({},t),{dataInstanceKey:r.skeletonSrc}),credentialsProvider:i})}}),l.subsources.push({id:"bounds",subsource:{staticAnnotations:(0,ye.Sl)(o)},default:!0}),l}(e,t,c,a)}))}function yt(e,t){let n=t.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===n)throw new Error("Invalid DVID URL syntax.");if(void 0===n[2])return{offset:0,completions:(0,Ge.BH)(t,e.repositories.values(),(e=>e.uuid+"/"),(e=>"".concat(e.alias,": ").concat(e.description)))};let i=n[1],r=e.getNode(i);return(0,Ge.KV)(i.length+1,function(e,t){return{offset:0,completions:(0,Ge.BH)(t,e.dataInstances.values(),(e=>e.name),(e=>"".concat(e.base.typeName)))}}(r,n[2]))}class bt extends Me.tc{constructor(e){super(),this.credentialsManager=e}get description(){return"DVID"}get(e){return vt(e)}completeUrl(e){return async function(e){let t=e.providerUrl.match(/^((?:http|https):\/\/[^\/]+)\/([^\?]*).*$/);if(null===t)throw null;let n=t[1],i=t[2],r=ut(n);const o=await lt(e.chunkManager,n,e.credentialsManager.getCredentialsProvider(ne,{dvidServer:n,authServer:r}));return(0,Ge.KV)(n.length+1,yt(o,i))}(e)}}var St=n(9312);function wt(e){return e.text()}function xt(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ee.fx;const r={method:n.method,body:n.payload};return"POST"===r.method&&(r.headers={"Content-Type":"application/json"}),function(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ee.fx;return(0,$.R)(e,n,i,r,function(e){return(t,n)=>{let i=Q()({},n);return t?i.headers=Q()(Q()({},i.headers),{Authorization:"Bearer ".concat(t)}):e.startsWith("https:")&&(i.credentials="include"),i}}(n),(e=>{const n=e.status;if((403===n||401===n)&&t)return"refresh";if(504===n)return"retry";throw e}),o)}(e,t,n.url,r,""===n.responseType?wt:"json"===n.responseType?te.cj:te.Rc,i)}(0,St.Z)("dvid",(e=>new bt(e.credentialsManager)));class Ct extends le.uw{constructor(e,t){var n;super(),n=this,this.authServer=e,this.retry=t,this.get=(0,le.uO)((e=>{const t=new q.M(!0);let i;return new(ae())(((r,o)=>{e.add((()=>{void 0!==i&&(i.cancel(),i=void 0,t.dispose(),o(ee.wS))}));const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Authorization required.",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Request authorization.";if(t.setText(e+" "),n.retry){let e=document.createElement("button");e.textContent=i,t.element.appendChild(e),e.addEventListener("click",n.retry)}t.setVisible(!0)};let a=this.authServer;(()=>{void 0!==i&&i.cancel(),i=new ee.Qi,s("Waiting for authorization...","Retry"),this.getAuthToken(a,i).then((e=>{void 0!==i&&(i=void 0,t.dispose(),r(e))}),(e=>{void 0!==i&&(i=void 0,s("Authorization failed: ".concat(e,"."),"Retry"))}))})()}))}))}getAuthToken(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee.fx;if(e){if(e.startsWith("token:"))return ae().resolve(e.substring(6));if("neurohub"==e)return"neurohub"in(n=window)?ae().resolve(n.neurohub.clio.auth.getAuthResponse().id_token):ae().resolve("");{const n=new Headers;return(0,te.Bk)(e,{method:"GET",headers:n},wt,t).catch((()=>(0,te.Bk)(e,{method:"GET"},wt,t)))}}return ae().resolve("");var n}}const kt="Clio",Et=/^([^\/]+:\/\/[^\/]+)\/([^\/]+)\/([^\/\?]+)(\?.*)?$/;function Tt(e){let t=(0,te.Dl)(e);return"precomputed"===t.protocol&&(t=(0,te.Dl)(t.host+t.path)),t}function Lt(e){let t=e.protocol,n=e.host,i=e.path;switch(t){case"gs":return"https://storage.googleapis.com/".concat(n).concat(i,"/info");case"dvid":const e=function(e){let t=e.match(Et);if(null===t)throw new Error("Invalid DVID URL: ".concat(p()(e),"."));return{baseUrl:t[1],nodeKey:t[2],dataInstanceKey:t[3]}}(n+i);return"".concat(e.baseUrl,"/api/node/").concat(e.nodeKey,"/").concat(e.dataInstanceKey,"/info");case"https":return"".concat(t,"://").concat(n).concat(i,"/info");default:throw Error("Unrecognized volume information")}}class Pt{constructor(e){this.parameters=e}getTopLevelUrl(){var e=this.parameters;const t=e.baseUrl,n=e.api;return"".concat(t,"/").concat(n||"clio_toplevel")}getDatasetsUrl(){return"".concat(this.getTopLevelUrl(),"/datasets")}getGrayscaleInfoUrl(){return Lt(Tt(this.parameters.grayscale))}getAnnotationEndpoint(){return"Atlas"===this.parameters.kind?"atlas":"annotations"}getAnnotationEntryUrl(){return"".concat(this.getTopLevelUrl(),"/").concat(this.getAnnotationEndpoint(),"/").concat(this.parameters.dataset)}getAllAnnotationsUrl(){return this.getAnnotationEntryUrl()+(this.parameters.groups?"?groups=".concat(this.parameters.groups):"")}hasPointQueryApi(){return"clio_toplevel"===this.parameters.api||"Atlas"===this.parameters.kind}getPostAnnotationUrl(e){return this.hasPointQueryApi()?"".concat(this.getAnnotationEntryUrl(),"?x=").concat(e[0],"&y=").concat(e[1],"&z=").concat(e[2]):this.getAnnotationEntryUrl()}getDeleteAnnotationUrl(e){if(this.hasPointQueryApi()){const t=e.match(/(-?\d+)_(-?\d+)_(-?\d+)/);if(t)return this.getAnnotationUrl(null===t||void 0===t?void 0:t.slice(1,4))}return"".concat(this.getAnnotationEntryUrl(),"/").concat(e)}getAnnotationUrl(e){return"".concat(this.getAnnotationEntryUrl(),"?x=").concat(e[0],"&y=").concat(e[1],"&z=").concat(e[2])}}class Dt extends Ct{constructor(e){super(e),this.authServer=e}}X.X.register(kt,(e=>new Dt(e)));var Mt=n(281),It=n.n(Mt);function Rt(e){return class extends e{constructor(){super(...arguments)}}}(0,Ee.ks)("annotation.add.signal",(function(e){const t=this.get(e.id),n=(0,ye.aW)(e.newAnnotation);n&&(t.parent.updateReference(n),t.parent.childAdded.dispatch(n))}));class At{}class Ot extends At{}class Nt extends At{}class _t extends At{}Rt(Ot);Rt(Nt);Rt(_t);class Vt{constructor(e){this.annotation=e}get renderingAttribute(){if("Atlas"===this.kind){if(!this.title)return-1;if(this.checked)return 1}else{if("False Split"===this.bookmarkType)return 2;if("False Merge"===this.bookmarkType)return 3}return 0}get confidence(){return 0}updateProperties(){this.annotation.properties=[this.renderingAttribute,this.confidence]}get ext(){return void 0===this.annotation.ext&&(this.annotation.ext={}),this.annotation.ext}get prop(){return this.annotation.prop}set prop(e){this.annotation.prop=e}get bookmarkType(){if(this.prop)switch(this.prop.type){case"Split":return"False Merge";case"Merge":return"False Split"}return"Other"}get type(){return this.annotation.type}get kind(){return this.annotation.kind}set kind(e){this.annotation.kind=e,this.update()}roundPos(){this.annotation.type===ye.UJ.POINT?this.annotation.point=this.annotation.point.map((e=>Math.round(e))):this.annotation.type!==ye.UJ.LINE&&this.annotation.type!==ye.UJ.SPHERE||(this.annotation.pointA=this.annotation.pointA.map((e=>Math.round(e))),this.annotation.pointB=this.annotation.pointB.map((e=>Math.round(e))))}setProp(e){this.prop=Q()(Q()({},this.prop),e)}get user(){return this.prop&&this.prop.user}set user(e){this.setProp({user:e})}get comment(){return this.prop&&this.prop.comment}get description(){return this.comment}updatePresentation(){this.title?this.annotation.description=this.title+": ":this.annotation.description="",this.description&&(this.annotation.description+=this.description)}update(){this.updatePresentation(),this.updateProperties()}set comment(e){this.setProp({comment:e}),this.updatePresentation()}updateComment(){this.comment=this.annotation.description||"",this.annotation.description=void 0}get title(){return this.prop&&this.prop.title}set title(e){this.setProp({title:e}),this.updatePresentation()}get timestamp(){return this.prop&&this.prop.timestamp?Number(this.prop.timestamp):0}addTimeStamp(){this.setProp({timestamp:String(Date.now())})}get checked(){return this.ext&&this.ext.verified||this.prop&&this.prop.checked||!1}set checked(e){this.setProp({checked:e})}get presentation(){return this.updatePresentation(),this.annotation.description||""}set presentation(e){this.annotation.description=e}}function Bt(e,t){let n;const i=function(e){const t=e.split(".")[1];if(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(n)}}(e);if(i&&("user"in i?n=i.user:"email"in i&&(n=i.email)),n){if(t&&t!==n)return}else n=t;return n}const Ft={definitions:{},type:"object",required:["Prop"],properties:{Prop:{$id:"#/properties/Prop",type:"object",title:"Properties",required:["comment"],properties:{comment:{$id:"#/properties/Prop/properties/comment",type:"string",title:"Comment",default:""}}}}};class Ut extends Vt{get title(){return this.annotation.ext&&this.annotation.ext.title}set title(e){this.ext.title=e}get description(){return this.annotation.ext&&this.annotation.ext.description}set description(e){this.ext.description=e}get user(){return this.annotation.ext&&this.annotation.ext.user}set user(e){this.ext.user=e}get checked(){return this.ext&&this.ext.verified}set checked(e){this.ext.verified=e}}const zt={definitions:{},type:"object",required:["Prop"],properties:{Prop:{$id:"#/properties/Prop",type:"object",title:"Properties",required:["description"],properties:{description:{$id:"#/properties/Prop/properties/description",type:"string",title:"Description",default:""}}}}},jt={definitions:{},type:"object",required:["Prop"],properties:{Prop:{$id:"#/properties/Prop",type:"object",title:"Properties",required:["title","description"],properties:{title:{$id:"#/properties/Prop/properties/title",type:"string",title:"Title",default:""},description:{$id:"#/properties/Prop/properties/description",type:"string",title:"Description",default:""}}}}};function Gt(e){return Array.isArray(e)}function Wt(e){return!Gt(e)&&null!==e&&"object"===typeof e}class Ht{constructor(e){this.name=e,this.childNodeList=new Array,this.parentNode=null}isRoot(){return null===this.parentNode}isLeaf(){return 0===this.childNodeList.length}*[It()](){yield*function*e(t){yield t;for(let n of t.childNodeList)yield*e(n)}(this)}*leafNodes(){for(let e of this)0===e.childNodeList.length&&(yield e)}get fullName(){let e=this.name,t=this.parentNode;for(;t;)e=t.name+"/"+e,t=t.parentNode;return e}get nameArray(){let e=new Array;if(!this.isRoot()){e.push(this.name);let t=this.parentNode;for(;t&&!t.isRoot();)e.push(t.name),t=t.parentNode}return e}getPropertyValue(e){if(!this.isRoot()&&e){let t=this.nameArray,n=e;for(let e=t.length-1;e>=0;--e){if(!Wt(n))return n;n=n[t[e]]}return n}}}function qt(e,t){if("object"==e.type){void 0==t.properties&&(t.properties={}),t.properties.title=e.title;let n=e.required;Gt(n)&&n.forEach((n=>{let i=new Ht(n);i.parentNode=t,t.childNodeList.push(i),qt(e.properties[n],i)}))}else t.properties=e}function Yt(e,t){let n=new Ht(t);return qt(e,n),n}const Jt="annotation";function Kt(e,t,n){let i,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=document.createElement("div"),s=e.title;switch(s&&o.appendChild(document.createTextNode(s)),e.type){case"number":i=document.createElement("input"),"number"===typeof n&&(i.text=n);break;case"string":let t=e.enum;Array.isArray(t)?(i=document.createElement("select"),o.appendChild(i),t.forEach((e=>{let t=document.createElement("option");t.text=e,t.value=e,t.disabled=r,i.appendChild(t)})),void 0!==n&&(i.value=n)):(i=document.createElement("input"),i.setAttribute("autocomplete","off"),"string"===typeof n&&(i.value=n,i.setAttribute("value",n)));break;case"boolean":i=document.createElement("input"),i.type="checkbox",i.checked="boolean"===typeof n?n:1==n}return i&&(i.id=t,i.readOnly=r,o.appendChild(i)),o}function Xt(e,t){return e+"/"+t}function Zt(e,t){return function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=document.createElement("div"),o=Yt(e,n);o.record=r;for(let s of o)if(!s.isRoot())if(s.isLeaf()){let e=s.getPropertyValue(t),n=Kt(s.properties,s.fullName,e,i);s.parentNode.record.appendChild(n)}else{let e=document.createElement("fieldset"),t=document.createElement("legend");t.textContent=s.properties.title,e.appendChild(t),s.record=e,s.parentNode.record.appendChild(e)}return r}(e,t,Jt,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}function Qt(e,t,n,i){"object"===e.type?e.required.forEach((r=>{let o=n;t&&("undefined"===typeof n[t]&&(n[t]={}),o=n[t]),Qt(e.properties[r],r,o,Xt(i,r))})):n[t]=function(e){let t=document.getElementById(e);if(t)return"checkbox"===t.type?t.checked:t.value}(i)}JSON.parse('\n{\n  "definitions": {},\n  "type": "object",\n  "required": [\n    "Prop"\n  ],\n  "properties": {\n    "Prop": {\n      "$id": "#/properties/Prop",\n      "type": "object",\n      "title": "Properties",\n      "required": [\n        "comment",\n        "type",\n        "checked"\n      ],\n      "properties": {\n        "comment": {\n          "$id": "#/properties/Prop/properties/comment",\n          "type": "string",\n          "title": "Comment",\n          "default": ""\n        },\n        "type": {\n          "$id": "#/properties/Prop/properties/type",\n          "type": "string",\n          "title": "Type",\n          "enum": ["Merge", "Split", "Other"]\n        },\n        "checked": {\n          "$id": "#/properties/Prop/properties/checked",\n          "type": "boolean",\n          "title": "Checked"\n        }\n      }\n    }\n  }\n}\n');const $t=F.eR.fromValues(64,64,64);class en{}class tn extends en{constructor(){super(...arguments),this.chunkDataSize=$t}}class nn extends tn{}nn.RPC_ID="clio/Annotation";class rn extends tn{}rn.RPC_ID="clio/AnnotationChunkSource";class on extends((0,be.nx)(De()(Ye.eU),rn)){}const sn=(0,be.nx)(De()(Ye.oZ),nn);class an extends sn{constructor(e,t){super(e,Q()({rank:3,relationships:["segments"],properties:t.parameters.properties},t)),this.readonly=!1,this.parameters=t.parameters,this.dataInfo=t.dataInfo,this.childAdded=this.childAdded||new Ke.HN,this.childUpdated=this.childUpdated||new Ke.HN,this.childDeleted=this.childDeleted||new Ke.HN,this.makeEditWidget=e=>function(e,t,n,i,r,o){const s=Q()({},e.value);if(s.type!==ye.UJ.POINT&&s.type!==ye.UJ.LINE&&s.type!==ye.UJ.SPHERE)return null;t||(t=Ft);const a=i(s),l=r?r(s):a.prop;let c=Zt(t,l?{Prop:l}:{},n.readonly),d=document.createElement("button");return d.textContent="update",d.onclick=()=>{let i={};Qt(t,"",i,"annotation");const r=i.Prop;o?o(s,r):a.setProp(r),a.update(),n.update(e,s),n.commit(e)},c.appendChild(d),c}(e,this.parameters.schema,this,(e=>new Ut(e)),(e=>Q()(Q()({},e.prop),e.ext)),((e,t)=>{const n=new Ut(e);t.title&&(n.title=t.title),t.description&&(n.description=t.description)})),this.getUser=()=>this.parameters.user}getSources(e){let t=[[(e=>{const t=e.upperVoxelBound;return{spec:(0,Je._g)({rank:3,chunkDataSize:Uint32Array.from(t),lowerVoxelBound:e.lowerVoxelBound,upperVoxelBound:e.upperVoxelBound}),chunkToMultiscaleTransform:F.pB.create()}})(this.dataInfo)]];let n=0;return t[0].length>1&&(n=10),t.map((e=>e.map((e=>{let{spec:t,chunkToMultiscaleTransform:i}=e;return{chunkSource:this.chunkManager.getChunkSource(on,{spec:Q()({limit:n,chunkToMultiscaleTransform:i},t),parent:this,credentialsProvider:this.credentialsProvider,parameters:this.parameters}),chunkToMultiscaleTransform:i}}))))}*[It()](){for(let e of this.references)e[1].value&&(yield e[1].value)}commit(e){!e.value||e.value.type!==ye.UJ.LINE&&e.value.type!==ye.UJ.SPHERE||(e.value.pointA=e.value.pointA.map((e=>Math.round(e))),e.value.pointB=e.value.pointB.map((e=>Math.round(e)))),super.commit(e)}add(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.readonly){let e="Permission denied for changing annotations.";throw q.M.showTemporaryMessage(e),Error(e)}const n=new Ut(e);if(n.addTimeStamp(),this.parameters.user&&(n.user=this.parameters.user),e.type===ye.UJ.POINT&&(n.kind=this.parameters.kind||"Note",e.description)){let t=function(e){let t=e.match(/^\${(.*):JSON}$/);return t?JSON.parse(t[1]):null}(e.description);t&&n.setProp(t)}return n.roundPos(),n.update(),super.add(e,t)}update(e,t){const n=new Ut(t);n.roundPos(),n.update(),super.update(e,t)}invalidateCache(){this.references.forEach((e=>{e.dispose()})),this.references.clear(),this.childRefreshed.dispatch(),this.metadataChunkSource.invalidateCache();for(let e of this.getSources({multiscaleToViewTransform:new Float32Array,displayRank:1,modelChannelDimensionIndices:[]}))for(let t of e)t.chunkSource.invalidateCache();for(let e of this.segmentFilteredSources)e.invalidateCache()}}async function ln(e,t,n){const i=await async function(e){const t=e.grayscale;if(t){let e=Tt(t);return re({method:"GET",url:Lt(e),responseType:"json"}).then((t=>new He(t,"https"===e.protocol?"gs":e.protocol)))}return ae().resolve({numChannels:1,voxelSize:F.eR.fromValues(8,8,8),lowerVoxelBound:F.eR.fromValues(0,0,0),upperVoxelBound:F.eR.fromValues(5e4,5e4,5e4),blockSize:F.eR.fromValues(64,64,64),numLevels:1})}(t),r={lowerBounds:new Float64Array(i.lowerVoxelBound),upperBounds:Float64Array.from(i.upperVoxelBound)},o=(0,Se.d)({rank:3,names:["x","y","z"],units:["m","m","m"],scales:Float64Array.from(i.voxelSize,(e=>e/1e9)),boundingBoxes:[(0,Se.T4)(r)]}),s=await async function(e,t,n,i){return((t,n)=>e.chunkManager.getChunkSource(an,{parameters:n,credentialsProvider:i,dataInfo:t}))(n,t)}(e,t,i,n);return{modelTransform:(0,Se.FH)(o),subsources:[{id:"default",subsource:{annotation:s},default:!0}]}}const cn=/^([^\/]+:\/\/[^\/]+)\/(?:([^\/\?#]+)\/)?([^\/\?#]+)(?:(?:\?|#)(.*))?$/;async function dn(e,t){let n=function(e){let t=e.match(cn);if(null===t)throw new Error("Invalid Clio URL: ".concat(p()(e),"."));let n={baseUrl:t[1],api:t[2],dataset:t[3]},i=t[4];if(i){let e=(0,We.parseQueryStringParameters)(i);e.token?(n.authToken=e.token,n.authServer="token:"+e.token):e.auth&&(n.authServer=e.auth),e.user?n.user=e.user:n.authToken&&(n.user=Bt(n.authToken)),e.kind?"atlas"===e.kind?n.kind="Atlas":n.kind=e.kind:n.kind="Normal",e.groups&&(n.groups=e.groups)}return n}(e.providerUrl);if(!n.user&&n.authServer){let e=t(n.authServer).get();n.authToken=(await e).credentials,n.user=Bt(n.authToken)}return e.chunkManager.memoize.getUncounted(Q()({type:"clio:MultiscaleVolumeChunkSource"},n),(async()=>{n=await async function(e,t){const n=new Pt(e);return xt(t(e.authServer),(i=e,!!i.authServer&&("neurohub"===i.authServer||i.authServer.startsWith("http"))),{url:n.getDatasetsUrl(),method:"GET",responseType:"json"}).then((t=>{const n=(0,We.verifyObjectProperty)(t,e.dataset,We.verifyObject);if("location"in n)e.grayscale=(0,We.verifyObjectProperty)(n,"location",We.verifyString);else if("mainLayer"in n){const t=(0,We.verifyObjectProperty)(n,"mainLayer",We.verifyString),i=(0,We.verifyObjectProperty)(n,"neuroglancer",We.verifyObject).layers.find((e=>e.name===t));i.source&&i.source.url?e.grayscale=(0,We.verifyObjectProperty)(i.source,"url",We.verifyString):e.grayscale=(0,We.verifyObjectProperty)(i,"source",We.verifyString)}return e}));var i}(n,t);let i=Q()(Q()({},new nn),n);"Atlas"===n.kind?i.schema=jt:i.schema=zt,i.properties=[{identifier:"rendering_attribute",description:"rendering attribute",type:"int32",default:0,min:0,max:5,step:1}];const r=t(n.authServer);return ln(e,i,r)}))}class un extends Me.tc{constructor(e){super(),this.credentialsManager=e,this.description="Clio"}getCredentialsProvider(e){let t="";return e&&(t=e),this.credentialsManager.getCredentialsProvider(kt,t)}get(e){return dn(e,this.getCredentialsProvider.bind(this))}completeUrl(e){return async function(){return ae().resolve({offset:0,completions:[{value:""}]})}(e.providerUrl)}}(0,St.Z)("clio",(e=>new un(e.credentialsManager)));var hn=n(3008),pn=n.n(hn),fn=n(8781);const gn="google-brainmaps";function mn(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ee.fx;return(0,fn.Y)(t,"".concat(e.serverUrl).concat(n.path),{method:n.method,body:n.payload},"json"===n.responseType?te.cj:te.Rc,i)}var vn,yn=n(974),bn=n.n(yn);!function(e){e[e.RAW=0]="RAW",e[e.JPEG=1]="JPEG",e[e.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"}(vn||(vn={}));class Sn{}Sn.RPC_ID="brainmaps/VolumeChunkSource";class wn{}wn.RPC_ID="brainmaps/MultiscaleMeshSource";class xn{}xn.RPC_ID="brainmaps/MeshSource";class Cn{}Cn.RPC_ID="brainmaps/SkeletonSource";class kn{}kn.RPC_ID="brainmaps/Annotation";class En{}En.RPC_ID="brainmaps/AnnotationSpatialIndex";var Tn=n(1202),Ln=n(5553);class Pn extends((0,be.nx)(De()(S.RS),Sn)){}class Dn extends((0,be.nx)(De()(Ue.bJ),wn)){}class Mn extends((0,be.nx)(De()(Ue.No),xn)){}class In extends((0,be.nx)(De()(ze.tr),Cn)){}class Rn extends((0,be.nx)(De()(Ye.eU),En)){}const An=new(ve());function On(e){(0,We.verifyObject)(e);try{return{corner:(0,We.verifyObjectProperty)(e,"corner",(e=>(0,We.parseXYZ)(F.eR.create(),e,We.verifyFiniteFloat))),size:(0,We.verifyObjectProperty)(e,"size",(e=>(0,We.parseXYZ)(F.eR.create(),e,We.verifyFinitePositiveFloat))),metadata:(0,We.verifyObjectProperty)(e,"metadata",We.verifyOptionalString)}}catch(t){throw new Error("Failed to parse bounding box: ".concat(t.message))}}An.set("UINT8",L.pe.UINT8),An.set("FLOAT",L.pe.FLOAT32),An.set("UINT32",L.pe.UINT32),An.set("UINT64",L.pe.UINT64);class Nn{constructor(e){try{(0,We.verifyObject)(e),this.numChannels=(0,We.verifyObjectProperty)(e,"channelCount",We.verifyPositiveInt),this.dataType=(0,We.verifyObjectProperty)(e,"channelType",(e=>(0,We.verifyMapKey)(e,An))),this.voxelSize=(0,We.verifyObjectProperty)(e,"pixelSize",(e=>(0,We.parseXYZ)(F.eR.create(),e,We.verifyFinitePositiveFloat))),this.upperVoxelBound=(0,We.verifyObjectProperty)(e,"volumeSize",(e=>(0,We.parseXYZ)(F.eR.create(),e,We.verifyPositiveInt))),this.boundingBoxes=(0,We.verifyObjectProperty)(e,"boundingBox",(e=>void 0===e?[]:(0,We.parseArray)(e,On)))}catch(t){throw new Error("Failed to parse BrainMaps volume geometry: ".concat(t.message))}}}function _n(e){return(0,We.verifyObject)(e),{name:(0,We.verifyObjectProperty)(e,"name",We.verifyString),type:(0,We.verifyObjectProperty)(e,"type",We.verifyString)}}const Vn="([0-9]+)",Bn=new RegExp("^(.*)_".concat(Vn,"x").concat(Vn,"x").concat(Vn,"_lod([0-9]+)_").concat("([0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?)","$"));function Fn(e,t){const n=function(e,t){const n=new(ve()),i=e.scales[0],r=new(ge());for(const s of t){if("TRIANGLES"!==s.type)continue;const e=s.name.match(Bn);if(null===e)continue;const t=e[1];let o=n.get(t);void 0===o&&(o={key:t,chunkShape:F.eR.create(),lods:[]},n.set(t,o));const a=parseInt(e[5]);if(void 0!==o.lods[a]){r.add(t);continue}const l=F.eR.fromValues(parseInt(e[2],10),parseInt(e[3],10),parseInt(e[4],10)),c=new Uint32Array(3);for(let n=0;n<3;++n)c[n]=Math.ceil(i.upperVoxelBound[n]/l[n]);o.lods[a]={info:s,scale:parseFloat(e[6]),relativeBlockShape:l,gridShape:c}}const o=[];e:for(const s of n.values()){if(r.has(s.key))continue e;const e=s.lods[0];if(void 0===e)continue e;const t=e.relativeBlockShape;F.eR.multiply(s.chunkShape,t,i.voxelSize);for(let n=1;n<s.lods.length;++n){const e=s.lods[n];if(void 0===e)continue e;const i=e.relativeBlockShape;for(let n=0;n<3;++n){const e=i[n],r=t[n];if(e<r||e%r!==0)continue e;i[n]=e/r}}t.fill(1),o.push(s)}return o}(e,t),i=[],r=e=>{i.some((t=>t.name===e.name))||i.push(e)},o=new(ge());for(const s of n){r({multi:s,single:void 0,name:s.key,partOfMultiscale:!1});for(const e of s.lods)o.add(e.info)}for(const s of t)r({single:s,multi:void 0,name:s.name,partOfMultiscale:o.has(s)});return i}class Un{constructor(e){try{(0,We.verifyObject)(e);let t=this.scales=(0,We.verifyObjectProperty)(e,"geometry",(e=>(0,We.parseArray)(e,(e=>new Nn(e)))));if(0===t.length)throw new Error("Expected at least one scale.");let n=t[0],i=this.numChannels=n.numChannels,r=this.dataType=n.dataType;for(let e=1,o=t.length;e<o;++e){let n=t[e];if(n.dataType!==r)throw new Error("Scale ".concat(e," has data type ").concat(L.pe[n.dataType]," ")+"but scale 0 has data type ".concat(L.pe[r],"."));if(n.numChannels!==i)throw new Error("Scale ".concat(e," has ").concat(n.numChannels," channel(s) ")+"but scale 0 has ".concat(i," channels."))}this.box={lowerBounds:new Float64Array(3),upperBounds:new Float64Array(n.upperVoxelBound)}}catch(t){throw new Error("Failed to parse BrainMaps multiscale volume specification: ".concat(t.message))}}getModelSpace(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.scales[0],n=["x","y","z"],i=["m","m","m"],r=bn()(t.voxelSize,(e=>e/1e9)),o=[0,0,0],s=bn()(t.upperVoxelBound);return e&&(n.push("c^"),i.push(""),r.push(1),o.push(0),s.push(this.numChannels)),(0,Se.d)({names:n,units:i,scales:Float64Array.from(r),boundingBoxes:[(0,Se.T4)({lowerBounds:new Float64Array(n.length),upperBounds:Float64Array.from(s)})]})}}class zn extends S.kg{constructor(e,t,n,i,r,o,s){super(e),this.instance=t,this.credentialsProvider=n,this.volumeId=i,this.changeSpec=r,this.multiscaleVolumeInfo=o,this.encoding=s.encoding,this.jpegQuality=s.jpegQuality,this.chunkLayoutPreference=s.chunkLayoutPreference;let a=L.rU.IMAGE;this.dataType===L.pe.UINT64&&(a=L.rU.SEGMENTATION),this.volumeType=a}get scales(){return this.multiscaleVolumeInfo.scales}get dataType(){return this.multiscaleVolumeInfo.dataType}get rank(){return 1!==this.multiscaleVolumeInfo.numChannels?4:3}getSources(e){let t=vn.RAW;this.dataType!==L.pe.UINT64&&this.dataType!==L.pe.UINT32||this.volumeType!==L.rU.SEGMENTATION||this.encoding===vn.RAW?this.volumeType===L.rU.IMAGE&&this.dataType===L.pe.UINT8&&1===this.multiscaleVolumeInfo.numChannels&&this.encoding!==vn.RAW&&!0!==e.discreteValues&&(t=vn.JPEG):t=vn.COMPRESSED_SEGMENTATION;const n=t===vn.JPEG?this.jpegQuality:void 0,i=this.scales[0],r=i.upperVoxelBound,o=F.eR.create(),s=this.rank;return(0,je.RO)(this.scales.map(((a,l)=>{F.eR.divide(o,a.voxelSize,i.voxelSize);let c,d=a.upperVoxelBound,u=a.numChannels;const h=new Float32Array((s+1)**2);h[(s+1)*s+s]=1;const p=new Float32Array(s);1!==u&&(d=Float32Array.of(...d,u),c=Uint32Array.of(1,1,1,u),h[3*(s+1)+3]=1,p[3]=u);for(let e=0;e<3;++e)h[(s+1)*e+e]=o[e],p[e]=r[e]/o[e];return(0,L.vn)({rank:s,minBlockSize:c,chunkToMultiscaleTransform:h,dataType:a.dataType,upperVoxelBound:d,volumeType:this.volumeType,volumeSourceOptions:e,chunkLayoutPreference:this.chunkLayoutPreference,maxCompressedSegmentationBlockSize:F.eR.fromValues(64,64,64)}).map((e=>({chunkSource:this.chunkManager.getChunkSource(Pn,{credentialsProvider:this.credentialsProvider,spec:e,parameters:{volumeId:this.volumeId,changeSpec:this.changeSpec,scaleIndex:l,encoding:t,jpegQuality:n,instance:this.instance}}),chunkToMultiscaleTransform:h,upperClipBound:p})))})))}}function jn(e){const t=F.pB.create(),n=e.scales[0].voxelSize;for(let i=0;i<3;++i)t[5*i]=1/n[i];return t}function Gn(e){try{return(0,We.verifyObject)(e),{id:(0,We.verifyObjectProperty)(e,"id",We.verifyString),label:(0,We.verifyObjectProperty)(e,"label",We.verifyString),description:(0,We.verifyObjectProperty)(e,"description",We.verifyOptionalString)}}catch(t){throw new Error("Failed to parse project: ".concat(t.message))}}function Wn(e){try{return(0,We.verifyObject)(e),(0,We.verifyObjectProperty)(e,"project",(e=>void 0===e?[]:(0,We.parseArray)(e,Gn)))}catch(t){throw new Error("Error parsing project list: ".concat(t.message))}}function Hn(e,t){try{return(0,We.verifyObject)(e),(0,We.verifyObjectProperty)(e,t,(e=>void 0===e?[]:(0,We.parseArray)(e,We.verifyString)))}catch(n){throw new Error("Error parsing dataset list: ".concat(n.message))}}const qn=(0,be.nx)(De()(Ye.oZ),kn);class Yn extends qn{constructor(e,t){super(e,Q()({rank:3,relationships:["segments"],properties:[]},t)),this.credentialsProvider=this.registerDisposer(t.credentialsProvider.addRef())}hasNonSerializedProperties(){return!0}getSources(){const e=this.parameters.upperVoxelBound,t=(0,Je._g)({rank:3,chunkDataSize:e,upperVoxelBound:e}),n=F.pB.create();return[[{chunkSource:this.chunkManager.getChunkSource(Rn,{parent:this,spec:Q()({limit:0,chunkToMultiscaleTransform:n},t),parameters:this.parameters,credentialsProvider:this.credentialsProvider}),chunkToMultiscaleTransform:n}]]}}const Jn=[{key:{value:"encoding",description:"Volume chunk data encoding"},values:[{value:"raw",description:""},{value:"jpeg",description:""},{value:"compressed_segmentation",description:""}]},{key:{value:"chunkLayout",description:"Volume chunk layout preference"},values:[{value:"isotropic",description:""},{value:"flat",description:""}]},{key:{value:"jpegQuality",description:"JPEG quality (1 to 100)"},values:[]}];class Kn extends Me.tc{constructor(e,t){super(),this.instance=e,this.credentialsProvider=t}get description(){return this.instance.description}getMultiscaleInfo(e,t){return e.memoize.getUncounted({type:"brainmaps:getMultiscaleInfo",volumeId:t,instance:this.instance,credentialsProvider:(0,Pe.R)(this.credentialsProvider)},(()=>mn(this.instance,this.credentialsProvider,{method:"GET",path:"/v1beta2/volumes/".concat(t),responseType:"json"}).then((e=>new Un(e)))))}getMeshesInfo(e,t){return e.memoize.getUncounted({type:"brainmaps:getMeshesInfo",volumeId:t,instance:this.instance,credentialsProvider:(0,Pe.R)(this.credentialsProvider)},(()=>mn(this.instance,this.credentialsProvider,{method:"GET",path:"/v1beta2/objects/".concat(t,"/meshes"),responseType:"json"}).then((e=>function(e){try{return(0,We.verifyObject)(e),(0,We.verifyObjectProperty)(e,"meshes",(e=>void 0===e?[]:(0,We.parseArray)(e,_n)))}catch(t){throw new Error("Failed to parse BrainMaps meshes specification: ".concat(t.message))}}(e)))))}get(e){var t=function(e){const t=e.match(/^([^:?\/]+:[^:?\/]+:[^:?\/]+)(?::([^:?\/]+))?(?:\/([^?]+))?(?:\?(.*))?$/);if(null===t)throw new Error("Invalid Brain Maps volume key: ".concat(p()(e),"."));let n;void 0!==t[2]&&(n={changeStackId:t[2]});const i=(0,We.parseQueryStringParameters)(t[4]||"");return{volumeId:t[1],changeSpec:n,meshName:t[3],parameters:i}}(e.providerUrl);const n=t.volumeId,i=t.changeSpec,r=t.meshName,o=t.parameters;(0,We.verifyObject)(o);const s=(0,We.verifyOptionalObjectProperty)(o,"encoding",(e=>(0,We.verifyEnumString)(e,vn))),a=(0,We.verifyOptionalObjectProperty)(o,"jpegQuality",(e=>{const t=(0,We.verifyInt)(e);if(t<1||t>100)throw new Error("Expected integer in range [1, 100], but received: ".concat(e));return t}),70),l={encoding:s,chunkLayoutPreference:(0,We.verifyOptionalObjectProperty)(o,"chunkLayout",(e=>(0,We.verifyEnumString)(e,Je.l))),jpegQuality:a};return e.chunkManager.memoize.getUncounted({type:"brainmaps:get",instance:this.instance,volumeId:n,changeSpec:i,brainmapsOptions:l},(async()=>{var t=await ae().all([this.getMultiscaleInfo(e.chunkManager,n),this.getMeshesInfo(e.chunkManager,n)]),o=(0,ue.A)(t,2);const s=o[0],a=o[1],c=new zn(e.chunkManager,this.instance,this.credentialsProvider,n,i,s,l),d={modelTransform:(0,Se.FH)(s.getModelSpace(1!==s.numChannels)),subsources:[{id:void 0===r?"default":"volume",subsource:{volume:c},default:void 0===r}]},u=(0,ye.Sl)(s.box);s.scales[0].boundingBoxes.forEach(((e,t)=>{u.add({type:ye.UJ.AXIS_ALIGNED_BOUNDING_BOX,description:e.metadata,pointA:e.corner,pointB:F.eR.add(F.eR.create(),e.corner,e.size),id:"boundingBox".concat(t),properties:[]})})),d.subsources.push({id:"bounds",subsource:{staticAnnotations:u},default:!0});const h=Fn(s,a),f=(t,o)=>{let a;const l=t.single;if(void 0!==l)a="TRIANGLES"===l.type?e.chunkManager.getChunkSource(Mn,{credentialsProvider:this.credentialsProvider,parameters:{instance:this.instance,volumeId:n,meshName:l.name,changeSpec:i}}):e.chunkManager.getChunkSource(In,{credentialsProvider:this.credentialsProvider,parameters:{instance:this.instance,volumeId:n,meshName:t.name,changeSpec:i}});else{const r=t.multi;a=e.chunkManager.getChunkSource(Dn,{credentialsProvider:this.credentialsProvider,format:{fragmentRelativeVertices:!1,vertexPositionFormat:Tn.Pc.float32},parameters:{instance:this.instance,volumeId:n,info:r,changeSpec:i}})}d.subsources.push({id:void 0===r?"/".concat(t.name):"default",subsource:{mesh:a},subsourceToModelSubspaceTransform:jn(s),modelSubspaceDimensionIndices:[0,1,2],default:o})};if(void 0!==r){const e=h.find((e=>e.name===r));if(void 0===e)throw new Error("Mesh/skeleton source not found: ".concat(p()(e)));f(e,!0)}else{let e=!0;for(const t of h)t.partOfMultiscale||(f(t,e),e=!1)}return void 0!==i&&d.subsources.push({id:"spatials",default:!0,modelSubspaceDimensionIndices:[0,1,2],subsource:{annotation:e.chunkManager.getChunkSource(Yn,{parameters:{volumeId:n,changestack:i.changeStackId,instance:this.instance,upperVoxelBound:s.scales[0].upperVoxelBound},credentialsProvider:this.credentialsProvider})}}),d}))}getProjectList(e){return e.memoize.getUncounted({instance:this.instance,type:"brainmaps:getProjectList"},(()=>{let e=mn(this.instance,this.credentialsProvider,{method:"GET",path:"/v1beta2/projects",responseType:"json"}).then((e=>Wn(e)));const t="".concat(this.instance.description," project list");return q.M.forPromise(e,{delay:!0,initialMessage:"Retrieving ".concat(t,"."),errorPrefix:"Error retrieving ".concat(t,": ")}),e}))}getDatasetList(e,t){return e.memoize.getUncounted({instance:this.instance,type:"brainmaps:".concat(t,":getDatasetList")},(()=>{let e=mn(this.instance,this.credentialsProvider,{method:"GET",path:"/v1beta2/datasets?project_id=".concat(t),responseType:"json"}).then((e=>Hn(e,"datasetIds")));const n="".concat(this.instance.description," dataset list");return q.M.forPromise(e,{delay:!0,initialMessage:"Retrieving ".concat(n),errorPrefix:"Error retrieving ".concat(n)}),e}))}getVolumeList(e,t,n){return e.memoize.getUncounted({instance:this.instance,type:"brainmaps:".concat(t,":").concat(n,":getVolumeList")},(()=>{let e=mn(this.instance,this.credentialsProvider,{method:"GET",path:"/v1beta2/volumes?project_id=".concat(t,"&dataset_id=").concat(n),responseType:"json"}).then((e=>{const i=Hn(e,"volumeId"),r=t.length+n.length+2,o=[];for(const t of i)o.push(t.substring(r));return o}));const i="".concat(this.instance.description," volume list");return q.M.forPromise(e,{delay:!0,initialMessage:"Retrieving ".concat(i),errorPrefix:"Error retrieving ".concat(i)}),e}))}getChangeStackList(e,t){return e.memoize.getUncounted({instance:this.instance,type:"brainmaps:getChangeStackList",volumeId:t},(()=>{let e=mn(this.instance,this.credentialsProvider,{method:"GET",path:"/v1beta2/changes/".concat(t,"/change_stacks"),responseType:"json"}).then((e=>{return t=e,(0,We.verifyObjectProperty)(t,"changeStackId",(e=>void 0===e?void 0:(0,We.parseArray)(e,We.verifyString)));var t}));const n="change stacks for ".concat(t);return q.M.forPromise(e,{delay:!0,initialMessage:"Retrieving ".concat(n,"."),errorPrefix:"Error retrieving ".concat(n,": ")}),e}))}async completeUrl(e){const t=e.providerUrl,n=t.match(/^([^:\/?]*)(?::([^:\/?]*)(?::([^:\/?]*)(?::([^:\/?]*))?(?:\/([^?]*))?(?:\?(.*))?)?)?$/);if(null===n)throw null;var i=(0,ue.A)(n,7);const r=i[1],o=i[2],s=i[3],a=i[4],l=i[5],c=i[6];if(void 0!==c)return(0,Ge.KV)(t.length-c.length,await(0,Ge.Hj)(c,Jn));if(void 0!==l){const n="".concat(r,":").concat(o,":").concat(s),i=await this.getMeshesInfo(e.chunkManager,n),a=[],c=new(ge());for(const e of i)if(e.name.startsWith(l))switch(e.type){case"LINE_SEGMENTS":a.push({value:e.name,description:"Skeletons"});break;case"TRIANGLES":{a.push({value:e.name,description:"Mesh (single-resolution)"});const t=e.name.match(Bn);if(null!==t){const e=t[1];if(c.has(e))break;c.add(e),a.push({value:e,description:"Mesh (multi-resolution)"})}break}}return a.sort(((e,t)=>(0,Ln.e)(e.value,t.value))),{offset:t.length-l.length,completions:a}}if(void 0!==a){const n="".concat(r,":").concat(o,":").concat(s),i=await this.getChangeStackList(e.chunkManager,n);if(void 0===i)throw null;return{offset:t.length-a.length,completions:(0,Ge.Q9)(a,i)}}if(void 0!==s)return{offset:t.length-s.length,completions:(0,Ge.Q9)(s,await this.getVolumeList(e.chunkManager,r,o))};if(void 0!==o){const n=await this.getDatasetList(e.chunkManager,r);return{offset:t.length-o.length,completions:(0,Ge.Q9)(o,n.map((e=>"".concat(e,":"))))}}const d=await this.getProjectList(e.chunkManager);return{offset:0,completions:(0,Ge.BH)(r,d,(e=>"".concat(e.id,":")),(e=>e.label))}}}const Xn={description:"Google Brain Maps",serverUrl:"https://brainmaps.googleapis.com"};if((0,St.Z)("brainmaps",(e=>new Kn(Xn,e.credentialsManager.getCredentialsProvider(gn)))),"undefined"!==typeof NEUROGLANCER_BRAINMAPS_SERVERS)for(const zo of pn()(NEUROGLANCER_BRAINMAPS_SERVERS)){var Zn=(0,ue.A)(zo,2);const e=Zn[0],t=Zn[1];(0,St.Z)("brainmaps-".concat(e),(e=>new Kn(t,e.credentialsManager.getCredentialsProvider(gn))))}var Qn=n(4035);const $n="https://accounts.google.com";class ei{constructor(){this.finished=new Ke.HN}}class ti{constructor(){this.proxyName="postmessageRelay".concat((0,Qn.Yr)()),this.rpcToken="".concat((0,Qn.Yr)()),this.relayReadyService="oauth2relayReady:".concat(this.rpcToken),this.oauth2CallbackService="oauth2callback:".concat(this.rpcToken),this.pendingRequests=new(ve()),function(e,t){let n=document.createElement("iframe");n.style.display="none",n.id=e,n.name=e;const i=location.origin;n.src="https://accounts.google.com/o/oauth2/postmessageRelay?"+"parent=".concat(encodeURIComponent(i),"#rpctoken=").concat(t),document.body.appendChild(n)}(this.proxyName,this.rpcToken),this.relayReadyPromise=new(ae())((e=>{addEventListener("message",(t=>{if(t.origin===$n)try{let n=(0,We.verifyObject)(JSON.parse(t.data)),i=(0,We.verifyString)(n.s);if(i===this.relayReadyService&&e(),i===this.oauth2CallbackService){let e=(0,We.parseArray)(n.a,(e=>e)),t=(0,We.verifyString)(e[0]),i=location.origin;if(!t.startsWith(i+"#")&&!t.startsWith(i+"?"))throw new Error("oauth2callback: URL ".concat(p()(t)," ")+"does not match current origin ".concat(i,"."));let r=t.substring(i.length+1).split("&"),o=new(ve());for(let n of r){let e=n.match("^([a-z_]+)=(.*)$");if(null===e)throw new Error("oauth2callback: URL part ".concat(p()(e)," ")+"does not match expected pattern.");o.set(e[1],e[2])}let s=o.get("state");if(void 0===s)throw new Error("oauth2callback: State argument is missing.");let a=this.pendingRequests.get(s);if(void 0===a)return;let l=o.get("error");if(void 0!==l){let e=o.get("error_subtype"),t=l;return void 0!==e&&(t+=": "+e),void a.finished.dispatch(void 0,new Error("Error obtaining Google OAuth2 token: ".concat(t)))}let c=o.get("access_token"),d=o.get("token_type"),u=o.get("expires_in"),h=o.get("scope");if(void 0===c||void 0===d||void 0===u||void 0===h)throw new Error("oauth2callback: URL lacks expected parameters.");return void a.finished.dispatch({accessToken:c,tokenType:d,expiresIn:u,scope:h})}}catch(n){throw new Error("Invalid message received from ".concat($n,": ").concat(p()(t.data),": ")+"".concat(n.message,"."))}}))}))}addPendingRequest(e){let t=new ei;return this.pendingRequests.set(e,t),t.finished.add((()=>{this.pendingRequests.delete(e)})),t}makeAuthRequestUrl(e){let t="".concat("https://accounts.google.com/o/oauth2/auth","?client_id=").concat(encodeURIComponent(e.clientId));t+="&redirect_uri=postmessage",t+="&response_type=token";var n=e.origin;let i=void 0===n?location.origin:n;return t+="&origin=".concat(encodeURIComponent(i)),t+="&proxy=".concat(this.proxyName),t+="&include_granted_scopes=true",t+="&scope=".concat(encodeURIComponent(e.scopes.join(" "))),e.state&&(t+="&state=".concat(e.state)),e.approvalPrompt&&(t+="&approval_prompt=".concat(encodeURIComponent(e.approvalPrompt))),e.loginHint&&(t+="&login_hint=".concat(encodeURIComponent(e.loginHint))),e.immediate&&(t+="&immediate=true"),void 0!==e.authUser&&(t+="&authuser=".concat(e.authUser)),t}}let ni;function ii(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee.fx;const n=(0,Qn.Yr)(),i=(void 0===ni&&(ni=new ti),ni),r=i.makeAuthRequestUrl({state:n,clientId:e.clientId,scopes:e.scopes,approvalPrompt:e.approvalPrompt,loginHint:e.loginHint,immediate:e.immediate,authUser:e.authUser}),o=i.addPendingRequest(n),s=new(ae())(((e,t)=>{o.finished.add(((n,i)=>{void 0!==n?e(n):t(i)}))}));if(o.finished.add(t.add((()=>{o.finished.dispatch(void 0,ee.wS)}))),e.immediate)i.relayReadyPromise.then((()=>{if(t.isCanceled)return;const e=document.createElement("iframe");e.src=r,e.style.display="none",document.body.appendChild(e),o.finished.add((()=>{(0,f.fh)(e)}))}));else if(!t.isCanceled){const e=open(r);null!==e&&o.finished.add((()=>{e.close()}))}return s}class ri extends le.uw{constructor(e){super(),this.options=e,this.get=(0,le.uO)((e=>{const t=this.options,n=new q.M(!0);let i;return new(ae())(((r,o)=>{function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(t.description," authorization required."),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Request authorization.";n.setText(e+"  ");let r=document.createElement("button");r.textContent=i,n.element.appendChild(r),r.addEventListener("click",(()=>{a(!1)})),n.setVisible(!0)}function a(e){void 0!==i&&i.cancel(),i=new ee.Qi,s("Waiting for ".concat(t.description," authorization..."),"Retry"),ii({clientId:t.clientId,scopes:t.scopes,immediate:e,authUser:0},i).then((e=>{void 0!==i&&(i=void 0,n.dispose(),r(e))}),(n=>{void 0!==i&&(i=void 0,e?s():s("".concat(t.description," authorization failed: ").concat(n,"."),"Retry"))}))}e.add((()=>{void 0!==i&&(i.cancel(),i=void 0,n.dispose(),o(ee.wS))})),a(!0)}))}))}}class oi extends ri{constructor(e){super({clientId:e,scopes:["https://www.googleapis.com/auth/brainmaps"],description:"Brain Maps"})}}var si,ai,li;X.X.register(gn,(()=>new oi(BRAINMAPS_CLIENT_ID))),function(e){e[e.RAW=0]="RAW",e[e.JPEG=1]="JPEG",e[e.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION",e[e.COMPRESSO=3]="COMPRESSO",e[e.PNG=4]="PNG"}(si||(si={}));class ci{}ci.RPC_ID="precomputed/VolumeChunkSource";class di{}di.RPC_ID="precomputed/MeshSource",function(e){e[e.RAW=0]="RAW",e[e.GZIP=1]="GZIP"}(ai||(ai={})),function(e){e[e.IDENTITY=0]="IDENTITY",e[e.MURMURHASH3_X86_128=1]="MURMURHASH3_X86_128"}(li||(li={}));class ui{}ui.RPC_ID="precomputed/MultiscaleMeshSource";class hi{}hi.RPC_ID="precomputed/SkeletonSource";class pi{}pi.RPC_ID="precomputed/AnnotationSpatialIndexSource";class fi{}fi.RPC_ID="precomputed/AnnotationSource";class gi{}gi.RPC_ID="precomputed/IndexedSegmentPropertySource";var mi=n(8365),vi=n(9043);async function yi(e,t,n,i,r){if(!i.startsWith("/"))throw null;const o=await async function(e,t,n,i,r){const o=await(0,fn.Y)(e,"https://www.googleapis.com/storage/v1/b/".concat(t,"/o?")+"delimiter=".concat(encodeURIComponent(i),"&prefix=").concat(encodeURIComponent(n),"&")+"neuroglancerOrigin=".concat(encodeURIComponent(location.origin)),{},te.cj,r);return(0,We.verifyObject)(o),[...(0,We.verifyOptionalObjectProperty)(o,"prefixes",We.verifyStringArray,[]),...(0,We.verifyOptionalObjectProperty)(o,"items",(e=>(0,We.parseArray)(e,(e=>((0,We.verifyObject)(e),(0,We.verifyObjectProperty)(e,"name",We.verifyString))))),[]).filter((e=>!e.endsWith("_$folder$")))]}(e,n,i.substring(1),"/",r);let s=i.lastIndexOf("/");return{offset:s+t.length+1,completions:o.map((e=>({value:e.substring(s)})))}}var bi=n(3398),Si=n(7882),wi=n(6256);async function xi(e,t,n){console.log("getHtmlPathCompletions");const i=e.match(/^([a-z]+:\/\/.*\/)([^\/?#]*)$/);if(null===i)throw null;const r=await async function(e,t,n){var i=await(0,bi.G)(n,e,{headers:{accept:"text/html"}},(async e=>({text:await e.text(),contentType:e.headers.get("content-type")})),t);const r=i.text,o=i.contentType;if(null===o||null===/\btext\/html\b/i.exec(o))return[];const s=(new DOMParser).parseFromString(r,"text/html"),a=s.evaluate("//a/@href",s,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null),l=[];for(let c=0,d=a.snapshotLength;c<d;++c){const t=a.snapshotItem(c).textContent;t&&l.push(new URL(t,e).toString())}return l}(i[1],t,n),o=i[1].length,s=[];for(const a of r)a.startsWith(e)&&s.push({value:a.substring(o)});return{offset:o,completions:s}}const Ci=[{value:"gs://",description:"Google Cloud Storage (JSON API)"},{value:"gs+xml://",description:"Google Cloud Storage (XML API)"},{value:"gs+json://",description:"Google Cloud Storage (storage JSON API)"},{value:"gs+ngauth+http://",description:"Google Cloud Storage (JSON API) authenticated via ngauth"},{value:"gs+ngauth+https://",description:"Google Cloud Storage (JSON API) authenticated via ngauth"},{value:"gs+xml+ngauth+http://",description:"Google Cloud Storage (XML API) authenticated via ngauth"},{value:"gs+xml+ngauth+https://",description:"Google Cloud Storage (XML API) authenticated via ngauth"},{value:"s3://",description:"Amazon Simple Storage Service (S3)"},{value:"https://"},{value:"http://"}];async function ki(e,t,n){if(!t.includes("://"))return{offset:0,completions:(0,Ge.BH)(t,Ci,(e=>e.value),(e=>e.description))};var i=(0,bi.n)(t,e);const r=i.url,o=i.credentialsProvider,s=t.length-r.length;let a;try{a=(0,te.Dl)(r)}catch(p){throw null}var l=a;const c=l.protocol,d=l.host,u=l.path,h=await(async()=>{if("gs+xml"===c&&u.length>0)return await(0,wi.X)(o,"".concat(c,"://").concat(d),"https://storage.googleapis.com/".concat(d),u,n);if(("gs"===c||"gs+json"===c)&&u.length>0)return await yi(o,"".concat(c,"://").concat(d),d,u,n);if("s3"===c&&u.length>0)return await(0,Si.bj)(d,u,n);const e=r.match(/^((?:http|https):\/\/(?:storage\.googleapis\.com\/[^\/]+|[^\/]+\.storage\.googleapis\.com|[^\/]+\.s3(?:[^./]+)?\.amazonaws.com))(\/.*)$/);if(null!==e)return await(0,wi.X)(o,e[1],e[1],e[2],n);if(("http"===c||"https"===c)&&u.length>0)return await xi(r,n,o);throw null})();return{offset:s+h.offset,completions:h.completions}}var Ei=n(2729);class Ti extends((0,be.nx)(De()(S.RS),ci)){}class Li extends((0,be.nx)(De()(Ue.No),di)){}class Pi extends((0,be.nx)(De()(Ue.bJ),ui)){}class Di extends((0,be.nx)(De()(ze.tr),hi)){get skeletonVertexCoordinatesInVoxels(){return!1}get vertexAttributes(){return this.parameters.metadata.vertexAttributes}}function Mi(e,t){const n=e.split("/");for(const i of t.split("/"))".."!==i||0===n.length?n.push(i):n.length=n.length-1;return n.join("/")}class Ii{constructor(e,t){(0,We.verifyObject)(e);const n=1===t?3:4,i=this.resolution=new Float64Array(n),r=this.voxelOffset=new Float32Array(n),o=this.size=new Float32Array(n);if(4===n&&(i[3]=1,o[3]=t),(0,We.verifyObjectProperty)(e,"resolution",(e=>(0,We.parseFixedLengthArray)(i.subarray(0,3),e,We.verifyFinitePositiveFloat))),(0,We.verifyOptionalObjectProperty)(e,"voxel_offset",(e=>(0,We.parseFixedLengthArray)(r.subarray(0,3),e,We.verifyInt))),(0,We.verifyObjectProperty)(e,"size",(e=>(0,We.parseFixedLengthArray)(o.subarray(0,3),e,We.verifyPositiveInt))),this.chunkSizes=(0,We.verifyObjectProperty)(e,"chunk_sizes",(e=>(0,We.parseArray)(e,(e=>{const i=new Uint32Array(n);return 4===n&&(i[3]=t),(0,We.parseFixedLengthArray)(i.subarray(0,3),e,We.verifyPositiveInt),i})))),0===this.chunkSizes.length)throw new Error("No chunk sizes specified.");if(this.sharding=(0,We.verifyObjectProperty)(e,"sharding",Ui),void 0!==this.sharding&&1!==this.chunkSizes.length)throw new Error("Sharding requires a single chunk size per scale");(this.encoding=(0,We.verifyObjectProperty)(e,"encoding",(e=>(0,We.verifyEnumString)(e,si))))===si.COMPRESSED_SEGMENTATION&&(this.compressedSegmentationBlockSize=(0,We.verifyObjectProperty)(e,"compressed_segmentation_block_size",(e=>(0,We.parseFixedLengthArray)(F.eR.create(),e,We.verifyPositiveInt)))),this.key=(0,We.verifyObjectProperty)(e,"key",We.verifyString)}}class Ri extends S.kg{constructor(e,t,n,i){super(e),this.credentialsProvider=t,this.url=n,this.info=i}get dataType(){return this.info.dataType}get volumeType(){return this.info.volumeType}get rank(){return this.info.modelSpace.rank}getSources(e){const t=this.info.scales[0].resolution,n=this.rank;return(0,je.RO)(this.info.scales.map((i=>{const r=i.resolution,o=n+1,s=new Float32Array(o*o);s[s.length-1]=1;var a=this.info.modelSpace.boundingBoxes[0].box;const l=a.lowerBounds,c=a.upperBounds,d=new Float32Array(n),u=new Float32Array(n);for(let e=0;e<3;++e){const a=r[e]/t[e];s[o*e+e]=a;const h=i.voxelOffset[e];s[o*n+e]=h*a,d[e]=l[e]/a-h,u[e]=c[e]/a-h}return 4===n&&(s[3*o+3]=1,d[3]=l[3],u[3]=c[3]),(0,L.vn)({rank:n,dataType:this.dataType,chunkToMultiscaleTransform:s,upperVoxelBound:i.size,volumeType:this.volumeType,chunkDataSizes:i.chunkSizes,baseVoxelOffset:i.voxelOffset,compressedSegmentationBlockSize:i.compressedSegmentationBlockSize,volumeSourceOptions:e}).map((e=>({chunkSource:this.chunkManager.getChunkSource(Ti,{credentialsProvider:this.credentialsProvider,spec:e,parameters:{url:Mi(this.url,i.key),encoding:i.encoding,sharding:i.sharding}}),chunkToMultiscaleTransform:s,lowerClipBound:d,upperClipBound:u})))})))}}const Ai=(0,be.nx)(De()(Ye.oZ),fi);class Oi extends((0,be.nx)(De()(Ye.eU),pi)){}class Ni extends Ai{constructor(e,t){const n=t.parameters;super(e,{rank:n.rank,relationships:n.relationships.map((e=>e.name)),properties:n.properties,parameters:n}),this.readonly=!0,this.metadata=t.metadata,this.credentialsProvider=t.credentialsProvider}getSources(){return[this.metadata.spatialIndices.map((e=>{const t=e.spec;return{chunkSource:this.chunkManager.getChunkSource(Oi,{credentialsProvider:this.credentialsProvider,parent:this,spec:t,parameters:e.parameters}),chunkToMultiscaleTransform:t.chunkToMultiscaleTransform}}))]}}function _i(e,t,n){return e.getChunkSource(Li,{parameters:n,credentialsProvider:t})}function Vi(e){return(0,We.verifyObjectProperty)(e,"transform",(e=>{const t=F.pB.create();return void 0!==e&&(0,We.parseFixedLengthArray)(t.subarray(0,12),e,We.verifyFiniteFloat),F.pB.transpose(t,t),t}))}async function Bi(e,t,n){let i;try{i=await Hi(e,t,n)}catch(r){if((0,te.El)(r))return{metadata:void 0};throw r}return function(e){(0,We.verifyObject)(e);const t=(0,We.verifyObjectProperty)(e,"@type",We.verifyString);let n;if("neuroglancer_legacy_mesh"===t)n=void 0;else{if("neuroglancer_multilod_draco"!==t)throw new Error("Unsupported mesh type: ".concat(p()(t)));{const t=(0,We.verifyObjectProperty)(e,"lod_scale_multiplier",We.verifyFinitePositiveFloat),i=(0,We.verifyObjectProperty)(e,"vertex_quantization_bits",We.verifyPositiveInt);n={lodScaleMultiplier:t,transform:Vi(e),sharding:(0,We.verifyObjectProperty)(e,"sharding",Ui),vertexQuantizationBits:i}}}return{metadata:n,segmentPropertyMap:(0,We.verifyObjectProperty)(e,"segment_properties",We.verifyOptionalString)}}(i)}function Fi(e){return void 0===e?ai.RAW:(0,We.verifyEnumString)(e,ai)}function Ui(e){if(void 0===e)return;(0,We.verifyObject)(e);const t=(0,We.verifyObjectProperty)(e,"@type",We.verifyString);if("neuroglancer_uint64_sharded_v1"!==t)throw new Error("Unsupported sharding format: ".concat(p()(t)));return{hash:(0,We.verifyObjectProperty)(e,"hash",(e=>(0,We.verifyEnumString)(e,li))),preshiftBits:(0,We.verifyObjectProperty)(e,"preshift_bits",We.verifyInt),shardBits:(0,We.verifyObjectProperty)(e,"shard_bits",We.verifyInt),minishardBits:(0,We.verifyObjectProperty)(e,"minishard_bits",We.verifyInt),minishardIndexEncoding:(0,We.verifyObjectProperty)(e,"minishard_index_encoding",Fi),dataEncoding:(0,We.verifyObjectProperty)(e,"data_encoding",Fi)}}async function zi(e,t,n){return function(e){(0,We.verifyObject)(e);const t=(0,We.verifyObjectProperty)(e,"@type",We.verifyString);if("neuroglancer_skeletons"!==t)throw new Error("Unsupported skeleton type: ".concat(p()(t)));const n=Vi(e),i=new(ve());(0,We.verifyObjectProperty)(e,"vertex_attributes",(e=>{void 0!==e&&(0,We.parseArray)(e,(e=>{(0,We.verifyObject)(e);const t=(0,We.verifyObjectProperty)(e,"id",We.verifyString);if(""===t)throw new Error("vertex attribute id must not be empty");if(i.has(t))throw new Error("duplicate vertex attribute id ".concat(p()(t)));const n=(0,We.verifyObjectProperty)(e,"data_type",(e=>(0,We.verifyEnumString)(e,vi.pe))),r=(0,We.verifyObjectProperty)(e,"num_components",We.verifyPositiveInt);i.set(t,{dataType:n,numComponents:r})}))}));const r=(0,We.verifyObjectProperty)(e,"sharding",Ui),o=(0,We.verifyObjectProperty)(e,"segment_properties",We.verifyOptionalString);return{metadata:{transform:n,vertexAttributes:i,sharding:r},segmentPropertyMap:o}}(await Hi(e,t,n))}function ji(){return(0,Se.d)({names:["x","y","z"],units:["m","m","m"],scales:Float64Array.of(1e-9,1e-9,1e-9)})}async function Gi(e,t,n){var i=await Bi(e,t,n);const r=i.metadata,o=i.segmentPropertyMap;if(void 0===r)return{source:_i(e,t,{url:n,lod:0}),transform:F.pB.create(),segmentPropertyMap:o};let s;const a=r.vertexQuantizationBits;if(10===a)s=Tn.Pc.uint10;else{if(16!==a)throw new Error("Invalid vertex quantization bits: ".concat(a));s=Tn.Pc.uint16}return{source:e.getChunkSource(Pi,{credentialsProvider:t,parameters:{url:n,metadata:r},format:{fragmentRelativeVertices:!0,vertexPositionFormat:s}}),transform:r.transform,segmentPropertyMap:o}}async function Wi(e,t,n){var i=await zi(e,t,n);const r=i.metadata,o=i.segmentPropertyMap;return{source:e.getChunkSource(Di,{credentialsProvider:t,parameters:{url:n,metadata:r}}),transform:r.transform,segmentPropertyMap:o}}function Hi(e,t,n){return e.memoize.getUncounted({type:"precomputed:metadata",url:n,credentialsProvider:(0,Pe.R)(t)},(async()=>await(0,bi.G)(t,"".concat(n,"/info"),{},te.cj)))}function qi(e){const t=F.pB.create(),n=e.scales[0].resolution;for(let i=0;i<3;++i)t[5*i]=1/n[i];return t}async function Yi(e,t,n,i){const r=function(e){(0,We.verifyObject)(e);const t=(0,We.verifyObjectProperty)(e,"data_type",(e=>(0,We.verifyEnumString)(e,vi.pe))),n=(0,We.verifyObjectProperty)(e,"num_channels",We.verifyPositiveInt),i=(0,We.verifyObjectProperty)(e,"type",(e=>(0,We.verifyEnumString)(e,L.rU))),r=(0,We.verifyObjectProperty)(e,"mesh",We.verifyOptionalString),o=(0,We.verifyObjectProperty)(e,"skeletons",We.verifyOptionalString),s=(0,We.verifyObjectProperty)(e,"segment_properties",We.verifyOptionalString),a=(0,We.verifyObjectProperty)(e,"scales",(e=>(0,We.parseArray)(e,(e=>new Ii(e,n)))));if(0===a.length)throw new Error("Expected at least one scale");const l=a[0],c=1===n?3:4,d=new Float64Array(c),u=new Float64Array(c),h=new Float64Array(c),p=["x","y","z"],f=["m","m","m"];for(let m=0;m<3;++m)d[m]=l.resolution[m]/1e9,u[m]=l.voxelOffset[m],h[m]=u[m]+l.size[m];4===c&&(d[3]=1,h[3]=n,p[3]="c^",f[3]="");const g={lowerBounds:u,upperBounds:h};return{dataType:t,volumeType:i,mesh:r,skeletons:o,segmentPropertyMap:s,scales:a,modelSpace:(0,Se.d)({rank:c,names:p,units:f,scales:d,boundingBoxes:[(0,Se.T4)(g)]})}}(i),o=new Ri(e.chunkManager,t,n,r),s=r.modelSpace,a=[{id:"default",default:!0,subsource:{volume:o}},{id:"bounds",default:!0,subsource:{staticAnnotations:(0,ye.Sl)(s.bounds)}}];if(void 0!==r.segmentPropertyMap){const i=Mi(n,r.segmentPropertyMap),o=await Hi(e.chunkManager,t,i),s=Qi(e.chunkManager,t,o,i);a.push({id:"properties",default:!0,subsource:{segmentPropertyMap:s}})}if(void 0!==r.mesh){const i=Mi(n,r.mesh);var l=await Gi(e.chunkManager,t,i);const o=l.source,s=l.transform,c=qi(r);F.pB.multiply(c,c,s),a.push({id:"mesh",default:!0,subsource:{mesh:o},subsourceToModelSubspaceTransform:c})}if(void 0!==r.skeletons){const i=Mi(n,r.skeletons);var c=await Wi(e.chunkManager,t,i);const o=c.source,s=c.transform,l=qi(r);F.pB.multiply(l,l,s),a.push({id:"skeletons",default:!0,subsource:{mesh:o},subsourceToModelSubspaceTransform:l})}return{modelTransform:(0,Se.FH)(s),subsources:a}}function Ji(e,t){return(0,We.verifyObject)(t),{url:Mi(e,(0,We.verifyObjectProperty)(t,"key",We.verifyString)),sharding:(0,We.verifyObjectProperty)(t,"sharding",Ui)}}class Ki{constructor(e,t){this.url=e,(0,We.verifyObject)(t);const n=(0,We.verifyObjectProperty)(t,"dimensions",Se.$r),i=n.rank,r=(0,We.verifyObjectProperty)(t,"lower_bound",(e=>(0,We.parseFixedLengthArray)(new Float64Array(i),e,We.verifyFiniteFloat))),o=(0,We.verifyObjectProperty)(t,"upper_bound",(e=>(0,We.parseFixedLengthArray)(new Float64Array(i),e,We.verifyFiniteFloat)));this.coordinateSpace=(0,Se.d)({rank:i,names:n.names,units:n.units,scales:n.scales,boundingBoxes:[(0,Se.T4)({lowerBounds:r,upperBounds:o})]}),this.parameters={type:(0,We.verifyObjectProperty)(t,"annotation_type",(e=>(0,We.verifyEnumString)(e,ye.UJ))),rank:i,relationships:(0,We.verifyObjectProperty)(t,"relationships",(t=>(0,We.parseArray)(t,(t=>{const n=Ji(e,t),i=(0,We.verifyObjectProperty)(t,"id",We.verifyString);return Q()(Q()({},n),{name:i})})))),properties:(0,We.verifyObjectProperty)(t,"properties",ye.aU),byId:(0,We.verifyObjectProperty)(t,"by_id",(t=>Ji(e,t)))},this.spatialIndices=(0,We.verifyObjectProperty)(t,"spatial",(t=>(0,We.parseArray)(t,(t=>{const n=Ji(e,t),o=(0,We.verifyObjectProperty)(t,"grid_shape",(e=>(0,We.parseFixedLengthArray)(new Float32Array(i),e,We.verifyPositiveInt))),s=(0,We.verifyObjectProperty)(t,"chunk_size",(e=>(0,We.parseFixedLengthArray)(new Float32Array(i),e,We.verifyFinitePositiveFloat))),a=(0,We.verifyObjectProperty)(t,"limit",We.verifyPositiveInt),l=new Float32Array(i);for(let e=0;e<i;++e)l[e]=o[e]*s[e];const c=Ei.DA(Float32Array,i+1);for(let e=0;e<i;++e)c[(i+1)*i+e]=r[e];const d=Q()({limit:a,chunkToMultiscaleTransform:c},(0,Je._g)({rank:i,chunkDataSize:s,upperVoxelBound:l}));return d.upperChunkBound=o,{parameters:n,spec:d,limit:a}})))),this.spatialIndices.reverse()}}async function Xi(e,t,n){var i=await Gi(e.chunkManager,t,n);const r=i.source,o=i.transform,s=i.segmentPropertyMap,a=[{id:"default",default:!0,subsource:{mesh:r},subsourceToModelSubspaceTransform:o}];if(void 0!==s){const i=Mi(n,s),r=await Hi(e.chunkManager,t,i),o=Qi(e.chunkManager,t,r,i);a.push({id:"properties",default:!0,subsource:{segmentPropertyMap:o}})}return{modelTransform:(0,Se.FH)(ji()),subsources:a}}function Zi(e){(0,We.verifyObject)(e);const t=new P.Uint64,n=(0,We.verifyObjectProperty)(e,"ids",(e=>{const n=(e=(0,We.verifyStringArray)(e)).length,i=new Uint32Array(2*n);for(let r=0;r<n;++r){if(!t.tryParseString(e[r]))throw new Error("Invalid uint64 id: ".concat(p()(e[r])));i[2*r]=t.low,i[2*r+1]=t.high}return i})),i=n.length/2,r=(0,We.verifyObjectProperty)(e,"properties",(e=>(0,We.parseArray)(e,(e=>{(0,We.verifyObject)(e);const t=(0,We.verifyObjectProperty)(e,"id",We.verifyString),n=(0,We.verifyOptionalObjectProperty)(e,"description",We.verifyString),r=(0,We.verifyObjectProperty)(e,"type",(e=>{if("label"!==e&&"description"!==e&&"string"!==e&&"tags"!==e&&"number"!==e)throw new Error("Invalid property type: ".concat(p()(e)));return e}));if("tags"===r){const o=(0,We.verifyObjectProperty)(e,"tags",We.verifyStringArray);let s=(0,We.verifyOptionalObjectProperty)(e,"tag_descriptions",We.verifyStringArray);if(void 0===s)s=new Array(o.length),s.fill("");else if(s.length!==o.length)throw new Error("Expected tag_descriptions to have length: ".concat(o.length));return{id:t,description:n,type:r,tags:o,tagDescriptions:s,values:(0,We.verifyObjectProperty)(e,"values",(e=>{if(!Array.isArray(e)||e.length!==i)throw new Error("Expected ".concat(i," values, but received: ").concat(e.length));return e.map((e=>String.fromCharCode(...e)))}))}}if("number"===r){const o=(0,We.verifyObjectProperty)(e,"data_type",(e=>(0,We.verifyEnumString)(e,vi.pe)));if(o===vi.pe.UINT64)throw new Error("uint64 properties not supported");const s=(0,We.verifyObjectProperty)(e,"values",(e=>{if(!Array.isArray(e)||e.length!==i)throw new Error("Expected ".concat(i," values, but received: ").concat(e.length));return vi.dp[o].from(e)}));let a=1/0,l=-1/0;for(let e=s.length-1;e>=0;--e){const t=s[e];t<a&&(a=t),t>l&&(l=t)}return{id:t,description:n,type:r,dataType:o,values:s,bounds:[a,l]}}return{id:t,description:n,type:r,values:(0,We.verifyObjectProperty)(e,"values",(e=>{if((0,We.verifyStringArray)(e),e.length!==i)throw new Error("Expected ".concat(i," values, but received: ").concat(e.length));return e}))}}))));return(0,mi.lV)({ids:n,properties:r})}(0,be.nx)(De()(mi.Bl),gi);function Qi(e,t,n,i){try{const e=(0,We.verifyObjectProperty)(n,"@type",We.verifyString);if("neuroglancer_segment_properties"!==e)throw new Error("Unsupported segment property map type: ".concat(p()(e)));const t=(0,We.verifyOptionalObjectProperty)(n,"inline",Zi);return new mi.l9({inlineProperties:t})}catch(r){throw new Error("Error parsing segment property map: ".concat(r.message))}}const $i=/^([^#]*)(?:#(.*))?$/;function er(e){var t=e.match($i),n=(0,ue.A)(t,3);let i=n[1],r=n[2];i.endsWith("/")&&(i=i.substring(0,i.length-1));return{url:i,parameters:(0,We.parseQueryStringParameters)(r||"")}}function tr(e,t){const n=(0,We.unparseQueryStringParameters)(t);return n&&(e+="#".concat(n)),e}class nr extends Me.tc{get description(){return"Precomputed file-backed data source"}normalizeUrl(e){var t=er(e.providerUrl);const n=t.url,i=t.parameters;return e.providerProtocol+"://"+tr(n,i)}convertLegacyUrl(e){var t=er(e.providerUrl);const n=t.url,i=t.parameters;return"mesh"===e.type&&(i.type="mesh"),e.providerProtocol+"://"+tr(n,i)}get(e){var t=er(e.providerUrl);const n=t.url,i=t.parameters;return e.chunkManager.memoize.getUncounted({type:"precomputed:get",providerUrl:n,parameters:i},(async()=>{var t=(0,bi.n)(n,e.credentialsManager);const r=t.url,o=t.credentialsProvider;let s;try{s=await Hi(e.chunkManager,o,r)}catch(c){if((0,te.El)(c)&&"mesh"===i.type)return await Xi(e,o,r);throw c}(0,We.verifyObject)(s);const a=(0,We.verifyOptionalObjectProperty)(s,"redirect",We.verifyString);if(void 0!==a)throw new Me.Lx(a);const l=(0,We.verifyOptionalObjectProperty)(s,"@type",We.verifyString);switch(l){case"neuroglancer_skeletons":return await async function(e,t,n){var i=await Wi(e.chunkManager,t,n);const r=i.source,o=i.transform,s=i.segmentPropertyMap,a=[{id:"default",default:!0,subsource:{mesh:r},subsourceToModelSubspaceTransform:o}];if(void 0!==s){const i=Mi(n,s),r=await Hi(e.chunkManager,t,i),o=Qi(e.chunkManager,0,r);a.push({id:"properties",default:!0,subsource:{segmentPropertyMap:o}})}return{modelTransform:(0,Se.FH)(ji()),subsources:a}}(e,o,r);case"neuroglancer_multilod_draco":case"neuroglancer_legacy_mesh":return await Xi(e,o,r);case"neuroglancer_annotations_v1":return await async function(e,t,n,i){const r=new Ki(n,i);return{modelTransform:(0,Se.FH)(r.coordinateSpace),subsources:[{id:"default",default:!0,subsource:{annotation:e.chunkManager.getChunkSource(Ni,{credentialsProvider:t,metadata:r,parameters:r.parameters})}}]}}(e,o,r,s);case"neuroglancer_segment_properties":return await async function(e,t,n,i){return{modelTransform:(0,Se.FH)(Se._c),subsources:[{id:"default",default:!0,subsource:{segmentPropertyMap:Qi(e.chunkManager,0,i)}}]}}(e,0,0,s);case"neuroglancer_multiscale_volume":case void 0:return await Yi(e,o,r,s);default:throw new Error("Invalid type: ".concat(p()(l)))}}))}completeUrl(e){return ki(e.credentialsManager,e.providerUrl,e.cancellationToken)}}(0,St.Z)("precomputed",(()=>new nr));var ir,rr=n(2683);!function(e){e[e.RAW=0]="RAW",e[e.GZIP=1]="GZIP",e[e.BLOSC=2]="BLOSC"}(ir||(ir={}));class or{}or.RPC_ID="n5/VolumeChunkSource";var sr=n(2240);class ar extends((0,be.nx)(De()(S.RS),or)){}class lr extends S.kg{constructor(e,t,n,i){let r,o;if(super(e),this.credentialsProvider=t,this.multiscaleMetadata=n,this.scales=i,i.forEach(((e,t)=>{if(void 0!==e){if(void 0===o&&(o=t),void 0!==r&&e.dataType!==r)throw new Error("Scale s".concat(t," has data type ").concat(L.pe[e.dataType]," but expected ").concat(L.pe[r],"."));r=e.dataType}})),void 0===r)throw new Error("At least one scale must be specified.");const s=n.scales[o],a=i[o];this.dataType=r,this.volumeType=L.rU.IMAGE,this.baseScaleIndex=o;const l=n.modelSpace,c=l.rank;this.modelSpace=(0,Se.d)({names:l.names,scales:l.scales,units:l.units,boundingBoxes:[{transform:(0,Ei.nx)(Float64Array,s.downsamplingFactor,!1),box:{lowerBounds:new Float64Array(c),upperBounds:new Float64Array(a.size)}}],coordinateArrays:l.coordinateArrays})}get rank(){return this.modelSpace.rank}getSources(e){(0,rr.A)(this);const t=this.scales,n=this.rank,i=this.multiscaleMetadata.scales;return(0,je.RO)(t.filter((e=>void 0!==e)).map(((t,r)=>{const o=i[r],s=(0,Ei.nx)(Float32Array,o.downsamplingFactor);return(0,L.vn)({rank:n,chunkToMultiscaleTransform:s,dataType:t.dataType,upperVoxelBound:t.size,volumeType:this.volumeType,chunkDataSizes:[t.chunkSize],volumeSourceOptions:e}).map((e=>({chunkSource:this.chunkManager.getChunkSource(ar,{credentialsProvider:this.credentialsProvider,spec:e,parameters:{url:o.url,encoding:t.encoding}}),chunkToMultiscaleTransform:s})))})))}}class cr{constructor(e){let t;(0,We.verifyObject)(e),this.dataType=(0,We.verifyObjectProperty)(e,"dataType",(e=>(0,We.verifyEnumString)(e,L.pe))),this.size=Float32Array.from((0,We.verifyObjectProperty)(e,"dimensions",(e=>(0,We.parseArray)(e,We.verifyPositiveInt)))),this.chunkSize=(0,We.verifyObjectProperty)(e,"blockSize",(e=>(0,We.parseFixedLengthArray)(new Uint32Array(this.size.length),e,We.verifyPositiveInt))),(0,We.verifyOptionalObjectProperty)(e,"compression",(e=>{t=(0,We.verifyObjectProperty)(e,"type",(e=>(0,We.verifyEnumString)(e,ir)))})),void 0===t&&(t=(0,We.verifyObjectProperty)(e,"compressionType",(e=>(0,We.verifyEnumString)(e,ir)))),this.encoding=t}}async function dr(e,t,n,i){const r=function(e){var t=(0,te.Dl)(e);let n=t.protocol,i=t.host,r=t.path;r.endsWith("/")&&(r=r.substring(0,r.length-1));const o=[];for(;;){o.push("".concat(n,"://").concat(i).concat(r,"/attributes.json"));const e=r.lastIndexOf("/");if(-1===e)break;r=r.substring(0,e)}return o}(n),o=await ae().all(r.map(((n,o)=>function(e,t,n,i){return e.memoize.getUncounted({type:"n5:attributes.json",url:n,credentialsProvider:(0,Pe.R)(t)},(()=>(0,bi.G)(t,n,{},te.cj).then((e=>{try{return(0,We.verifyObject)(e)}catch(t){throw new Error("Error reading attributes from ".concat(n,": ").concat(t.message))}})).catch((e=>{if((0,te.El)(e)){if(i)return;return{}}throw e}))))}(e,t,n,i&&o===r.length-1))));if(-1===o.indexOf(void 0))return o.reverse(),Q()({},...o)}function ur(e,t){if(-1!==e&&t!==e)throw new Error("Rank mismatch, received ".concat(t," but expected ").concat(e));return t}function hr(e){return Float64Array.from((0,We.parseArray)(e,We.verifyFinitePositiveFloat))}function pr(e){const t=(0,We.expectArray)(e);if(0===t.length)throw new Error("Expected non-empty array");let n=-1;return{all:(0,We.parseArray)(t,(e=>{const t=hr(e);return n=ur(n,t.length),t})),single:void 0,rank:n}}const fr=["x","y","z","t","c"];function gr(e,t){(0,We.verifyObject)(t);let n,i,r=-1,o=(0,We.verifyOptionalObjectProperty)(t,"resolution",(e=>{const t=Float64Array.from((0,We.parseArray)(e,We.verifyFinitePositiveFloat));return r=ur(r,t.length),t})),s=(0,We.verifyOptionalObjectProperty)(t,"axes",(e=>{const t=(0,We.parseArray)(e,We.verifyString);return r=ur(r,t.length),t})),a=(0,We.verifyOptionalObjectProperty)(t,"units",(e=>{const t=(0,We.parseArray)(e,sr.rh);return r=ur(r,t.length),t})),l={unit:"m",exponent:-9};(0,We.verifyOptionalObjectProperty)(t,"downsamplingFactors",(e=>{var t=function(e){const t=(0,We.expectArray)(e);if(0===t.length)throw new Error("Expected non-empty array");if(Array.isArray(t[0]))return pr(t);const n=hr(e);return{all:void 0,single:n,rank:n.length}}(e);const o=t.single,s=t.all,a=t.rank;r=ur(r,a),void 0!==o&&(n=o),void 0!==s&&(i=s)})),(0,We.verifyOptionalObjectProperty)(t,"pixelResolution",(e=>{l=(0,We.verifyObjectProperty)(e,"unit",sr.rh),(0,We.verifyOptionalObjectProperty)(e,"dimensions",(e=>{o=Float64Array.from((0,We.parseArray)(e,We.verifyFinitePositiveFloat)),r=ur(r,o.length)}))})),(0,We.verifyOptionalObjectProperty)(t,"scales",(e=>{var t=pr(e);const n=t.all,o=t.rank;r=ur(r,o),i=n}));const c=(0,We.verifyOptionalObjectProperty)(t,"dimensions",(e=>{const t=(0,We.parseArray)(e,We.verifyPositiveInt);return r=ur(r,t.length),t}));if(-1===r)throw new Error("Unable to determine rank of dataset");void 0===a&&(a=new Array(r),a.fill(l)),void 0===o&&(o=new Float64Array(r),o.fill(1));for(let h=0;h<r;++h)o[h]=(0,sr.Gh)(o[h],a[h].exponent);const d=new Array(r);void 0!==s&&(0,We.verifyOptionalObjectProperty)(t,"coordinateArrays",(e=>{(0,We.verifyObject)(e);for(let t=0;t<r;++t){const n=s[t];if(Object.prototype.hasOwnProperty.call(e,n)){const i=(0,We.verifyStringArray)(e[n]);d[t]={explicit:!1,labels:i,coordinates:bn()(i,((e,t)=>t))},a[t]={unit:"",exponent:0},o[t]=1}}})),void 0===s&&(s=function(e){const t=fr.slice(0,e);for(;t.length<e;)t.push("d".concat(t.length+1));return t}(r));const u=(0,Se.d)({rank:r,valid:!0,names:s,scales:o,units:a.map((e=>e.unit)),coordinateArrays:d});if(void 0===c){if(void 0===i)throw new Error("Not valid single-resolution or multi-resolution dataset");return{modelSpace:u,url:e,attributes:t,scales:i.map(((t,n)=>({url:"".concat(e,"/s").concat(n),downsamplingFactor:t})))}}return void 0===n&&(n=new Float64Array(r),n.fill(1)),{modelSpace:u,url:e,attributes:t,scales:[{url:e,downsamplingFactor:n}]}}class mr extends Me.tc{get description(){return"N5 data source"}get(e){let t=e.providerUrl;return t.endsWith("/")&&(t=t.substring(0,t.length-1)),e.chunkManager.memoize.getUncounted({type:"n5:MultiscaleVolumeChunkSource",providerUrl:t},(async()=>{var n=(0,bi.n)(t,e.credentialsManager);const i=n.url,r=n.credentialsProvider,o=gr(i,await dr(e.chunkManager,r,i,!1)),s=await function(e,t,n){return ae().all(n.scales.map((async n=>{const i=await dr(e,t,n.url,!0);if(void 0!==i)return new cr(i)})))}(e.chunkManager,r,o),a=new lr(e.chunkManager,r,o,s);return{modelTransform:(0,Se.FH)(a.modelSpace),subsources:[{id:"default",default:!0,url:void 0,subsource:{volume:a}},{id:"bounds",default:!0,url:void 0,subsource:{staticAnnotations:(0,ye.Sl)(a.modelSpace.bounds)}}]}}))}completeUrl(e){return ki(e.credentialsManager,e.providerUrl,e.cancellationToken)}}(0,St.Z)("n5",(()=>new mr));var vr,yr=n(2395),br=n.n(yr);!function(e){e[e.RAW=0]="RAW",e[e.GZIP=1]="GZIP",e[e.BLOSC=2]="BLOSC"}(vr||(vr={}));class Sr{}Sr.RPC_ID="zarr/VolumeChunkSource";var wr=n(1783);const xr=new(ve());xr.set("|u1",{endianness:wr.H$.LITTLE,dataType:vi.pe.UINT8}),xr.set("|i1",{endianness:wr.H$.LITTLE,dataType:vi.pe.INT8});for(let zo of[["<",wr.H$.LITTLE],[">",wr.H$.BIG]]){var Cr=(0,ue.A)(zo,2);let e=Cr[0],t=Cr[1];for(let n of["u","i"])xr.set("".concat(e).concat(n,"8"),{endianness:t,dataType:vi.pe.UINT64});xr.set("".concat(e,"u2"),{endianness:t,dataType:vi.pe.UINT16}),xr.set("".concat(e,"i2"),{endianness:t,dataType:vi.pe.INT16}),xr.set("".concat(e,"u4"),{endianness:t,dataType:vi.pe.UINT32}),xr.set("".concat(e,"i4"),{endianness:t,dataType:vi.pe.INT32}),xr.set("".concat(e,"f4"),{endianness:t,dataType:vi.pe.FLOAT32})}class kr extends((0,be.nx)(De()(S.RS),Sr)){}function Er(e){return(0,We.verifyOptionalObjectProperty)(e,"dimension_separator",(e=>{if("."!==e&&"/"!==e)throw new Error('Expected "." or "/", but received: '.concat(p()(e)));return e}))}function Tr(e){try{(0,We.verifyObject)(e),(0,We.verifyObjectProperty)(e,"zarr_format",(e=>{if(2!==e)throw new Error("Expected 2 but received: ".concat(p()(e)))}));const t=(0,We.verifyObjectProperty)(e,"shape",(e=>(0,We.parseArray)(e,(e=>{if("number"!==typeof e||!br()(e)||e<0)throw new Error("Expected non-negative integer, but received: ".concat(p()(e)));return e})))),n=(0,We.verifyObjectProperty)(e,"chunks",(e=>(0,We.parseFixedLengthArray)(new Array(t.length),e,(e=>{if("number"!==typeof e||!br()(e)||e<=0)throw new Error("Expected positive integer, but received: ".concat(p()(e)));return e})))),i=(0,We.verifyObjectProperty)(e,"order",(e=>{if("C"!==e&&"F"!==e)throw new Error('Expected "C" or "F", but received: '.concat(p()(e)));return e})),r=Er(e),o=(0,We.verifyObjectProperty)(e,"dtype",(e=>function(e){const t=xr.get(e);if(void 0===t)throw new Error("Unsupported numpy data type: ".concat(p()(e)));return t}((0,We.verifyString)(e)))),s=(0,We.verifyObjectProperty)(e,"compressor",(e=>{if(null===e)return vr.RAW;(0,We.verifyObject)(e);const t=(0,We.verifyObjectProperty)(e,"id",We.verifyString);switch(t){case"blosc":return vr.BLOSC;case"gzip":case"zlib":return vr.GZIP;default:throw new Error("Unsupported compressor: ".concat(p()(t)))}}));return{rank:t.length,shape:t,chunks:n,order:i,dataType:o.dataType,encoding:{compressor:s,endianness:o.endianness},dimensionSeparator:r}}catch(t){throw new Error("Error parsing zarr metadata: ".concat(t.message))}}class Lr extends S.kg{constructor(e,t,n,i,r,o){super(e),this.credentialsProvider=t,this.url=n,this.separator=i,this.metadata=r,this.attrs=o,this.dataType=r.dataType,this.volumeType=L.rU.IMAGE;let s=(0,We.verifyOptionalObjectProperty)(o,"_ARRAY_DIMENSIONS",(e=>(0,We.parseFixedLengthArray)(new Array(r.rank),e,We.verifyString)));void 0===s&&(s=bn()(r.shape,((e,t)=>"d".concat(t)))),this.modelSpace=(0,Se.d)({names:s,scales:Float64Array.from(r.shape,(()=>1)),units:bn()(r.shape,(()=>"")),boundingBoxes:[(0,Se.T4)({lowerBounds:new Float64Array(r.rank),upperBounds:Float64Array.from(r.shape)})]})}get rank(){return this.metadata.rank}getSources(e){const t=this.metadata,n=t.rank,i=t.chunks,r=t.shape;let o,s,a;if("F"===t.order)o=Uint32Array.from(i),s=Float32Array.from(r),a=(0,Ei.DA)(Float32Array,n+1);else{o=new Uint32Array(n),s=new Float32Array(n),a=new Float32Array((n+1)**2),a[(n+1)**2-1]=1;for(let e=0;e<n;++e)o[e]=i[n-1-e],s[e]=r[n-1-e],a[e+(n-1-e)*(n+1)]=1}return(0,je.RO)([(0,L.vn)({rank:n,chunkToMultiscaleTransform:a,dataType:t.dataType,upperVoxelBound:s,volumeType:this.volumeType,chunkDataSizes:[o],volumeSourceOptions:e}).map((e=>({chunkSource:this.chunkManager.getChunkSource(kr,{credentialsProvider:this.credentialsProvider,spec:e,parameters:{url:this.url,encoding:t.encoding,separator:this.separator}}),chunkToMultiscaleTransform:a})))])}}function Pr(e,t,n){return e.memoize.getUncounted({type:"zarr:.zattrs json",url:n,credentialsProvider:(0,Pe.R)(t)},(async()=>{try{const e=await(0,bi.G)(t,n+"/.zattrs",{},te.cj);return(0,We.verifyObject)(e),e}catch(e){if((0,te.El)(e))return{};throw e}}))}function Dr(e,t,n){return e.memoize.getUncounted({type:"zarr:.zarray json",url:n,credentialsProvider:(0,Pe.R)(t)},(async()=>Tr(await(0,bi.G)(t,n+"/.zarray",{},te.cj))))}const Mr=[{key:{value:"dimension_separator",description:"Dimension separator in chunk keys"},values:[{value:".",description:"(default)"},{value:"/",description:""}]}];class Ir extends Me.tc{get description(){return"Zarr data source"}get(e){var t=e.providerUrl.match(/([^?]*)(?:\?(.*))?$/),n=(0,ue.A)(t,3);let i=n[1],r=n[2];const o=(0,We.parseQueryStringParameters)(r||"");(0,We.verifyObject)(o);const s=Er(o);return i.endsWith("/")&&(i=i.substring(0,i.length-1)),e.chunkManager.memoize.getUncounted({type:"zarr:MultiscaleVolumeChunkSource",providerUrl:i,dimensionSeparator:s},(async()=>{var t=(0,bi.n)(i,e.credentialsManager);const n=t.url,r=t.credentialsProvider;var o=await ae().all([Dr(e.chunkManager,r,n),Pr(e.chunkManager,r,n)]),a=(0,ue.A)(o,2);const l=a[0],c=a[1];if(void 0!==l.dimensionSeparator&&void 0!==s&&l.dimensionSeparator!==s)throw new Error("Explicitly specified dimension separator "+"".concat(p()(s)," does not match value ")+"in .zarray ".concat(p()(l.dimensionSeparator)));const d=new Lr(e.chunkManager,r,n,s||l.dimensionSeparator||".",l,c);return{modelTransform:(0,Se.FH)(d.modelSpace),subsources:[{id:"default",default:!0,url:void 0,subsource:{volume:d}},{id:"bounds",default:!0,url:void 0,subsource:{staticAnnotations:(0,ye.Sl)(d.modelSpace.bounds)}}]}}))}async completeUrl(e){var t=e.providerUrl.match(/([^?]*)(?:\?(.*))?$/);let n=(0,ue.A)(t,3)[2];return void 0!==n?(0,Ge.KV)(e.providerUrl.length-n.length,await(0,Ge.Hj)(n,Mr)):await ki(e.credentialsManager,e.providerUrl,e.cancellationToken)}}(0,St.Z)("zarr",(()=>new Ir));n(1785);var Rr,Ar=n(2858),Or=n(7445),Nr=n(3985),_r=n(3436),Vr=n(2837),Br=n(6429);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ADDITIVE=1]="ADDITIVE"}(Rr||(Rr={}));const Fr=new(ve())([[Rr.DEFAULT,e=>{e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)}],[Rr.ADDITIVE,e=>{e.blendFunc(e.SRC_ALPHA,e.ONE)}]]);var Ur=n(7160),zr=n(251),jr=n(9080),Gr=n(4011);const Wr="#uicontrol invlerp normalized\nvoid main() {\n  emitGrayscale(normalized());\n}\n";function Hr(e,t){e.addFragmentCode("\n#define VOLUME_RENDERING false\n\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n"),e.addFragmentCode(zr.o),(0,Gr.kk)(t,e),e.setFragmentMainFunction((0,jr.qK)(t.parseResult.code))}class qr extends Vr.r{constructor(e,t){var n,i,r;const o=t.opacity,s=t.blendMode,a=t.shaderControlState;super(e,Q()(Q()({},t),{fallbackShaderParameters:new Ur.B0((0,Gr.PH)((0,Gr.TZ)(Wr,{imageData:{dataType:e.dataType,channelRank:null!==(r=null===(i=null===(n=t.channelCoordinateSpace)||void 0===n?void 0:n.value)||void 0===i?void 0:i.rank)&&void 0!==r?r:0}}))),encodeShaderParameters:e=>e.key,shaderParameters:a.builderState,dataHistogramSpecifications:a.histogramSpecifications})),this.shaderControlState=a,this.opacity=o,this.blendMode=s,this.registerDisposer(o.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(s.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(a.changed.add(this.redrawNeeded.dispatch))}defineShader(e,t){if(0!==t.parseResult.errors.length)throw new Error("Invalid UI control specification");e.addUniform("highp float","uOpacity"),Hr(e,t)}initializeShader(e,t,n){const i=this.gl;i.uniform1f(t.uniform("uOpacity"),this.opacity.value),(0,Gr.dB)(i,t,this.shaderControlState,n.parseResult.controls)}setGLBlendMode(e,t){const n=this.blendMode.value;n===Rr.ADDITIVE||t>0?(e.enable(e.BLEND),Fr.get(n)(e)):e.disable(WebGL2RenderingContext.BLEND)}}var Yr=n(1245),Jr=n(7965),Kr=n(3893),Xr=n(2328),Zr=n(304),Qr=n(6094),$r=n(6560),eo=n(6210),to=n(6874);const no=F.w0.create();function io(e,t,n,i,r,o){if(0===i.length)return;const s=e.viewMatrix,a=e.projectionMat,l=e.displayDimensionRenderInfo.voxelPhysicalScales,c=(0,F.xK)(l),d=((0,F.sJ)(a)/64)**3,u=F.w0.determinant((0,F._A)(no,s)),h=e=>{const t=i[e];return Math.abs(t.chunkLayout.detTransform*u)};let p=i.length-1,f=h(p);for(let b=p-1;b>=0;--b){const e=h(b);if(!(Math.abs(e-d)<Math.abs(f-d)))break;f=e,p=b}const g=Math.pow(f*c/u,1/3),m=Math.pow(f,1/3)*e.width/(2*a[0]);let v=!0;const y=i[p];(0,Je.ah)(e,t,y,((e,t)=>{v&&(r(y,p,g,m,t),v=!1),o(y,p,e)}))}var ro=n(605),oo=n(8913);const so=F.pB.create(),ao=new Float32Array(24);class lo extends $r.r{constructor(e){super(),this.multiscaleSource=e.multiscaleSource,this.transform=e.transform,this.channelCoordinateSpace=e.channelCoordinateSpace,this.shaderControlState=e.shaderControlState,this.localPosition=e.localPosition,this.renderScaleTarget=e.renderScaleTarget,this.renderScaleHistogram=e.renderScaleHistogram,this.registerDisposer(this.renderScaleHistogram.visibility.add(this.visibility));const t=this.registerDisposer((0,Ur.Uq)((e=>e.rank),[this.channelCoordinateSpace]));this.shaderGetter=(0,jr.Wh)(this,this.gl,{memoizeKey:"VolumeRenderingRenderLayer",parameters:e.shaderControlState.builderState,getContextKey:e=>{let{emitter:t,chunkFormat:n}=e;return"".concat((0,Pe.R)(t),":").concat(n.shaderKey)},shaderError:e.shaderError,extraParameters:t,defineShader:(e,t,n,i)=>{let{emitter:r,chunkFormat:o}=t;if(0!==n.parseResult.errors.length)throw new Error("Invalid UI control specification");(0,oo.N)(e),e.addFragmentCode("\n#define VOLUME_RENDERING true\n"),r(e),e.addUniform("highp float","uNearLimitFraction"),e.addUniform("highp float","uFarLimitFraction"),e.addUniform("highp int","uMaxSteps"),e.addUniform("highp vec3","uTranslation"),e.addUniform("highp mat4","uModelViewProjectionMatrix"),e.addUniform("highp mat4","uInvModelViewProjectionMatrix"),e.addUniform("highp vec3","uChunkDataSize"),e.addUniform("highp vec3","uLowerClipBound"),e.addUniform("highp vec3","uUpperClipBound"),e.addUniform("highp float","uBrightnessFactor"),e.addVarying("highp vec4","vNormalizedPosition"),e.addVertexCode(ro.D_),e.setVertexMain("\nvec3 boxVertex = getBoxFaceVertexPosition(gl_VertexID);\nvec3 position = max(uLowerClipBound, min(uUpperClipBound, uTranslation + boxVertex * uChunkDataSize));\nvNormalizedPosition = gl_Position = uModelViewProjectionMatrix * vec4(position, 1.0);\ngl_Position.z = 0.0;\n"),e.addFragmentCode("\nvec3 curChunkPosition;\nvec4 outputColor;\nvoid userMain();\n"),(0,S.m0)(e,o,i,"curChunkPosition"),e.addFragmentCode("\nvoid emitRGBA(vec4 rgba) {\n  float alpha = rgba.a * uBrightnessFactor;\n  outputColor += vec4(rgba.rgb * alpha, alpha);\n}\nvoid emitRGB(vec3 rgb) {\n  emitRGBA(vec4(rgb, 1.0));\n}\nvoid emitGrayscale(float value) {\n  emitRGB(vec3(value, value, value));\n}\nvoid emitTransparent() {\n  emitRGBA(vec4(0.0, 0.0, 0.0, 0.0));\n}\n"),e.setFragmentMainFunction("\nvoid main() {\n  vec2 normalizedPosition = vNormalizedPosition.xy / vNormalizedPosition.w;\n  vec4 nearPointH = uInvModelViewProjectionMatrix * vec4(normalizedPosition, -1.0, 1.0);\n  vec4 farPointH = uInvModelViewProjectionMatrix * vec4(normalizedPosition, 1.0, 1.0);\n  vec3 nearPoint = nearPointH.xyz / nearPointH.w;\n  vec3 farPoint = farPointH.xyz / farPointH.w;\n  vec3 rayVector = farPoint - nearPoint;\n  vec3 boxStart = max(uLowerClipBound, uTranslation);\n  vec3 boxEnd = min(boxStart + uChunkDataSize, uUpperClipBound);\n  float intersectStart = uNearLimitFraction;\n  float intersectEnd = uFarLimitFraction;\n  for (int i = 0; i < 3; ++i) {\n    float startPt = nearPoint[i];\n    float endPt = farPoint[i];\n    float boxLower = boxStart[i];\n    float boxUpper = boxEnd[i];\n    float r = rayVector[i];\n    float startFraction;\n    float endFraction;\n    if (startPt >= boxLower && startPt <= boxUpper) {\n      startFraction = 0.0;\n    } else {\n      startFraction = min((boxLower - startPt) / r, (boxUpper - startPt) / r);\n    }\n    if (endPt >= boxLower && endPt <= boxUpper) {\n      endFraction = 1.0;\n    } else {\n      endFraction = max((boxLower - startPt) / r, (boxUpper - startPt) / r);\n    }\n    intersectStart = max(intersectStart, startFraction);\n    intersectEnd = min(intersectEnd, endFraction);\n  }\n  float stepSize = (uFarLimitFraction - uNearLimitFraction) / float(uMaxSteps - 1);\n  int startStep = int(floor((intersectStart - uNearLimitFraction) / stepSize));\n  int endStep = min(uMaxSteps, int(floor((intersectEnd - uNearLimitFraction) / stepSize)) + 1);\n  outputColor = vec4(0, 0, 0, 0);\n  for (int step = startStep; step < endStep; ++step) {\n    vec3 position = mix(nearPoint, farPoint, uNearLimitFraction + float(step) * stepSize);\n    curChunkPosition = position - uTranslation;\n    userMain();\n  }\n  emit(outputColor, 0u);\n}\n"),e.addFragmentCode(zr.o),(0,Gr.kk)(n,e),e.addFragmentCode("\n#define main userMain\n"+(0,jr.qK)(n.parseResult.code)+"\n#undef main\n")}}),this.vertexIdHelper=this.registerDisposer(oo.u.get(this.gl)),this.registerDisposer(this.renderScaleTarget.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.shaderControlState.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.localPosition.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.transform.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.shaderControlState.fragmentMain.changed.add(this.redrawNeeded.dispatch));const n=this.multiscaleSource.chunkManager,i=this.registerDisposer(new be.tB(this.layerChunkProgressInfo)),r=n.rpc;i.RPC_TYPE_ID="volume_rendering/VolumeRenderingRenderLayer",i.initializeCounterpart(r,{chunkManager:n.rpcId,localPosition:this.registerDisposer(eo.a.makeFromExisting(r,this.localPosition)).rpcId,renderScaleTarget:this.registerDisposer(eo.a.makeFromExisting(r,this.renderScaleTarget)).rpcId}),this.backend=i}get gl(){return this.multiscaleSource.chunkManager.gl}get isTransparent(){return!0}get isVolumeRendering(){return!0}get dataType(){return this.multiscaleSource.dataType}attach(e){super.attach(e),e.state={sources:e.registerDisposer((0,Ur.no)(((t,n,i)=>{const r=(0,to.AK)(i,n,(e=>this.multiscaleSource.getSources(e)),e.messages,this);for(const e of r)for(const n of e)t.registerDisposer(n.source);return e.view.flushBackendProjectionParameters(),this.backend.rpc.invoke("volume_rendering/VolumeRenderingRenderLayer/update",{layer:this.backend.rpcId,view:e.view.rpcId,sources:(0,to.Zi)(r)}),this.redrawNeeded.dispatch(),r}),this.transform,e.view.displayDimensionRenderInfo))}}get chunkManager(){return this.multiscaleSource.chunkManager}draw(e,t){if(!e.emitColor)return;const n=t.state.sources.value;if(0===n.length)return;let i,r,o=0,s=0,a=null;const l=F.eR.create(),c=this.gl;this.vertexIdHelper.enable();const d=this.renderScaleHistogram;d.begin(this.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber);const u=()=>{null!==a&&(null!==i&&i.endDrawing(c,a),0===m&&0===v||d.add(o,s,m,v))};let h=!0;const p=e.projectionParameters;let f,g,m=0,v=0;const y=this.multiscaleSource.rank,b=F.eR.create();c.enable(WebGL2RenderingContext.CULL_FACE),c.cullFace(WebGL2RenderingContext.FRONT),io(e.projectionParameters,this.localPosition.value,this.renderScaleTarget.value,n[0],((t,n,d,h)=>{o=d,s=h;const m=(0,Je.BA)(p,t.chunkLayout),v=t.source,y=t.fixedPositionWithinChunk,b=t.chunkDisplayDimensionIndices;for(const e of b)y[e]=0;const S=v.chunkFormat;if(S!==i&&(i=S,u(),r=this.shaderGetter({emitter:e.emitter,chunkFormat:S}),a=r.shader,null!==a&&(a.bind(),null!==S&&((0,Gr.dB)(c,a,this.shaderControlState,r.parameters.parseResult.controls),S.beginDrawing(c,a),S.beginSource(c,a)))),g=void 0,null===a)return;f=v.chunks,l.fill(1);const w=F.pB.multiply(so,p.viewProjectionMat,m.transform);c.uniformMatrix4fv(a.uniform("uModelViewProjectionMatrix"),!1,w);const x=ao;(0,F._S)(x,w),F.pB.invert(w,w),c.uniformMatrix4fv(a.uniform("uInvModelViewProjectionMatrix"),!1,w);var C=function(e,t,n){let i=0,r=0;for(let l=0;l<3;++l){const o=e[16+l],s=o*t[l],a=o*n[l];i+=Math.min(s,a),r+=Math.max(s,a)}const o=-e[19],s=Math.max(o,i),a=e[23];return{near:o,far:a,adjustedNear:s,adjustedFar:Math.min(a,r)}}(x,t.lowerClipDisplayBound,t.upperClipDisplayBound);const k=C.near,E=C.far,T=C.adjustedNear,L=C.adjustedFar,P=(L-T)/63/(E-k);c.uniform1f(a.uniform("uBrightnessFactor"),P);const D=(T-k)/(E-k),M=(L-k)/(E-k);c.uniform1f(a.uniform("uNearLimitFraction"),D),c.uniform1f(a.uniform("uFarLimitFraction"),M),c.uniform1i(a.uniform("uMaxSteps"),64),c.uniform3fv(a.uniform("uLowerClipBound"),t.lowerClipDisplayBound),c.uniform3fv(a.uniform("uUpperClipBound"),t.upperClipDisplayBound)}),(e=>{if(null===a)return;const t=e.curPositionInChunks.join(),n=f.get(t);if(void 0!==n&&n.state===Qr.HU.GPU_MEMORY){const t=e.chunkLayout.size;let r=n.chunkDataSize;const o=e.chunkDisplayDimensionIndices,s=e.fixedPositionWithinChunk,d=e.chunkTransform.channelToChunkDimensionIndices;if((0,rr.A)(e),r!==g){g=r;for(let e=0;e<3;++e){const t=o[e];l[e]=-1===t||t>=y?1:g[t]}c.uniform3fv(a.uniform("uChunkDataSize"),l)}const u=n.chunkGridPosition;for(let e=0;e<3;++e){const n=o[e];b[e]=-1===n||n>=y?0:t[e]*u[n]}null!=i&&i.bindChunk(c,a,n,s,o,d,h),h=!1,c.uniform3fv(a.uniform("uTranslation"),b),(0,ro.KA)(c,1,1),++m}else++v})),c.disable(WebGL2RenderingContext.CULL_FACE),u(),this.vertexIdHelper.disable()}isReady(e,t){const n=t.state.sources.value;if(0===n.length)return!0;let i=!1;return io(e.projectionParameters,this.localPosition.value,this.renderScaleTarget.value,n[0],(()=>{}),(e=>{const t=e.source.chunks.get(e.curPositionInChunks.join());void 0!==t&&t.state===Qr.HU.GPU_MEMORY||(i=!0)})),i}}var co=n(2038),uo=n(1058);const ho=n(8774).n5.fromObject({arrowup:{action:"tab-backward"},arrowdown:{action:"tab-forward"},tab:{action:"tab-forward"},"shift+tab":{action:"tab-backward"},enter:{action:"commit"},escape:{action:"cancel"}});class po{constructor(e){this.id=e,this.element=document.createElement("div"),this.nameContainer=document.createElement("div"),this.nameElement=document.createElement("input"),this.lowerElement=document.createElement("div"),this.upperElement=document.createElement("div");const t=this.element,n=this.nameContainer,i=this.nameElement,r=this.lowerElement,o=this.upperElement;t.classList.add("neuroglancer-channel-dimensions-widget-dim"),n.classList.add("neuroglancer-channel-dimensions-widget-name-container"),i.classList.add("neuroglancer-channel-dimensions-widget-name"),n.appendChild(i),r.classList.add("neuroglancer-channel-dimensions-widget-lower"),o.classList.add("neuroglancer-channel-dimensions-widget-upper"),t.appendChild(n),t.appendChild(r),t.appendChild(o),n.draggable=!0,i.disabled=!0,i.spellcheck=!1,i.autocomplete="off",i.required=!0,i.placeholder=" ",n.title="Drag to reorder, double click to rename.  Names ending in ' or ^ indicate dimensions local to the layer; names ending in ^ indicate channel dimensions (image layers only).",n.addEventListener("dblclick",(()=>{i.disabled=!1,i.focus(),i.select()})),i.addEventListener("focus",(()=>{i.select()}))}}class fo extends w.O8{constructor(e){super(),this.combiner=e,this.element=document.createElement("div"),this.dimensionWidgets=[],this.curCoordinateSpace=void 0,this.dragSource=void 0,this.coordinateSpace=this.combiner.combined;const t=this.element;t.classList.add("neuroglancer-channel-dimensions-widget");const n=this.registerCancellable((0,co.t)((()=>this.updateView())));this.registerDisposer(e.combined.changed.add(n));this.registerDisposer(new uo.cL(t,ho)).allShortcutsAreGlobal=!0,this.registerDisposer((0,uo.qZ)(t,"cancel",(e=>{this.forceUpdateView();const t=e.target;t instanceof HTMLElement&&t.blur()}))),this.updateView()}reorderDimensionTo(e,t){if(e===t)return;const n=this.coordinateSpace;n.value=(0,Se.dq)(n.value,e,t)}makeNewDimensionWidget(e){const t=new po(e);return t.nameContainer.addEventListener("dragstart",(e=>{this.dragSource=t,e.stopPropagation(),e.dataTransfer.setData("neuroglancer-dimension","")})),t.nameContainer.addEventListener("dragenter",(e=>{const n=this.dragSource;if(void 0===n||n===t)return;const i=this.dimensionWidgets,r=i.indexOf(n),o=i.indexOf(t);-1!==r&&-1!==o&&(e.preventDefault(),this.reorderDimensionTo(o,r))})),t.nameContainer.addEventListener("dragend",(e=>{this.dragSource===t&&(this.dragSource=void 0)})),t.nameElement.addEventListener("blur",(e=>{t.nameElement.disabled=!0;const n=e.relatedTarget;this.dimensionWidgets.some((e=>e.nameElement===n))||this.updateNames()||this.forceUpdateView()})),t.nameElement.addEventListener("input",(()=>{const e=t.nameElement;(0,f.qi)(e),this.updateNameValidity()})),(0,uo.qZ)(t.nameElement,"commit",(()=>{this.updateNames()})),(0,uo.qZ)(t.nameElement,"tab-forward",(e=>this.selectAdjacentField(e,t,1))),(0,uo.qZ)(t.nameElement,"tab-backward",(e=>this.selectAdjacentField(e,t,-1))),t}selectAdjacentField(e,t,n){e.stopPropagation();const i=this.dimensionWidgets,r=i.indexOf(t);if(-1===r)return;const o=r+n;if(o<0||o>=i.length)return;const s=i[o];s.nameElement.disabled=!1,s.nameElement.focus(),e.preventDefault()}updateNames(){const e=this.dimensionWidgets,t=this.coordinateSpace,n=t.value,i=e.map((e=>e.nameElement.value));if(this.combiner.getRenameValidity(i).includes(!1))return!1;const r=n.names;if((0,je.r1)(r,i))return!1;const o=n.timestamps.map(((e,t)=>r[t]===i[t]?e:Date.now())),s=Q()(Q()({},n),{names:i,timestamps:o});return t.value=s,!0}updateNameValidity(){const e=this.dimensionWidgets,t=e.map((e=>e.nameElement.value)),n=t.length,i=this.combiner.getRenameValidity(t);for(let r=0;r<n;++r)e[r].nameElement.dataset.isValid=!1===i[r]?"false":"true"}forceUpdateView(){this.curCoordinateSpace=void 0,this.updateView()}updateView(){const e=this.coordinateSpace.value;if(this.curCoordinateSpace===e)return;this.curCoordinateSpace=e;const t=this.element,n=this.dimensionWidgets,i=this.dimensionWidgets=e.ids.map((e=>n.find((t=>t.id===e))||this.makeNewDimensionWidget(e)));(0,f.bu)(t,function*(){const t=e.names,n=e.rank;var r=e.bounds;const o=r.lowerBounds,s=r.upperBounds;for(let e=0;e<n;++e){const n=i[e];n.nameElement.value=t[e],delete n.nameElement.dataset.isValid,(0,f.qi)(n.nameElement),n.lowerElement.textContent=o[e].toString(),n.upperElement.textContent=s[e].toString(),yield n.element}}.call(this))}}var go=n(6348),mo=n(154),vo=n(8093),yo=n(441),bo=n(5041),So=n(217),wo=n(1821),xo=n(551),Co=n(628),ko=n(4791),Eo=n(8946);const To="opacity",Lo="blend",Po="shader",Do="shaderControls",Mo="crossSectionRenderScale",Io="channelDimensions",Ro="volumeRendering",Ao=(0,Kr.Ok)(Ar.J3);class Oo extends Ao{constructor(e){super(e),this.opacity=(0,Yr.h)(.5),this.blendMode=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rr.DEFAULT;return new Br.F(Rr,e)}(),this.fragmentMain=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wr;return(0,jr.vk)(e)}(),this.shaderError=(0,jr.RH)(),this.dataType=new Ur.B0(void 0),this.sliceViewRenderScaleHistogram=new _r.zD,this.sliceViewRenderScaleTarget=(0,_r.fm)(1),this.volumeRenderingRenderScaleHistogram=new _r.zD,this.volumeRenderingRenderScaleTarget=(0,_r.fm)(1),this.channelCoordinateSpace=new Se.W6,this.channelCoordinateSpaceCombiner=new Se.Ii(this.channelCoordinateSpace,Se.OG),this.channelSpace=this.registerDisposer((0,Ur.ol)((e=>(0,Zr.T)((()=>(0,Nr.Sg)(e)))),this.channelCoordinateSpace)),this.volumeRendering=new Jr.C_(!1,!1),this.shaderControlState=this.registerDisposer(new Gr.a$(this.fragmentMain,this.registerDisposer((0,Ur.Uq)(((e,t)=>void 0===e?null:{imageData:{dataType:e,channelRank:t.rank}}),[this.dataType,this.channelCoordinateSpace],((e,t)=>p()(e)===p()(t)))),this.channelCoordinateSpaceCombiner)),this.localCoordinateSpaceCombiner.includeDimensionPredicate=Se.AJ,this.blendMode.changed.add(this.specificationChanged.dispatch),this.opacity.changed.add(this.specificationChanged.dispatch),this.fragmentMain.changed.add(this.specificationChanged.dispatch),this.shaderControlState.changed.add(this.specificationChanged.dispatch),this.sliceViewRenderScaleTarget.changed.add(this.specificationChanged.dispatch),this.volumeRendering.changed.add(this.specificationChanged.dispatch),this.tabs.add("rendering",{label:"Rendering",order:-100,getter:()=>new Vo(this)}),this.tabs.default="rendering"}markLoading(){const e=super.markLoading(),t=this.channelCoordinateSpaceCombiner.retain();return()=>{e(),t()}}addCoordinateSpace(e){const t=super.addCoordinateSpace(e),n=this.channelCoordinateSpaceCombiner.bind(e);return()=>{t(),n()}}activateDataSubsources(e){let t;for(const n of e){if(this.addStaticAnnotations(n))continue;const e=n.subsourceEntry.subsource.volume;e instanceof S.kg?t&&e.dataType!==t?n.deactivate("Data type must be ".concat(L.pe[e.dataType].toLowerCase())):(t=e.dataType,n.activate((t=>{n.addRenderLayer(new qr(e,{opacity:this.opacity,blendMode:this.blendMode,shaderControlState:this.shaderControlState,shaderError:this.shaderError,transform:n.getRenderLayerTransform(this.channelCoordinateSpace),renderScaleTarget:this.sliceViewRenderScaleTarget,renderScaleHistogram:this.sliceViewRenderScaleHistogram,localPosition:this.localPosition,channelCoordinateSpace:this.channelCoordinateSpace}));const i=t.registerDisposer(new lo({multiscaleSource:e,shaderControlState:this.shaderControlState,shaderError:this.shaderError,transform:n.getRenderLayerTransform(this.channelCoordinateSpace),renderScaleTarget:this.volumeRenderingRenderScaleTarget,renderScaleHistogram:this.volumeRenderingRenderScaleHistogram,localPosition:this.localPosition,channelCoordinateSpace:this.channelCoordinateSpace}));t.registerDisposer(n.messages.addChild(i.messages)),t.registerDisposer((0,Ur.no)(((e,t)=>{t&&e.registerDisposer(this.addRenderLayer(i.addRef()))}),this.volumeRendering)),this.shaderError.changed.dispatch()}))):n.deactivate("Not compatible with image layer")}this.dataType.value=t}restoreState(e){super.restoreState(e),this.opacity.restoreState(e[To]),(0,We.verifyOptionalObjectProperty)(e,Lo,(e=>this.blendMode.restoreState(e))),this.fragmentMain.restoreState(e[Po]),this.shaderControlState.restoreState(e[Do]),this.sliceViewRenderScaleTarget.restoreState(e[Mo]),this.channelCoordinateSpace.restoreState(e[Io]),this.volumeRendering.restoreState(e[Ro])}toJSON(){const e=super.toJSON();return e[To]=this.opacity.toJSON(),e[Lo]=this.blendMode.toJSON(),e[Po]=this.fragmentMain.toJSON(),e[Do]=this.shaderControlState.toJSON(),e[Mo]=this.sliceViewRenderScaleTarget.toJSON(),e[Io]=this.channelCoordinateSpace.toJSON(),e[Ro]=this.volumeRendering.toJSON(),e}displayImageSelectionState(e,t){const n=e.value;if(null==n)return!1;const i=this.channelSpace.value;if(void 0!==i.error)return!1;const r=i.numChannels,o=i.coordinates;var s=i.channelCoordinateSpace;const a=s.names,l=s.rank,c=document.createElement("div");c.classList.add("neuroglancer-selection-details-value-grid");let d="[copy] 0fr ";0!==l&&(d+="repeat(".concat(l,", [dim] 0fr [coord] 0fr) ")),d+="[value] 1fr",c.style.gridTemplateColumns=d;for(let u=0;u<r;++u){const e=0===l?n:n[u],t=null==e?"":e.toString(),i=(0,go.C)({title:"Copy value",onClick:()=>{(0,Xr.B)(t)}});c.appendChild(i);for(let n=0;n<l;++n){const e=document.createElement("div");e.classList.add("neuroglancer-selection-details-value-grid-dim"),e.textContent=a[n],c.appendChild(e);const t=document.createElement("div");t.classList.add("neuroglancer-selection-details-value-grid-coord"),t.textContent=o[u*l+n].toString(),c.appendChild(t)}const r=document.createElement("div");r.classList.add("neuroglancer-selection-details-value-grid-value"),r.textContent=t,c.appendChild(r)}return t.appendChild(c),!0}displaySelectionState(e,t,n){let i=this.displayImageSelectionState(e,t);return super.displaySelectionState(e,t,n)&&(i=!0),i}getLegendShaderOptions(){return{memoizeKey:"ImageUserLayer",parameters:this.shaderControlState.builderState,encodeParameters:e=>e.key,defineShader:(e,t)=>{e.addFragmentCode("\n#define uOpacity 1.0\n"),Hr(e,t)},initializeShader:e=>{const t=e.shader;(0,Gr.dB)(this.manager.root.display.gl,t,this.shaderControlState,e.parameters.parseResult.controls)}}}}function No(e){return new Co.h({shaderError:e.shaderError,fragmentMain:e.fragmentMain,shaderControlState:e.shaderControlState})}Oo.type="image",Oo.typeAbbreviation="img";const _o=[Q()({label:"Resolution (slice)",toolJson:Mo},(0,xo.P)((e=>({histogram:e.sliceViewRenderScaleHistogram,target:e.sliceViewRenderScaleTarget})))),Q()({label:"Blending",toolJson:Lo},(0,bo.k)((e=>e.blendMode))),Q()({label:"Volume rendering (experimental)",toolJson:Ro},(0,yo.Y)((e=>e.volumeRendering))),Q()({label:"Resolution (3d)",toolJson:"volumeRenderScale",isValid:e=>e.volumeRendering},(0,xo.P)((e=>({histogram:e.volumeRenderingRenderScaleHistogram,target:e.volumeRenderingRenderScaleTarget})))),Q()({label:"Opacity",toolJson:To},(0,So.k)((e=>({value:e.opacity}))))];for(const zo of _o)(0,vo.ok)(Oo,zo);class Vo extends Eo.oz{constructor(e){super(),this.layer=e,this.codeWidget=this.registerDisposer(No(this.layer));const t=this.element;t.classList.add("neuroglancer-image-dropdown");for(const r of _o)t.appendChild((0,vo.KZ)(this,e,this.visibility,r));let n=document.createElement("div");n.style.flex="1";let i=document.createElement("div");i.className="neuroglancer-image-dropdown-top-row",i.appendChild(document.createTextNode("Shader")),i.appendChild(n),i.appendChild((0,wo.F)({title:"Show larger editor view",onClick:()=>{new Bo(this.layer)}})),i.appendChild((0,mo.G)({title:"Documentation on image layer rendering",href:"https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md"})),t.appendChild(i),t.appendChild(this.registerDisposer(new fo(e.channelCoordinateSpaceCombiner)).element),t.appendChild(this.codeWidget.element),t.appendChild(this.registerDisposer(new ko.SJ(e.shaderControlState,this.layer.manager.root.display,this.layer,{visibility:this.visibility,legendShaderOptions:this.layer.getLegendShaderOptions()})).element)}}class Bo extends Or.hJ{constructor(e){super(),this.layer=e,this.codeWidget=this.registerDisposer(No(this.layer)),this.content.classList.add("neuroglancer-image-layer-shader-overlay"),this.content.appendChild(this.codeWidget.element),this.codeWidget.textEditor.refresh()}}function Fo(e){if(e.brainMapsClientId){const t=e.brainMapsClientId;X.X.register(gn,(()=>new oi(t)))}let t=K({bundleRoot:e.bundleRoot},e.target);return(0,v.yx)(t.inputEventBindings),function(e){e.registerEventListener(document,"copy",(t=>{if((0,f.Hf)(t.target))return;const n=document.getSelection();if(null!==n&&"Range"===n.type)return;const i=(0,g.$s)(e.state).value,r=t.clipboardData;null!==r&&r.setData("text/plain",p()(i,void 0,"  ")),t.preventDefault()}))}(t),m(t),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;(0,w.K6)(e,"contextmenu",(e=>{e.preventDefault()}))}(e.target),t}(0,Ar.LJ)(Oo),(0,Ar.zQ)(L.rU.IMAGE,Oo),(0,Ar.lV)((e=>{const t=e.volume;if(void 0!==t&&t.volumeType===L.rU.UNKNOWN)return{layerConstructor:Oo,priority:-100}})),(0,ko.G6)(Oo,(e=>({shaderControlState:e.shaderControlState,legendShaderOptions:e.getLegendShaderOptions()})));class Uo{version(){return"0.0.1"}}},8614:(e,t,n)=>{n.d(t,{lH:()=>v,s0:()=>y});var i=n(3985),r=n(3056),o=n(7965),s=n(7160),a=n(2303),l=n(7562),c=n(304),d=n(3835),u=n(1648),h=n(9080),p=n(4011);class f extends s.B0{}class g extends u.g{constructor(){super(((e,t)=>{let{showMatches:n,segmentationState:i}=t;e.registerDisposer(n.changed.add(this.changed.dispatch)),e.registerDisposer(i.changed.add(this.changed.dispatch)),e.registerDisposer((0,s.no)(((e,t)=>{if(null==t)return;const n=t.segmentationGroupState;e.registerDisposer(n.changed.add(this.changed.dispatch)),e.registerDisposer((0,s.no)(((e,t)=>{const n=t.visibleSegments;let i=0===n.size;e.registerDisposer(n.changed.add((()=>{const e=0===n.size;e!==i&&(i=e,this.changed.dispatch())})))}),n))}),i))}))}get(e){let t=super.get(e);return void 0===t&&(t={segmentationState:new s.B0(void 0),showMatches:new o.C_(!1)},super.set(e,t)),t}}const m="\nvoid main() {\n  setColor(defaultColor());\n}\n";class v extends l.O8{constructor(){super(...arguments),this.shader=(0,h.vk)(m),this.shaderControls=new p.a$(this.shader),this.fallbackShaderControls=new s.B0((0,p.PH)((0,p.TZ)(m))),this.shaderError=(0,h.RH)(),this.color=new a.TrackableRGB(d.eR.fromValues(1,1,0)),this.relationshipStates=this.registerDisposer(new g),this.ignoreNullSegmentFilter=new o.C_(!0),this.displayUnfiltered=(0,s.ol)(((e,t)=>{for(const n of e.values())if(n.showMatches.value){if(!t)return!1;const e=n.segmentationState.value;if(null!=e&&e.segmentationGroupState.value.visibleSegments.size>0)return!1}return!0}),this.relationshipStates,this.ignoreNullSegmentFilter),this.hoverState=new f(void 0)}}class y extends l.O8{constructor(e){super();const t=e.transform,n=e.localPosition,o=e.source;var a=e.role;const l=void 0===a?r.gY.ANNOTATION:a;this.transform=t,this.localPosition=n,this.source=this.registerDisposer(o),this.role=l,this.displayState=e.displayState,this.chunkTransform=this.registerDisposer((0,s.ol)((e=>(0,c.T)((()=>(0,i.pe)((0,c.P)(e))))),this.transform)),this.dataSource=e.dataSource,this.subsourceId=e.subsourceId,this.subsourceIndex=e.subsourceIndex}get sourceIndex(){const e=this.dataSource;return e.layer.dataSources.indexOf(e)}}},2282:(e,t,n)=>{n.d(t,{Mx:()=>v,N8:()=>b,Wv:()=>a,XD:()=>m,YN:()=>h,g8:()=>d,hR:()=>f,j4:()=>g,ky:()=>c,q8:()=>u,qW:()=>p,vA:()=>l});var i=n(8178),r=n.n(i),o=n(156),s=n(3835);const a="annotation.MetadataChunkSource",l="annotation.GeometryChunkSource",c="annotation.SubsetGeometryChunkSource",d="annotation.reference.add",u="annotation.reference.delete",h="annotation.commit",p="annotation.commit",f="annotation/SpatiallyIndexedRenderLayer",g="annotation/PerspectiveRenderLayer:updateSources",m="annotation/RenderLayer",v="annotation/RenderLayer.updateSegmentation",y=s.w0.create();function b(e,t,n,i,a,l){const c=e.displayDimensionRenderInfo,d=e.viewMatrix,u=e.projectionMat,h=e.width,p=e.height,f=c.voxelPhysicalScales,g=Math.abs(s.w0.determinant((0,s._A)(y,d))),m=(0,s.xK)(f),v=(0,s.I1)(u)/g*m;if(0===i.length)return;const b=i[0];let S=Math.abs(b.chunkLayout.detTransform)*m;const w=b.lowerClipDisplayBound,x=b.upperClipDisplayBound;for(let r=0;r<3;++r)S*=x[r]-w[r];const C=Math.min(S,v),k=h*p,E=k/n**2/C;let T=0;for(let y=i.length-1;y>=0&&T<E;--y){const n=i[y],c=n.source.spec,d=n.chunkLayout,u=(0,s.xK)(d.size)*Math.abs(d.detTransform)*m,h=c.limit,p=c.rank,f=n.nonDisplayLowerClipBound,g=n.nonDisplayUpperClipBound;let v=1;for(let e=0;e<p;++e){const t=g[e]-f[e];r()(t)&&(v/=t)}let b=!0;const S=T+h*v/u,w=Math.pow(1/S,1/3),x=Math.sqrt(k/(S*C)),L=(E-T)*u/v,P=Math.min(1,L/c.limit);(0,o.ah)(e,t,n,(()=>{b&&(a(n,y),b=!1),l(n,y,P,w,x)})),T=S}}},9063:(e,t,n)=>{n.d(t,{eU:()=>D,nm:()=>E,oZ:()=>V});var i=n(281),r=n.n(i),o=n(1274),s=n.n(o),a=n(608),l=n.n(a),c=n(6063),d=n.n(c),u=n(5677),h=n.n(u),p=n(1767),f=n(2282),g=n(2108),m=n(5795),v=n(4874),y=n(6874),b=n(9859),S=n(1783),w=n(2729),x=n(6344),C=n(7799),k=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=h()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&d()(t,n,s),s};function E(e){let t=0;const n=e.typeToIds;for(const i of p.PB)t+=(0,g.Ag)(i).pickIdsPerInstance*n[i].length;return t}class T{constructor(e){this.bufferValid=!1,this.numPickIds=0,this.serializedAnnotations={data:e.data,typeToIds:e.typeToIds,typeToOffset:e.typeToOffset,typeToIdMaps:e.typeToIdMaps}}freeGPUMemory(e){const t=this.buffer;void 0!==t&&(t.dispose(),this.bufferValid=!1,this.buffer=void 0)}}class L extends m.AA{constructor(e,t){super(e),void 0!==t.data&&(this.data=new T(t))}freeGPUMemory(e){super.freeGPUMemory(e);const t=this.data;void 0!==t&&t.freeGPUMemory(e)}dispose(){this.data=void 0}}class P extends y.ZG{constructor(e,t){super(e,t),void 0!==t.data&&(this.data=new T(t))}freeGPUMemory(e){super.freeGPUMemory(e);const t=this.data;void 0!==t&&t.freeGPUMemory(e)}dispose(){this.data=void 0}}let D=class extends y.kV{constructor(e,t){super(e,t),this.immediateChunkUpdates=!0;(this.parent=t.parent).spatiallyIndexedSources.add(this);var n=this.spec;const i=n.rank,r=n.chunkDataSize,o=this.multiscaleToChunkTransform=new Float32Array((i+1)**2);w.DI(o,i+1,this.spec.chunkToMultiscaleTransform,i+1,i+1);for(let s=0;s<i;++s)for(let e=0;e<i+1;++e)o[(i+1)*e+s]/=r[s]}disposed(){this.parent.spatiallyIndexedSources.delete(this),super.disposed()}initializeCounterpart(e,t){t.parent=this.parent.rpcId,super.initializeCounterpart(e,t)}addChunk(e,t){super.addChunk(e,t)}getChunk(e){return new P(this,e)}};D=k([(0,C.R6)(f.vA)],D);let M=class extends m.PU{constructor(e,t,n){super(e,{}),this.parent=t,this.relationshipIndex=n,this.immediateChunkUpdates=!0}addChunk(e,t){super.addChunk(e,t)}getChunk(e){return new L(this,e)}};M=k([(0,C.R6)(f.ky)],M);class I extends m.AA{constructor(e,t){super(e),this.annotation=(0,p.aW)(t.annotation)}}let R=class extends m.PU{constructor(e,t){super(e),this.parent=t}getChunk(e){return new I(this,e)}addChunk(e,t){super.addChunk(e,t);const n=this.parent.references.get(e);void 0!==n&&(n.value=t.annotation,n.changed.dispatch())}deleteChunk(e){const t=this.parent.references.get(e);void 0!==t&&(t.value=void 0,t.changed.dispatch())}};function A(e,t,n,i){const r=new Uint8Array(e.data.length+i);for(const o of p.PB){if(o===n)continue;let s=e.typeToOffset[o],a=s;o>n&&(a+=i,e.typeToOffset[o]=a),r.set(e.data.subarray(s,s+e.typeToIds[o].length*t[o].serializedBytes),a)}return r}function O(e,t,n,i,r,o,s,a){const l=e.typeToOffset[n];let c=l,d=l;const u=t[n].propertyGroupBytes,h=u.length,p=e.typeToIds[n].length;for(let f=0;f<h;++f){const t=u[f];i.set(e.data.subarray(c+r*t,c+o*t),d+s*t),c+=t*p,d+=t*a}}function N(e,t,n){const i=t.type,r=n[i].rank,o=e.serializedAnnotations,s=o.typeToIds[i],a=o.typeToIdMaps[i],l=p.lc[i],c=n[i].serializedBytes;let d=a.get(t.id);if(void 0===d){d=a.size,a.set(t.id,d);const e=A(o,n,i,c);O(o,n,i,e,0,d,0,d+1),s.push(t.id),o.data=e}const u=o.typeToOffset[i],h=new DataView(o.data.buffer,o.data.byteOffset,o.data.byteLength),f=S.Hp===S.H$.LITTLE,g=n[i];l.serialize(h,u+g.propertyGroupBytes[0]*d,f,r,t),g.serialize(h,u,d,s.length,f,t.properties),e.bufferValid=!1}function _(e,t,n,i){const r=e.serializedAnnotations,o=r.typeToIdMaps[t],s=o.get(n);if(void 0===s)return!1;const a=r.typeToIds[t],l=A(r,i,t,-i[t].serializedBytes);O(r,i,t,l,0,s,0,a.length-1),O(r,i,t,l,s+1,a.length,s,a.length-1),a.splice(s,1),o.delete(n);for(let c=s,d=a.length;c<d;++c)o.set(a[c],c);return r.data=l,e.bufferValid=!1,!0}R=k([(0,C.R6)(f.Wv)],R);class V extends C.T6{constructor(e,t){super(),this.chunkManager=e,this.metadataChunkSource=this.registerDisposer(new R(this.chunkManager,this)),this.spatiallyIndexedSources=new(s()),this.temporary=function(){const e=[],t=[],n=[];for(const i of p.PB)e[i]=[],t[i]=0,n[i]=new(l());return new P(void 0,{data:new Uint8Array(0),numPickIds:0,typeToOffset:t,typeToIds:e,typeToIdMaps:n})}(),this.references=new(l()),this.localUpdates=new(l()),this.numCommitsInProgress=0,this.changed=new x.IY,this.referencesChanged=new x.HN,this.readonly=!1,this.childRefreshed=new x.IY,this.rank=t.rank,this.properties=t.properties,this.annotationPropertySerializers=(0,p.s7)(this.rank,this.properties);const n=this.segmentFilteredSources=[],i=t.relationships;this.relationships=i;for(let r=0,o=i.length;r<o;++r)n.push(this.registerDisposer(new M(e,this,r)))}hasNonSerializedProperties(){return this.relationships.length>0}getSources(e){throw new Error("not implemented")}initializeCounterpart(e,t){this.metadataChunkSource.initializeCounterpart(e,{});for(const n of this.segmentFilteredSources)n.initializeCounterpart(e,{});t.segmentFilteredSource=this.segmentFilteredSources.map((e=>e.addCounterpartRef())),t.metadataChunkSource=this.metadataChunkSource.addCounterpartRef(),t.chunkManager=this.chunkManager.rpcId,super.initializeCounterpart(e,t)}add(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.id=(0,p.vI)();const n=new p.D7(e.id);return n.value=e,this.references.set(n.id,n),this.referencesChanged.dispatch({action:"adding",id:n.id}),n.registerDisposer((()=>{this.references.delete(n.id),this.referencesChanged.dispatch({action:"deref",id:n.id})})),this.applyLocalUpdate(n,!1,t,e),n}applyLocalUpdate(e,t,n,i){const r=this.localUpdates,o=e.id;let s=this.localUpdates.get(o);const a=e.value;if(null==a)throw new Error("Cannot create local update from null annotation");if(void 0===s?(s={type:a.type,reference:e.addRef(),existingAnnotation:t?a:void 0,pendingCommit:void 0,commitInProgress:void 0},r.set(o,s),this.forEachPossibleChunk(a,(e=>{const t=e.data;if(void 0===t)return;_(t,a.type,o,this.annotationPropertySerializers)})),null!==i&&N(this.temporary.data,i,this.annotationPropertySerializers)):(null===i?_(this.temporary.data,a.type,a.id,this.annotationPropertySerializers):N(this.temporary.data,i,this.annotationPropertySerializers),e.value=i),n)if(void 0!==s.commitInProgress)s.pendingCommit=i;else{if(null===i&&void 0===s.existingAnnotation)return r.delete(o),void s.reference.dispose();this.sendCommitRequest(s,i)}this.notifyChanged(e.id,i||void 0)}sendCommitRequest(e,t){this.updateCommitsInProgress(1),e.commitInProgress=t,this.rpc.invoke(f.YN,{id:this.rpcId,annotationId:e.existingAnnotation&&e.reference.id,newAnnotation:t})}delete(e){this.applyLocalUpdate(e,!0,!0,null)}update(e,t){this.applyLocalUpdate(e,!0,!1,t)}notifyChanged(e,t){const n=this.references.get(e),i=this.metadataChunkSource.chunks.get(e);void 0!==i&&(i.annotation=t||null),void 0!==n&&(n.value=t||null,n.changed.dispatch(),this.referencesChanged.dispatch({action:"changed",id:e})),this.chunkManager.chunkQueueManager.visibleChunksChanged.dispatch()}commit(e){this.applyLocalUpdate(e,!0,!0,e.value)}updateReference(e){let t=this.references.get(e.id);if(void 0!==t)t.value=e;else{let t=new p.D7(e.id);this.references.set(e.id,t),t.value=e,this.referencesChanged.dispatch({action:"update",id:t.id}),t.registerDisposer((()=>{this.references.delete(t.id),this.referencesChanged.dispatch({action:"deref",id:t.id})}))}}hasReference(e){return this.references.has(e)}getReference(e){let t=this.references.get(e);if(void 0!==t)return t.addRef();t=new p.D7(e),this.references.set(e,t),this.referencesChanged.dispatch({action:"get",id:e}),this.rpc.invoke(f.g8,{id:this.rpcId,annotation:e}),t.registerDisposer((()=>{this.references.delete(e),this.referencesChanged.dispatch({action:"deref",id:e}),this.rpc.invoke(f.q8,{id:this.rpcId,annotation:e})}));const n=this.metadataChunkSource.chunks.get(e);return void 0!==n&&null!==n.annotation&&(t.value=n.annotation),t}forEachPossibleChunk(e,t){const n=e.relatedSegments;if(void 0!==n){const e=n.length,i=this.segmentFilteredSources;for(let r=0;r<e;++r){const e=n[r];if(void 0===e)return;const o=i[r];for(const n of e){const e=o.chunks.get((0,v.dH)(n));void 0!==e&&t(e)}}}const i=this.rank,r=new Float32Array(i),o=new Float32Array(i),s=new Float32Array(i);for(const a of this.spatiallyIndexedSources){switch(e.type){case p.UJ.POINT:w.vo(r,a.multiscaleToChunkTransform,i+1,e.point,i),o.set(r);break;case p.UJ.LINE:case p.UJ.SPHERE:case p.UJ.AXIS_ALIGNED_BOUNDING_BOX:w.vo(r,a.multiscaleToChunkTransform,i+1,e.pointA,i),w.vo(o,a.multiscaleToChunkTransform,i+1,e.pointB,i);break;case p.UJ.ELLIPSOID:w.vo(r,a.multiscaleToChunkTransform,i+1,e.center,i),w._U(o,a.multiscaleToChunkTransform,i+1,e.radii,i);for(let e=0;e<i;++e){const t=r[e],n=o[e];r[e]=t-n,o[e]=t+n}}let n=1;for(let e=0;e<i;++e){const t=r[e],i=o[e],s=Math.min(t,i),a=Math.max(t,i);r[e]=Math.ceil(s-1),o[e]=Math.floor(a+1),n*=o[e]-r[e]}const l=a.chunks;for(let e=0;e<n;++e){let n=e;for(let e=0;e<i;++e){const t=r[e],i=o[e]-t;n=(n-(s[e]=n%i))/i}const a=l.get(s.join());void 0!==a&&t(a)}}}static encodeOptions(e){return{}}handleSuccessfulUpdate(e,t){const n=this.localUpdates.get(e);if(void 0===n||void 0===n.commitInProgress)throw new Error("Received invalid successful update notification");if(this.updateCommitsInProgress(-1),null!==t&&n.reference.id!==t.id){if(null===n.commitInProgress)throw new Error("Received invalid successful update notification");n.reference.id=t.id,this.references.delete(e),this.references.set(t.id,n.reference.addRef()),this.localUpdates.delete(e),this.localUpdates.set(t.id,n),null!==n.reference.value&&(n.reference.value.id=t.id,_(this.temporary.data,n.type,e,this.annotationPropertySerializers),N(this.temporary.data,n.reference.value,this.annotationPropertySerializers)),n.reference.changed.dispatch()}let i=void 0===n.existingAnnotation;n.existingAnnotation=t||void 0,n.commitInProgress=void 0;let r=n.pendingCommit;n.pendingCommit=void 0,null===t&&(r=void 0),void 0!==r?(null!==r&&(r.id=t.id),this.sendCommitRequest(n,r)):(this.revertLocalUpdate(n),i?(this.childAdded.dispatch(t),this.referencesChanged.dispatch({action:"added",id:t.id})):null===t?(this.references.get(e).dispose(),this.childDeleted.dispatch(e),this.referencesChanged.dispatch({action:"deleted",id:e})):(this.childUpdated.dispatch(t),this.referencesChanged.dispatch({action:"updated",id:t.id})))}disposed(){const e=this.commitStatus;void 0!==e&&e.dispose()}updateCommitsInProgress(e){if(this.numCommitsInProgress+=e,0===this.numCommitsInProgress)void 0!==this.commitStatus&&(this.commitStatus.dispose(),this.commitStatus=void 0);else if(void 0===this.commitStatus){(this.commitStatus=new b.M(!0)).setText("Commiting annotations")}}handleFailedUpdate(e,t){const n=this.localUpdates.get(e);if(void 0===n||void 0===n.commitInProgress)throw new Error("Received invalid update notification");(new b.M).setErrorMessage("Error commiting annotation update: ".concat(t)),this.revertLocalUpdate(n),this.updateCommitsInProgress(-1)}revertLocalUpdate(e){_(this.temporary.data,e.type,e.reference.id,this.annotationPropertySerializers);const t=e.existingAnnotation;void 0!==t&&this.forEachPossibleChunk(t,(e=>{const n=e.data;void 0!==n&&N(n,t,this.annotationPropertySerializers)}));const n=e.reference,i=n.id;n.value=t||null,n.changed.dispatch(),n.dispose(),this.localUpdates.delete(i)}*[r()](){}}(0,C.ks)(f.qW,(function(e){const t=this.get(e.id),n=e.annotationId,i=e.error;if(void 0!==i)t.handleFailedUpdate(n,i);else{const i=(0,p.aW)(e.newAnnotation);t.handleSuccessfulUpdate(n,i)}}))},1767:(e,t,n)=>{n.d(t,{D7:()=>C,OS:()=>q,PB:()=>E,RB:()=>W,Sl:()=>K,UJ:()=>k,Y9:()=>I,aU:()=>B,aW:()=>Z,ef:()=>P,lc:()=>G,nx:()=>D,oL:()=>X,oh:()=>V,s7:()=>M,vI:()=>J,vd:()=>H,zC:()=>R});var i=n(281),r=n.n(i),o=n(608),s=n.n(o),a=n(974),l=n.n(a),c=n(1274),d=n.n(c),u=n(984),h=n.n(u),p=n(9735),f=n(2303),g=n(9043),m=n(7562),v=n(1783),y=n(7970),b=n(679),S=n(4035),w=n(6344),x=n(8194);class C extends m.O8{constructor(e){super(),this.id=e,this.changed=new w.IY}addRef(){return super.addRef()}dispose(){super.dispose()}}var k;!function(e){e[e.POINT=0]="POINT",e[e.LINE=1]="LINE",e[e.AXIS_ALIGNED_BOUNDING_BOX=2]="AXIS_ALIGNED_BOUNDING_BOX",e[e.ELLIPSOID=3]="ELLIPSOID",e[e.SPHERE=4]="SPHERE"}(k||(k={}));const E=[k.POINT,k.LINE,k.AXIS_ALIGNED_BOUNDING_BOX,k.ELLIPSOID,k.SPHERE],T={rgb:{serializedBytes:()=>3,alignment:()=>1,serializeCode:(e,t)=>"dv.setUint16(".concat(t,", ").concat(e,", true);")+"dv.setUint8(".concat(t," + 2, ").concat(e," >>> 16);"),deserializeCode:(e,t)=>"".concat(e," = dv.getUint16(").concat(t,", true) | (dv.getUint8(").concat(t," + 2) << 16);"),deserializeJson:e=>(0,f.packColor)((0,f.parseRGBColorSpecification)(e)),serializeJson:e=>(0,f.serializeColor)((0,f.unpackRGB)(e))},rgba:{serializedBytes:()=>4,alignment:()=>1,serializeCode:(e,t)=>"dv.setUint32(".concat(t,", ").concat(e,", true);"),deserializeCode:(e,t)=>"".concat(e," = dv.getUint32(").concat(t,", true);"),deserializeJson:e=>(0,f.packColor)((0,f.parseRGBAColorSpecification)(e)),serializeJson:e=>(0,f.serializeColor)((0,f.unpackRGBA)(e))},float32:{serializedBytes:()=>4,alignment:()=>4,serializeCode:(e,t)=>"dv.setFloat32(".concat(t,", ").concat(e,", isLittleEndian);"),deserializeCode:(e,t)=>"".concat(e," = dv.getFloat32(").concat(t,", isLittleEndian);"),deserializeJson:e=>(0,y.verifyFloat)(e),serializeJson:e=>e},uint32:{serializedBytes:()=>4,alignment:()=>4,serializeCode:(e,t)=>"dv.setUint32(".concat(t,", ").concat(e,", isLittleEndian);"),deserializeCode:(e,t)=>"".concat(e," = dv.getUint32(").concat(t,", isLittleEndian);"),deserializeJson:e=>(0,y.verifyInt)(e),serializeJson:e=>e},int32:{serializedBytes:()=>4,alignment:()=>4,serializeCode:(e,t)=>"dv.setInt32(".concat(t,", ").concat(e,", isLittleEndian);"),deserializeCode:(e,t)=>"".concat(e," = dv.getInt32(").concat(t,", isLittleEndian);"),deserializeJson:e=>(0,y.verifyInt)(e),serializeJson:e=>e},uint16:{serializedBytes:()=>2,alignment:()=>2,serializeCode:(e,t)=>"dv.setUint16(".concat(t,", ").concat(e,", isLittleEndian);"),deserializeCode:(e,t)=>"".concat(e," = dv.getUint16(").concat(t,", isLittleEndian);"),deserializeJson:e=>(0,y.verifyInt)(e),serializeJson:e=>e},int16:{serializedBytes:()=>2,alignment:()=>2,serializeCode:(e,t)=>"dv.setInt16(".concat(t,", ").concat(e,", isLittleEndian);"),deserializeCode:(e,t)=>"".concat(e," = dv.getInt16(").concat(t,", isLittleEndian);"),deserializeJson:e=>(0,y.verifyInt)(e),serializeJson:e=>e},uint8:{serializedBytes:()=>1,alignment:()=>1,serializeCode:(e,t)=>"dv.setUint8(".concat(t,", ").concat(e,");"),deserializeCode:(e,t)=>"".concat(e," = dv.getUint8(").concat(t,");"),deserializeJson:e=>(0,y.verifyInt)(e),serializeJson:e=>e},int8:{serializedBytes:()=>2,alignment:()=>1,serializeCode:(e,t)=>"dv.setInt8(".concat(t,", ").concat(e,");"),deserializeCode:(e,t)=>"".concat(e," = dv.getInt8(").concat(t,");"),deserializeJson:e=>(0,y.verifyInt)(e),serializeJson:e=>e}},L=255;function P(e,t,n){let i=0;const r=n.length,o=new Array(r),s=[];for(let h=0;h<r;++h)o[h]=h;const a=t=>T[n[t].type].alignment(e);o.sort(((e,t)=>a(t)-a(e)));let l=0;const c=new Array(r);let d=t;const u=()=>{d+=(4-d%4)%4,i+=d,s[l]=d,d=0,++l};for(let h=0;h<r;++h){const t=o[h],i=n[t],r=T[i.type],s=r.serializedBytes(e),a=r.alignment(e),p=(a-d%a)%a,f=d+p+s;f+(4-f%4)%4<=L?d+=p:u(),c[t]={offset:d,group:l},d+=s}return u(),{serializedBytes:i,offsets:c,propertyGroupBytes:s}}class D{constructor(e,t,n){if(this.rank=e,this.firstGroupInitialOffset=t,this.propertySpecs=n,0===n.length)return this.serializedBytes=t,this.serialize=this.deserialize=()=>{},void(this.propertyGroupBytes=[t]);var i=P(e,t,n);const r=i.serializedBytes,o=i.offsets,s=i.propertyGroupBytes;this.propertyGroupBytes=s;let a="let groupOffset0 = offset;";for(let h=1;h<s.length;++h)a+="let groupOffset".concat(h," = groupOffset").concat(h-1," + ").concat(s[h-1],"*annotationCount;");for(let h=0;h<s.length;++h)a+="groupOffset".concat(h," += ").concat(s[h],"*annotationIndex;");let l=a,c=a;const d=n.length;for(let h=0;h<d;++h){var u=o[h];const t=u.group,i=u.offset,r=n[h],s=T[r.type],a="properties[".concat(h,"]"),d="groupOffset".concat(t," + ").concat(i);l+=s.serializeCode(a,d,e),c+=s.deserializeCode(a,d,e)}this.serializedBytes=r,this.serialize=new Function("dv","offset","annotationIndex","annotationCount","isLittleEndian","properties",l),this.deserialize=new Function("dv","offset","annotationIndex","annotationCount","isLittleEndian","properties",c)}}function M(e,t){const n=[];for(const i of E){const r=G[i];n[i]=new D(e,r.serializedBytes(e),t)}return n}function I(e,t){const n="float32"===e.type?t.toPrecision(6):t.toString(),i=e.enumValues,r=e.enumLabels;if(void 0!==i){const e=i.indexOf(t);if(-1!==e)return"".concat(r[e]," (").concat(n,")")}return n}function R(e,t){switch(e.type){case"rgb":return(0,f.serializeColor)((0,f.unpackRGB)(t));case"rgba":return(0,f.serializeColor)((0,f.unpackRGBA)(t));default:return I(e,t)}}function A(e){const t=(0,y.verifyString)(e);if(null===t.match(/^[a-z][a-zA-Z0-9_]*$/))throw new Error("Invalid property identifier: ".concat(h()(e)));return t}function O(e){if((0,y.verifyString)(e),!Object.prototype.hasOwnProperty.call(T,e))throw new Error("Unsupported property type: $JSON.stringify(obj)}");return e}function N(e){(0,y.verifyObject)(e);const t=(0,y.verifyObjectProperty)(e,"id",A),n=(0,y.verifyObjectProperty)(e,"type",O),i=(0,y.verifyOptionalObjectProperty)(e,"description",y.verifyString);let r,o,s=(0,y.verifyOptionalObjectProperty)(e,"default",(e=>T[n].deserializeJson(e)),0);switch(n){case"rgb":case"rgba":break;default:{const t=g.pe[n.toUpperCase()];r=(0,y.verifyOptionalObjectProperty)(e,"enum_values",(e=>(0,y.parseArray)(e,(e=>(0,b.DZ)(t,e))))),void 0!==r&&(o=(0,y.verifyObjectProperty)(e,"enum_labels",(e=>(0,y.parseFixedLengthArray)(new Array(r.length),e,y.verifyString))))}}return{type:n,identifier:t,description:i,default:s,enumValues:r,enumLabels:o}}function _(e){const t=e.default;return{id:e.identifier,description:e.description,type:e.type,default:0===t?void 0:T[e.type].serializeJson(t)}}function V(e){if(void 0!==e&&0!==e.length)return e.map(_)}function B(e){if(void 0===e)return[];const t=(0,y.parseArray)(e,N);return function(e){const t=new(d());for(const n of e){if(t.has(n.identifier))throw new Error("Duplicate property identifier: ".concat(n.identifier));t.add(n.identifier)}}(t),t}function F(e,t,n,i,r){for(let o=0;o<i;++o)e.setFloat32(t,r[o],n),t+=4;return t}function U(e,t,n,i,r,o){return t=F(e,t,n,i,r),t=F(e,t,n,i,o)}function z(e,t,n,i,r){for(let o=0;o<i;++o)r[o]=e.getFloat32(t,n),t+=4;return t}function j(e,t,n,i,r,o){return t=z(e,t,n,i,r),t=z(e,t,n,i,o)}const G={[k.LINE]:{icon:"\ua579",description:"Line",toJSON:e=>({pointA:l()(e.pointA),pointB:l()(e.pointB)}),restoreState(e,t,n){e.pointA=(0,y.verifyObjectProperty)(t,"pointA",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteFloat))),e.pointB=(0,y.verifyObjectProperty)(t,"pointB",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteFloat)))},serializedBytes:e=>8*e,serialize(e,t,n,i,r){U(e,t,n,i,r.pointA,r.pointB)},deserialize:(e,t,n,i,r)=>{const o=new Float32Array(i),s=new Float32Array(i);return j(e,t,n,i,o,s),{type:k.LINE,pointA:o,pointB:s,id:r,properties:[]}},visitGeometry(e,t){t(e.pointA,!1),t(e.pointB,!1)}},[k.SPHERE]:{icon:"\u2296",description:"Sphere",toJSON:e=>({pointA:l()(e.pointA),pointB:l()(e.pointB)}),restoreState(e,t,n){e.pointA=(0,y.verifyObjectProperty)(t,"pointA",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteFloat))),e.pointB=(0,y.verifyObjectProperty)(t,"pointB",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteFloat)))},serializedBytes:e=>8*e,serialize(e,t,n,i,r){U(e,t,n,i,r.pointA,r.pointB)},deserialize:(e,t,n,i,r)=>{const o=new Float32Array(i),s=new Float32Array(i);return j(e,t,n,i,o,s),{type:k.SPHERE,pointA:o,pointB:s,id:r,properties:[]}},visitGeometry(e,t){t(e.pointA,!1),t(e.pointB,!1)}},[k.POINT]:{icon:"\u26ac",description:"Point",toJSON:e=>({point:l()(e.point)}),restoreState:(e,t,n)=>{e.point=(0,y.verifyObjectProperty)(t,"point",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteFloat)))},serializedBytes:e=>4*e,serialize:(e,t,n,i,r)=>{F(e,t,n,i,r.point)},deserialize:(e,t,n,i,r)=>{const o=new Float32Array(i);return z(e,t,n,i,o),{type:k.POINT,point:o,id:r,properties:[]}},visitGeometry(e,t){t(e.point,!1)}},[k.AXIS_ALIGNED_BOUNDING_BOX]:{icon:"\u2751",description:"Bounding Box",toJSON:e=>({pointA:l()(e.pointA),pointB:l()(e.pointB)}),restoreState:(e,t,n)=>{e.pointA=(0,y.verifyObjectProperty)(t,"pointA",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteFloat))),e.pointB=(0,y.verifyObjectProperty)(t,"pointB",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteFloat)))},serializedBytes:e=>8*e,serialize(e,t,n,i,r){U(e,t,n,i,r.pointA,r.pointB)},deserialize:(e,t,n,i,r)=>{const o=new Float32Array(i),s=new Float32Array(i);return j(e,t,n,i,o,s),{type:k.AXIS_ALIGNED_BOUNDING_BOX,pointA:o,pointB:s,id:r,properties:[]}},visitGeometry(e,t){t(e.pointA,!1),t(e.pointB,!1)}},[k.ELLIPSOID]:{icon:"\u25ce",description:"Ellipsoid",toJSON:e=>({center:l()(e.center),radii:l()(e.radii)}),restoreState:(e,t,n)=>{e.center=(0,y.verifyObjectProperty)(t,"center",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteFloat))),e.radii=(0,y.verifyObjectProperty)(t,"radii",(e=>(0,y.parseFixedLengthArray)(new Float32Array(n),e,y.verifyFiniteNonNegativeFloat)))},serializedBytes:e=>8*e,serialize(e,t,n,i,r){U(e,t,n,i,r.center,r.radii)},deserialize:(e,t,n,i,r)=>{const o=new Float32Array(i),s=new Float32Array(i);return j(e,t,n,i,o,s),{type:k.ELLIPSOID,center:o,radii:s,id:r,properties:[]}},visitGeometry(e,t){t(e.center,!1),t(e.radii,!0)}}};function W(e,t){const n=G[e.type].toJSON(e,t.rank);n.type=k[e.type].toLowerCase(),n.id=e.id,n.description=e.description||void 0;const i=e.relatedSegments;if(void 0!==i&&i.some((e=>0!==e.length))&&(n.segments=i.map((e=>e.map((e=>e.toString()))))),0!==t.properties.length){const i=t.properties;n.props=e.properties.map(((e,t)=>T[i[t].type].serializeJson(e)))}return n}class H extends m.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];super(),this.relationships=t,this.properties=n,this.annotationMap=new(s()),this.changed=new w.IY,this.readonly=!1,this.childAdded=new w.HN,this.childUpdated=new w.HN,this.childDeleted=new w.HN,this.childRefreshed=new w.IY,this.pending=new(d()),this.references=new(s()),this.rank_=e,this.annotationPropertySerializers=M(e,n)}get rank(){return this.rank_}hasNonSerializedProperties(){return!0}add(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.ensureUpdated(),e.id){if(this.annotationMap.has(e.id))throw new Error("Annotation id already exists: ".concat(h()(e.id),"."))}else e.id=J();return this.annotationMap.set(e.id,e),this.changed.dispatch(),this.childAdded.dispatch(e),t||this.pending.add(e.id),this.getReference(e.id)}commit(e){this.ensureUpdated();const t=e.id;this.pending.delete(t),this.changed.dispatch()}update(e,t){if(this.ensureUpdated(),null===e.value)throw new Error("Annotation already deleted.");e.value=t,this.annotationMap.set(t.id,t),e.changed.dispatch(),this.changed.dispatch(),this.childUpdated.dispatch(t)}[r()](){return this.ensureUpdated(),this.annotationMap.values()}get(e){return this.ensureUpdated(),this.annotationMap.get(e)}delete(e){null!==e.value&&(e.value=null,this.annotationMap.delete(e.id),this.pending.delete(e.id),e.changed.dispatch(),this.changed.dispatch(),this.childDeleted.dispatch(e.id))}getReference(e){let t=this.references.get(e);return void 0!==t?t.addRef():(t=new C(e),t.value=this.annotationMap.get(e)||null,this.references.set(e,t),t.registerDisposer((()=>{this.references.delete(e)})),t)}ensureUpdated(){}toJSON(){this.ensureUpdated();const e=[],t=this.pending;for(const n of this)t.has(n.id)||e.push(W(n,this));return e}clear(){this.annotationMap.clear(),this.pending.clear(),this.changed.dispatch()}restoreState(e){this.ensureUpdated();const t=this.annotationMap;t.clear(),this.pending.clear(),void 0!==e&&(0,y.parseArray)(e,(e=>{const n=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,y.verifyObject)(e);const i=(0,y.verifyObjectProperty)(e,"type",(e=>(0,y.verifyEnumString)(e,k))),r=(0,y.verifyObjectProperty)(e,"id",n?y.verifyOptionalString:y.verifyString)||J(),o=(0,y.verifyObjectProperty)(e,"segments",(e=>{if(void 0===e)return t.relationships.map((()=>[]));const n=(0,y.expectArray)(e);return 0===n.length?t.relationships.map((()=>[])):1!==t.relationships.length||Array.isArray(n[0])?(0,y.parseArray)((0,y.expectArray)(e,t.relationships.length),(e=>(0,y.parseArray)(e,(e=>x.Uint64.parseString(e))))):[(0,y.parseArray)(n,(e=>x.Uint64.parseString(e)))]})),s=(0,y.verifyObjectProperty)(e,"props",(e=>{const n=t.properties;return void 0===e?n.map((e=>e.default)):(0,y.parseArray)((0,y.expectArray)(e,t.properties.length),((e,t)=>T[n[t].type].deserializeJson(e)))})),a={id:r,description:(0,y.verifyObjectProperty)(e,"description",y.verifyOptionalString),relatedSegments:o,properties:s,type:i};return G[i].restoreState(a,e,t.rank),a}(e,this);t.set(n.id,n)}));for(const n of this.references.values()){const e=n.id,i=t.get(e);n.value=i||null,n.changed.dispatch()}this.changed.dispatch()}reset(){this.clear()}}class q extends H{constructor(e,t,n){super(e.value.sourceRank,n,t),this.watchableTransform=e,this.curCoordinateTransform=e.value,this.registerDisposer(e.changed.add((()=>this.ensureUpdated())))}get rank(){return this.ensureUpdated(),this.rank_}ensureUpdated(){const e=this.watchableTransform.value,t=this.curCoordinateTransform;if(e===t)return;this.curCoordinateTransform=e;const n=e.sourceRank,i=t.sourceRank;if(i===n&&(t.inputSpace===e.inputSpace||(0,p.r1)(t.inputSpace.ids.slice(0,n),e.inputSpace.ids.slice(0,n))))return;const r=e.inputSpace.ids,o=t.inputSpace.ids,s=[];for(let l=0;l<n;++l){let e=o.indexOf(r[l]);e>=i&&(e=-1),s.push(e)}const a=e=>{const t=new Float32Array(n);for(let i=0;i<n;++i){const n=s[i];t[i]=-1===n?0:e[i]}return t};for(const l of this.annotationMap.values())switch(l.type){case k.POINT:l.point=a(l.point);break;case k.LINE:case k.SPHERE:case k.AXIS_ALIGNED_BOUNDING_BOX:l.pointA=a(l.pointA),l.pointB=a(l.pointB);break;case k.ELLIPSOID:l.center=a(l.center),l.radii=a(l.radii)}this.rank_!==n&&(this.rank_=n,this.annotationPropertySerializers=M(this.rank_,this.properties)),this.changed.dispatch()}}const Y="Data Bounds";function J(){return(0,S.Yr)(160)}function K(e){const t=new H(e.lowerBounds.length);return t.readonly=!0,t.add(function(e){return{type:k.AXIS_ALIGNED_BOUNDING_BOX,id:"data-bounds",description:Y,pointA:new Float32Array(e.lowerBounds),pointB:new Float32Array(e.upperBounds),properties:[]}}(e)),t}class X{constructor(e){this.propertySerializers=e,this.annotations=[[],[],[],[],[]]}add(e){this.annotations[e.type].push(e)}serialize(){return function(e,t){let n=0;const i=[];for(const s of E){const r=t[s].serializedBytes;i[s]=n,n+=r*e[s].length}const r=[],o=[],a=new ArrayBuffer(n),l=new DataView(a),c=v.Hp===v.H$.LITTLE;for(const d of E){const n=t[d],a=n.rank,u=n.serialize,h=e[d];r[d]=h.map((e=>e.id)),o[d]=new(s())(h.map(((e,t)=>[e.id,t])));const p=G[d].serialize,f=i[d],g=n.propertyGroupBytes[0];for(let e=0,t=h.length;e<t;++e){const n=h[e];p(l,f+e*g,c,a,n),u(l,f,e,t,c,n.properties)}}return{data:new Uint8Array(a),typeToIds:r,typeToOffset:i,typeToIdMaps:o}}(this.annotations,this.propertySerializers)}}function Z(e){if(null==e)return e;const t=e.relatedSegments;if(void 0!==t)for(let n=0,i=t.length;n<i;++n){const e=t[n];void 0!==e&&(t[n]=e.map((e=>new x.Uint64(e.low,e.high))))}return e}},2108:(e,t,n)=>{n.d(t,{Ag:()=>y,rK:()=>v,sP:()=>g});var i=n(608),r=n.n(i),o=n(2982),s=n(1767),a=n(7562),l=n(251),c=n(9080),d=n(4011);function u(e,t){return{defineShader(n,i){const r="prop_".concat(i),o="a_".concat(r);n.addAttribute("".concat(e),o),n.addVertexCode("".concat(e," ").concat(r,"() { return ").concat(o,"; }")),n.addInitializer((e=>{const n=e.attribute(o),i=e.gl;e.vertexShaderInputBinders[r]=-1===n?{enable(){},disable(){},bind(){}}:{enable(e){i.enableVertexAttribArray(n),i.vertexAttribDivisor(n,e)},disable(){i.vertexAttribDivisor(n,0),i.disableVertexAttribArray(n)},bind(e,r){t(i,n,e,r)}}}))}}}function h(e,t,n,i){return u(e,((e,r,o,s)=>{e.vertexAttribPointer(r,t,n,i,o,s)}))}function p(e,t,n){return u(e,((e,i,r,o)=>{e.vertexAttribIPointer(i,t,n,r,o)}))}const f={rgb:h("highp vec3",3,WebGL2RenderingContext.UNSIGNED_BYTE,!0),rgba:h("highp vec4",4,WebGL2RenderingContext.UNSIGNED_BYTE,!0),float32:h("highp float",1,WebGL2RenderingContext.FLOAT,!1),uint32:p("highp uint",1,WebGL2RenderingContext.UNSIGNED_INT),int32:p("highp int",1,WebGL2RenderingContext.INT),uint16:p("highp uint",1,WebGL2RenderingContext.UNSIGNED_SHORT),int16:p("highp int",1,WebGL2RenderingContext.SHORT),uint8:p("highp uint",1,WebGL2RenderingContext.UNSIGNED_BYTE),int8:p("highp int",1,WebGL2RenderingContext.BYTE)};class g extends a.O8{constructor(e,t,n,i,r,o,a){super(),this.gl=e,this.annotationType=t,this.rank=n,this.properties=i,this.shaderControlState=r,this.fallbackShaderParameters=o,this.shaderError=a;const l=this.serializedGeometryBytesPerAnnotation=s.lc[t].serializedBytes(n);var c=(0,s.ef)(n,l,i);const d=c.offsets,u=c.serializedBytes,h=c.propertyGroupBytes;this.serializedBytesPerAnnotation=u,this.propertyOffsets=d,this.propertyGroupBytes=h,this.geometryDataStride=h[0]}getDependentShader(e,t){return(0,c.P9)(this,this.gl,{memoizeKey:{t:"annotation",targetIsSliceView:this.targetIsSliceView,type:this.annotationType,subType:e,properties:this.properties,rank:this.rank},fallbackParameters:this.fallbackShaderParameters,parameters:this.shaderControlState.builderState,shaderError:this.shaderError,defineShader:(e,n)=>{const i=this.rank,r=this.properties,s=[],a=n.parseResult.code;for(let t=0,o=r.length;t<o;++t){const n=r[t],o="prop_".concat(n.identifier);if(!a.match(new RegExp("\\b".concat(o,"\\b"))))continue;s.push(t);f[n.type].defineShader(e,n.identifier,i)}const u=this.propertyOffsets,h=this.propertyGroupBytes,p=new Array(h.length);p[0]=0;for(let t=1;t<h.length;++t)p[t]=p[t-1]+h[t-1];e.addInitializer((e=>{const t=s.map((t=>e.vertexShaderInputBinders["prop_".concat(r[t].identifier)])),n=t.length;e.vertexShaderInputBinders.properties={enable(e){for(let i=0;i<n;++i)t[i].enable(e)},bind(e,i){for(let o=0;o<n;++o){var r=u[s[o]];let n=r.group,a=r.offset;t[o].bind(h[n],i+a+p[n]*e)}},disable(){for(let e=0;e<n;++e)t[e].disable()}}})),e.addUniform("highp vec3","uColor"),e.addUniform("highp uint","uSelectedIndex"),e.addVarying("highp vec4","vColor"),e.addUniform("highp vec3","uSubspaceMatrix",i),e.addUniform("highp mat4","uModelViewProjection"),e.addUniform("highp float","uModelClipBounds",2*i),e.addUniform("highp uint","uPickID"),e.addVarying("highp uint","vPickID","flat"),e.addVertexCode(l.o),e.addVertexCode("\nvec3 defaultColor() { return uColor; }\nhighp uint getPickBaseOffset() { return uint(gl_InstanceID) * ".concat(this.pickIdsPerInstance,"u; }\n")),e.addFragmentCode("\nvoid emitAnnotation(vec4 color) {\n  emit(color, vPickID);\n}\n");const g="\nfloat getSubspaceClipCoefficient(float modelPoint[".concat(this.rank,"]) {\n  float coefficient = 1.0;\n  for (int i = 0; i < ").concat(i,"; ++i) {\n    float d = abs(modelPoint[i] - uModelClipBounds[i]) * uModelClipBounds[").concat(i," + i];\n    coefficient *= max(0.0, 1.0 - d);\n  }\n  return coefficient;\n}\n");e.addVertexCode(g),e.addFragmentCode(g),e.addVertexCode("\nvec3 projectModelVectorToSubspace(float modelPoint[".concat(this.rank,"]) {\n  vec3 result = vec3(0.0, 0.0, 0.0);\n  for (int i = 0; i < ").concat(i,"; ++i) {\n    result += uSubspaceMatrix[i] * modelPoint[i];\n  }\n  return result;\n}\n\nfloat getMaxEndpointSubspaceClipCoefficient(float modelPointA[").concat(this.rank,"],  float modelPointB[").concat(this.rank,"]) {\n  float coefficient = 1.0;\n  for (int i = 0; i < ").concat(i,"; ++i) {\n    float dA = abs(modelPointA[i] - uModelClipBounds[i]) * uModelClipBounds[").concat(i," + i];\n    float dB = abs(modelPointB[i] - uModelClipBounds[i]) * uModelClipBounds[").concat(i," + i];\n    coefficient *= max(0.0, 1.0 - min(dA, dB));\n  }\n  return coefficient;\n}\n\nfloat getMaxSubspaceClipCoefficient(float modelPointA[").concat(this.rank,"],  float modelPointB[").concat(this.rank,"]) {\n  float coefficient = 1.0;\n  for (int i = 0; i < ").concat(i,"; ++i) {\n    float a = modelPointA[i];\n    float b = modelPointB[i];\n    float c = uModelClipBounds[i];\n    float x = clamp(c, min(a, b), max(a, b));\n    float d = abs(x - c) * uModelClipBounds[").concat(i," + i];\n    coefficient *= max(0.0, 1.0 - d);\n  }\n  return coefficient;\n}\n\n")),(0,d.kk)(n,e),e.addVertexCode("\nconst bool PROJECTION_VIEW = ".concat(!this.targetIsSliceView,";\nbool ng_discardValue;\n#define discard ng_discard()\nvoid ng_discard() {\n  ng_discardValue = true;\n}\nvoid setLineColor(vec4 startColor, vec4 endColor);\nvoid setLineWidth(float width);\n\nvoid setAxisColor(vec4 startColor, vec4 endColor);\nvoid setAxisWidth(float width);\nvoid setSphereColor(vec4 color);\n\nvoid setEndpointMarkerColor(vec4 startColor, vec4 endColor);\nvoid setEndpointMarkerBorderColor(vec4 startColor, vec4 endColor);\nvoid setEndpointMarkerSize(float startSize, float endSize);\nvoid setEndpointMarkerBorderWidth(float startSize, float endSize);\n\nvoid setPointMarkerColor(vec4 color);\nvoid setPointMarkerBorderColor(vec4 color);\nvoid setPointMarkerSize(float size);\nvoid setPointMarkerBorderWidth(float size);\nvoid setPointMarkerBorderColor(vec3 color) { setPointMarkerBorderColor(vec4(color, 1.0)); }\n\nvoid setAxisEndpointMarkerColor(vec4 startColor, vec4 endColor);\nvoid setAxisEndpointMarkerBorderColor(vec4 startColor, vec4 endColor);\nvoid setAxisEndpointMarkerSize(float startSize, float endSize);\nvoid setAxisEndpointMarkerBorderWidth(float startSize, float endSize);\n\nvoid setAxisPointMarkerColor(vec4 color);\nvoid setAxisPointMarkerBorderColor(vec4 color);\nvoid setAxisPointMarkerSize(float size);\nvoid setAxisPointMarkerBorderWidth(float size);\n\nvoid setEllipsoidFillColor(vec4 color);\n\nvoid setBoundingBoxBorderColor(vec4 color);\nvoid setBoundingBoxBorderWidth(float size);\nvoid setBoundingBoxFillColor(vec4 color);\n\nvoid setEndpointMarkerColor(vec3 startColor, vec3 endColor) {\n  setEndpointMarkerColor(vec4(startColor, 1.0), vec4(endColor, 1.0));\n}\nvoid setEndpointMarkerBorderColor(vec3 startColor, vec3 endColor) {\n  setEndpointMarkerBorderColor(vec4(startColor, 1.0), vec4(endColor, 1.0));\n}\nvoid setEndpointMarkerColor(vec3 color) { setEndpointMarkerColor(color, color); }\nvoid setEndpointMarkerColor(vec4 color) { setEndpointMarkerColor(color, color); }\nvoid setEndpointMarkerBorderColor(vec3 color) { setEndpointMarkerBorderColor(color, color); }\nvoid setEndpointMarkerBorderColor(vec4 color) { setEndpointMarkerBorderColor(color, color); }\nvoid setEndpointMarkerSize(float size) { setEndpointMarkerSize(size, size); }\nvoid setEndpointMarkerBorderWidth(float size) { setEndpointMarkerBorderWidth(size, size); }\nvoid setLineColor(vec4 color) { setLineColor(color, color); }\nvoid setLineColor(vec3 color) { setLineColor(vec4(color, 1.0)); }\nvoid setLineColor(vec3 startColor, vec3 endColor) { setLineColor(vec4(startColor, 1.0), vec4(endColor, 1.0)); }\nvoid setAxisColor(vec4 color) { setAxisColor(color, color); }\nvoid setAxisColor(vec3 color) { setAxisColor(vec4(color, 1.0)); }\nvoid setAxisColor(vec3 startColor, vec3 endColor) { setAxisColor(vec4(startColor, 1.0), vec4(endColor, 1.0)); }\nvoid setAxisEndpointMarkerColor(vec3 startColor, vec3 endColor) {\n  setAxisEndpointMarkerColor(vec4(startColor, 1.0), vec4(endColor, 1.0));\n}\nvoid setAxisEndpointMarkerBorderColor(vec3 startColor, vec3 endColor) {\n  setAxisEndpointMarkerBorderColor(vec4(startColor, 1.0), vec4(endColor, 1.0));\n}\nvoid setAxisEndpointMarkerColor(vec3 color) { setAxisEndpointMarkerColor(color, color); }\nvoid setAxisEndpointMarkerColor(vec4 color) { setAxisEndpointMarkerColor(color, color); }\nvoid setAxisEndpointMarkerBorderColor(vec3 color) { setAxisEndpointMarkerBorderColor(color, color); }\nvoid setAxisEndpointMarkerBorderColor(vec4 color) { setAxisEndpointMarkerBorderColor(color, color); }\nvoid setAxisEndpointMarkerSize(float size) { setAxisEndpointMarkerSize(size, size); }\nvoid setAxisEndpointMarkerBorderWidth(float size) { setAxisEndpointMarkerBorderWidth(size, size); }\nvoid setColor(vec4 color) {\n  setPointMarkerColor(color);\n  setLineColor(color);\n  setEndpointMarkerColor(color);\n  setBoundingBoxBorderColor(color);\n  setEllipsoidFillColor(vec4(color.rgb, color.a * (PROJECTION_VIEW ? 1.0 : 0.5)));\n  setAxisColor(color);\n  setAxisEndpointMarkerColor(color);\n  setSphereColor(color);\n}\nvoid setEllipsoidFillColor(vec3 color) { setEllipsoidFillColor(vec4(color, 1.0)); }\n\nvoid setBoundingBoxFillColor(vec3 color) { setBoundingBoxFillColor(vec4(color, 1.0)); }\nvoid setBoundingBoxBorderColor(vec3 color) { setBoundingBoxBorderColor(vec4(color, 1.0)); }\n\nvoid setColor(vec3 color) { setColor(vec4(color, 1.0)); }\nvoid userMain();\n"));for(const t of m){var v=(0,o.A)(t,2);const n=v[0],i=v[1];n!==this.annotationType&&i.defineShaderNoOpSetters(e)}t(e),e.addVertexCode("\n#define main userMain\n"+(0,c.qK)(n.parseResult.code)+"\n#undef main\n")}})}setPartIndex(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];let r="\nvoid setPartIndex(".concat(n.map(((e,t)=>"highp uint partIndex".concat(t))).join(),") {\n  highp uint pickID = uPickID;\n  highp uint pickBaseOffset = getPickBaseOffset();\n").concat(n.map(((e,t)=>"highp uint pickOffset".concat(t," = pickBaseOffset + partIndex").concat(t,";"))).join("\n"),"\n");return 0===n.length&&(r+="\n  highp uint pickOffset0 = pickBaseOffset;\n"),r+="\n  vPickID = pickID + pickOffset0;\n  highp uint selectedIndex = uSelectedIndex;\nif (selectedIndex == pickBaseOffset".concat(n.map(((e,t)=>" || selectedIndex == pickOffset".concat(t))).join(""),") {\n    vColor = vec4(mix(vColor.rgb, vec3(1.0, 1.0, 1.0), 0.75), vColor.a);\n  }\n}\n"),e.addVertexCode(r),"setPartIndex(".concat(n.join(),")")}get invokeUserMain(){return"\nng_discardValue = false;\nuserMain();\nif (ng_discardValue) {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n  return;\n}\n"}getCrossSectionFadeFactor(){return this.targetIsSliceView?"(clamp(1.0 - 2.0 * abs(0.5 - gl_FragCoord.z), 0.0, 1.0))":"(1.0)"}enable(e,t,n){var i=e(t.renderContext.emitter);const r=i.shader,o=i.parameters;if(null===r)return;r.bind();const s=this.gl,a=t.renderContext,l=t.annotationLayer;if((0,d.dB)(s,r,this.shaderControlState,o.parseResult.controls),s.uniform3fv(r.uniform("uSubspaceMatrix"),t.subspaceMatrix),s.uniform1fv(r.uniform("uModelClipBounds"),t.modelClipBounds),s.uniformMatrix4fv(r.uniform("uModelViewProjection"),!1,t.modelViewProjectionMatrix),a.emitPickID&&s.uniform1ui(r.uniform("uPickID"),t.basePickId),a.emitColor){const e=l.state.displayState.color.value;s.uniform3f(r.uniform("uColor"),e[0],e[1],e[2]),s.uniform1ui(r.uniform("uSelectedIndex"),t.selectedIndex)}const c=r.vertexShaderInputBinders.properties;c.enable(1),s.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,t.buffer.buffer),c.bind(t.count,t.bufferOffset),n(r),c.disable()}}const m=new(r());function v(e,t){m.set(e,t)}function y(e){return m.get(e)}},9821:(e,t,n)=>{n.r(t),n.d(t,{AnnotationUserLayer:()=>ee});var i=n(3651),r=n.n(i),o=n(1190),s=n.n(o),a=n(2982),l=n(608),c=n.n(l),d=n(1767),u=n(8614),h=n(9063),p=n(8332),f=n(2579),g=n(2858),m=n(7445),v=n(3985),y=n(3056),b=n(1785),S=n(7965),w=n(7160),x=n(3893),C=n(2038),k=n(7562),E=n(3162),T=n(7970),L=n(6344),P=n(7772),D=n(154),M=n(5491),I=n.n(M);class R extends k.O8{constructor(e){super(),this.ref=e,this.element=document.createElement("label"),this.selectElement=document.createElement("select"),this.registerDisposer(e);const t=this.element,n=this.selectElement;t.appendChild(n),this.updateView(),this.registerEventListener(n,"change",(()=>this.updateModel())),this.registerDisposer(this.ref.changed.add(I()((()=>this.updateView()),0)))}updateModel(){this.ref.layerName=this.selectElement.value||void 0}updateView(){const e=this.selectElement,t=this.ref,n=t.filter;(0,E.gS)(e);const i=document.createElement("option");e.appendChild(i);for(const r of this.ref.layerManager.managedLayers)if(n(r)){const t=document.createElement("option"),n=r.name;t.textContent=n,t.value=n,e.appendChild(t)}e.value=t.layerName||""}}var A=n(1821),O=n(551),N=n(628),_=n(4791),V=n(8946);const B="annotations",F="annotationProperties",U="annotationRelationships",z="crossSectionAnnotationSpacing",j="projectionAnnotationSpacing",G="shader",W="shaderControls";function H(e,t){void 0!==t&&(0,T.parseArray)(t,((t,n)=>{e.add({type:d.UJ.POINT,id:""+n,point:(0,T.verify3dVec)(t),properties:[]})}))}function q(e){const t=e.layer;return null===t||t instanceof b.SegmentationUserLayer}const Y="linkedSegmentationLayer",J="filterBySegmentation",K="ignoreNullSegmentFilter";class X extends k.O8{constructor(e,t,n){super(),this.layerManager=e,this.annotationStates=t,this.annotationDisplayState=n,this.changed=new L.IY,this.curGeneration=-1,this.wasLoading=void 0,this.map=new(c()),this.registerDisposer(t.changed.add((()=>this.update()))),this.registerDisposer(t.isLoadingChanged.add((()=>this.update()))),this.update()}update(){const e=this.annotationStates.changed.count,t=this.annotationStates.isLoading;if(this.curGeneration===e&&t===this.wasLoading)return;this.wasLoading=t,this.curGeneration=e;const n=this.map;let i=!1;for(const o of this.annotationStates.relationships){let t=n.get(o);void 0===t&&(t=this.addRelationship(o),i=!0),t.seenGeneration=e}if(!t)for(const o of n){var r=(0,a.A)(o,2);const t=r[0];r[1].seenGeneration!==e&&(n.delete(t),i=!0)}i&&this.changed.dispatch()}addRelationship(e){const t=this.annotationDisplayState.relationshipStates.get(e),n=new g.tX(this.layerManager.addRef(),q);n.registerDisposer(n.changed.add((()=>{t.segmentationState.value=void 0===n.layerName?void 0:function(e){if(void 0===e)return null;const t=e.layer;return null===t?null:t instanceof b.SegmentationUserLayer?t.displayState:null}(n.layer)})));const i=t.showMatches,r={layerRef:n,showMatches:i,seenGeneration:-1};return n.changed.add(this.changed.dispatch),i.changed.add(this.changed.dispatch),this.map.set(e,r),r}get(e){return this.update(),this.map.get(e)}unbind(e){e.layerRef.changed.remove(this.changed.dispatch),e.showMatches.changed.remove(this.changed.dispatch)}reset(){for(const e of this.map.values())e.showMatches.reset()}toJSON(){const e=this.map;if(0===e.size)return{};let t;const n=[];for(const r of e){var i=(0,a.A)(r,2);const e=i[0],o=i[1];o.showMatches.value&&n.push(e);const s=o.layerRef.layerName;void 0!==s&&((t=t||{})[e]=s)}return n.sort(),{[Y]:t,[J]:0===n.length?void 0:n}}restoreState(e){const t=this.annotationStates.isLoading;(0,T.verifyOptionalObjectProperty)(e,Y,(e=>{"string"===typeof e&&(e={segments:e}),(0,T.verifyObject)(e);for(const i of s()(e)){const n=(0,T.verifyString)(e[i]);let r=this.map.get(i);if(void 0===r){if(!t)continue;r=this.addRelationship(i)}r.layerRef.layerName=n}for(const t of this.map){var n=(0,a.A)(t,2);const i=n[0],r=n[1];Object.prototype.hasOwnProperty.call(e,i)||(r.layerRef.layerName=void 0)}})),(0,T.verifyOptionalObjectProperty)(e,J,(e=>{"boolean"===typeof e&&(e=!0===e?["segments"]:[]);for(const n of(0,T.verifyStringArray)(e)){let e=this.map.get(n);if(void 0===e){if(!t)continue;e=this.addRelationship(n)}e.showMatches.value=!0}}))}disposed(){const e=this.map;for(const t of e.values())this.unbind(t);e.clear(),super.disposed()}}class Z extends k.O8{constructor(e,t){super(),this.relationship=e,this.state=t,this.element=document.createElement("label"),this.seenGeneration=-1;const n=this.element,i=this.registerDisposer(new S.Fo(t.showMatches)),r=new R(t.layerRef);n.appendChild(i.element),n.appendChild(document.createTextNode(e)),n.appendChild(r.element)}}class Q extends k.O8{constructor(e){super(),this.linkedSegmentationLayers=e,this.widgets=new(c()),this.element=document.createElement("div"),this.element.style.display="contents";const t=this.registerCancellable((0,C.t)((()=>this.updateView())));this.registerDisposer(this.linkedSegmentationLayers.annotationStates.changed.add(t)),this.updateView()}updateView(){const e=this.linkedSegmentationLayers,t=e.annotationStates,n=t.changed.count,i=this.widgets;for(const o of i){var r=(0,a.A)(o,2);const e=r[0],t=r[1];t.seenGeneration!==n&&(t.dispose(),i.delete(e))}(0,E.bu)(this.element,function*(){for(const r of t.relationships){let t=i.get(r);void 0===t&&(t=new Z(r,e.get(r))),t.seenGeneration=n,yield t.element}}.call(this))}disposed(){super.disposed();for(const e of this.widgets.values())e.dispose()}}const $=(0,x.Ok)(g.J3);class ee extends ${constructor(e){super(e),this.annotationProperties=new w.B0(void 0),this.localAnnotationsJson=void 0,this.pointAnnotationsJson=void 0,this.linkedSegmentationLayers=this.registerDisposer(new X(this.manager.rootLayers,this.annotationStates,this.annotationDisplayState)),this.linkedSegmentationLayers.changed.add(this.specificationChanged.dispatch),this.annotationDisplayState.ignoreNullSegmentFilter.changed.add(this.specificationChanged.dispatch),this.annotationCrossSectionRenderScaleTarget.changed.add(this.specificationChanged.dispatch),this.tabs.add("rendering",{label:"Rendering",order:-100,getter:()=>new ie(this)}),this.tabs.default="annotations",this.allowingRefresh=!0}disposed(){const e=this.localAnnotations;void 0!==e&&e.dispose(),super.disposed()}restoreState(e){super.restoreState(e),this.linkedSegmentationLayers.restoreState(e),this.localAnnotationsJson=e[B],this.localAnnotationProperties=(0,T.verifyOptionalObjectProperty)(e,F,d.aU),this.localAnnotationRelationships=(0,T.verifyOptionalObjectProperty)(e,U,T.verifyStringArray,["segments"]),this.pointAnnotationsJson=e.points,this.annotationCrossSectionRenderScaleTarget.restoreState(e[z]),this.annotationProjectionRenderScaleTarget.restoreState(e[j]),this.annotationDisplayState.ignoreNullSegmentFilter.restoreState(e[K]),this.annotationDisplayState.shader.restoreState(e[G]),this.annotationDisplayState.shaderControls.restoreState(e[W])}getLegacyDataSourceSpecifications(e,t,n,i){if(Object.prototype.hasOwnProperty.call(t,"source"))return super.getLegacyDataSourceSpecifications(e,t,n,i);const o=(0,T.verifyOptionalObjectProperty)(t,"voxelSize",(e=>(0,T.parseFixedLengthArray)(new Float64Array(3),e,(e=>(0,T.verifyFinitePositiveFloat)(e)/1e9)))),s=["m","m","m"];if(void 0!==o){const e=(0,p.d)({rank:3,units:s,scales:o,names:["x","y","z"]});n=void 0===n?{outputSpace:e,sourceRank:3,transform:void 0,inputSpace:e}:r()(r()({},n),{inputSpace:e})}return[{url:f.Zj,transform:n,enableDefaultSubsources:!0,subsources:new(c())}]}activateDataSubsources(e){var t;let n,i=!1;for(const o of e){const e=o.subsourceEntry,r=e=>void 0!==n&&(0,T.stableStringify)(e)!==(0,T.stableStringify)(n)?(o.deactivate("Annotation properties are not compatible"),!1):(n=e,!0);if(e.subsource.local===f.h0.annotations){if(i){o.deactivate("Only one local annotations source per layer is supported");continue}if(i=!0,!r(null!==(t=this.localAnnotationProperties)&&void 0!==t?t:[]))continue;o.activate((t=>{var n;const i=this.localAnnotations=new d.OS(o.loadedDataSource.transform,null!==(n=this.localAnnotationProperties)&&void 0!==n?n:[],this.localAnnotationRelationships);try{i.restoreState(this.localAnnotationsJson)}catch(s){}t.registerDisposer((()=>{i.dispose(),this.localAnnotations=void 0})),t.registerDisposer(this.localAnnotations.changed.add(this.specificationChanged.dispatch));try{H(this.localAnnotations,this.pointAnnotationsJson)}catch(a){}this.pointAnnotationsJson=void 0,this.localAnnotationsJson=void 0;const r=new u.s0({localPosition:this.localPosition,transform:t.registerDisposer((0,v.Z2)(this.manager.root.coordinateSpace,this.localPosition.coordinateSpace,o.loadedDataSource.transform,void 0)),source:i.addRef(),displayState:this.annotationDisplayState,dataSource:o.loadedDataSource.layerDataSource,subsourceIndex:o.subsourceIndex,subsourceId:e.id,role:y.gY.ANNOTATION});this.addAnnotationLayerState(r,o)}));continue}const s=e.subsource.annotation;if(void 0===s)o.deactivate("Not compatible with annotation layer");else{if(!r(s.properties))continue;o.activate((()=>{const t=new u.s0({localPosition:this.localPosition,transform:o.getRenderLayerTransform(),source:s,displayState:this.annotationDisplayState,dataSource:o.loadedDataSource.layerDataSource,subsourceIndex:o.subsourceIndex,subsourceId:e.id,role:y.gY.ANNOTATION});this.addAnnotationLayerState(t,o)}))}}const r=this.annotationProperties.value;(0,T.stableStringify)(r)!==(0,T.stableStringify)(n)&&(this.annotationProperties.value=n)}initializeAnnotationLayerViewTab(e){const t=e.registerDisposer((0,w.ol)((e=>e.some((e=>e.source instanceof h.oZ))),this.annotationStates)),n=e.registerDisposer(new P.p(t,((e,t,n)=>{if(e){{const e=n.registerDisposer(new O.r(this.annotationCrossSectionRenderScaleHistogram,this.annotationCrossSectionRenderScaleTarget));e.label.textContent="Spacing (cross section)",t.appendChild(e.element)}{const e=n.registerDisposer(new O.r(this.annotationProjectionRenderScaleHistogram,this.annotationProjectionRenderScaleTarget));e.label.textContent="Spacing (projection)",t.appendChild(e.element)}}})));e.element.insertBefore(n.element,e.element.firstChild);{const t=e.registerDisposer(new S.Fo(this.annotationDisplayState.ignoreNullSegmentFilter)),n=document.createElement("label");n.appendChild(document.createTextNode("Ignore null related segment filter")),n.title="Display all annotations if filtering by related segments is enabled but no segments are selected",n.appendChild(t.element),e.element.appendChild(n)}e.element.appendChild(e.registerDisposer(new Q(this.linkedSegmentationLayers)).element)}toJSON(){const e=super.toJSON();e[z]=this.annotationCrossSectionRenderScaleTarget.toJSON(),e[j]=this.annotationProjectionRenderScaleTarget.toJSON(),void 0!==this.localAnnotations?e[B]=this.localAnnotations.toJSON():void 0!==this.localAnnotationsJson&&(e[B]=this.localAnnotationsJson),e[F]=(0,d.oh)(this.localAnnotationProperties);const t=this.localAnnotationRelationships;return e[U]=t&&1===t.length&&"segments"===t[0]?void 0:t,e[K]=this.annotationDisplayState.ignoreNullSegmentFilter.toJSON(),e[G]=this.annotationDisplayState.shader.toJSON(),e[W]=this.annotationDisplayState.shaderControls.toJSON(),r()(e,this.linkedSegmentationLayers.toJSON()),e}}function te(e){return new N.h({shaderError:e.annotationDisplayState.shaderError,fragmentMain:e.annotationDisplayState.shader,shaderControlState:e.annotationDisplayState.shaderControls})}ee.type="annotation",ee.typeAbbreviation="ann";class ne extends m.hJ{constructor(e){super(),this.layer=e,this.codeWidget=this.registerDisposer(te(this.layer)),this.content.appendChild(this.codeWidget.element),this.codeWidget.textEditor.refresh()}}class ie extends V.oz{constructor(e){super(),this.layer=e,this.codeWidget=this.registerDisposer(te(this.layer));const t=this.element;t.classList.add("neuroglancer-annotation-rendering-tab"),t.appendChild(this.registerDisposer(new P.p(e.annotationProperties,((e,t)=>{if(void 0===e||0===e.length)return;const n=document.createElement("div");t.appendChild(n),n.classList.add("neuroglancer-annotation-shader-property-list");for(const i of e){const e=document.createElement("div");e.classList.add("neuroglancer-annotation-shader-property");const t=document.createElement("span");t.classList.add("neuroglancer-annotation-shader-property-type"),t.textContent=i.type;const r=document.createElement("span");r.classList.add("neuroglancer-annotation-shader-property-identifier"),r.textContent="prop_".concat(i.identifier),e.appendChild(t),e.appendChild(r);const o=i.description;void 0!==o&&(e.title=o),n.appendChild(e)}}))).element);let n=document.createElement("div");n.className="neuroglancer-segmentation-dropdown-skeleton-shader-header";let i=document.createElement("div");i.style.flex="1",i.textContent="Annotation shader:",n.appendChild(i),n.appendChild((0,A.F)({title:"Show larger editor view",onClick:()=>{new ne(this.layer)}})),n.appendChild((0,D.G)({title:"Documentation on annotation rendering",href:"https://github.com/google/neuroglancer/blob/master/src/neuroglancer/annotation/rendering.md"})),t.appendChild(n),t.appendChild(this.codeWidget.element),t.appendChild(this.registerDisposer(new _.SJ(e.annotationDisplayState.shaderControls,this.layer.manager.root.display,this.layer,{visibility:this.visibility})).element)}}(0,g.LJ)(ee),(0,g.LJ)(ee,"pointAnnotation"),(0,g.lV)((e=>e.local===f.h0.annotations?{layerConstructor:ee,priority:100}:void 0!==e.annotation?{layerConstructor:ee,priority:1}:void 0)),(0,_.G6)(ee,(e=>({shaderControlState:e.annotationDisplayState.shaderControls})))},6094:(e,t,n)=>{var i;n.d(t,{DJ:()=>a,ES:()=>r,HU:()=>i,IL:()=>v,IM:()=>h,M0:()=>m,WS:()=>c,il:()=>o,o0:()=>l,oS:()=>u,rY:()=>d,tD:()=>f,wU:()=>p,y3:()=>g}),function(e){e[e.GPU_MEMORY=0]="GPU_MEMORY",e[e.SYSTEM_MEMORY=1]="SYSTEM_MEMORY",e[e.SYSTEM_MEMORY_WORKER=2]="SYSTEM_MEMORY_WORKER",e[e.DOWNLOADING=3]="DOWNLOADING",e[e.QUEUED=4]="QUEUED",e[e.NEW=5]="NEW",e[e.FAILED=6]="FAILED",e[e.EXPIRED=7]="EXPIRED"}(i||(i={}));const r=8;var o;!function(e){e[e.FIRST_TIER=0]="FIRST_TIER",e[e.FIRST_ORDERED_TIER=0]="FIRST_ORDERED_TIER",e[e.VISIBLE=0]="VISIBLE",e[e.PREFETCH=1]="PREFETCH",e[e.LAST_ORDERED_TIER=1]="LAST_ORDERED_TIER",e[e.RECENT=2]="RECENT",e[e.LAST_TIER=2]="LAST_TIER"}(o||(o={}));const s=3;var a,l;!function(e){e[e.totalTime=0]="totalTime",e[e.totalChunks=1]="totalChunks"}(a||(a={})),function(e){e[e.numChunks=0]="numChunks",e[e.systemMemoryBytes=1]="systemMemoryBytes",e[e.gpuMemoryBytes=2]="gpuMemoryBytes"}(l||(l={}));const c=3;function d(e,t){return e*s+t}function u(e){return r*s*c+e}const h="ChunkQueueManager",p="ChunkManager",f="ChunkSource.invalidate",g="ChunkQueueManager.requestChunkStatistics",m="ChunkManager.chunkLayerStatistics";class v{constructor(){this.numVisibleChunksNeeded=0,this.numVisibleChunksAvailable=0,this.numPrefetchChunksNeeded=0,this.numPrefetchChunksAvailable=0}}},5795:(e,t,n)=>{n.d(t,{AA:()=>L,PU:()=>A,Vk:()=>R,YZ:()=>M,nx:()=>O,tB:()=>N,yV:()=>D});var i=n(3651),r=n.n(i),o=n(7399),s=n.n(o),a=n(2982),l=n(608),c=n.n(l),d=n(984),u=n.n(d),h=n(6063),p=n.n(h),f=n(5677),g=n.n(f),m=n(6094),v=n(6210),y=n(7965),b=n(7160),S=n(2959),w=n(7970),x=n(5870),C=n(2311),k=n(6344),E=n(7799),T=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=g()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&p()(t,n,s),s};class L{constructor(e){this.source=e,this.state=m.HU.SYSTEM_MEMORY}get gl(){return this.source.gl}copyToGPU(e){this.state=m.HU.GPU_MEMORY}freeGPUMemory(e){this.state=m.HU.SYSTEM_MEMORY}}function P(e){if("number"!==typeof e||e<0)throw new Error("Expected non-negative number as limit, but received: ".concat(u()(e)));return e}class D{constructor(){let{defaultItemLimit:e=Number.POSITIVE_INFINITY,defaultSizeLimit:t=Number.POSITIVE_INFINITY}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sizeLimit=new b.DN(t,P),this.itemLimit=new b.DN(e,P)}}let M=class extends E.T6{constructor(e,t,n,i){super(),this.gl=t,this.frameNumberCounter=n,this.capacities=i,this.visibleChunksChanged=new k.IY,this.pendingChunkUpdates=null,this.pendingChunkUpdatesTail=null,this.chunkUpdateDeadline=null,this.chunkUpdateDelay=30,this.enablePrefetch=new y.C_(!0,!0);const r=t=>({itemLimit:this.registerDisposer(v.a.makeFromExisting(e,t.itemLimit)).rpcId,sizeLimit:this.registerDisposer(v.a.makeFromExisting(e,t.sizeLimit)).rpcId});this.initializeCounterpart(e,{gpuMemoryCapacity:r(i.gpuMemory),systemMemoryCapacity:r(i.systemMemory),downloadCapacity:r(i.download),computeCapacity:r(i.compute),enablePrefetch:this.registerDisposer(v.a.makeFromExisting(e,this.enablePrefetch)).rpcId})}scheduleChunkUpdate(){let e,t=this.chunkUpdateDeadline;e=null===t||Date.now()<t?0:this.chunkUpdateDelay,setTimeout(this.processPendingChunkUpdates.bind(this),e)}processPendingChunkUpdates(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.chunkUpdateDeadline;e||null!==t||(t=Date.now()+30);let n=!1,i=0;for(;;){if(!e&&Date.now()>t){this.chunkUpdateDeadline=null,setTimeout((()=>this.processPendingChunkUpdates()),this.chunkUpdateDelay);break}let r=this.pendingChunkUpdates;if(null==r)break;if(this.applyChunkUpdate(r)&&(n=!0),++i,null==(this.pendingChunkUpdates=r.nextUpdate)){this.pendingChunkUpdatesTail=null;break}}return n&&this.visibleChunksChanged.dispatch(),i}handleFetch_(e,t){var n=t.promise;const i=n.resolve,r=n.reject;if(n.cancellationToken.isCanceled)return void r(S.wS);const o=t.key,s=e.chunks.get(o);if(!s)return void r(new Error("No chunk found at ".concat(o," for source ").concat(e.constructor.name)));const a=s.data;a?i({value:a}):r(new Error("At ".concat(o," for source ").concat(e.constructor.name,": chunk has no data")))}applyChunkUpdate(e){let t=!1;const n=this.rpc.get(e.source);if(void 0!==e.promise)this.handleFetch_(n,e);else if(void 0===e.id){for(const e of n.chunks.keys())n.deleteChunk(e);t=!0}else{let i=e.state;if(i===m.HU.EXPIRED)n.deleteChunk(e.id);else{let r,o=e.id;if(e.new?(r=n.getChunk(e),n.addChunk(o,r)):r=n.chunks.get(o),i!==r.state)switch(i){case m.HU.GPU_MEMORY:r.copyToGPU(this.gl),t=!0;break;case m.HU.SYSTEM_MEMORY:r.freeGPUMemory(this.gl);break;default:throw new Error("INTERNAL ERROR: Invalid chunk state: ".concat(m.HU[i]))}}}return t}flushPendingChunkUpdates(){return this.processPendingChunkUpdates(!0)}async getStatistics(){const e=this.rpc,t=await e.promiseInvoke(m.y3,{queue:this.rpcId}),n=new(c());for(const r of t){var i=(0,a.A)(r,2);const t=i[0],o=i[1],s=e.get(t);void 0!==s&&n.set(s,o)}return n}};function I(e,t){let n=e.get(t.source);let i=n.chunkManager.chunkQueueManager;if(n.immediateChunkUpdates)return void(i.applyChunkUpdate(t)&&i.visibleChunksChanged.dispatch());let r=i.pendingChunkUpdatesTail;null==r?(i.pendingChunkUpdates=t,i.pendingChunkUpdatesTail=t,i.scheduleChunkUpdate()):(r.nextUpdate=t,i.pendingChunkUpdatesTail=t)}M=T([(0,E.R6)(m.IM)],M),(0,E.ks)("Chunk.update",(function(e){I(this,e)})),(0,E.oJ)("Chunk.retrieve",(function(e,t){return new(s())(((n,i)=>{e.promise={resolve:n,reject:i,cancellationToken:t},I(this,e)}))})),(0,E.ks)(m.M0,(function(e){const t=this.get(e.id);for(const n of t.prevStatisticsLayers)n.numVisibleChunksNeeded=0,n.numVisibleChunksAvailable=0,n.numPrefetchChunksNeeded=0,n.numPrefetchChunksAvailable=0;t.prevStatisticsLayers.length=0;for(const n of e.layers){const e=this.get(n.id);if(void 0===e)continue;const i=e.layerChunkProgressInfo;i.numVisibleChunksAvailable=n.numVisibleChunksAvailable,i.numVisibleChunksNeeded=n.numVisibleChunksNeeded,i.numPrefetchChunksAvailable=n.numPrefetchChunksAvailable,i.numPrefetchChunksNeeded=n.numPrefetchChunksNeeded,t.prevStatisticsLayers.push(i)}t.layerChunkStatisticsUpdated.dispatch()}));let R=class extends E.T6{constructor(e){super(),this.chunkQueueManager=e,this.memoize=new x.e,this.prevStatisticsLayers=[],this.layerChunkStatisticsUpdated=new k.IY,this.registerDisposer(e.addRef()),this.initializeCounterpart(e.rpc,{chunkQueueManager:e.rpcId})}get gl(){return this.chunkQueueManager.gl}getChunkSource(e,t){const n=e.encodeOptions(t);n.constructorId=(0,C.R)(e);const i=(0,w.stableStringify)(n);return this.memoize.get(i,(()=>{const i=new e(this,t);return i.initializeCounterpart(this.rpc,{}),i.key=n,i}))}};R=T([(0,E.R6)(m.wU)],R);class A extends E.T6{constructor(e){super(),this.chunkManager=e,this.chunks=new(c()),this.immediateChunkUpdates=!1}initializeCounterpart(e,t){t.chunkManager=this.chunkManager.rpcId,super.initializeCounterpart(e,t)}get gl(){return this.chunkManager.chunkQueueManager.gl}deleteChunk(e){const t=this.chunks.get(e);t.state===m.HU.GPU_MEMORY&&t.freeGPUMemory(this.gl),this.chunks.delete(e)}addChunk(e,t){this.chunks.set(e,t)}getChunk(e){throw new Error("Not implemented.")}invalidateCache(){this.rpc.invoke(m.tD,{id:this.rpcId})}static encodeOptions(e){return{}}}function O(e,t){let n=class extends e{constructor(){super(...arguments);const e=arguments.length<=1?void 0:arguments[1];this.parameters=e.parameters}initializeCounterpart(e,t){t.parameters=this.parameters,super.initializeCounterpart(e,t)}static encodeOptions(e){return r()({parameters:e.parameters},super.encodeOptions(e))}};return n=T([(0,E.R6)(t.RPC_ID)],n),n}class N extends E.T6{constructor(e){super(),this.layerChunkProgressInfo=e}}},8332:(e,t,n)=>{n.d(t,{$d:()=>pe,$r:()=>U,AJ:()=>ie,Bk:()=>me,FH:()=>Z,Ii:()=>he,Nj:()=>V,OG:()=>oe,QN:()=>de,RE:()=>W,RV:()=>te,T4:()=>H,UC:()=>q,W6:()=>j,Wd:()=>X,_c:()=>B,cK:()=>se,cL:()=>J,d:()=>_,dq:()=>ye,fv:()=>be,ge:()=>G,iG:()=>ge,ii:()=>ne,jK:()=>fe,mc:()=>re,p4:()=>K,qx:()=>Se,tJ:()=>ue,up:()=>D,vK:()=>ve});var i=n(1274),r=n.n(i),o=n(2395),s=n.n(o),a=n(8178),l=n.n(a),c=n(3651),d=n.n(c),u=n(1190),h=n.n(u),p=n(984),f=n.n(p),g=n(2982),m=n(974),v=n.n(m),y=n(608),b=n.n(y),S=n(7160),w=n(9735),x=n(3835),C=n(7970),k=n(2729),E=n(2240),T=n(6344),L=n(9799);let P=0;function D(){return++P}function M(e,t){return void 0===e?void 0===t:void 0!==t&&(e.explicit===t.explicit&&(0,w.r1)(e.coordinates,t.coordinates)&&(0,w.r1)(e.labels,t.labels))}function I(e,t){const n=new(b());for(let i=0,r=e.length;i<r;++i)n.set(e[i],t[i]);return(e=v()(n.keys())).sort(((e,t)=>e-t)),{coordinates:e,labels:t=v()(e,(e=>n.get(e)))}}function R(e){if(1===e.length)return e[0];const t=new(b());let n=!1;for(const r of e){r.explicit&&(n=!0);const e=r.coordinates,i=r.labels;for(let n=0,r=e.length;n<r;++n)t.set(e[n],i[n])}const i=v()(t.keys());i.sort(((e,t)=>e-t));return{explicit:n,coordinates:i,labels:v()(i,(e=>t.get(e)))}}function A(e){if(0!==(e=e.filter((e=>void 0!==e))).length)return R(e)}function O(e,t){return(0,w.r1)(e.transform,t.transform)&&function(e,t){return(0,w.r1)(e.lowerBounds,t.lowerBounds)&&(0,w.r1)(e.upperBounds,t.upperBounds)}(e.box,t.box)}function N(e,t){return e.valid===t.valid&&e.rank===t.rank&&(0,w.r1)(e.names,t.names)&&(0,w.r1)(e.ids,t.ids)&&(0,w.r1)(e.timestamps,t.timestamps)&&(0,w.r1)(e.units,t.units)&&(0,w.r1)(e.scales,t.scales)&&(0,w.wm)(e.boundingBoxes,t.boundingBoxes,O)&&(0,w.wm)(e.coordinateArrays,t.coordinateArrays,M)}function _(e){const t=e.names,n=e.units,i=e.scales;var r=e.valid;const o=void 0===r||r;var s=e.rank;const a=void 0===s?t.length:s;var l=e.timestamps;const c=void 0===l?t.map((()=>Number.NEGATIVE_INFINITY)):l;var d=e.ids;const u=void 0===d?t.map(((e,t)=>-t)):d;var h=e.boundingBoxes;const p=void 0===h?[]:h;var f=e.coordinateArrays;const g=void 0===f?new Array(a):f;var m=e.bounds;const v=void 0===m?function(e,t){const n=new Float64Array(t),i=new Float64Array(t);n.fill(Number.NEGATIVE_INFINITY),i.fill(Number.POSITIVE_INFINITY);for(const r of e)for(let e=0;e<t;++e){const o=q(r,e,t);if(void 0===o)continue;const s=o.lower,a=o.upper;n[e]=n[e]===Number.NEGATIVE_INFINITY?s:Math.min(n[e],s),i[e]=i[e]===Number.POSITIVE_INFINITY?a:Math.max(i[e],a)}return{lowerBounds:n,upperBounds:i}}(p,a):m;return{valid:o,rank:a,names:t,timestamps:c,ids:u,units:n,scales:i,boundingBoxes:p,bounds:v,coordinateArrays:g}}const V=_({valid:!1,names:[],units:[],scales:L.J,boundingBoxes:[]}),B=_({valid:!0,names:[],units:[],scales:L.J,boundingBoxes:[]});function F(e){var t=(0,C.expectArray)(e,2),n=(0,g.A)(t,2);const i=n[0],r=n[1],o=(0,C.verifyFinitePositiveFloat)(i),s=(0,C.verifyString)(r),a=E.KQ.get(s);if(void 0===a)throw new Error("Invalid unit: ".concat(f()(s)));return{unit:a.unit,scale:(0,E.Gh)(o,a.exponent)}}function U(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e)return V;(0,C.verifyObject)(e);const n=ue(h()(e),t),i=n.length,r=new Array(i),o=new Float64Array(i),s=new Array(i);for(let a=0;a<i;++a)(0,C.verifyObjectProperty)(e,n[a],(e=>{if(Array.isArray(e)){var t=F(e);const n=t.unit,i=t.scale;r[a]=n,o[a]=i}else{(0,C.verifyObject)(e);let t=(0,C.verifyObjectProperty)(e,"coordinates",C.verifyIntegerArray),n=(0,C.verifyObjectProperty)(e,"labels",C.verifyStringArray),i=t.length;if(i!==n.length)throw new Error("Length of coordinates array (".concat(i,") ")+"does not match length of labels array (".concat(n.length,")"));r[a]="",o[a]=1,s[a]=d()({explicit:!0},I(t,n))}}));return _({valid:!1,names:n,units:r,scales:o,coordinateArrays:s})}function z(e){const t=e.rank;if(0===t)return;const n=e.names,i=e.units,r=e.scales,o=e.coordinateArrays,s={};for(let a=0;a<t;++a){const e=n[a],t=o[a];(null===t||void 0===t?void 0:t.explicit)?s[e]={coordinates:v()(t.coordinates),labels:t.labels}:s[e]=[r[a],i[a]]}return s}class j extends S.B0{constructor(){super(V)}toJSON(){return z(this.value)}reset(){this.value=V}restoreState(e){this.value=U(e)}}function G(e,t){let n=(e+t)/2;return l()(n)||(n=Math.min(Math.max(0,e),t)),n}function W(e,t){const n=t.lowerBounds,i=t.upperBounds,r=e.length;for(let o=0;o<r;++o)e[o]=G(n[o],i[o]);return e}function H(e){const t=e.lowerBounds.length;return{box:e,transform:k.DA(Float64Array,t,t+1)}}function q(e,t,n){var i=e.box;const r=i.lowerBounds,o=i.upperBounds,s=e.transform,a=r.length,l=n,c=s[l*a+t];let d=c,u=c,h=!1;for(let p=0;p<a;++p){let e=s[l*p+t];if(0===e)continue;const n=e*r[p],i=e*o[p];d+=Math.min(n,i),u+=Math.max(n,i),h=!0}if(h)return{lower:d,upper:u}}function Y(e,t,n){const i=e.transform,r=e.box,o=n.length,s=r.lowerBounds.length,a=new Float64Array((s+1)*t);for(let l=0;l<o;++l){const e=n[l];if(-1!==e)for(let n=0;n<=s;++n)a[n*t+e]=i[n*o+l]}return{transform:a,box:r}}function J(e,t){const n={lowerBounds:Float64Array.of(0),upperBounds:Float64Array.of(1)},i=new Float64Array(2*e);return i[t]=1,{transform:i,box:n}}function K(e,t,n){if(t===n)return e;const i=e.box,r=i.lowerBounds.length,o=new Float64Array((r+1)*n);return k.C(o,n,e.transform,t,t,r+1),{box:i,transform:o}}function X(e,t){const n=e.rank,i=e.sourceRank;if(n!==t.rank||i!==t.sourceRank)return!1;const r=e.inputSpace,o=t.inputSpace;return!!((0,w.r1)(o.scales,r.scales)&&(0,w.r1)(o.units,r.units)&&(0,w.r1)(t.outputSpace.names,e.outputSpace.names))&&ae(e.transform,n,e.outputSpace.scales,t.transform,n,t.outputSpace.scales)}function Z(e){return{rank:e.rank,sourceRank:e.rank,inputSpace:e,outputSpace:e,transform:k.DA(Float64Array,e.rank+1)}}function Q(e,t,n){return e.boundingBoxes.map((i=>function(e,t,n,i){let r=e.transform,o=e.box;const s=e.box.lowerBounds.length,a=i.length,l=new Float64Array((s+1)*a);for(let c=0;c<a;++c){const e=i[c];for(let i=0;i<s;++i){let o=0;for(let s=0;s<a;++s){const l=n[s];o+=t[(a+1)*s+c]*r[a*i+s]*(l/e)}l[a*i+c]=o}let o=t[(a+1)*a+c];for(let i=0;i<a;++i){const l=n[i];o+=t[(a+1)*i+c]*r[a*s+i]*(l/e)}l[s*a+c]=o}return{transform:l,box:o}}(i,t,e.scales,n)))}function $(e,t,n){const i=_({valid:e.valid,rank:n.rank,ids:n.ids,names:n.names,timestamps:n.timestamps,scales:n.scales,units:n.units,boundingBoxes:Q(e,t,n.scales),coordinateArrays:n.coordinateArrays});return N(i,n)?n:i}function ee(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){const t=Number(e);if(s()(t)&&t>=0)return!0}return null!==e.match(/^[a-zA-Z][a-zA-Z_0-9]*['^]?$/)}function te(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new(r());for(const i of e){if(!ee(i,t))return!1;if(n.has(i))return!1;n.add(i)}return!0}function ne(e){const t=e.length,n=new Array(t);n.fill(!0);for(let i=0;i<t;++i){const t=e[i];if(!ee(t)){n[i]=!1;continue}const r=e.indexOf(t,i+1);-1!==r&&(n[i]=!1,n[r]=!1)}return n}function ie(e){return e.endsWith("'")}function re(e){return e.endsWith("'")||e.endsWith("^")}function oe(e){return e.endsWith("^")}function se(e){return!re(e)}function ae(e,t,n,i,r,o){if(!k.LC(e,t+1,i,r+1,t,t))return!1;for(let s=0;s<t;++s){const a=e[(t+1)*t+s],l=i[(r+1)*r+s];if(a*(n[s]/o[s])!==l)return!1}for(let s=t;s<r;++s)if(0!==i[(r+1)*r+s])return!1;for(let s=t;s<r;++s){for(let e=0;e<t;++e)if(0!==i[(r+1)*e+s])return!1;for(let e=0;e<r;++e){const t=i[(r+1)*s+e];if(s===e){if(1!==t)return!1}else if(0!==t)return!1}}return!0}function le(e,t){if(!t.includes(e))return e;var n=e.match(/^([^']*)('?)$/),i=(0,g.A)(n,3);const r=i[1],o=i[2];for(let s=0;;++s){const e="".concat(r).concat(s).concat(o);if(!t.includes(e))return e}}function ce(e){const t=$(e.inputSpace,e.transform,e.outputSpace);return t===e.outputSpace?e:{rank:e.rank,sourceRank:e.sourceRank,inputSpace:e.inputSpace,transform:e.transform,outputSpace:t}}class de{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.mutableSourceRank=t,this.value_=void 0,this.changed=new T.IY,this.inputSpaceChanged=new T.IY,this.defaultTransform=ce(e);const n=this;this.outputSpace={changed:n.changed,get value(){return n.value.outputSpace},set value(e){const t=n.value;if(N(t.outputSpace,e))return;if(t.rank!==e.rank)return;const i=function(e,t,n){const i=new Float64Array(e),r=t.length,o=(r+1)*r;for(let s=0;s<r;++s)i[o+s]*=t[s]/n[s];return i}(t.transform,t.outputSpace.scales,e.scales);n.value_={sourceRank:t.sourceRank,rank:t.rank,inputSpace:t.inputSpace,outputSpace:$(t.inputSpace,i,e),transform:i},n.changed.dispatch()}},this.inputSpace={changed:n.inputSpaceChanged,get value(){return n.value.inputSpace},set value(e){const t=n.value;N(t.inputSpace,e)||(n.value_=function(e,t){const n=e.inputSpace,i=e.transform,r=n.ids,o=n.rank,s=t.rank,a=t.names,l=t.units,c=t.scales,d=new Array(o);d.fill(!0);const u=[],h=t.ids.map(((e,t)=>{const n=r.indexOf(e);return-1!==n?d[n]=!1:u.push(t),n})),p=e.outputSpace,f=p.names,g=p.units,m=p.scales,v=p.ids,y=p.timestamps,b=p.coordinateArrays,S=d,w=[],x=[],C=new Float64Array(s),k=[],E=[],T=new Array(s);let L=0;const P=new Float64Array((s+1)**2);P[P.length-1]=1;for(let D=0;D<o;++D)if(!S[D]){w[L]=f[D],k[L]=v[D],x[L]=g[D],C[L]=m[D],E[L]=y[D],T[L]=b[D];for(let e=0;e<s;++e){const t=h[e];-1!==t&&(P[e*(s+1)+L]=i[t*(o+1)+D])}P[s*(s+1)+L]=i[o*(o+1)+D],++L}for(const I of u)k[L]=D(),w[L]=le(a[I],w),C[L]=c[I],x[L]=l[I],P[I*(s+1)+L]=1,++L;const M=_({valid:t.valid,rank:s,names:w,ids:k,timestamps:E,units:x,scales:C,boundingBoxes:Q(t,P,C),coordinateArrays:T});return{rank:s,sourceRank:e.sourceRank,inputSpace:t,outputSpace:M,transform:P}}(t,e),n.inputSpaceChanged.dispatch(),n.changed.dispatch())}}}set value(e){const t=this.value;e!==t&&(this.value_=ce(e),e.inputSpace!==t.inputSpace&&this.inputSpaceChanged.dispatch(),this.changed.dispatch())}get value(){let e=this.value_;return void 0===e&&(e=this.value_=this.defaultTransform),e}reset(){this.value_!==this.defaultTransform&&(this.value_=this.defaultTransform,this.inputSpaceChanged.dispatch(),this.changed.dispatch())}get defaultInputSpace(){return this.defaultTransform.inputSpace}get spec(){const e=this.value,t=e.rank,n=e.transform,i=e.inputSpace,r=e.outputSpace,o=e.sourceRank,s=this.defaultTransform,a=this.mutableSourceRank,l=s.inputSpace,c=s.rank,d=s.transform,u=s.outputSpace,h=i.units,p=i.scales,f=o===t&&(0,w.r1)(p,a?r.scales:l.scales)&&(0,w.r1)(h,a?r.units:l.units),g=ae(d,c,u.scales,n,t,r.scales),m=(0,w.r1)(u.names,r.names);if(!(g&&m&&f))return{sourceRank:o,transform:g?void 0:n,outputSpace:e.outputSpace,inputSpace:f?void 0:i}}set transform(e){const t=this.value,n=t.inputSpace;this.value_={rank:t.rank,sourceRank:t.sourceRank,inputSpace:n,transform:e,outputSpace:$(n,e,t.outputSpace)},this.changed.dispatch()}set spec(e){if(void 0===e)return void this.reset();if(this.mutableSourceRank){const t=e.inputSpace||e.outputSpace,n=t.rank,i=_({rank:n,names:t.names.map(((e,t)=>"".concat(t))),units:t.units,scales:t.scales,coordinateArrays:t.coordinateArrays});return void(this.value={rank:n,transform:e.transform||k.DA(Float64Array,n+1),sourceRank:e.sourceRank,outputSpace:e.outputSpace,inputSpace:i})}var t=this.defaultTransform;const n=t.inputSpace,i=t.sourceRank,r=t.outputSpace,o=t.transform,s=t.rank,a=e.inputSpace,l=e.sourceRank,c=e.outputSpace,u=e.transform,h=e.outputSpace.rank,p=n.names,f=void 0!==a?a.names:p,g=new Array(i);for(let d=0;d<i;++d){let e=f.indexOf(p[d]);e>=l&&(e=-1),g[d]=e}const m=h-l+i;for(let d=l;d<h;++d)g[i+d-l]=d;const v=new Float64Array(m),y=new Array(m),b=[];for(let d=0;d<i;++d){const e=g[d];-1===e||void 0===a?(v[d]=n.scales[d],b[d]=n.units[d],y[d]=n.coordinateArrays[d]):(v[d]=a.scales[e],b[d]=a.units[e],y[d]=A([n.coordinateArrays[d],a.coordinateArrays[e]]))}const S=a||c,w=p.slice(0,i),x=r.names.slice(0,i),C=r.coordinateArrays.slice(0,i),E=new Float64Array(m),T=[];for(let d=0;d<m;++d){const e=g[d];-1===e?(E[d]=r.scales[d],T[d]=r.units[d],C[d]=r.coordinateArrays[d]):(x[d]=c.names[e],T[d]=c.units[e],E[d]=c.scales[e],C[d]=c.coordinateArrays[e])}if(!te(x))return void this.reset();for(let d=i;d<m;++d){const e=d-i+l;v[d]=S.scales[e],b[d]=S.units[e],w[d]="".concat(d)}const L=new Float64Array((m+1)**2);L[L.length-1]=1;for(let d=0;d<m;++d){const e=g[d];let t;t=-1===e||void 0===u?d>=i?0:o[s*(s+1)+d]*(r.scales[d]/E[d]):u[h*(h+1)+e],L[m*(m+1)+d]=t;for(let n=0;n<m;++n){const t=g[n];let r;r=-1===e!=(-1===t)?0:-1===e||void 0===u?e>=i||t>=i?e===t?1:0:o[n*(s+1)+d]:u[t*(h+1)+e],L[n*(m+1)+d]=r}}const P=n.boundingBoxes.map((e=>K(e,s,m)));for(let d=i;d<m;++d)P.push(J(m,d));for(let k=0;k<m;++k){if(0!==L[m*(m+1)+k])continue;let e;for(let n=0;n<m;++n){const t=L[n*(m+1)+k];if(0!==t){if(1!==t){e=null;break}if(void 0!==e){e=null;break}e=n}}if(null==e)continue;let t=y[e];void 0!==t&&(t.explicit&&(t=d()(d()({},t),{explicit:!1})),C[k]=A([t,C[k]]))}this.value={rank:m,transform:L,sourceRank:i,outputSpace:_({rank:m,names:x,scales:E,units:T,coordinateArrays:C}),inputSpace:_({rank:m,names:w,scales:v,units:b,coordinateArrays:y,boundingBoxes:P})}}toJSON(){return me(this.spec)}restoreState(e){this.spec=ge(e)}}function ue(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,C.parseArray)(e,(e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,C.verifyString)(e);if(!ee(n,t))throw new Error("Invalid dimension name: ".concat(f()(n)));return n}(e,t)));if(!te(n,t))throw new Error("Invalid dimensions: ".concat(f()(n)));return n}class he{constructor(e,t){this.combined=e,this.bindings=new(r()),this.retainCount=0,this.prevCombined=this.combined.value,this.dimensionRefCounts=new(b()),this.handleCombinedChanged=()=>{this.combined.value!==this.prevCombined&&this.update()},this.includeDimensionPredicate_=t}getRenameValidity(e){const t=this.combined.value.names,n=ne(e),i=e.length;for(let r=0;r<i;++r){if(!n[r])continue;const i=e[r];if(t.includes(i))continue;let o=!0;for(const e of this.bindings){if(e.space.value.names.includes(i)){o=!1;break}}n[r]=o}return n}get includeDimensionPredicate(){return this.includeDimensionPredicate_}set includeDimensionPredicate(e){this.includeDimensionPredicate_=e,this.update()}update(){const e=this.combined,t=this.bindings,n=this.retainCount>0?1:0;if(0===t.size&&!n)return void(e.value=V);const i=this.includeDimensionPredicate_,r=e.value;let o=v()(r.names),s=v()(r.units),a=v()(r.scales),l=v()(r.ids),c=v()(r.timestamps),d=r.names.map((()=>n?1:0));const u=[];let h=!1;for(const v of t){const e=v.space.value,t=v.prevValue,r=v.mappedDimensionIds;h=h||e.valid;const p=e.names,f=e.units,g=e.scales,m=e.ids,y=e.timestamps,b=[],S=[];u.push(S),v.mappedDimensionIds=b,v.prevValue=e;const w=p.length;for(let u=0;u<w;++u){const e=p[u];if(!i(e))continue;if(void 0!==t){const n=m[u],i=t.ids.indexOf(n);if(-1!==i){const t=r[i];if(void 0!==t){const n=l.indexOf(t);if(-1!==n){b[u]=t,++d[n],S[u]=n;const i=y[u];void 0===i||i<=c[n]||(o[n]=e,a[n]=g[u],s[n]=f[u],c[n]=i);continue}}}}let h=o.indexOf(e);if(-1!==h){b[u]=l[h],++d[h],S[u]=h;continue}h=o.length,S[u]=h,d[h]=1+n,o[h]=e,s[h]=f[u],a[h]=g[u],c[h]=y[u];const v=D();l[h]=v,b[u]=v}}const p=this.dimensionRefCounts;p.clear();let f=0,g=o.length;for(const x of t){const e=x.space.value,t=u[f++],n=e.rank,i=v()(e.names),r=v()(e.timestamps),l=Float64Array.from(e.scales),d=v()(e.units);for(let u=0;u<n;++u){const e=t[u];void 0!==e&&(d[u]=s[e],l[u]=a[e],r[u]=c[e],i[u]=o[e])}for(const o of i){let e=p.get(o);void 0===e?e=1:++e,p.set(o,e)}if(!(0,w.r1)(d,e.units)||!(0,w.r1)(l,e.scales)||!(0,w.r1)(i,e.names)||!(0,w.r1)(r,e.timestamps)){const t=_({valid:e.valid,ids:e.ids,scales:l,units:d,names:i,timestamps:r,boundingBoxes:e.boundingBoxes,coordinateArrays:e.coordinateArrays});x.prevValue=t,x.space.value=t}}{for(let t=0;t<g;++t)i(o[t])||(d[t]=0);const e=(e,t)=>0!==d[t];o=o.filter(e),s=s.filter(e),a=a.filter(e),l=l.filter(e),c=c.filter(e),d=d.filter(e),g=o.length}const m=[],y=new Array(g);for(let v=0,w=r.rank;v<w;++v){const e=r.coordinateArrays[v];if(!(null===e||void 0===e?void 0:e.explicit))continue;const t=l.indexOf(r.ids[v]);-1!==t&&(y[t]=[e])}for(const v of t){const e=v.space.value,t=e.rank,n=e.boundingBoxes,i=e.coordinateArrays,r=e.names.map((e=>o.indexOf(e)));for(const o of n)m.push(Y(o,g,r));for(let o=0;o<t;++o){const e=i[o];if(void 0===e)continue;const t=r[o],n=y[t];void 0===n?y[t]=[e]:n.push(e)}}const b=new Array(g);for(let v=0;v<g;++v){const e=y[v];void 0!==e&&(b[v]=R(e))}const S=_({valid:h,ids:l,names:o,units:s,scales:new Float64Array(a),boundingBoxes:m,coordinateArrays:b});if(n)for(let v=0;v<g;++v)--d[v];N(r,S)||(this.prevCombined=S,e.value=S)}retain(){return++this.retainCount,()=>{0===--this.retainCount&&this.update()}}bind(e){const t={space:e,mappedDimensionIds:[],prevValue:void 0},n=this.bindings;0===n.size&&this.combined.changed.add(this.handleCombinedChanged),n.add(t);const i=e.changed.add((()=>{e.value!==t.prevValue&&this.update()}));return this.update(),()=>{i();const e=this.bindings;e.delete(t),0===e.size&&this.combined.changed.remove(this.handleCombinedChanged),this.update()}}}function pe(e,t,n,i,r){const o=r.length,s=new e((o+1)**2);s[s.length-1]=1;for(let a=0;a<o;++a){const e=i[a];s[(o+1)*o+a]=t[(n+1)*n+e];for(let i=0;i<o;++i){const l=r[i];s[(o+1)*i+a]=t[(n+1)*l+e]}}return s}function fe(e){if(void 0===e)return;const t=new Float64Array(16);if(Array.isArray(e))if(16===e.length)for(let n=0;n<4;++n)for(let i=0;i<4;++i)t[4*n+i]=(0,C.verifyFiniteFloat)(e[4*i+n]);else{(0,C.expectArray)(e,4);for(let n=0;n<4;++n){const i=(0,C.expectArray)(e[n],4);for(let e=0;e<4;++e)t[4*e+n]=(0,C.verifyFiniteFloat)(i[e])}}else{(0,C.verifyObject)(e);const n=x.Yu.create(),i=x.eR.create(),r=x.eR.fromValues(1,1,1);(0,C.verifyOptionalObjectProperty)(e,"rotation",(e=>{(0,C.parseFiniteVec)(n,e),x.Yu.normalize(n,n)})),(0,C.verifyOptionalObjectProperty)(e,"translation",(e=>{(0,C.parseFiniteVec)(i,e)})),(0,C.verifyOptionalObjectProperty)(e,"scale",(e=>{(0,C.parseFiniteVec)(r,e)}));const o=x.pB.create();x.pB.fromRotationTranslationScale(o,n,i,r),t.set(o)}return{sourceRank:3,transform:t,outputSpace:_({valid:!0,names:["x","y","z"],units:["m","m","m"],scales:Float64Array.of(1e-9,1e-9,1e-9)}),inputSpace:void 0}}function ge(e){if(void 0===e)return;const t=(0,C.verifyObject)(e),n=(0,C.verifyObjectProperty)(t,"outputDimensions",U),i=n.rank,r=(0,C.verifyObjectProperty)(t,"sourceRank",(e=>{if(void 0===e)return i;if(!s()(e)||e<0||e>i)throw new Error("Expected integer in range [0, ".concat(i,"] but received: ").concat(f()(e)));return e})),o=(0,C.verifyOptionalObjectProperty)(t,"inputDimensions",(e=>{const t=U(e,!0);if(t.rank!==i)throw new Error("Expected rank of ".concat(i,", but received rank of: ").concat(t.rank));return t})),a=(0,C.verifyOptionalObjectProperty)(t,"matrix",(e=>{const t=new Float64Array((i+1)**2),n=(0,C.expectArray)(e,i);t[t.length-1]=1;for(let o=0;o<i;++o)try{const e=(0,C.expectArray)(n[o],i+1);for(let n=0;n<=i;++n)t[(i+1)*n+o]=(0,C.verifyFiniteFloat)(e[n])}catch(r){throw new Error("Error in row ".concat(o,": ").concat(r.message))}return t}));return{transform:a,outputSpace:n,inputSpace:o,sourceRank:r}}function me(e){if(void 0===e)return;const t=e.transform,n=e.outputSpace,i=e.inputSpace,r=e.sourceRank;let o;const s=n.rank;if(void 0!==t){o=[];for(let e=0;e<s;++e){const n=[];o[e]=n;for(let i=0;i<=s;++i)n[i]=t[(s+1)*i+e]}}return{sourceRank:r===s?void 0:r,matrix:o,outputDimensions:z(n),inputDimensions:void 0===i?void 0:z(i)}}function ve(e,t){const n=e.ids,i=e.names,r=e.scales,o=e.units,s=e.timestamps,a=e.coordinateArrays;return _({rank:t.length,valid:e.valid,ids:t.map((e=>n[e])),names:t.map((e=>i[e])),timestamps:t.map((e=>s[e])),scales:Float64Array.from(t,(e=>r[e])),units:t.map((e=>o[e])),coordinateArrays:t.map((e=>a[e])),boundingBoxes:e.boundingBoxes.map((n=>function(e,t,n){const i=e.box,r=e.transform,o=e.box.lowerBounds.length,s=t.length,a=new Float64Array((o+1)*s);for(let l=0;l<s;++l)for(let e=0;e<=o;++e){const i=t[l];a[l+e*s]=r[i+e*n]}if(!a.every((e=>0===e)))return{transform:a,box:i}}(n,t,e.rank))).filter((e=>void 0!==e))})}function ye(e,t,n){return t===n?e:ve(e,(0,w.ep)(e.rank,n,t))}function be(e,t){const n=e.transform,i=e.rank,r=(0,x.PC)(n,i,[t]);if(1!==r.length)return;const o=(0,g.A)(r,1)[0],s=Math.abs(n[(i+1)*o+t]),a=e.inputSpace;return{scale:a.scales[o]*s,unit:a.units[o]}}function Se(e,t){var n=e.defaultInputSpace;const i=n.scales,r=n.units;return t<i.length?{scale:i[t],unit:r[t]}:void 0}},9285:(e,t,n)=>{n.d(t,{X:()=>i});const i=new(n(2784).qr)},8176:(e,t,n)=>{n.d(t,{R:()=>h});var i=n(7399),r=n.n(i),o=n(2959),s=n(2686);const a=32,l=3,c=500,d=1e4;function u(e){return Math.min(2**e*c,d/2)*(1+Math.random())}async function h(e,t,n,i,c,d){let h,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o.fx;e:for(let g=0;;){(0,o.Dq)(p),g>1&&await new(r())((e=>setTimeout(e,u(g-2)))),h=await e.get(h,p);t:for(let e=0;;)try{return await(0,s.Bk)("function"===typeof t?t(h.credentials):t,c(h.credentials,n),i,p)}catch(f){if(f instanceof s.j$){if("refresh"===d(f,h.credentials)){if(++g===l)throw f;continue e}if(++e===a)throw f;await new(r())((t=>setTimeout(t,u(e-1))));continue t}throw f}}}},2784:(e,t,n)=>{n.d(t,{qr:()=>v,uO:()=>f,uw:()=>h,vy:()=>y});var i=n(7399),r=n.n(i),o=n(984),s=n.n(o),a=n(608),l=n.n(a),c=n(2959),d=n(7562),u=n(5870);class h extends d.O8{}function p(e){let t,n,i;return(r,o)=>void 0===n||void 0!==t&&void 0!==r&&t.generation===r.generation?(t=void 0,i=new c.y3,n=e(r,i).then((e=>(t=e,i=void 0,e)),(e=>{throw i.isCanceled&&(i=void 0,n=void 0),e})),n):(void 0===t&&i.addConsumer(o),n)}function f(e){let t=0;return p(((n,i)=>e(i).then((e=>({generation:++t,credentials:e})))))}class g{constructor(){this.providers=new(l()),this.topLevelManager=this}register(e,t){this.providers.set(e,t)}getCredentialsProvider(e,t){const n=this.providers.get(e);if(void 0===n)throw new Error("No registered credentials provider: ".concat(s()(e)));return n(t,this.topLevelManager)}}class m extends d.O8{constructor(e){super(),this.base=e,this.memoize=new u.e}getCredentialsProvider(e,t){return this.memoize.get({key:e,parameters:t},(()=>this.registerDisposer(this.base.getCredentialsProvider(e,t).addRef())))}}class v extends m{constructor(){super(new g),this.base.topLevelManager=this}register(e,t){this.base.register(e,t)}}class y extends h{constructor(e,t){super(),this.baseProvider=e,this.anonymousCredentials=t,this.anonymous=!0,this.get=p((e=>this.anonymous&&void 0===e?r().resolve({generation:-10,credentials:this.anonymousCredentials}):(this.anonymous=!1,this.baseProvider.get(e))))}}},8781:(e,t,n)=>{n.d(t,{Y:()=>l});var i=n(3651),r=n.n(i),o=n(8176),s=n(2959),a=n(2686);function l(e,t,n,i){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s.fx;return void 0===e?(0,a.Bk)(t,n,i,l):(0,o.R)(e,t,n,i,((e,t)=>{if(!e.accessToken)return t;const n=new Headers(t.headers);return n.set("Authorization","".concat(e.tokenType," ").concat(e.accessToken)),r()(r()({},t),{headers:n})}),((e,t)=>{const n=e.status;if(401===n)return"refresh";if(504===n||503===n)return"retry";if(403===n&&!t.accessToken)return"refresh";throw e}),l)}},9312:(e,t,n)=>{n.d(t,{Q:()=>c,Z:()=>l});var i=n(2982),r=n(608),o=n.n(r),s=n(2579);const a=new(o());function l(e,t){a.set(e,t)}function c(e){const t=new s.Kz(e.credentialsManager);for(const r of a){var n=(0,i.A)(r,2);const o=n[0],s=n[1];t.register(o,s(e))}return t}},2579:(e,t,n)=>{n.d(t,{Kz:()=>M,Lx:()=>x,Q4:()=>k,Yw:()=>L,Zj:()=>T,h0:()=>i,tc:()=>E});var i,r=n(7399),o=n.n(r),s=n(974),a=n.n(s),l=n(3651),c=n.n(l),d=n(1274),u=n.n(d),h=n(984),p=n.n(h),f=n(2982),g=n(608),m=n.n(g),v=n(8332),y=n(2959),b=n(6974),S=n(7562),w=n(2729);class x extends Error{constructor(e){super("Redirected to: ".concat(e)),this.redirectTarget=e}}function C(e,t){void 0===t&&(t=-1===e.indexOf("/")?":":"/");let n=e.lastIndexOf(t);return-1===n?0:n+1}function k(){return{url:"",transform:void 0,enableDefaultSubsources:!0,subsources:new(m())}}!function(e){e[e.annotations=0]="annotations",e[e.equivalences=1]="equivalences"}(i||(i={}));class E extends S.O8{normalizeUrl(e){return e.url}convertLegacyUrl(e){return e.url}async completeUrl(e){throw null}}const T="local://annotations",L="local://equivalences";class P extends E{get description(){return"Local in-memory"}async get(e){switch(e.url){case T:{let t;if(void 0===e.transform){const n=e.globalCoordinateSpace.value,i=n.rank,r=n.names,o=n.scales,s=n.units;t={rank:i,sourceRank:i,inputSpace:(0,v.d)({rank:i,scales:o,units:s,names:r.map(((e,t)=>"".concat(t)))}),outputSpace:(0,v.d)({rank:i,scales:o,units:s,names:r}),transform:(0,w.DA)(Float64Array,i+1)}}else t=(0,v.FH)(v._c);return{modelTransform:t,canChangeModelSpaceRank:!0,subsources:[{id:"default",default:!0,subsource:{local:i.annotations}}]}}case L:return{modelTransform:(0,v.FH)(v._c),canChangeModelSpaceRank:!1,subsources:[{id:"default",default:!0,subsource:{local:i.equivalences}}]}}throw new Error("Invalid local data source URL")}async completeUrl(e){return{offset:0,completions:(0,b.BH)(e.providerUrl,[{value:"annotations",description:"Annotations stored in the JSON state"},{value:"equivalences",description:"Segmentation equivalence graph stored in the JSON state"}],(e=>e.value),(e=>e.description))}}}const D=/^(?:([a-zA-Z][a-zA-Z0-9-+_]*):\/\/)?(.*)$/;class M extends S.O8{constructor(e){super(),this.credentialsManager=e,this.dataSources=new(m())([["local",new P]])}register(e,t){this.dataSources.set(e,this.registerDisposer(t))}getProvider(e){const t=e.match(D);if(null===t||void 0===t[1])throw new Error('Data source URL must have the form "<protocol>://<path>".');var n=(0,f.A)(t,3);const i=n[1],r=n[2],o=this.dataSources.get(i);if(void 0===o)throw new Error("Unsupported data source: ".concat(p()(i),"."));return[o,r,i]}async get(e){const t=new(u());var n=e.cancellationToken;const i=void 0===n?y.fx:n;let r=e.url;for(;;){var o=this.getProvider(e.url),s=(0,f.A)(o,3);const n=s[0],d=s[1],u=s[2];t.add(e.url);try{return n.get(c()(c()({},e),{url:r,providerProtocol:u,providerUrl:d,registry:this,cancellationToken:i,credentialsManager:this.credentialsManager}))}catch(l){if(l instanceof x){const e=l.redirectTarget;if(t.has(e))throw Error("Layer source redirection contains loop: ".concat(p()(a()(t))));if(t.size>=10)throw Error("Too many layer source redirections: ".concat(p()(a()(t))));r=e;continue}throw l}}}convertLegacyUrl(e){try{var t=this.getProvider(e.url),n=(0,f.A)(t,3);const i=n[0],r=n[1],o=n[2];return i.convertLegacyUrl(c()(c()({},e),{providerUrl:r,providerProtocol:o,registry:this}))}catch(i){return e.url}}normalizeUrl(e){try{var t=this.getProvider(e.url),n=(0,f.A)(t,3);const i=n[0],r=n[1],o=n[2];return i.normalizeUrl(c()(c()({},e),{providerUrl:r,providerProtocol:o,registry:this}))}catch(i){return e.url}}async completeUrl(e){const t=e.url;var n=e.cancellationToken;const i=void 0===n?y.fx:n;let r=t.match(D),s=r[1];if(void 0===s)return o().resolve({offset:0,completions:(0,b.BH)(t,this.dataSources,(e=>{let[t]=e;return"".concat(t,"://")}),(e=>{let[,t]=e;return t.description}))});{const n=this.dataSources.get(s);if(void 0!==n){const o=await n.completeUrl({registry:this,url:t,providerUrl:r[2],chunkManager:e.chunkManager,cancellationToken:i,credentialsManager:this.credentialsManager});return(0,b.KV)(s.length+3,o)}throw null}}suggestLayerName(e){var t=this.getProvider(e),n=(0,f.A)(t,2);let i=n[0],r=n[1];r.endsWith("/")&&(r=r.substring(0,r.length-1));let o=i.suggestLayerName;return void 0!==o?o(r):function(e,t){let n=C(e,t);return e.substring(n)}(r)}findSourceGroup(e){var t=this.getProvider(e),n=(0,f.A)(t,3);let i=n[0],r=n[1],o=n[2];return(i.findSourceGroup||C)(r)+o.length+3}}},1434:(e,t,n)=>{n.d(t,{A3:()=>x,Y5:()=>S,Rr:()=>m,yD:()=>b,p9:()=>w,sD:()=>v,uQ:()=>y});var i=n(608),r=n.n(i),o=n(1274),s=n.n(o),a=n(974),l=n.n(a),c=n(2982),d=n(7160),u=n(2038),h=n(7562),p=n(7970),f=n(6344),g=n(5870);class m{constructor(){this.width=0,this.height=0,this.logicalWidth=0,this.logicalHeight=0,this.visibleLeftFraction=0,this.visibleTopFraction=0,this.visibleWidthFraction=0,this.visibleHeightFraction=0}}function v(e,t){const n=1/e.visibleWidthFraction,i=1/e.visibleHeightFraction,r=-1-(2*e.visibleLeftFraction-1)*n;let o=-1-(2*e.visibleTopFraction-1)*i;o=-o,t[0]=t[0]*n+t[3]*r,t[4]=t[4]*n+t[7]*r,t[8]=t[8]*n+t[11]*r,t[12]=t[12]*n+t[15]*r,t[1]=t[1]*i+t[3]*o,t[5]=t[5]*i+t[7]*o,t[9]=t[9]*i+t[11]*o,t[13]=t[13]*i+t[15]*o}function y(e,t){return e.width===t.width&&e.height===t.height&&e.logicalWidth===t.logicalWidth&&e.logicalHeight===t.logicalHeight&&e.visibleLeftFraction===t.visibleLeftFraction&&e.visibleTopFraction===t.visibleTopFraction}class b extends h.O8{constructor(e,t,n){super(),this.context=e,this.element=t,this.visibility=n,this.boundsGeneration=-1,this.canvasRelativeClippedLeft=0,this.canvasRelativeClippedTop=0,this.canvasRelativeLogicalLeft=0,this.canvasRelativeLogicalTop=0,this.renderViewport=new m,this.boundsObserversRegistered=!1,this.gl=e.gl,e.addPanel(this)}scheduleRedraw(){this.visible&&this.context.scheduleRedraw()}ensureBoundsUpdated(){const e=this.context;e.ensureBoundsUpdated();const t=e.boundsGeneration;if(t===this.boundsGeneration)return;this.boundsGeneration=t;const n=this.element;!this.boundsObserversRegistered&&e.monitorPanel(n)&&(this.boundsObserversRegistered=!0);const i=n.getBoundingClientRect(),r=e.container,o=e.canvasRect,s=e.canvas,a=s.width,l=s.height,c=a/o.width,d=l/o.height,u=o.left,h=o.top;let p=this.canvasRelativeLogicalLeft=Math.round((i.left-u)*c+n.clientLeft),f=this.canvasRelativeLogicalTop=Math.round((i.top-h)*d+n.clientTop),g=n.clientWidth,m=n.clientHeight,v=f,y=p,b=p+g,S=f+m;for(let k=n.parentElement;null!==k&&k!==r;k=k.parentElement){const e=k.getBoundingClientRect();0===e.x&&0===e.y&&0===e.width&&0===e.height||(y=Math.max(y,(e.left-u)*c),v=Math.max(v,(e.top-h)*d),b=Math.min(b,(e.right-u)*c),S=Math.min(S,(e.bottom-h)*d))}v=this.canvasRelativeClippedTop=Math.round(Math.max(v,0)),y=this.canvasRelativeClippedLeft=Math.round(Math.max(y,0)),b=Math.round(Math.min(b,a)),S=Math.round(Math.min(S,l));const w=this.renderViewport,x=w.width=Math.max(0,b-y),C=w.height=Math.max(0,S-v);w.logicalWidth=g,w.logicalHeight=m,w.visibleLeftFraction=(y-p)/g,w.visibleTopFraction=(v-f)/m,w.visibleWidthFraction=x/g,w.visibleHeightFraction=C/m}setGLClippedViewport(){const e=this.gl,t=this.canvasRelativeClippedTop,n=this.canvasRelativeClippedLeft;var i=this.renderViewport;const r=i.width,o=i.height,s=t+o;e.enable(WebGL2RenderingContext.SCISSOR_TEST);let a=this.context.canvas.height-s;e.viewport(n,a,r,o),e.scissor(n,a,r,o)}setGLLogicalViewport(){const e=this.gl;var t=this.renderViewport;const n=t.width,i=t.height,r=t.logicalWidth,o=t.logicalHeight,s=this.context.canvas.height;e.enable(WebGL2RenderingContext.SCISSOR_TEST),e.viewport(this.canvasRelativeLogicalLeft,s-(this.canvasRelativeLogicalTop+o),r,o),e.scissor(this.canvasRelativeClippedLeft,s-(this.canvasRelativeClippedTop+i),n,i)}disposed(){this.boundsObserversRegistered&&this.context.unmonitorPanel(this.element),this.context.removePanel(this),super.disposed()}get visible(){return this.visibility.visible}getDepthArray(){}get shouldDraw(){if(!this.visible)return!1;const e=this.element;return 0!==e.clientWidth&&0!==e.clientHeight&&0!==e.offsetWidth&&0!==e.offsetHeight}get drawOrder(){return 0}}class S extends b{constructor(e,t,n){super(e,t,n),this.canvas=document.createElement("canvas"),this.canvasRenderingContext=this.canvas.getContext("2d");const i=this.canvas;t.appendChild(i),t.style.position="relative",i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0"}draw(){this.drawIndirect();const e=this.renderViewport,t=this.canvas,n=e.logicalWidth,i=e.logicalHeight;t.width=n,t.height=i;const r=this.canvasRenderingContext;null===r||void 0===r||r.drawImage(this.context.canvas,this.canvasRelativeLogicalLeft,this.canvasRelativeLogicalTop,n,i,0,0,n,i)}}class w extends d.DN{constructor(){super(Float64Array.of(0,0,1,1),(e=>(0,p.parseFixedLengthArray)(new Float64Array(4),e,p.verifyFloat01)))}toJSON(){const e=this.value;var t=(0,c.A)(e,4);const n=t[0],i=t[1],r=t[2],o=t[3];if(0!==n||0!=i||1!==r||1!==o)return l()(e)}}class x extends h.O8{constructor(e){super(),this.container=e,this.canvas=document.createElement("canvas"),this.updateStarted=new f.IY,this.updateFinished=new f.IY,this.changed=this.updateFinished,this.panels=new(s()),this.resizeGeneration=0,this.boundsGeneration=-1,this.orderedPanels=[],this.frameNumber=0,this.panelAncestors=new(r()),this.resizeCallback=()=>{++this.resizeGeneration,this.scheduleRedraw()},this.resizeObserver=new ResizeObserver(this.resizeCallback),this.scheduleRedraw=this.registerCancellable((0,u.t)((()=>this.draw())));const t=this.canvas,n=this.resizeObserver;e.style.position="relative",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width="100%",t.style.height="100%",t.style.zIndex="0",n.observe(t),e.appendChild(t),this.registerEventListener(t,"webglcontextlost",(e=>{console.log("Lost WebGL context: ".concat(e.statusMessage)),e.preventDefault()})),this.registerEventListener(t,"webglcontextrestored",(()=>{console.log("WebGL context restored"),window.location.reload()})),this.gl=function(e){let t={antialias:!1,stencil:!0},n=e.getContext("webgl2",t);if(null==n)throw new Error("WebGL not supported.");n.memoize=new g.d,n.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),n.max3dTextureSize=n.getParameter(n.MAX_3D_TEXTURE_SIZE),n.maxTextureImageUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),n.tempTextureUnit=n.maxTextureImageUnits-1;for(const i of["EXT_color_buffer_float"])if(!n.getExtension(i))throw new Error("".concat(i," extension not available"));for(const i of["EXT_float_blend"])n.getExtension(i);return n}(t)}monitorPanel(e){const t=this.panelAncestors,n=this.container;if(!n.contains(e))return!1;for(;e!==n;){let n=t.get(e);if(void 0!==n){++n.count;break}const i=e.parentElement;n={parent:i,count:1},t.set(e,n),e.addEventListener("scroll",this.resizeCallback,{capture:!0}),this.resizeObserver.observe(e),e=i}return!0}unmonitorPanel(e){const t=this.panelAncestors,n=this.container;for(;e!==n;){const n=t.get(e);if(1!==n.count){--n.count;break}e.removeEventListener("scroll",this.resizeCallback,{capture:!0}),this.resizeObserver.unobserve(e),t.delete(e),e=n.parent}}applyWindowedViewportToElement(e,t){var n=(0,c.A)(t,4);const i=n[0],r=n[1],o=1/n[2],s=1/n[3];e.style.position="absolute",e.style.top="".concat(-s*r*100,"%"),e.style.left="".concat(-o*i*100,"%"),e.style.width="".concat(100*o,"%"),e.style.height="".concat(100*s,"%"),++this.resizeGeneration,this.scheduleRedraw()}isReady(){for(const e of this.panels)if(e.visible&&!e.isReady())return!1;return!0}makeCanvasOverlayElement(){const e=document.createElement("div");return e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",e.style.zIndex="2",this.container.appendChild(e),e}disposed(){this.orderedPanels.length=0,this.resizeObserver.disconnect()}addPanel(e){this.panels.add(e),this.orderedPanels.length=0,++this.resizeGeneration,this.scheduleRedraw()}removePanel(e){this.panels.delete(e),this.orderedPanels.length=0,++this.resizeGeneration,this.scheduleRedraw()}ensureBoundsUpdated(){const e=this.resizeGeneration;if(this.boundsGeneration===e)return;const t=this.canvas;t.width=t.offsetWidth,t.height=t.offsetHeight,this.canvasRect=t.getBoundingClientRect(),this.boundsGeneration=e}draw(){++this.frameNumber,this.updateStarted.dispatch();let e=this.gl;this.ensureBoundsUpdated(),this.gl.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);const t=this.orderedPanels,n=this.panels;t.length!==n.size&&(t.push(...n),t.sort(((e,t)=>e.drawOrder-t.drawOrder)));for(const i of t){if(!i.shouldDraw)continue;i.ensureBoundsUpdated();const e=i.renderViewport;0!==e.width&&0!==e.height&&i.draw()}e.disable(e.SCISSOR_TEST),this.gl.clearColor(1,1,1,1),this.gl.colorMask(!1,!1,!1,!0),e.clear(e.COLOR_BUFFER_BIT),this.gl.colorMask(!0,!0,!0,!0),this.updateFinished.dispatch()}getDepthArray(){var e=this.canvas;const t=e.width,n=e.height,i=new Float32Array(t*n);for(const o of this.panels){if(!o.shouldDraw)continue;const e=o.getDepthArray();if(void 0===e)continue;const t=o.canvasRelativeClippedTop,n=o.canvasRelativeClippedLeft;var r=o.renderViewport;const s=r.width,a=r.height;for(let r=0;r<a;++r){const o=(a-1-r)*s;i.set(e.subarray(o,o+s),(t+r)*s+n)}}return i}}},648:(e,t,n)=>{n.d(t,{_:()=>a});var i=n(8250),r=n.n(i);const o=3432918353,s=461845907;function a(e,t){return t>>>=0,e>>>=0,t=((t=r()(t,o)>>>0)<<15|t>>>17)>>>0,e=5*(e=((e=(e^(t=r()(t,s)>>>0))>>>0)<<13|e>>>19)>>>0)+3864292196>>>0}},1110:(e,t,n)=>{n.d(t,{Ky:()=>c,LN:()=>g,Tg:()=>S});var i=n(2982),r=n(281),o=n.n(r),s=n(648),a=n(4035),l=n(8194);const c=3;let d=0,u=0,h=0,p=0;class f{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.generateHashSeeds(c);this.hashSeeds=e,this.loadFactor=.8,this.size=0,this.emptyLow=4294967295,this.emptyHigh=4294967295,this.maxRehashAttempts=5,this.maxAttempts=5,this.generation=0,this.mungedEmptyKey=-1;let t=8;for(;t<2*e.length;)t*=2;this.allocate(t)}updateHashFunctions(e){this.hashSeeds=f.generateHashSeeds(e),this.mungedEmptyKey=-1}tableWithMungedEmptyKey(e){const t=this.hashSeeds.length,n=new Array(t);for(let a=0;a<t;++a)n[a]=this.getHash(a,this.emptyLow,this.emptyHigh);let i=this.mungedEmptyKey;if(-1===i)e:for(;;){i=16777216*Math.random()>>>0;for(let e=0;e<t;++e){let r=this.getHash(e,i,i);for(let e=0;e<t;++e)if(n[e]===r)continue e}this.mungedEmptyKey=i;break}let r=this.table,o=this.emptyLow,s=this.emptyHigh;for(let a=0;a<t;++a){let e=n[a];r[e]===o&&r[e+1]===s&&(r[e]=i,r[e+1]=i)}try{e(r)}finally{for(let e=0;e<t;++e){let t=n[e];r[t]===i&&r[t+1]===i&&(r[t]=o,r[t+1]=s)}}}static generateHashSeeds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;return(0,a.UY)(new Uint32Array(e))}getHash(e,t,n){let i=this.hashSeeds[e];return i=(0,s._)(i,t),i=(0,s._)(i,n),this.entryStride*(i&this.tableSize-1)}*keys(){let e=this.emptyLow,t=this.emptyHigh,n=this.entryStride,i=this.table;for(let r=0,o=i.length;r<o;r+=n){let n=i[r],o=i[r+1];n===e&&o===t||(yield new l.Uint64(n,o))}}unsafeKeys(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new l.Uint64;return function*(){let n=e.emptyLow,i=e.emptyHigh,r=e.entryStride,o=e.table;for(let e=0,s=o.length;e<s;e+=r){let r=o[e],s=o[e+1];r===n&&s===i||(t.low=r,t.high=s,yield t)}}()}indexOfPair(e,t){let n=this.table,i=this.emptyLow,r=this.emptyHigh;if(e===i&&t===r)return-1;for(let o=0,s=this.hashSeeds.length;o<s;++o){let i=this.getHash(o,e,t);if(n[i]===e&&n[i+1]===t)return i}return-1}indexOf(e){return this.indexOfPair(e.low,e.high)}chooseAnotherEmptyKey(){let e,t,n=this.emptyLow,i=this.emptyHigh,r=this.table,o=this.entryStride;for(;e=4294967296*Math.random()>>>0,t=4294967296*Math.random()>>>0,e===n&&t===i||this.hasPair(e,t););this.emptyLow=e,this.emptyHigh=t;for(let s=0,a=r.length;s<a;s+=o)r[s]===n&&r[s+1]===i&&(r[s]=e,r[s+1]=t)}has(e){return-1!==this.indexOf(e)}hasPair(e,t){return-1!==this.indexOfPair(e,t)}delete(e){let t=this.indexOf(e);if(-1!==t){let e=this.table;return e[t]=this.emptyLow,e[t+1]=this.emptyHigh,++this.generation,this.size--,!0}return!1}clearTable(){let e=this.table,t=this.entryStride,n=this.emptyLow,i=this.emptyHigh,r=e.length;for(let o=0;o<r;o+=t)e[o]=n,e[o+1]=i}clear(){return 0!==this.size&&(this.size=0,++this.generation,this.clearTable(),!0)}reserve(e){return e>this.capacity&&(this.backupPending(),this.grow(e),this.restorePending(),!0)}swapPending(e,t){let n=d,i=u;this.storePending(e,t),e[t]=n,e[t+1]=i}storePending(e,t){d=e[t],u=e[t+1]}backupPending(){h=d,p=u}restorePending(){d=h,u=p}tryToInsert(){let e=0,t=this.emptyLow,n=this.emptyHigh,i=this.maxAttempts,r=this.table,o=this.hashSeeds.length,s=Math.floor(Math.random()*o);for(;;){let a=this.getHash(s,d,u);if(this.swapPending(r,a),d===t&&u===n)return!0;if(++e===i)break;s=(s+Math.floor(Math.random()*(o-1))+1)%o}return!1}allocate(e){this.tableSize=e;let t=this.entryStride;this.table=new Uint32Array(e*t),this.maxAttempts=e,this.clearTable(),this.capacity=e*this.loadFactor,this.mungedEmptyKey=-1}rehash(e,t){this.allocate(t),this.updateHashFunctions(this.hashSeeds.length);let n=this.emptyLow,i=this.emptyHigh,r=this.entryStride;for(let o=0,s=e.length;o<s;o+=r){let t=e[o],r=e[o+1];if((t!==n||r!==i)&&(this.storePending(e,o),!this.tryToInsert()))return!1}return!0}grow(e){let t=this.table,n=this.tableSize;for(;n<e;)n*=2;for(;;){for(let e=0;e<this.maxRehashAttempts;++e)if(this.rehash(t,n))return void 0;n*=2}}insertInternal(){for(++this.generation,d===this.emptyLow&&u===this.emptyHigh&&this.chooseAnotherEmptyKey(),++this.size>this.capacity&&(this.backupPending(),this.grow(2*this.tableSize),this.restorePending());!this.tryToInsert();)this.backupPending(),this.grow(this.tableSize),this.restorePending()}}class g extends f{add(e){let t=e.low,n=e.high;return!this.hasPair(t,n)&&(d=t,u=n,this.insertInternal(),!0)}[o()](){return this.unsafeKeys()}}g.prototype.entryStride=2;let m=0,v=0,y=0,b=0;class S extends f{set(e,t){let n=e.low,i=e.high;return!this.hasPair(n,i)&&(d=n,u=i,m=t.low,v=t.high,this.insertInternal(),!0)}get(e,t){let n=this.indexOf(e);if(-1===n)return!1;let i=this.table;return t.low=i[n+2],t.high=i[n+3],!0}swapPending(e,t){let n=m,i=v;super.swapPending(e,t),e[t+2]=n,e[t+3]=i}storePending(e,t){super.storePending(e,t),m=e[t+2],v=e[t+3]}backupPending(){super.backupPending(),y=m,b=v}restorePending(){super.restorePending(),m=y,v=b}[o()](){return this.unsafeEntries()}*entries(){let e=this.emptyLow,t=this.emptyHigh,n=this.entryStride,i=this.table;for(let r=0,o=i.length;r<o;r+=n){let n=i[r],o=i[r+1];if(n!==e||o!==t){let e=new l.Uint64(n,o),t=new l.Uint64(i[r+2],i[r+3]);yield[e,t]}}}unsafeEntries(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new l.Uint64,new l.Uint64];return function*(){let n=e.emptyLow,r=e.emptyHigh,o=e.entryStride,s=e.table;var a=(0,i.A)(t,2);let l=a[0],c=a[1];for(let e=0,i=s.length;e<i;e+=o){let i=s[e],o=s[e+1];i===n&&o===r||(l.low=i,l.high=o,c.low=s[e+2],c.high=s[e+3],yield t)}}()}}S.prototype.entryStride=4},968:(e,t,n)=>{n.d(t,{F7:()=>h,dD:()=>d,t$:()=>f,vb:()=>p});var i=n(1288),r=n.n(i),o=n(1110),s=n(9043),a=n(7562),l=n(6098),c=n(2025);const d=[l.sZ,"\nhighp uint hashCombine(highp uint state, highp uint value) {\n  value *= 0xcc9e2d51u;\n  value = (value << 15u) | (value >> 17u);\n  value *= 0x1b873593u;\n  state ^= value;\n  state = (state << 13u) | (state >> 19u);\n  state = (state * 5u) + 0xe6546b64u;\n  return state;\n}\nhighp uint hashCombine(highp uint state, uint64_t x) {\n  state = hashCombine(state, x.value[0]);\n  return hashCombine(state, x.value[1]);\n}\n"],u=(0,c.YY)(new c.nC,s.pe.UINT64,1);class h extends a.O8{constructor(e,t){super(),this.gl=e,this.hashTable=t,this.generation=-1,this.texture=null,this.texture=e.createTexture()}copyToGPU(){let e=this.hashTable,t=e.generation;if(this.generation===t)return;const n=this.gl,i=this.texture;this.generation=t,n.activeTexture(WebGL2RenderingContext.TEXTURE0+n.tempTextureUnit),n.bindTexture(WebGL2RenderingContext.TEXTURE_2D,i),e.tableWithMungedEmptyKey((e=>{(0,c.pK)(this.gl,u,e)})),n.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}disposed(){this.gl.deleteTexture(this.texture),this.texture=null,this.gl=void 0,this.hashTable=void 0,super.disposed()}static get(e,t){return e.memoize.get(t,(()=>new this(e,t)))}}class p{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Ky;this.prefix=e,this.numAlternatives=t,this.textureUnitSymbol=r()("gpuhashtable:".concat(this.prefix)),this.accessHelper=new c.R6("gpuhashtable_".concat(this.prefix)),this.samplerName=this.prefix+"_sampler",this.hashSeedsName=this.prefix+"_seeds",this.hashKeyMask=this.prefix+"_keyMask",this.readTable=this.prefix+"_readTable"}defineShader(e){let t=this.hashSeedsName,n=this.samplerName,i=this.numAlternatives,r=this.hashKeyMask;e.addUniform("highp uint",t,i),e.addUniform("highp uint",r),e.addTextureSampler("usampler2D",n,this.textureUnitSymbol),e.addFragmentCode(d),e.addFragmentCode(l.sZ),e.addFragmentCode(l.CQ),this.accessHelper.defineShader(e),e.addFragmentCode(this.accessHelper.getAccessor(this.readTable,this.samplerName,s.pe.UINT64,1));let o="";o+="\nbool ".concat(this.hasFunctionName,"(uint64_t x) {\n");for(let s=0;s<i;++s)o+="\n  {\n    uint h = hashCombine(".concat(t,"[").concat(s,"], x) & ").concat(r,";\n    uint64_t key = ").concat(this.readTable,"(h);\n    if (equals(key, x)) {\n      return true;\n    }\n  }\n");o+="\n  return false;\n}\n",e.addFragmentCode(o)}get hasFunctionName(){return"".concat(this.prefix,"_has")}enable(e,t,n){n.copyToGPU();const i=t.textureUnit(this.textureUnitSymbol);e.activeTexture(WebGL2RenderingContext.TEXTURE0+i),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,n.texture),e.uniform1ui(t.uniform(this.hashKeyMask),n.hashTable.tableSize-1),e.uniform1uiv(t.uniform(this.hashSeedsName),n.hashTable.hashSeeds)}disable(e,t){const n=t.textureUnit(this.textureUnitSymbol);e.activeTexture(WebGL2RenderingContext.TEXTURE0+n),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}}class f extends p{defineShader(e){super.defineShader(e);let t=this.numAlternatives,n=this.hashSeedsName,i=this.hashKeyMask,r="\nbool ".concat(this.getFunctionName,"(uint64_t x, out uint64_t value) {\n");for(let o=0;o<t;++o)r+="\n  {\n    uint h = hashCombine(".concat(n,"[").concat(o,"], x) & ").concat(i,";\n    uint64_t key = ").concat(this.readTable,"(h * 2u);\n    if (equals(key, x)) {\n      value = ").concat(this.readTable,"(h * 2u + 1u);\n      return true;\n    }\n  }\n");r+="\n  return false;\n}\n",e.addFragmentCode(r)}get getFunctionName(){return"".concat(this.prefix,"_get")}}},2858:(e,t,n)=>{n.d(t,{TR:()=>Ke,tX:()=>st,nB:()=>Ze,R8:()=>gt,o5:()=>at,Qk:()=>Je,vC:()=>Xe,h7:()=>Pt,u7:()=>ot,Mh:()=>ft,D0:()=>et,J3:()=>qe,ZV:()=>Mt,Rs:()=>Ct,QG:()=>xt,TC:()=>kt,G$:()=>ut,vK:()=>mt,Ar:()=>ht,du:()=>rt,LJ:()=>bt,lV:()=>St,zQ:()=>wt});var i=n(984),r=n.n(i),o=n(3008),s=n.n(o),a=n(1190),l=n.n(a),c=n(281),d=n.n(c),u=n(2982),h=n(608),p=n.n(h),f=n(7737),g=n.n(f),m=n(1274),v=n.n(m),y=n(3651),b=n.n(y),S=n(974),w=n.n(S),x=n(5491),C=n.n(x),k=n(492),E=n.n(k),T=n(8332),L=n(2579),P=n(575),D=n(201),M=n(3295),I=n(9859),R=n(7965),A=n(7160),O=n(6423),N=n(1406),_=n(954),V=n(2038),B=n(9043),F=n(7562),U=n(3162),z=n(8164),j=n(680),G=n(8178),W=n.n(G),H=n(1963),q=n.n(H),Y=n(5792),J=n.n(Y),K=n(9735),X=n(1058),Z=n(2729),Q=n(8774),$=n(2240),ee=n(1301);function te(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.value;e.style.minWidth=t.length+1+"ch"}const ne="neuroglancer-coordinate-space-transform-singleton";function ie(e,t){let n,i;return n=e===Number.NEGATIVE_INFINITY?"(-\u221e,":"[".concat(Math.floor(e),","),i=t===Number.POSITIVE_INFINITY?"+\u221e)":"".concat(Math.floor(t),")"),{lower:n,upper:i}}const re=Q.n5.fromObject({arrowup:{action:"move-up"},arrowdown:{action:"move-down"},arrowleft:{action:"move-left",preventDefault:!1},arrowright:{action:"move-right",preventDefault:!1},enter:{action:"commit"},escape:{action:"cancel"}});function oe(){const e=document.createElement("div"),t=document.createElement("input");e.classList.add("neuroglancer-coordinate-space-transform-scale-container"),t.spellcheck=!1,t.autocomplete="off",t.size=1,t.classList.add("neuroglancer-coordinate-space-transform-scale"),e.appendChild(t);const n=document.createElement("div"),i=document.createElement("span");i.innerHTML=q(),n.appendChild(i);const r=document.createTextNode("");return n.appendChild(r),n.classList.add("neuroglancer-coordinate-space-transform-scale-suggestion"),e.appendChild(n),{cellElement:e,inputElement:t,suggestionElement:n}}function se(e,t,n,i,r){if(void 0===t||t.scale===n&&t.unit===i)e.style.display="none";else{e.style.display="";const n=(0,$.NJ)(t.scale,t.unit,{elide1:!1});e.lastChild.textContent=n,e.title="".concat(r).concat(n)}}function ae(){const e=document.createElement("input");return e.spellcheck=!1,e.autocomplete="off",e.size=1,e.placeholder=" ",e.classList.add("neuroglancer-coordinate-space-transform-output-name"),e}function le(e,t,n){const i=e.map((e=>(0,$.W7)(e.value)));if(i.includes(void 0))return!1;const r=Float64Array.from(i,(e=>e.scale)),o=w()(i,(e=>e.unit)),s=n.value,a=s.scales,l=s.units,c=s.rank;for(let h=0;h<c;++h)t[h]||(r[h]=a[h],o[h]=l[h]);if((0,K.r1)(a,r)&&(0,K.r1)(l,o))return!1;const d=s.timestamps.map(((e,t)=>r[t]===a[t]&&o[t]===l[t]?e:Date.now())),u=(0,T.d)({valid:s.valid,rank:s.rank,scales:r,units:o,timestamps:d,ids:s.ids,names:s.names,boundingBoxes:s.boundingBoxes,coordinateArrays:s.coordinateArrays});return n.value=u,!0}function ce(e,t,n,i){const r=new Float64Array(e.scales),o=w()(e.units);if(r[t]===n&&o[t]===i)return e;const s=w()(e.timestamps);return r[t]=n,o[t]=i,s[t]=Date.now(),b()(b()({},e),{scales:r,units:o,timestamps:s})}class de extends F.O8{constructor(e,t,n){super(),this.transform=e,this.localCombiner=t,this.globalCombiner=n,this.element=document.createElement("div"),this.coefficientContainer=document.createElement("div"),this.translationContainer=document.createElement("div"),this.outputNameContainer=document.createElement("div"),this.outputScaleContainer=document.createElement("div"),this.inputNameContainer=document.createElement("div"),this.inputScaleContainer=document.createElement("div"),this.inputLowerBoundsContainer=document.createElement("div"),this.inputUpperBoundsContainer=document.createElement("div"),this.coefficientElements=[],this.inputNameElements=[],this.outputNameElements=[],this.outputScaleElements=[],this.outputScaleSuggestionElements=[],this.inputScaleSuggestionElements=[],this.inputScaleElements=[],this.inputBoundsElements=[],this.outputBoundsElements=[],this.addSourceDimensionIcon=(0,ee.m)({svg:J(),text:"S"}),this.addOutputDimensionIcon=(0,ee.m)({svg:J(),text:"V"}),this.addOutputDimensionCell=document.createElement("div"),this.addOutputDimensionInput=ae(),this.inputScaleModified=[],this.outputScaleModified=[],this.curSourceRank=-1,this.curRank=-1,this.curTransform=void 0,this.addingSourceDimension=!1,this.resetToIdentityButton=(0,ee.m)({text:"Set to identity",title:"Reset to identity transform",onClick:()=>{const e=this.transform,t=e.value.rank;e.transform=(0,Z.DA)(Float64Array,t+1)}}),this.resetToDefaultButton=(0,ee.m)({text:"Reset to default",title:"Reset to default input scales, transform, and output dimensions.",onClick:()=>{const e=this.transform;if(e.mutableSourceRank)return;const t=e.defaultTransform;let n=t.outputSpace;const i=n.ids.map((()=>(0,T.up)()));e.value=b()(b()({},t),{outputSpace:b()(b()({},n),{ids:i})})}});const i=this.element;this.registerDisposer(new X.cL(i,re)).allShortcutsAreGlobal=!0,i.classList.add("neuroglancer-coordinate-space-transform-widget"),this.registerDisposer(new Q.qy(i,re));const r=(0,V.t)((()=>this.updateView()));this.registerDisposer(e.changed.add(r));const o=this.coefficientContainer,s=this.translationContainer,a=this.outputNameContainer,l=this.inputNameContainer,c=this.inputScaleContainer,d=this.inputLowerBoundsContainer,h=this.inputUpperBoundsContainer,p=this.outputScaleContainer,f=this.addOutputDimensionCell,g=this.addOutputDimensionIcon,m=this.addSourceDimensionIcon,v=this.resetToIdentityButton,y=this.resetToDefaultButton;o.style.display="contents",s.style.display="contents",a.style.display="contents",l.style.display="contents",c.style.display="contents",p.style.display="contents",d.style.display="contents",h.style.display="contents";const S=document.createElement("div");S.classList.add("neuroglancer-coordinate-space-transform-widget-reset-buttons"),v.classList.add("neuroglancer-coordinate-space-transform-widget-reset-to-identity"),y.classList.add("neuroglancer-coordinate-space-transform-widget-reset-to-default"),S.appendChild(v),S.appendChild(y),i.appendChild(S);for(const b of[["source","Source dimensions"],["output","Output dimensions"],["input-lower","Lower"],["input-upper","Upper"],["input-scale","Scale"],["translation","Translation"]]){var w=(0,u.A)(b,2);const e=w[0],t=w[1],n=document.createElement("div");n.classList.add("neuroglancer-coordinate-space-transform-".concat(e,"-label")),n.classList.add("neuroglancer-coordinate-space-transform-label"),n.textContent=t,i.appendChild(n)}e.mutableSourceRank&&f.appendChild(m),f.appendChild(g),f.classList.add("neuroglancer-coordinate-space-transform-output-extend");const x="Embed in additional output dimension",C="Extend to additional source dimension";g.title=x,m.title=C,f.appendChild(this.addOutputDimensionInput),f.dataset.isActive="false",g.addEventListener("click",(()=>{this.addingSourceDimension=!1,this.addOutputDimensionInput.title=x,this.addOutputDimensionCell.dataset.isActive="true",this.addOutputDimensionInput.focus()})),m.addEventListener("click",(()=>{this.addingSourceDimension=!0,this.addOutputDimensionInput.title=C,this.addOutputDimensionCell.dataset.isActive="true",this.addOutputDimensionInput.focus()})),this.addOutputDimensionInput.addEventListener("blur",(()=>{this.updateAddOutputDimensionCellStyle()})),i.appendChild(o),i.appendChild(a),i.appendChild(l),i.appendChild(c),i.appendChild(p),i.appendChild(d),i.appendChild(h),o.appendChild(s),i.addEventListener("input",(e=>{const t=e.target;if(t instanceof HTMLInputElement){te(t);let e=this.inputScaleElements.indexOf(t);if(-1!==e)return this.inputScaleModified[e]=!0,void this.updateScaleValidity(t);if(e=this.outputScaleElements.indexOf(t),-1!==e)return this.outputScaleModified[e]=!0,void this.updateScaleValidity(t);if(e=this.outputNameElements.indexOf(t),-1!==e)return void this.updateOutputNameValidity();if(this.coefficientContainer.contains(t))return void this.updateCoefficientValidity(t)}}));const k=(e,t,n)=>{(0,X.qZ)(i,e,(e=>{e.stopPropagation();const i=e.target;if(!(i instanceof HTMLInputElement))return;if(0!==n&&(i.selectionStart!==i.selectionEnd||i.selectionStart!==(1===n?i.value.length:0)))return;const r=this.getElementGridPosition(i);if(void 0===r)return;const o=this.getElementByGridPosition(r.row+t,r.col+n);null!==o&&(o.focus(),e.preventDefault())}))};k("move-up",-1,0),k("move-down",1,0),k("move-left",0,-1),k("move-right",0,1);const E=(e,t)=>{e.addEventListener("focusout",(n=>{const i=n.relatedTarget;i instanceof Node&&e.contains(i)||t(n)}))};E(o,(()=>{this.updateModelTransform()||this.updateViewTransformCoefficients()})),E(a,(()=>{this.updateModelOutputNames()||this.updateViewOutputNames()})),E(c,(()=>{this.updateModelInputScales()||this.updateViewInputScales()})),E(p,(()=>{this.updateModelOutputScales()||this.updateViewOutputScales()})),(0,X.qZ)(i,"cancel",(e=>{this.curTransform=void 0,this.updateView(),e.target.blur()})),(0,X.qZ)(o,"commit",(()=>{this.updateModelTransform()})),(0,X.qZ)(a,"commit",(()=>{this.updateModelOutputNames()})),(0,X.qZ)(c,"commit",(()=>{this.updateModelInputScales()})),(0,X.qZ)(p,"commit",(()=>{this.updateModelOutputScales()})),i.addEventListener("focusin",(e=>{const t=e.target;t instanceof HTMLInputElement&&t.select()})),this.updateView()}updateWillBeDeletedAttributes(e){const t=this.transform.value.rank;void 0===e&&(e=new Array(t)).fill(!1);const n=this.coefficientElements,i=this.inputBoundsElements,r=this.inputScaleElements;for(let s=0;s<t;++s){const a=e[s];for(let i=0;i<=t;++i){const r=n[t*i+s],o=i<t&&e[i];r.dataset.willBeDeleted=(a||o).toString()}r[s].dataset.willBeDeleted=a.toString();var o=i[s];const l=o.lower,c=o.upper;l.dataset.willBeDeleted=a.toString(),c.dataset.willBeDeleted=a.toString()}}updateAddOutputDimensionCellStyle(){const e=this.addOutputDimensionInput;this.addOutputDimensionCell.dataset.isActive=(0!==e.value.length||document.activeElement===e).toString()}updateOutputNameValidity(){const e=this.outputNameElements,t=e.map((e=>e.value));var n=this.transform,i=n.value;const r=i.sourceRank,o=i.rank,s=n.mutableSourceRank;if(e.length!==o+1)return;const a=(0,T.ii)(t);let l=new Array(o);l.fill(!1);for(let c=0;c<=o;++c){let n=a[c];0===t[c].length&&(s||c>=r)&&(n=!0,l[c]=!0),e[c].dataset.isValid=n.toString()}this.updateWillBeDeletedAttributes(l),this.updateAddOutputDimensionCellStyle()}updateScaleValidity(e){const t=void 0!==(0,$.W7)(e.value);e.dataset.isValid=t.toString()}updateCoefficientValidity(e){const t=W()(Number(e.value));e.dataset.isValid=t.toString()}getElementGridPosition(e){{const t=this.outputNameElements.indexOf(e);if(-1!==t)return{row:t,col:-2}}{const t=this.inputScaleElements.indexOf(e);if(-1!==t)return{row:-1,col:t}}{const t=this.coefficientElements.indexOf(e),n=this.transform.value.rank;if(-1!==t)return{row:t%n,col:Math.floor(t/n)}}{const t=this.outputScaleElements.indexOf(e);if(-1!==t)return{row:t,col:-1}}}getElementByGridPosition(e,t){const n=this.transform.value.rank;return-1===e?t<0||t>=n?null:this.inputScaleElements[t]:-2===t?e<0||e>n?null:this.outputNameElements[e]:-1===t?e<0||e>=n?null:this.outputScaleElements[e]:e<0||e>=n||t<0||t>n?null:this.coefficientElements[t*n+e]}dimensionRefCount(e){return((0,T.AJ)(e)?this.localCombiner:this.globalCombiner).dimensionRefCounts.get(e)||0}updateModelInputScales(){return le(this.inputScaleElements,this.inputScaleModified,this.transform.inputSpace)}updateModelOutputScales(){return le(this.outputScaleElements,this.outputScaleModified,this.transform.outputSpace)}updateModelOutputNames(){const e=this.outputNameElements.map((e=>e.value));var t=this.transform;const n=t.value,i=t.mutableSourceRank,r=n.outputSpace,o=n.rank,s=n.sourceRank;if(e.length!==o+1)return;const a=[],l=[],c=0!==e[o].length;let d=s;for(let y=0;y<=o;++y){const t=e[y];if(0!==t.length)l.push(t),a.push(y);else if(y<s){if(!i)return!1;--d}}if(!(0,T.RV)(l))return!1;const u=r.names;if(!c&&(0,K.r1)(u,l))return!0;let h=n.inputSpace,p=n.outputSpace,f=n.transform;if(c){this.addingSourceDimension&&++d;const t=e[o],n=((0,T.AJ)(t)?this.localCombiner:this.globalCombiner).combined.value,i=n.names.indexOf(t);let s,a;-1!==i?(s=n.units[i],a=n.scales[i]):(s="",a=1);const l=h.boundingBoxes.map((e=>(0,T.p4)(e,o,o+1)));this.addingSourceDimension||l.push((0,T.cL)(o+1,o)),h=(0,T.d)({valid:h.valid,rank:o+1,names:[...h.names,""],ids:[...h.ids,(0,T.up)()],timestamps:[...h.timestamps,Date.now()],scales:Float64Array.from([...h.scales,a]),units:[...h.units,s],boundingBoxes:l,coordinateArrays:[...h.coordinateArrays,void 0]}),p=(0,T.d)({valid:r.valid,rank:o+1,names:[...r.names,t],ids:[...r.ids,(0,T.up)()],timestamps:[...r.timestamps,Date.now()],scales:Float64Array.from([...r.scales,a]),units:[...r.units,s],coordinateArrays:[...r.coordinateArrays,void 0]}),f=(0,Z.Aw)(new Float64Array((o+2)**2),o+1,f,o)}f=(0,T.$d)(Float64Array,f,h.rank,a,a),h=(0,T.vK)(h,a),p=(0,T.vK)(p,a);const g=p.ids.map(((e,t)=>{const n=a[t];if(n===o)return e;const i=l[t],r=u[n];return i===r||1===this.dimensionRefCount(r)&&this.dimensionRefCount(i)===(u.includes(i)?1:0)?e:(0,T.up)()})),m=p.timestamps.map(((e,t)=>{const n=a[t];return n===o||l[t]===u[n]?e:Date.now()}));p=b()(b()({},p),{names:l,ids:g,timestamps:m});let v={rank:p.rank,sourceRank:d,outputSpace:p,inputSpace:h,transform:f};return this.transform.value=v,!0}updateModelTransform(){const e=this.coefficientElements,t=this.transform.value.rank,n=new Float64Array((t+1)**2);n[n.length-1]=1;for(let i=0;i<t;++i)for(let r=0;r<=t;++r){const o=e[r*t+i],s=parseFloat(o.value);if(!W()(s))return!1;n[r*(t+1)+i]=s}return this.transform.transform=n,!0}updateViewOutputNames(){var e=this.transform.value;const t=e.outputSpace,n=e.rank;if(n!==this.curRank)return;const i=this.outputNameElements,r=t.names;for(let o=0;o<n;++o){const e=i[o];e.value=r[o],e.dataset.isValid="true",te(e)}i[n].value="",this.updateWillBeDeletedAttributes()}updateViewTransformCoefficients(){var e=this.transform.value;const t=e.transform,n=e.rank,i=this.coefficientElements;for(let r=0;r<n;++r)for(let e=0;e<=n;++e){const o=i[e*n+r];o.value=t[e*(n+1)+r].toString(),o.dataset.isValid="true",te(o)}}ensureViewRankUpdated(){const e=this.transform.value,t=e.rank,n=e.sourceRank;if(this.curSourceRank===n&&this.curRank===t)return;const i=this.inputBoundsElements,r=this.inputNameElements,o=this.inputScaleElements,s=this.element,a=this.coefficientElements,l=this.outputNameElements,c=this.outputScaleElements,d=this.outputScaleSuggestionElements,u=this.inputScaleSuggestionElements,h=this.outputBoundsElements,p=this.coefficientContainer,f=this.translationContainer,g=this.outputNameContainer,m=this.inputNameContainer,v=this.inputScaleContainer,y=this.inputLowerBoundsContainer,b=this.inputUpperBoundsContainer,S=this.outputScaleContainer;s.style.gridTemplateColumns="[outputLabel headerStart] min-content [outputNames] 1fr [outputScales] 1fr [headerEnd] "+"repeat(".concat(Math.max(1,t)+1,", [sourceDim] 1fr)"),s.style.gridTemplateRows="[sourceLabel headerStart] auto [sourceNames] auto [sourceLower] auto [sourceUpper] auto [sourceScales] auto [headerEnd]"+"repeat(".concat(t+1,", [outputDim] auto)"),(0,U.gS)(p),(0,U.gS)(f),p.appendChild(f),(0,U.gS)(g),(0,U.gS)(m),(0,U.gS)(v),(0,U.gS)(y),(0,U.gS)(b),(0,U.gS)(S),r.length=0,o.length=0,i.length=0,c.length=0,d.length=0,u.length=0,a.length=0,l.length=0,h.length=0;for(let C=0;C<t;++C){const e=e=>{e.classList.add("neuroglancer-coordinate-space-transform-input"),C>=n&&e.classList.add(ne)};{const t=document.createElement("div");t.classList.add("neuroglancer-coordinate-space-transform-input-name"),e(t),t.style.gridRowStart="sourceNames",t.style.gridColumnStart="sourceDim ".concat(C+1),m.appendChild(t),r.push(t)}{var w=oe();const t=w.cellElement,n=w.inputElement,i=w.suggestionElement;t.classList.add("neuroglancer-coordinate-space-transform-input-scale-container"),e(t),t.style.gridRowStart="sourceScales",t.style.gridColumnStart="sourceDim ".concat(C+1),v.appendChild(t),o.push(n),u.push(i);const r=C;i.addEventListener("click",(()=>{const e=(0,T.qx)(this.transform,r);void 0!==e&&(this.transform.inputSpace.value=ce(this.transform.inputSpace.value,r,e.scale,e.unit))}))}{const t=document.createElement("div");e(t),t.classList.add("neuroglancer-coordinate-space-transform-input-bounds"),t.style.gridRowStart="sourceLower",t.style.gridColumnStart="sourceDim ".concat(C+1),y.appendChild(t);const n=document.createElement("div");e(n),n.classList.add("neuroglancer-coordinate-space-transform-input-bounds"),n.style.gridRowStart="sourceUpper",n.style.gridColumnStart="sourceDim ".concat(C+1),b.appendChild(n),i.push({lower:t,upper:n})}}for(let C=0;C<t;++C){for(let e=0;e<=t;++e){const i=document.createElement("input");i.classList.add("neuroglancer-coordinate-space-transform-coeff"),i.spellcheck=!1,i.autocomplete="off",i.size=1,i.style.gridRowStart="outputDim ".concat(C+1),i.placeholder=" ",i.style.gridColumnStart="sourceDim ".concat(e+1),a[e*t+C]=i,e===t?i.classList.add("neuroglancer-coordinate-space-transform-translation-coeff"):e==n&&i.classList.add(ne),(e===t?f:p).appendChild(i)}{var x=oe();const e=x.cellElement,t=x.suggestionElement,n=x.inputElement;e.classList.add("neuroglancer-coordinate-space-transform-output-scale-container"),e.style.gridRowStart="outputDim ".concat(C+1),e.style.gridColumnStart="outputScales";const i=C;t.addEventListener("click",(()=>{const e=this.transform.value,t=(0,T.fv)(e,i);void 0!==t&&(this.transform.outputSpace.value=ce(e.outputSpace,i,t.scale,t.unit))})),d.push(t),S.appendChild(e),c.push(n)}{const e=document.createElement("div");e.classList.add("neuroglancer-coordinate-space-transform-output-name-container"),e.style.gridRowStart="outputDim ".concat(C+1),e.style.gridColumnStart="outputNames";const t=ae();t.title="Rebind to a different dimension",C>=n?t.title+=", or delete to remove singleton dimension":this.transform.mutableSourceRank&&(t.title+=", or delete to remove source dimension"),t.title+=".  Names ending in ' or ^ indicate dimensions local to the layer; names ending in ^ indicate channel dimensions (image layers only).",l.push(t),g.appendChild(e),e.appendChild(t);const i=document.createElement("div");i.classList.add("neuroglancer-coordinate-space-transform-output-bounds"),e.appendChild(i);const r=document.createElement("div");r.classList.add("neuroglancer-coordinate-space-transform-output-bounds"),e.appendChild(r),h.push({lower:i,upper:r}),e.addEventListener("mousedown",(e=>{e.target!==t&&(t.focus(),e.preventDefault())}))}}l.push(this.addOutputDimensionInput),this.addOutputDimensionInput.value="",g.appendChild(this.addOutputDimensionCell),this.curSourceRank=n,this.curRank=t}updateViewInputScales(){this.ensureViewRankUpdated(),this.inputScaleModified.length=0;var e=this.transform.value;const t=e.inputSpace,n=e.rank,i=e.sourceRank,r=this.inputBoundsElements,o=this.inputNameElements,s=this.inputScaleElements,a=this.inputScaleSuggestionElements,l=t.names,c=t.scales,d=t.units;var u=t.bounds;const h=u.lowerBounds,p=u.upperBounds;for(let g=0;g<n;++g){const e=s[g],t=c[g],n=d[g];let u;if(e.value=(0,$.NJ)(t,n,{elide1:!1}),e.dataset.isValid="true",te(e),g<i){let t=l[g];t||(t="".concat(g)),o[g].textContent=t,u="source dimension ".concat(t),e.title="Override scale of ".concat(u)}else u="singleton dimension",e.title="Set extent of ".concat(u);var f=ie(h[g],p[g]);const m=f.lower,v=f.upper,y=r[g];y.lower.textContent=m,y.lower.title="Lower bound of ".concat(u),y.upper.title="Upper bound of ".concat(u),y.upper.textContent=v,se(a[g],(0,T.qx)(this.transform,g),t,n,"Revert scale of ".concat(u," to "))}}updateViewOutputScales(){const e=this.transform.value;var t=e.outputSpace;const n=t.rank,i=t.names,r=t.units,o=t.scales;var s=t.bounds;const a=s.lowerBounds,l=s.upperBounds,c=this.outputScaleElements,d=this.outputBoundsElements,u=this.outputScaleSuggestionElements;for(let p=0;p<n;++p){const t=c[p],n=o[p],s=r[p];t.value=(0,$.NJ)(n,s,{elide1:!1}),te(t);const f=i[p];t.dataset.isValid="true";const g="Change coordinates of ".concat((0,T.AJ)(f)?"local":"global"," dimension ").concat(f);t.title="".concat(g," (does not rescale the source)");var h=ie(a[p],l[p]);const m=h.lower,v=h.upper,y=d[p];y.lower.textContent=m,y.upper.textContent=v,se(u[p],(0,T.fv)(e,p),n,s,"".concat(g," to inferred scale of "))}}updateResetButtonVisibility(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n=this.transform;const i=n.value,r=n.mutableSourceRank,o=n.defaultTransform,s=i.rank;this.resetToIdentityButton.style.visibility=e||!(0,Z.Lk)(i.transform,s+1,s+1)?"visible":"hidden",this.resetToDefaultButton.style.visibility=r||!e&&!t&&(0,T.Wd)(o,i)?"hidden":"visible"}updateView(){const e=this.transform.value;this.curTransform!==e&&(this.curTransform=e,this.ensureViewRankUpdated(),this.updateViewInputScales(),this.updateViewOutputNames(),this.updateViewTransformCoefficients(),this.updateViewOutputScales(),this.updateAddOutputDimensionCellStyle(),this.updateResetButtonVisibility())}disposed(){(0,U.fh)(this.element),super.disposed()}}var ue=n(2959);var he=n(7797),pe=n.n(he);var fe=n(6344),ge=n(2608);const me="neuroglancer-multiline-autocomplete-completion-active";function ve(e){let t=document.createElement("div");return t.textContent=e.value,t}function*ye(e){for(;e.length>0;){const t=e.match(/[:/_]+/);if(null===t)return void(yield e);const n=t.index+t[0].length;yield e.substring(0,n),e=e.substring(n)}}function be(e){let t=document.createElement("div");t.className="neuroglancer-multiline-autocomplete-completion-with-description",t.textContent=e.value;let n=document.createElement("div");return n.className="neuroglancer-multiline-autocomplete-completion-description",n.textContent=e.description||"",t.appendChild(n),t}const Se=X.n5.fromObject({arrowdown:{action:"cycle-next-active-completion"},arrowup:{action:"cycle-prev-active-completion"},home:{action:"home"},end:{action:"end"},tab:{action:"choose-active-completion-or-prefix",preventDefault:!1},enter:{action:"commit"},escape:{action:"cancel",preventDefault:!1,stopPropagation:!1}});class we extends F.O8{constructor(e){super(),this.element=document.createElement("div"),this.inputElement=document.createElement("span"),this.hintElement=document.createElement("span"),this.completionsVirtualList=void 0,this.onCommit=new fe.HN,this.onInput=new fe.HN,this.prevInputValue="",this.completionsVisible=!1,this.activeCompletionPromise=null,this.activeCompletionCancellationToken=void 0,this.hasFocus=!1,this.completionResult=null,this.dropdownContentsStale=!0,this.hasResultForDropdown=!1,this.commonPrefix="",this.completionDisabled=-1,this.activeIndex=-1,this.dropdownStyleStale=!0,this.resizeHandler=()=>{this.completionsVisible&&this.updateDropdownStyle()},this.resizeObserver=new ResizeObserver(this.resizeHandler),this.debouncedUpdateHintState=this.registerCancellable(C()((()=>this.updateHintState()),0)),this.completer=e.completer;var t=e.delay;const n=void 0===t?200:t;let i=this.scheduleUpdateCompletions=C()((()=>{const e=this.activeCompletionCancellationToken=new ue.Qi;let t=this.activeCompletionPromise=this.completer(this.value,e);null!==t&&t.then((e=>{this.activeCompletionPromise===t&&(this.setCompletions(e),this.activeCompletionPromise=null)}))}),n);this.registerDisposer((()=>{i.cancel()}));const r=this.element,o=this.inputElement,s=this.hintElement;r.classList.add("neuroglancer-multiline-autocomplete"),this.registerEventListener(window,"resize",this.resizeHandler),this.resizeObserver.observe(r),this.registerDisposer((()=>this.resizeObserver.unobserve(o))),o.contentEditable="true",o.spellcheck=!1,r.appendChild(document.createTextNode("\u200b")),r.appendChild(o),r.appendChild(s),o.classList.add("neuroglancer-multiline-autocomplete-input"),s.classList.add("neuroglancer-multiline-autocomplete-hint"),o.addEventListener("input",(()=>{this.completionDisabled=-1,this.setValueAndSelection(this.value,this.getSelectionRange()),this.debouncedUpdateHintState()})),o.addEventListener("copy",(e=>{const t=e.clipboardData;if(null!==t){const e=window.getSelection();null!==e&&!e.isCollapsed&&e.containsNode(o,!0)&&t.setData("text/plain",e.toString())}e.preventDefault(),e.stopPropagation()})),this.registerEventListener(document,"selectionchange",(()=>{const e=this.getSelectionRange(),t=this.completionDisabled;void 0!==e&&e.begin===t&&e.end===t||(this.completionDisabled=-1,this.debouncedUpdateHintState())})),this.setValueAndSelection(""),this.updateHintState(),r.addEventListener("pointerdown",(e=>{const t=e.target;if(t instanceof Node){if(o.contains(t))return;const e=this.completionsVirtualList;if(void 0!==e&&e.element.contains(t))return}o===document.activeElement&&(this.moveCaretToEndOfInput(),e.stopPropagation(),e.preventDefault())})),r.addEventListener("click",(()=>{o.focus()})),this.registerEventListener(this.inputElement,"focus",(()=>{if(!this.hasFocus){this.hasFocus=!0,this.dropdownStyleStale=!0,this.updateDropdown();const e=document.createRange(),t=o.childNodes;e.setStart(o,0),0===t.length?e.setEnd(o,0):e.setEndAfter(t[t.length-1]);const n=window.getSelection();null!==n&&(n.removeAllRanges(),n.addRange(e)),this.debouncedUpdateHintState()}})),this.registerEventListener(this.inputElement,"blur",(()=>{this.hasFocus&&(this.hasFocus=!1,this.updateDropdown()),this.debouncedUpdateHintState();const e=window.getSelection();null!==e&&e.containsNode(this.inputElement,!0)&&e.removeAllRanges(),this.onCommit.dispatch(this.value,!1)})),this.registerEventListener(window,"resize",(()=>{this.dropdownStyleStale=!0})),this.registerEventListener(window,"scroll",(()=>{this.dropdownStyleStale=!0}));this.registerDisposer(new X.cL(o,Se)).allShortcutsAreGlobal=!0,(0,X.qZ)(o,"cycle-next-active-completion",(()=>{this.cycleActiveCompletion(1)})),(0,X.qZ)(o,"cycle-prev-active-completion",(()=>{this.cycleActiveCompletion(-1)})),(0,X.qZ)(o,"home",(()=>{this.moveCaretToBeginningOfInput()})),(0,X.qZ)(o,"end",(()=>{this.moveCaretToEndOfInput()})),(0,X.qZ)(o,"choose-active-completion-or-prefix",(e=>{this.selectActiveCompletion(!0)&&e.preventDefault()})),(0,X.qZ)(o,"commit",(e=>{if(this.selectActiveCompletion(!1))e.stopPropagation();else{let e=!this.completionsVisible;this.disableCompletion(),this.hideCompletions(),this.onCommit.dispatch(this.value,e)}})),(0,X.qZ)(o,"cancel",(e=>{e.stopPropagation(),this.cancel()&&(e.detail.preventDefault(),e.detail.stopPropagation())}))}disableCompletion(){const e=this.getSelectionRange();this.completionDisabled=void 0!==e&&e.end===e.begin?e.end:-1}get placeholder(){return this.inputElement.dataset.placeholder||""}set placeholder(e){this.inputElement.dataset.placeholder=e}getSelectionRange(){const e=window.getSelection();if(null===e)return;if(0===e.rangeCount)return;const t=e.getRangeAt(0),n=this.inputElement,i=document.createRange();i.setStart(n,0),i.setEnd(t.startContainer,t.startOffset);const r=i.toString().length;return{begin:r,end:r+e.toString().length}}setValueAndSelection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const n=-1!==this.completionDisabled;this.onInput.dispatch(e);const i=this.inputElement;(0,U.gS)(i);let r=0;const o=void 0!==t?document.createRange():void 0;let s=!0;for(const a of ye(e)){s||i.appendChild(document.createElement("wbr")),s=!1;const e=r+a.length,n=document.createTextNode(a);if(i.appendChild(n),void 0!==o){const i=t.begin,s=t.end;i>=r&&i<=e&&o.setStart(n,i-r),s>=r&&s<=e&&o.setEnd(n,s-r)}r=e}if(void 0!==o){s&&(o.setStart(i,0),o.setEnd(i,0));const e=window.getSelection();null!==e&&(e.removeAllRanges(),e.addRange(o))}this.completionDisabled=n&&void 0!==t&&t.end===t.begin?t.end:-1}shouldAttemptCompletion(){const e=this.inputElement;if(document.activeElement!==e)return!1;const t=this.getSelectionRange();return void 0!==t&&t.end===t.begin&&t.end!=this.completionDisabled&&t.end===this.value.length}hideCompletions(){this.cancelActiveCompletion(),this.clearCompletions(),this.hintElement.textContent=""}updateHintState(){if(this.debouncedUpdateHintState.cancel(),this.shouldAttemptCompletion()){const e=this.value;if(e===this.prevInputValue)return;this.hideCompletions(),this.prevInputValue=e,this.scheduleUpdateCompletions()}else this.hideCompletions()}handleDropdownClick(e){let t=this.completionsVirtualList;if(void 0===t)return;const n=t.element;for(let i=e.target;i instanceof HTMLElement&&i!==n;i=i.parentElement){const e=i.dataset.completionIndex;if(void 0!==e){this.selectCompletion(Number(e));break}}}cycleActiveCompletion(e){if(null===this.completionResult)return;let t=this.activeIndex,n=this.completionResult.completions.length;t=-1===t?e>0?0:n-1:(t+e+n)%n,this.setActiveIndex(t)}shouldShowDropdown(){return!(null===this.completionResult||!this.hasFocus)&&this.hasResultForDropdown}updateDropdownStyle(){const e=this.completionsVirtualList,t=this.element;void 0!==e&&function(e,t){let{horizontal:n=!1,vertical:i=!0,topMargin:r=6,bottomMargin:o=6,leftMargin:s=6,rightMargin:a=6,maxHeight:l=!0,maxWidth:c=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const d=t.getBoundingClientRect();if(n){const t=e.ownerDocument.documentElement.clientWidth;let n=d.right,i=t-d.left;n>i?(e.style.left="",e.style.right="".concat(t-d.right,"px"),c&&(e.style.maxWidth=n-s+"px")):(e.style.right="",e.style.left="".concat(d.left,"px"),c&&(e.style.maxWidth=i-a+"px"))}if(i){const t=e.ownerDocument.documentElement.clientHeight;let n=d.top-r,i=t-d.bottom-o;e.style.left="".concat(d.left,"px"),e.style.width="".concat(d.width,"px"),n>3*i?(e.style.top="",e.style.bottom="".concat(t-d.top,"px"),l&&(e.style.maxHeight=n+"px")):(e.style.top="".concat(d.bottom,"px"),e.style.bottom="",l&&(e.style.maxHeight=i+"px"))}}(e.element,t,{horizontal:!1}),this.dropdownStyleStale=!1}updateDropdown(){let e=this.completionsVirtualList;if(this.shouldShowDropdown()){if(this.dropdownContentsStale){void 0!==e&&e.dispose();const n=this.completionResult;var t=n.makeElement;const i=void 0===t?ve:t;e=this.completionsVirtualList=new ge.w({source:{length:n.completions.length,render:e=>{const t=n.completions[e],r=i.call(n,t);return r.classList.add("neuroglancer-multiline-autocomplete-completion"),r.dataset.completionIndex="".concat(e),this.activeIndex===e&&r.classList.add(me),r}},selectedIndex:-1===this.activeIndex?void 0:this.activeIndex}),e.element.classList.add("neuroglancer-multiline-autocomplete-dropdown"),e.element.addEventListener("mousedown",(e=>{this.inputElement.focus(),e.preventDefault()})),e.element.addEventListener("mouseup",this.handleDropdownClick.bind(this)),this.element.appendChild(e.element),this.dropdownContentsStale=!1}this.dropdownStyleStale&&this.updateDropdownStyle(),this.completionsVisible||(this.completionsVisible=!0);const n=this.activeIndex;-1!==n&&this.completionsVirtualList.scrollItemIntoView(n)}else this.completionsVisible&&(void 0!==e&&(e.dispose(),this.completionsVirtualList=void 0,this.dropdownContentsStale=!0),this.completionsVisible=!1)}setCompletions(e){this.clearCompletions();let t=e.completions;if(0===t.length)return;const n=this.prevInputValue;if(void 0!==n){if(this.completionResult=e,1===t.length){let i=t[0];e.showSingleResult?this.hasResultForDropdown=!0:i.value.startsWith(n)?this.hasResultForDropdown=!1:this.hasResultForDropdown=!0,e.selectSingleResult?this.setActiveIndex(0):this.setHintValue(this.getCompletedValueByIndex(0))}else{this.hasResultForDropdown=!0;let t=function(e){let t=pe()(e);var n=t.next();let i=n.value;if(n.done)return"";let r=i.length;for(;r>0;){var o=t.next();let e=o.value;if(o.done)break;let n=0;for(;n<r&&i.charCodeAt(n)===e.charCodeAt(n);++n);r=n}return i.substring(0,r)}(function*(){for(let t of e.completions)yield t.value}()),i=this.getCompletedValue(t);i.startsWith(n)&&(this.commonPrefix=i,this.setHintValue(i))}this.updateDropdown()}}setHintValue(e){const t=this.prevInputValue;if(void 0===t)return;e!==t&&e.startsWith(t)||(e=""),e=e.substring(t.length);const n=this.hintElement;(0,U.gS)(n);let i=!0;for(const r of ye(e)){i||n.appendChild(document.createElement("wbr")),i=!1;const e=document.createTextNode(r);n.appendChild(e)}}setActiveIndex(e){if(!this.dropdownContentsStale){let t=this.activeIndex;const n=this.completionsVirtualList;if(void 0!==n){if(-1!==t){const e=n.getItemElement(t);void 0!==e&&e.classList.remove(me)}if(-1!==e){let t=n.getItemElement(e);void 0!==t&&t.classList.add(me),n.scrollItemIntoView(e)}}}-1!==e&&this.setHintValue(this.getCompletedValueByIndex(e)),this.activeIndex=e}getCompletedValueByIndex(e){return this.getCompletedValue(this.completionResult.completions[e].value)}getCompletedValue(e){let t=this.completionResult,n=this.prevInputValue;return void 0===n?"":n.substring(0,t.offset)+e}moveCaretToBeginningOfInput(){const e=document.createRange(),t=this.inputElement;e.setStart(t,0),e.setEnd(t,0);const n=window.getSelection();null!==n&&(n.removeAllRanges(),n.addRange(e),this.debouncedUpdateHintState())}moveCaretToEndOfInput(){const e=document.createRange(),t=this.inputElement,n=t.childNodes,i=n[n.length-1];void 0===i?(e.setStart(t,0),e.setEnd(t,0)):(e.setStartAfter(i),e.setEndAfter(i));const r=window.getSelection();null!==r&&(r.removeAllRanges(),r.addRange(e),this.debouncedUpdateHintState())}selectActiveCompletion(e){let t=this.activeIndex;if(-1===t){if(!e)return!1;let n=this.completionResult;if(null===n||1!==n.completions.length){let e=this.commonPrefix;return e.length>this.value.length&&(this.value=e,this.moveCaretToEndOfInput(),!0)}t=0}let n=this.getCompletedValueByIndex(t);return this.value!==n&&(this.value=n,this.moveCaretToEndOfInput(),!0)}selectCompletion(e){this.value=this.getCompletedValueByIndex(e),this.moveCaretToEndOfInput()}cancel(){return!1}cancelActiveCompletion(){this.prevInputValue=void 0;const e=this.activeCompletionCancellationToken;void 0!==e&&e.cancel(),this.activeCompletionCancellationToken=void 0,this.activeCompletionPromise=null}clearCompletions(){if(null!==this.completionResult){this.activeIndex=-1,this.completionResult=null,this.dropdownContentsStale=!0,this.dropdownStyleStale=!0,this.commonPrefix="";const e=this.completionsVirtualList;void 0!==e&&(e.dispose(),this.completionsVirtualList=void 0),this.updateDropdown()}}get value(){return this.inputElement.textContent||""}set value(e){e!==this.value&&(this.completionDisabled=-1,this.setValueAndSelection(e),this.debouncedUpdateHintState())}disposed(){const e=this.completionsVirtualList;void 0!==e&&e.dispose(),(0,U.fh)(this.element),this.cancelActiveCompletion(),super.disposed()}}var xe=n(8946);class Ce extends we{constructor(e){const t=e.source.layer.manager;super({completer:(e,n)=>t.dataSourceProviderRegistry.completeUrl({url:e,chunkManager:t.chunkManager,cancellationToken:n}).then((e=>({completions:e.completions,makeElement:be,offset:e.offset,showSingleResult:!0}))),delay:0}),this.placeholder="Data source URL",this.dataSourceView=e,this.element.classList.add("neuroglancer-layer-data-source-url-input"),this.dirty=new A.B0(!1);const n=e=>{e!==this.dataSourceView.source.spec.url&&(this.dirty.value=!0)};n(""),this.onInput.add(n)}cancel(){return this.value=this.dataSourceView.source.spec.url,this.dirty.value=!1,this.inputElement.blur(),!0}}class ke extends F.O8{constructor(e){super(),this.model=e,this.element=document.createElement("ul"),this.generation=-1,this.element.classList.add("neuroglancer-layer-data-sources-source-messages");const t=this.registerCancellable((0,V.t)((()=>this.updateView())));this.registerDisposer(e.changed.add(t)),this.registerDisposer((()=>(0,U.fh)(this.element))),this.updateView()}updateView(){const e=this.model,t=e.changed.count;if(t===this.generation)return;this.generation=t;const n=this.element;(0,U.gS)(n);const i=new(v());for(const r of e){const e="".concat(r.severity," ").concat(r.message);if(i.has(e))continue;i.add(e);const t=document.createElement("li");n.appendChild(t),t.classList.add("neuroglancer-message"),t.classList.add("neuroglancer-message-".concat(z.TU[r.severity])),t.textContent=r.message}}}class Ee extends F.O8{constructor(e,t){super(),this.loadedSubsource=t,this.element=document.createElement("div");const n=this.element;n.classList.add("neuroglancer-layer-data-source-subsource");const i=document.createElement("label"),r=document.createElement("span"),o=()=>{i.dataset.isActive=(void 0!==t.activated||!t.enabled).toString()};o(),this.registerDisposer(t.isActiveChanged.add(o)),this.registerDisposer(e.enabledSubsourcesChanged.add(o));const s=this.registerDisposer(new R.Fo({get value(){return t.enabled},set value(n){t.enabled=n,e.enableDefaultSubsources=!1,e.enabledSubsourcesChanged.dispatch()},changed:e.enabledSubsourcesChanged}));i.classList.add("neuroglancer-layer-data-sources-info-line"),i.appendChild(s.element);const a=document.createElement("span");a.classList.add("neuroglancer-layer-data-sources-source-id");const l=t.subsourceEntry.id;"default"!==l&&(a.textContent=l),i.appendChild(a),r.classList.add("neuroglancer-layer-data-sources-source-type");const c=this.registerDisposer(new ke(this.loadedSubsource.messages));n.appendChild(i),i.appendChild(r),n.appendChild(c.element);let d="";const u=t.subsourceEntry.subsource,h=u.volume;if(h instanceof _.kg)d="".concat(B.pe[h.dataType].toLowerCase()," volume");else if(u.mesh instanceof O.No)d="meshes (single-res.)";else if(u.mesh instanceof O.bJ)d="meshes (multi-res.)";else if(u.mesh instanceof N.tr)d="skeletons";else if(void 0!==u.segmentPropertyMap)d="segment property map";else if(void 0!==u.local)switch(u.local){case L.h0.annotations:d="Local annotations";break;case L.h0.equivalences:d="local segmentation graph"}else void 0!==u.staticAnnotations?d="default annotations":void 0!==u.annotation?d="annotations":void 0!==u.singleMesh?d="single mesh":void 0!==u.segmentationGraph&&(d="segmentation graph");r.textContent=d}}class Te extends F.O8{constructor(e){super(),this.source=e,this.element=document.createElement("div");const t=this.element,n=document.createElement("label");n.classList.add("neuroglancer-layer-data-sources-source-default"),n.appendChild(this.registerDisposer(new R.Fo({changed:e.enabledSubsourcesChanged,get value(){return e.enableDefaultSubsources},set value(t){if(e.enableDefaultSubsources!==t){if(e.enableDefaultSubsources=t,t)for(const t of e.subsources)t.enabled=t.subsourceEntry.default;e.enabledSubsourcesChanged.dispatch()}}})).element),n.appendChild(document.createTextNode("Enable default subsource set")),n.title="Enable the default set of subsources for this data source.",t.appendChild(n);for(const r of e.subsources)t.appendChild(this.registerDisposer(new Ee(e,r)).element);const i=e.transform;if(i.mutableSourceRank||0!==i.value.sourceRank){const t=this.registerDisposer(new de(e.transform,e.layer.localCoordinateSpaceCombiner,e.layer.manager.root.coordinateSpaceCombiner));this.element.appendChild(t.element)}this.registerDisposer((()=>(0,U.fh)(this.element)))}}class Le extends F.O8{constructor(e,t){super(),this.tab=e,this.source=t,this.element=document.createElement("div"),this.seenGeneration=0,this.generation=-1;const n=this.urlInput=this.registerDisposer(new Ce(this));n.onCommit.add(((t,i)=>{const r=this.source,o=r.spec,s=this.source.layer;if((t=s.manager.dataSourceProviderRegistry.normalizeUrl({url:t}))!==n.value&&(n.disableCompletion(),n.setValueAndSelection(t,{begin:t.length,end:t.length})),n.dirty.value=!1,t&&t===o.url)i&&void 0!==e.detectedLayerConstructor&&Pe(r.layer);else{if(s instanceof Pt)try{const e=s.manager.dataSourceProviderRegistry.suggestLayerName(t);Ct(s.managedLayer,e)}catch(a){}r.spec=b()(b()({},o),{url:t})}}));const i=this.element;i.classList.add("neuroglancer-layer-data-source"),i.appendChild(n.element),i.appendChild(this.registerDisposer(new ke(t.messages)).element),this.updateView()}updateView(){const e=this.source.changed.count;if(e===this.generation)return;this.generation=e,this.urlInput.value=this.source.spec.url,this.urlInput.dirty.value=!1;const t=this.source.loadState;let n=this.loadedView;if(void 0!==n){if(n.source===t)return;n.dispose(),n=this.loadedView=void 0}t instanceof P.eE&&(n=this.loadedView=new Te(t),this.element.appendChild(n.element))}disposed(){const e=this.loadedView;void 0!==e&&e.dispose(),(0,U.fh)(this.element),super.disposed()}}function Pe(e){if(e instanceof Pt){const t=e.detectedLayerConstructor;if(void 0!==t)return xt(e.managedLayer,t),!0}return!1}class De extends xe.oz{constructor(e){super(),this.layer=e,this.generation=-1,this.sourceViews=new(p()),this.addDataSourceIcon=(0,j.G)({title:"Add additional data source"}),this.layerTypeDetection=document.createElement("div"),this.layerTypeElement=document.createElement("span"),this.dataSourcesContainer=document.createElement("div"),this.detectedLayerConstructor=void 0;const t=this.element,n=this.dataSourcesContainer;t.classList.add("neuroglancer-layer-data-sources-tab"),n.classList.add("neuroglancer-layer-data-sources-container");const i=this.addDataSourceIcon;if(i.style.alignSelf="start",i.addEventListener("click",(()=>{const e=this.layer.addDataSource(void 0);this.updateView();const t=this.sourceViews.get(e);void 0!==t&&t.urlInput.inputElement.focus()})),t.appendChild(this.dataSourcesContainer),e instanceof Pt){const n=this.layerTypeDetection,i=this.layerTypeElement;n.style.display="none",i.classList.add("neuroglancer-layer-data-sources-tab-type-detection-type"),n.appendChild(document.createTextNode("Create as ")),n.appendChild(i),n.appendChild(document.createTextNode(" layer")),t.appendChild(n),n.classList.add("neuroglancer-layer-data-sources-tab-type-detection"),n.addEventListener("click",(()=>{Pe(e)}))}const r=this.reRender=(0,V.t)((()=>this.updateView()));this.registerDisposer(e.dataSourcesChanged.add(r)),this.registerDisposer(this.visibility.changed.add(r)),this.updateView()}updateLayerTypeDetection(){const e=(()=>{const e=this.layer;if(!(e instanceof Pt))return;const t=e.detectedLayerConstructor;if(void 0!==t){for(const e of this.sourceViews.values())if(e.urlInput.dirty.value)return;return t}})();if(e===this.detectedLayerConstructor)return;const t=this.layerTypeDetection;if(this.detectedLayerConstructor=e,void 0!==e){this.layerTypeElement.textContent=e.type,t.title="Click here or press enter in the data source URL input box to create as "+"".concat(e.type," layer"),t.style.display=""}else t.style.display="none"}disposed(){const e=this.sourceViews;for(const t of e.values())t.dispose();e.clear(),super.disposed()}updateView(){if(!this.visible)return;const e=this.layer.dataSourcesChanged.count;if(e!==this.generation){this.generation=e;const n=Date.now(),i=this.sourceViews,r=this.layer;function*o(){let e=!0;const t=r.dataSources;for(const r of t){let o=i.get(r);void 0===o&&(o=new Le(this,r),o.registerDisposer(o.urlInput.dirty.changed.add(this.reRender)),i.set(r,o)),o.seenGeneration=n,o.updateView();const s=r.spec.url;1===t.length&&""===s&&setTimeout((()=>{o.urlInput.inputElement.focus()}),0),e=0===r.spec.url.length,yield o.element}e||(yield this.addDataSourceIcon)}(0,U.bu)(this.dataSourcesContainer,o.call(this));for(const s of i){var t=(0,u.A)(s,2);const a=t[0],l=t[1];l.seenGeneration!==n&&(l.dispose(),i.delete(a))}}this.updateLayerTypeDetection()}}var Me=n(8868),Ie=n(4228),Re=n(3240),Ae=n(7970);function Oe(e,t){e.remove(t)}function Ne(e,t){e.add(t)}var _e=n(8194),Ve=n(9799),Be=n(1259);const Fe="tool",Ue="toolBindings",ze="localPosition",je="localDimensions",Ge="source",We="pick";class He{constructor(){this.callbacks=[]}defer(e){this.callbacks.push(e)}}class qe extends F.O8{constructor(e){super(),this.managedLayer=e,this.pick=new R.C_(!0,!0),this.layersChanged=new fe.IY,this.readyStateChanged=new fe.IY,this.specificationChanged=new fe.IY,this.renderLayers=new Array,this.loadingCounter=1,this.tabs=this.registerDisposer(new xe.HJ),this.panels=new Me.AZ(this),this.tool=this.registerDisposer(new Re.he(this)),this.toolBinder=new Re.st(this),this.dataSourcesChanged=new fe.IY,this.dataSources=[],this.allowingRefresh=!1,this.localCoordinateSpaceCombiner.includeDimensionPredicate=T.mc,this.tabs.changed.add(this.specificationChanged.dispatch),this.panels.specificationChanged.add(this.specificationChanged.dispatch),this.tool.changed.add(this.specificationChanged.dispatch),this.toolBinder.changed.add(this.specificationChanged.dispatch),this.localPosition.changed.add(this.specificationChanged.dispatch),this.pick.changed.add(this.specificationChanged.dispatch),this.pick.changed.add(this.layersChanged.dispatch),this.dataSourcesChanged.add(this.specificationChanged.dispatch),this.dataSourcesChanged.add((()=>this.updateDataSubsourceActivations())),this.tabs.add("source",{label:"Source",order:-100,getter:()=>new De(this)})}get localPosition(){return this.managedLayer.localPosition}get localCoordinateSpaceCombiner(){return this.managedLayer.localCoordinateSpaceCombiner}get localCoordinateSpace(){return this.managedLayer.localCoordinateSpace}get type(){return this.constructor.type}initializeSelectionState(e){e.generation=-1,e.localPositionValid=!1,e.localPosition=Ve.qE,e.localCoordinateSpace=void 0,e.annotationId=void 0,e.annotationType=void 0,e.annotationBuffer=void 0,e.annotationIndex=void 0,e.annotationCount=void 0,e.annotationSourceIndex=void 0,e.annotationSubsource=void 0,e.annotationPartIndex=void 0,e.value=void 0}resetSelectionState(e){e.localPositionValid=!1,e.annotationId=void 0,e.value=void 0}selectionStateFromJson(e,t){const n=(e.localCoordinateSpace=this.localCoordinateSpace.value).rank;if(0!==n){const i=(0,Ae.verifyOptionalObjectProperty)(t,ze,(e=>(0,Ae.parseFixedLengthArray)(new Float32Array(n),e,Ae.verifyFiniteFloat)));void 0===i?e.localPositionValid=!1:(e.localPositionValid=!0,e.localPosition=i)}void 0!==(e.annotationId=(0,Ae.verifyOptionalObjectProperty)(t,"annotationId",Ae.verifyString))&&(e.annotationSourceIndex=(0,Ae.verifyOptionalObjectProperty)(t,"annotationSource",Ae.verifyInt,0),e.annotationPartIndex=(0,Ae.verifyOptionalObjectProperty)(t,"annotationPart",Ae.verifyInt),e.annotationSubsource=(0,Ae.verifyOptionalObjectProperty)(t,"annotationSubsource",Ae.verifyString)),e.value=t.value}displaySelectionState(e,t,n){return!1}selectionStateToJson(e,t){const n={};if(e.localPositionValid){const t=e.localPosition;t.length>0&&(n.localPosition=w()(t))}return void 0!==e.annotationId&&(n.annotationId=e.annotationId,n.annotationPart=e.annotationPartIndex,n.annotationSource=e.annotationSourceIndex,n.annotationSubsource=e.annotationSubsource),null!=e.value&&(n.value=e.value),n}captureSelectionState(e,t){e.localCoordinateSpace=this.localCoordinateSpace.value;const n=this.localPosition.value;let i=e.localPosition;i.length!==n.length?e.localPosition=n.slice():i.set(n),e.localPositionValid=!0,e.value=this.getValueAt(t.position,t)}copySelectionState(e,t){e.generation=t.generation,e.localPositionValid=t.localPositionValid,e.localCoordinateSpace=t.localCoordinateSpace;const n=t.localPosition;e.localPosition.length!==n.length?e.localPosition=n.slice():e.localPosition.set(n),e.annotationId=t.annotationId,e.annotationType=t.annotationType,e.annotationBuffer=t.annotationBuffer,e.annotationIndex=t.annotationIndex,e.annotationCount=t.annotationCount,e.annotationSourceIndex=t.annotationSourceIndex,e.annotationSubsource=t.annotationSubsource,e.annotationPartIndex=t.annotationPartIndex,e.value=t.value}get isReady(){return 0===this.loadingCounter}get manager(){return this.managedLayer.manager}canAddDataSource(){return!0}addDataSource(e){const t=new P.$6(this,e);return this.dataSources.push(t),this.dataSourcesChanged.dispatch(),t}activateDataSubsources(e){}updateDataSubsourceActivations(){this.activateDataSubsources(function*(){for(const e of this.dataSources){const t=e.loadState;if(void 0!==t&&void 0===t.error)for(const e of t.subsources)if(e.enabled)yield e;else{const n=e.activated;e.messages.clearMessages(),void 0!==n&&(n.dispose(),e.activated=void 0,t.activatedSubsourcesChanged.dispatch())}}}.call(this))}decrementLoadingCounter(){0===--this.loadingCounter&&this.readyStateChanged.dispatch()}markLoading(){const e=this.localCoordinateSpaceCombiner.retain(),t=this.manager.root.coordinateSpaceCombiner.retain();1===++this.loadingCounter&&this.readyStateChanged.dispatch();return()=>{e(),t(),this.decrementLoadingCounter()}}addCoordinateSpace(e){const t=this.manager.root.coordinateSpaceCombiner.bind(e),n=this.localCoordinateSpaceCombiner.bind(e);return()=>{t(),n()}}initializationDone(){const e=this.selectionState={};this.initializeSelectionState(e),this.decrementLoadingCounter()}getLegacyDataSourceSpecifications(e,t,n,i){return void 0===e?[]:[(0,P.Es)(e,n)]}getDataSourceSpecifications(e){let t,n=(0,Ae.verifyObjectProperty)(e,Ge,(e=>Array.isArray(e)?e.map((e=>(0,P.Es)(e))):"object"===typeof e?[(0,P.Es)(e)]:(t=e,[])));const i=(0,Ae.verifyObjectProperty)(e,"transform",T.jK);return n.push(...this.getLegacyDataSourceSpecifications(t,e,i,n)),n=n.filter((e=>e.url)),0===n.length&&n.push((0,L.Q4)()),n}restoreState(e){this.tool.restoreState(e[Fe]),this.toolBinder.restoreState(e[Ue]),this.panels.restoreState(e),this.localCoordinateSpace.restoreState(e[je]),this.localPosition.restoreState(e[ze]),this.constructor.supportsPickOption&&this.pick.restoreState(e[We]);for(const t of this.getDataSourceSpecifications(e))this.addDataSource(t)}addRenderLayer(e){this.renderLayers.push(e);const t=this.layersChanged;return e.layerChanged.add(t.dispatch),e.userLayer=this,t.dispatch(),()=>this.removeRenderLayer(e)}removeRenderLayer(e){const t=this.renderLayers,n=this.layersChanged,i=t.indexOf(e);if(-1===i)throw new Error("Attempted to remove invalid RenderLayer");t.splice(i,1),e.layerChanged.remove(n.dispatch),e.userLayer=void 0,e.dispose(),n.dispatch()}disposed(){const e=this.layersChanged;(0,F.$F)(this.dataSources);for(const t of this.renderLayers)t.layerChanged.remove(e.dispatch),t.dispose();this.renderLayers.length=0,super.disposed()}getValueAt(e,t){let n,i=this.renderLayers,r=t.pickedRenderLayer;if(null!==r&&-1!==i.indexOf(r)&&(n=r.transformPickedValue(t),n=this.transformPickedValue(n),null!=n))return n;for(let o of i)if(n=o.getValueAt(e),null!=n)break;return this.transformPickedValue(n)}transformPickedValue(e){return e}toJSON(){return b()({type:this.type,[Ge]:Ye(this.dataSources),[Fe]:this.tool.toJSON(),[Ue]:this.toolBinder.toJSON(),[je]:this.localCoordinateSpace.toJSON(),[ze]:this.localPosition.toJSON(),[We]:this.pick.toJSON()},this.panels.toJSON())}handleAction(e,t){}selectedValueToJson(e){return e}selectedValueFromJson(e){return e}setLayerPosition(e,t){const n=this.manager.root.globalPosition,i=this.localPosition;e?((0,K.b8)(n.value,t,e.globalToRenderLayerDimensions),(0,K.b8)(i.value,t,e.localToRenderLayerDimensions)):n.value.set(t),i.changed.dispatch(),n.changed.dispatch()}}function Ye(e){if(0!==e.length)return 1===e.length?e[0].toJSON():e.map((e=>e.toJSON()))}qe.supportsPickOption=!1;class Je extends F.O8{constructor(e,t){super(),this.manager=t,this.localCoordinateSpace=new T.W6,this.localCoordinateSpaceCombiner=new T.Ii(this.localCoordinateSpace,T.AJ),this.localPosition=this.registerDisposer(new D.yX(this.localCoordinateSpace)),this.nonArchivedLayerIndex=-1,this.readyStateChanged=new fe.IY,this.layerChanged=new fe.IY,this.specificationChanged=new fe.IY,this.containers=new(v()),this.layer_=null,this.visible=!0,this.archived=!1,this.name_=e}get layer(){return this.layer_}set layer(e){let t=this.layer_;if(null!=t&&(this.unregisterUserLayer(),t.dispose()),this.layer_=e,null!=e){const t=[e.layersChanged.add(this.layerChanged.dispatch),e.readyStateChanged.add(this.readyStateChanged.dispatch),e.specificationChanged.add(this.specificationChanged.dispatch)];this.unregisterUserLayer=()=>{t.forEach((e=>e()))},this.readyStateChanged.dispatch(),this.layerChanged.dispatch()}}isReady(){const e=this.layer;return null!==e&&e.isReady}get name(){return this.name_}set name(e){e!==this.name_&&(this.name_=e,this.layerChanged.dispatch())}get supportsPickOption(){const e=this.layer;return null!==e&&e.constructor.supportsPickOption}get pickEnabled(){const e=this.layer;return null!==e&&e.constructor.supportsPickOption&&e.pick.value}set pickEnabled(e){const t=this.layer;null!==t&&t.constructor.supportsPickOption&&(t.pick.value=e)}toJSON(){let e=this.layer;if(null===e)return;let t=e.toJSON();return t.name=this.name,this.visible||(this.archived?t.archived=!0:t.visible=!1),t}setVisible(e){if(e!==this.visible){if(e&&this.archived)return this.visible=!0,void this.setArchived(!1);this.visible=e,this.layerChanged.dispatch()}}setArchived(e){if(this.archived!==e){if(!0===e){this.visible=!1,this.archived=!0;for(const e of this.manager.root.subsets){const t=e.layerManager;t.has(this)&&t.removeManagedLayer(this)}}else{for(const e of this.manager.root.subsets){const t=e.layerManager;t.has(this)||t.addManagedLayer(this.addRef())}this.archived=!1}this.layerChanged.dispatch()}}disposed(){this.layer=null,super.disposed()}}class Ke extends F.O8{constructor(){super(),this.managedLayers=new Array,this.layerSet=new(v()),this.layersChanged=new fe.IY,this.readyStateChanged=new fe.IY,this.specificationChanged=new fe.IY,this.boundPositions=new(g()),this.numDirectUsers=0,this.nonArchivedLayerIndexGeneration=-1,this.renderLayerToManagedLayerMapGeneration=-1,this.renderLayerToManagedLayerMap_=new(p()),this.scheduleRemoveLayersWithSingleRef=this.registerCancellable(C()((()=>this.removeLayersWithSingleRef()),0)),this.layersChanged.add(this.scheduleRemoveLayersWithSingleRef)}updateNonArchivedLayerIndices(){const e=this.layersChanged.count;if(e===this.nonArchivedLayerIndexGeneration)return;this.nonArchivedLayerIndexGeneration=e;let t=0;for(const n of this.managedLayers)n.archived||(n.nonArchivedLayerIndex=t++);for(const n of this.managedLayers)n.archived&&(n.nonArchivedLayerIndex=t++)}getLayerByNonArchivedIndex(e){let t=0;for(const n of this.managedLayers)if(!n.archived){if(t===e)return n;++t}}get renderLayerToManagedLayerMap(){const e=this.layersChanged.count,t=this.renderLayerToManagedLayerMap_;if(this.renderLayerToManagedLayerMapGeneration!==e){this.renderLayerToManagedLayerMapGeneration=e,t.clear();for(const e of this.managedLayers){const n=e.layer;if(null!==n)for(const i of n.renderLayers)t.set(i,e)}}return t}filter(e){let t=!1;this.managedLayers=this.managedLayers.filter((n=>!!e(n)||(this.unbindManagedLayer(n),this.layerSet.delete(n),t=!0,!1))),t&&this.layersChanged.dispatch()}removeLayersWithSingleRef(){this.numDirectUsers>0||this.filter((e=>1!==e.refCount||e.archived))}updateSignalBindings(e,t){t(e.layerChanged,this.layersChanged.dispatch),t(e.readyStateChanged,this.readyStateChanged.dispatch),t(e.specificationChanged,this.specificationChanged.dispatch)}useDirectly(){return 1===++this.numDirectUsers&&this.layersChanged.remove(this.scheduleRemoveLayersWithSingleRef),()=>{0===--this.numDirectUsers&&(this.layersChanged.add(this.scheduleRemoveLayersWithSingleRef),this.scheduleRemoveLayersWithSingleRef())}}addManagedLayer(e,t){return this.updateSignalBindings(e,Ne),this.layerSet.add(e),e.containers.add(this),void 0===t&&(t=this.managedLayers.length),this.managedLayers.splice(t,0,e),this.layersChanged.dispatch(),this.readyStateChanged.dispatch(),e}*readyRenderLayers(){for(let e of this.managedLayers)e.visible&&e.layer&&(yield*e.layer.renderLayers)}unbindManagedLayer(e){this.updateSignalBindings(e,Oe),e.containers.delete(this),e.manager.rootLayers.layersChanged.dispatch(),e.dispose()}clear(){for(let e of this.managedLayers)this.unbindManagedLayer(e);this.managedLayers.length=0,this.layerSet.clear(),this.layersChanged.dispatch()}remove(e){const t=this.managedLayers[e];this.unbindManagedLayer(t),this.managedLayers.splice(e,1),this.layerSet.delete(t),this.layersChanged.dispatch()}removeManagedLayer(e){let t=this.managedLayers.indexOf(e);if(-1===t)throw new Error("Internal error: invalid managed layer.");this.remove(t)}reorderManagedLayer(e,t){const n=this.managedLayers.length;if(e===t||e<0||e>=n||t<0||t>=n)return;var i=this.managedLayers.splice(e,1);let r=(0,u.A)(i,1)[0];this.managedLayers.splice(t,0,r),this.layersChanged.dispatch()}disposed(){this.clear(),super.disposed()}getLayerByName(e){return this.managedLayers.find((t=>t.name===e))}getUniqueLayerName(e){let t=e,n=0;for(;void 0!==this.getLayerByName(t);)t=e+ ++n;return t}has(e){return this.layerSet.has(e)}get renderLayers(){let e=this;return{*[d()](){for(let t of e.managedLayers)if(null!==t.layer)for(let e of t.layer.renderLayers)yield e}}}get visibleRenderLayers(){let e=this;return{*[d()](){for(let t of e.managedLayers)if(null!==t.layer&&t.visible)for(let e of t.layer.renderLayers)yield e}}}invokeAction(e,t){const n=new He;for(let i of this.managedLayers){if(null===i.layer||!i.visible)continue;if(void 0!==t&&i!==t)continue;let r=i.layer;r.handleAction(e,n);for(let t of r.renderLayers)t.handleAction(e)}for(const i of n.callbacks)i()}}class Xe{constructor(){this.changed=new fe.IY,this.coordinateSpace=T.Nj,this.position=Ve.qE,this.unsnappedPosition=Ve.qE,this.active=!1,this.displayDimensions=void 0,this.pickedRenderLayer=null,this.pickedValue=new _e.Uint64(0,0),this.pickedOffset=0,this.pickedAnnotationLayer=void 0,this.pickedAnnotationId=void 0,this.pickedAnnotationBuffer=void 0,this.pickedAnnotationBufferBaseOffset=void 0,this.pickedAnnotationIndex=void 0,this.pickedAnnotationCount=void 0,this.pickedAnnotationType=void 0,this.forcerFunction=void 0}removeForcer(e){e===this.forcerFunction&&(this.forcerFunction=void 0,this.setActive(!1))}setForcer(e){this.forcerFunction=e,void 0===e&&this.setActive(!1)}updateUnconditionally(){const e=this.forcerFunction;return void 0!==e&&(e(),this.active)}setActive(e){this.active===e&&!0!==e||(this.active=e,this.changed.dispatch())}}class Ze extends F.O8{constructor(e,t){super(),this.layerManager=e,this.mouseState=t,this.changed=new fe.IY,this.needsUpdate=!0,this.registerDisposer(t.changed.add((()=>{this.handleChange()}))),this.registerDisposer(e.layersChanged.add((()=>{this.handleLayerChange()})))}handleLayerChange(){this.mouseState.active&&this.handleChange()}handleChange(){this.needsUpdate=!0,this.changed.dispatch()}update(){if(!this.needsUpdate)return;this.needsUpdate=!1;let e=this.mouseState;const t=this.changed.count;if(e.active)for(const n of this.layerManager.managedLayers){const i=n.layer;if(n.visible&&null!==i){const n=i.selectionState;n&&(i.resetSelectionState(n),n.generation=t,i.captureSelectionState(n,e))}}}get(e){this.update();const t=e.selectionState;if(!t||t.generation===this.changed.count)return t}toJSON(){this.update();const e={};for(const t of this.layerManager.managedLayers){const n=t.layer;if(n){const i=this.get(n);void 0!==i&&(e[t.name]=n.selectionStateToJson(i,!0))}}return e}}const Qe=b()(b()({},Ie.n7),{minSize:150,row:1}),$e=b()(b()({},Qe),{visible:!0});class et extends F.O8{constructor(e,t){super(),this.coordinateSpace=e,this.layerSelectedValues=t,this.changed=new fe.IY,this.history=[],this.historyIndex=0,this.location=new Ie.c1(Qe),this.pin=new A.B0(!0),this.registerDisposer((0,A.no)(((e,n)=>{n||(this.capture(!0),e.registerDisposer(t.changed.add(e.registerCancellable(E()((()=>this.capture(!0)),100,{leading:!0,trailing:!0})))))}),this.pin)),this.pin.changed.add(this.changed.dispatch),this.location.changed.add(this.changed.dispatch)}get value(){return this.value_}goBack(){const e=this.pin.value?this.historyIndex:this.history.length;e>0&&(this.historyIndex=e-1,this.value_=this.history[e-1],this.pin.value=!0,this.changed.dispatch())}canGoBack(){return(this.pin.value?this.historyIndex:this.history.length)>0}canGoForward(){if(!this.pin.value)return!1;return this.historyIndex+1<this.history.length}goForward(){if(!this.pin.value)return;const e=this.historyIndex;e+1<this.history.length&&(this.historyIndex=e+1,this.value_=this.history[e+1],this.changed.dispatch())}set value(e){if(e!==this.value_){if(this.value_=e,void 0!==e&&this.pin.value){const t=this.history;t.length=Math.min(t.length,this.historyIndex+1),t.push(e),t.length>10&&t.splice(0,t.length-10),this.historyIndex=t.length-1}this.changed.dispatch()}}captureSingleLayerState(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!1===n&&(!this.location.visible||this.pin.value))return;const r={};e.initializeSelectionState(r),t(r)&&(i&&(this.location.visible=!0),!0===n?this.pin.value=!0:"toggle"===n&&(this.pin.value=!this.pin.value),this.value={layers:[{layer:e,state:r}],coordinateSpace:this.coordinateSpace.value,position:void 0})}reset(){this.location.reset(),this.pin.value=!1,this.value=void 0}toJSON(){const e=this.value;let t;if(this.location.visible){if(t=this.location.toJSON(b()(b()({},$e),{visible:!Be.sw.expectingExternalUI})),this.pin.value&&void 0!==e){const n={};for(const t of e.layers){let e=t.layer.selectionStateToJson(t.state,!1);0===l()(e).length&&(e=void 0),n[t.layer.managedLayer.name]=e}void 0!==e.position&&(t.position=w()(e.position)),t.layers=n}}else t=this.location.toJSON(Qe),t=(0,Ae.emptyToUndefined)(t),void 0!==t&&(t.visible=!1);return t}select(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.pin;e&&(this.location.visible=!0),t.value=!t.value,t.value&&this.capture()}capture(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=function(e){const t=e.mouseState;if(!t.active)return;const n=[];for(const i of e.layerManager.managedLayers){const t=i.layer;if(null===t)continue;const r=e.get(t);if(void 0===r)continue;const o={};t.initializeSelectionState(o),t.copySelectionState(o,r),n.push({layer:t,state:o})}return{position:t.position.slice(),coordinateSpace:t.coordinateSpace,layers:n}}(this.layerSelectedValues);e&&void 0===t||(this.value=t)}restoreState(e){if(void 0===e)return this.pin.value=!0,void(this.value=void 0);if(null===e)return this.pin.value=!1,this.location.visible=!0,void(this.value=void 0);(0,Ae.verifyObject)(e),this.location.restoreState(e,b()(b()({},$e),{visible:!Be.sw.expectingExternalUI}));const t=this.coordinateSpace.value,n=t.rank>0?(0,Ae.verifyOptionalObjectProperty)(e,"position",(e=>(0,Ae.parseFixedLengthArray)(new Float32Array(t.rank),e,Ae.verifyFiniteFloat))):void 0,i=[];(0,Ae.verifyOptionalObjectProperty)(e,"layers",(e=>{(0,Ae.verifyObject)(e);const t=this.layerSelectedValues.layerManager;for(const r of s()(e)){var n=(0,u.A)(r,2);const e=n[0],o=n[1],s=t.getLayerByName(e);if(void 0===s)return;const a=s.layer;if(null===a)return;(0,Ae.verifyObject)(o);const l={};a.initializeSelectionState(l),a.selectionStateFromJson(l,o),i.push({layer:a,state:l})}})),this.pin.value=i.length>0||void 0!==n,this.value={position:n,coordinateSpace:t,layers:i}}}class tt extends F.O8{constructor(e){super(),this.view=e,this.messages=new z.Mf,this.seenGeneration=-1,this.state=void 0}}let nt=0;class it extends F.O8{constructor(e,t,n,i,r,o){super(),this.layerManager=e,this.renderLayerType=t,this.view=n,this.roles=i,this.layerAdded=r,this.visibility=o,this.visibleLayers_=new(p()),this.debouncedUpdateVisibleLayers=this.registerCancellable(C()((()=>this.updateVisibleLayers()),0)),this.registerDisposer(e.layersChanged.add(this.debouncedUpdateVisibleLayers)),this.registerDisposer(i.changed.add(this.debouncedUpdateVisibleLayers)),this.updateVisibleLayers()}disposed(){this.visibleLayers.forEach((e=>e.dispose())),this.visibleLayers.clear(),super.disposed()}updateVisibleLayers(){const e=++nt,t=this.visibleLayers_,n=this.renderLayerType,i=this.layerAdded,r=this.roles;for(let s of this.layerManager.readyRenderLayers())if(s instanceof n&&r.has(s.role)){let n=s,r=t.get(n);void 0===r&&(r=new tt(this.view),r.registerDisposer(n.messages.addChild(r.messages)),r.registerDisposer(n.addRef()),r.registerDisposer(n.visibility.add(this.visibility)),t.set(n,r),i(n,r),n.attach(r)),r.seenGeneration=e}for(const s of t){var o=(0,u.A)(s,2);const n=o[0],i=o[1];i.seenGeneration!==e&&(t.delete(n),i.dispose())}}get visibleLayers(){return this.debouncedUpdateVisibleLayers.flush(),this.visibleLayers_}}function rt(e,t,n,i,r){return i.registerDisposer(new it(e,t,i,n,((e,t)=>{t.registerDisposer(e.redrawNeeded.add((()=>i.scheduleRedraw())));const n=e.backend;n&&(n.rpc.invoke(M.sC,{layer:n.rpcId,view:i.rpcId}),t.registerDisposer((()=>n.rpc.invoke(M.lG,{layer:n.rpcId,view:i.rpcId})))),void 0!==r&&r(e,t),i.scheduleRedraw(),t.registerDisposer((()=>i.scheduleRedraw()))}),i.visibility))}class ot extends F.O8{constructor(e){super(),this.layerManager=e,this.changed=new fe.IY,this.location=new Ie.c1(Me.vm),this.registerDisposer(e),this.location.changed.add((()=>{var e,t;this.changed.dispatch();const n=null!==(t=null===(e=this.layer)||void 0===e?void 0:e.layer)&&void 0!==t?t:void 0;if(void 0!==n){const e=this.location.value;if(e.visible){const t=n.panels.panels[0];t.location.value!==e&&(t.location.value=e,t.location.locationChanged.dispatch())}}}))}get layer(){return this.layer_}get visible(){return this.location.visible}toggle(e){this.layer===e&&this.visible?this.visible=!1:(this.layer=e,this.visible=!0)}set visible(e){let t=this.layer_;if(!0===e&&void 0===t){const n=this.layerManager.managedLayers;n.length>0?t=this.layer=n[0]:e=!1}if(!0===e&&void 0!==t){const n=t.layer;null!==n&&0!==n.panels.panels[0].tabs.length||(e=!1)}this.visible!==e&&(this.location.visible=e,e||void 0===t||this.maybeDeleteNewLayer(t),this.changed.dispatch())}maybeDeleteNewLayer(e){if(e.wasDisposed)return;const t=e.layer;null!==t&&t instanceof Pt&&(t.dataSources.some((e=>0!==e.spec.url.length))||kt(e))}set layer(e){if(e===this.layer_)return;const t=this.layer_;if(void 0!==t&&(this.existingLayerDisposer(),this.existingLayerDisposer=void 0,this.maybeDeleteNewLayer(t)),this.layer_=e,void 0!==e){const t=()=>{this.layer_=void 0,this.visible=!1,this.existingLayerDisposer=void 0,this.changed.dispatch()};e.registerDisposer(t);const n=e.specificationChanged.add((()=>{this.changed.dispatch()}));this.existingLayerDisposer=()=>{const i=e.layer;if(null!==i){const e=i.tool.value;void 0!==e&&e.deactivate()}e.unregisterDisposer(t),n()}}else this.location.visible=!1;this.changed.dispatch()}toJSON(){const e=this.location.toJSON();return void 0!==this.layer&&(e.layer=this.layer.name),(0,Ae.emptyToUndefined)(e)}restoreState(e){if(void 0===e)return void this.reset();(0,Ae.verifyObject)(e),this.location.restoreState(e);const t=(0,Ae.verifyObjectProperty)(e,"layer",Ae.verifyOptionalString),n=void 0!==t?this.layerManager.getLayerByName(t):void 0;void 0===n&&(this.visible=!1),this.layer=n}reset(){this.location.reset(),this.layer=void 0}}class st extends F.O8{constructor(e,t){super(),this.layerManager=e,this.filter=t,this.changed=new fe.IY,this.validate=C()((()=>{const e=this.layerName_;if(void 0!==e){const t=this.layerManager.getLayerByName(e);void 0!==t&&this.filter(t)?(this.layer_=t,this.changed.dispatch()):(this.layer_=void 0,this.layerName_=void 0,this.changed.dispatch())}}),0),this.registerDisposer(e),this.registerDisposer(e.specificationChanged.add((()=>{const e=this.layer_;if(void 0!==e)if(this.layerManager.layerSet.has(e)&&this.filter(e)){const t=e.name;t!==this.layerName_&&(this.layerName_=t,this.changed.dispatch())}else this.layer_=void 0,this.layerName_=void 0,this.changed.dispatch()})))}get layer(){return this.layer_}get layerName(){return this.layerName_}set layer(e){this.layer_!==e&&(void 0!==e&&this.layerManager.layerSet.has(e)&&this.filter(e)?(this.layer_=e,this.layerName_=e.name):(this.layer_=void 0,this.layerName_=void 0),this.changed.dispatch())}set layerName(e){e!==this.layerName_&&(this.layer_=void 0,this.layerName_=e,this.changed.dispatch(),this.validate())}restoreState(e){const t=(0,Ae.verifyOptionalString)(e);this.layerName=t}toJSON(){const e=this.layer_;return void 0!==e?e.name:this.layerName_}reset(){this.layerName_=void 0,this.layer_=void 0,this.changed.dispatch()}}class at extends F.O8{constructor(e,t,n,i){super(),this.layerManager=e,this.layer=t,this.predicate=n,this.getGroup=i,this.linkedLayers_=new(v()),this.changed=new fe.IY,this.linkedLayersChanged=new fe.IY,this.root_=t;const r=this;this.root={get value(){return r.root_},changed:r.changed}}get linkedLayers(){return this.linkedLayers_}get rootGroup(){return this.getGroup(this.root.value)}reset(){this.isolate()}restoreState(e){if(void 0===e)return;const t=(0,Ae.verifyString)(e);this.linkByName(t)}toJSON(){const e=this.root.value;if(e!==this.layer)return e.managedLayer.name}isolate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.getGroup,n=this.layer,i=this.root_;if(i===n){const e=this.linkedLayers_;if(0!==e.size){for(const n of e){const e=t(n);e.root_=n,e.changed.dispatch()}e.clear(),this.linkedLayersChanged.dispatch()}return}const r=t(i);r.linkedLayers_.delete(n),r.linkedLayersChanged.dispatch(),this.root_=n,e&&this.changed.dispatch()}linkByName(e){const t=this.layer.managedLayer,n=this.layerManager.getLayerByName(e);if(void 0===n)return;if(n===t)return;const i=n.layer;null!==i&&this.predicate(i)&&this.linkToLayer(i)}linkToLayer(e){if(e===this.layer)return;if(this.root_===e)return;this.root_!==this.layer&&this.isolate(!1);const t=this.getGroup,n=t(e).root_;if(n===this.layer)return;const i=t(n);i.linkedLayers_.add(this.layer),i.linkedLayersChanged.dispatch(),this.root_=n,this.changed.dispatch()}disposed(){this.isolate(!1)}}function lt(e,t){const n=(0,Ae.verifyOptionalObjectProperty)(t,"type",Ae.verifyString,"auto");e.archived=(0,Ae.verifyOptionalObjectProperty)(t,"archived",Ae.verifyBoolean,!1),e.archived?e.visible=!1:e.visible=(0,Ae.verifyOptionalObjectProperty)(t,"visible",Ae.verifyBoolean,!0);const i=mt.get(n)||Pt;return e.layer=new i(e),t}function ct(e,t){try{const n=e.layer;if(null===n)return;n.restoreState(t),n.initializationDone()}catch(n){throw kt(e),n}}function dt(e,t){try{(0,Ae.verifyObject)(t),lt(e,t),ct(e,t)}catch(n){throw kt(e),n}}function ut(e,t){try{dt(e,t)}catch(n){(new I.M).setErrorMessage(n instanceof Error?n.message:""+n)}}function ht(e,t,n){const i=new Je(t,e);return dt(i,n),i}class pt extends F.O8{constructor(){super(...arguments),this.changed=new fe.IY}}class ft extends pt{constructor(e,t,n,i,r,o,s,a,l){super(),this.display=e,this.dataSourceProviderRegistry=t,this.layerManager=n,this.chunkManager=i,this.selectionState=r,this.selectedLayer=o,this.coordinateSpace=s,this.globalPosition=a,this.toolBinder=l,this.coordinateSpaceCombiner=new T.Ii(this.coordinateSpace,T.cK),this.subsets=new(v()),this.layerSelectedValues=this.selectionState.layerSelectedValues,this.registerDisposer(n.layersChanged.add(this.changed.dispatch)),this.registerDisposer(n.specificationChanged.add(this.changed.dispatch))}get rpc(){return this.chunkManager.rpc}get root(){return this}reset(){this.layerManager.clear()}restoreState(e){let t;this.layerManager.clear(),Array.isArray(e)?t=e:((0,Ae.verifyObject)(e),t=s()(e).map((e=>{let[t,n]=e;return"string"===typeof n?{name:t,source:n}:((0,Ae.verifyObject)(n),b()(b()({},n),{name:t}))})));const n=[];for(const o of t){(0,Ae.verifyObject)(o);const e=this.layerManager.getUniqueLayerName((0,Ae.verifyObjectProperty)(o,"name",Ae.verifyString)),t=new Je(e,this);try{lt(t,o),this.layerManager.addManagedLayer(t),n.push({managedLayer:t,spec:o})}catch(i){t.dispose();(new I.M).setErrorMessage("Error creating layer ".concat(r()(e),": ")+(i instanceof Error)?i.message:0)}}for(const o of n){const e=o.managedLayer,t=o.spec;try{ct(e,t)}catch(i){(new I.M).setErrorMessage("Error creating layer ".concat(r()(name),": ")+(i instanceof Error)?i.message:0)}}}add(e,t){-1===this.layerManager.managedLayers.indexOf(e)&&(e.name=this.layerManager.getUniqueLayerName(e.name)),this.layerManager.addManagedLayer(e,t)}toJSON(){const e=[];let t=0;for(let n of this.layerManager.managedLayers){const i=n.toJSON();null!=i&&(e.push(i),++t)}if(0!==t)return e}get rootLayers(){return this.layerManager}}class gt extends pt{constructor(e){super(),this.master=e,this.changed=new fe.IY,this.layerManager=this.registerDisposer(new Ke),this.registerDisposer(e);const t=this.layerManager;this.registerDisposer(t.layersChanged.add(this.changed.dispatch)),this.registerDisposer(t.specificationChanged.add(this.changed.dispatch)),e.subsets.add(this)}get rpc(){return this.master.rpc}get dataSourceProviderRegistry(){return this.master.dataSourceProviderRegistry}get chunkManager(){return this.master.chunkManager}get layerSelectedValues(){return this.master.layerSelectedValues}get root(){return this.master}disposed(){super.disposed(),this.master.subsets.delete(this)}reset(){this.layerManager.clear()}restoreState(e){const t=this.master.layerManager,n=[];for(const i of new(v())((0,Ae.parseArray)(e,Ae.verifyString))){const e=t.getLayerByName(i);if(void 0===e)throw new Error("Undefined layer referenced in subset specification: ".concat(r()(i)));e.archived||n.push(e)}this.layerManager.clear();for(const i of n)this.layerManager.addManagedLayer(i.addRef())}toJSON(){return this.layerManager.managedLayers.map((e=>e.name))}add(e,t){-1===this.master.layerManager.managedLayers.indexOf(e)&&(e.name=this.master.layerManager.getUniqueLayerName(e.name),this.master.layerManager.addManagedLayer(e.addRef())),this.layerManager.addManagedLayer(e,t)}get rootLayers(){return this.master.rootLayers}}const mt=new(p()),vt=new(p()),yt=[e=>{const t=e.volume;if(void 0===t)return;const n=vt.get(t.volumeType);return void 0!==n?{layerConstructor:n,priority:0}:void 0}];function bt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.type;mt.set(t,e)}function St(e){yt.push(e)}function wt(e,t){vt.set(e,t)}function xt(e,t){const n=e.layer;if(null===n)return;const i=n.toJSON(),r=new t(e);r.restoreState(i),r.initializationDone(),e.layer=r}function Ct(e,t){return t!==e.name&&(t=e.manager.root.layerManager.getUniqueLayerName(t),e.name=t,e.layerChanged.dispatch(),!0)}function kt(e){if(!e.wasDisposed)for(const t of e.containers)t.removeManagedLayer(e)}function Et(e,t){return void 0===e?t:void 0===t?e:e.priority<t.priority?t:e}function Tt(e){let t;for(const i of yt)t=Et(t,i(e));const n=e.volume;if(void 0!==n){const e=vt.get(n.volumeType);void 0!==e&&(t=Et(t,{layerConstructor:e,priority:0}))}return t}function Lt(e){let t;for(const n of e){t=Et(t,Tt(n.subsourceEntry.subsource))}return t}class Pt extends qe{activateDataSubsources(e){var t;this.detectedLayerConstructor=null===(t=Lt(e))||void 0===t?void 0:t.layerConstructor}}Pt.type="new",Pt.typeAbbreviation="new";class Dt extends qe{activateDataSubsources(e){var t;const n=null===(t=Lt(e))||void 0===t?void 0:t.layerConstructor;void 0!==n&&xt(this.managedLayer,n)}}function Mt(e,t){const n=ht(e,"new layer",{type:"new"});e.add(n),t.layer=n,t.visible=!0}Dt.type="auto",Dt.typeAbbreviation="auto",bt(Pt),bt(Dt)},575:(e,t,n)=>{n.d(t,{$6:()=>k,Es:()=>b,eE:()=>C});var i=n(974),r=n.n(i),o=n(2982),s=n(608),a=n.n(s),l=n(8332),c=n(2579),d=n(3985),u=n(9735),h=n(2959),p=n(7562),f=n(7970),g=n(2729),m=n(8164),v=n(6344);function y(e){return"boolean"===typeof e?{enabled:e}:((0,f.verifyObject)(e),{enabled:(0,f.verifyOptionalObjectProperty)(e,"enabled",f.verifyBoolean)})}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return"string"===typeof e?{url:e,transform:t,enableDefaultSubsources:!0,subsources:new(a())}:((0,f.verifyObject)(e),{url:(0,f.verifyObjectProperty)(e,"url",f.verifyString),transform:(0,f.verifyObjectProperty)(e,"transform",l.iG)||t,enableDefaultSubsources:(0,f.verifyOptionalObjectProperty)(e,"enableDefaultSubsources",f.verifyBoolean,!0),subsources:(0,f.verifyOptionalObjectProperty)(e,"subsources",(e=>(0,f.verifyObjectAsMap)(e,y)),new(a()))})}function S(e){return e.enabled}function w(e){const t=(0,l.Bk)(e.transform),n={};let i=!0;for(const s of e.subsources){var r=(0,o.A)(s,2);const e=r[0],t=S(r[1]);void 0!==t&&(n[e]=t,i=!1)}return void 0===t&&i&&!0===e.enableDefaultSubsources?e.url:{url:e.url,transform:t,subsources:i?void 0:n,enableDefaultSubsources:!0===e.enableDefaultSubsources&&void 0}}class x{constructor(e,t,n,i,r){let o;this.loadedDataSource=e,this.subsourceEntry=t,this.subsourceSpec=n,this.subsourceIndex=i,this.activated=void 0,this.guardValues=[],this.messages=new m.Mf,this.isActiveChanged=new v.IY,o=void 0===n||void 0===n.enabled?t.default&&r:n.enabled;const s=e.dataSource.modelTransform.sourceRank;let a=t.modelSubspaceDimensionIndices;if(void 0===a){a=new Array(s);for(let e=0;e<s;++e)a[e]=e}var l=t.subsourceToModelSubspaceTransform;const c=void 0===l?g.DA(Float32Array,a.length+1):l;this.enabled=o,this.subsourceToModelSubspaceTransform=c,this.modelSubspaceDimensionIndices=a,this.isActiveChanged.add(e.activatedSubsourcesChanged.dispatch)}activate(e){this.messages.clearMessages();for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(void 0!==this.activated){if((0,u.r1)(n,this.guardValues))return;this.activated.dispose()}this.guardValues=n;e(this.activated=new p.O8),this.isActiveChanged.dispatch()}deactivate(e){this.messages.clearMessages(),this.messages.addMessage({severity:m.TU.error,message:e});const t=this.activated;void 0!==t&&(this.activated=void 0,t.dispose(),this.isActiveChanged.dispatch())}addRenderLayer(e){const t=this.activated;t.registerDisposer(this.loadedDataSource.layer.addRenderLayer(e)),t.registerDisposer(this.messages.addChild(e.messages))}getRenderLayerTransform(e){const t=this.activated;var n=this.loadedDataSource;const i=n.layer,r=n.transform;return t.registerDisposer((0,d.Z2)(i.manager.root.coordinateSpace,i.localPosition.coordinateSpace,r,this,e))}}class C extends p.O8{constructor(e,t,n){super(),this.layerDataSource=e,this.dataSource=t,this.error=void 0,this.enabledSubsourcesChanged=new v.IY,this.activatedSubsourcesChanged=new v.IY,this.messages=new m.Mf,t.canChangeModelSpaceRank?(this.transform=new l.QN((0,l.FH)((0,l.d)({rank:0,scales:new Float64Array(0),units:[],names:[]})),!0),this.transform.value=t.modelTransform):this.transform=new l.QN(t.modelTransform),void 0!==n.transform&&(this.transform.spec=n.transform);const i=n.subsources;this.enableDefaultSubsources=n.enableDefaultSubsources,this.subsources=t.subsources.map(((e,t)=>new x(this,e,i.get(e.id),t,this.enableDefaultSubsources)))}get enabledSubsources(){return this.subsources.filter((e=>e.enabled))}get layer(){return this.layerDataSource.layer}disposed(){for(const e of this.subsources){const t=e.activated;void 0!==t&&(e.activated=void 0,t.dispose())}}}class k extends p.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;super(),this.layer=e,this.changed=new v.IY,this.messages=new m.Mf,this.loadState_=void 0,this.specGeneration=-1,this.refCounted_=void 0,this.registerDisposer(this.changed.add(e.dataSourcesChanged.dispatch)),void 0===t?this.spec_=(0,c.Q4)():this.spec=t}get spec(){const e=this.loadState;if(void 0!==e&&void 0===e.error){const t=this.changed.count;t!==this.specGeneration&&(this.specGeneration=t,this.spec_={url:this.spec.url,transform:e.transform.spec,enableDefaultSubsources:e.enableDefaultSubsources,subsources:new(a())(r()(e.subsources,(t=>{const n=e.enableDefaultSubsources&&t.subsourceEntry.default;return[t.subsourceEntry.id,{enabled:t.enabled!==n?t.enabled:void 0}]})))})}return this.spec_}get loadState(){return this.loadState_}set spec(e){const t=this.layer;if(this.messages.clearMessages(),0===e.url.length){if(1!==t.dataSources.length){const e=t.dataSources.indexOf(this);if(-1!==e)return t.dataSources.splice(e,1),t.dataSourcesChanged.dispatch(),void this.dispose()}return this.spec_=e,void(void 0!==this.refCounted_&&(this.refCounted_.dispose(),this.refCounted_=void 0,this.loadState_=void 0,this.changed.dispatch()))}const n=new p.O8,i=n.registerDisposer((0,p.K9)(t.markLoading()));void 0!==this.refCounted_&&(this.refCounted_.dispose(),this.loadState_=void 0),this.refCounted_=n,this.spec_=e;const r=t.manager.chunkManager,o=t.manager.dataSourceProviderRegistry,s=new h.Qi;this.messages.addMessage({severity:m.TU.info,message:"Loading data source"}),o.get({chunkManager:r,url:e.url,cancellationToken:s,globalCoordinateSpace:t.manager.root.coordinateSpace,transform:e.transform}).then((r=>{if(n.wasDisposed)return;this.messages.clearMessages();const o=n.registerDisposer(new C(this,r,e));o.registerDisposer(t.addCoordinateSpace(o.transform.outputSpace)),o.registerDisposer(o.transform.changed.add(this.changed.dispatch)),this.loadState_=o,o.registerDisposer(o.enabledSubsourcesChanged.add(this.changed.dispatch)),this.changed.dispatch(),i()})).catch((e=>{this.wasDisposed||(this.loadState_={error:e},this.messages.clearMessages(),this.messages.addMessage({severity:m.TU.error,message:e.message}),this.changed.dispatch())})),n.registerDisposer((()=>{s.cancel()})),this.changed.dispatch()}disposed(){const e=this.refCounted_;void 0!==e&&e.dispose()}toJSON(){const e=this.loadState;return void 0===e||void 0!==e.error?w(this.spec):w({url:this.spec.url,transform:e.transform.spec,enableDefaultSubsources:e.enableDefaultSubsources,subsources:new(a())(r()(e.subsources,(t=>{const n=e.enableDefaultSubsources&&t.subsourceEntry.default;return[t.subsourceEntry.id,{enabled:t.enabled!==n?t.enabled:void 0}]})))})}}},1202:(e,t,n)=>{n.d(t,{Of:()=>i,Pc:()=>a,Yo:()=>r,dI:()=>o,pi:()=>s});const i="mesh/MeshLayer",r="mesh/MultiscaleMeshLayer",o="mesh/FragmentSource",s="mesh/MultiscaleFragmentSource";var a;!function(e){e[e.float32=0]="float32",e[e.uint10=1]="uint10",e[e.uint16=2]="uint16"}(a||(a={}))},6423:(e,t,n)=>{n.d(t,{d8:()=>O,No:()=>V,Ye:()=>U,bJ:()=>G});var i=n(3651),r=n.n(i),o=n(6063),s=n.n(o),a=n(5677),l=n.n(a),c=n(6094),d=n(5795),u=n(1202),h=(n(1274),n(3835));const p=!1;function f(e,t,n,i,r,o,s){const a=e.octree,l=e.lodScales,c=e.chunkGridSpatialOrigin,d=e.chunkShape,u=l.length-1,p=t[0],f=t[4],g=t[8],m=t[1],v=t[5],y=t[9],b=t[3],S=t[7],w=t[11],x=t[15],C=b>0?0:1,k=S>0?0:1,E=w>0?0:1,T=n[16],L=n[17],P=n[18],D=n[19];function M(e,t,n){return b*e+S*t+w*n+x}const I=M(-D*T,-D*L,-D*P),R=e.clipLowerBound[0],A=e.clipLowerBound[1],O=e.clipLowerBound[2],N=e.clipUpperBound[0],_=e.clipUpperBound[1],V=e.clipUpperBound[2],B=Math.sqrt((p*r)**2+(m*o)**2),F=Math.sqrt((f*r)**2+(v*o)**2),U=Math.sqrt((g*r)**2+(y*o)**2),z=Math.max(B,F,U);!function e(t,r,o){const u=1<<t,p=5*r,f=a[p],g=a[p+1],m=a[p+2],v=a[p+3],y=a[p+4];let b=f*u*d[0]+c[0],S=g*u*d[1]+c[1],w=m*u*d[2]+c[2],x=b+u*d[0],T=S+u*d[1],L=w+u*d[2];if(b=Math.max(b,R),S=Math.max(S,A),w=Math.max(w,O),x=Math.min(x,N),T=Math.min(T,_),L=Math.min(L,V),(0,h.T_)(b,S,w,x,T,L,n)){const n=Math.max(I,function(e,t,n,i,r,o){return M(e+C*(i-e),t+k*(r-t),n+E*(o-n))}(b,S,w,x,T,L)),a=n/z;if(0===o||a*i<o){const n=l[t];if(0!==n&&s(t,r,n/a,y>>>31),t>0&&(0===n||a*i<n)){const i=0===n?o:n,r=(2147483647&y)>>>0;for(let n=v;n<r;++n)e(t-1,n,i)}}}}(u,a.length/5-1,0)}function g(e,t,n,i,r,o,s,a){const l=e.lodScales;let c=0;for(;c+1<l.length&&0!==l[c+1];)++c;const d=[];let u=0,h=0;function g(e,t){for(p;;){if(0===u)return;const n=u-1,i=c-n,r=d[3*n],o=0===i?1:8,s=d[3*n+1],l=d[3*n+2];if(e===u){const e=t&o-1;return h!==e&&-1!==r&&a(i,r,h,e,l),void(h=e+1)}h!==o&&-1!==r&&a(i,r,h,o,l),h=s+1,--u}}let m=0;const v=e.octree;f(e,t,n,i,r,o,((e,t,n,i)=>{if(!i&&!s(e,t,n))return void(m=Math.max(e,m));if(e<m)return;m=0;const r=5*t,o=function(e,t,n){return 1&e|t<<1&2|n<<2&4}(v[r],v[r+1],v[r+2]),a=c-e;g(a,o);const l=3*a;d[l]=i?-1:t,d[l+1]=o,d[l+2]=n,h=0,u=a+1})),g(0,0)}function m(e,t,n){return"".concat(e,"/").concat(t,":").concat(n)}var v=n(6560),y=n(3056),b=n(4874),S=n(739),w=n(7160),x=n(2729),C=n(9981),k=n(9080),E=n(7799),T=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=l()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&s()(t,n,a),a};const L=h.pB.create(),P=h.w0.create();function D(e,t){t.vertexBuffer=C.h.fromData(e,t.meshData.vertexPositions,e.ARRAY_BUFFER,e.STATIC_DRAW),t.indexBuffer=C.h.fromData(e,t.meshData.indices,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),t.normalBuffer=C.h.fromData(e,t.meshData.vertexNormals,e.ARRAY_BUFFER,e.STATIC_DRAW)}function M(e){e.vertexBuffer.dispose(),e.indexBuffer.dispose(),e.normalBuffer.dispose()}function I(e){return{defineShader:e=>{e.addAttribute("highp vec3","aVertexPosition"),e.addVertexCode("highp vec3 getVertexPosition() { return aVertexPosition; }")},bind(t,n,i){i.vertexBuffer.bindToVertexAttrib(n.attribute("aVertexPosition"),3,e,!0)},endLayer:(e,t)=>{e.disableVertexAttribArray(t.attribute("aVertexPosition"))}}}const R={[u.Pc.float32]:I(WebGL2RenderingContext.FLOAT),[u.Pc.uint16]:I(WebGL2RenderingContext.UNSIGNED_SHORT),[u.Pc.uint10]:{defineShader:e=>{e.addAttribute("highp uint","aVertexPosition"),e.addVertexCode("\nhighp vec3 getVertexPosition() {\n  return vec3(float(aVertexPosition & 1023u),\n              float((aVertexPosition >> 10) & 1023u),\n              float((aVertexPosition >> 20) & 1023u)) / 1023.0;\n}\n")},bind(e,t,n){n.vertexBuffer.bindToVertexAttribI(t.attribute("aVertexPosition"),1,WebGL2RenderingContext.UNSIGNED_INT)},endLayer:(e,t)=>{e.disableVertexAttribArray(t.attribute("aVertexPosition"))}}};class A{constructor(e,t){this.fragmentRelativeVertices=e,this.vertexPositionFormat=t,this.tempLightVec=new Float32Array(4),this.vertexPositionHandler=R[this.vertexPositionFormat]}beginLayer(e,t,n,i){let r=n.lightDirection,o=n.ambientLighting,s=n.directionalLighting,a=this.tempLightVec;h.eR.scale(a,r,s),a[3]=o,e.uniform4fv(t.uniform("uLightDirection"),a);const l=i.silhouetteRendering.value;l>0&&e.uniform1f(t.uniform("uSilhouettePower"),l)}setColor(e,t,n){e.uniform4fv(t.uniform("uColor"),n)}setPickID(e,t,n){e.uniform1ui(t.uniform("uPickID"),n)}beginModel(e,t,n,i){const r=n.projectionParameters;e.uniformMatrix4fv(t.uniform("uModelViewProjection"),!1,h.pB.multiply(L,r.viewProjectionMat,i)),(0,h._A)(P,i),(0,h.Jh)(P,P,r.displayDimensionRenderInfo.canonicalVoxelFactors),h.w0.invert(P,P),h.w0.transpose(P,P),e.uniformMatrix3fv(t.uniform("uNormalMatrix"),!1,P)}drawFragmentHelper(e,t,n,i,r){this.vertexPositionHandler.bind(e,t,n);const o=n.meshData;n.normalBuffer.bindToVertexAttrib(t.attribute("aVertexNormal"),2,WebGL2RenderingContext.BYTE,!0),n.indexBuffer.bind();const s=o.indices;e.drawElements(o.strips?WebGL2RenderingContext.TRIANGLE_STRIP:WebGL2RenderingContext.TRIANGLES,r-i,2===s.BYTES_PER_ELEMENT?WebGL2RenderingContext.UNSIGNED_SHORT:WebGL2RenderingContext.UNSIGNED_INT,i*s.BYTES_PER_ELEMENT)}drawFragment(e,t,n){const i=n.meshData.indices;this.drawFragmentHelper(e,t,n,0,i.length)}drawMultiscaleFragment(e,t,n,i,r){const o=n.meshData.subChunkOffsets[i],s=n.meshData.subChunkOffsets[r];this.drawFragmentHelper(e,t,n,o,s)}endLayer(e,t){this.vertexPositionHandler.endLayer(e,t),e.disableVertexAttribArray(t.attribute("aVertexNormal"))}makeGetter(e){const t=e.registerDisposer((0,w.Uq)((e=>e>0),[e.displayState.silhouetteRendering]));return(0,k.P9)(e,e.gl,{memoizeKey:"mesh/MeshShaderManager/".concat(this.fragmentRelativeVertices,"/").concat(this.vertexPositionFormat),parameters:t,defineShader:(e,t)=>{this.vertexPositionHandler.defineShader(e),e.addAttribute("highp vec2","aVertexNormal"),e.addVarying("highp vec4","vColor"),e.addUniform("highp vec4","uLightDirection"),e.addUniform("highp vec4","uColor"),e.addUniform("highp mat3","uNormalMatrix"),e.addUniform("highp mat4","uModelViewProjection"),e.addUniform("highp uint","uPickID"),t&&e.addUniform("highp float","uSilhouettePower"),this.fragmentRelativeVertices&&(e.addUniform("highp vec3","uFragmentOrigin"),e.addUniform("highp vec3","uFragmentShape")),e.addVertexCode("\nhighp vec3 decodeNormalOctahedronSnorm8(highp vec2 e) {\n  vec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\n  if (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * vec2(v.x > 0.0 ? 1.0 : -1.0, v.y > 0.0 ? 1.0 : -1.0);\n  return normalize(v);\n}\n");let n="";this.fragmentRelativeVertices?n+="\nhighp vec3 vertexPosition = uFragmentOrigin + uFragmentShape * getVertexPosition();\nhighp vec3 normalMultiplier = 1.0 / uFragmentShape;\n":n+="\nhighp vec3 vertexPosition = getVertexPosition();\nhighp vec3 normalMultiplier = vec3(1.0, 1.0, 1.0);\n",n+="\ngl_Position = uModelViewProjection * vec4(vertexPosition, 1.0);\nvec3 origNormal = decodeNormalOctahedronSnorm8(aVertexNormal);\nvec3 normal = normalize(uNormalMatrix * (normalMultiplier * origNormal));\nfloat absCosAngle = abs(dot(normal, uLightDirection.xyz));\nfloat lightingFactor = absCosAngle + uLightDirection.w;\nvColor = vec4(lightingFactor * uColor.rgb, uColor.a);\n",t&&(n+="\nvColor *= pow(1.0 - absCosAngle, uSilhouettePower);\n"),e.setVertexMain(n),e.setFragmentMain("emit(vColor, uPickID);")}})}}class O extends v.r{constructor(e,t,n){super(),this.chunkManager=e,this.source=t,this.displayState=n,this.meshShaderManager=new A(!1,u.Pc.float32),this.getShader=this.meshShaderManager.makeGetter(this),(0,S.registerRedrawWhenSegmentationDisplayState3DChanged)(n,this),this.registerDisposer(n.silhouetteRendering.changed.add(this.redrawNeeded.dispatch));let i=this.backend=this.registerDisposer(new S.SegmentationLayerSharedObject(e,n,this.layerChunkProgressInfo));i.RPC_TYPE_ID=u.Of,i.initializeCounterpartWithChunkManager({source:t.addCounterpartRef()}),i.visibility.add(this.visibility),this.registerDisposer(n.renderScaleHistogram.visibility.add(this.visibility))}get isTransparent(){const e=this.displayState;return e.objectAlpha.value<1||e.silhouetteRendering.value>0}get transparentPickEnabled(){return this.displayState.transparentPickEnabled.value}get gl(){return this.chunkManager.chunkQueueManager.gl}draw(e,t){if(!e.emitColor&&e.alreadyEmittedPickID)return;const n=this.gl,i=this.displayState,r=this.meshShaderManager;if(i.objectAlpha.value<=0)return;const o=(0,y.$x)(i.transform.value,e.projectionParameters.displayDimensionRenderInfo,t);if(void 0===o)return;const s=this.getShader(e.emitter).shader;if(null===s)return;s.bind(),r.beginLayer(n,s,e,this.displayState),r.beginModel(n,s,e,o);const a=this.source.chunks;let l=0,d=0;const u=this.displayState.renderScaleHistogram,h=this.source.fragmentSource.chunks;(0,S.forEachVisibleSegmentToDraw)(i,this,e.emitColor,e.emitPickID?e.pickIDs:void 0,((t,i,o)=>{const u=(0,b.dH)(t),p=a.get(u);if(++l,void 0!==p){++d,e.emitColor&&r.setColor(n,s,i),e.emitPickID&&r.setPickID(n,s,o),l+=p.fragmentIds.length;for(const e of p.fragmentIds){const t=this.source.getFragmentKey(u,e).key,i=h.get(t);void 0!==i&&i.state===c.HU.GPU_MEMORY&&(r.drawFragment(n,s,i),++d)}}})),e.emitColor&&(u.begin(this.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber),u.add(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,d,l-d)),r.endLayer(n,s)}isReady(){const e=this.displayState,t=this.source;let n=!0;const i=t.fragmentSource.chunks;return(0,b.SH)(e.segmentationGroupState.value,(e=>{const r=(0,b.dH)(e),o=t.chunks.get(r);if(void 0!==o)for(const t of o.fragmentIds){const e=this.source.getFragmentKey(r,t).key,o=i.get(e);if(void 0===o||o.state!==c.HU.GPU_MEMORY)return void(n=!1)}else n=!1})),n}}class N extends d.AA{constructor(e,t){super(e),this.fragmentIds=t.fragmentIds}}class _ extends d.AA{constructor(e,t){super(e),this.meshData=t}copyToGPU(e){super.copyToGPU(e),D(e,this)}freeGPUMemory(e){super.freeGPUMemory(e),M(this)}}class V extends d.PU{constructor(e,t){super(e,t),this.fragmentSource=this.registerDisposer(new B(this.chunkManager,this))}initializeCounterpart(e,t){this.fragmentSource.initializeCounterpart(this.chunkManager.rpc,{}),t.fragmentSource=this.fragmentSource.addCounterpartRef(),super.initializeCounterpart(e,t)}getChunk(e){return new N(this,e)}getFragmentKey(e,t){return{key:"".concat(e,"/").concat(t),fragmentId:t}}}let B=class extends d.PU{constructor(e,t){super(e),this.meshSource=t}get key(){return this.meshSource.key}getChunk(e){return new _(this,e)}};function F(e,t,n,i){const r=e.get(m(t,n,i));return void 0!==r&&r.state===c.HU.GPU_MEMORY}B=T([(0,E.R6)(u.dI)],B);class U extends v.r{constructor(e,t,n){super(),this.chunkManager=e,this.source=t,this.displayState=n,this.meshShaderManager=new A(this.source.format.fragmentRelativeVertices,this.source.format.vertexPositionFormat),this.getShader=this.meshShaderManager.makeGetter(this),(0,S.registerRedrawWhenSegmentationDisplayState3DChanged)(n,this),this.registerDisposer(n.silhouetteRendering.changed.add(this.redrawNeeded.dispatch));let i=this.backend=this.registerDisposer(new S.SegmentationLayerSharedObject(e,n,this.layerChunkProgressInfo));i.RPC_TYPE_ID=u.Yo,i.initializeCounterpartWithChunkManager({source:t.addCounterpartRef()}),i.visibility.add(this.visibility),this.registerDisposer(n.renderScaleHistogram.visibility.add(this.visibility))}get isTransparent(){const e=this.displayState;return e.objectAlpha.value<1||e.silhouetteRendering.value>0}get transparentPickEnabled(){return this.displayState.transparentPickEnabled.value}get gl(){return this.chunkManager.chunkQueueManager.gl}draw(e,t){if(!e.emitColor&&e.alreadyEmittedPickID)return;const n=this.gl,i=this.displayState,r=this.meshShaderManager;if(i.objectAlpha.value<=0)return;const o=(0,y.$x)(i.transform.value,e.projectionParameters.displayDimensionRenderInfo,t);if(void 0===o)return;const s=this.getShader(e.emitter).shader;if(null===s)return;s.bind(),r.beginLayer(n,s,e,this.displayState);const a=this.displayState.renderScaleHistogram;e.emitColor&&a.begin(this.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber),(0,h._A)(P,o),(0,h.Jh)(P,P,e.projectionParameters.displayDimensionRenderInfo.voxelPhysicalScales);const l=Math.pow(Math.abs(h.w0.determinant(P)),1/3),c=this.source.chunks,d=this.source.fragmentSource.chunks,u=e.projectionParameters,p=h.pB.multiply(h.pB.create(),u.viewProjectionMat,o),f=(0,h._S)(new Float32Array(24),p),v=this.displayState.renderScaleTarget.value,w=this.source.format.fragmentRelativeVertices;r.beginModel(n,s,e,o);let x=0,C=0;(0,S.forEachVisibleSegmentToDraw)(i,this,e.emitColor,e.emitPickID?e.pickIDs:void 0,((t,i,o)=>{const h=(0,b.dH)(t),y=c.get(h);if(++x,void 0===y)return;++C;const S=y.manifest,k=S.octree,E=S.chunkShape,T=S.chunkGridSpatialOrigin,L=S.vertexOffsets;e.emitColor&&r.setColor(n,s,i),e.emitPickID&&r.setPickID(n,s,o),g(S,p,f,v,u.width,u.height,((t,n,i)=>{const r=F(d,h,t,n);return e.emitColor&&a.add(S.lodScales[t]*l,i,r?1:0,r?0:1),r}),((e,t,i,o)=>{const a=m(h,e,t),l=d.get(a),c=k[5*t],u=k[5*t+1],p=k[5*t+2],f=1<<e;w&&(n.uniform3f(s.uniform("uFragmentOrigin"),T[0]+c*E[0]*f+L[3*e+0],T[1]+u*E[1]*f+L[3*e+1],T[2]+p*E[2]*f+L[3*e+2]),n.uniform3f(s.uniform("uFragmentShape"),E[0]*f,E[1]*f,E[2]*f)),r.drawMultiscaleFragment(n,s,l,i,o)}))})),a.add(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,C,x-C),r.endLayer(n,s)}isReady(e,t){let n=this.displayState;if(n.objectAlpha.value<=0)return!0;const i=(0,y.$x)(n.transform.value,e.projectionParameters.displayDimensionRenderInfo,t);if(void 0===i)return!1;const r=this.source.chunks,o=this.source.fragmentSource.chunks,s=e.projectionParameters,a=h.pB.multiply(h.pB.create(),s.viewProjectionMat,i),l=(0,h._S)(new Float32Array(24),a),c=this.displayState.renderScaleTarget.value;let d=!0;return(0,b.SH)(n.segmentationGroupState.value,(e=>{if(!d)return;const t=(0,b.dH)(e),n=r.get(t);if(void 0===n)return void(d=!1);g(n.manifest,a,l,c,s.width,s.height,((e,n)=>(d=d&&F(o,t,e,n),d)),(()=>{}))})),d}getObjectPosition(e){const t=this.displayState.transform.value;if(void 0!==t.error)return;const n=this.source.chunks.get((0,b.dH)(e));if(void 0===n)return;const i=n.manifest,r=i.clipLowerBound,o=i.clipUpperBound,s=t.rank,a=new Float32Array(s);for(let c=0;c<3;++c)a[c]=(r[c]+o[c])/2;const l=new Float32Array(s);return x.vo(l,t.modelToRenderLayerTransform,s+1,a,s),l}}class z extends d.AA{constructor(e,t){super(e),this.manifest=t.manifest}}class j extends d.AA{constructor(e,t){super(e),this.meshData=t}copyToGPU(e){super.copyToGPU(e),D(e,this)}freeGPUMemory(e){super.freeGPUMemory(e),M(this)}}class G extends d.PU{constructor(e,t){super(e,t),this.fragmentSource=this.registerDisposer(new W(this.chunkManager,this)),this.format=t.format}static encodeOptions(e){return r()({format:e.format},super.encodeOptions(e))}initializeCounterpart(e,t){this.fragmentSource.initializeCounterpart(this.chunkManager.rpc,{}),t.fragmentSource=this.fragmentSource.addCounterpartRef(),t.format=this.format,super.initializeCounterpart(e,t)}getChunk(e){return new z(this,e)}}let W=class extends d.PU{constructor(e,t){super(e),this.meshSource=t}get key(){return this.meshSource.key}getChunk(e){return new j(this,e)}};W=T([(0,E.R6)(u.pi)],W)},201:(e,t,n)=>{n.d(t,{Dm:()=>Y,EC:()=>F,Ey:()=>H,MT:()=>K,QA:()=>te,Ti:()=>U,Yu:()=>$,_v:()=>ee,aI:()=>J,fj:()=>X,hb:()=>i,kt:()=>ne,nA:()=>q,ru:()=>B,wP:()=>Q,x_:()=>z,yX:()=>O,zX:()=>G});var i,r,o=n(4117),s=n.n(o),a=n(6392),l=n.n(a),c=n(1526),d=n.n(c),u=n(8178),h=n.n(u),p=n(3816),f=n.n(p),g=n(1190),m=n.n(g),v=n(974),y=n.n(v),b=n(8332),S=n(9735),w=n(7562),x=n(3835),C=n(7970),k=n(6344),E=n(233),T=n(6429),L=n(9799);!function(e){e[e.LINKED=0]="LINKED",e[e.RELATIVE=1]="RELATIVE",e[e.UNLINKED=2]="UNLINKED"}(i||(i={})),function(e){e[e.LINKED=0]="LINKED",e[e.UNLINKED=2]="UNLINKED"}(r||(r={}));class P extends T.F{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.LINKED;super(i,e)}}class D extends T.F{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.LINKED;super(r,e)}}const M=x.eR.create(),I=x.Yu.create();function R(e,t,n,r){let o,s=!1;e.registerDisposer(t);let a=i.UNLINKED;const l=()=>{const s=n.value;if(s!==a)switch(s){case i.UNLINKED:o=void 0;break;case i.LINKED:o=void 0,r.assign(e,t);break;case i.RELATIVE:o=r.difference(e,t)}a=s,e.changed.dispatch()};return e.registerDisposer(e.changed.add((()=>{if(!s)switch(n.value){case i.UNLINKED:break;case i.LINKED:r.assign(t,e);break;case i.RELATIVE:r.subtract(t,e,o)}}))),e.registerDisposer(t.changed.add((()=>{switch(s=!0,n.value){case i.UNLINKED:if(r.isValid(e))break;case i.LINKED:r.assign(e,t);break;case i.RELATIVE:r.add(e,t,o)}s=!1}))),e.registerDisposer(n.changed.add(l)),l(),e}function A(e,t,n,i){return R(e,t,n,i)}class O extends w.O8{constructor(e){super(),this.coordinateSpace=e,this.coordinates_=L.qE,this.changed=new k.IY,this.registerDisposer(e.changed.add((()=>{this.handleCoordinateSpaceChanged()})))}get valid(){return this.coordinateSpace.value.valid}get value(){return this.handleCoordinateSpaceChanged(),this.coordinates_}reset(){this.curCoordinateSpace=void 0,this.coordinates_=L.qE,this.changed.dispatch()}set value(e){const t=this.curCoordinateSpace;if(void 0===t||!t.valid||t.rank!==e.length)return;this.coordinates_.set(e),this.changed.dispatch()}handleCoordinateSpaceChanged(){const e=this.coordinateSpace.value,t=this.curCoordinateSpace;if(e===t)return;this.curCoordinateSpace=e;const n=e.rank;if(!e.valid)return;if(void 0===t||!t.valid){let t=this.coordinates_;if(void 0!==t&&t.length===n);else{t=this.coordinates_=new Float32Array(n),(0,b.RE)(t,e.bounds);for(let e=0;e<n;++e)t[e]=Math.floor(t[e])+.5}return void this.changed.dispatch()}const i=new Float32Array(n),r=this.coordinates_,o=e.ids,s=e.scales,a=t.ids,l=t.scales;for(let c=0;c<n;++c){const t=o[c],n=a.indexOf(t);i[c]=-1===n?(0,b.ge)(e.bounds.lowerBounds[c],e.bounds.upperBounds[c]):r[n]*(l[n]/s[c])}this.coordinates_=i,this.changed.dispatch()}toJSON(){if(!this.valid&&0===this.coordinates_.length)return;this.handleCoordinateSpaceChanged();const e=this.value;return 0!==e.length?y()(e):void 0}restoreState(e){void 0!==e?(this.curCoordinateSpace=void 0,this.coordinates_=Float32Array.from((0,C.parseArray)(e,C.verifyFiniteFloat)),this.handleCoordinateSpaceChanged(),this.changed.dispatch()):this.reset()}snapToVoxel(){this.handleCoordinateSpaceChanged();const e=this.coordinates_,t=e.length;for(let n=0;n<t;++n)e[n]=Math.floor(e[n])+.5;this.changed.dispatch()}assign(e){e.handleCoordinateSpaceChanged();const t=e.curCoordinateSpace,n=e.coordinates_;this.curCoordinateSpace=t,this.coordinates_=Float32Array.from(n),this.changed.dispatch()}static getOffset(e,t){const n=e.coordinates_,i=t.coordinates_;if(n.length===i.length)return L.Re(new Float32Array(n.length),n,i)}static addOffset(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.handleCoordinateSpaceChanged();const r=t.value;void 0!==n&&r.length===n.length&&(L.Ln(e.value,r,n,i),e.changed.dispatch())}get legacyJsonView(){const e=this;return{changed:e.changed,toJSON:()=>e.toJSON(),reset(){e.reset()},restoreState(t){void 0===t||Array.isArray(t)?e.restoreState(t):((0,C.verifyObject)(t),(0,E.wX)(t,"voxelCoordinates",e))}}}}function N(e,t,n){void 0!==n&&0!==m()(n).length?((0,C.verifyObject)(n),e.value=i.UNLINKED,(0,C.verifyObjectProperty)(n,"value",(e=>{void 0!==e&&t.restoreState(e)})),(0,C.verifyObjectProperty)(n,"link",(t=>e.restoreState(t)))):e.value=i.LINKED}class _{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P;this.peer=e,this.link=t}get changed(){return this.value.changed}toJSON(){const e=this.link;if(e.value!==i.LINKED)return{link:e.toJSON(),value:this.getValueJson()}}getValueJson(){return this.value.toJSON()}reset(){this.link.value=i.LINKED}restoreState(e){N(this.link,this.value,e)}copyToPeer(){this.link.value!==i.LINKED&&(this.link.value=i.UNLINKED,this.peer.assign(this.value),this.link.value=i.LINKED)}}class V extends _{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D)}}class B extends _{constructor(){super(...arguments),this.value=R(new O(this.peer.coordinateSpace),this.peer,this.link,{assign:(e,t)=>e.assign(t),isValid:e=>e.valid,difference:O.getOffset,add:O.addOffset,subtract:(e,t,n)=>{O.addOffset(e,t,n,-1)}})}}class F extends w.O8{constructor(e){super(),this.changed=new k.IY,null==e&&(e=x.Yu.create()),this.orientation=e}toJSON(){let e=this.orientation;var t;if(x.Yu.normalize(this.orientation,this.orientation),0!==(t=e)[0]||0!==t[1]||0!==t[2]||1!==t[3])return Array.prototype.slice.call(this.orientation)}restoreState(e){try{(0,C.parseFiniteVec)(this.orientation,e),x.Yu.normalize(this.orientation,this.orientation)}catch(t){x.Yu.identity(this.orientation)}this.changed.dispatch()}reset(){x.Yu.identity(this.orientation),this.changed.dispatch()}snap(){let e=x.w0.create();x.w0.fromQuat(e,this.orientation);let t=[!1,!1,!1];for(let n=0;n<3;++n){let i=0,r=0;for(let o=0;o<3;++o){let s=e[3*n+o];e[3*n+o]=0,t[o]||Math.abs(s)>Math.abs(i)&&(i=s,r=o)}e[3*n+r]=f()(i),t[r]=!0}x.Yu.fromMat3(this.orientation,e),this.changed.dispatch()}static makeRelative(e,t){let n=new F(x.Yu.multiply(x.Yu.create(),e.orientation,t)),i=!1;n.registerDisposer(e.changed.add((()=>{i||(r=!0,x.Yu.multiply(n.orientation,e.orientation,t),n.changed.dispatch(),r=!1)})));let r=!1;const o=x.Yu.invert(x.Yu.create(),t);return n.registerDisposer(n.changed.add((()=>{r||(i=!0,x.Yu.multiply(e.orientation,n.orientation,o),e.changed.dispatch(),i=!1)}))),n}assign(e){x.Yu.copy(this.orientation,e.orientation),this.changed.dispatch()}}class U extends _{constructor(){super(...arguments),this.value=R(new F,this.peer,this.link,{assign:(e,t)=>e.assign(t),isValid:()=>!0,difference:(e,t)=>{const n=x.Yu.create();return x.Yu.multiply(n,x.Yu.invert(n,t.orientation),e.orientation)},add:(e,t,n)=>{x.Yu.multiply(e.orientation,t.orientation,n),e.changed.dispatch()},subtract:(e,t,n)=>{x.Yu.multiply(e.orientation,t.orientation,x.Yu.invert(I,n)),e.changed.dispatch()}})}}class z extends w.O8{constructor(e){super(),this.coordinateSpace=e,this.changed=new k.IY,this.curCoordinateSpace=b.Nj,this.value_={factors:new Float64Array(0)},this.registerDisposer(e.changed.add((()=>this.update()))),this.update()}get value(){return this.update()}reset(){this.value_={factors:new Float64Array(0)},this.curCoordinateSpace=b.Nj,this.changed.dispatch()}toJSON(){const e={};let t=!1;const n=this.value.factors;var i=this.curCoordinateSpace;const r=i.names,o=i.rank;for(let s=0;s<o;++s){const i=n[s];1!==i&&(e[r[s]]=i,t=!0)}if(t)return e}restoreState(e){const t=this.coordinateSpace.value,n=t.names,i=t.rank,r=new Float64Array(i);if(r.fill(-1),void 0!==e){const t=(0,C.verifyObject)(e);for(let e=0;e<i;++e)r[e]=(0,C.verifyObjectProperty)(t,n[e],(e=>void 0===e?1:(0,C.verifyFinitePositiveFloat)(e)))}this.value_={factors:r},this.curCoordinateSpace=t,this.changed.dispatch()}setFactors(e){const t=this.coordinateSpace.value;e.length===t.rank&&(this.value_={factors:e},this.curCoordinateSpace=t,this.changed.dispatch())}update(){const e=this.coordinateSpace.value;let t=this.value_;const n=this.curCoordinateSpace;if(n===e)return t;const i=n.ids,r=e.ids,o=e.rank,s=t.factors,a=new Float64Array(o);a.fill(1);for(let l=0;l<o;++l){const e=r[l],t=i.indexOf(e);-1!==t&&(a[l]=s[t])}return(0,S.r1)(a,s)||(t=this.value_={factors:a},this.curCoordinateSpace=e,this.changed.dispatch()),t}assign(e){this.setFactors(e.value.factors)}}function j(e,t,n,i,r){if(n===i)return t;const o=n.ids,s=i.rank,a=i.ids,l=new e(s);for(let c=0;c<s;++c){const e=a[c],n=o.indexOf(e);l[c]=-1===n?r(c):t[n]}return l}class G extends _{constructor(){super(...arguments),this.value=R(new z(this.peer.coordinateSpace),this.peer,this.link,{assign:(e,t)=>e.assign(t),difference:(e,t)=>{const n=e.value.factors,i=e.coordinateSpace.value,r=t.value.factors;return{coordinateSpace:i,offsets:L.Re(new Float64Array(n.length),n,r)}},add:(e,t,n)=>{const i=j(Float64Array,n.offsets,n.coordinateSpace,e.coordinateSpace.value,(()=>0));e.setFactors(L.WQ(new Float64Array(i.length),i,t.value.factors))},subtract:(e,t,n)=>{const i=j(Float64Array,n.offsets,n.coordinateSpace,e.coordinateSpace.value,(()=>0));e.setFactors(L.Re(new Float64Array(i.length),t.value.factors,i))},isValid:()=>!0})}}function W(e,t,n){const i=e.rank,r=e.names,o=e.units,s=t.displayRank,a=t.displayDimensionIndices,l=new Float64Array(3);let c,d=new Float64Array(3);const u=n.factors,h=new Array(3),p=new Float64Array(3);if(l.fill(1),d.fill(1),p.fill(1),h.fill(""),0===s)c=1;else{c=Number.POSITIVE_INFINITY;const t=e.scales;for(let e=0;e<s;++e){const n=a[e],i=d[e]=u[n]*t[n];c=Math.min(c,i),h[e]=o[n],p[e]=t[n]}for(let e=0;e<s;++e)l[e]=d[e]/c}return{globalRank:i,globalDimensionNames:r,displayRank:s,displayDimensionIndices:a,displayDimensionUnits:h,displayDimensionScales:p,canonicalVoxelFactors:l,voxelPhysicalScales:d,canonicalVoxelPhysicalSize:c}}class H extends w.O8{constructor(e,t){super(),this.relativeDisplayScales=e,this.displayDimensions=t,this.changed=new k.IY,this.curRelativeDisplayScales=this.relativeDisplayScales.value,this.curDisplayDimensions=this.displayDimensions.value,this.curCoordinateSpace=this.relativeDisplayScales.coordinateSpace.value,this.value_=W(this.curCoordinateSpace,this.curDisplayDimensions,this.curRelativeDisplayScales),this.registerDisposer(e),this.registerDisposer(t);const n=()=>{this.value};this.registerDisposer(e.changed.add(n)),this.registerDisposer(t.changed.add(n))}get value(){var e=this.relativeDisplayScales;const t=e.value,n=e.coordinateSpace.value,i=this.displayDimensions.value,r=this.curRelativeDisplayScales,o=this.curDisplayDimensions,s=this.curCoordinateSpace;let a=this.value_;if(r!==t||o!==i||s!==n){this.curRelativeDisplayScales=t,this.curDisplayDimensions=i,this.curCoordinateSpace=n;const e=W(n,i,t);l=a,c=e,(0,S.r1)(l.globalDimensionNames,c.globalDimensionNames)&&(0,S.r1)(l.displayDimensionIndices,c.displayDimensionIndices)&&(0,S.r1)(l.canonicalVoxelFactors,c.canonicalVoxelFactors)&&(0,S.r1)(l.voxelPhysicalScales,c.voxelPhysicalScales)&&l.canonicalVoxelPhysicalSize===c.canonicalVoxelPhysicalSize&&(0,S.r1)(l.displayDimensionUnits,c.displayDimensionUnits)&&(0,S.r1)(l.displayDimensionScales,c.displayDimensionScales)||(this.value_=a=e,this.changed.dispatch())}var l,c;return a}}class q extends w.O8{constructor(e){super(),this.coordinateSpace=e,this.changed=new k.IY,this.default_=!0,this.value_=void 0,this.registerDisposer(this.coordinateSpace.changed.add(this.changed.dispatch)),this.update()}get value(){return this.update(),this.value_}update(){const e=this.coordinateSpace.value,t=this.value_;if(void 0!==t&&t.coordinateSpace===e)return;if(void 0===t||this.default_)return void this.setToDefault(e);const n=new Int32Array(3),i=t.coordinateSpace.ids,r=e.ids,o=t.displayDimensionIndices,s=t.displayRank;let a=0;for(let l=0;l<s;++l){const e=r.indexOf(i[o[l]]);-1!==e&&(n[a]=e,++a)}if(n.fill(-1,a),0===a)return this.default_=!0,void this.setToDefault(e);this.assignValue(e,a,n),this.changed.dispatch()}setToDefault(e){const t=Math.min(e.rank,3),n=new Int32Array(3);n.fill(-1);for(let i=0;i<t;++i)n[i]=i;this.assignValue(e,t,n)}assignValue(e,t,n){this.value_={coordinateSpace:e,displayRank:t,displayDimensionIndices:n},this.changed.dispatch()}reset(){this.default_=!0,this.value_=void 0,this.changed.dispatch()}restoreState(e){if(void 0===e)return void this.reset();const t=(0,b.tJ)(e);if(t.length>3)throw new Error("Number of spatial dimensions must be <= 3");const n=this.coordinateSpace.value,i=new Int32Array(3);i.fill(-1);const r=n.names;let o=0;for(const s of t){const e=r.indexOf(s);-1!==e&&(i[o++]=e)}0!==o?(this.default_=!1,this.assignValue(n,o,i)):this.reset()}get default(){return this.update(),this.default_}set default(e){this.default_!==e&&(e?(this.default_=!0,this.setToDefault(this.coordinateSpace.value)):(this.default_=!1,this.changed.dispatch()))}setDimensionIndices(e,t){this.default_=!1,this.assignValue(this.coordinateSpace.value,e,t)}toJSON(){if(this.default_)return;const e=this.value,t=[],n=e.displayRank,i=e.displayDimensionIndices,r=e.coordinateSpace.names;if(0!==n){for(let e=0;e<n;++e)t[e]=r[i[e]];return t}}assign(e){if(e.default)this.default=!0;else{var t=e.value;const n=t.displayRank,i=t.displayDimensionIndices;this.setDimensionIndices(n,i)}}}class Y extends V{constructor(e){super(e),this.value=A(new q(this.peer.coordinateSpace),this.peer,this.link,{assign:(e,t)=>e.assign(t),isValid:()=>!0})}}class J extends w.O8{constructor(e,t,n){super(),this.position=e,this.displayDimensionRenderInfo=t,this.orientation=n,this.changed=new k.IY,this.registerDisposer(e),this.registerDisposer(n),this.registerDisposer(t),this.registerDisposer(e.changed.add(this.changed.dispatch)),this.registerDisposer(n.changed.add(this.changed.dispatch)),this.registerDisposer(t.changed.add(this.changed.dispatch))}get displayDimensions(){return this.displayDimensionRenderInfo.displayDimensions}get relativeDisplayScales(){return this.displayDimensionRenderInfo.relativeDisplayScales}get valid(){return this.position.valid}reset(){this.position.reset(),this.orientation.reset(),this.displayDimensions.reset()}updateDisplayPosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M;var n=this.position;const i=n.coordinateSpace.value,r=n.value;var o=this.displayDimensions.value;const s=o.displayDimensionIndices,a=o.displayRank;if(void 0===i)return!1;t.fill(0);for(let l=0;l<a;++l){const e=s[l];t[l]=r[e]}if(!1!==e(t)){for(let e=0;e<a;++e){r[s[e]]=t[e]}return this.position.changed.dispatch(),!0}return!1}toMat4(e,t){x.pB.fromQuat(e,this.orientation.orientation);const n=this.position.value;var i=this.displayDimensionRenderInfo.value;const r=i.canonicalVoxelFactors,o=i.displayDimensionIndices;for(let s=0;s<3;++s){const i=o[s],a=t/r[s];e[s]*=a,e[4+s]*=a,e[8+s]*=a,e[12+s]=n[i]||0}}toMat3(e,t){x.w0.fromQuat(e,this.orientation.orientation);var n=this.displayDimensionRenderInfo.value;const i=n.canonicalVoxelFactors,r=n.displayRank;for(let o=0;o<r;++o){const n=t/i[o];e[o]*=n,e[3+o]*=n,e[6+o]*=n}}snap(){this.orientation.snap(),this.position.snapToVoxel(),this.changed.dispatch()}translateDimensionRelative(e,t){if(!this.valid)return;const n=this.position,i=n.value;var r=n.coordinateSpace.value.bounds;const o=r.lowerBounds,s=r.upperBounds;let a=i[e]+t;if(t>0){const t=s[e];h()(t)&&(a=Math.min(a,Math.ceil(t-1)))}else{const t=o[e];h()(t)&&(a=Math.max(a,Math.floor(t)))}i[e]=a,n.changed.dispatch()}translateVoxelsRelative(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.valid)return;const n=x.eR.transformQuat(M,e,this.orientation.orientation),i=this.position,r=i.value;var o=this.displayDimensions.value;const s=o.displayDimensionIndices,a=o.displayRank;var l=i.coordinateSpace.value.bounds;const c=l.lowerBounds,d=l.upperBounds;for(let u=0;u<a;++u){const e=s[u],i=n[u];if(0===i)continue;let o=r[e]+i;if(i>0){const t=d[e];h()(t)&&(o=Math.min(o,Math.ceil(t-1)))}else{const t=c[e];h()(t)&&(o=Math.max(o,Math.floor(t)))}t&&(o=Math.floor(o)+.5),r[e]=o}this.position.changed.dispatch()}rotateRelative(e,t){var n=x.Yu.create();x.Yu.setAxisAngle(n,e,t);var i=this.orientation.orientation;x.Yu.multiply(i,i,n),this.orientation.changed.dispatch()}rotateAbsolute(e,t,n){var i=this.position;const r=i.coordinateSpace.value,o=i.value;if(void 0===r)return;const s=this.relativeDisplayScales.value.factors;var a=this.displayDimensions.value;const l=a.displayDimensionIndices,c=a.displayRank,d=r.scales,u=x.Yu.create();x.Yu.setAxisAngle(u,e,t);const h=this.orientation.orientation,p=M;M.fill(0);for(let g=0;g<c;++g){const e=l[g],t=n[e]-o[e];p[g]=t*d[e]*s[e]}const f=x.Yu.invert(I,h);x.eR.transformQuat(p,p,f),x.Yu.multiply(h,u,h),x.eR.transformQuat(p,p,h);for(let g=0;g<c;++g){const e=l[g];o[e]=n[e]-p[g]/(d[e]*s[e])}this.position.changed.dispatch(),this.orientation.changed.dispatch()}translateNonDisplayDimension(e,t){if(!this.valid)return;const n=this.displayDimensions.value.displayDimensionIndices,i=this.position.coordinateSpace.value.rank;for(let r=0;r<i;++r)if(-1===n.indexOf(r)&&0===e--)return void this.translateDimensionRelative(r,t)}}class K extends _{constructor(e,t){super(e),this.value=(()=>{const n=new e.constructor(t);return R(n,this.peer,this.link,{assign:(e,t)=>{e.assign(t)},isValid:e=>e.coordinateSpaceValue.valid&&0!==e.canonicalVoxelPhysicalSize,difference:(e,t)=>e.value/t.value*(e.canonicalVoxelPhysicalSize/t.canonicalVoxelPhysicalSize),add:(e,t,n)=>{e.setPhysicalScale(t.value*n,t.canonicalVoxelPhysicalSize)},subtract:(e,t,n)=>{e.setPhysicalScale(t.value/n,t.canonicalVoxelPhysicalSize)}}),n})()}}function X(e){return{changed:e.changed,toJSON:()=>e.toJSON(),restoreState(t){N(e.link,e.value.legacyJsonView,t)},reset(){e.reset()}}}class Z extends w.O8{constructor(e){super(),this.displayDimensionRenderInfo=e,this.changed=new k.IY,this.curCanonicalVoxelPhysicalSize=0,this.value_=Number.NaN,this.legacyValue_=Number.NaN,this.registerDisposer(e),this.registerDisposer(e.changed.add((()=>this.handleCoordinateSpaceChanged()))),this.registerDisposer(e.relativeDisplayScales.coordinateSpace.changed.add((()=>this.handleCoordinateSpaceChanged()))),this.handleCoordinateSpaceChanged()}get value(){return this.handleCoordinateSpaceChanged(),this.value_}set value(e){const t=this.canonicalVoxelPhysicalSize;d()(e,this.value_)&&t===this.curCanonicalVoxelPhysicalSize||(this.curCanonicalVoxelPhysicalSize=t,this.legacyValue_=Number.NaN,this.value_=e,this.changed.dispatch())}get canonicalVoxelPhysicalSize(){return this.displayDimensionRenderInfo.value.canonicalVoxelPhysicalSize}get coordinateSpaceValue(){return this.displayDimensionRenderInfo.relativeDisplayScales.coordinateSpace.value}set legacyValue(e){d()(e,this.legacyValue_)||(this.value_=Number.NaN,this.legacyValue_=e,this.curCanonicalVoxelPhysicalSize=0,this.changed.dispatch())}get legacyValue(){return this.legacyValue_}handleCoordinateSpaceChanged(){const e=this.value_;var t=this.displayDimensionRenderInfo;const n=t.value.canonicalVoxelPhysicalSize,i=t.relativeDisplayScales.coordinateSpace.value,r=this.curCanonicalVoxelPhysicalSize;(l()(e)||n!==r)&&(l()(e)?i.valid&&0!==n&&(this.curCanonicalVoxelPhysicalSize=n,this.value_=this.getDefaultValue(),this.changed.dispatch()):0!==r&&(this.value_=e*(r/n),this.curCanonicalVoxelPhysicalSize=n,this.changed.dispatch()))}toJSON(){const e=this.value;return l()(e)?void 0:e}restoreState(e){this.curCanonicalVoxelPhysicalSize=0,this.legacyValue_=Number.NaN,this.value_=void 0===e?Number.NaN:(0,C.verifyFinitePositiveFloat)(e),this.changed.dispatch()}reset(){this.curCanonicalVoxelPhysicalSize=0,this.value_=Number.NaN,this.legacyValue_=Number.NaN,this.changed.dispatch()}get legacyJsonView(){const e=this;return{changed:e.changed,toJSON:()=>e.toJSON(),reset:()=>e.reset(),restoreState(t){e.legacyValue=(0,C.verifyFinitePositiveFloat)(t)}}}setPhysicalScale(e,t){const n=this.curCanonicalVoxelPhysicalSize=this.canonicalVoxelPhysicalSize;this.value=e*(t/n)}assign(e){const t=e.legacyValue;l()(t)?this.setPhysicalScale(e.value,e.canonicalVoxelPhysicalSize):this.legacyValue=t}}class Q extends Z{getDefaultValue(){const e=this.legacyValue_;if(l()(e))return 1;const t=this.canonicalVoxelPhysicalSize;return 1e-9*this.legacyValue_/t}}class $ extends Z{getDefaultValue(){const e=this.legacyValue_;if(!l()(e)){this.legacyValue_=Number.NaN;const t=this.canonicalVoxelPhysicalSize;return 200*Math.tan(Math.PI/8)*1e-9*e/t}var t=this.coordinateSpaceValue.bounds;const n=t.lowerBounds,i=t.upperBounds;var r=this.displayDimensionRenderInfo.value;const o=r.canonicalVoxelFactors,a=r.displayDimensionIndices;let c=o.reduce(((e,t,r)=>{const o=a[r],s=(i[o]-n[o])*t;return Math.max(e,s)}),0);return c=h()(c)?2**Math.ceil(s()(c)):1024,c}}class ee extends w.O8{constructor(e,t){super(),this.defaultValue=e,this.displayDimensionRenderInfo=t,this.changed=new k.IY,this.value_=e,this.canonicalVoxelPhysicalSize=t.value.canonicalVoxelPhysicalSize,this.registerDisposer(t.changed.add((()=>{this.value})))}get value(){let e=this.value_;if(e>0){const t=this.displayDimensionRenderInfo.value.canonicalVoxelPhysicalSize,n=this.canonicalVoxelPhysicalSize;t!==n&&(this.canonicalVoxelPhysicalSize=t,e=this.value_=e=n/t,this.changed.dispatch())}return e}set value(e){if(e===this.value)return;this.value_=e;const t=this.displayDimensionRenderInfo.value.canonicalVoxelPhysicalSize;this.canonicalVoxelPhysicalSize=t,this.changed.dispatch()}toJSON(){const e=this.value;if(e!==this.defaultValue)return e}reset(){this.value=this.defaultValue}restoreState(e){"number"===typeof e&&h()(e)&&0!==e?this.value=e:this.value=this.defaultValue}setValueAbsolute(e,t){if(e>0){e*=t/this.displayDimensionRenderInfo.value.canonicalVoxelPhysicalSize}this.value=e}assign(e){this.setValueAbsolute(e.value,e.canonicalVoxelPhysicalSize)}}class te extends V{constructor(e,t){super(e),this.value=A(new ee(e.defaultValue,t),this.peer,this.link,{assign:(e,t)=>e.assign(t),isValid:()=>!0})}}class ne extends w.O8{constructor(e,t,n){super(),this.pose=e,this.zoomFactor=t,this.depthRange=n,this.changed=new k.IY,this.registerDisposer(e),this.registerDisposer(t),this.registerDisposer(n),this.registerDisposer(this.pose.changed.add(this.changed.dispatch)),this.registerDisposer(this.zoomFactor.changed.add(this.changed.dispatch)),this.registerDisposer(this.depthRange.changed.add(this.changed.dispatch))}get coordinateSpace(){return this.pose.position.coordinateSpace}reset(){this.pose.reset(),this.zoomFactor.reset()}get position(){return this.pose.position}get displayDimensions(){return this.pose.displayDimensions}get relativeDisplayScales(){return this.pose.relativeDisplayScales}get displayDimensionRenderInfo(){return this.pose.displayDimensionRenderInfo}toMat4(e){this.pose.toMat4(e,this.zoomFactor.value)}toMat3(e){this.pose.toMat3(e,this.zoomFactor.value)}get relativeDepthRange(){let e=this.depthRange.value;return e>0?e/=this.zoomFactor.value:e*=-1,e}get valid(){return this.pose.valid&&!l()(this.zoomFactor.value)}zoomBy(e){this.zoomFactor.value*=e}}},7445:(e,t,n)=>{n.d(t,{_w:()=>s,hJ:()=>l});var i=n(6740),r=n(7562),o=n(1058);let s=0;const a=o.n5.fromObject({escape:{action:"close"}});class l extends r.O8{constructor(){super(),this.keyMap=new o.n5,this.keyMap.addParent(a,Number.NEGATIVE_INFINITY),++s;let e=this.container=document.createElement("div");e.className="overlay";let t=this.content=document.createElement("div");this.registerDisposer(new i.j(t)),t.className="overlay-content",e.appendChild(t),document.body.appendChild(e),this.registerDisposer(new o.cL(this.container,this.keyMap)),this.registerEventListener(e,"action:close",(()=>{this.dispose()})),t.focus()}disposed(){--s,document.body.removeChild(this.container),super.disposed()}}},6560:(e,t,n)=>{n.d(t,{r:()=>r});var i=n(3056);class r extends i.aR{draw(e,t){}isReady(e,t){return!0}get transparentPickEnabled(){return!0}}},5603:(e,t,n)=>{n.d(t,{_G:()=>l,kJ:()=>a,wO:()=>c});var i=n(1434),r=n(9735),o=n(3835),s=n(9799);class a extends i.Rr{constructor(){super(...arguments),this.globalPosition=s.qE,this.projectionMat=o.pB.create(),this.viewMatrix=o.pB.create(),this.invViewMatrix=o.pB.create(),this.viewProjectionMat=o.pB.create(),this.invViewProjectionMat=o.pB.create()}}function l(e,t){return e.displayDimensionRenderInfo===t.displayDimensionRenderInfo&&(0,i.uQ)(e,t)&&(0,r.r1)(e.globalPosition,t.globalPosition)&&(0,r.r1)(e.projectionMat,t.projectionMat)&&(0,r.r1)(e.viewMatrix,t.viewMatrix)}function c(e){const t=e.viewMatrix,n=e.viewProjectionMat;o.pB.invert(t,e.invViewMatrix),o.pB.multiply(n,e.projectionMat,t),o.pB.invert(e.invViewProjectionMat,n)}},3985:(e,t,n)=>{n.d(t,{IB:()=>y,IH:()=>S,Mk:()=>x,SZ:()=>w,Sg:()=>p,Z2:()=>m,iz:()=>v,pe:()=>b,vt:()=>C});var i=n(974),r=n.n(i),o=n(2395),s=n.n(o),a=n(8332),l=n(7160),c=n(9735),d=n(3835),u=n(2729),h=n(9799);a._c,new Uint32Array(0),new Uint32Array(0);function p(e){const t=e.rank;var n=e.bounds;const i=n.lowerBounds,r=n.upperBounds;if(i.some((e=>0!==e)))throw new Error("Lower bounds of channel coordinate space must all be 0");if(r.some((e=>!s()(e)||e<=0||e>=2**32)))throw new Error("Upper bounds of channel coordinate space must all be positive integers");const o=new Uint32Array(r),a=(0,h._e)(o),l=new Uint32Array(a*t);for(let s=0;s<a;++s){let e=s;for(let n=0;n<t;++n){const i=e%o[n];e=(e-i)/o[n],l[s*t+n]=i}}return{channelCoordinateSpace:e,shape:o,numChannels:a,coordinates:l}}function f(e,t,n,i,r,o){const s=n.scales,a=r.scales,l=r.rank,c=t+1;for(let d=0;d<l;++d){const n=o[d];if(-1===n)continue;const r=a[d];for(let o=0;o<t;++o){const t=s[i[o]];e[c*o+n]*=t/r}}}function g(e,t){return e===t||void 0===e.error&&void 0===t.error&&((0,c.r1)(e.modelDimensionNames,t.modelDimensionNames)&&(0,c.r1)(e.layerDimensionNames,t.layerDimensionNames)&&(0,c.r1)(e.globalToRenderLayerDimensions,t.globalToRenderLayerDimensions)&&(0,c.r1)(e.localToRenderLayerDimensions,t.localToRenderLayerDimensions)&&(0,c.r1)(e.channelToRenderLayerDimensions,t.channelToRenderLayerDimensions)&&(0,c.r1)(e.modelToRenderLayerTransform,t.modelToRenderLayerTransform)&&(0,c.r1)(e.channelSpaceShape,t.channelSpaceShape))}function m(e,t,n,i,o){return(0,l.Uq)(((e,t,n,o)=>function(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a._c;const l=n.inputSpace,c=n.rank,h=n.sourceRank,p=n.outputSpace,g=n.transform,m=l.names,v=p.names;let y;if(void 0!==i)y=r()(i.modelSubspaceDimensionIndices);else{y=[];for(let e=0;e<h;++e)y[e]=e}const b=y.length;for(let r=h;r<c;++r)y.push(r);const S=(0,d.PC)(n.transform,c,y,!0),w=y.length,x=y.map((e=>m[e]||"".concat(e))),C=S.map((e=>v[e]));if(w!==S.length)return{error:"Rank mismatch between model subspace dimensions ("+x.join(", ")+") and corresponding layer/global dimensions ("+C.join(", ")+")"};let k=(0,a.$d)(Float32Array,g,c,S,y);const E=S.map((e=>v[e])),T=t.names.map((e=>E.indexOf(e))),L=e.names.map((e=>E.indexOf(e)));f(k,w,l,y,e,L),f(k,w,l,y,t,T);const P=o.names.map((e=>E.indexOf(e)));f(k,w,l,y,o,P);const D=[],M=o.rank;if(void 0!==i){let e=i.subsourceToModelSubspaceTransform;b!==w&&(e=u.Aw(new Float32Array((w+1)**2),w,e,b)),k=u.lw(new Float32Array((w+1)**2),w+1,k,w+1,e,w+1,w+1,w+1,w+1)}const I=new Uint32Array(M);for(let r=0;r<M;++r){const e=o.bounds.lowerBounds[r],t=o.bounds.upperBounds[r];if(0!==e||!s()(t)||t<=0||t>=2**32)return{error:"Channel dimension ".concat(o.names[r]," must have ")+"lower bound of 0 and positive integer upper bound"};I[r]=t;const n=P[r];let i=-1;if(-1!==n)for(let r=0;r<w;++r){const e=k[n+r*(w+1)];if(0!==e){if(1!==e||-1!==i)return{error:"Channel dimension ".concat(C[n]," ")+"must map to a single source dimension"};i=r}}D[r]=i}return{rank:w,unpaddedRank:b,modelDimensionNames:x,layerDimensionNames:C,localToRenderLayerDimensions:T,globalToRenderLayerDimensions:L,channelToRenderLayerDimensions:P,modelToRenderLayerTransform:k,channelToModelDimensions:D,channelSpaceShape:I}}(e,t,n,i,o)),[e,t,n,void 0===o?(0,l.XZ)(void 0):o],g)}function v(e,t,n,i){const r=n.globalToRenderLayerDimensions;for(let o=0;o<3;++o){let n=0;const s=i[o];if(-1!==s){const e=r[s];-1!==e&&(n=t[e])}e[o]=n}}function y(e,t,n,i){const r=n.globalToRenderLayerDimensions;for(let o=0;o<3;++o){const n=i[o];if(-1!==n){const i=r[n];-1!==i&&(e[i]=t[o])}}}function b(e,t){const n=e.rank,i=e.unpaddedRank;let r;i!==n&&void 0!==t&&(t=u.Aw(new Float32Array((n+1)**2),n,t,i)),void 0!==t?(r=new Float32Array((n+1)*(n+1)),u.lw(r,n+1,e.modelToRenderLayerTransform,n+1,t,n+1,n+1,n+1,n+1)):r=e.modelToRenderLayerTransform;const o=new Float32Array((n+1)*(n+1)),s=u.DI(o,n+1,r,n+1,n+1);if(0===s)throw new Error("Transform is singular");const a=e.globalToRenderLayerDimensions,l=e.localToRenderLayerDimensions,c=e.channelToRenderLayerDimensions,d=a.length,p=l.length,f=d+p,g=new Float32Array((f+1)*n);for(let u=0;u<n;++u){for(let e=0;e<d;++e){const t=a[e];-1!==t&&(g[u+e*n]=o[u+t*(n+1)])}for(let e=0;e<p;++e){const t=l[e];-1!==t&&(g[u+(d+e)*n]=o[u+t*(n+1)])}g[u+f*n]=o[u+n*(n+1)]}const m=c.length;let v=new Array(m);const y=[];for(let u=0;u<m;++u){const t=c[u];let i=-1;if(-1!==t){for(let o=0;o<n;++o){const s=r[t+o*(n+1)];if(0!==s){if(1!==s||-1!==i)throw new Error("Channel dimension ".concat(e.layerDimensionNames[t]," ")+"must map with stride 1 to a single data chunk dimensions");i=o}}if(-1!==i){if(0!==r[t+n*(n+1)])throw new Error("Channel dimension ".concat(e.layerDimensionNames[t]," ")+"must have an offset of 0 in the chunk coordinate space");y.push(i)}}v[u]=i}const b=e.channelSpaceShape,S=h._e(b),w=y.length,x=new Uint32Array(S*w);for(let u=0;u<S;++u){let e=u,t=0;for(let n=0;n<m;++n){const i=e%b[n];e=(e-i)/b[n];-1!==v[n]&&(x[u*w+t]=i,++t)}}return{layerRank:n,modelTransform:e,chunkToLayerTransform:r,layerToChunkTransform:o,chunkToLayerTransformDet:s,combinedGlobalLocalRank:f,combinedGlobalLocalToChunkTransform:g,channelToChunkDimensionIndices:v,chunkChannelDimensionIndices:y,numChannels:S,chunkChannelCoordinates:x,channelSpaceShape:b}}function S(e,t){const n=e.globalToRenderLayerDimensions,i=[],r=[];for(let o=0;o<3;++o){const e=t[o];if(-1==e)continue;const s=n[e];r.push(s),-1!==s&&i.push(s)}for(let o=r.length;o<3;++o)r[o]=-1;return{layerDisplayDimensionIndices:i,displayToLayerDimensionIndices:r}}function w(e,t){const n=e.chunkToLayerTransform,i=e.modelTransform,o=i.rank,s=t.layerDisplayDimensionIndices,a=t.displayToLayerDimensionIndices,l=s.length,c=(0,d.PC)(n,o,s);if(c.length!==l){const e=i.modelDimensionNames,t=i.layerDimensionNames;throw new Error("Rank mismatch between displayed layer dimensions "+"(".concat(r()(s,(e=>t[e])).join(",\xa0"),") ")+"and corresponding chunk dimensions "+"(".concat(r()(c,(t=>e[t])).join(",\xa0"),")"))}const u=d.pB.create();for(let r=0;r<3;++r){const e=a[r];if(-1!==e){for(let t=0;t<l;++t){const i=c[t];u[4*t+r]=n[i*(o+1)+e]}u[12+r]=n[o*(o+1)+e]}}const h=d.pB.create();d.pB.invert(h,u);for(let r=c.length;r<3;++r)c[r]=-1;return{modelTransform:e.modelTransform,chunkTransform:e,displaySubspaceModelMatrix:u,displaySubspaceInvModelMatrix:h,chunkDisplayDimensionIndices:c,numChunkDisplayDims:l}}function x(e,t,n,i,r){const o=t.length,s=n.length,a=e.length;let l=!0;for(let c=0;c<i;++c){let d=c,u=0;for(let e=0;e<o;++e)u+=r[d+e*i]*t[e];d+=o*i;for(let e=0;e<s;++e)u+=r[d+e*i]*n[e];u+=r[d+s*i],c<a?e[c]=u:(u<0||u>=1)&&(l=!1)}return l}function C(e,t,n){e.fill(0),e[15]=1;let i=!0;const o=t.displayDimensionIndices,s=n.globalToRenderLayerDimensions,a=n.modelToRenderLayerTransform,l=n.rank;for(let r=0;r<3;++r){const t=o[r];if(-1===t){i=!1;continue}const n=s[t];if(-1!==n){e[r+12]=a[n+l*(l+1)];for(let t=0;t<3;++t)e[r+4*t]=a[n+(l+1)*t]}else i=!1}if(!i){const e=t.globalDimensionNames,i=r()(o.filter((e=>-1!==e)),(t=>e[t])).join(",\xa0");throw new Error("Transform from model dimensions (".concat(n.modelDimensionNames.join(",\xa0"),") ")+"to display dimensions (".concat(i,") does not have full rank"))}}},3295:(e,t,n)=>{n.d(t,{Bh:()=>o,kg:()=>s,lG:()=>r,sC:()=>i});const i="rendered_view.addLayer",r="rendered_view.removeLayer",o="SharedProjectionParameters",s="SharedProjectionParameters.changed"},3436:(e,t,n)=>{n.d(t,{Jo:()=>u,Uz:()=>g,fm:()=>m,iC:()=>f,zD:()=>v});var i=n(608),r=n.n(i),o=n(4117),s=n.n(o),a=n(7160),l=n(7970),c=n(843),d=n(6344);const u=40,h=.5,p=-4;function f(e){return(s()(e)-p)/h}function g(e){return 2**(e*h+p)}function m(e){return new a.DN(e,l.verifyFinitePositiveFloat)}class v{constructor(){this.visibility=new c.S2,this.changed=new d.IY,this.frameNumber=-1,this.spatialScales=new(r()),this.numHistogramRows=1,this.value=new Uint32Array(u*this.numHistogramRows*2)}begin(e){e!==this.frameNumber&&(this.value.fill(0),this.frameNumber=e,this.spatialScales.clear(),this.changed.dispatch())}add(e,t,n,i){let r=this.spatialScales,o=this.numHistogramRows,s=this.value,a=r.get(e);if(void 0===a&&(a=r.size,r.set(e,a)),a>=o){this.numHistogramRows=o*=2;const e=new Uint32Array(o*u*2);e.set(s),this.value=s=e}const l=a*u*2+Math.min(Math.max(0,Math.round(f(t))),u-1);s[l]+=n,s[l+u]+=i}}},3056:(e,t,n)=>{n.d(t,{$x:()=>I,aR:()=>M,cs:()=>P,er:()=>D,gY:()=>i,jL:()=>A,tT:()=>R});var i,r=n(3651),o=n.n(r),s=n(4148),a=n.n(s),l=n(6063),c=n.n(l),d=n(5677),u=n.n(d),h=n(5491),p=n.n(h),f=n(6094),g=n(1434),m=n(5603),v=n(3985),y=n(3295),b=n(7160),S=n(7562),w=n(3835),x=n(8164),C=n(6344),k=n(843),E=n(7799),T=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=u()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&c()(t,n,s),s},L=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof a()){var r=0;for(i=a()(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};function P(){return new b._Y([i.DATA,i.ANNOTATION,i.DEFAULT_ANNOTATION])}!function(e){e[e.DATA=0]="DATA",e[e.ANNOTATION=1]="ANNOTATION",e[e.DEFAULT_ANNOTATION=2]="DEFAULT_ANNOTATION"}(i||(i={}));class D extends S.O8{constructor(){super(...arguments),this.role=i.DATA,this.messages=new x.Mf,this.layerChanged=new C.IY,this.redrawNeeded=new C.IY,this.layerChunkProgressInfo=new f.IL}handleAction(e){}getValueAt(e){}transformPickedValue(e){return e.pickedValue}updateMouseState(e,t,n,i){}}class M extends D{constructor(){super(...arguments),this.visibility=new k.S2}attach(e){}}function I(e,t,n){let i=n.state;if(void 0===i||i.transform!==e||i.displayDimensionRenderInfo!==t){if(n.messages.clearMessages(),i=n.state={transform:e,displayDimensionRenderInfo:t,modelTransform:void 0},void 0!==e.error)return void n.messages.addMessage({severity:x.TU.error,message:e.error});try{const n=w.pB.create();(0,v.vt)(n,t,e),i.modelTransform=n}catch(r){n.messages.addMessage({severity:x.TU.error,message:r.message})}}return i.modelTransform}class R extends S.O8{constructor(e){super(),this.renderViewport=new g.Rr,this.changed=new C.HN;var t=e.parametersConstructor;const n=void 0===t?m.kJ:t,i=e.navigationState,r=e.update;var s=e.isEqual;const a=void 0===s?m._G:s;this.oldValue_=new n,this.value_=new n;const l=()=>{const e=this.oldValue_,t=this.value_;e.displayDimensionRenderInfo=i.displayDimensionRenderInfo.value,o()(e,this.renderViewport);let n=e.globalPosition;const s=i.position.value,l=s.length;n.length!==l&&(e.globalPosition=n=new Float32Array(l)),n.set(s),r(e,i),a(e,t)||(this.value_=e,this.oldValue_=t,this.changed.dispatch(t,e))},c=this.update=this.registerCancellable(p()(l,0));this.registerDisposer(i.changed.add(c)),l()}setViewport(e){(0,g.uQ)(e,this.renderViewport)||(o()(this.renderViewport,e),this.update())}get value(){return this.update.flush(),this.value_}}let A=class extends E.T6{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;super(),this.base=t,this.updateInterval=n,this.prevDisplayDimensionRenderInfo=void 0,this.update=this.registerCancellable(p()(((e,t)=>{let n;if(t.displayDimensionRenderInfo!==this.prevDisplayDimensionRenderInfo)n=t,this.prevDisplayDimensionRenderInfo=t.displayDimensionRenderInfo;else{t.displayDimensionRenderInfo;n=L(t,["displayDimensionRenderInfo"])}this.rpc.invoke(y.kg,{id:this.rpcId,value:n})}),this.updateInterval)),this.initializeCounterpart(e,{value:t.value}),this.registerDisposer(t.changed.add(this.update))}flush(){this.update.flush()}};A=T([(0,E.R6)(y.Bh)],A)},7376:(e,t,n)=>{n.d(t,{LB:()=>u,YL:()=>p,ji:()=>c,lo:()=>h});var i=n(648),r=n(968),o=n(8491),s=n(6344),a=n(6098),l=n(4035);class c{constructor(e){this.prefix=e,this.seedName=this.prefix+"_seed"}defineShader(e){const t=this.seedName;e.addUniform("highp uint",t),e.addFragmentCode(a.sZ),e.addFragmentCode(r.dD),e.addFragmentCode(a.Hp);let n="\nvec3 ".concat(this.prefix,"(uint64_t x) {\n  uint h = hashCombine(").concat(t,", x);\n  vec").concat(2," v;\n");for(let i=0;i<2;++i)n+="\n  v[".concat(i,"] = float(h & 0xFFu) / 255.0;\n  h >>= 8u;\n");n+="\n  vec3 hsv = vec3(v.x, 0.5 + v.y * 0.5, 1.0);\n  return hsvToRgb(hsv);\n}\n",e.addFragmentCode(n)}enable(e,t,n){e.uniform1ui(t.uniform(this.seedName),n)}}let d=new Float32Array(3);function u(e){return"rgb(".concat(100*e[0],"%,").concat(100*e[1],"%,").concat(100*e[2],"%)")}class h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.z7)();this.hashSeed=e,this.changed=new s.IY}static getDefault(){return new h(0)}get value(){return this.hashSeed}set value(e){e!==this.hashSeed&&(this.hashSeed=e,this.changed.dispatch())}compute(e,t){let n=(0,i._)(this.hashSeed,t.low);n=(0,i._)(n,t.high);const r=(255&n)/255,s=(n>>8&255)/255;return(0,o.M)(e,r,.5+.5*s,1),e}computeCssColor(e){return this.compute(d,e),u(d)}randomize(){this.hashSeed=(0,l.z7)(),this.changed.dispatch()}toString(){return"new SegmentColorHash(".concat(this.hashSeed,")")}toJSON(){return 0===this.hashSeed?void 0:this.hashSeed}reset(){this.restoreState(0)}restoreState(e){const t=e>>>0;t!==this.hashSeed&&(this.hashSeed=t,this.changed.dispatch())}}class p{constructor(e){this.prefix=e,this.hashMapShaderManager=new r.t$("segmentStatedColorHash")}defineShader(e){this.hashMapShaderManager.defineShader(e);let t="\nbool ".concat(this.getFunctionName,"(uint64_t x, out vec3 value) {\n  uint64_t uint64Value;\n  if (").concat(this.hashMapShaderManager.getFunctionName,"(x, uint64Value)) {\n    uint uintValue = uint64Value.value[0];\n    value.r = float((uintValue & 0x0000ffu))       / 255.0;\n    value.g = float((uintValue & 0x00ff00u) >>  8) / 255.0;\n    value.b = float((uintValue & 0xff0000u) >> 16) / 255.0;\n    return true;\n  }\n  return false;\n}\n");e.addFragmentCode(t)}get getFunctionName(){return"".concat(this.prefix,"_get")}enable(e,t,n){this.hashMapShaderManager.enable(e,t,n)}disable(e,t){this.hashMapShaderManager.disable(e,t)}}},4874:(e,t,n)=>{n.d(t,{Ch:()=>r,LF:()=>l,M:()=>s,SH:()=>c,ZD:()=>o,dH:()=>a});var i=n(8262);const r=["visibleSegments","segmentEquivalences","temporaryVisibleSegments","temporarySegmentEquivalences","useTemporaryVisibleSegments","useTemporarySegmentEquivalences"];function o(e,t,n){e.registerDisposer(t.visibleSegments.changed.add(n)),e.registerDisposer(t.segmentEquivalences.changed.add(n))}function s(e,t,n){e.registerDisposer(t.temporaryVisibleSegments.changed.add(n)),e.registerDisposer(t.temporarySegmentEquivalences.changed.add(n)),e.registerDisposer(t.useTemporaryVisibleSegments.changed.add(n)),e.registerDisposer(t.useTemporarySegmentEquivalences.changed.add(n))}function a(e){return"".concat(e.low,",").concat(e.high)}function l(e){return e.useTemporaryVisibleSegments.value?e.temporaryVisibleSegments:e.visibleSegments}function c(e,t){const n=l(e),r=function(e){return e.useTemporarySegmentEquivalences.value?e.temporarySegmentEquivalences:e.segmentEquivalences}(e);if(r.disjointSets){const e=r.disjointSets.visibleSegmentEquivalencePolicy.value;for(let o of n.unsafeKeys())if(e&i.y6.NONREPRESENTATIVE_EXCLUDED){t(o,r.get(o))}else{if(void 0===r.disjointSets||!r.disjointSets.isMinElement(o))continue;for(let n of r.setElements(o))e&i.y6.REPRESENTATIVE_EXCLUDED&&e&i.y6.MAX_REPRESENTATIVE&&n.high>>>31||t(n,o)}}}},739:(e,t,n)=>{n.r(t),n.d(t,{SegmentSelectionState:()=>T,SegmentWidgetFactory:()=>_,SegmentWidgetWithExtraColumnsFactory:()=>B,SegmentationLayerSharedObject:()=>X,Uint64MapEntry:()=>E,augmentSegmentId:()=>D,bindSegmentListWidth:()=>I,forEachVisibleSegmentToDraw:()=>Z,getBaseObjectColor:()=>q,getObjectColor:()=>Y,makeSegmentWidget:()=>F,maybeAugmentSegmentId:()=>P,registerCallbackWhenSegmentationDisplayStateChanged:()=>U,registerRedrawWhenSegmentationDisplayState3DChanged:()=>G,registerRedrawWhenSegmentationDisplayStateChanged:()=>z,registerRedrawWhenSegmentationDisplayStateWithAlphaChanged:()=>j,resetTemporaryVisibleSegmentsState:()=>L,segmentWidgetTemplateWithExtraColumns:()=>O,sendVisibleSegmentsState:()=>J,updateIdStringWidth:()=>M});var i=n(2055),r=n.n(i),o=n(3651),s=n.n(o),a=n(5795),l=n(7376),c=n(4874),d=n(6210),u=n(7160),h=n(4527),p=n(2328),f=n(2303),g=n(7562),m=n(3162),v=n(3835),y=n(6344),b=n(8194),S=n(843),w=n(6348),x=n(4254),C=n.n(x),k=n(1301);class E{constructor(e,t,n){this.key=e,this.value=t,this.label=n}toString(){const e=this.key,t=this.value,n=this.label;let i;return i=void 0===t?"".concat(e):"".concat(e,"\u2192").concat(t),void 0===n?i:"".concat(i," ").concat(n)}}class T extends g.O8{constructor(){super(...arguments),this.selectedSegment=new b.Uint64,this.baseSelectedSegment=new b.Uint64,this.hasSelectedSegment=!1,this.changed=new y.IY}get value(){return this.hasSelectedSegment?this.selectedSegment:void 0}get baseValue(){return this.hasSelectedSegment?this.baseSelectedSegment:void 0}set(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.selectedSegment,i=this.baseSelectedSegment;let r,o=0,s=0,a=0,l=0;if(null==e)r=!1;else if("number"===typeof e)o=a=e>>>0,s=l=e<0?4294967295:0,r=!0;else if(e instanceof E){const t=e.value||e.key;o=t.low,s=t.high,a=e.key.low,l=e.key.high,r=!0}else e instanceof b.Uint64?(o=a=e.low,s=l=e.high,r=!0):r=!1;t&&0===o&&0===s&&(r=!1),r?!r||this.hasSelectedSegment&&n.low===o&&n.high===s&&i.low===a&&i.high===l||(n.low=o,n.high=s,i.low=a,i.high=l,this.hasSelectedSegment=!0,this.changed.dispatch()):this.hasSelectedSegment&&(this.hasSelectedSegment=!1,this.changed.dispatch())}isSelected(e){return this.hasSelectedSegment&&b.Uint64.equal(e,this.selectedSegment)}bindTo(e,t){this.registerDisposer(e.changed.add((()=>{const n=e.get(t);let i;void 0!==n&&(i=n.value),this.set(i,t.displayState.segmentationGroupState.value.hideSegmentZero.value)})))}}function L(e){e.useTemporarySegmentEquivalences.value=!1,e.useTemporaryVisibleSegments.value=!1,e.temporaryVisibleSegments.clear(),e.temporarySegmentEquivalences.clear()}function P(e,t){let n,i,r,o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n="number"===typeof t?new b.Uint64(t>>>0,t<0?4294967295:0):"string"===typeof t?b.Uint64.parseString(t):s?t.clone():t,null==e)return n;var a=e.segmentationGroupState.value;const l=a.segmentEquivalences,c=a.segmentPropertyMap.value;return 0!==l.size?(i=l.get(n),r=b.Uint64.equal(i,n)?void 0:i):i=n,o=null===c||void 0===c?void 0:c.getSegmentLabel(i),void 0===o&&void 0==r?n:new E(n,r,o)}function D(e,t){if(t instanceof E)return t;let n=P(e,t);return n instanceof b.Uint64?new E(n):n}function M(e,t){const n=t.length;e.value<n&&(e.value=n)}function I(e,t){return(0,u.W1)((e=>t.style.setProperty("--neuroglancer-segment-list-width","".concat(e,"ch"))),e.segmentationGroupState.value.maxIdLength)}const R=(()=>{const e=document.createElement("div");e.classList.add("neuroglancer-segment-list-entry");const t=document.createElement("div");t.classList.add("neuroglancer-segment-list-entry-sticky"),e.appendChild(t);const n=(0,w.C)({title:"Copy segment ID"});n.classList.add("neuroglancer-segment-list-entry-copy");const i=document.createElement("div");i.classList.add("neuroglancer-segment-list-entry-copy-container");const r=i.childElementCount;i.appendChild(n);const o=t.childElementCount;t.appendChild(i);const a=t.childElementCount,l=document.createElement("input");l.type="checkbox",l.title="Toggle segment visibility",l.classList.add("neuroglancer-segment-list-entry-visible-checkbox"),t.appendChild(l);const c=document.createElement("div");c.classList.add("neuroglancer-segment-list-entry-id-container");const d=t.childElementCount;t.appendChild(c);const u=document.createElement("div");u.classList.add("neuroglancer-segment-list-entry-id");const h=c.childElementCount;c.appendChild(u);const p=document.createElement("span");p.classList.add("neuroglancer-segment-list-entry-name");const f=e.childElementCount;e.appendChild(p);const g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,k.m)(s()({svg:C()},e))}({title:"Filter by label"});g.classList.add("neuroglancer-segment-list-entry-filter");const m=e.childElementCount;return e.appendChild(g),{template:e,copyContainerIndex:o,copyIndex:r,visibleIndex:a,idContainerIndex:d,idIndex:h,labelIndex:f,filterIndex:m,unmappedIdIndex:-1,unmappedCopyIndex:-1}})(),A=(()=>{const e=R,t=e.template.cloneNode(!0),n=t.children[0],i=n.children[e.idContainerIndex],r=i.childElementCount,o=i.children[e.idIndex].cloneNode(!0);o.classList.add("neuroglancer-segment-list-entry-unmapped-id"),i.appendChild(o);const a=n.children[e.copyContainerIndex],l=a.childElementCount;return a.appendChild(a.children[e.copyIndex].cloneNode(!0)),s()(s()({},e),{template:t,unmappedIdIndex:r,unmappedCopyIndex:l})})();function O(e){let t=R;const n=t.template.cloneNode(!0),i=[];for(let r=0;r<e;++r){i.push(n.childElementCount);const e=document.createElement("div");e.classList.add("neuroglancer-segment-list-entry-extra-property"),e.style.width="max(var(--neuroglancer-column-".concat(r,"-width), var(--neuroglancer-column-").concat(r,"-label-width))"),n.appendChild(e)}return s()(s()({},t),{template:n,numericalPropertyIndices:i})}const N=new(r());class _{constructor(e,t){if(this.displayState=e,this.template=t,void 0!==e){let t=N.get(e);void 0===t&&(t=function(e){const t=t=>{const n=t.currentTarget,i=n.dataset.id,r=H;r.tryParseString(i),e.segmentSelectionState.set(r),(0,h.m)(n)||e.selectSegment(r,!1)},n=t=>{const n=t.currentTarget,i=n.dataset.id,r=H;r.tryParseString(i),e.selectSegment(r,!(0,h.m)(n)||"toggle")},i=()=>{e.segmentSelectionState.set(null)},r=e=>e.currentTarget.closest(".neuroglancer-segment-list-entry"),o=e=>{const t=r(e);(0,p.B)(t.dataset.id),e.stopPropagation()},s=e=>{const t=r(e);(0,p.B)(t.dataset.unmappedId),e.stopPropagation()},a=t=>{const n=r(t).dataset.id,i=H;i.tryParseString(n);const o=e.segmentationGroupState.value.visibleSegments;o.set(i,!o.has(i)),t.stopPropagation()},l=t=>{const n=r(t).dataset.id,i=H;i.tryParseString(n),e.filterBySegmentLabel(i),t.stopPropagation()},c=t=>{if(2!==t.button||t.ctrlKey||t.altKey||t.metaKey||t.shiftKey)return;const n=t.currentTarget.dataset.id,i=H;i.tryParseString(n),e.moveToSegment(i)};return(e,r)=>{const d=e.children,u=d[0].children;e.addEventListener("mousedown",c);const h=u[r.copyContainerIndex];-1!==r.unmappedCopyIndex&&h.children[r.unmappedCopyIndex].addEventListener("click",s),h.children[r.copyIndex].addEventListener("click",o),e.addEventListener("mouseenter",t),e.addEventListener("mouseleave",i),u[r.visibleIndex].addEventListener("click",a),d[r.filterIndex].addEventListener("click",l),e.addEventListener("action:select-position",n)}}(e),N.set(e,t)),this.registerEventHandlers=t}}static make(e,t){return new _(e,t?A:R)}get(e){const t=this.displayState;return this.getWithNormalizedId(D(t,e))}getWithNormalizedId(e){var t,n;const i=this.displayState,r=this.template,o=r.template.cloneNode(!0),s=e.key,a=null!==(t=e.value)&&void 0!==t?t:s,l=a.toString();o.dataset.id=l;const c=o.children,d=c[0].children,u=d[r.idContainerIndex];u.children[r.idIndex].textContent=l;const h=r.unmappedIdIndex;if(void 0!==i?this.registerEventHandlers(o,r):d[r.visibleIndex].style.display="none",-1!==h){const e=u.children[h];if(b.Uint64.equal(s,a)){e.style.display="none";d[r.copyContainerIndex].children[r.unmappedCopyIndex].style.display="none"}else{const t=s.toString();o.dataset.unmappedId=t,e.textContent=t,void 0!==i&&M(i.segmentationGroupState.value.maxIdLength,t)}}return c[r.labelIndex].textContent=null!==(n=e.label)&&void 0!==n?n:"",void 0!==i&&(this.updateWithId(o,a),M(i.segmentationGroupState.value.maxIdLength,l)),o}update(e){const t=H,n=e.dataset.id;void 0!==n&&(t.parseString(n),this.updateWithId(e,t))}updateWithId(e,t){const n=e.children[0].children,i=this.template,r=this.displayState,o=r.segmentSelectionState,s=r.segmentationGroupState.value.visibleSegments;n[i.visibleIndex].checked=s.has(t),e.dataset.selected=(o.hasSelectedSegment&&b.Uint64.equal(o.selectedSegment,t)).toString();const a=n[i.idContainerIndex];V(a.children[i.idIndex],q(this.displayState,t));const l=i.unmappedIdIndex;if(-1!==l){let t,n;if(r.baseSegmentColoring.value&&void 0!==(t=e.dataset.unmappedId)){const e=H;e.parseString(t),n=q(this.displayState,e)}else n=v.Oi;V(a.children[l],n)}}}function V(e,t){e.style.backgroundColor=(0,l.LB)(t),e.style.color=(0,f.useWhiteBackground)(t)?"white":"black"}class B extends _{constructor(e,t,n){var i;const r=e.segmentationGroupState.value.segmentPropertyMap.value,o=(null!==(i=null===r||void 0===r?void 0:r.numericalProperties)&&void 0!==i?i:[]).filter(n);super(e,O(o.length)),this.parentElement=t,this.segmentPropertyMap=r,this.numericalProperties=o;(this.numericalPropertyWidths=new Array(this.numericalProperties.length)).fill(0)}getWithNormalizedId(e){var t,n,i;const r=super.getWithNormalizedId(e),o=this.numericalProperties,s=this.template.numericalPropertyIndices;if(s.length>0){const a=null!==(i=null===(t=this.segmentPropertyMap)||void 0===t?void 0:t.getSegmentInlineIndex(null!==(n=e.value)&&void 0!==n?n:e.key))&&void 0!==i?i:-1;if(-1!==a){const e=this.numericalPropertyWidths;for(let t=0,n=s.length;t<n;++t){const n=o[t].values[a];if(!isNaN(n)){const i=n.toString(),o=i.length;o>e[t]&&(e[t]=o,this.parentElement.style.setProperty("--neuroglancer-column-".concat(t,"-width"),"".concat(o,"ch"))),r.children[s[t]].textContent=i}}}}return r}makeHeaderLabel(e,t,n){const i=document.createElement("span");i.textContent=e,i.classList.add("neuroglancer-segment-list-header-label"),i.classList.add("neuroglancer-segment-list-header-label"),"label"===e&&(n.style.textAlign="left");const r=document.createElement("span");r.classList.add("neuroglancer-segment-list-header-label-sort"),i.appendChild(r),r.textContent="\u25b2";const o=(0,m.MY)(i).width;return this.parentElement.style.setProperty(t,"".concat(o,"px")),n.appendChild(i),{id:e,label:i,sortIcon:r}}getHeader(){const e=this.template,t=e.template.cloneNode(!0),n=t.children,i=n[0].children;i[e.copyContainerIndex].style.visibility="hidden",i[e.visibleIndex].style.visibility="hidden",n[e.filterIndex].style.visibility="hidden";const r=i[e.idContainerIndex],o=[this.makeHeaderLabel("id","--neuroglancer-id-column-label-width",r.children[e.idIndex]),this.makeHeaderLabel("label","--neuroglancer-label-column-label-width",n[e.labelIndex])],s=this.numericalProperties,a=this.template.numericalPropertyIndices;for(let l=0,c=a.length;l<c;++l){const e=s[l],n=this.makeHeaderLabel(e.id,"--neuroglancer-column-".concat(l,"-label-width"),t.children[a[l]]),i=e.description;i&&(n.label.title=i),o.push(n)}return{container:t,propertyLabels:o}}}function F(e,t){return _.make(null!==e&&void 0!==e?e:void 0,!0).getWithNormalizedId(t)}function U(e,t,n){t.registerDisposer((0,u.aM)(((e,t)=>{(0,c.ZD)(e,t,n)}),e.segmentationGroupState)),t.registerDisposer((0,u.aM)(((e,t)=>{e.registerDisposer(t.segmentColorHash.changed.add(n)),e.registerDisposer(t.segmentDefaultColor.changed.add(n))}),e.segmentationColorGroupState)),t.registerDisposer(e.saturation.changed.add(n)),t.registerDisposer(e.segmentSelectionState.changed.add(n)),t.registerDisposer(e.baseSegmentColoring.changed.add(n))}function z(e,t){const n=t.redrawNeeded.dispatch;U(e,t,n),t.registerDisposer((0,u.aM)(((e,t)=>{(0,c.M)(e,t,n)}),e.segmentationGroupState))}function j(e,t){z(e,t),t.registerDisposer(e.objectAlpha.changed.add(t.redrawNeeded.dispatch))}function G(e,t){j(e,t),t.registerDisposer(e.transform.changed.add(t.redrawNeeded.dispatch)),t.registerDisposer(e.renderScaleTarget.changed.add(t.redrawNeeded.dispatch)),t.registerDisposer(e.transparentPickEnabled.changed.add(t.redrawNeeded.dispatch))}const W=v.ln.create(),H=new b.Uint64;function q(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W;if(null==e)return n.fill(1),n;const i=e.segmentationColorGroupState.value;if(0!==i.segmentStatedColors.size&&i.segmentStatedColors.get(t,H))return n[0]=(255&H.low)/255,n[1]=((65280&H.low)>>>8)/255,n[2]=((16711680&H.low)>>>16)/255,n;const r=i.segmentDefaultColor.value;return void 0!==r?(n[0]=r[0],n[1]=r[1],n[2]=r[2],n):(i.segmentColorHash.compute(n,t),n)}function Y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=W;i[3]=n,q(e,t,i);let r=e.saturation.value;e.segmentSelectionState.isSelected(t)&&(r>.5?r=r-=.5:r+=.5);for(let o=0;o<3;++o)i[o]=i[o]*r+(1-r);return i[0]*=n,i[1]*=n,i[2]*=n,i}function J(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(const n of c.Ch)t[n]=e[n].rpcId;return t}const K=(0,S.Mz)(a.tB);class X extends K{constructor(e,t,n){super(n),this.chunkManager=e,this.displayState=t}initializeCounterpartWithChunkManager(e){let t=this.displayState;e.chunkManager=this.chunkManager.rpcId,J(t.segmentationGroupState.value,e),e.transform=this.registerDisposer(d.a.makeFromExisting(this.chunkManager.rpc,this.displayState.transform)).rpcId,e.renderScaleTarget=this.registerDisposer(d.a.makeFromExisting(this.chunkManager.rpc,this.displayState.renderScaleTarget)).rpcId,super.initializeCounterpart(this.chunkManager.rpc,e)}}function Z(e,t,n,i,r){const o=Math.min(1,e.objectAlpha.value),s=e.baseSegmentColoring.value;(0,c.SH)(e.segmentationGroupState.value,((a,l)=>{let c=null===i||void 0===i?void 0:i.registerUint64(t,a),d=n?Y(e,s?a:l,o):void 0;r(a,d,c,l)}))}},8365:(e,t,n)=>{n.d(t,{Bl:()=>w,l9:()=>k,mS:()=>j,Zp:()=>O,DU:()=>z,e7:()=>U,GZ:()=>M,YR:()=>G,lV:()=>L,HK:()=>R,iA:()=>W,E0:()=>B,wA:()=>_});var i=n(2982),r=n(1274),o=n.n(r),s=n(3651),a=n.n(s),l=n(4117),c=n.n(l),d=n(5795),u=n(9735),h=n(9043),p=n(8250),f=n.n(p);function g(e,t){return t=((t=f()(t,3432918353)>>>0)<<15|t>>>17)>>>0,e=((e^=t=f()(t,461845907)>>>0)<<13|e>>>19)>>>0,e=f()(e,5)+3864292196>>>0}function m(e,t,n){let i=e;return i=g(i,t),i=g(i,n),function(e,t){return e^=t,e^=e>>>16,e=f()(e,2246822507)>>>0,e^=e>>>13,e*=3266489909,(e^=e>>>16)>>>0}(i,8)}var v=n(679),y=n(2311),b=n(5553),S=n(8194);class w extends d.PU{constructor(e,t){super(e,t),this.properties=t.properties}static encodeOptions(e){return{properties:e.properties}}}function x(e,t,n){const i=e.length-1;for(;;){if(0===e[t&=i])return void(e[t]=n);++t}}function C(e,t){return t<=255?new Uint8Array(e):t<=65535?new Uint16Array(e):new Uint32Array(e)}class k{constructor(e){this.inlineProperties=e.inlineProperties}}class E{constructor(e){var t;this.segmentPropertyMap=e;const n=e.inlineProperties;void 0!==n&&(this.inlineIdToIndex=function(e){const t=e.length/2,n=C(2**(Math.ceil(c()(t))+1),t+1);for(let i=0;i<t;++i)x(n,m(0,e[2*i],e[2*i+1]),i+1);return n}(n.ids)),this.tags=null===n||void 0===n?void 0:n.properties.find((e=>"tags"===e.type)),this.labels=null===n||void 0===n?void 0:n.properties.find((e=>"label"===e.type)),this.numericalProperties=null!==(t=null===n||void 0===n?void 0:n.properties.filter((e=>"number"===e.type)))&&void 0!==t?t:[]}getSegmentInlineIndex(e){const t=this.inlineIdToIndex;return void 0===t?-1:function(e,t,n,i){let r=m(0,n,i);const o=e.length-1;for(;;){r&=o;let s=e[r];if(0===s)return-1;if(--s,t[2*s]===n&&t[2*s+1]===i)return s;++r}}(t,this.segmentPropertyMap.inlineProperties.ids,e.low,e.high)}getSegmentLabel(e){const t=this.getSegmentInlineIndex(e);if(-1===t)return;const n=this.labels,i=this.tags;let r="";if(void 0!==n&&(r=n.values[t]),void 0!==i){const e=i.tags;let n=i.values[t];for(let t=0,i=n.length;t<i;++t){const i=e[n.charCodeAt(t)];r.length>0&&(r+=" "),r+="#",r+=i}}return 0!==r.length?r:void 0}}function T(e,t,n){for(let i=0,r=n.length;i<r;++i)t[n[i]]=e[i]}function L(e){const t=e.ids;if(function(e){const t=e.length;if(0===t)return!0;let n=e[0],i=e[1];for(let r=0;r<t;r+=2){const t=e[r],o=e[r+1];if((o-i||t-n)<=0)return!1;n=t,i=o}return!0}(t))return e;const n=t.length/2,i=C(n,n-1);for(let o=0;o<n;++o)i[o]=o;i.sort(((e,n)=>{const i=t[2*e],r=t[2*e+1],o=t[2*n];return r-t[2*n+1]||i-o}));const r=new Uint32Array(2*n);for(let o=0;o<n;++o){const e=i[o];r[2*o]=t[2*e],r[2*o+1]=t[2*e+1]}return{ids:r,properties:e.properties.map((e=>{const t=e.values,r=new t.constructor(n);for(let o=0;o<n;++o)r[o]=t[i[o]];return a()(a()({},e),{values:r})}))}}function P(e,t,n){const i=e.type;return"label"===i||"description"===i||"string"===i||"tags"===i?function(e,t,n){const i=new Array(t);return i.fill(""),T(e.values,i,n),a()(a()({},e),{values:i})}(e,t,n):function(e,t,n){const i=new Float32Array(t);return i.fill(Number.NaN),T(e.values,i,n),a()(a()({},e),{values:i})}(e,t,n)}function D(e,t){if(void 0===e)return t;if(void 0===t)return e;let n=0;const i=e.ids.length/2,r=t.ids.length/2,o=new Uint32Array(i),s=new Uint32Array(r),a=e.ids,l=t.ids;let c;if((0,u.NT)(i,r,((e,t)=>{const n=a[2*e+1],i=a[2*e],r=l[2*t+1],o=l[2*t];return n-r||i-o}),(e=>{o[e]=n,++n}),(e=>{s[e]=n,++n}),((e,t)=>{o[e]=n,s[t]=n,++n})),n===i)c=a;else if(n===r)c=l;else{c=new Uint32Array(2*n);for(let e=0;e<i;++e){const t=o[e];c[2*t]=a[2*e],c[2*t+1]=a[2*e+1]}for(let e=0;e<r;++e){const t=s[e];c[2*t]=l[2*e],c[2*t+1]=l[2*e+1]}}const d=[];if(n===i)d.push(...e.properties);else for(const u of e.properties)d.push(P(u,n,o));if(n===r)d.push(...t.properties);else for(const u of t.properties)d.push(P(u,n,s));return{ids:c,properties:d}}function M(e,t){return e.memoize.getUncounted({id:"getPreprocessedSegmentPropertyMap",maps:t.map((e=>(0,y.R)(e)))},(()=>{const e=function(e){for(;;){if(0===e.length)return;if(1===e.length)return e[0];const i=[];for(let r=0,o=e.length;r<o;r+=2)r+1===o?i.push(e[r]):i.push((t=e[r],n=e[r+1],new k({inlineProperties:D(t.inlineProperties,n.inlineProperties)})));e=i}var t,n}(t);if(void 0!==e)return new E(e)}))}const I=/^[,\s]*[0-9]+(?:[,\s]+[0-9]+)*[,\s]*$/;function R(e,t){var n;if(null!==t.match(I)){const e=t.split(/[\s,]+/),n=[],i=new(o());for(let t=0,r=e.length;t<r;++t){const r=e[t];if(""===r)continue;const o=new S.Uint64;if(!o.tryParseString(r))continue;const s=o.toString();i.has(s)||(i.add(s),n.push(o))}return n.sort(S.Uint64.compare),{ids:n}}const i={regexp:void 0,prefix:void 0,includeTags:[],excludeTags:[],numericalConstraints:[],sortBy:[],includeColumns:[]},r=null===(n=null===e||void 0===e?void 0:e.segmentPropertyMap.inlineProperties)||void 0===n?void 0:n.properties,s=null===e||void 0===e?void 0:e.tags,a=(null===s||void 0===s?void 0:s.tags)||[],l=a.map((e=>e.toLowerCase())),c=null===e||void 0===e?void 0:e.labels,d=[];let u;for(let o=0;o<t.length;o=u){let n,s=t.indexOf(" ",o);if(u=-1===s?s=t.length:s+1,n=t.substring(o,s),0===n.length)continue;const p=(e,t)=>{const n=e.toLowerCase(),r=l.indexOf(n);if(-1!==r){if(e=a[r],!i.includeTags.includes(e)&&!i.excludeTags.includes(e))return e;d.push({begin:t,end:s,message:"Duplicate tag: ".concat(e)})}else d.push({begin:t,end:s,message:"Invalid tag: ".concat(e)})};if(n.startsWith("#")){const e=p(n.substring(1),o+1);void 0!==e&&i.includeTags.push(e);continue}if(n.startsWith("-#")){const e=p(n.substring(2),o+2);void 0!==e&&i.excludeTags.push(e);continue}if(n.startsWith("<")||n.startsWith(">")){let e=n.substring(1).toLowerCase();if("id"!==e&&"label"!==e){const t=null===r||void 0===r?void 0:r.find((t=>t.id.toLowerCase()===e&&("number"===t.type||"label"===t.type||"string"===t.type)));if(void 0===t){d.push({begin:o+1,end:s,message:"Invalid field: ".concat(e)});continue}e=t.id}if(void 0!==i.sortBy.find((t=>t.fieldId===e))){d.push({begin:o+1,end:s,message:"Duplicate sort field: ".concat(e)});continue}i.sortBy.push({order:n[0],fieldId:e});continue}if(n.startsWith("|")){let e=n.substring(1).toLowerCase();if("id"===e||"label"===e)continue;const t=null===r||void 0===r?void 0:r.find((t=>t.id.toLowerCase()===e&&("number"===t.type||"string"===t.type)));if(void 0===t){d.push({begin:o+1,end:s,message:"Invalid field: ".concat(e)});continue}if(e=t.id,i.sortBy.find((t=>t.fieldId===e))||i.includeColumns.find((t=>t===e)))continue;i.includeColumns.push(e);continue}if(n.startsWith("/")){if(void 0!==i.regexp){d.push({begin:o,end:s,message:"Only one regular expression allowed"});continue}if(void 0!==i.prefix){d.push({begin:o,end:s,message:"Prefix cannot be combined with regular expression"});continue}if(void 0===c){d.push({begin:o,end:s,message:"No label property"});continue}try{i.regexp=new RegExp(n.substring(1))}catch(h){d.push({begin:o,end:s,message:"Invalid regular expression syntax"})}continue}const f=n.match(/^([a-zA-Z][a-zA-Z0-9_]*)(<|<=|=|>=|>)([0-9.].*)$/);if(null===f)void 0===i.regexp?void 0!==c?void 0!==i.prefix?i.prefix+=" ".concat(n):i.prefix=n:d.push({begin:o,end:s,message:"No label property"}):d.push({begin:o,end:s,message:"Prefix cannot be combined with regular expression"});else{let t=f[1].toLowerCase();const n=f[2],r=null===e||void 0===e?void 0:e.numericalProperties.find((e=>e.id.toLowerCase()===t));if(void 0===r){d.push({begin:o,end:o+t.length,message:"Invalid numerical field: ".concat(t)});continue}let a;t=r.id;try{a=(0,v.DZ)(r.dataType,f[3])}catch(h){d.push({begin:o+f[1].length+f[2].length,end:s,message:h.message});continue}let l=i.numericalConstraints.find((e=>e.fieldId===t));void 0===l&&(l={fieldId:t,bounds:r.bounds},i.numericalConstraints.push(l));const c=(0,v.Md)(r.bounds,l.bounds[0]),u=(0,v.Md)(r.bounds,l.bounds[1]);let p=u,g=c;switch(n){case"<":p=(0,v.Xw)(r.dataType,a,-1);break;case"<=":p=a;break;case"=":p=g=a;break;case">=":g=a;break;case">":g=(0,v.Xw)(r.dataType,a,1)}if(g=(0,v.Os)(c,g)>0?c:g,p=(0,v.Os)(u,p)<0?u:p,(0,v.Os)(g,p)>0){d.push({begin:o,end:s,message:"Constraint would not match any values"});continue}l.bounds=[g,p]}}return d.length>0?{errors:d}:(0===i.sortBy.length&&i.sortBy.push({fieldId:V(e),order:"<"}),i)}function A(e){return"\\u"+e.toString(16).padStart(4,"0")}function O(e,t){var n;if(void 0!==t.errors)return{query:t,total:-1,count:0,errors:t.errors};if(void 0!==t.ids){const e=t.ids;return{query:t,total:-1,explicitIds:e,count:e.length}}const r=null===(n=null===e||void 0===e?void 0:e.segmentPropertyMap)||void 0===n?void 0:n.inlineProperties;if(void 0===r)return{query:t,count:0,total:-1};const o=null===r||void 0===r?void 0:r.properties,s=r.ids.length/2;let a=C(s,s);for(let i=0;i<s;++i)a[i]=i;const l=e=>{let t=a.length,n=0;for(let i=0;i<t;++i){const t=a[i];e(t)&&(a[n]=t,++n)}a=a.subarray(0,n)};if(void 0!==t.regexp||void 0!==t.prefix){const n=e.labels.values,i=t.regexp,r=t.prefix;void 0!==i&&l((e=>null!==n[e].match(i))),void 0!==r&&l((e=>n[e].startsWith(r)))}const c=t.includeTags,d=t.excludeTags,u=e.tags;if(c.length>0||d.length>0){const e=u.values,t=u.tags,n=[];for(const i of c)n.push([t.indexOf(i),1]);for(const i of d)n.push([t.indexOf(i),0]);n.sort(((e,t)=>e[0]-t[0]));let r="^",o=0;const s=e=>{e<o||(r+="[".concat(A(o),"-").concat(A(e),"]*"))};for(const l of n){var h=(0,i.A)(l,2);const e=h[0],t=h[1];s(e-1),t&&(r+=A(e)),o=e+1}s(65535),r+="$";const a=new RegExp(r);l((t=>null!==e[t].match(a)))}let p,f;const g=t.numericalConstraints;if(g.length>0){const t=e.numericalProperties,n=g.length,r=2**n-1;p=C(a.length,r);for(let e=0;e<n;++e){const n=g[e],r=t.find((e=>e.id===n.fieldId)).values,o=2**e;var m=(0,i.A)(n.bounds,2);const s=m[0],l=m[1];for(let e=0,t=a.length;e<t;++e){const t=r[a[e]];p[e]|=o*(t>=s&&t<=l)}}f=a,a=f.slice();let o=a.length,s=0;for(let e=0;e<o;++e)p[e]===r&&(a[s]=a[e],++s);a=a.subarray(0,s)}let v=[];if(void 0!==u){const e=[],n=u.tags,i=u.values,r=new Uint32Array(n.length);for(let t=0,o=a.length;t<o;++t){const e=i[a[t]];for(let t=0,n=e.length;t<n;++t)++r[e.charCodeAt(t)]}for(let o=0,s=n.length;o<s;++o){const i=r[o],s=n[o],a={tag:s,tagIndex:o,count:r[o]};t.includeTags.includes(s)||t.excludeTags.includes(s)?e.push(a):i>0&&v.push(a)}e.push(...v),v=e}const y=(e,t)=>{if("number"!==e.type){const n=e.values;a.sort(((e,i)=>(0,b.e)(n[e],n[i])*t))}else{const n=e.values;a.sort(((e,i)=>(n[e]-n[i])*t))}},S=t=>{void 0!==u&&y(u,t);const n=null===e||void 0===e?void 0:e.labels;void 0!==n&&y(n,t)},w=t.sortBy;for(let i=w.length-1;i>=0;--i){var x=w[i];const e=x.fieldId,t=x.order,n="<"===t?1:-1;if("id"!==e)"label"===e?S(n):y(o.find((t=>t.id===e)),n);else{if(i+1===w.length){if("<"===t)continue;a.reverse();continue}a.sort(((e,t)=>n*(e-t)))}}return{query:t,intermediateIndices:f,intermediateIndicesMask:p,indices:a,tags:v,count:a.length,total:s}}function N(e,t,n){const r=256,o=t.values;var s=(0,i.A)(n,2);const a=s[0],l=s[1],c=l<=a?0:r/(l-a),d=new Uint32Array(258),u=e.query.numericalConstraints,h=u.findIndex((e=>e.fieldId===t.id));if(-1===h){const t=e.indices;for(let e=0,n=t.length;e<n;++e){const n=o[t[e]];isNaN(n)||++d[Math.min(255,Math.max(-1,(n-a)*c))+1>>>0]}}else{const t=e.intermediateIndices,n=e.intermediateIndicesMask,i=2**u.length-1-2**h;for(let e=0,r=t.length;e<r;++e){if((n[e]&i)==i){const n=o[t[e]];isNaN(n)||++d[Math.min(255,Math.max(-1,(n-a)*c))+1>>>0]}}}return{queryResult:e,histogram:d,window:n}}function _(e,t,n,i){if(void 0===e)return n.length=0,void(i.length=0);const r=e.numericalProperties,o=r.length;if(void 0!==(null===t||void 0===t?void 0:t.indices))for(let s=0;s<o;++s){const e=n[s],o=i[s],a=r[s];void 0!==e&&e.queryResult===t&&(0,v.gt)(a.dataType,e.window,o)||(n[s]=N(t,a,o))}else n.length=0}function V(e){return(null===e||void 0===e?void 0:e.tags)||(null===e||void 0===e?void 0:e.labels)?"label":"id"}function B(e,t){const n=t.ids;if(void 0!==n)return n.map((e=>e.toString())).join(", ");let r="";var o=t;const s=o.prefix,a=o.regexp;void 0!==s?r=s:void 0!==a&&(r="/".concat(a));for(const i of t.includeTags)r.length>0&&(r+=" "),r+="#".concat(i);for(const i of t.excludeTags)r.length>0&&(r+=" "),r+="-#".concat(i);for(const d of t.numericalConstraints){const t=d.fieldId,n=d.bounds;var l=(0,i.A)(n,2);const o=l[0],s=l[1],a=e.numericalProperties.find((e=>e.id===t));if(!(0,v.gt)(a.dataType,a.bounds,n))if(0!==(0,v.Os)(o,s)){if((0,v.Os)(o,a.bounds[0])>0){r.length>0&&(r+=" ");const e=(0,v.Xw)(a.dataType,o,-1),n=o.toString(),i=e.toString();a.dataType!==h.pe.FLOAT32||n.length<=i.length?r+="".concat(t,">=").concat(n):r+="".concat(t,">").concat(i)}if((0,v.Os)(s,a.bounds[1])<0){r.length>0&&(r+=" ");const e=(0,v.Xw)(a.dataType,s,1),n=s.toString(),i=e.toString();a.dataType!==h.pe.FLOAT32||n.length<=i.length?r+="".concat(t,"<=").concat(n):r+="".concat(t,"<").concat(i)}}else r.length>0&&(r+=" "),r+="".concat(t,"=").concat(o)}let c=t.sortBy;if(1===c.length){const t=c[0];"<"===t.order&&t.fieldId===V(e)&&(c=[])}for(const i of c)r.length>0&&(r+=" "),r+="".concat(i.order).concat(i.fieldId);for(const i of t.includeColumns)r.length>0&&(r+=" "),r+="|".concat(i);return r}const F=new S.Uint64;function U(e,t,n){if(void 0===t)return;const i=t.explicitIds;if(void 0!==i)return void i.forEach(n);const r=t.indices;if(void 0!==r){const t=(null===e||void 0===e?void 0:e.segmentPropertyMap.inlineProperties).ids;for(let e=0,i=r.length;e<i;++e){const i=r[e];F.low=t[2*i],F.high=t[2*i+1],n(F,e)}}}function z(e,t,n){if(0===n.size)return 0;let i=0;return U(e,t,(e=>{n.has(e)&&++i})),i}function j(e,t,n,i){const r=e.includeTags.filter((e=>e!==t)),o=e.excludeTags.filter((e=>e!==t));return!0===i&&(n?r:o).push(t),a()(a()({},e),{includeTags:r,excludeTags:o})}function G(e){return void 0===e.ids&&(void 0!==e.errors||!(e.numericalConstraints.length>0)&&(!(e.includeTags.length>0)&&(!(e.excludeTags.length>0)&&(!e.prefix&&!e.regexp))))}function W(e,t){if(void 0===e)return!1;if(void 0!==e.ids)return!1;if(void 0!==e.errors)return!1;const n=e.sortBy,i=e.includeColumns;return void 0!==n.find((e=>e.fieldId===t))||i.includes(t)}},8262:(e,t,n)=>{n.d(t,{Aj:()=>a,K_:()=>s,YR:()=>l,y6:()=>i});var i,r=n(7562),o=n(8194);!function(e){e[e.MIN_REPRESENTATIVE=0]="MIN_REPRESENTATIVE",e[e.MAX_REPRESENTATIVE=1]="MAX_REPRESENTATIVE",e[e.REPRESENTATIVE_EXCLUDED=2]="REPRESENTATIVE_EXCLUDED",e[e.NONREPRESENTATIVE_EXCLUDED=4]="NONREPRESENTATIVE_EXCLUDED"}(i||(i={}));class s{}class a extends r.O8{constructor(e,t,n){super(),this.graph=e,this.segmentsState=t,this.transform=n}createRenderLayers(e,t,n){return[]}}function l(e){return!(e.high>>>31)}new o.Uint64(4294967295,4294967295)},1785:(e,t,n)=>{n.r(t),n.d(t,{LAYER_CONTROLS:()=>hn,SKELETON_RENDERING_SHADER_CONTROL_TOOL_ID:()=>rn,SegmentationUserLayer:()=>dn,SegmentationUserLayerColorGroupState:()=>sn,SegmentationUserLayerGroupState:()=>on});var i=n(608),r=n.n(i),o=n(3651),s=n.n(o),a=n(2982),l=n(8332),c=n(2579),d=n(2858),u=n(575),h=n(6423),p=n(3436),f=n(7376),g=n(739),m=n(8365),v=n(1274),y=n.n(v),b=n(5491),S=n.n(b),w=n(8262),x=n(6063),C=n.n(x),k=n(5677),E=n.n(k),T=n(281),L=n.n(T),P=n(9176),D=n.n(P),M=n(7160),I=n(8194);const R=D()("disjoint_sets:rank"),A=D()("disjoint_sets:parent"),O=D()("disjoint_sets:next"),N=D()("disjoint_sets:prev");function _(e){let t=e,n=e[A];for(;n!==e;)n=(e=n)[A];for(e=t[A];n!==e;)t[A]=n,t=e,e=t[A];return n}function*V(e){let t=e;do{yield t,t=t[O]}while(t!==e)}const B=D()("disjoint_sets:min");function F(e){return e[A]===e}class U{constructor(){this.map=new(r()),this.visibleSegmentEquivalencePolicy=new M.B0(w.y6.MIN_REPRESENTATIVE),this.generation=0}has(e){let t=e.toString();return void 0!==this.map.get(t)}get(e){let t=e.toString(),n=this.map.get(t);return void 0===n?e:_(n)[B]}isMinElement(e){let t=this.get(e);return t===e||I.Uint64.equal(t,e)}makeSet(e){let t=e.toString(),n=this.map,i=n.get(t);return void 0===i?(i=e.clone(),(r=i)[A]=r,r[R]=0,r[O]=r[N]=r,i[B]=i,n.set(t,i),i):_(i);var r}link(e,t){if((e=this.makeSet(e))===(t=this.makeSet(t)))return!1;this.generation++;let n=function(e,t){let n=e[R],i=t[R];return n>i?(t[A]=e,e):(e[A]=t,n===i&&(t[R]=i+1),t)}(e,t);!function(e,t){let n=e[N],i=t[N];t[N]=n,n[O]=t,e[N]=i,i[O]=e}(e,t);let i=e[B],r=t[B];const o=0!==(this.visibleSegmentEquivalencePolicy.value&w.y6.MAX_REPRESENTATIVE);return n[B]=I.Uint64.less(i,r)===o?r:i,!0}linkAll(e){for(let t=1,n=e.length;t<n;++t)this.link(e[0],e[t])}deleteSet(e){const t=this.map;let n=!1;for(const i of this.setElements(e))t.delete(i.toString()),n=!0;return n}*setElements(e){let t=e.toString(),n=this.map.get(t);void 0===n?yield e:yield*V(n)}clear(){let e=this.map;return 0!==e.size&&(++this.generation,e.clear(),!0)}get size(){return this.map.size}mappings(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Array(2);return function*(){for(let n of e.map.values())t[0]=n,t[1]=_(n)[B],yield t}()}*roots(){for(let e of this.map.values())F(e)&&(yield e)}[L()](){return this.mappings()}toJSON(){let e=new Array;for(let t of this.map.values())if(F(t)){let n=new Array;for(let e of V(t))n.push(e);n.sort(I.Uint64.compare),e.push(n)}return e.sort(((e,t)=>I.Uint64.compare(e[0],t[0]))),e.map((e=>e.map((e=>e.toString()))))}}var z,j=n(7970),G=n(6344),W=n(7799),H=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=E()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&C()(t,n,s),s};const q="DisjointUint64Sets.add",Y="DisjointUint64Sets.clear",J="DisjointUint64Sets.highBitRepresentativeChanged",K="DisjointUint64Sets.deleteSet";let X=z=class extends W.IN{constructor(){super(...arguments),this.disjointSets=new U,this.changed=new G.IY}get value(){return this}static makeWithCounterpart(e,t){let n=new this;return n.disjointSets.visibleSegmentEquivalencePolicy=t,n.registerDisposer(t.changed.add((()=>{$(n)}))),n.initializeCounterpart(e),t.value&&$(n),n}disposed(){this.disjointSets=void 0,this.changed=void 0,super.disposed()}link(e,t){if(this.disjointSets.link(e,t)){let n=this.rpc;return n&&n.invoke(q,{id:this.rpcId,al:e.low,ah:e.high,bl:t.low,bh:t.high}),this.changed.dispatch(),!0}return!1}linkAll(e){for(let t=1,n=e.length;t<n;++t)this.link(e[0],e[t])}has(e){return this.disjointSets.has(e)}get(e){return this.disjointSets.get(e)}clear(){if(this.disjointSets.clear()){let e=this.rpc;e&&e.invoke(Y,{id:this.rpcId}),this.changed.dispatch()}}setElements(e){return this.disjointSets.setElements(e)}deleteSet(e){if(this.disjointSets.deleteSet(e)){let t=this.rpc;t&&t.invoke(K,{id:this.rpcId,l:e.low,h:e.high}),this.changed.dispatch()}}get size(){return this.disjointSets.size}toJSON(){return this.disjointSets.toJSON()}restoreState(e){if(void 0!==e){let t=[new I.Uint64,new I.Uint64];(0,j.parseArray)(e,(e=>{(0,j.parseArray)(e,((e,n)=>{t[n%2].parseString(String(e),10),0!==n&&this.link(t[0],t[1])}))}))}}assignFrom(e){this.clear(),e instanceof z&&(e=e.disjointSets);for(const n of e){var t=(0,a.A)(n,2);const e=t[0],i=t[1];this.link(e,i)}}};X=z=H([(0,W.eZ)("DisjointUint64Sets")],X);const Z=new I.Uint64,Q=new I.Uint64;function $(e){e.rpc.invoke(J,{id:e.rpcId,value:e.disjointSets.visibleSegmentEquivalencePolicy.value})}(0,W.ks)(q,(function(e){let t=this.get(e.id);Z.low=e.al,Z.high=e.ah,Q.low=e.bl,Q.high=e.bh,t.disjointSets.link(Z,Q)&&t.changed.dispatch()})),(0,W.ks)(Y,(function(e){let t=this.get(e.id);t.disjointSets.clear()&&t.changed.dispatch()})),(0,W.ks)(J,(function(e){this.get(e.id).disjointSets.visibleSegmentEquivalencePolicy.value=e.value})),(0,W.ks)(K,(function(e){let t=this.get(e.id);Z.low=e.l,Z.high=e.h,t.disjointSets.deleteSet(Z)&&t.changed.dispatch()}));class ee extends w.K_{constructor(){super(...arguments),this.spanningTreeEdges=new(r()),this.equivalences=new X,this.connections=new(y()),this.changed=new G.HN}link(e,t){this.equivalences.link(e,t);for(const n of this.connections)n.segmentsState.segmentEquivalences.link(e,t)}linkAll(e){this.equivalences.linkAll(e);for(const t of this.connections)t.segmentsState.segmentEquivalences.linkAll(e)}deleteSet(e){this.equivalences.deleteSet(e);for(const t of this.connections)t.segmentsState.segmentEquivalences.deleteSet(e)}normalizeAll(){for(const e of this.connections)te(e.segmentsState.visibleSegments,e.segmentsState.segmentEquivalences.disjointSets)}addSpanningTreeEdge(e,t){const n=e.toString(),i=t.toString(),r=this.spanningTreeEdges;let o=r.get(n);void 0===o&&(o=new(y()),r.set(n,o));let s=r.get(i);void 0===s&&(s=new(y()),r.set(i,s)),o.add(i),s.add(n)}removeSpanningTreeEdge(e,t){const n=e.toString(),i=t.toString(),r=this.spanningTreeEdges,o=r.get(n),s=r.get(i);o.delete(i),0===o.size&&r.delete(n),s.delete(n),0===s.size&&r.delete(i)}*getSpanningTreeNeighbors(e){const t=new I.Uint64,n=this.spanningTreeEdges.get(e.toString());if(void 0!==n)for(const i of n)t.parseString(i),yield t}restoreState(e){const t=this.equivalences,n=this.spanningTreeEdges;if(t.clear(),n.clear(),void 0===e)return;const i=[new I.Uint64,new I.Uint64];(0,j.parseArray)(e,(e=>{(0,j.parseArray)(e,((e,n)=>{i[n%2].parseString(String(e),10),0!==n&&t.link(i[0],i[1])&&this.addSpanningTreeEdge(i[0],i[1])}))}))}toJSON(){const e=this.spanningTreeEdges;if(0===e.size)return;const t=new Array;for(let i of e){var n=(0,a.A)(i,2);let e=n[0],r=n[1];const o=I.Uint64.parseString(e);for(const n of r){const e=I.Uint64.parseString(n);I.Uint64.compare(o,e)>0||t.push([o,e])}}return t.sort(((e,t)=>I.Uint64.compare(e[0],t[0])||I.Uint64.compare(e[1],t[1]))),t.map((e=>e.map((e=>e.toString()))))}get visibleSegmentEquivalencePolicy(){return w.y6.MIN_REPRESENTATIVE}async merge(e,t){const n=this.equivalences;return I.Uint64.equal(n.get(e),n.get(t))?e:(this.addSpanningTreeEdge(e,t),this.link(e,t),this.normalizeAll(),this.changed.dispatch(),n.get(e))}async split(e,t){const n=this.computeSplit(e,t);if(void 0===n)throw new Error("Segments are already split");const i=n.includeBaseSegments,r=n.includeRepresentative,o=n.excludeBaseSegments,s=n.excludeRepresentative,a=this.equivalences;this.deleteSet(e),this.linkAll(i),this.linkAll(o);const l=(e,t)=>{for(const n of e)for(const e of this.getSpanningTreeNeighbors(n))I.Uint64.equal(a.get(e),t)||this.removeSpanningTreeEdge(n,e)},c=a.get(e),d=a.get(t);l(i,c),l(o,d);for(const u of this.connections){const e=u.segmentsState.visibleSegments;e.has(s)&&(e.delete(s),e.add(r))}return this.normalizeAll(),this.changed.dispatch(),{include:c,exclude:d}}trackSegment(e,t){return()=>{}}computeSplit(e,t){const n=this.equivalences,i=n.get(e);if(!I.Uint64.equal(i,n.get(t)))return;const r=new U;for(const d of n.setElements(i))if(!I.Uint64.equal(d,t))for(const e of this.getSpanningTreeNeighbors(d))I.Uint64.equal(e,t)||r.link(d,e);const o=[],s=[],a=r.get(e);let l=e,c=t;for(const d of n.setElements(i))I.Uint64.equal(r.get(d),a)?(o.push(d),I.Uint64.compare(d,l)<0&&(l=d)):(s.push(d),I.Uint64.compare(d,c)<0&&(c=d));return o.sort(I.Uint64.compare),s.sort(I.Uint64.compare),{includeBaseSegments:o,includeRepresentative:l,excludeBaseSegments:s,excludeRepresentative:c}}connect(e){const t=new ne(this,e);return e.segmentEquivalences.assignFrom(this.equivalences),te(e.visibleSegments,e.segmentEquivalences.disjointSets),t.registerDisposer(e.visibleSegments.changed.add(t.registerCancellable(S()((()=>te(e.visibleSegments,e.segmentEquivalences.disjointSets)),0)))),this.connections.add(t),t.registerDisposer((()=>{this.connections.delete(t)})),t}}function te(e,t){const n=[];for(const i of e.unsafeKeys()){const r=t.get(i);I.Uint64.equal(i,r)||(n.push(r),e.delete(i))}for(const i of n)e.add(i)}class ne extends w.Aj{computeSplit(e,t){return this.graph.computeSplit(e,t)}}var ie=n(6210),re=n(1406),oe=n(7779),se=n(954),ae=n(1110),le=n(968),ce=n(4874),de=n(2837);class ue{constructor(e){this.disjointSets=e,this.generation=Number.NaN,this.hashMap=new ae.Tg}update(){let e=this.disjointSets;const t=e.generation;if(this.generation!==t){this.generation=t;let i=this.hashMap;i.clear();for(let t of e.mappings()){var n=(0,a.A)(t,2);let e=n[0],r=n[1];i.set(e,r)}}}}class he extends de.r{constructor(e,t){super(e,{shaderParameters:new M.wP((e=>({hasEquivalences:e.registerDisposer((0,M.Uq)((e=>0!==e.size),[t.segmentationGroupState.value.segmentEquivalences])),hasSegmentStatedColors:e.registerDisposer((0,M.Uq)((e=>0!==e.size),[t.segmentStatedColors])),hasSegmentDefaultColor:e.registerDisposer((0,M.Uq)((e=>void 0!==e),[t.segmentDefaultColor])),hideSegmentZero:t.hideSegmentZero,baseSegmentColoring:t.baseSegmentColoring}))),transform:t.transform,renderScaleHistogram:t.renderScaleHistogram,renderScaleTarget:t.renderScaleTarget,localPosition:t.localPosition}),this.displayState=t,this.segmentationGroupState=this.displayState.segmentationGroupState.value,this.segmentColorShaderManager=new f.ji("segmentColorHash"),this.segmentStatedColorShaderManager=new f.YL("segmentStatedColor"),this.hashTableManager=new le.vb("visibleSegments"),this.gpuHashTable=this.registerDisposer(le.F7.get(this.gl,this.segmentationGroupState.visibleSegments.hashTable)),this.gpuTemporaryHashTable=le.F7.get(this.gl,this.segmentationGroupState.temporaryVisibleSegments.hashTable),this.equivalencesShaderManager=new le.t$("equivalences"),this.equivalencesHashMap=new ue(this.segmentationGroupState.segmentEquivalences.disjointSets),this.temporaryEquivalencesHashMap=new ue(this.segmentationGroupState.temporarySegmentEquivalences.disjointSets),this.gpuEquivalencesHashTable=this.registerDisposer(le.F7.get(this.gl,this.equivalencesHashMap.hashMap)),this.gpuTemporaryEquivalencesHashTable=this.registerDisposer(le.F7.get(this.gl,this.temporaryEquivalencesHashMap.hashMap)),this.registerDisposer(this.shaderParameters),(0,g.registerRedrawWhenSegmentationDisplayStateChanged)(t,this),this.registerDisposer(t.selectedAlpha.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(t.notSelectedAlpha.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(t.ignoreNullVisibleSet.changed.add(this.redrawNeeded.dispatch))}disposed(){var e;null===(e=this.gpuSegmentStatedColorHashTable)||void 0===e||e.dispose()}getSources(e){return this.multiscaleSource.getSources(s()(s()({},e),{discreteValues:!0}))}defineShader(e,t){this.hashTableManager.defineShader(e);let n="\nuint64_t getUint64DataValue() {\n  uint64_t x = toUint64(getDataValue());\n";n+="return x;\n}\n",e.addFragmentCode("\nuint64_t getUint64DataValue() {\n  uint64_t x = toUint64(getDataValue());\nreturn x;\n}\n"),t.hasEquivalences?(this.equivalencesShaderManager.defineShader(e),e.addFragmentCode("\nuint64_t getMappedObjectId(uint64_t value) {\n  uint64_t mappedValue;\n  if (".concat(this.equivalencesShaderManager.getFunctionName,"(value, mappedValue)) {\n    return mappedValue;\n  }\n  return value;\n}\n"))):e.addFragmentCode("\nuint64_t getMappedObjectId(uint64_t value) {\n  return value;\n}\n"),e.addUniform("highp uvec2","uSelectedSegment"),e.addUniform("highp uint","uShowAllSegments"),e.addUniform("highp float","uSelectedAlpha"),e.addUniform("highp float","uNotSelectedAlpha"),e.addUniform("highp float","uSaturation");let i="\n  uint64_t baseValue = getUint64DataValue();\n  uint64_t value = getMappedObjectId(baseValue);\n  uint64_t valueForColor = ".concat(t.baseSegmentColoring?"baseValue":"value",";\n\n  float alpha = uSelectedAlpha;\n  float saturation = uSaturation;\n");t.hideSegmentZero&&(i+="\n  if (value.value[0] == 0u && value.value[1] == 0u) {\n    emit(vec4(vec4(0, 0, 0, 0)));\n    return;\n  }\n"),i+="\n  bool has = uShowAllSegments != 0u ? true : ".concat(this.hashTableManager.hasFunctionName,"(value);\n  if (uSelectedSegment == value.value) {\n    float adjustment = has ? 0.5 : 0.75;\n    if (saturation > adjustment) {\n      saturation -= adjustment;\n    } else {\n      saturation += adjustment;\n    }\n  } else if (!has) {\n    alpha = uNotSelectedAlpha;\n  }\n");let r="vec3 getMappedIdColor(uint64_t value) {\n";t.hasSegmentStatedColors&&(this.segmentStatedColorShaderManager.defineShader(e),r+="\n  vec3 rgb;\n  if (".concat(this.segmentStatedColorShaderManager.getFunctionName,"(value, rgb)) {\n    return rgb;\n  }\n")),t.hasSegmentDefaultColor?(e.addUniform("highp vec3","uSegmentDefaultColor"),r+="  return uSegmentDefaultColor;\n"):(this.segmentColorShaderManager.defineShader(e),r+="  return segmentColorHash(value);\n"),r+="\n}\n",e.addFragmentCode(r),i+="\n  vec3 rgb = getMappedIdColor(valueForColor);\n  emit(vec4(mix(vec3(1.0,1.0,1.0), rgb, saturation), alpha));\n",e.setFragmentMain(i)}initializeShader(e,t,n){const i=this.gl,r=this.displayState,o=this.segmentationGroupState,s=this.displayState.segmentSelectionState;var a=this.displayState;const l=a.segmentDefaultColor.value,c=a.segmentColorHash.value,d=(0,ce.LF)(o),u=this.displayState.ignoreNullVisibleSet.value;let h=0,p=0;if(s.hasSelectedSegment){let e=s.selectedSegment;h=e.low,p=e.high}if(i.uniform1f(t.uniform("uSelectedAlpha"),r.selectedAlpha.value),i.uniform1f(t.uniform("uSaturation"),r.saturation.value),i.uniform1f(t.uniform("uNotSelectedAlpha"),r.notSelectedAlpha.value),i.uniform2ui(t.uniform("uSelectedSegment"),h,p),i.uniform1ui(t.uniform("uShowAllSegments"),d.hashTable.size||!u?0:1),this.hashTableManager.enable(i,t,o.useTemporaryVisibleSegments.value?this.gpuTemporaryHashTable:this.gpuHashTable),n.hasEquivalences){const e=o.useTemporarySegmentEquivalences.value;(e?this.temporaryEquivalencesHashMap:this.equivalencesHashMap).update(),this.equivalencesShaderManager.enable(i,t,e?this.gpuTemporaryEquivalencesHashTable:this.gpuEquivalencesHashTable)}if(void 0===l?this.segmentColorShaderManager.enable(i,t,c):i.uniform3fv(t.uniform("uSegmentDefaultColor"),l),n.hasSegmentStatedColors){const e=this.displayState.segmentStatedColors.value;let n=this.gpuSegmentStatedColorHashTable;void 0!==n&&n.hashTable===e.hashTable||(null===n||void 0===n||n.dispose(),this.gpuSegmentStatedColorHashTable=n=le.F7.get(i,e.hashTable)),this.segmentStatedColorShaderManager.enable(i,t,n)}}endSlice(e,t,n){const i=this.gl;this.hashTableManager.disable(i,t),n.hasEquivalences&&this.equivalencesShaderManager.disable(i,t),n.hasSegmentStatedColors&&this.segmentStatedColorShaderManager.disable(i,t),super.endSlice(e,t,n)}}var pe=n(9859),fe=n(1245),ge=n(7965),me=n(3893),ve=n(2395),ye=n.n(ve),be=n(974),Se=n.n(be),we=n(492),xe=n.n(we),Ce=n(890),ke=n(2038),Ee=n(9735),Te=n(2328),Le=n(7562),Pe=n(3162),De=n(1058),Me=n(8774),Ie=n(7921),Re=n(6348),Ae=n(7772),Oe=n(8946),Ne=n(2608),_e=n(679),Ve=n(1532),Be=n(3240);const Fe="mergeSegments",Ue="splitSegments",ze=De.n5.fromObject({"at:shift?+mousedown0":{action:"merge-segments"},"at:shift?+mousedown2":{action:"set-anchor"}}),je=De.n5.fromObject({"at:shift?+mousedown0":{action:"split-segments"},"at:shift?+alt+mousedown0":{action:"split-and-select-segments"},"at:shift?+mousedown2":{action:"set-anchor"}});class Ge extends Be.NL{constructor(e){super(e),this.lastAnchorBaseSegment=new M.B0(void 0);const t=()=>{const t=e.anchorSegment.value;if(void 0===t)return;const n=e.displayState.segmentSelectionState;if(!n.hasSelectedSegment)return;const i=e.displayState.segmentationGroupState.value.segmentEquivalences,r=i.get(t);if(!I.Uint64.equal(n.selectedSegment,r))return;const o=n.baseSelectedSegment,s=(0,w.YR)(o),a=i.disjointSets.visibleSegmentEquivalencePolicy.value;a&w.y6.NONREPRESENTATIVE_EXCLUDED&&s||a&w.y6.REPRESENTATIVE_EXCLUDED&&!s||(this.lastAnchorBaseSegment.value=o.clone())};this.registerDisposer(e.displayState.segmentSelectionState.changed.add(t)),this.registerDisposer(e.anchorSegment.changed.add(t))}toJSON(){return Fe}activate(e){const t=this.layer.displayState.segmentationGroupState.value,n=()=>{let e=this.layer.anchorSegment.value,n=this.lastAnchorBaseSegment.value;if(void 0===e)return{anchorSegment:void 0,error:"Select anchor segment for merge"};const i=t.segmentEquivalences.get(e);return t.visibleSegments.has(i)?void 0!==n&&I.Uint64.equal(t.segmentEquivalences.get(n),i)?{anchorSegment:n,error:void 0}:{anchorSegment:e,error:"Hover over base segment within anchor segment that is closest to merge location"}:{anchorSegment:e,error:"Anchor segment must be in visible set"}},i=()=>{var e=n();let i=e.anchorSegment,r=e.error;if(void 0===i||void 0!==r)return{anchorSegment:i,error:r,otherSegment:void 0,anchorSegmentValid:!1};const o=this.layer.displayState,s=o.segmentSelectionState.baseValue;return void 0===s||I.Uint64.equal(o.segmentSelectionState.selectedSegment,t.segmentEquivalences.get(i))?{anchorSegment:i,otherSegment:void 0,error:"Hover over segment to merge",anchorSegmentValid:!0}:{anchorSegment:i,otherSegment:s,error:void 0,anchorSegmentValid:!0}};var r=(0,Be.L0)(e);const o=r.body;r.header.textContent="Merge segments",o.classList.add("neuroglancer-merge-segments-status"),e.bindInputEventMap(ze),e.registerDisposer((()=>{(0,g.resetTemporaryVisibleSegmentsState)(t)}));const s=()=>{(0,Pe.gS)(o);const e=this.layer.displayState;var n=i();let r=n.anchorSegment,s=n.otherSegment,a=n.anchorSegmentValid,l=n.error;const c=e=>{const t=(0,g.makeSegmentWidget)(this.layer.displayState,e);return t.classList.add("neuroglancer-segment-list-entry-double-line"),t};if(void 0!==r&&o.appendChild(c((0,g.augmentSegmentId)(e,r))),void 0!==l){const e=document.createElement("span");e.textContent=l,o.appendChild(e)}if(void 0!==s){const t=document.createElement("span");t.textContent=" merge ",o.appendChild(t),o.appendChild(c((0,g.augmentSegmentId)(e,s)))}const d=t.segmentEquivalences;if(a){t.useTemporaryVisibleSegments.value=!0;const e=t.temporaryVisibleSegments;e.clear(),e.add(d.get(r)),void 0!==s&&e.add(d.get(s))}else(0,g.resetTemporaryVisibleSegmentsState)(t)};s(),e.registerDisposer((0,g.bindSegmentListWidth)(this.layer.displayState,o));const a=e.registerCancellable((0,ke.t)(s));(0,g.registerCallbackWhenSegmentationDisplayStateChanged)(this.layer.displayState,e,a),e.registerDisposer(this.layer.anchorSegment.changed.add(a)),e.registerDisposer(this.lastAnchorBaseSegment.changed.add(a)),e.bindAction("merge-segments",(e=>{e.stopPropagation(),(async()=>{const e=t.graph.value;if(void 0===e)return;var n=i();const r=n.anchorSegment,o=n.otherSegment,s=n.error;if(void 0!==r&&void 0!==o&&void 0===s)try{await e.merge(r,o),pe.M.showTemporaryMessage("Merge performed")}catch(a){pe.M.showTemporaryMessage("Merge failed: ".concat(a))}})()})),e.bindAction("set-anchor",(e=>{e.stopPropagation();const n=this.layer.displayState.segmentSelectionState.baseValue;if(void 0===n)return;const i=this.layer.anchorSegment.value;t.visibleSegments.add(n),void 0!==i&&I.Uint64.equal(i,n)||(this.layer.anchorSegment.value=n.clone())}))}get description(){return"merge"}}class We extends Be.NL{toJSON(){return Ue}activate(e){const t=this.layer.displayState.segmentationGroupState.value,n=()=>{let e=this.layer.anchorSegment.value;if(void 0===e)return{anchorSegment:void 0,error:"Select anchor segment for split"};const n=t.segmentEquivalences.get(e);return t.visibleSegments.has(n)?{anchorSegment:e,error:void 0}:{anchorSegment:e,error:"Anchor segment must be in visible set"}};var i=(0,Be.L0)(e);const r=i.body;i.header.textContent="Split segments",r.classList.add("neuroglancer-merge-segments-status"),e.bindInputEventMap(je);const o=()=>{var e=n();let i=e.anchorSegment,r=e.error;if(void 0===i||void 0!==r)return{anchorSegment:i,error:r,otherSegment:void 0,anchorSegmentValid:!1};const o=this.layer.displayState,s=o.segmentSelectionState.baseValue;return void 0===s||!I.Uint64.equal(o.segmentSelectionState.selectedSegment,t.segmentEquivalences.get(i))||I.Uint64.equal(s,i)?{anchorSegment:i,otherSegment:void 0,anchorSegmentValid:!0,error:"Hover over base segment to seed split"}:{anchorSegment:i,otherSegment:s,anchorSegmentValid:!0,error:void 0}};e.registerDisposer((()=>{(0,g.resetTemporaryVisibleSegmentsState)(t)}));const s=()=>{(0,Pe.gS)(r);const e=this.layer.displayState;var n=o();let i,s,a=n.anchorSegment,l=n.otherSegment,c=n.anchorSegmentValid,d=n.error;(()=>{const e=t.segmentEquivalences,n=this.layer.graphConnection;if(c&&void 0!==n){if(t.useTemporaryVisibleSegments.value=!0,void 0!==l){const e=n.computeSplit(a,l);if(void 0!==e){i=new g.Uint64MapEntry(a,e.includeRepresentative),s=new g.Uint64MapEntry(l,e.excludeRepresentative),t.useTemporarySegmentEquivalences.value=!0;const n=e.includeRepresentative,r=e.excludeRepresentative,o=t.temporarySegmentEquivalences;o.clear();for(const t of e.includeBaseSegments)o.link(t,n);for(const t of e.excludeBaseSegments)o.link(t,r);const c=t.temporaryVisibleSegments;return c.clear(),c.add(n),void c.add(r)}}t.useTemporarySegmentEquivalences.value=!1;const r=t.temporaryVisibleSegments;r.clear(),r.add(e.get(a))}else(0,g.resetTemporaryVisibleSegmentsState)(t)})();const u=e=>{const t=(0,g.makeSegmentWidget)(this.layer.displayState,e);return t.classList.add("neuroglancer-segment-list-entry-double-line"),t};if(void 0!==a&&r.appendChild(u(null!==i&&void 0!==i?i:(0,g.augmentSegmentId)(e,a))),void 0!==d){const e=document.createElement("span");e.textContent=d,r.appendChild(e)}if(void 0!==s){const e=document.createElement("span");e.textContent=" split ",r.appendChild(e),r.appendChild(u(s))}};e.registerDisposer((0,g.bindSegmentListWidth)(this.layer.displayState,r)),s();const a=e.registerCancellable((0,ke.t)(s));(0,g.registerCallbackWhenSegmentationDisplayStateChanged)(this.layer.displayState,e,a),e.registerDisposer(this.layer.anchorSegment.changed.add(a));const l=async e=>{const n=t.graph.value;if(void 0===n)return;var i=o();const r=i.anchorSegment,s=i.otherSegment,a=i.error;if(void 0!==r&&void 0!==s&&void 0===a)try{await n.split(r,s),e&&t.visibleSegments.add(t.segmentEquivalences.get(s)),pe.M.showTemporaryMessage("Split performed")}catch(l){pe.M.showTemporaryMessage("Split failed: ".concat(l))}};e.bindAction("split-segments",(e=>{e.stopPropagation(),l(!1)})),e.bindAction("split-and-select-segments",(e=>{e.stopPropagation(),l(!0)})),e.bindAction("set-anchor",(e=>{e.stopPropagation();const n=this.layer.displayState.segmentSelectionState.baseValue;if(void 0===n)return;t.visibleSegments.add(n);const i=this.layer.anchorSegment.value;void 0!==i&&I.Uint64.equal(i,n)||(this.layer.anchorSegment.value=n.clone())}))}get description(){return"split"}}var He=n(8602),qe=n(3234);const Ye="selectSegments",Je="mousedown0",Ke=He.n5.fromObject({["at:alt?+shift?+".concat(Je)]:"drag-select-segments"});var Xe;!function(e){e[e.IDLE=0]="IDLE",e[e.SELECT=1]="SELECT",e[e.DESELECT=2]="DESELECT"}(Xe||(Xe={}));class Ze extends Be.NL{constructor(e){super(e)}toJSON(){return Ye}activate(e){const t=this.layer;var n=(0,Be.L0)(e);const i=n.body,r=n.header;let o=Xe.IDLE,s=!1;e.bindInputEventMap(Ke);const a=()=>2&De.YT.value?Xe.DESELECT:Xe.SELECT,l=e=>{o!==e&&(o=e,s=!1,c())},c=()=>{(0,Pe.gS)(i);const e=document.createElement("span");switch(o){case Xe.IDLE:r.textContent="Select/Deselect segments",e.textContent="".concat(Je," to select segments; alt+").concat(Je," to deselect segments.");break;case Xe.SELECT:case Xe.DESELECT:r.textContent="".concat(o==Xe.SELECT?"Select":"Deselect"," segments"),e.textContent="Drag to ".concat(o==Xe.SELECT?"select":"deselect"," segments (").concat(t.displayState.segmentationGroupState.value.visibleSegments.size," selected).")}i.appendChild(e)};c();const d=()=>{if(o==Xe.IDLE)return;const e=t.displayState.segmentSelectionState;if(e.hasSelectedSegment){const n=e.selectedSegment,i=t.displayState.segmentationGroupState.value.visibleSegments;switch(o){case Xe.SELECT:i.add(n);break;case Xe.DESELECT:i.delete(n)}}};e.registerDisposer(t.displayState.segmentSelectionState.changed.add((()=>{s&&d()}))),e.registerDisposer(t.displayState.segmentationGroupState.value.visibleSegments.changed.add(c)),e.registerDisposer(De.YT.changed.add((()=>{o!=Xe.IDLE&&l(a())})));e.bindAction("drag-select-segments",(e=>((e,t)=>{e.stopPropagation(),l(t),d();const n=e.detail.screenX,i=e.detail.screenY;(0,qe.i)(e.detail,((e,t,r)=>{if(!s){const t=e.screenX-n,r=e.screenY-i;t*t+r*r>25&&(d(),s=!0)}}),(e=>{s=!1,l(Xe.IDLE)}))})(e,a())))}get description(){return"select"}}const Qe=new I.Uint64;class $e extends Le.O8{constructor(e,t,n,i){super(),this.query=e,this.segmentPropertyMap=t,this.segmentationDisplayState=n,this.parentElement=i,this.changed=new G.HN,this.explicitSegmentsVisible=!1,this.visibleSegmentsGeneration=-1,this.queryResult=new M.B0(void 0),this.statusText=new M.B0(""),this.selectedMatches=0,this.matchStatusTextPrefix="",this.debouncedUpdate=S()((()=>this.update()),0),this.render=e=>{const t=this.explicitSegments;let n,i=!1;if(void 0!==t&&e<t.length)n=t[e],i=this.explicitSegmentsVisible;else{void 0!==t&&(e-=t.length),n=Qe;const i=this.queryResult.value.indices[e],r=this.segmentPropertyMap.segmentPropertyMap.inlineProperties.ids;n.low=r[2*i],n.high=r[2*i+1]}const r=this.segmentWidgetFactory.get(n);return i&&(r.dataset.visibleList="true"),r},this.update(),this.registerDisposer(n.segmentationGroupState.value.visibleSegments.changed.add(this.debouncedUpdate)),this.registerDisposer(e.changed.add(this.debouncedUpdate))}get numMatches(){var e,t;return null!==(t=null===(e=this.queryResult.value)||void 0===e?void 0:e.count)&&void 0!==t?t:0}update(){var e;const t=this.query.value,n=this.segmentPropertyMap,i=this.queryResult.value;let r;if(this.prevQuery===t)r=i;else{const e=(0,m.HK)(n,t);r=(0,m.Zp)(n,e)}const o=[];let s=!1,a="";const l=this.segmentationDisplayState.segmentationGroupState.value.visibleSegments,c=l.changed.count,d=this.visibleSegmentsGeneration,u=(0,m.YR)(r.query);if(u){if(d===c&&void 0!==this.explicitSegments&&this.explicitSegmentsVisible)o.push({retainCount:this.explicitSegments.length,deleteCount:0,insertCount:0});else{this.visibleSegmentsGeneration=c;const e=Se()(l,(e=>e.clone()));e.sort(I.Uint64.compare);const t=this.explicitSegments;void 0===t?(this.explicitSegments=e,o.push({retainCount:0,insertCount:e.length,deleteCount:0})):o.push(...(0,Ee.q9)(t,e,I.Uint64.compare)),this.explicitSegments=e,s=!0}this.explicitSegmentsVisible=!0}else this.visibleSegmentsGeneration=c,void 0!==this.explicitSegments&&this.explicitSegmentsVisible&&(o.push({deleteCount:this.explicitSegments.length,retainCount:0,insertCount:0}),this.explicitSegments=void 0,s=!0),this.explicitSegmentsVisible=!1;const h=r.explicitIds;if(void 0!==h?this.explicitSegments=h:this.explicitSegmentsVisible||(this.explicitSegments=void 0),i!==r&&(o.push({retainCount:0,deleteCount:null!==(e=null===i||void 0===i?void 0:i.count)&&void 0!==e?e:0,insertCount:r.count}),s=!0,this.queryResult.value=r),void 0!==r.explicitIds?a="".concat(r.count," ids"):u?a="".concat(r.count," listed ids"):r.total>0&&(a="".concat(r.count,"/").concat(r.total," matches")),i!==r||c!==d){let e=a,t=0;void 0!==n&&r.count>0&&(t=(0,m.DU)(n,r,l),e+=" (".concat(t," visible)")),this.selectedMatches=t,this.statusText.value=e}this.prevQuery=t,this.matchStatusTextPrefix=a;const p=this.explicitSegments;this.length=(this.explicitSegmentsVisible?p.length:0)+r.count,s&&this.changed.dispatch(o)}updateRendering(e){this.segmentWidgetFactory.update(e)}updateRenderedItems(e){e.forEachRenderedItem((e=>{this.updateRendering(e)}))}}const et=De.n5.fromObject({enter:{action:"toggle-listed"},"shift+enter":{action:"hide-listed"},"control+enter":{action:"hide-all"},escape:{action:"cancel"}});function tt(e){(0,Pe.qi)(e,Math.max(1,e.value.length+.1))}function nt(e,t){let n;if(ye()(t))n=t.toString();else{const e=t.toString(),i=t.toPrecision(6);n=e.length<i.length?e:i}e.value=n,tt(e)}function it(e,t,n){var i;const r=null===e||void 0===e?void 0:e.query,o=null===r||void 0===r?void 0:r.sortBy;if(void 0===o)return;const a=r.includeColumns,l="<"===(null===(i=o.find((e=>e.fieldId===n)))||void 0===i?void 0:i.order)?">":"<",c=a.filter((e=>e!==n));for(const s of o)"id"!==s.fieldId&&"label"!==s.fieldId&&s.fieldId!==n&&c.push(s.fieldId);t(s()(s()({},r),{sortBy:[{fieldId:n,order:l}],includeColumns:c}))}function rt(e,t,n){var i,r;const o=null===(i=null===e||void 0===e?void 0:e.query)||void 0===i?void 0:i.sortBy,s=null===(r=null===o||void 0===o?void 0:o.find((e=>e.fieldId===n)))||void 0===r?void 0:r.order;t.textContent=">"===s?"\u25bc":"\u25b2",t.style.visibility=void 0===s?"":"visible",t.title="Sort by ".concat(n," in ").concat("<"===s?"descending":"ascending"," order")}class ot extends Le.O8{constructor(e,t,n){super(),this.segmentPropertyMap=e,this.queryResult=t,this.setQuery=n,this.propertyHistograms=[],this.bounds={window:new M.B0([]),range:new M.B0([])},this.throttledUpdate=this.registerCancellable(xe()((()=>this.updateHistograms()),100)),this.debouncedRender=this.registerCancellable((0,ke.t)((()=>this.updateHistogramRenderings()))),this.debouncedSetQuery=this.registerCancellable(S()((()=>this.setQueryFromBounds()),200));const i=null===e||void 0===e?void 0:e.numericalProperties,r=[];let o;if(void 0!==i&&i.length>0){o=document.createElement("details");const e=document.createElement("summary");e.textContent="".concat(i.length," numerical propert").concat(i.length>1?"ies":"y"),o.appendChild(e),o.classList.add("neuroglancer-segment-query-result-numerical-list");const t=this.bounds.window.value;for(let n=0,s=i.length;n<s;++n){const e=i[n],s=this.makeNumericalPropertySummary(n,e);r.push(s),o.appendChild(s.element),t[n]=e.bounds}}this.listElement=o,this.properties=r,this.registerDisposer(this.queryResult.changed.add((()=>{this.handleNewQueryResult()}))),this.registerDisposer(this.bounds.window.changed.add(this.throttledUpdate)),this.registerDisposer(this.bounds.window.changed.add(this.debouncedRender)),this.registerDisposer(this.bounds.range.changed.add(this.debouncedRender)),this.registerDisposer(this.bounds.range.changed.add(this.debouncedSetQuery)),this.handleNewQueryResult()}setQueryFromBounds(){const e=this.queryResult.value;if(void 0===e)return;if(void 0===e.indices)return;const t=e.query,n=[],i=this.bounds.range.value,r=this.properties;for(let o=0,s=r.length;o<s;++o){const e=r[o].property;n.push({fieldId:e.id,bounds:i[o]})}this.setQuery(s()(s()({},t),{numericalConstraints:n}))}getBounds(e){const t=this.bounds;return{range:t.range.value[e],window:t.window.value[e]}}setBounds(e,t){const n=this.properties[e].property;let i=(0,_e.M_)(n.bounds,t.range);(0,_e.Os)(i[0],i[1])>0&&(i=[i[1],i[0]]);const r=(0,_e.M_)(n.bounds,t.window),o=this.getBounds(e),s=this.properties[e].property.dataType;(0,_e.gt)(s,r,o.window)||(this.bounds.window.value[e]=r,this.bounds.window.changed.dispatch()),(0,_e.gt)(s,i,o.range)||(this.bounds.range.value[e]=i,this.bounds.range.changed.dispatch())}setBound(e,t,n,i){const r=this.segmentPropertyMap.numericalProperties[n].bounds;i=(0,_e.Md)(r,i);const o=this.getBounds(n),s=(0,Ve.sB)(o,e,t,i,!0);this.setBounds(n,s)}handleNewQueryResult(){const e=this.queryResult.value;if(void 0!==this.listElement){if(void 0!==(null===e||void 0===e?void 0:e.indices)){const t=e.query.numericalConstraints,n=this.segmentPropertyMap.numericalProperties,i=this.bounds.range.value,r=t.length,o=n.length;i.length=o;for(let e=0;e<o;++e)i[e]=n[e].bounds;for(let e=0;e<r;++e){const r=t[e];i[n.findIndex((e=>e.id===r.fieldId))]=r.bounds}}this.updateHistograms(),this.throttledUpdate.cancel()}}updateHistograms(){const e=this.queryResult.value;void 0!==this.listElement&&((0,m.wA)(this.segmentPropertyMap,e,this.propertyHistograms,this.bounds.window.value),this.updateHistogramRenderings())}updateHistogramRenderings(){this.debouncedRender.cancel();const e=this.listElement;if(void 0===e)return;const t=this.propertyHistograms;if(0===t.length)return void(e.style.display="none");e.style.display="";const n=this.properties;for(let i=0,r=n.length;i<r;++i)this.updateNumericalPropertySummary(i,n[i],t[i])}makeNumericalPropertySummary(e,t){const n=document.createElement("div");n.classList.add("neuroglancer-segment-query-result-numerical-plot-container");const i=document.createElement("img");i.classList.add("neuroglancer-segment-query-result-numerical-plot");const r=new Ve.kh(i,t.dataType,(()=>this.getBounds(e)),(t=>this.setBounds(e,t))),o=document.createElement("span");o.classList.add("neuroglancer-segment-query-result-numerical-plot-sort");const a=document.createElement("input");a.type="checkbox",a.addEventListener("click",(()=>{!function(e,t,n){if(void 0===e)return;if(void 0===e.indices)return;const i=e.query;let r=i.sortBy,o=i.includeColumns;(0,m.iA)(i,n)?(r=r.filter((e=>e.fieldId!==n)),o=o.filter((e=>e!==n))):o.push(n),t(s()(s()({},i),{sortBy:r,includeColumns:o}))}(this.queryResult.value,this.setQuery,t.id)}));const l=n=>{const i=document.createElement("div");i.classList.add("neuroglancer-segment-query-result-numerical-plot-bounds"),i.classList.add("neuroglancer-segment-query-result-numerical-plot-bounds-".concat(n));const r=i=>{const r=function(e,t){const n=document.createElement("input");return n.addEventListener("focus",(()=>{n.select()})),n.classList.add("neuroglancer-segment-query-result-numerical-plot-".concat(e,"-bound")),n.classList.add("neuroglancer-segment-query-result-numerical-plot-bound"),n.type="text",n.spellcheck=!1,n.autocomplete="off",n.title=(0===t?"Lower":"Upper")+" bound "+("range"===e?"range":"for distribution"),n.addEventListener("input",(()=>{tt(n)})),n}(n,i);return r.addEventListener("change",(()=>{if(void 0!==this.bounds[n].value[e]){try{const o=(0,_e.DZ)(t.dataType,r.value);this.setBound(n,i,e,o),this.bounds[n].changed.dispatch()}catch(o){}nt(r,this.bounds[n].value[e][i])}})),r},s=[r(0),r(1)];let l;if("range"===n){l=[document.createElement("div"),document.createElement("div"),document.createElement("div")],l[1].classList.add("neuroglancer-segment-query-result-numerical-plot-bound-constraint-spacer"),l[1].appendChild(a);const e=document.createElement("span");e.classList.add("neuroglancer-segment-query-result-numerical-plot-label"),e.appendChild(document.createTextNode(t.id)),e.appendChild(o),e.addEventListener("click",(()=>{it(this.queryResult.value,this.setQuery,t.id)})),l[1].appendChild(e);const n=t.description;n&&(l[1].title=n),i.appendChild(l[0]),i.appendChild(s[0]);const r=document.createElement("div");r.textContent="\u2264",r.classList.add("neuroglancer-segment-query-result-numerical-plot-bound-constraint-symbol"),i.appendChild(r),i.appendChild(l[1]);const c=document.createElement("div");c.textContent="\u2264",c.classList.add("neuroglancer-segment-query-result-numerical-plot-bound-constraint-symbol"),i.appendChild(c),i.appendChild(s[1]),i.appendChild(l[2])}else i.appendChild(s[0]),i.appendChild(s[1]);return{container:i,spacers:l,inputs:s}},c={range:l("range"),window:l("window")};return n.appendChild(c.range.container),n.appendChild(i),n.appendChild(c.window.container),{property:t,controller:r,element:n,plotImg:i,boundElements:c,bounds:{window:[NaN,NaN],range:[NaN,NaN]},propertyHistogram:void 0,columnCheckbox:a,sortIcon:o}}updateNumericalPropertySummary(e,t,n){const i=t.bounds.window,r=this.bounds.window.value[e],o=t.bounds.range,s=this.bounds.range.value[e],a=t.property,l=this.queryResult.value,c=(0,m.iA)(null===l||void 0===l?void 0:l.query,a.id);if(t.columnCheckbox.checked=c,t.columnCheckbox.title=c?"Remove column from result table":"Add column to result table",rt(l,t.sortIcon,a.id),t.propertyHistogram===n&&(0,_e.gt)(a.dataType,i,r)&&(0,_e.gt)(a.dataType,o,s))return;const d=n.histogram,u="http://www.w3.org/2000/svg",h=document.createElementNS(u,"svg");h.setAttribute("width","1"),h.setAttribute("height","1"),h.setAttribute("preserveAspectRatio","none");const p=document.createElementNS(u,"rect"),f=(0,_e._)(r,s[0]),g=(0,_e._)(r,s[1]);p.setAttribute("x","".concat(f)),p.setAttribute("y","0"),p.setAttribute("width","".concat(g-f)),p.setAttribute("height","1"),p.setAttribute("fill","#4f4f4f"),h.appendChild(p);const v=d.length,y=(e,t,i)=>{const o=document.createElementNS(u,"polyline");let s="",a=0;for(let n=e;n<i;++n)a+=d[n];if(0===a)return;const l=(0,_e._)(r,n.window[0]),c=(0,_e._)(r,n.window[1]),h=(e,t)=>{const n=e/(v-2);s+=" ".concat(l*(1-n)+c*n,",").concat(1-t)};0!==e&&h(e,0);let p=0;for(let n=e;n<t;++n){p+=d[n],h(n,p/a)}return o.setAttribute("fill","none"),o.setAttribute("stroke-width","1px"),o.setAttribute("points",s),o.setAttribute("vector-effect","non-scaling-stroke"),o};{const e=y(0,v-1,v);void 0!==e&&(e.setAttribute("stroke","cyan"),h.appendChild(e))}if(!(0,_e.gt)(a.dataType,a.bounds,s)){const e=Math.floor(Math.max(0,Math.min(1,(0,_e._)(n.window,s[0])))*(v-2)),t=Math.ceil(Math.max(0,Math.min(1,(0,_e._)(n.window,s[1])))*(v-2)),i=y(e,t,t);void 0!==i&&(i.setAttribute("stroke","white"),h.appendChild(i))}const b=(new XMLSerializer).serializeToString(h);t.plotImg.src="data:image/svg+xml;base64,".concat(btoa(b)),t.propertyHistogram=n;for(let m=0;m<2;++m)i[m]=r[m],nt(t.boundElements.window.inputs[m],r[m]),o[m]=s[m],nt(t.boundElements.range.inputs[m],s[m]);const S=t.boundElements.range.spacers,w=(0,_e.M_)(r,s),x=(0,_e.Ct)(a.dataType,r),C=(0,_e._)(r,w[0])*x,k=(0,_e._)(r,w[1])*x+(1-x);S[0].style.width="".concat(100*C,"%"),S[2].style.width="".concat(100*(1-k),"%")}}class st extends Oe.oz{constructor(e){super(),this.layer=e;const t=this.element;t.classList.add("neuroglancer-segment-display-tab"),t.appendChild(this.registerDisposer(new Ae.p(e.displayState.segmentationGroupState.value.graph,((t,n,i)=>{if(void 0===t)return;const r=document.createElement("div");r.className="neuroglancer-segmentation-toolbox",r.appendChild((0,Be.JU)(i,e,{toolJson:Fe,label:"Merge",title:"Merge segments"})),r.appendChild((0,Be.JU)(i,e,{toolJson:Ue,label:"Split",title:"Split segments"})),n.appendChild(r)}))).element);const n=document.createElement("div");n.className="neuroglancer-segmentation-toolbox",n.appendChild((0,Be.JU)(this,e,{toolJson:Ye,label:"Select",title:"Select/Deselect segments"})),t.appendChild(n);const i=document.createElement("input");i.classList.add("neuroglancer-segment-list-query"),i.addEventListener("focus",(()=>{i.select()}));this.registerDisposer(new De.cL(i,et)).allShortcutsAreGlobal=!0;const r=this.layer.displayState.segmentQuery,o=this.registerCancellable(S()((()=>{r.value=i.value}),200));i.autocomplete="off",i.title=et.describe(),i.spellcheck=!1,i.placeholder="Enter ID, name prefix or /regexp",this.registerDisposer((0,M.W1)((e=>{i.value=e}),r)),this.registerDisposer((0,M.W1)((e=>{Date.now()-e<100&&(setTimeout((()=>{i.focus()}),0),this.layer.segmentQueryFocusTime.value=Number.NEGATIVE_INFINITY)}),this.layer.segmentQueryFocusTime)),t.appendChild(i),t.appendChild(this.registerDisposer(new Ae.p(e.displayState.segmentPropertyMap,((t,n,s)=>{const a=e=>{i.focus(),i.select();const n=(0,m.E0)(t,e);document.execCommand("insertText",!1,n),r.value=n,i.select()},l=s.registerDisposer(new $e(r,t,e.displayState,n)),c=e.displayState.segmentationGroupState.value,d=document.createElement("ul");d.classList.add("neuroglancer-segment-query-errors"),n.appendChild(d);const u=document.createElement("div");u.classList.add("neuroglancer-segment-query-result-statistics");const h=document.createElement("span"),p=document.createElement("input");p.type="checkbox",p.checked=!0,p.title="Deselect all segment IDs",p.addEventListener("change",(()=>{c.visibleSegments.clear()}));const f=(0,Re.C)({title:"Copy visible segment IDs",onClick:()=>{const e=Se()(c.visibleSegments,(e=>e.clone()));e.sort(I.Uint64.compare),(0,Te.B)(e.join(", "))}}),v=document.createElement("span");h.appendChild(f),h.appendChild(p),h.appendChild(v);const y=document.createElement("span"),b=document.createElement("input"),S=(0,Re.C)({onClick:()=>{o(),o.flush(),l.debouncedUpdate.flush();const e=l.queryResult.value;if(void 0===e)return;const n=new Array(e.count);(0,m.e7)(t,e,((e,t)=>{n[t]=e.toString()})),(0,Te.B)(n.join(", "))}});b.type="checkbox";const w=()=>{o(),o.flush(),l.debouncedUpdate.flush();const e=l.queryResult.value;if(void 0===e)return;const n=c.visibleSegments,i=l.selectedMatches,r=i!==e.count;if(r&&e.count-i>100){if(!T)return T=!0,x.textContent="Confirm: show ".concat(e.count-i," segments?"),!1;T=!1,E()}return(0,m.e7)(t,e,(e=>{n.set(e,r)})),!0};b.addEventListener("click",(e=>{w()||e.preventDefault()}));const x=document.createElement("span");y.appendChild(S),y.appendChild(b),y.appendChild(x),h.classList.add("neuroglancer-segment-list-status"),y.classList.add("neuroglancer-segment-list-status"),n.appendChild(u);const C=document.createElement("div");C.classList.add("neuroglancer-segment-query-result-statistics-separator"),n.appendChild(C),n.appendChild(y),n.appendChild(h);let k=-1;const E=()=>{const e=c.visibleSegments.size;k!==e&&(k=e,v.textContent="".concat(e," visible in total"),p.checked=e>0,p.style.visibility=e?"visible":"hidden",f.style.visibility=e?"visible":"hidden"),x.textContent=l.statusText.value;const t=l.numMatches,n=l.selectedMatches;S.style.visibility=t?"visible":"hidden",S.title="Copy ".concat(t," segment ID(s)"),b.style.visibility=t?"visible":"hidden",0===n?(b.checked=!1,b.indeterminate=!1,b.title="Show ".concat(t," segment ID(s)")):n===t?(b.checked=!0,b.indeterminate=!1,b.title="Hide ".concat(n," segment ID(s)")):(b.checked=!0,b.indeterminate=!0,b.title="Show ".concat(t-n," segment ID(s)"))};E(),l.statusText.changed.add(E),s.registerDisposer(c.visibleSegments.changed.add(E));let T=!1;s.registerEventListener(i,"input",(()=>{o(),T&&(T=!1,E())})),s.registerDisposer((0,De.qZ)(i,"cancel",(()=>{i.focus(),i.select(),document.execCommand("delete"),i.blur(),i.value="",r.value="",T=!1,E()}))),s.registerDisposer((0,De.qZ)(i,"toggle-listed",w)),s.registerDisposer((0,De.qZ)(i,"hide-all",(()=>{c.visibleSegments.clear()}))),s.registerDisposer((0,De.qZ)(i,"hide-listed",(()=>{o(),o.flush(),l.debouncedUpdate.flush();const e=c.visibleSegments;if(""===r.value)e.clear();else{const n=l.queryResult.value;if(void 0===n)return;(0,m.e7)(t,n,(t=>{e.delete(t)}))}})));const L=s.registerDisposer(new Ne.w({source:l,horizontalScroll:!0})),P=s.registerCancellable((0,ke.t)((()=>{l.updateRenderedItems(L)}))),D=this.layer.displayState;s.registerDisposer(D.segmentSelectionState.changed.add(P)),s.registerDisposer(c.visibleSegments.changed.add(P)),s.registerDisposer(D.segmentColorHash.changed.add(P)),s.registerDisposer(D.segmentStatedColors.changed.add(P)),s.registerDisposer(D.segmentDefaultColor.changed.add(P)),L.element.classList.add("neuroglancer-segment-list"),s.registerDisposer(e.bindSegmentListWidth(L.element)),s.registerDisposer(new Me.qy(L.element,(0,Ce.o6)()));const R=s.registerDisposer(new ot(t,l.queryResult,a));{const e=R.listElement;void 0!==e&&u.appendChild(e)}let A;(0,M.W1)((e=>{if(l.segmentWidgetFactory=new g.SegmentWidgetWithExtraColumnsFactory(l.segmentationDisplayState,l.parentElement,(t=>(0,m.iA)(null===e||void 0===e?void 0:e.query,t.id))),L.scrollToTop(),(0,Pe.gS)(L.header),void 0!==t){const t=l.segmentWidgetFactory.getHeader();t.container.classList.add("neuroglancer-segment-list-header");for(const n of t.propertyLabels){const t=n.label,i=n.sortIcon,r=n.id;t.addEventListener("click",(()=>{it(l.queryResult.value,a,r)})),rt(e,i,r)}L.header.appendChild(t.container)}if((e=>{const t=null===e||void 0===e?void 0:e.errors;if((0,Pe.gS)(d),void 0!==t)for(const n of t){const e=document.createElement("li");e.textContent=n.message,d.appendChild(e)}})(e),C.style.display="none",null===A||void 0===A||A.remove(),void 0===e)return;let n=e.query;void 0===n.errors&&void 0===n.ids&&(A=function(e,t){const n=e.tags;if(void 0===n||0===n.length)return;const i=e.query,r=document.createElement("div");r.classList.add("neuroglancer-segment-query-result-tag-list");for(const o of n){const n=o.tag,s=o.count,a=document.createElement("div");a.classList.add("neuroglancer-segment-query-result-tag");const l=document.createElement("span");l.classList.add("neuroglancer-segment-query-result-tag-name"),l.textContent=n,r.appendChild(a);const c=i.includeTags.includes(n),d=i.excludeTags.includes(n);let u;u=c?"Remove tag from required set":d?"Remove tag from excluded set":"Add tag to required set",l.addEventListener("click",(()=>{t((0,m.mS)(i,n,!0,!c&&!d))})),l.title=u;const h=c||d,p=r=>{const o=r?s:e.count-s,l=document.createElement("div");if(l.classList.add("neuroglancer-segment-query-result-tag-toggle"),l.classList.add("neuroglancer-segment-query-result-tag-".concat(r?"include":"exclude")),a.appendChild(l),!h&&0===o)return;const u=r?c:d;l.appendChild(new Ie.R({get value(){return u},set value(e){t((0,m.mS)(i,n,r,e))},changed:G.$$},{text:r?"+":"-",enableTitle:"Add tag to ".concat(r?"required":"exclusion"," set"),disableTitle:"Remove tag from ".concat(r?"required":"exclusion"," set"),backgroundScheme:"dark"}).element)};p(!0),p(!1),a.appendChild(l);const f=document.createElement("span");f.classList.add("neuroglancer-segment-query-result-tag-count"),h||(f.textContent=s.toString()),a.appendChild(f)}return r}(e,a),void 0!==A&&u.appendChild(A),(R.properties.length>0||void 0!==A)&&(C.style.display=""))}),l.queryResult),n.appendChild(L.element)}))).element)}}var at=n(7445),lt=n(154),ct=n(8093),dt=n(3141);class ut extends Le.O8{constructor(e){super(),this.group=e,this.element=document.createElement("div"),this.topRow=document.createElement("div"),this.label=document.createElement("label"),this.selectElement=document.createElement("select"),this.linkedLayers=document.createElement("div"),this.unlinkButton=document.createElement("button");const t=this.element,n=this.label,i=this.topRow,r=this.selectElement,o=this.linkedLayers,s=this.unlinkButton;i.appendChild(n),i.appendChild(r),i.appendChild(s),s.textContent="Unlink",s.addEventListener("click",(()=>{this.group.isolate()})),t.appendChild(i),t.appendChild(o),this.updateView();const a=S()((()=>this.updateView()),0);this.registerEventListener(r,"change",(()=>{this.updateModel(),a()})),this.registerDisposer(this.group.changed.add(a)),this.registerDisposer(this.group.linkedLayersChanged.add(a)),this.registerDisposer(this.group.layerManager.layersChanged.add(a))}updateModel(){const e=this.selectElement.value;""===e&&this.group.root.value!==this.group.layer?this.group.isolate():this.group.linkByName(e)}updateView(){var e;const t=this.selectElement,n=this.group,i=n.predicate;(0,Pe.gS)(t);const r=0!==this.group.rootGroup.linkedLayers.size;this.unlinkButton.style.display=r?"":"none";const o=this.linkedLayers,s=0!==n.linkedLayers.size;if(o.style.display=s?"":"none",this.unlinkButton.textContent=s?"Unlink all":"Unlink",s){this.element.style.display="",t.style.display="none",(0,Pe.gS)(o);for(const e of n.linkedLayers){const t=document.createElement("div");t.classList.add("neuroglancer-linked-layer-widget-layer");const n=(0,dt.j)({title:"Unlink layer",onClick:()=>{this.group.getGroup(e).isolate()}});t.appendChild(n),t.appendChild(document.createTextNode(e.managedLayer.name)),o.appendChild(t)}}else{t.style.display="";const r=document.createElement("option");t.appendChild(r);let o=0;for(const e of this.group.layerManager.managedLayers){const r=e.layer;if(null!==r&&(r!==n.layer&&i(r))){++o;const n=document.createElement("option"),i=e.name;n.textContent=i,n.value=i,t.appendChild(n)}}t.value=null!==(e=n.toJSON())&&void 0!==e?e:"",this.element.style.display=0===o?"none":""}}}var ht=n(1821),pt=n(628),ft=n(4791);function gt(e){return new pt.h({fragmentMain:e.displayState.skeletonRenderingOptions.shader,shaderError:e.displayState.shaderError,shaderControlState:e.displayState.skeletonRenderingOptions.shaderControlState})}class mt extends Oe.oz{constructor(e){super(),this.layer=e;const t=this.element;t.classList.add("neuroglancer-segmentation-rendering-tab");{const n=this.registerDisposer(new ut(e.displayState.linkedSegmentationGroup));n.label.textContent="Linked to: ",t.appendChild(n.element)}{const n=this.registerDisposer(new ut(e.displayState.linkedSegmentationColorGroup));n.label.textContent="Colors linked to: ",t.appendChild(n.element)}for(const i of hn)t.appendChild((0,ct.KZ)(this,e,this.visibility,i));const n=this.registerDisposer(new Ae.p(e.hasSkeletonsLayer,((t,n,i)=>{if(!t)return;let r=document.createElement("div");r.className="neuroglancer-segmentation-dropdown-skeleton-shader-header";let o=document.createElement("div");o.style.flex="1",o.textContent="Skeleton shader:",r.appendChild(o),r.appendChild((0,ht.F)({title:"Show larger editor view",onClick:()=>{new vt(this.layer)}})),r.appendChild((0,lt.G)({title:"Documentation on skeleton rendering",href:"https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md"})),n.appendChild(r);const s=i.registerDisposer(gt(this.layer));n.appendChild(s.element),n.appendChild(i.registerDisposer(new ft.SJ(e.displayState.skeletonRenderingOptions.shaderControlState,this.layer.manager.root.display,this.layer,{visibility:this.visibility,toolId:rn})).element),s.textEditor.refresh()}),this.visibility));t.appendChild(n.element)}}class vt extends at.hJ{constructor(e){super(),this.layer=e,this.codeWidget=this.registerDisposer(gt(this.layer)),this.content.classList.add("neuroglancer-segmentation-layer-skeleton-shader-overlay"),this.content.appendChild(this.codeWidget.element),this.codeWidget.textEditor.refresh()}}var yt,bt=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=E()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&C()(t,n,s),s};let St=yt=class extends W.IN{constructor(){super(...arguments),this.hashTable=new ae.Tg,this.changed=new G.HN}get value(){return this}static makeWithCounterpart(e){let t=new yt;return t.initializeCounterpart(e),t}set_(e,t){return this.hashTable.set(e,t)}set(e,t){if(this.set_(e,t)){let n=this.rpc;n&&n.invoke("Uint64Map.set",{id:this.rpcId,key:e,value:t}),this.changed.dispatch(e,!0)}}has(e){return this.hashTable.has(e)}get(e,t){return this.hashTable.get(e,t)}[L()](){return this.hashTable.entries()}unsafeEntries(){return this.hashTable.unsafeEntries()}delete_(e){return this.hashTable.delete(e)}delete(e){if(this.delete_(e)){let t=this.rpc;t&&t.invoke("Uint64Map.delete",{id:this.rpcId,key:e}),this.changed.dispatch(e,!1)}}get size(){return this.hashTable.size}assignFrom(e){this.clear();for(const n of e.unsafeEntries()){var t=(0,a.A)(n,2);const e=t[0],i=t[1];this.set(e,i)}}clear(){if(this.hashTable.clear()){let e=this.rpc;e&&e.invoke("Uint64Map.clear",{id:this.rpcId}),this.changed.dispatch(null,!1)}}toJSON(){let e={};for(let n of this.hashTable.unsafeEntries()){var t=(0,a.A)(n,2);let i=t[0],r=t[1];e[i.toString()]=r.toString()}return e}};St=yt=bt([(0,W.eZ)("Uint64Map")],St),(0,W.ks)("Uint64Map.set",(function(e){let t=this.get(e.id);t.set_(e.key,e.value)&&t.changed.dispatch()})),(0,W.ks)("Uint64Map.delete",(function(e){let t=this.get(e.id);t.delete_(e.key)&&t.changed.dispatch()})),(0,W.ks)("Uint64Map.clear",(function(e){let t=this.get(e.id);t.hashTable.clear()&&t.changed.dispatch()}));var wt,xt=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=E()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&C()(t,n,s),s};let Ct=wt=class extends W.IN{constructor(){super(...arguments),this.hashTable=new ae.LN,this.changed=new G.HN}get value(){return this}static makeWithCounterpart(e){let t=new wt;return t.initializeCounterpart(e),t}set(e,t){t?this.add(e):this.delete(e)}reserve_(e){return this.hashTable.reserve(e)}reserve(e){if(this.reserve_(e)){let t=this.rpc;t&&t.invoke("Uint64Set.reserve",{id:this.rpcId,value:e})}}add_(e){let t=!1;for(const n of e)t=this.hashTable.add(n)||t;return t}add(e){const t=Array().concat(e);if(this.add_(t)){let n=this.rpc;n&&n.invoke("Uint64Set.add",{id:this.rpcId,value:t}),this.changed.dispatch(e,!0)}}has(e){return this.hashTable.has(e)}[L()](){return this.hashTable.keys()}unsafeKeys(){return this.hashTable.unsafeKeys()}delete_(e){let t=!1;for(const n of e)t=this.hashTable.delete(n)||t;return t}delete(e){const t=Array().concat(e);if(this.delete_(Array().concat(e))){let n=this.rpc;n&&n.invoke("Uint64Set.delete",{id:this.rpcId,value:t}),this.changed.dispatch(e,!1)}}get size(){return this.hashTable.size}clear(){if(this.hashTable.clear()){let e=this.rpc;e&&e.invoke("Uint64Set.clear",{id:this.rpcId}),this.changed.dispatch(null,!1)}}toJSON(){let e=new Array;for(let t of this.unsafeKeys())e.push(t.toString());return e.sort(),e}assignFrom(e){this.clear();for(const t of e.unsafeKeys())this.add(t)}};Ct=wt=xt([(0,W.eZ)("Uint64Set")],Ct),(0,W.ks)("Uint64Set.reserve",(function(e){let t=this.get(e.id);t.reserve_(e.value)&&t.changed.dispatch()})),(0,W.ks)("Uint64Set.add",(function(e){let t=this.get(e.id);t.add_(e.value)&&t.changed.dispatch()})),(0,W.ks)("Uint64Set.delete",(function(e){let t=this.get(e.id);t.delete_(e.value)&&t.changed.dispatch()})),(0,W.ks)("Uint64Set.clear",(function(e){let t=this.get(e.id);t.hashTable.clear()&&t.changed.dispatch()}));var kt=n(2303),Et=n(9080),Tt=n(441),Lt=n(5041),Pt=n(217),Dt=n(551),Mt=n(7053),It=n.n(Mt),Rt=n(3835),At=n(1301),Ot=n(3625),Nt=n(4492);function _t(e,t){e.displayState.segmentDefaultColor.value=t?Rt.eR.fromValues(1,0,0):void 0}const Vt="selectedAlpha",Bt="notSelectedAlpha",Ft="objectAlpha",Ut="saturation",zt="hideSegmentZero",jt="baseSegmentColoring",Gt="ignoreNullVisibleSet",Wt="segments",Ht="equivalences",qt="colorSeed",Yt="segmentColors",Jt="meshRenderScale",Kt="crossSectionRenderScale",Xt="skeletonRendering",Zt="segmentQuery",Qt="meshSilhouetteRendering",$t="linkedSegmentationGroup",en="linkedSegmentationColorGroup",tn="segmentDefaultColor",nn="anchorSegment",rn="skeletonShaderControl";class on extends Le.O8{constructor(e){super(),this.layer=e,this.specificationChanged=new G.HN,this.localGraph=new ee,this.visibleSegments=this.registerDisposer(Ct.makeWithCounterpart(this.layer.manager.rpc)),this.segmentPropertyMap=new M.B0(void 0),this.graph=new M.B0(void 0),this.segmentEquivalences=this.registerDisposer(X.makeWithCounterpart(this.layer.manager.rpc,this.layer.registerDisposer((0,M.Uq)((e=>e&&e.visibleSegmentEquivalencePolicy||w.y6.MIN_REPRESENTATIVE),[this.graph])))),this.localSegmentEquivalences=!1,this.maxIdLength=new M.B0(1),this.hideSegmentZero=new ge.C_(!0,!0),this.segmentQuery=new M.DN("",j.verifyString),this.temporaryVisibleSegments=this.layer.registerDisposer(Ct.makeWithCounterpart(this.layer.manager.rpc)),this.temporarySegmentEquivalences=this.layer.registerDisposer(X.makeWithCounterpart(this.layer.manager.rpc,this.segmentEquivalences.disjointSets.visibleSegmentEquivalencePolicy)),this.useTemporaryVisibleSegments=this.layer.registerDisposer(ie.a.make(this.layer.manager.rpc,!1)),this.useTemporarySegmentEquivalences=this.layer.registerDisposer(ie.a.make(this.layer.manager.rpc,!1));const t=this.specificationChanged;this.visibleSegments.changed.add(t.dispatch),this.hideSegmentZero.changed.add(t.dispatch),this.segmentQuery.changed.add(t.dispatch)}restoreState(e){(0,j.verifyOptionalObjectProperty)(e,zt,(e=>this.hideSegmentZero.restoreState(e))),(0,j.verifyOptionalObjectProperty)(e,Ht,(e=>{this.localGraph.restoreState(e)})),(0,j.verifyOptionalObjectProperty)(e,Wt,(e=>{const t=this.segmentEquivalences,n=this.visibleSegments;(0,j.parseArray)(e,(e=>{let i=I.Uint64.parseString(String(e),10);n.add(t.get(i))}))})),(0,j.verifyOptionalObjectProperty)(e,Zt,(e=>this.segmentQuery.restoreState(e)))}toJSON(){const e={};e[zt]=this.hideSegmentZero.toJSON();let t=this.visibleSegments;t.size>0&&(e[Wt]=t.toJSON());let n=this.segmentEquivalences;return this.localSegmentEquivalences&&n.size>0&&(e[Ht]=n.toJSON()),e[Zt]=this.segmentQuery.toJSON(),e}assignFrom(e){this.maxIdLength.value=e.maxIdLength.value,this.hideSegmentZero.value=e.hideSegmentZero.value,this.visibleSegments.assignFrom(e.visibleSegments),this.segmentEquivalences.assignFrom(e.segmentEquivalences)}}class sn extends Le.O8{constructor(e){super(),this.layer=e,this.specificationChanged=new G.HN,this.segmentColorHash=f.lo.getDefault(),this.segmentStatedColors=this.registerDisposer(new St),this.segmentDefaultColor=new kt.TrackableOptionalRGB;const t=this.specificationChanged;this.segmentColorHash.changed.add(t.dispatch),this.segmentStatedColors.changed.add(t.dispatch),this.segmentDefaultColor.changed.add(t.dispatch)}restoreState(e){(0,j.verifyOptionalObjectProperty)(e,qt,(e=>this.segmentColorHash.restoreState(e))),(0,j.verifyOptionalObjectProperty)(e,tn,(e=>this.segmentDefaultColor.restoreState(e))),(0,j.verifyOptionalObjectProperty)(e,Yt,(e=>{let t=(0,j.verifyObjectAsMap)(e,(e=>(0,kt.parseRGBColorSpecification)(String(e))));for(let i of t){var n=(0,a.A)(i,2);let e=n[0],t=n[1];const r=I.Uint64.parseString(String(e)),o=new I.Uint64((0,kt.packColor)(t));this.segmentStatedColors.set(r,o)}}))}toJSON(){const e={};e[qt]=this.segmentColorHash.toJSON(),e[tn]=this.segmentDefaultColor.toJSON();const t=this.segmentStatedColors;if(t.size>0){const i=e[Yt]={};for(const e of t.unsafeEntries()){var n=(0,a.A)(e,2);const t=n[0],r=n[1];i[t.toString()]=(0,kt.serializeColor)((0,kt.unpackRGB)(r.low))}}return e}assignFrom(e){this.segmentColorHash.value=e.segmentColorHash.value,this.segmentStatedColors.assignFrom(e.segmentStatedColors),this.segmentDefaultColor.value=e.segmentDefaultColor.value}}class an extends Le.O8{constructor(e,t){super(),this.linkedGroup=e,this.propertyName=t,this.value}get changed(){return this.linkedGroup.root.changed}get value(){const e=this.linkedGroup.root.value;if(e!==this.curRoot){this.curRoot=e;const t=e.displayState[this.propertyName];if(e===this.linkedGroup.layer){const e=this.curGroupState;void 0!==e&&(t.assignFrom(e),e.dispose())}this.curGroupState=t.addRef()}return this.curGroupState}disposed(){var e;null===(e=this.curGroupState)||void 0===e||e.dispose()}}class ln{constructor(e){this.layer=e,this.segmentSelectionState=new g.SegmentSelectionState,this.selectedAlpha=(0,fe.h)(.5),this.saturation=(0,fe.h)(1),this.notSelectedAlpha=(0,fe.h)(0),this.silhouetteRendering=new M.DN(0,j.verifyFiniteNonNegativeFloat,0),this.objectAlpha=(0,fe.h)(1),this.ignoreNullVisibleSet=new ge.C_(!0,!0),this.skeletonRenderingOptions=new re.Qb,this.shaderError=(0,Et.RH)(),this.renderScaleHistogram=new p.zD,this.renderScaleTarget=(0,p.fm)(1),this.selectSegment=this.layer.selectSegment,this.transparentPickEnabled=this.layer.pick,this.baseSegmentColoring=new ge.C_(!1,!1),this.filterBySegmentLabel=this.layer.filterBySegmentLabel,this.moveToSegment=e=>{this.layer.moveToSegment(e)},this.linkedSegmentationGroup=this.layer.registerDisposer(new d.o5(this.layer.manager.rootLayers,this.layer,(e=>e instanceof dn),(e=>e.displayState.linkedSegmentationGroup))),this.linkedSegmentationColorGroup=this.layer.registerDisposer(new d.o5(this.layer.manager.rootLayers,this.layer,(e=>e instanceof dn),(e=>e.displayState.linkedSegmentationColorGroup))),this.originalSegmentationGroupState=this.layer.registerDisposer(new on(this.layer)),this.originalSegmentationColorGroupState=this.layer.registerDisposer(new sn(this.layer)),e.displayState=this,this.segmentationGroupState=this.layer.registerDisposer(new an(this.linkedSegmentationGroup,"originalSegmentationGroupState")),this.segmentationColorGroupState=this.layer.registerDisposer(new an(this.linkedSegmentationColorGroup,"originalSegmentationColorGroupState")),this.hideSegmentZero=this.layer.registerDisposer(new M.rG(this.segmentationGroupState,(e=>e.hideSegmentZero))),this.segmentColorHash=this.layer.registerDisposer(new M.DY(this.segmentationColorGroupState,(e=>e.segmentColorHash))),this.segmentStatedColors=this.layer.registerDisposer(new M.DY(this.segmentationColorGroupState,(e=>e.segmentStatedColors))),this.segmentDefaultColor=this.layer.registerDisposer(new M.DY(this.segmentationColorGroupState,(e=>e.segmentDefaultColor))),this.segmentQuery=this.layer.registerDisposer(new M.rG(this.segmentationGroupState,(e=>e.segmentQuery))),this.segmentPropertyMap=this.layer.registerDisposer(new M.rG(this.segmentationGroupState,(e=>e.segmentPropertyMap)))}}const cn=(0,me.Ok)(d.J3);class dn extends cn{constructor(e){super(e),this.sliceViewRenderScaleHistogram=new p.zD,this.sliceViewRenderScaleTarget=(0,p.fm)(1),this.segmentQueryFocusTime=new M.B0(Number.NEGATIVE_INFINITY),this.selectSegment=(e,t)=>{this.manager.root.selectionState.captureSingleLayerState(this,(t=>(t.value=e.clone(),!0)),t)},this.filterBySegmentLabel=e=>{const t=(0,g.augmentSegmentId)(this.displayState,e).label;t&&this.filterSegments(t)},this.filterSegments=e=>{this.displayState.segmentationGroupState.value.segmentQuery.value=e,this.segmentQueryFocusTime.value=Date.now(),this.tabs.value="segments",this.manager.root.selectedLayer.layer=this.managedLayer},this.displayState=new ln(this),this.anchorSegment=new M.DN(void 0,(e=>void 0===e?void 0:I.Uint64.parseString(e))),this.has2dLayer=this.registerDisposer((0,M.ol)((e=>e.some((e=>e instanceof he))),{changed:this.layersChanged,value:this.renderLayers})),this.has3dLayer=this.registerDisposer((0,M.ol)((e=>e.some((e=>e instanceof h.d8||e instanceof h.Ye||e instanceof re.eQ||e instanceof re.gW))),{changed:this.layersChanged,value:this.renderLayers})),this.hasSkeletonsLayer=this.registerDisposer((0,M.ol)((e=>e.some((e=>e instanceof re.eQ))),{changed:this.layersChanged,value:this.renderLayers})),this.registerDisposer((0,M.aM)(((e,t)=>{e.registerDisposer(t.specificationChanged.add(this.specificationChanged.dispatch)),this.specificationChanged.dispatch()}),this.displayState.segmentationGroupState)),this.registerDisposer((0,M.aM)(((e,t)=>{e.registerDisposer(t.specificationChanged.add(this.specificationChanged.dispatch)),this.specificationChanged.dispatch()}),this.displayState.segmentationColorGroupState)),this.displayState.segmentSelectionState.bindTo(this.manager.layerSelectedValues,this),this.displayState.selectedAlpha.changed.add(this.specificationChanged.dispatch),this.displayState.saturation.changed.add(this.specificationChanged.dispatch),this.displayState.notSelectedAlpha.changed.add(this.specificationChanged.dispatch),this.displayState.objectAlpha.changed.add(this.specificationChanged.dispatch),this.displayState.baseSegmentColoring.changed.add(this.specificationChanged.dispatch),this.displayState.ignoreNullVisibleSet.changed.add(this.specificationChanged.dispatch),this.displayState.skeletonRenderingOptions.changed.add(this.specificationChanged.dispatch),this.displayState.renderScaleTarget.changed.add(this.specificationChanged.dispatch),this.displayState.silhouetteRendering.changed.add(this.specificationChanged.dispatch),this.anchorSegment.changed.add(this.specificationChanged.dispatch),this.sliceViewRenderScaleTarget.changed.add(this.specificationChanged.dispatch),this.displayState.originalSegmentationGroupState.localGraph.changed.add(this.specificationChanged.dispatch),this.displayState.linkedSegmentationGroup.changed.add((()=>this.updateDataSubsourceActivations())),this.tabs.add("rendering",{label:"Render",order:-100,getter:()=>new mt(this)}),this.tabs.add("segments",{label:"Seg.",order:-50,getter:()=>new st(this)}),this.tabs.default="rendering"}bindSegmentListWidth(e){return(0,g.bindSegmentListWidth)(this.displayState,e)}get volumeOptions(){return{volumeType:oe.rU.SEGMENTATION}}activateDataSubsources(e){const t=[],n=this.displayState.linkedSegmentationGroup.root.value===this;let i;for(const o of e){if(this.addStaticAnnotations(o))continue;var r=o.subsourceEntry.subsource;const e=r.volume,a=r.mesh,l=r.segmentPropertyMap,d=r.segmentationGraph,u=r.local;if(e instanceof se.kg){if(e.dataType===oe.pe.FLOAT32){o.deactivate("Data type not compatible with segmentation layer");continue}o.activate((()=>o.addRenderLayer(new he(e,s()(s()({},this.displayState),{transform:o.getRenderLayerTransform(),renderScaleTarget:this.sliceViewRenderScaleTarget,renderScaleHistogram:this.sliceViewRenderScaleHistogram,localPosition:this.localPosition})))),this.displayState.segmentationGroupState.value)}else void 0!==a?o.activate((()=>{const e=s()(s()({},this.displayState),{transform:o.getRenderLayerTransform()});if(a instanceof h.No)o.addRenderLayer(new h.d8(this.manager.chunkManager,a,e));else if(a instanceof h.bJ)o.addRenderLayer(new h.Ye(this.manager.chunkManager,a,e));else{const t=new re.X0(this.manager.chunkManager,a,e);o.addRenderLayer(new re.eQ(t.addRef())),o.addRenderLayer(new re.gW(t))}}),this.displayState.segmentationGroupState.value):void 0!==l?n?(o.activate((()=>{})),t.push(l)):o.deactivate("Not supported on non-root linked segmentation layers"):void 0!==d?n?void 0!==i?o.deactivate("Only one segmentation graph is supported"):(i=d,o.activate((e=>{this.graphConnection=e.registerDisposer(d.connect(this.displayState.segmentationGroupState.value));const t=s()(s()({},this.displayState),{transform:o.getRenderLayerTransform()}),n=this.graphConnection.createRenderLayers(this.manager.chunkManager,t,this.localPosition);for(const i of n)o.addRenderLayer(i)}))):o.deactivate("Not supported on non-root linked segmentation layers"):u===c.h0.equivalences?n?void 0!==i?o.deactivate("Only one segmentation graph is supported"):(i=this.displayState.originalSegmentationGroupState.localGraph,o.activate((e=>{this.graphConnection=e.registerDisposer(i.connect(this.displayState.segmentationGroupState.value)),e.registerDisposer((()=>{this.graphConnection=void 0}))}))):o.deactivate("Not supported on non-root linked segmentation layers"):o.deactivate("Not compatible with segmentation layer")}this.displayState.originalSegmentationGroupState.segmentPropertyMap.value=(0,m.GZ)(this.manager.chunkManager,t),this.displayState.originalSegmentationGroupState.graph.value=i}getLegacyDataSourceSpecifications(e,t,n,i){const o=super.getLegacyDataSourceSpecifications(e,t,n,i),s=(0,j.verifyOptionalObjectProperty)(t,"mesh",(e=>null===e?null:(0,j.verifyString)(e))),a=(0,j.verifyOptionalObjectProperty)(t,"skeletons",(e=>null===e?null:(0,j.verifyString)(e)));if(void 0!==s||void 0!==a)for(const l of o)l.enableDefaultSubsources=!1,l.subsources=new(r())([["default",{enabled:!0}],["bounds",{enabled:!0}]]);return null!=s&&o.push((0,u.Es)(this.manager.dataSourceProviderRegistry.convertLegacyUrl({url:s,type:"mesh"}))),null!=a&&o.push((0,u.Es)(this.manager.dataSourceProviderRegistry.convertLegacyUrl({url:a,type:"skeletons"}))),void 0!==t[Ht]&&void 0===i.find((e=>e.url===c.Yw))&&o.push({url:c.Yw,enableDefaultSubsources:!0,transform:{outputSpace:l._c,sourceRank:0,transform:void 0,inputSpace:l._c},subsources:new(r())}),o}restoreState(e){super.restoreState(e),this.displayState.selectedAlpha.restoreState(e[Vt]),this.displayState.saturation.restoreState(e[Ut]),this.displayState.notSelectedAlpha.restoreState(e[Bt]),this.displayState.objectAlpha.restoreState(e[Ft]),this.displayState.baseSegmentColoring.restoreState(e[jt]),this.displayState.silhouetteRendering.restoreState(e[Qt]),this.displayState.ignoreNullVisibleSet.restoreState(e[Gt]);const t=this.displayState.skeletonRenderingOptions;t.restoreState(e[Xt]);const n=e.skeletonShader;void 0!==n&&t.shader.restoreState(n),this.displayState.renderScaleTarget.restoreState(e[Jt]),this.anchorSegment.restoreState(e[nn]),this.sliceViewRenderScaleTarget.restoreState(e[Kt]);const i=(0,j.verifyOptionalObjectProperty)(e,$t,j.verifyString);void 0!==i&&this.displayState.linkedSegmentationGroup.linkByName(i);const r=(0,j.verifyOptionalObjectProperty)(e,en,(e=>!1===e?void 0:(0,j.verifyString)(e)),i);void 0!==r&&this.displayState.linkedSegmentationColorGroup.linkByName(r),this.displayState.segmentationGroupState.value.restoreState(e),this.displayState.segmentationColorGroupState.value.restoreState(e)}toJSON(){var e;const t=super.toJSON();t[Vt]=this.displayState.selectedAlpha.toJSON(),t[Bt]=this.displayState.notSelectedAlpha.toJSON(),t[Ut]=this.displayState.saturation.toJSON(),t[Ft]=this.displayState.objectAlpha.toJSON(),t[jt]=this.displayState.baseSegmentColoring.toJSON(),t[Gt]=this.displayState.ignoreNullVisibleSet.toJSON(),t[Qt]=this.displayState.silhouetteRendering.toJSON(),t[nn]=this.anchorSegment.toJSON(),t[Xt]=this.displayState.skeletonRenderingOptions.toJSON(),t[Jt]=this.displayState.renderScaleTarget.toJSON(),t[Kt]=this.sliceViewRenderScaleTarget.toJSON();var n=this.displayState;const i=n.linkedSegmentationGroup,r=n.linkedSegmentationColorGroup;return t[$t]=i.toJSON(),r.root.value!==i.root.value&&(t[en]=null!==(e=r.toJSON())&&void 0!==e&&e),t[Ht]=this.displayState.originalSegmentationGroupState.localGraph.toJSON(),i.root.value===this&&s()(t,this.displayState.segmentationGroupState.value.toJSON()),r.root.value===this&&s()(t,this.displayState.segmentationColorGroupState.value.toJSON()),t}transformPickedValue(e){return null==e?e:(0,g.maybeAugmentSegmentId)(this.displayState,e,!0)}handleAction(e,t){switch(e){case"recolor":this.displayState.segmentationColorGroupState.value.segmentColorHash.randomize();break;case"clear-segments":if(!this.pick.value)break;this.displayState.segmentationGroupState.value.visibleSegments.clear();break;case"select":{if(!this.pick.value)break;const e=this.displayState.segmentSelectionState;if(e.hasSelectedSegment){const n=e.selectedSegment,i=this.displayState.segmentationGroupState.value.visibleSegments,r=!i.has(n);(r||void 0===t.segmentationToggleSegmentState)&&(t.segmentationToggleSegmentState=r),t.defer((()=>{t.segmentationToggleSegmentState===r&&i.set(n,r)}))}break}case"copy-segment-id":{if(!this.pick.value)break;const e=this.displayState.segmentSelectionState;if(e.hasSelectedSegment){const t=e.selectedSegment;this.copiedSegments=[t.clone()];const n=t.toString();(0,Te.B)(n)&&pe.M.showTemporaryMessage(n+" copied to clipboard")}break}case"add-copy-segment-id":{if(!this.pick.value)break;const e=this.displayState.segmentSelectionState;if(e.hasSelectedSegment){const t=e.selectedSegment;this.copiedSegments.push(t.clone());const n=this.copiedSegments.map((e=>e.toString())).join(",");(0,Te.B)(n)&&pe.M.showTemporaryMessage(n+" copied to clipboard")}break}}}selectionStateFromJson(e,t){super.selectionStateFromJson(e,t);const n=new I.Uint64;let i=e.value;"number"===typeof i&&(i=i.toString()),"string"===typeof i&&n.tryParseString(i)?e.value=n:e.value=void 0}selectionStateToJson(e,t){const n=super.selectionStateToJson(e,t);let i=e.value;return i instanceof g.Uint64MapEntry?n.value=t?{key:i.key.toString(),value:i.value?i.value.toString():void 0,label:i.label}:(i.value||i.key).toString():i instanceof I.Uint64&&(n.value=i.toString()),n}displaySegmentationSelection(e,t,n){const i=e.value;let r;if(("number"===typeof i||"string"===typeof i)&&(r=new I.Uint64,!r.tryParseString(i.toString())))return!1;if(i instanceof I.Uint64)r=i.clone();else{if(!(i instanceof g.Uint64MapEntry))return!1;r=i.key.clone()}const o=this.displayState,s=(0,g.augmentSegmentId)(o,r);var a=this.displayState.segmentationGroupState.value;const l=a.segmentEquivalences,c=a.segmentPropertyMap.value,d=l.get(r),u=(0,g.makeSegmentWidget)(this.displayState,s);if((0,g.registerCallbackWhenSegmentationDisplayStateChanged)(o,n,n.redraw),n.registerDisposer((0,g.bindSegmentListWidth)(o,u)),u.classList.add("neuroglancer-selection-details-segment"),t.appendChild(u),void 0!==c){const e=c.segmentPropertyMap.inlineProperties;if(void 0!==e){const n=c.getSegmentInlineIndex(d);if(-1!==n)for(const i of e.properties)if("label"!==i.type)if("description"===i.type){const e=i.values[n];if(!e)continue;const r=document.createElement("div");r.classList.add("neuroglancer-selection-details-segment-description"),r.textContent=e,t.appendChild(r)}else if("number"===i.type||"string"===i.type){const e=i.values[n];if("number"===i.type?isNaN(e):!e)continue;const r=document.createElement("div");r.classList.add("neuroglancer-selection-details-segment-property");const o=document.createElement("div");o.classList.add("neuroglancer-selection-details-segment-property-name"),o.textContent=i.id,i.description&&(o.title=i.description);const s=document.createElement("div");s.classList.add("neuroglancer-selection-details-segment-property-value"),s.textContent=e.toString(),r.appendChild(o),r.appendChild(s),t.appendChild(r)}}}return!0}displaySelectionState(e,t,n){let i=this.displaySegmentationSelection(e,t,n);return super.displaySelectionState(e,t,n)&&(i=!0),i}moveToSegment(e){for(const n of this.renderLayers){if(!(n instanceof h.Ye))continue;const t=n.getObjectPosition(e);if(void 0!==t)return void this.setLayerPosition(n.displayState.transform.value,t)}let t=!1;for(const n of this.renderLayers)if(n instanceof he){const i=n.multiscaleSource;i.getSegmentPosition&&(t=!0,i.getSegmentPosition(e).then((e=>{this.setLayerPosition(null,e)})).catch((t=>{pe.M.showTemporaryMessage("Failed to retrieve position for segment ".concat(e,": ").concat(t))})))}t||pe.M.showTemporaryMessage("No position information loaded for segment ".concat(e))}}dn.type="segmentation",dn.typeAbbreviation="seg",dn.supportsPickOption=!0;function un(e){return[s()({label:"Skeleton mode (".concat(e,")"),toolJson:"".concat(Xt,".mode").concat(e),isValid:e=>e.hasSkeletonsLayer},(0,Lt.k)((t=>t.displayState.skeletonRenderingOptions["params".concat(e)].mode))),s()({label:"Line width (".concat(e,")"),toolJson:"".concat(Xt,".lineWidth").concat(e),isValid:e=>e.hasSkeletonsLayer,toolDescription:"Skeleton line width (".concat(e,")"),title:"Skeleton line width (".concat(e,")")},(0,Pt.k)((t=>({value:t.displayState.skeletonRenderingOptions["params".concat(e)].lineWidth,options:{min:1,max:40,step:1}}))))]}const hn=[s()({label:"Color seed",title:"Color segments based on a hash of their id",toolJson:qt},function(){const e=e=>{e.displayState.segmentationColorGroupState.value.segmentColorHash.randomize()};return{makeControl:(t,n,i)=>{let{labelTextContainer:r}=i;const o=document.createElement("input");o.type="radio",o.addEventListener("change",(()=>{_t(t,!o.checked)})),r.prepend(o);const s=document.createElement("div");s.classList.add("neuroglancer-segmentation-color-seed-control");const a=n.registerDisposer(new Nt.I(t.displayState.segmentColorHash));s.appendChild(a.element);const l=(0,At.m)({svg:It(),title:"Randomize",onClick:()=>e(t)});return s.appendChild(l),n.registerDisposer((0,M.W1)((e=>{const t=void 0===e;s.style.visibility=t?"":"hidden",o.checked=t}),t.displayState.segmentDefaultColor)),{controlElement:s,control:a}},activateTool:t=>{const n=t.tool.layer;_t(n,!1),e(n)}}}()),s()({label:"Fixed color",title:"Use a fixed color for all segments without an explicitly-specified color",toolJson:tn},function(){const e=(0,Ot.Y)((e=>e.displayState.segmentDefaultColor));return s()(s()({},e),{makeControl:(t,n,i)=>{const r=e.makeControl(t,n,i),o=r.controlElement,s=document.createElement("input");return s.type="radio",s.addEventListener("change",(()=>{_t(t,s.checked),s.checked&&o.click()})),i.labelTextContainer.prepend(s),n.registerDisposer((0,M.W1)((e=>{const t=void 0!==e;o.style.visibility=t?"":"hidden",s.checked=t}),t.displayState.segmentDefaultColor)),r},activateTool:(t,n)=>{_t(t.tool.layer,!0),e.activateTool(t,n)}})}()),s()({label:"Saturation",toolJson:Ut,title:"Saturation of segment colors"},(0,Pt.k)((e=>({value:e.displayState.saturation})))),s()({label:"Opacity (on)",toolJson:Vt,isValid:e=>e.has2dLayer,title:"Opacity in cross-section views of segments that are selected"},(0,Pt.k)((e=>({value:e.displayState.selectedAlpha})))),s()({label:"Opacity (off)",toolJson:Bt,isValid:e=>e.has2dLayer,title:"Opacity in cross-section views of segments that are not selected"},(0,Pt.k)((e=>({value:e.displayState.notSelectedAlpha})))),s()({label:"Resolution (slice)",toolJson:Kt,isValid:e=>e.has2dLayer},(0,Dt.P)((e=>({histogram:e.sliceViewRenderScaleHistogram,target:e.sliceViewRenderScaleTarget})))),s()({label:"Resolution (mesh)",toolJson:Jt,isValid:e=>e.has3dLayer},(0,Dt.P)((e=>({histogram:e.displayState.renderScaleHistogram,target:e.displayState.renderScaleTarget})))),s()({label:"Opacity (3d)",toolJson:Ft,isValid:e=>e.has3dLayer,title:"Opacity of meshes and skeletons"},(0,Pt.k)((e=>({value:e.displayState.objectAlpha})))),s()({label:"Silhouette (3d)",toolJson:Qt,isValid:e=>e.has3dLayer,title:"Set to a non-zero value to increase transparency of object faces perpendicular to view direction"},(0,Pt.k)((e=>({value:e.displayState.silhouetteRendering,options:{min:0,max:10,step:.1}})))),s()({label:"Hide segment ID 0",toolJson:zt,title:"Disallow selection and display of segment id 0"},(0,Tt.Y)((e=>e.displayState.hideSegmentZero))),s()({label:"Base segment coloring",toolJson:jt,title:"Color base segments individually"},(0,Tt.Y)((e=>e.displayState.baseSegmentColoring))),s()({label:"Show all by default",title:"Show all segments if none are selected",toolJson:Gt},(0,Tt.Y)((e=>e.displayState.ignoreNullVisibleSet))),...un("2d"),...un("3d")];for(const pn of hn)(0,ct.ok)(dn,pn);(0,d.LJ)(dn),(0,d.zQ)(oe.rU.SEGMENTATION,dn),(0,d.lV)((e=>{if(void 0!==e.mesh)return{layerConstructor:dn,priority:1}})),(0,ft.G6)(dn,(e=>({shaderControlState:e.displayState.skeletonRenderingOptions.shaderControlState})),rn),(0,Be.zA)(dn,Fe,(e=>new Ge(e))),(0,Be.zA)(dn,Ue,(e=>new We(e))),(0,Be.zA)(dn,Ye,(e=>new Ze(e)))},6210:(e,t,n)=>{n.d(t,{a:()=>h});var i,r=n(6063),o=n.n(r),s=n(5677),a=n.n(s),l=n(7160),c=n(7799),d=function(e,t,n,i){var r,s=arguments.length,l=s<3?t:null===i?i=a()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)l=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(l=(s<3?r(l):s>3?r(t,n,l):r(t,n))||l);return s>3&&l&&o()(t,n,l),l};const u="SharedWatchableValue.changed";let h=i=class extends c.IN{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.updatingValue_=!1,void 0!==e&&(this.base=new l.B0(t.value),this.setupChangedHandler())}initializeCounterpart(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.value=this.value,super.initializeCounterpart(e,t)}setupChangedHandler(){this.registerDisposer(this.base.changed.add((()=>{if(this.updatingValue_)this.updatingValue_=!1;else{const e=this.rpc;null!==e&&e.invoke(u,{id:this.rpcId,value:this.value})}})))}static makeFromExisting(e,t){let n=new i;return n.base=t,n.setupChangedHandler(),n.initializeCounterpart(e),n}static make(e,t){return i.makeFromExisting(e,new l.B0(t))}get value(){return this.base.value}set value(e){this.base.value=e}get changed(){return this.base.changed}};h=i=d([(0,c.eZ)("SharedWatchableValue")],h),(0,c.ks)(u,(function(e){const t=this.get(e.id);t.updatingValue_=!0,t.base.value=e.value,t.updatingValue_=!1}))},1406:(e,t,n)=>{n.d(t,{eQ:()=>G,X0:()=>j,Qb:()=>z,tr:()=>K,gW:()=>W});var i=n(608),r=n.n(i),o=n(2982),s=n(6688),a=n.n(s),l=n(9176),c=n.n(l),d=n(6094),u=n(5795),h=n(6560),p=n(3056),f=n(4874),g=n(739);var m=n(7184),v=n(7160),y=n(9043),b=n(7562),S=n(3835),w=n(7970),x=n(6344),C=n(233),k=n(6429),E=n(9981),T=n(9182),L=n(251),P=n(9080),D=n(7520),M=n(4011),I=n(2025),R=n(8913);const A=S.pB.create(),O="void main() {\n  emitDefault();\n}\n",N=[],_=(0,I.YY)(new I.nC,y.pe.FLOAT32,3);class V extends b.O8{constructor(e,t){super(),this.base=e,this.targetIsSliceView=t,this.textureAccessHelper=new I.R6("vertexData"),this.vertexIdHelper=this.registerDisposer(R.u.get(this.gl)),this.edgeShaderGetter=(0,P.P9)(this,this.gl,{memoizeKey:{type:"skeleton/SkeletonShaderManager/edge",vertexAttributes:this.vertexAttributes},fallbackParameters:this.base.fallbackShaderParameters,parameters:this.base.displayState.skeletonRenderingOptions.shaderControlState.builderState,shaderError:this.base.displayState.shaderError,defineShader:(e,t)=>{if(0!==t.parseResult.errors.length)throw new Error("Invalid UI control specification");this.defineCommonShader(e),this.defineAttributeAccess(e),(0,D.VU)(e),e.addAttribute("highp uvec2","aVertexIndex"),e.addUniform("highp float","uLineWidth");let n="\nhighp vec3 vertexA = readAttribute0(aVertexIndex.x);\nhighp vec3 vertexB = readAttribute0(aVertexIndex.y);\nemitLine(uProjection, vertexA, vertexB, uLineWidth);\nhighp uint lineEndpointIndex = getLineEndpointIndex();\nhighp uint vertexIndex = aVertexIndex.x * lineEndpointIndex + aVertexIndex.y * (1u - lineEndpointIndex);\n";e.addFragmentCode("\nvec4 segmentColor() {\n  return uColor;\n}\nvoid emitRGB(vec3 color) {\n  emit(vec4(color * uColor.a, uColor.a * getLineAlpha() * ".concat(this.getCrossSectionFadeFactor(),"), uPickID);\n}\nvoid emitDefault() {\n  emit(vec4(uColor.rgb, uColor.a * getLineAlpha() * ").concat(this.getCrossSectionFadeFactor(),"), uPickID);\n}\n")),e.addFragmentCode(L.o);const i=this.vertexAttributes,r=i.length;for(let o=1;o<r;++o){const t=i[o];e.addVarying("highp ".concat(t.glslDataType),"vCustom".concat(o)),n+="vCustom".concat(o," = readAttribute").concat(o,"(vertexIndex);\n"),e.addFragmentCode("#define ".concat(t.name," vCustom").concat(o,"\n"))}e.setVertexMain(n),(0,M.kk)(t,e),e.setFragmentMainFunction((0,P.qK)(t.parseResult.code))}}),this.nodeShaderGetter=(0,P.P9)(this,this.gl,{memoizeKey:{type:"skeleton/SkeletonShaderManager/node",vertexAttributes:this.vertexAttributes},fallbackParameters:this.base.fallbackShaderParameters,parameters:this.base.displayState.skeletonRenderingOptions.shaderControlState.builderState,shaderError:this.base.displayState.shaderError,defineShader:(e,t)=>{if(0!==t.parseResult.errors.length)throw new Error("Invalid UI control specification");this.defineCommonShader(e),this.defineAttributeAccess(e),(0,T.fg)(e,this.targetIsSliceView),e.addUniform("highp float","uNodeDiameter");let n="\nhighp uint vertexIndex = uint(gl_InstanceID);\nhighp vec3 vertexPosition = readAttribute0(vertexIndex);\nemitCircle(uProjection * vec4(vertexPosition, 1.0), uNodeDiameter, 0.0);\n";e.addFragmentCode("\nvec4 segmentColor() {\n  return uColor;\n}\nvoid emitRGBA(vec4 color) {\n  vec4 borderColor = color;\n  emit(getCircleColor(color, borderColor), uPickID);\n}\nvoid emitRGB(vec3 color) {\n  emitRGBA(vec4(color, 1.0));\n}\nvoid emitDefault() {\n  emitRGBA(uColor);\n}\n"),e.addFragmentCode(L.o);const i=this.vertexAttributes,r=i.length;for(let o=1;o<r;++o){const t=i[o];e.addVarying("highp ".concat(t.glslDataType),"vCustom".concat(o)),n+="vCustom".concat(o," = readAttribute").concat(o,"(vertexIndex);\n"),e.addFragmentCode("#define ".concat(t.name," vCustom").concat(o,"\n"))}e.setVertexMain(n),(0,M.kk)(t,e),e.setFragmentMainFunction((0,P.qK)(t.parseResult.code))}})}get vertexAttributes(){return this.base.vertexAttributes}defineCommonShader(e){(0,R.N)(e),e.addUniform("highp vec4","uColor"),e.addUniform("highp mat4","uProjection"),e.addUniform("highp uint","uPickID")}get gl(){return this.base.gl}defineAttributeAccess(e){const t=this.textureAccessHelper;t.defineShader(e);const n=this.vertexAttributes.length;for(let i=N.length;i<n;++i)N[i]=c()("SkeletonShader.vertexAttributeTextureUnit".concat(i));this.vertexAttributes.forEach(((n,i)=>{e.addTextureSampler("".concat((0,I.iY)(n.dataType),"sampler2D"),"uVertexAttributeSampler".concat(i),N[i]),e.addVertexCode(t.getAccessor("readAttribute".concat(i),"uVertexAttributeSampler".concat(i),n.dataType,n.numComponents))}))}getCrossSectionFadeFactor(){return this.targetIsSliceView?"(clamp(1.0 - 2.0 * abs(0.5 - gl_FragCoord.z), 0.0, 1.0))":"(1.0)"}beginLayer(e,t,n,i){const r=n.projectionParameters.viewProjectionMat;let o=S.pB.multiply(A,r,i);e.uniformMatrix4fv(t.uniform("uProjection"),!1,o),this.vertexIdHelper.enable()}setColor(e,t,n){e.uniform4fv(t.uniform("uColor"),n)}setPickID(e,t,n){e.uniform1ui(t.uniform("uPickID"),n)}drawSkeleton(e,t,n,i,r){const o=this.vertexAttributes.length,s=i.vertexAttributeTextures;for(let a=0;a<o;++a){const n=WebGL2RenderingContext.TEXTURE0+t.textureUnit(N[a]);e.activeTexture(n),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,s[a])}{t.bind();const n=t.attribute("aVertexIndex");i.indexBuffer.bindToVertexAttribI(n,2,WebGL2RenderingContext.UNSIGNED_INT),e.vertexAttribDivisor(n,1),(0,D.Cy)(t,r,this.targetIsSliceView?1:0),(0,D.wo)(e,1,i.numIndices/2),e.vertexAttribDivisor(n,0),e.disableVertexAttribArray(n)}null!==n&&(n.bind(),(0,T.Yu)(n,r,{featherWidthInPixels:this.targetIsSliceView?1:0}),(0,T.aK)(n.gl,2,i.numVertices))}endLayer(e,t){const n=this.vertexAttributes.length;for(let i=0;i<n;++i){let n=t.textureUnit(N[i])+WebGL2RenderingContext.TEXTURE0;e.activeTexture(n),e.bindTexture(e.TEXTURE_2D,null)}this.vertexIdHelper.disable()}}var B;!function(e){e[e.LINES=0]="LINES",e[e.LINES_AND_POINTS=1]="LINES_AND_POINTS"}(B||(B={}));class F extends k.F{constructor(e){super(B,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e)}}class U extends v.DN{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;super(e,w.verifyFinitePositiveFloat,t)}}class z{constructor(){this.compound=new C.dp,this.shader=(0,P.vk)(O),this.shaderControlState=new M.a$(this.shader),this.params2d={mode:new F(B.LINES_AND_POINTS),lineWidth:new U(2)},this.params3d={mode:new F(B.LINES),lineWidth:new U(1)};const e=this.compound;e.add("shader",this.shader),e.add("shaderControls",this.shaderControlState),e.add("mode2d",this.params2d.mode),e.add("lineWidth2d",this.params2d.lineWidth),e.add("mode3d",this.params3d.mode),e.add("lineWidth3d",this.params3d.lineWidth)}get changed(){return this.compound.changed}reset(){this.compound.reset()}restoreState(e){void 0!==e&&this.compound.restoreState(e)}toJSON(){const e=this.compound.toJSON();for(const t of a()(e))if(void 0!==t)return e}}class j extends b.O8{constructor(e,t,n){super(),this.chunkManager=e,this.source=t,this.displayState=n,this.layerChunkProgressInfo=new d.IL,this.redrawNeeded=new x.IY,this.fallbackShaderParameters=new v.B0((0,M.PH)((0,M.TZ)(O))),(0,g.registerRedrawWhenSegmentationDisplayState3DChanged)(n,this),this.displayState.shaderError.value=void 0;const i=n.skeletonRenderingOptions;this.registerDisposer(i.shader.changed.add((()=>{this.displayState.shaderError.value=void 0,this.redrawNeeded.dispatch()})));let r=this.sharedObject=this.registerDisposer(new g.SegmentationLayerSharedObject(e,n,this.layerChunkProgressInfo));r.RPC_TYPE_ID="skeleton/SkeletonLayer",r.initializeCounterpartWithChunkManager({source:t.addCounterpartRef()});const s=this.vertexAttributes=[q];for(let l of t.vertexAttributes){var a=(0,o.A)(l,2);let e=a[0],t=a[1];s.push({name:e,dataType:t.dataType,numComponents:t.numComponents,webglDataType:H(t.dataType),glslDataType:t.numComponents>1?"vec".concat(t.numComponents):"float"})}}get visibility(){return this.sharedObject.visibility}get gl(){return this.chunkManager.chunkQueueManager.gl}draw(e,t,n,i,r){let o=i.lineWidth.value;const s=this.gl,a=this.source,l=this.displayState;if(l.objectAlpha.value<=0)return;const c=(0,p.$x)(l.transform.value,e.projectionParameters.displayDimensionRenderInfo,r);if(void 0===c)return;let u;u=i.mode.value===B.LINES_AND_POINTS?Math.max(5,2*o):o;const h=n.edgeShaderGetter(e.emitter),m=n.nodeShaderGetter(e.emitter),v=h.shader,y=h.parameters,b=m.shader,S=m.parameters;if(null===v||null===b)return;const w=this.displayState.skeletonRenderingOptions.shaderControlState;v.bind(),n.beginLayer(s,v,e,c),(0,M.dB)(s,v,w,y.parseResult.controls),s.uniform1f(v.uniform("uLineWidth"),o),b.bind(),n.beginLayer(s,b,e,c),s.uniform1f(b.uniform("uNodeDiameter"),u),(0,M.dB)(s,b,w,S.parseResult.controls);const x=a.chunks;(0,g.forEachVisibleSegmentToDraw)(l,t,e.emitColor,e.emitPickID?e.pickIDs:void 0,((t,i,r)=>{const o=(0,f.dH)(t),a=x.get(o);void 0!==a&&a.state===d.HU.GPU_MEMORY&&(void 0!==i&&(v.bind(),n.setColor(s,v,i),b.bind(),n.setColor(s,b,i)),void 0!==r&&(v.bind(),n.setPickID(s,v,r),b.bind(),n.setPickID(s,b,r)),n.drawSkeleton(s,v,b,a,e.projectionParameters))})),n.endLayer(s,v)}isReady(){const e=this.source,t=this.displayState;if(t.objectAlpha.value<=0)return!0;const n=e.chunks;let i=!0;return(0,f.SH)(t.segmentationGroupState.value,(e=>{const t=(0,f.dH)(e),r=n.get(t);void 0!==r&&r.state===d.HU.GPU_MEMORY||(i=!1)})),i}}class G extends h.r{constructor(e){super(),this.base=e,this.renderHelper=this.registerDisposer(new V(this.base,!1)),this.renderOptions=this.base.displayState.skeletonRenderingOptions.params3d,this.layerChunkProgressInfo=e.layerChunkProgressInfo,this.registerDisposer(e),this.registerDisposer(e.redrawNeeded.add(this.redrawNeeded.dispatch));const t=this.renderOptions;this.registerDisposer(t.mode.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(t.lineWidth.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(e.visibility.add(this.visibility))}get gl(){return this.base.gl}get isTransparent(){return this.base.displayState.objectAlpha.value<1}draw(e,t){!e.emitColor&&e.alreadyEmittedPickID||this.base.draw(e,this,this.renderHelper,this.renderOptions,t)}isReady(){return this.base.isReady()}}class W extends m.j{constructor(e){super(),this.base=e,this.renderHelper=this.registerDisposer(new V(this.base,!0)),this.renderOptions=this.base.displayState.skeletonRenderingOptions.params2d,this.layerChunkProgressInfo=e.layerChunkProgressInfo,this.registerDisposer(e);const t=this.renderOptions;this.registerDisposer(t.mode.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(t.lineWidth.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(e.redrawNeeded.add(this.redrawNeeded.dispatch)),this.registerDisposer(e.visibility.add(this.visibility))}get gl(){return this.base.gl}draw(e,t){this.base.draw(e,this,this.renderHelper,this.renderOptions,t)}isReady(){return this.base.isReady()}}function H(e){if(e===y.pe.FLOAT32)return WebGL2RenderingContext.FLOAT;throw new Error("Data type not supported by WebGL: ".concat(y.pe[e]))}const q={dataType:y.pe.FLOAT32,numComponents:3,name:"",webglDataType:WebGL2RenderingContext.FLOAT,glslDataType:"vec3"};class Y extends u.AA{constructor(e,t){super(e),this.vertexAttributes=t.vertexAttributes;let n=this.indices=t.indices;this.numVertices=t.numVertices,this.vertexAttributeOffsets=t.vertexAttributeOffsets,this.numIndices=n.length}copyToGPU(e){super.copyToGPU(e);const t=this.source.attributeTextureFormats,n=this.vertexAttributes,i=this.vertexAttributeOffsets,r=this.vertexAttributeTextures=[];for(let o=0,s=i.length;o<s;++o){const a=e.createTexture();e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,a),(0,I.pK)(e,t[o],n.subarray(i[o],o+1!==s?i[o+1]:n.length)),r[o]=a}e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null),this.indexBuffer=E.h.fromData(e,this.indices,WebGL2RenderingContext.ARRAY_BUFFER,WebGL2RenderingContext.STATIC_DRAW)}freeGPUMemory(e){super.freeGPUMemory(e);const t=this.vertexAttributeTextures;for(const n of t)e.deleteTexture(n);t.length=0,this.indexBuffer.dispose()}}const J=new(r());class K extends u.PU{constructor(e,t){super(e,t)}get attributeTextureFormats(){let e=this.attributeTextureFormats_;return void 0===e&&(e=this.attributeTextureFormats_=function(e){const t=[_];for(const n of e.values())t.push((0,I.YY)(new I.nC,n.dataType,n.numComponents));return t}(this.vertexAttributes)),e}getChunk(e){return new Y(this,e)}get vertexAttributes(){return J}}},156:(e,t,n)=>{n.d(t,{BA:()=>j,EO:()=>P,N9:()=>M,SJ:()=>O,TD:()=>k,WC:()=>I,_g:()=>D,ah:()=>U,bT:()=>C,l:()=>L,oq:()=>R,vX:()=>A,xO:()=>T,xd:()=>z});var i=n(3651),r=n.n(i),o=n(4117),s=n.n(o),a=n(2982),l=n(608),c=n.n(l),d=n(5603),u=n(3985),h=n(6393),p=(n(9043),n(3835)),f=n(9799),g=n(7799);const m=!1,v=!1,y=p.pB.create();function b(e,t){let n=0,i=Math.abs(e.detTransform);const r=e.transform,o=e.size;for(let s=0;s<3;++s){let e=0;for(let n=0;n<3;++n)e+=t[4*n+2]*r[4*s+n];const a=o[s];n+=Math.abs(e)*a,i*=a}return i/n}function S(e,t,n){const i=e.curPositionInChunks,r=e.fixedPositionWithinChunk,o=e.nonDisplayLowerClipBound,s=e.nonDisplayUpperClipBound;var a=e.source.spec;const l=a.rank,c=a.chunkDataSize;if(!(0,u.Mk)(i,t,n,e.layerRank,e.fixedLayerToChunkTransform))return!1;for(let d=0;d<l;++d){const t=i[d];if(t<o[d]||t>=s[d])return m&&console.log("excluding source",e,"because of chunkDim=".concat(d,", sum=").concat(t),o,s,e.fixedLayerToChunkTransform),!1;const n=c[d],a=i[d]=Math.floor(t/n);r[d]=t-a*n}return!0}function w(e,t){let n=t.length,i=0;if(m&&console.log(t),n>1){let r=0;for(let o=0;o<n;++o){const n=t[o].chunkLayout;let s=b(n,e);m&&console.log("chunksize = ".concat(n.size,", sliceArea = ").concat(s)),s>r&&(r=s,i=o)}}return i}const x=new h.i(p.eR.create(),p.pB.create(),0);class C extends d.kJ{constructor(){super(...arguments),this.viewportNormalInGlobalCoordinates=p.eR.create(),this.viewportNormalInCanonicalCoordinates=p.eR.create(),this.centerDataPosition=p.eR.create(),this.pixelSize=0}}class k extends g.T6{constructor(e){super(),this.projectionParameters=e,this.visibleLayers=new(c()),this.visibleSourcesStale=!0,this.registerDisposer(e.changed.add(((e,t)=>{(function(e,t){if(e.displayDimensionRenderInfo!==t.displayDimensionRenderInfo)return!0;if(e.pixelSize!==t.pixelSize)return!0;const n=e.viewMatrix,i=t.viewMatrix;for(let r=0;r<12;++r)if(n[r]!==i[r])return!0;return!1})(e,t)&&this.invalidateVisibleSources(),this.invalidateVisibleChunks()})))}invalidateVisibleSources(){this.visibleSourcesStale=!0}invalidateVisibleChunks(){}updateVisibleSources(){if(!this.visibleSourcesStale)return;this.visibleSourcesStale=!1;const e=this.projectionParameters.value.displayDimensionRenderInfo,t=this.visibleLayers;for(const r of t){var n=(0,a.A)(r,2);const t=n[0];var i=n[1];const o=i.allSources,s=i.visibleSources,l=i.displayDimensionRenderInfo;if(s.length=0,l!==e||0===o.length)continue;const c=w(this.projectionParameters.value.viewMatrix,o.map((e=>e[0]))),d=o[c];for(const e of t.filterVisibleSources(this,d))s.push(e);s.reverse(),m&&console.log("visible sources chosen",s)}}}const E=18;function T(e){let t=e.rank,n=e.upperVoxelBound;var i=e.maxVoxelsPerChunkLog2;let r=void 0===i?E:i,o=e.chunkToViewTransform,a=e.displayRank,l=e.minBlockSize,c=e.maxBlockSize;var d=e.lowerVoxelBound;const u=void 0===d?new Uint32Array(t):d,h=new Float32Array(t);for(let s=0;s<t;++s){let e=0;for(let t=0;t<a;++t){const n=o[s*a+t];e+=n*n}h[s]=Math.sqrt(e)}const p=new Uint32Array(t);void 0!==l?p.set(l):p.fill(1);const g=new Array(t);for(let f=0;f<t;++f){let e=Number.POSITIVE_INFINITY;0===h[f]?e=p[f]:(void 0!==n&&(e=Math.pow(2,Math.floor(s()(n[f]-u[f])))),void 0!==c&&(e=Math.min(e,c[f]))),g[f]=e}function m(){let e=1/0,n=-1;for(let i=0;i<t;++i){if(p[i]>=g[i])continue;let t=p[i]*h[i];t<e&&(e=t,n=i)}return n}r-=s()(f._e(p));for(let s=0;s<r;++s){let e=m();if(-1===e)break;p[e]*=2}return p}var L;function P(e){if(void 0!==e.chunkDataSizes)return e.chunkDataSizes;var t=e.chunkLayoutPreference;switch(void 0===t?L.ISOTROPIC:t){case L.ISOTROPIC:return[T(e)];case L.FLAT:return function(e){const t=[],n=e.displayRank,i=e.chunkToViewTransform,o=e.rank;if(n>3)throw new Error("Unsupported view transform");if(n<3)return[T(e)];for(let s=0;s<3;++s){const a=(s+2)%3,l=new Float32Array(i);for(let e=0;e<o;++e)l[e*n+a]=0;t[s]=T(r()(r()({},e),{chunkToViewTransform:l}))}return t}(e)}}function D(e){const t=e.rank,n=e.chunkDataSize,i=e.upperVoxelBound;var r=e.lowerVoxelBound;const o=void 0===r?new Float32Array(t):r,s=new Float32Array(t),a=new Float32Array(t);for(let l=0;l<t;++l)s[l]=Math.floor(o[l]/n[l]),a[l]=Math.floor((i[l]-1)/n[l]+1);return{rank:t,chunkDataSize:n,lowerChunkBound:s,upperChunkBound:a,lowerVoxelBound:o,upperVoxelBound:i}}function*M(e,t,n){const i=1.1*e.projectionParameters.value.pixelSize,r=n[0].effectiveVoxelSize,o=t.renderScaleTarget.value,s=e=>{const t=i*o;for(let n=0;n<3;++n){const i=e[n];if(i>t&&i>1.01*r[n])return!0}return!1},a=(e,t)=>{const n=i*o;for(let i=0;i<3;++i){const r=e[i],o=t[i];if(Math.abs(n-r)<Math.abs(n-o)&&r<1.01*o)return!0}return!1};let l,c=n.length-1;for(;;){const e=n[c];if(void 0!==l&&!a(e.effectiveVoxelSize,l))break;if(yield e,0===c||!s(e.effectiveVoxelSize))break;l=e.effectiveVoxelSize,--c}}!function(e){e[e.ISOTROPIC=0]="ISOTROPIC",e[e.FLAT=1]="FLAT"}(L||(L={}));const I="SliceView",R="sliceview/RenderLayer",A="SliceView.addVisibleLayer",O="SliceView.removeVisibleLayer",N=new Float32Array(3),_=new Float32Array(3),V=p.pB.create(),B=new Float32Array(24);function F(e,t,n,i){const r=N,o=_,s=t.lowerChunkDisplayBound,a=t.upperChunkDisplayBound;for(let d=0;d<3;++d)r[d]=Math.max(r[d],s[d]),o[d]=Math.min(o[d],a[d]);const l=t.curPositionInChunks,c=t.chunkDisplayDimensionIndices;!function t(){if(!i(r[0],r[1],r[2],o[0],o[1],o[2],e))return;let s=0,a=Math.max(0,o[0]-r[0]),d=a;for(let e=1;e<3;++e){const t=Math.max(0,o[e]-r[e]);d*=t,t>a&&(a=t,s=e)}if(0===d)return;if(1===d)return l[c[0]]=r[0],l[c[1]]=r[1],l[c[2]]=r[2],void n(r,e);const u=r[s],h=o[s],p=Math.floor(.5*(u+h));o[s]=p,t(),o[s]=h,r[s]=p,t(),r[s]=u}()}function U(e,t,n,i){if(!S(n,e.globalPosition,t))return;const r=n.chunkLayout.size,o=p.pB.multiply(V,e.viewProjectionMat,n.chunkLayout.transform);for(let l=0;l<3;++l){const e=r[l];for(let t=0;t<4;++t)o[4*l+t]*=e}const s=B;(0,p._S)(s,o);const a=_;N.fill(Number.NEGATIVE_INFINITY),a.fill(Number.POSITIVE_INFINITY),F(s,n,i,p.T_)}function z(e,t,n,i,r){if(!S(n,e.globalPosition,t))return;const o=i.size,s=p.pB.multiply(V,e.viewProjectionMat,i.transform);for(let u=0;u<3;++u){const e=o[u];for(let t=0;t<4;++t)s[4*u+t]*=e}const a=y;p.pB.invert(a,s);const l=N,c=_;for(let u=0;u<3;++u){const e=a[12+u]+.001/o[u],t=Math.abs(a[u]),n=Math.abs(a[4+u]);l[u]=Math.floor(e-t-n),c[u]=Math.floor(e+t+n+1)}const d=B;for(let u=0;u<3;++u){const e=s[4*u],t=s[4*u+1],n=s[4*u+2];d[u]=e,d[4+u]=-e,d[8+u]=+t,d[12+u]=-t,d[16+u]=+n,d[20+u]=-n}{const e=3,t=s[4*e],n=s[4*e+1],i=s[4*e+2];d[e]=1+t,d[4+e]=1-t,d[8+e]=1+n,d[12+e]=1-n,d[16+e]=i,d[20+e]=-i}v&&(console.log("clippingPlanes",d),console.log("modelViewProjection",s.join(",")),console.log("lower=".concat(l.join(","),", upper=").concat(c.join(",")))),F(d,n,r,p.qp)}function j(e,t){const n=t.finiteRank;if(3===n)return t;x.finiteRank=n,p.eR.copy(x.size,t.size);const i=p.pB.copy(x.transform,t.transform),r=p.pB.copy(x.invTransform,t.invTransform);x.detTransform=t.detTransform;const o=e.invViewMatrix,s=e.width,a=e.height,l=(0,p.sJ)(e.projectionMat);for(let c=n;c<3;++c){const e=o[12+c];let t=e,n=e;const r=Math.abs(o[c]*s);t-=r,n+=r;const d=Math.abs(o[c+4]*a);t-=d,n+=d;const u=Math.abs(o[c+8]*l);t-=u,n+=u;const h=Math.max(1,n-t);i[12+c]=t,i[5*c]=h}return p.pB.invert(r,i),x}},8778:(e,t,n)=>{n.d(t,{U0:()=>h,oo:()=>p,qX:()=>c,xo:()=>u});var i=n(3835);const r=i.eR.create(),o=i.eR.create(),s=.001,a=.001;function l(e){let t=0;for(var n=0;n<3;++n)e[n]<0&&(t+=1<<n);return t}const c=new Float32Array([0,0,0,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,1,1,1,1,1]),d=(()=>{const e=[0,1,2,4,5,3,6,7],t=[0,1,2,5,3,4,6,7],n=[0,1,1,4,4,7,4,7,1,5,0,1,1,4,4,7,0,2,2,5,5,7,5,7,2,6,0,2,2,5,5,7,0,3,3,6,6,7,6,7,3,4,0,3,3,6,6,7],i=[0,1,2,3,4,5,6,7,1,4,5,0,3,7,2,6,2,6,0,5,7,3,1,4,3,0,6,4,1,2,7,5,4,3,7,1,0,6,5,2,5,2,1,7,6,0,4,3,6,7,3,2,5,4,0,1,7,5,4,6,2,1,3,0],r=new Int32Array(384);for(let o=0;o<8;++o)for(let s=0;s<n.length;++s){const a=8*t[o]+n[s];r[8*o*6+s]=e[i[a]]}return r})();function u(e){e.addUniform("highp vec3","uPlaneNormal"),e.addUniform("highp float","uPlaneDistance"),e.addUniform("highp ivec2","uVertexIndex",24),e.addUniform("highp vec3","uVertexBasePosition",8),e.addInitializer((e=>{e.gl.uniform3fv(e.uniform("uVertexBasePosition"),c)})),e.addVertexCode("\nvec3 getBoundingBoxPlaneIntersectionVertexPosition(vec3 chunkSize, vec3 boxLower, vec3 lowerClipBound, vec3 upperClipBound, int vertexIndex, float planeDistance) {\n  for (int e = 0; e < 4; ++e) {\n    highp ivec2 vidx = uVertexIndex[vertexIndex*4 + e];\n    highp vec3 v1 = max(lowerClipBound, min(upperClipBound, chunkSize * uVertexBasePosition[vidx.x] + boxLower));\n    highp vec3 v2 = max(lowerClipBound, min(upperClipBound, chunkSize * uVertexBasePosition[vidx.y] + boxLower));\n    highp vec3 vDir = v2 - v1;\n    highp float denom = dot(vDir, uPlaneNormal);\n    if (abs(denom) > ".concat(a,") {\n      highp float lambda = (planeDistance - dot(v1, uPlaneNormal)) / denom;\n      if ((lambda >= -").concat(s,") && (lambda <= (1.0 + ").concat(s,"))) {\n        lambda = clamp(lambda, 0.0, 1.0);\n        highp vec3 position = v1 + lambda * vDir;\n        return position;\n      }\n    }\n  }\n  return vec3(0, 0, 0);\n}\nvec3 getBoundingBoxPlaneIntersectionVertexPosition(vec3 chunkSize, vec3 boxLower, vec3 lowerClipBound, vec3 upperClipBound, int vertexIndex) {\n  return getBoundingBoxPlaneIntersectionVertexPosition(chunkSize, boxLower, lowerClipBound, upperClipBound, vertexIndex, uPlaneDistance);\n}\n"))}function h(e,t,n,r,o,u,h){let p=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],f=l(o),g=d.subarray(48*f,48*(f+1)),m=[0,0],v=[i.eR.create(),i.eR.create()],y=i.eR.create(),b=i.eR.create(),S=e=>c.subarray(3*e,3*e+3);for(let l=0;l<4;++l){for(let r=0;r<2;++r)m[r]=g[2*(4*h+l)+r],i.eR.multiply(v[r],e,S(m[r])),i.eR.add(v[r],v[r],u),i.eR.min(v[r],v[r],n),i.eR.max(v[r],v[r],t);i.eR.subtract(y,v[1],v[0]);let c=i.eR.dot(y,o);if(Math.abs(c)>a){let e=(r-i.eR.dot(v[0],o))/c;if(e>=-s&&e<=1+s)return p&&console.log("vertex ".concat(h,", e = ").concat(l,", good, lambda=").concat(e,", denom=").concat(c,", v0=").concat(v[0].join(),", vDir=").concat(y.join())),e=Math.max(0,Math.min(1,e)),i.eR.scaleAndAdd(b,v[0],y,e),b;p&&console.log("vertex ".concat(h,", e = ").concat(l,", skipped, denom = ").concat(c,", ")+"vDir = ".concat(y.join(),", v0=").concat(v[0].join(),", v1=").concat(v[1].join())+"uPlaneNormal = ".concat((0,i.nL)(o),", ")+"lambda=".concat(e))}else p&&console.log("vertex ".concat(h,", e = ").concat(l,", skipped, deom = ").concat(c,", ")+"vDir = ".concat((0,i.nL)(y),", uPlaneNormal = ").concat((0,i.nL)(o),", ")+"uLowerClipBound=".concat(t.join(),", uUpperClipBound=").concat(n.join(),", ")+"chunkSize=".concat(e,", uVertexBasePosition(v0)=").concat(S(m[0]).join(),", ")+"uVertexBasePosition(v1)=".concat(S(m[1]).join(),", ")+"uTranslation=".concat(u.join()))}}function p(e,t,n,s,a){const c=(0,i.uD)(r,t,s);i.eR.normalize(c,c);!function(e,t,n){const i=e.gl;i.uniform3fv(e.uniform("uPlaneNormal"),t),i.uniform1f(e.uniform("uPlaneDistance"),n);const r=l(t);i.uniform2iv(e.uniform("uVertexIndex"),d.subarray(48*r,48*(r+1)))}(e,c,i.eR.dot(i.eR.transformMat4(o,n,a),c))}},6393:(e,t,n)=>{n.d(t,{i:()=>o});var i=n(3835),r=n(2729);class o{constructor(e,t,n){this.size=i.eR.clone(e),this.transform=i.pB.clone(t),this.finiteRank=n;const o=i.pB.create(),s=r.DI(o,4,t,4,4);if(0===s)throw new Error("Transform is singular");this.invTransform=o,this.detTransform=s}toObject(){return{size:this.size,transform:this.transform,finiteRank:this.finiteRank}}static fromObject(e){return new o(e.size,e.transform,e.finiteRank)}globalToLocalSpatial(e,t){return i.eR.transformMat4(e,t,this.invTransform)}localSpatialVectorToGlobal(e,t){return(0,i.vs)(e,t,this.transform)}globalToLocalNormal(e,t){return(0,i.uD)(e,t,this.transform)}}},6874:(e,t,n)=>{n.d(t,{AK:()=>G,BE:()=>j,Eb:()=>B,ZG:()=>U,Zi:()=>_,kV:()=>F,wb:()=>z});var i=n(974),r=n.n(i),o=n(2982),s=n(6063),a=n.n(s),l=n(5677),c=n.n(l),d=n(5491),u=n.n(d),h=n(6094),p=n(5795),f=n(1434),g=n(5603),m=n(3985),v=n(3056),y=n(156),b=n(6393),S=n(7184),w=n(7562),x=n(3835),C=n(8164),k=n(2311),E=n(6344),T=n(843),L=n(863),P=n(706),D=n(858),M=n(5798),I=n(7799),R=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=c()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&a()(t,n,s),s};class A extends y.TD{}const O=(0,T.Mz)(A);function N(e){return{source:e.source.addCounterpartRef(),effectiveVoxelSize:e.effectiveVoxelSize,layerRank:e.layerRank,nonDisplayLowerClipBound:e.nonDisplayLowerClipBound,nonDisplayUpperClipBound:e.nonDisplayUpperClipBound,lowerClipBound:e.lowerClipBound,upperClipBound:e.upperClipBound,lowerClipDisplayBound:e.lowerClipDisplayBound,upperClipDisplayBound:e.upperClipDisplayBound,chunkDisplayDimensionIndices:e.chunkDisplayDimensionIndices,lowerChunkDisplayBound:e.lowerChunkDisplayBound,upperChunkDisplayBound:e.upperChunkDisplayBound,fixedLayerToChunkTransform:e.fixedLayerToChunkTransform,combinedGlobalLocalToChunkTransform:e.combinedGlobalLocalToChunkTransform,chunkLayout:e.chunkLayout.toObject()}}function _(e){return e.map((e=>e.map(N)))}function V(e,t){for(const n of t)for(const t of n){const n=t.source;e.removeSource(n),n.dispose()}}let B=class extends O{constructor(e,t,n,i){super(new v.tT({parametersConstructor:y.bT,navigationState:n,update:(e,t)=>{const n=e.invViewMatrix,i=e.centerDataPosition;t.toMat4(n);var r=e.displayDimensionRenderInfo;const o=r.canonicalVoxelFactors,s=r.voxelPhysicalScales;for(let f=0;f<3;++f)i[f]=n[12+f];const a=e.logicalWidth,l=e.logicalHeight,c=e.projectionMat,d=e.viewportNormalInGlobalCoordinates,u=e.viewportNormalInCanonicalCoordinates,h=t.relativeDepthRange;x.pB.ortho(c,-a/2,a/2,l/2,-l/2,-h,h),(0,f.sD)(e,c),(0,g.wO)(e);const p=e.viewMatrix;for(let f=0;f<3;++f){const e=d[f]=p[4*f+2];u[f]=e/o[f]}x.eR.normalize(d,d),x.eR.normalize(u,u);let m=0;for(let f=0;f<3;++f){m+=(s[f]*n[f])**2}m=Math.sqrt(m),e.pixelSize=m}})),this.chunkManager=e,this.layerManager=t,this.navigationState=n,this.wireFrame=i,this.gl=this.chunkManager.gl,this.viewChanged=new E.IY,this.renderingStale=!0,this.visibleChunksStale=!0,this.visibleLayerList=new Array,this.offscreenFramebuffer=this.registerDisposer(new P.Mi(this.gl,{colorBuffers:(0,P.Ns)(this.gl,1),depthBuffer:new P.f_(this.gl)})),this.histogramInputTextures=[],this.offscreenFramebuffersWithHistograms=[this.offscreenFramebuffer],this.histogramGenerator=L.h.get(this.gl),this.updateVisibleLayers=this.registerCancellable(u()((()=>{this.updateVisibleLayersNow()}),0)),this.registerDisposer(n),this.registerDisposer(this.projectionParameters),this.registerDisposer(this.projectionParameters.changed.add(((e,t)=>{e.displayDimensionRenderInfo!==t.displayDimensionRenderInfo&&this.updateVisibleLayers()})));const r=this.chunkManager.rpc,o=this.sharedProjectionParameters=this.registerDisposer(new v.jL(r,this.projectionParameters));this.initializeCounterpart(r,{chunkManager:e.rpcId,projectionParameters:o.rpcId}),this.registerDisposer(t.layersChanged.add((()=>{this.updateVisibleLayers()}))),this.wireFrame.changed.add(this.viewChanged.dispatch),this.viewChanged.add((()=>{this.renderingStale=!0})),this.registerDisposer(e.chunkQueueManager.visibleChunksChanged.add(this.viewChanged.dispatch)),this.updateVisibleLayers()}get displayDimensionRenderInfo(){return this.navigationState.displayDimensionRenderInfo}computeHistograms(e,t){this.histogramGenerator.compute(e,this.offscreenFramebuffer.depthBuffer.texture,this.histogramInputTextures,t,this.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber)}flushBackendProjectionParameters(){this.sharedProjectionParameters.flush()}forEachVisibleChunk(e,t,n){(0,y.xd)(this.projectionParameters.value,e.renderLayer.localPosition.value,e,t,(()=>{n(e.curPositionInChunks.join())}))}isReady(){if(!this.navigationState.valid)return!1;this.updateVisibleLayers.flush(),this.updateVisibleSources();let e=0,t=0;for(const n of this.visibleLayers.values()){const i=n.visibleSources;for(const n of i){const i=(0,y.BA)(this.projectionParameters.value,n.chunkLayout),r=n.source.chunks;this.forEachVisibleChunk(n,i,(n=>{const i=r.get(n);++t,i&&i.state===h.HU.GPU_MEMORY&&++e}))}}return e===t}invalidateVisibleSources(){super.invalidateVisibleSources(),this.viewChanged.dispatch()}bindVisibleRenderLayer(e,t){t.push(e.localPosition.changed.add((()=>this.invalidateVisibleChunks()))),t.push(e.redrawNeeded.add(this.viewChanged.dispatch)),t.push(e.transform.changed.add(this.updateVisibleLayers)),t.push(e.renderScaleTarget.changed.add((()=>this.invalidateVisibleSources())));const n=e.renderScaleHistogram;void 0!==n&&t.push(n.visibility.add(this.visibility)),t.push(e.dataHistogramSpecifications.producerVisibility.add(this.visibility))}updateVisibleLayersNow(){if(this.wasDisposed)return!1;if(!this.navigationState.valid)return!1;const e=Date.now(),t=this.visibleLayers,n=this.visibleLayerList,i=this.projectionParameters.value.displayDimensionRenderInfo;let r=this.rpc,s={id:this.rpcId},a=!1;n.length=0;for(let o of this.layerManager.readyRenderLayers())if(o instanceof S.X){n.push(o);let l=t.get(o);if(void 0===l){const n=[],r=new C.Mf;l={messages:r,allSources:this.getTransformedSources(o,r),transformGeneration:o.transform.changed.count,visibleSources:[],disposers:n,lastSeenGeneration:e,displayDimensionRenderInfo:i},n.push(o.messages.addChild(l.messages)),t.set(o.addRef(),l),this.bindVisibleRenderLayer(o,n)}else{l.lastSeenGeneration=e;const t=o.transform.changed.count;if(l.transformGeneration===t&&l.displayDimensionRenderInfo===i)continue;const n=l.allSources;l.allSources=this.getTransformedSources(o,l.messages),V(o,n),l.visibleSources.length=0,l.displayDimensionRenderInfo=i,l.transformGeneration=t}s.layerId=o.rpcId,s.sources=_(l.allSources),this.flushBackendProjectionParameters(),r.invoke(y.vX,s),a=!0}for(const c of t){var l=(0,o.A)(c,2);const n=l[0],i=l[1];i.lastSeenGeneration!==e&&(s.layerId=n.rpcId,r.invoke(y.SJ,s),t.delete(n),V(n,i.allSources),(0,w.$F)(i.disposers),n.dispose(),a=!0)}return a&&(this.visibleSourcesStale=!0),this.viewChanged.dispatch(),a}invalidateVisibleChunks(){super.invalidateVisibleChunks(),this.viewChanged.dispatch()}get valid(){return this.navigationState.valid}getOffscreenFramebufferWithHistograms(e){const t=this.offscreenFramebuffersWithHistograms;let n=t[e];if(void 0===n){const i=this.gl,r=this.histogramInputTextures,o=this.offscreenFramebuffer;r.length<e&&r.push(...(0,P.Ns)(i,e-r.length,WebGL2RenderingContext.R8,WebGL2RenderingContext.RED));let s=[o.colorBuffers[0].addRef()];for(let t=0;t<e;++t)s.push(r[t].addRef());n=this.registerDisposer(new P.Mi(i,{colorBuffers:s,depthBuffer:o.depthBuffer.addRef()})),t[e]=n}return n}updateRendering(){const e=this.projectionParameters.value,t=e.width,n=e.height;if(!this.renderingStale||!this.valid||0===t||0===n)return;this.renderingStale=!1,this.updateVisibleLayers.flush(),this.updateVisibleSources();let i=this.gl,r=this.offscreenFramebuffer;r.bind(t,n),i.disable(i.SCISSOR_TEST),i.clearColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clear(WebGL2RenderingContext.COLOR_BUFFER_BIT);let o=0;const s=this.wireFrame.value,a={sliceView:this,projectionParameters:e,wireFrame:s};for(let l of this.visibleLayerList){const e=s?0:l.getDataHistogramCount();this.getOffscreenFramebufferWithHistograms(e).bind(t,n);for(let t=0;t<e;++t)i.clearBufferfv(WebGL2RenderingContext.COLOR,1+t,x.yb);i.enable(WebGL2RenderingContext.DEPTH_TEST),i.depthFunc(WebGL2RenderingContext.LESS),i.clearDepth(1),i.clear(WebGL2RenderingContext.DEPTH_BUFFER_BIT),l.setGLBlendMode(i,o),l.draw(a),++o}i.disable(WebGL2RenderingContext.BLEND),i.disable(WebGL2RenderingContext.DEPTH_TEST),r.unbind()}disposed(){for(const t of this.visibleLayers){var e=(0,o.A)(t,2);const n=e[0],i=e[1];V(n,i.allSources),(0,w.$F)(i.disposers),n.dispose()}this.visibleLayers.clear(),this.visibleLayerList.length=0}getTransformedSources(e,t){const n=G(this.projectionParameters.value.displayDimensionRenderInfo,e.transform.value,(t=>e.getSources(t)),t,e);for(const i of n)for(const t of i)e.addSource(t.source,t.chunkTransform);return n}};B=R([(0,I.R6)(y.WC)],B);class F extends p.PU{constructor(e,t){super(e,t),this.spec=t.spec}static encodeSpec(e){return{chunkDataSize:r()(e.chunkDataSize),lowerVoxelBound:r()(e.lowerVoxelBound),upperVoxelBound:r()(e.upperVoxelBound)}}static encodeOptions(e){const t=super.encodeOptions(e);return t.spec=this.encodeSpec(e.spec),t}initializeCounterpart(e,t){t.spec=this.spec,super.initializeCounterpart(e,t)}}class U extends p.AA{constructor(e,t){super(e),this.chunkGridPosition=t.chunkGridPosition,this.state=h.HU.SYSTEM_MEMORY}}class z extends w.O8{constructor(e,t){super(),this.gl=e,this.copyVertexPositionsBuffer=(0,M.kl)(this.gl),this.textureCoordinateAdjustment=new Float32Array(4);let n=new D.N5(e);n.addVarying("vec2","vTexCoord"),n.addUniform("sampler2D","uSampler"),n.addInitializer((t=>{e.uniform1i(t.uniform("uSampler"),0)})),n.addUniform("vec4","uColorFactor"),n.addUniform("vec4","uBackgroundColor"),n.addUniform("mat4","uProjectionMatrix"),n.addUniform("vec4","uTextureCoordinateAdjustment"),n.require(t),n.setFragmentMain("\nvec4 sampledColor = texture(uSampler, vTexCoord);\nif (sampledColor.a == 0.0) {\n  sampledColor = uBackgroundColor;\n}\nemit(sampledColor * uColorFactor, 0u);\n"),n.addAttribute("vec4","aVertexPosition"),n.setVertexMain("\nvTexCoord = uTextureCoordinateAdjustment.xy + 0.5 * (aVertexPosition.xy + 1.0) * uTextureCoordinateAdjustment.zw;\ngl_Position = uProjectionMatrix * aVertexPosition;\n"),this.shader=this.registerDisposer(n.build())}draw(e,t,n,i,r,o,s,a){let l=this.gl,c=this.shader,d=this.textureCoordinateAdjustment;d[0]=r,d[1]=o,d[2]=s-r,d[3]=a-o,c.bind(),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,e),l.disable(WebGL2RenderingContext.BLEND),l.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,t),l.uniform4fv(c.uniform("uColorFactor"),n),l.uniform4fv(c.uniform("uBackgroundColor"),i),l.uniform4fv(c.uniform("uTextureCoordinateAdjustment"),d);let u=c.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(u,2),l.drawArrays(l.TRIANGLE_FAN,0,4),l.disableVertexAttribArray(u),l.bindTexture(l.TEXTURE_2D,null)}static get(e,t){return e.memoize.get("sliceview/SliceViewRenderHelper:".concat((0,k.R)(t)),(()=>new z(e,t)))}}class j{constructor(e){this.chunkManager=e}}function G(e,t,n,i,o){i.clearMessages();const s=e=>(i.addMessage({severity:C.TU.error,message:e}),[]);if(void 0!==t.error)return s(t.error);const a=t.rank,l=t.unpaddedRank,c=e.displayDimensionIndices,d=e.displayRank,u=e.canonicalVoxelFactors,h=(0,m.IH)(t,c),p=h.displayToLayerDimensionIndices,f=new Float32Array(d*l),g=t.modelToRenderLayerTransform;for(let r=0;r<d;++r){const e=p[r];if(-1===e)continue;const t=u[r];for(let n=0;n<l;++n)f[d*n+r]=g[(a+1)*n+e]*t}const v=n({displayRank:d,multiscaleToViewTransform:f,modelChannelDimensionIndices:t.channelToRenderLayerDimensions}),y=e.voxelPhysicalScales;try{const e=e=>{const n=e.chunkSource,i=n.spec;var r=e.lowerClipBound;const s=void 0===r?i.lowerVoxelBound:r;var a=e.upperClipBound;const c=void 0===a?i.upperVoxelBound:a,u=(0,m.pe)(t,e.chunkToMultiscaleTransform),p=i.chunkDataSize,f=u.channelToChunkDimensionIndices,g=new Float32Array(l),v=new Float32Array(l);g.set(s),v.set(c);const S=f.length,w=t.channelSpaceShape;for(let o=0;o<S;++o){const e=f[o];if(-1===e)continue;const n=w[o];if(p[e]!==n)throw new Error("Channel dimension "+t.layerDimensionNames[t.channelToRenderLayerDimensions[o]]+" has extent ".concat(n," but corresponding chunk dimension has extent ")+"".concat(p[e]));g[e]=Number.NEGATIVE_INFINITY,v[e]=Number.POSITIVE_INFINITY}const C=(0,m.SZ)(u,h),k=x.eR.create(),E=x.eR.create(),T=x.eR.create(),L=x.eR.create(),P=x.eR.create(),D=C.numChunkDisplayDims,M=C.chunkDisplayDimensionIndices,I=u.combinedGlobalLocalToChunkTransform,R=u.layerRank,A=u.combinedGlobalLocalRank,O=new Float32Array(I);for(let t=0;t<D;++t){const e=M[t];for(let t=0;t<=A;++t)O[e+t*R]=0;e<l?(P[t]=i.chunkDataSize[e],k[t]=i.lowerChunkBound[e],E[t]=i.upperChunkBound[e],T[t]=s[e],L[t]=c[e],g[e]=Number.NEGATIVE_INFINITY,v[e]=Number.POSITIVE_INFINITY):(P[t]=1,k[t]=0,E[t]=1,T[t]=0,L[t]=1)}P.fill(1,D),k.fill(0,D),E.fill(1,D),T.fill(0,D),L.fill(1,D);const N=new b.i(P,C.displaySubspaceModelMatrix,D),_=N.localSpatialVectorToGlobal(x.eR.create(),x.Oi);for(let t=0;t<d;++t)_[t]=Math.abs(_[t]*y[t]);return _.fill(1,d),{layerRank:R,lowerClipBound:s,upperClipBound:c,nonDisplayLowerClipBound:g,nonDisplayUpperClipBound:v,renderLayer:o,source:n,lowerChunkDisplayBound:k,upperChunkDisplayBound:E,lowerClipDisplayBound:T,upperClipDisplayBound:L,effectiveVoxelSize:_,chunkLayout:N,chunkDisplayDimensionIndices:M,fixedLayerToChunkTransform:O,curPositionInChunks:new Float32Array(l),combinedGlobalLocalToChunkTransform:u.combinedGlobalLocalToChunkTransform,fixedPositionWithinChunk:new Uint32Array(l),chunkTransform:u,chunkDisplayTransform:C}};return v.map((t=>t.map((t=>e(t)))))}catch(S){for(const e of v)for(const t of e){t.chunkSource.dispose()}const t=e.globalDimensionNames,n=r()(e.displayDimensionIndices.filter((e=>-1!==e)),(e=>t[e])).join(",\xa0");return s("Cannot render (".concat(n,") cross section: ").concat(S.message))}}},7184:(e,t,n)=>{n.d(t,{X:()=>f,j:()=>g});var i=n(3651),r=n.n(i),o=n(608),s=n.n(o),a=n(5795),l=n(3436),c=n(3056),d=n(6210),u=n(156),h=n(7160),p=n(863);class f extends c.er{constructor(e,t,n){var i;super(),this.chunkManager=e,this.multiscaleSource=t,this.rpcId=null,this.rpcTransfer={},this.visibleSources=new(s()),this.visibleSourcesList_=[];var r=n.renderScaleTarget;const o=void 0===r?(0,l.fm)(1):r;this.renderScaleTarget=o,this.renderScaleHistogram=n.renderScaleHistogram,this.transform=n.transform,this.localPosition=n.localPosition,this.rpcTransfer=n.rpcTransfer||{},this.dataHistogramSpecifications=this.registerDisposer(null!==(i=n.dataHistogramSpecifications)&&void 0!==i?i:new p.B((0,h.XZ)([]),(0,h.XZ)([]))),this.registerDisposer(this.dataHistogramSpecifications.visibility.changed.add(this.redrawNeeded.dispatch))}getDataHistogramCount(){const e=this.dataHistogramSpecifications;return e.visibility.visible?e.bounds.value.length:0}getSources(e){return this.multiscaleSource.getSources(e)}addSource(e,t){const n=this.visibleSources,i=n.get(e);void 0!==i?(++i.refCount,i.chunkTransform=t):(n.set(e,{source:e,refCount:1,chunkTransform:t}),this.visibleSourcesList_.length=0)}removeSource(e){const t=this.visibleSources,n=t.get(e);1!==n.refCount?--n.refCount:(t.delete(e),this.visibleSourcesList_.length=0)}get visibleSourcesList(){const e=this.visibleSources,t=this.visibleSourcesList_;if(0===t.length&&0!==e.size){for(const n of e.values())t.push(n);t.sort(((e,t)=>e.chunkTransform.chunkToLayerTransformDet-t.chunkTransform.chunkToLayerTransformDet))}return t}initializeCounterpart(){const e=this.registerDisposer(new a.tB(this.layerChunkProgressInfo)),t=this.chunkManager.rpc;e.RPC_TYPE_ID=this.RPC_TYPE_ID,e.initializeCounterpart(t,r()({localPosition:this.registerDisposer(d.a.makeFromExisting(t,this.localPosition)).rpcId,renderScaleTarget:this.registerDisposer(d.a.makeFromExisting(t,this.renderScaleTarget)).rpcId},this.rpcTransfer)),this.rpcId=e.rpcId}get gl(){return this.chunkManager.chunkQueueManager.gl}setGLBlendMode(e,t){t>0?(e.enable(WebGL2RenderingContext.BLEND),e.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA)):e.disable(WebGL2RenderingContext.BLEND)}filterVisibleSources(e,t){return(0,u.N9)(e,this,t)}}f.prototype.RPC_TYPE_ID=u.oq;class g extends c.aR{draw(e,t){}isReady(e,t){return!0}}},7779:(e,t,n)=>{n.d(t,{pe:()=>a.pe,rU:()=>i,vn:()=>p});var i,r=n(3651),o=n.n(r),s=n(156),a=n(9043),l=n(3835),c=n(2729),d=n(9799);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.IMAGE=1]="IMAGE",e[e.SEGMENTATION=2]="SEGMENTATION"}(i||(i={}));function u(e){const t=e.rank,n=e.dataType,i=e.compressedSegmentationBlockSize;var r=e.baseVoxelOffset;const a=void 0===r?new Float32Array(t):r;return o()(o()({},(0,s._g)(e)),{compressedSegmentationBlockSize:i,baseVoxelOffset:a,dataType:n})}function h(e){let t=e.rank,n=e.lowerVoxelBound,r=e.upperVoxelBound;if(!function(e){if(void 0!==e.compressedSegmentationBlockSize)return!1;if(e.volumeType!==i.SEGMENTATION&&!e.volumeSourceOptions.discreteValues)return!1;switch(e.dataType){case a.pe.UINT32:case a.pe.UINT64:break;default:return!1}switch(e.rank){case 3:return!0;case 4:return 1===e.chunkDataSize[3];default:return!1}}(e))return u(e);var l=e.volumeSourceOptions;let h=l.displayRank,p=l.multiscaleToViewTransform,f=e.chunkToMultiscaleTransform,g=e.chunkToViewTransform;void 0===g&&(g=c.lw(new Float32Array(t*h),h,p,h,f,t+1,h,t,t));const m=e.maxCompressedSegmentationBlockSize,v=e.chunkDataSize;return u(o()(o()({},e),{compressedSegmentationBlockSize:Float32Array.from((0,s.xO)({rank:t,chunkToViewTransform:g,displayRank:h,lowerVoxelBound:n,upperVoxelBound:r,maxVoxelsPerChunkLog2:9,maxBlockSize:void 0===m?v:d.jk(new Uint32Array(t),v,m)}))}))}function p(e){const t=e.rank;var n=e.volumeSourceOptions;const i=n.displayRank,r=n.multiscaleToViewTransform,a=n.modelChannelDimensionIndices,d=e.chunkToMultiscaleTransform,u=c.lw(new Float32Array(i*t),i,r,i,d,t+1,i,t,t);let p=e.minBlockSize;void 0===p?(p=new Uint32Array(t),p.fill(1)):p=new Uint32Array(p);const f=e.lowerVoxelBound,g=e.upperVoxelBound;if(0!==a.length)for(const o of(0,l.PC)(d,t,a)){let e=g[o];void 0!==f&&(e-=f[o]),p[o]=e}var m=e.chunkDataSizes;return(void 0===m?(0,s.EO)(o()(o()({},e),{minBlockSize:p,chunkToViewTransform:u,displayRank:i})):m).map((t=>h(o()(o()({},e),{chunkDataSize:t,chunkToViewTransform:u}))))}},954:(e,t,n)=>{n.d(t,{Iw:()=>u,OM:()=>p,RS:()=>h,kg:()=>f,m0:()=>c});var i=n(974),r=n.n(i),o=n(3651),s=n.n(o),a=n(6874),l=n(6098);function c(e,t,n,i){const r=t.dataType;t.defineShader(e,n);let o="",s="";if(0===n)o+="highp int ignoredChannelIndex";else for(let l=0;l<n;++l)0!==l&&(o+=", "),o+="highp int channelIndex".concat(l),s+=", channelIndex".concat(l);e.addFragmentCode(l.Z6);let a="\n".concat((0,l.mh)(r)," getDataValue(").concat(o,") {\n  highp ivec3 p = ivec3(max(vec3(0.0, 0.0, 0.0), min(floor(").concat(i,"), uChunkDataSize - 1.0)));\n  return getDataValueAt(p").concat(s,");\n}\n").concat((0,l.mh)(r)," getInterpolatedDataValue(").concat(o,") {\n  highp vec3 positionWithinChunk = ").concat(i,";\n  highp ivec3[2] points;\n  points[0] = ivec3(max(vec3(0.0, 0.0, 0.0), min(floor(positionWithinChunk - 0.5), uChunkDataSize - 1.0)));\n  points[1] = ivec3(max(vec3(0.0, 0.0, 0.0), min(ceil(positionWithinChunk - 0.5), uChunkDataSize - 1.0)));\n  highp vec3 mixCoeff = fract(positionWithinChunk - 0.5);\n  ").concat((0,l.mh)(r)," xvalues[2];\n  for (int ix = 0; ix < 2; ++ix) {\n    ").concat((0,l.mh)(r)," yvalues[2];\n    for (int iy = 0; iy < 2; ++iy) {\n      ").concat((0,l.mh)(r)," zvalues[2];\n      for (int iz = 0; iz < 2; ++iz) {\n        zvalues[iz] = getDataValueAt(ivec3(points[ix].x, points[iy].y, points[iz].z)\n                                     ").concat(s,");\n      }\n      yvalues[iy] = mixLinear(zvalues[0], zvalues[1], mixCoeff.z);\n    }\n    xvalues[ix] = mixLinear(yvalues[0], yvalues[1], mixCoeff.y);\n  }\n  return mixLinear(xvalues[0], xvalues[1], mixCoeff.x);\n}\n");e.addFragmentCode(a),n<=1&&e.addFragmentCode("\n".concat((0,l.mh)(r)," getDataValue() { return getDataValue(0); }\n").concat((0,l.mh)(r)," getInterpolatedDataValue() { return getInterpolatedDataValue(0); }\n"))}var d=new Array;function u(e){d.push(e)}class h extends a.kV{constructor(e,t){super(e,t),this.chunkFormatHandler=this.registerDisposer(function(e,t){for(let n of d){let i=n(e,t);if(null!=i)return i}throw new Error("No chunk format handler found.")}(e.chunkQueueManager.gl,this.spec));const n=this.spec.upperVoxelBound.length;this.tempChunkGridPosition=new Float32Array(n),this.tempPositionWithinChunk=new Uint32Array(n)}static encodeSpec(e){const t=e;return s()(s()({},super.encodeSpec(e)),{dataType:t.dataType,compressedSegmentationBlockSize:t.compressedSegmentationBlockSize&&r()(t.compressedSegmentationBlockSize),baseVoxelOffset:r()(t.baseVoxelOffset)})}get chunkFormat(){return this.chunkFormatHandler.chunkFormat}getValueAt(e,t){const n=this.spec.rank,i=this.tempChunkGridPosition,r=this.tempPositionWithinChunk;{const t=this.spec.chunkDataSize;for(let o=0;o<n;++o){const n=e[o],s=t[o],a=Math.floor(n/s);i[o]=a,r[o]=Math.floor(n-s*a)}}const o=this.chunks.get(i.join());if(void 0===o)return null;const s=o.chunkDataSize;for(let p=0;p<3;++p)if(r[p]>=s[p])return;if(0===t.channelSpaceShape.length)return o.getValueAt(r);const a=t.numChannels,l=t.chunkChannelCoordinates,c=t.chunkChannelDimensionIndices,d=c.length;let u=0;const h=new Array(a);for(let p=0;p<a;++p){for(let e=0;e<d;++e)r[c[e]]=l[u++];h[p]=o.getValueAt(r)}return h}getChunk(e){return this.chunkFormatHandler.getChunk(this,e)}}class p extends a.ZG{constructor(e,t){super(e,t),this.chunkDataSize=t.chunkDataSize||e.spec.chunkDataSize}get chunkFormat(){return this.source.chunkFormat}}class f extends a.BE{}},2837:(e,t,n)=>{n.d(t,{r:()=>w});var i=n(6094),r=n(8332),o=n(3985),s=n(156),a=n(8778),l=n(7184),c=n(954),d=n(7160),u=n(3835),h=n(2311),p=n(9080),f=n(6754),g=n(7520),m=n(8913);const v=u.pB.create();function y(e,t,n,i,r,o){const s=n.projectionParameters.value,l=s.centerDataPosition;(0,a.oo)(t,s.viewportNormalInGlobalCoordinates,l,o.transform,o.invTransform),e.uniformMatrix4fv(t.uniform("uProjectionMatrix"),!1,u.pB.multiply(v,i,o.transform)),e.uniform3fv(t.uniform("uLowerClipBound"),r.lowerClipDisplayBound),e.uniform3fv(t.uniform("uUpperClipBound"),r.upperClipDisplayBound)}function b(e,t,n){e.uniform3fv(t.uniform("uChunkDataSize"),n)}function S(e,t,n,i){e.uniform3fv(t.uniform("uTranslation"),n),i?(0,g.wo)(t.gl,6,1):e.drawArrays(e.TRIANGLE_FAN,0,6)}class w extends l.X{constructor(e,t){var n=t.shaderError;const i=void 0===n?(0,p.RH)():n,o=t.shaderParameters;super(e.chunkManager,e,t);const s=this.gl;this.vertexIdHelper=this.registerDisposer(m.u.get(s)),this.shaderParameters=o;const l=t.channelCoordinateSpace;this.channelCoordinateSpace=void 0===l?(0,d.XZ)(r.Nj):l,this.registerDisposer(o.changed.add(this.redrawNeeded.dispatch));const u=this.registerDisposer((0,d.Uq)(((e,t)=>({numChannelDimensions:e.rank,dataHistogramChannelSpecifications:t})),[this.channelCoordinateSpace,this.dataHistogramSpecifications.channels]));this.shaderGetter=(0,p.Wh)(this,s,{memoizeKey:"volume/RenderLayer:".concat((0,h.R)(this.constructor)),fallbackParameters:t.fallbackShaderParameters,parameters:o,encodeParameters:t.encodeShaderParameters,shaderError:i,extraParameters:u,defineShader:(e,t,n,i)=>{const r=t.chunkFormat,o=t.dataHistogramsEnabled,s=i.dataHistogramChannelSpecifications,l=i.numChannelDimensions;if(function(e,t){if((0,m.N)(e),(0,a.xo)(e),e.addUniform("highp vec3","uTranslation"),e.addUniform("highp mat4","uProjectionMatrix"),e.addUniform("highp vec3","uChunkDataSize"),e.addUniform("highp vec3","uLowerClipBound"),e.addUniform("highp vec3","uUpperClipBound"),t)return(0,g.VU)(e),e.setVertexMain("\nint vertexIndex1 = gl_VertexID / ".concat(g.bn,";\nint vertexIndex2 = vertexIndex1 == 5 ? 0 : vertexIndex1 + 1;\nvec3 vertexPosition1 = getBoundingBoxPlaneIntersectionVertexPosition(uChunkDataSize, uTranslation, uLowerClipBound, uUpperClipBound, vertexIndex1);\nvec3 vertexPosition2 = getBoundingBoxPlaneIntersectionVertexPosition(uChunkDataSize, uTranslation, uLowerClipBound, uUpperClipBound, vertexIndex2);\nemitLine(uProjectionMatrix * vec4(vertexPosition1, 1.0),\n         uProjectionMatrix * vec4(vertexPosition2, 1.0),\n         2.0);\n")),void e.setFragmentMain("\nemit(vec4(1.0, 1.0, 1.0, getLineAlpha()));\n");e.addVarying("highp vec3","vChunkPosition"),e.setVertexMain("\nvec3 position = getBoundingBoxPlaneIntersectionVertexPosition(uChunkDataSize, uTranslation, uLowerClipBound, uUpperClipBound, gl_VertexID);\ngl_Position = uProjectionMatrix * vec4(position, 1.0);\ngl_Position.z = 0.0;\nvChunkPosition = (position - uTranslation) +\n    ".concat(.001," * abs(uPlaneNormal);\n"))}(e,null===r),e.addOutputBuffer("vec4","v4f_fragData0",0),e.addFragmentCode("\nvoid emit(vec4 color) {\n  v4f_fragData0 = color;\n}\n"),null===r)return;(0,c.m0)(e,r,l,"vChunkPosition");const d=s.length;if(o&&d>0){let t="";const n=r.dataType;for(let i=0;i<d;++i){const r=s[i].channel,o="out_histogram".concat(i);e.addOutputBuffer("vec4",o,1+i);const a="getDataValue(".concat(r.join(","),")"),l="invlerpForHistogram".concat(i);e.addFragmentCode((0,f.Xh)(e,l,n,!1)),e.addFragmentCode("\nfloat getHistogramValue".concat(i,"() {\n  return invlerpForHistogram").concat(i,"(").concat(a,");\n}\n")),t+="{\nfloat x = getHistogramValue".concat(i,"();\nif (x < 0.0) x = 0.0;\nelse if (x > 1.0) x = 1.0;\nelse x = (1.0 + x * 253.0) / 255.0;\n").concat(o," = vec4(x, x, x, 1.0);\n}")}e.addFragmentCode("void userMain();\nvoid main() {\n  ".concat(t,"\n  userMain();\n}\n#define main userMain\n"))}this.defineShader(e,n)},getContextKey:e=>{var t;return"".concat(null===(t=e.chunkFormat)||void 0===t?void 0:t.shaderKey,"/").concat(e.dataHistogramsEnabled)}}),this.tempChunkPosition=new Float32Array(e.rank),this.initializeCounterpart()}get dataType(){return this.multiscaleSource.dataType}getValueAt(e){let t=this.tempChunkPosition;for(const n of this.visibleSourcesList){const i=n.source,r=n.chunkTransform;if(!(0,o.Mk)(t,e,this.localPosition.value,r.layerRank,r.combinedGlobalLocalToChunkTransform))continue;const s=i.getValueAt(t,r);if(null!=s)return s}return null}beginChunkFormat(e,t,n){const i=this.gl,r=this.dataHistogramSpecifications.visibility.visible,o=this.shaderGetter({chunkFormat:t,dataHistogramsEnabled:r}),s=o.shader,a=o.parameters,l=o.fallback;if(null!==s&&(s.bind(),function(e,t,n){n&&(0,g.Cy)(e,t,1)}(s,n,null===t),null!==t)){if(r){const e=o.extraParameters.dataHistogramChannelSpecifications.length,n=this.dataHistogramSpecifications.bounds.value;for(let i=0;i<e;++i)(0,f.SN)(s,"invlerpForHistogram".concat(i),t.dataType,n[i])}this.initializeShader(e,s,a,l),t.beginDrawing(i,s)}return o}endSlice(e,t,n){}draw(e){const t=e.sliceView,n=t.visibleLayers.get(this).visibleSources;if(0===n.length)return;const r=e.projectionParameters,o=e.wireFrame,a=this.gl;this.vertexIdHelper.enable();const l=u.eR.create(),c=this.renderScaleHistogram;let d;void 0!==c&&c.begin(this.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber);let h,p=null;const f=u.eR.create(),g=()=>{null!==p&&(null!==h&&h.endDrawing(a,p),this.endSlice(t,p,d.parameters))};let m=!0;for(const u of n){const e=(0,s.BA)(r,u.chunkLayout),n=u.chunkTransform.channelToChunkDimensionIndices,C=u.source,k=u.fixedPositionWithinChunk,E=u.chunkDisplayDimensionIndices;for(const t of E)k[t]=0;const T=o?null:C.chunkFormat;if(T!==h&&(h=T,g(),d=this.beginChunkFormat(t,T,r),p=d.shader),null===p)continue;const L=C.chunks;f.fill(1);let P,D=e.size;const M=C.spec.rank;y(a,p,t,r.viewProjectionMat,u,e),null!==T&&T.beginSource(a,p),m=!0;let I=0,R=0;if(t.forEachVisibleChunk(u,e,(e=>{let t=L.get(e);if(t&&t.state===i.HU.GPU_MEMORY){let e=t.chunkDataSize;if(e!==P){P=e;for(let e=0;e<3;++e){const t=E[e];f[e]=-1===t||t>=M?1:P[t]}b(a,p,f)}const i=t.chunkGridPosition;for(let t=0;t<3;++t){const e=E[t];l[t]=-1===e||e>=M?0:D[t]*i[e]}null!==T&&T.bindChunk(a,p,t,k,E,n,m),m=!1,S(a,p,l,o),++I}else++R})),(0!==I||0!==R)&&void 0!==c){const e=u.effectiveVoxelSize,t=(v=e[0],w=e[1],x=e[2],v>w?x>v?v:w>x?w:x:x>w?w:v>x?v:x);c.add(t,t/r.pixelSize,I,R)}}var v,w,x;if(g(),this.vertexIdHelper.disable(),!e.wireFrame){const e=this.getDataHistogramCount();e>0&&t.computeHistograms(e,this.dataHistogramSpecifications)}}}},9859:(e,t,n)=>{n.d(t,{M:()=>r});let i=null;class r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null===i){i=document.createElement("ul"),i.id="statusContainer";const e=document.getElementById("neuroglancer-container");e?e.appendChild(i):document.body.appendChild(i)}let t=document.createElement("li");this.element=t,!0===e&&(e=200),!1!==e?(this.setVisible(!1),this.timer=window.setTimeout(this.setVisible.bind(this,!0),e)):this.timer=null,i.appendChild(t)}dispose(){i.removeChild(this.element),this.element=void 0,null!==this.timer&&clearTimeout(this.timer)}setText(e,t){this.element.textContent=e,t&&this.setVisible(!0)}setHTML(e,t){this.element.innerHTML=e,t&&this.setVisible(!0)}setVisible(e){null!==this.timer&&(clearTimeout(this.timer),this.timer=null),this.element.style.display=e?"block":"none"}static forPromise(e,t){let n=new r(t.delay);n.setText(t.initialMessage);let i=n.dispose.bind(n);return e.then(i,(e=>{let i;i=e instanceof Error?e.message:""+e;var r=t.errorPrefix;let o=void 0===r?"":r;n.setErrorMessage(o+i),n.setVisible(!0)})),e}setErrorMessage(e){this.element.textContent=e+" ";let t=document.createElement("button");t.textContent="Dismiss",t.addEventListener("click",(()=>{this.dispose()})),this.element.appendChild(t)}static showMessage(e){const t=new r;return t.element.textContent=e,t.setVisible(!0),t}static showTemporaryMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;const n=this.showMessage(e);return window.setTimeout((()=>n.dispose()),t),n}}},1245:(e,t,n)=>{n.d(t,{h:()=>o});var i=n(7160),r=n(7970);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return new i.DN(e,r.verifyFloat01)}},7965:(e,t,n)=>{n.d(t,{C_:()=>a,Fo:()=>l,cY:()=>c});var i=n(5491),r=n.n(i),o=n(7562),s=n(6344);class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;this.value_=e,this.defaultValue=t,this.changed=new s.IY}get value(){return this.value_}set value(e){e!==this.value_&&(this.value_=e,this.changed.dispatch())}toggle(){this.value=!this.value}toJSON(){if(this.value_!==this.defaultValue)return this.value_}restoreState(e){this.value=!0!==e&&!1!==e?this.defaultValue:e}reset(){this.value=this.defaultValue}}class l extends o.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.model=e,this.element=document.createElement("input");let n=this.element;n.type="checkbox";const i=()=>{var e;const n=this.model.value;this.element.checked=n,void 0===t.enableTitle&&void 0===t.disableTitle||(this.element.title=null!==(e=n?t.enableTitle:t.disableTitle)&&void 0!==e?e:"")};this.registerDisposer(e.changed.add(i)),i(),this.registerEventListener(n,"change",(function(t){e.value=this.checked})),n.addEventListener("mousedown",(e=>{e.preventDefault()}))}disposed(){let e=this.element,t=e.parentElement;t&&t.removeChild(e),super.disposed()}}class c extends o.O8{constructor(e,t){super(),this.model=e,this.element=t,this.initialDisplay=this.element.style.display,this.updateVisibility(),this.registerDisposer(e.changed.add(this.registerCancellable(r()((()=>this.updateVisibility()),0))))}updateVisibility(){this.element.style.display=this.model.value?this.initialDisplay:"none"}}},7160:(e,t,n)=>{n.d(t,{B0:()=>g,DN:()=>m,DY:()=>M,Kk:()=>y,Uq:()=>x,W1:()=>P,XZ:()=>L,_Y:()=>k,aM:()=>T,no:()=>E,ol:()=>S,pz:()=>w,rG:()=>D,wP:()=>C});var i=n(7797),r=n.n(i),o=n(281),s=n.n(o),a=n(1274),l=n.n(a),c=n(1190),d=n.n(c),u=n(5491),h=n.n(u),p=n(7562),f=n(6344);class g{constructor(e){this.value_=e,this.changed=new f.IY}get value(){return this.value_}set value(e){e!==this.value_&&(this.value_=e,this.changed.dispatch())}}class m extends g{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;super(e),this.validator=t,this.defaultValue=n}toJSON(){if(this.value_!==this.defaultValue)return this.value_}reset(){this.value=this.defaultValue}restoreState(e){if(void 0!==e){let n=this.validator;try{return void(this.value=n(e))}catch(t){}}this.value=this.defaultValue}}class v extends p.O8{constructor(e,t){super(),this.changed=new f.IY,this.f=e,this.ws=t;for(const n of t)this.registerDisposer(n.changed.add(this.changed.dispatch))}get value(){return this.f(...this.ws.map((e=>e.value)))}}function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new v(e,n)}class b extends p.O8{constructor(e,t){super(),this.changed=new f.IY,this.valueGeneration=-1,this.f=e,this.ws=t;for(const n of t)this.registerDisposer(n.changed.add(this.changed.dispatch))}get value(){const e=this.changed.count;return e!==this.valueGeneration&&(this.value_=this.f(...this.ws.map((e=>e.value))),this.valueGeneration=e),this.value_}}function S(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new b(e,n)}class w extends p.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e===t;super(),this.changed=new f.HN,this.value=e.value,this.registerDisposer(e.changed.add((()=>{const n=e.value;t(this.value,n)||(this.value=n,this.changed.dispatch())})))}}function x(e,t,n){const i=new v(e,t),r=new w(i,n);return r.registerDisposer(i),r}class C extends p.O8{constructor(e){super(),this.changed=new f.IY;const t=e(this),n=d()(t),i=()=>{const e=Array.isArray(t)?[]:{};for(const i of n)e[i]=t[i].value;this.value=e,this.changed.dispatch()};i();for(const r of n){const e=t[r];this.registerDisposer(e.changed.add((()=>i())))}}}p.O8;p.O8;class k{constructor(e){this.changed=new f.IY,this.values=void 0===e?new(l()):new(l())(e)}add(e){const t=this.values;return t.has(e)||(t.add(e),this.changed.dispatch()),this}delete(e){return!!this.values.delete(e)&&(this.changed.dispatch(),!0)}has(e){return this.values.has(e)}get size(){return this.values.size}[s()](){return r()(this.values)}clear(){const e=this.values;e.size>0&&(e.clear(),this.changed.dispatch())}}function E(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];let r=n.map((e=>e.value));const o=n.length;let s=new p.O8,a=e(s,...r);const l=h()((()=>{let t=!1;for(let e=0;e<o;++e){const i=n[e].value;r[e]!==i&&(r[e]=i,t=!0)}t&&(s.dispose(),s=new p.O8,a=e(s,...r))}),0),c=n.map((e=>e.changed.add(l)));return{flush(){l.flush()},dispose(){l.cancel(),(0,p.$F)(c),s.dispose()},get value(){return l.flush(),a}}}function T(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];let r=n.map((e=>e.value));const o=n.length;let s=new p.O8,a=e(s,...r);const l=()=>{let t=!1;for(let e=0;e<o;++e){const i=n[e].value;r[e]!==i&&(r[e]=i,t=!0)}t&&(s.dispose(),s=new p.O8,a=e(s,...r))},c=n.map((e=>e.changed.add(l)));return{dispose(){(0,p.$F)(c),s.dispose()},get value(){return a}}}function L(e){return{changed:f.$$,value:e}}function P(e,t){return e(t.value),t.changed.add((()=>e(t.value)))}class D{constructor(e,t){this.outer=e,this.getInner=t,this.changed=new f.IY,this.update=()=>{const e=this.disposer,t=this.outer;void 0!==e&&e();const n=this.inner=this.getInner(t.value);this.disposer=n.changed.add(this.changed.dispatch),this.changed.dispatch()},e.changed.add(this.update),this.update()}dispose(){this.outer.changed.remove(this.update),this.disposer()}get value(){return this.inner.value}set value(e){this.inner.value=e}}class M extends D{reset(){this.inner.reset()}restoreState(e){this.inner.restoreState(e)}toJSON(){return this.inner.toJSON()}}},3893:(e,t,n)=>{n.d(t,{Ok:()=>_t});var i=n(3651),r=n.n(i),o=n(984),s=n.n(o),a=n(2982),l=n(608),c=n.n(l),d=n(974),u=n.n(d),h=n(1274),p=n.n(h),f=n(1767),g=n(8614),m=n(9063),v=n(8178),y=n.n(v),b=n(6063),S=n.n(b),w=n(5677),x=n.n(w),C=n(2108),k=n(8778),E=n(9735),T=n(3835),L=n(605),P=n(9981),D=n(9182),M=n(7520),I=n(858),R=n(6098),A=n(8913);const O=1+L.rE,N=O+L.Z9,_=N+6,V=Float32Array.from([0,0,0,0,0,1,O+0,1,0,0,1,0,1,O+1,0,1,0,0,1,1,O+2,1,1,0,1,1,1,O+3,0,0,0,0,1,0,O+4,0,0,1,0,1,1,O+5,1,0,0,1,1,0,O+6,1,0,1,1,1,1,O+7,0,0,0,1,0,0,O+8,0,0,1,1,0,1,O+9,0,1,0,1,1,0,O+10,0,1,1,1,1,1,O+11]),B=T.pB.create(),F=new Float32Array(6);class U extends C.sP{constructor(){super(...arguments),this.vertexIdHelper=this.registerDisposer(A.u.get(this.gl))}defineShader(e){(0,A.N)(e);const t=this.rank;(0,R.dt)(e,"float",WebGL2RenderingContext.FLOAT,!1,"Bounds",t,2),e.addUniform("vec3","uModelSpaceBoundOffsets",2)}enable(e,t,n){T.pB.invert(B,t.modelViewProjectionMatrix),(0,T.bS)(B,F);const i=t.chunkDisplayTransform.numChunkDisplayDims;for(let r=0;r<i;++r)F[r]=0,F[r+3]=0;for(let r=i;r<3;++r){const e=Math.abs(F[r+3]-F[r]);F[r]-=e,F[r+3]+=e}super.enable(e,t,(e=>{const i=e.vertexShaderInputBinders.Bounds;i.enable(1);const r=this.gl;r.uniform3fv(e.uniform("uModelSpaceBoundOffsets"),F),r.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,t.buffer.buffer),i.bind(this.geometryDataStride,t.bufferOffset);const o=this.vertexIdHelper;o.enable(),n(e),o.disable(),i.disable()}))}}function z(e){e.addVertexCode("\nvoid setBoundingBoxBorderWidth(float width) {}\nvoid setBoundingBoxBorderColor(vec4 color) {}\n")}function j(e){e.addVertexCode("\nvoid setBoundingBoxFillColor(vec4 color) {}\n")}function G(e){j(e),e.addVertexCode("\nfloat ng_lineWidth;\nvoid setBoundingBoxBorderWidth(float size) {\n  ng_lineWidth = size;\n}\nvoid setBoundingBoxBorderColor(vec4 color) {\n  vColor = color;\n}\n")}(0,C.rK)(f.UJ.AXIS_ALIGNED_BOUNDING_BOX,{sliceViewRenderHelper:class extends U{constructor(){super(...arguments),this.faceShaderGetter=this.getDependentShader("annotation/boundingBox/crossSection/face",(e=>{const t=this.rank;super.defineShader(e),(0,k.xo)(e),(0,M.VU)(e),e.addVarying("highp float","vClipCoefficient"),G(e),e.setVertexMain("\nfloat modelPositionA[".concat(t,"] = getBounds0();\nfloat modelPositionB[").concat(t,"] = getBounds1();\nfor (int i = 0; i < ").concat(t,"; ++i) {\n  float a = modelPositionA[i];\n  float b = modelPositionB[i];\n  modelPositionA[i] = min(a, b);\n  modelPositionB[i] = max(a, b);\n}\nvClipCoefficient = getMaxSubspaceClipCoefficient(modelPositionA, modelPositionB);\nif (vClipCoefficient == 0.0) {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n  return;\n}\nvec3 subspacePositionA = projectModelVectorToSubspace(modelPositionA) + uModelSpaceBoundOffsets[0];\nvec3 subspacePositionB = projectModelVectorToSubspace(modelPositionB) + uModelSpaceBoundOffsets[1];\nint vertexIndex1 = gl_VertexID / ").concat(M.bn,";\nint vertexIndex2 = vertexIndex1 == 5 ? 0 : vertexIndex1 + 1;\nvec3 vertexPosition1 = getBoundingBoxPlaneIntersectionVertexPosition(subspacePositionB - subspacePositionA, subspacePositionA, subspacePositionA, subspacePositionB, vertexIndex1);\nvec3 vertexPosition2 = getBoundingBoxPlaneIntersectionVertexPosition(subspacePositionB - subspacePositionA, subspacePositionA, subspacePositionA, subspacePositionB, vertexIndex2);\nng_lineWidth = 1.0;\n").concat(this.invokeUserMain,"\nemitLine(uModelViewProjection * vec4(vertexPosition1, 1.0),\n         uModelViewProjection * vec4(vertexPosition2, 1.0),\n         ng_lineWidth);\n").concat(this.setPartIndex(e),";\n")),e.setFragmentMain("\nemitAnnotation(vec4(vColor.rgb, vColor.a * getLineAlpha() * vClipCoefficient));\n")})),this.fillShaderGetter=this.getDependentShader("annotation/boundingBox/crossSection/fill",(e=>{const t=this.rank;super.defineShader(e),(0,k.xo)(e),e.addVarying("highp float","vClipCoefficient"),function(e){z(e),e.addVertexCode("\nvoid setBoundingBoxFillColor(vec4 color) {\n  vColor = color;\n}\n")}(e),e.setVertexMain("\nfloat modelPositionA[".concat(t,"] = getBounds0();\nfloat modelPositionB[").concat(t,"] = getBounds1();\nfor (int i = 0; i < ").concat(t,"; ++i) {\n  float a = modelPositionA[i];\n  float b = modelPositionB[i];\n  modelPositionA[i] = min(a, b);\n  modelPositionB[i] = max(a, b);\n}\nvClipCoefficient = getMaxSubspaceClipCoefficient(modelPositionA, modelPositionB);\nif (vClipCoefficient == 0.0) {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n  return;\n}\nvec3 subspacePositionA = projectModelVectorToSubspace(modelPositionA) + uModelSpaceBoundOffsets[0];\nvec3 subspacePositionB = projectModelVectorToSubspace(modelPositionB) + uModelSpaceBoundOffsets[1];\nint vertexIndex = gl_VertexID;\nvec3 vertexPosition = getBoundingBoxPlaneIntersectionVertexPosition(subspacePositionB - subspacePositionA, subspacePositionA, subspacePositionA, subspacePositionB, vertexIndex);\ngl_Position = uModelViewProjection * vec4(vertexPosition, 1);\n").concat(this.invokeUserMain,"\n").concat(this.setPartIndex(e),";\n")),e.setFragmentMain("\nemitAnnotation(vec4(vColor.rgb, vColor.a * vClipCoefficient));\n")}))}enableForBoundingBox(e,t,n){super.enable(e,t,(e=>{const i=t.renderContext.sliceView.projectionParameters.value;(0,k.oo)(e,i.viewportNormalInGlobalCoordinates,i.centerDataPosition,t.renderSubspaceModelMatrix,t.renderSubspaceInvModelMatrix),n(e)}))}draw(e){this.shaderControlState.parseResult.value.code.match(/\bsetBoundingBoxFillColor\b/)&&this.enableForBoundingBox(this.fillShaderGetter,e,(()=>{(0,I.Ym)(this.gl,WebGL2RenderingContext.TRIANGLE_FAN,0,6,e.count)})),this.enableForBoundingBox(this.faceShaderGetter,e,(t=>{(0,M.Cy)(t,e.renderContext.projectionParameters,1),(0,M.wo)(t.gl,6,e.count)}))}},perspectiveViewRenderHelper:class extends U{constructor(){super(...arguments),this.edgeBoxCornerOffsetsBuffer=this.registerDisposer(P.h.fromData(this.gl,(0,E.CS)(V,7,1,M.bn))),this.edgeShaderGetter=this.getDependentShader("annotation/boundingBox/projection/border",(e=>{const t=this.rank;this.defineShader(e),(0,M.VU)(e),e.addAttribute("highp vec3","aBoxCornerOffset1"),e.addAttribute("highp vec4","aBoxCornerOffset2"),e.addVarying("highp float","vClipCoefficient"),G(e),e.setVertexMain("\nfloat modelPositionA[".concat(t,"] = getBounds0();\nfloat modelPositionB[").concat(t,"] = getBounds1();\nvec3 subspacePositionA = projectModelVectorToSubspace(modelPositionA) + uModelSpaceBoundOffsets[0];\nvec3 subspacePositionB = projectModelVectorToSubspace(modelPositionB) + uModelSpaceBoundOffsets[1];\nvec3 endpointA = mix(subspacePositionA, subspacePositionB, aBoxCornerOffset1);\nvec3 endpointB = mix(subspacePositionA, subspacePositionB, aBoxCornerOffset2.xyz);\nvClipCoefficient = getMaxSubspaceClipCoefficient(modelPositionA, modelPositionB);\nif (vClipCoefficient == 0.0) {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n  return;\n}\nng_lineWidth = 1.0;\n").concat(this.invokeUserMain,"\nemitLine(uModelViewProjection * vec4(endpointA, 1.0),\n         uModelViewProjection * vec4(endpointB, 1.0),\n         ng_lineWidth);\n").concat(this.setPartIndex(e,"uint(aBoxCornerOffset2.w)"),";\n")),e.setFragmentMain("\nemitAnnotation(vec4(vColor.rgb, getLineAlpha() * vClipCoefficient));\n")})),this.boxCornerOffsetsBuffer=this.registerDisposer(P.h.fromData(this.gl,(0,E.CS)(k.qX,3,1,D.d$))),this.cornerShaderGetter=this.getDependentShader("annotation/boundingBox/projection/corner",(e=>{const t=this.rank;this.defineShader(e),(0,D.fg)(e,this.targetIsSliceView),e.addAttribute("highp vec3","aBoxCornerOffset"),e.addVarying("highp float","vClipCoefficient"),G(e),e.setVertexMain("\nfloat modelPositionA[".concat(t,"] = getBounds0();\nfloat modelPositionB[").concat(t,"] = getBounds1();\nvClipCoefficient = getMaxEndpointSubspaceClipCoefficient(modelPositionA, modelPositionB);\nif (vClipCoefficient == 0.0) {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n  return;\n}\nvec3 subspacePositionA = projectModelVectorToSubspace(modelPositionA) + uModelSpaceBoundOffsets[0];\nvec3 subspacePositionB = projectModelVectorToSubspace(modelPositionB) + uModelSpaceBoundOffsets[1];\nvec3 vertexPosition = mix(subspacePositionA, subspacePositionB, aBoxCornerOffset);\nemitCircle(uModelViewProjection * vec4(vertexPosition, 1.0), ng_lineWidth, 0.0);\nuint cornerIndex = uint(aBoxCornerOffset.x + aBoxCornerOffset.y * 2.0 + aBoxCornerOffset.z * 4.0);\nuint cornerPickOffset = ").concat(1,"u + cornerIndex;\n").concat(this.setPartIndex(e,"cornerPickOffset"),";\n")),e.setFragmentMain("\nvec4 borderColor = vec4(0.0, 0.0, 0.0, 1.0);\nvec4 color = getCircleColor(vColor, borderColor);\ncolor.a *= vClipCoefficient;\nemitAnnotation(color);\n")}))}drawEdges(e){const t=this.gl;this.enable(this.edgeShaderGetter,e,(n=>{const i=n.attribute("aBoxCornerOffset1"),r=n.attribute("aBoxCornerOffset2");this.edgeBoxCornerOffsetsBuffer.bindToVertexAttrib(i,3,WebGL2RenderingContext.FLOAT,!1,28,0),this.edgeBoxCornerOffsetsBuffer.bindToVertexAttrib(r,4,WebGL2RenderingContext.FLOAT,!1,28,12),(0,M.Cy)(n,e.renderContext.projectionParameters,1),(0,M.wo)(t,L.Z9,e.count),t.disableVertexAttribArray(i),t.disableVertexAttribArray(r)}))}drawCorners(e){const t=this.gl;this.enable(this.cornerShaderGetter,e,(n=>{const i=n.attribute("aBoxCornerOffset");this.boxCornerOffsetsBuffer.bindToVertexAttrib(i,3,WebGL2RenderingContext.FLOAT,!1),(0,D.Yu)(n,e.renderContext.projectionParameters,{featherWidthInPixels:0}),(0,D.aK)(n.gl,L.rE,e.count),t.disableVertexAttribArray(i)}))}draw(e){this.drawEdges(e),this.drawCorners(e)}},defineShaderNoOpSetters(e){j(e),z(e)},pickIdsPerInstance:_,snapPosition(e,t,n,i){const r=e.length,o=new Float32Array(t,n,2*r);i>=1&&i<O&&function(e,t){const n=e.length;for(let i=0;i<n;++i){const r=t[i],o=t[i+n],s=e[i];e[i]=Math.abs(r-s)<Math.abs(o-s)?r:o}}(e,o)},getRepresentativePoint(e,t,n){e.set(t.pointA)},updateViaRepresentativePoint(e,t,n){const i=t.length,o=e.pointA,s=e.pointB,a=new Float32Array(i),l=new Float32Array(i);for(let r=0;r<i;++r){const e=a[r]=t[r];l[r]=s[r]+(e-o[r])}return r()(r()({},e),{pointA:a,pointB:l})}});function W(e){e.addVertexCode("\nvoid setEndpointMarkerSize(float startSize, float endSize) {}\nvoid setEndpointMarkerBorderWidth(float startSize, float endSize) {}\nvoid setEndpointMarkerColor(vec4 startColor, vec4 endColor) {}\nvoid setEndpointMarkerBorderColor(vec4 startColor, vec4 endColor) {}\n")}function H(e){e.addVertexCode("\nvoid setLineWidth(float width) {}\nvoid setLineColor(vec4 startColor, vec4 endColor) {}\n")}class q extends C.sP{constructor(){super(...arguments),this.vertexIdHelper=this.registerDisposer(A.u.get(this.gl)),this.edgeShaderGetter=this.getDependentShader("annotation/line/edge",(e=>{const t=this.rank;this.defineShader(e),(0,M.VU)(e),e.addVarying("highp float[".concat(t,"]"),"vModelPosition"),e.addVertexCode("\nfloat ng_LineWidth;\n"),W(e),e.addVertexCode("\nvoid setLineWidth(float width) {\n  ng_LineWidth = width;\n}\nvoid setLineColor(vec4 startColor, vec4 endColor) {\n  vColor = mix(startColor, endColor, getLineEndpointCoefficient());\n}\n"),e.setVertexMain("\nfloat modelPositionA[".concat(t,"] = getVertexPosition0();\nfloat modelPositionB[").concat(t,"] = getVertexPosition1();\nfor (int i = 0; i < ").concat(t,"; ++i) {\n  vModelPosition[i] = mix(modelPositionA[i], modelPositionB[i], getLineEndpointCoefficient());\n}\nng_LineWidth = 1.0;\nvColor = vec4(0.0, 0.0, 0.0, 0.0);\n").concat(this.invokeUserMain,"\nemitLine(uModelViewProjection * vec4(projectModelVectorToSubspace(modelPositionA), 1.0),\n         uModelViewProjection * vec4(projectModelVectorToSubspace(modelPositionB), 1.0),\n         ng_LineWidth);\n").concat(this.setPartIndex(e),";\n")),e.setFragmentMain("\nfloat clipCoefficient = getSubspaceClipCoefficient(vModelPosition);\nemitAnnotation(vec4(vColor.rgb, vColor.a * getLineAlpha() *\n                                ".concat(this.getCrossSectionFadeFactor()," *\n                                clipCoefficient));\n"))})),this.endpointShaderGetter=this.getDependentShader("annotation/line/endpoint",(e=>{const t=this.rank;this.defineShader(e),(0,D.fg)(e,this.targetIsSliceView),e.addVarying("highp float","vClipCoefficient"),e.addVarying("highp vec4","vBorderColor"),H(e),e.addVertexCode("\nfloat ng_markerDiameter;\nfloat ng_markerBorderWidth;\nint getEndpointIndex() {\n  return gl_VertexID / ".concat(D.d$,";\n}\nvoid setEndpointMarkerSize(float startSize, float endSize) {\n  ng_markerDiameter = mix(startSize, endSize, float(getEndpointIndex()));\n}\nvoid setEndpointMarkerBorderWidth(float startSize, float endSize) {\n  ng_markerBorderWidth = mix(startSize, endSize, float(getEndpointIndex()));\n}\nvoid setEndpointMarkerColor(vec4 startColor, vec4 endColor) {\n  vColor = mix(startColor, endColor, float(getEndpointIndex()));\n}\nvoid setEndpointMarkerBorderColor(vec4 startColor, vec4 endColor) {\n  vBorderColor = mix(startColor, endColor, float(getEndpointIndex()));\n}\n")),e.setVertexMain("\nfloat modelPosition[".concat(t,"] = getVertexPosition0();\nfloat modelPositionB[").concat(t,"] = getVertexPosition1();\nfor (int i = 0; i < ").concat(t,"; ++i) {\n  modelPosition[i] = mix(modelPosition[i], modelPositionB[i], float(getEndpointIndex()));\n}\nvClipCoefficient = getSubspaceClipCoefficient(modelPosition);\nvColor = vec4(0.0, 0.0, 0.0, 0.0);\nvBorderColor = vec4(0.0, 0.0, 0.0, 1.0);\nng_markerDiameter = 5.0;\nng_markerBorderWidth = 1.0;\n").concat(this.invokeUserMain,"\nemitCircle(uModelViewProjection * vec4(projectModelVectorToSubspace(modelPosition), 1.0), ng_markerDiameter, ng_markerBorderWidth);\n").concat(this.setPartIndex(e,"uint(getEndpointIndex()) + 1u"),";\n")),e.setFragmentMain("\nvec4 color = getCircleColor(vColor, vBorderColor);\ncolor.a *= vClipCoefficient;\nemitAnnotation(color);\n")}))}defineShader(e){(0,A.N)(e);const t=this.rank;(0,R.dt)(e,"float",WebGL2RenderingContext.FLOAT,!1,"VertexPosition",t,2)}enable(e,t,n){super.enable(e,t,(e=>{const i=e.vertexShaderInputBinders.VertexPosition;i.enable(1),this.gl.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,t.buffer.buffer),i.bind(this.geometryDataStride,t.bufferOffset);const r=this.vertexIdHelper;r.enable(),n(e),r.disable(),i.disable()}))}drawEdges(e){this.enable(this.edgeShaderGetter,e,(t=>{(0,M.Cy)(t,e.renderContext.projectionParameters,1),(0,M.wo)(t.gl,1,e.count)}))}drawEndpoints(e){this.enable(this.endpointShaderGetter,e,(t=>{(0,D.Yu)(t,e.renderContext.projectionParameters,{featherWidthInPixels:.5}),(0,D.aK)(t.gl,2,e.count)}))}draw(e){this.drawEdges(e),this.drawEndpoints(e)}}(0,C.rK)(f.UJ.LINE,{sliceViewRenderHelper:q,perspectiveViewRenderHelper:q,defineShaderNoOpSetters(e){W(e),H(e)},pickIdsPerInstance:3,snapPosition(e,t,n,i){const r=e.length,o=new Float32Array(t,n,2*r);0===i?function(e,t){const n=e.length;(0,T._q)(e,t.subarray(0,n),t.subarray(n),e)}(e,o):function(e,t,n){const i=e.length,r=i*n;for(let o=0;o<i;++o)e[o]=t[r+o]}(e,o,i-1)},getRepresentativePoint(e,t,n){e.set(0===n||1===n?t.pointA:t.pointB)},updateViaRepresentativePoint(e,t,n){let i=r()({},e);const o=t.length;switch(n){case 0:{const n=e.pointA,i=e.pointB,s=new Float32Array(o),a=new Float32Array(o);for(let e=0;e<o;++e){const r=s[e]=t[e];a[e]=i[e]+(r-n[e])}return r()(r()({},e),{pointA:s,pointB:a})}case 1:return r()(r()({},e),{pointA:new Float32Array(t)});case 2:return r()(r()({},e),{pointB:new Float32Array(t)})}return i}});class Y extends C.sP{constructor(){super(...arguments),this.shaderGetter3d=this.getDependentShader("annotation/point:3d",(e=>{(0,A.N)(e),(0,D.fg)(e,this.targetIsSliceView),this.defineShaderCommon(e),e.addVertexMain("\nemitCircle(uModelViewProjection *\n           vec4(projectModelVectorToSubspace(modelPosition), 1.0), ng_markerDiameter, ng_markerBorderWidth);\n"),e.setFragmentMain("\nvec4 color = getCircleColor(vColor, vBorderColor);\nemitAnnotation(color);\n")})),this.makeShaderGetter2d=e=>this.getDependentShader("annotation/point:2d:".concat(e),(t=>{(0,A.N)(t),(0,M.VU)(t,!0),this.defineShaderCommon(t),t.addVertexMain("\nvec3 subspacePositionA = projectModelVectorToSubspace(modelPosition);\nvec3 subspacePositionB = subspacePositionA;\nvec4 baseProjection = uModelViewProjection * vec4(subspacePositionA, 1.0);\nvec4 zCoeffs = uModelViewProjection[".concat(e,"];\nfloat minZ = 1e30;\nfloat maxZ = -1e30;\nfor (int i = 0; i < 3; ++i) {\n  // Want: baseProjection[i] + z * zCoeffs[i] = -2.0 * (baseProjection.w - z * zCoeffs.w)\n  //  i.e. baseProjection[i] + 2.0 * baseProjection.w < -z * (2.0 * zCoeffs.w + zCoeffs[i])\n  //  i.e. baseProjection[i] + 2.0 * baseProjection.w < -z * k1\n  float k1 = 2.0 * zCoeffs.w + zCoeffs[i];\n  float q1 = -(baseProjection[i] + 2.0 * baseProjection.w) / k1;\n  if (k1 != 0.0) {\n    minZ = min(minZ, q1);\n    maxZ = max(maxZ, q1);\n  }\n  // Want: baseProjection[i] + z * zCoeffs[i] = 2.0 * (baseProjection.w + z * zCoeffs.w)\n  //  i.e. baseProjection[i] - 2.0 * baseProjection.w > z * (2.0 * zCoeffs.w - zCoeffs[i])\n  //  i.e. baseProjection[i] - 2.0 * baseProjection.w > z * k2\n  float k2 = 2.0 * zCoeffs.w - zCoeffs[i];\n  float q2 = (baseProjection[i] - 2.0 * baseProjection.w) / k2;\n  if (k2 != 0.0) {\n    minZ = min(minZ, q2);\n    maxZ = max(maxZ, q2);\n  }\n}\nif (minZ > maxZ) minZ = maxZ = 0.0;\nsubspacePositionA[").concat(e,"] = minZ;\nsubspacePositionB[").concat(e,"] = maxZ;\nemitLine(uModelViewProjection, subspacePositionA, subspacePositionB, ng_markerDiameter, ng_markerBorderWidth);\n")),t.setFragmentMain("\nvec4 color = getRoundedLineColor(vColor, vBorderColor);\nemitAnnotation(vec4(color.rgb, color.a * ".concat(this.getCrossSectionFadeFactor(),"));\n"))})),this.shaderGetter2d=this.makeShaderGetter2d(2),this.shaderGetter1d=this.makeShaderGetter2d(1),this.vertexIdHelper=this.registerDisposer(A.u.get(this.gl))}defineShaderCommon(e){const t=this.rank;(0,R.dt)(e,"float",WebGL2RenderingContext.FLOAT,!1,"VertexPosition",t),e.addVarying("highp vec4","vBorderColor"),e.addVertexCode("\nfloat ng_markerDiameter;\nfloat ng_markerBorderWidth;\nvoid setPointMarkerSize(float size) {\n  ng_markerDiameter = size;\n}\nvoid setPointMarkerBorderWidth(float size) {\n  ng_markerBorderWidth = size;\n}\nvoid setPointMarkerColor(vec4 color) {\n  vColor = color;\n}\nvoid setPointMarkerBorderColor(vec4 color) {\n  vBorderColor = color;\n}\n"),e.addVertexMain("\nng_markerDiameter = 5.0;\nng_markerBorderWidth = 1.0;\nvBorderColor = vec4(0.0, 0.0, 0.0, 1.0);\nfloat modelPosition[".concat(t,"] = getVertexPosition0();\nfloat clipCoefficient = getSubspaceClipCoefficient(modelPosition);\nif (clipCoefficient == 0.0) {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n  return;\n}\n").concat(this.invokeUserMain,"\nvColor.a *= clipCoefficient;\nvBorderColor.a *= clipCoefficient;\n").concat(this.setPartIndex(e),";\n"))}enable(e,t,n){super.enable(e,t,(e=>{const i=e.vertexShaderInputBinders.VertexPosition;i.enable(1),this.gl.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,t.buffer.buffer),i.bind(this.geometryDataStride,t.bufferOffset);const r=this.vertexIdHelper;r.enable(),n(e),r.disable(),i.disable()}))}draw(e){const t=e.chunkDisplayTransform.numChunkDisplayDims;switch(t){case 3:this.enable(this.shaderGetter3d,e,(t=>{(0,D.Yu)(t,e.renderContext.projectionParameters,{featherWidthInPixels:1}),(0,D.aK)(t.gl,1,e.count)}));break;case 2:case 1:this.enable(2===t?this.shaderGetter2d:this.shaderGetter1d,e,(t=>{(0,M.Cy)(t,e.renderContext.projectionParameters,1),(0,M.wo)(t.gl,1,e.count)}))}}}(0,C.rK)(f.UJ.POINT,{sliceViewRenderHelper:Y,perspectiveViewRenderHelper:Y,defineShaderNoOpSetters(e){e.addVertexCode("\nvoid setPointMarkerSize(float size) {}\nvoid setPointMarkerBorderWidth(float size) {}\nvoid setPointMarkerColor(vec4 color) {}\nvoid setPointMarkerBorderColor(vec4 color) {}\n")},pickIdsPerInstance:1,snapPosition(e,t,n){e.set(new Float32Array(t,n,e.length))},getRepresentativePoint(e,t){e.set(t.point)},updateViaRepresentativePoint:(e,t)=>r()(r()({},e),{point:new Float32Array(t)})});const J="\nstruct EllipseQuadraticForm {\n  highp float A;  // x*x coefficient\n  highp float B;  // x*y coefficient\n  highp float C;  // y*y coefficient\n  highp float D;  // x coefficient\n  highp float E;  // y coefficient\n  highp float F;  // 1 coefficient\n};\n",K=[J,"\nEllipseQuadraticForm computeCrossSectionEllipse(mat3 A, vec3 c) {\n  EllipseQuadraticForm p;\n  p.A = A[0][0];\n  p.B = A[0][1] + A[1][0];\n  p.C = A[1][1];\n  p.D = -2.0 * c[0] * A[0][0] - c[1] * (A[0][1] + A[1][0]) +\n        c[2] * (A[0][2] + A[2][0]);\n  p.E = -c[0] * (A[0][1] + A[1][0]) - 2.0 * c[1] * A[1][1] +\n        c[2] * (A[1][2] + A[2][1]);\n  p.F = c[0] * c[0] * A[0][0] + c[0] * c[1] * (A[0][1] + A[1][0]) -\n        c[0] * c[2] * (A[0][2] + A[2][0]) + c[1] * c[1] * A[1][1] -\n        c[1] * c[2] * (A[1][2] + A[2][1]) + c[2] * c[2] * A[2][2] - 1.0;\n  return p;\n}\n"];const X=[J,"\nstruct CenterOrientEllipse {\n  vec2 k;   // center\n  vec2 u1;  // minor axis direction\n  vec2 u2;  // major axis direction\n  float a;  // semimajor axis\n  float b;  // semiminor axis\n  bool valid; // indicates if the ellipse is valid\n};\n","\nCenterOrientEllipse computeCenterOrientEllipse(EllipseQuadraticForm p) {\n  CenterOrientEllipse r;\n  float a11 = p.A;\n  float a12 = p.B / 2.0;\n  float a22 = p.C;\n  float b1 = p.D;\n  float b2 = p.E;\n  float c = p.F;\n  float kdenom = 2.0 * (a12 * a12 - a11 * a22);\n  float k1 = r.k.x = (a22 * b1 - a12 * b2) / kdenom;\n  float k2 = r.k.y = (a11 * b2 - a12 * b1) / kdenom;\n  float mu = 1.0 / (a11 * k1 * k1 + 2.0 * a12 * k1 * k2 + a22 * k2 * k2 - c);\n  float m11 = mu * a11;\n  float m12 = mu * a12;\n  float m22 = mu * a22;\n  float lambdaTerm1 = m11 + m22;\n  float lambdaTerm2 = sqrt((m11 - m22) * (m11 - m22) + 4.0 * m12 * m12);\n  float lambda1 = ((lambdaTerm1 + lambdaTerm2) / 2.0);\n  float lambda2 = ((lambdaTerm1 - lambdaTerm2) / 2.0);\n  r.a = 1.0 / sqrt(lambda1);\n  r.b = 1.0 / sqrt(lambda2);\n  r.valid = lambda1 > 0.0 && lambda2 > 0.0;\n  if (abs(m11 - m22) < 1e-6 && abs(m12) < 1e-6) {\n    r.u1 = vec2(1.0, 0.0);\n  } else if (m11 >= m22) {\n    r.u1 = normalize(vec2(lambda1 - m22, m12));\n  } else {\n    r.u1 = normalize(vec2(m12, lambda1 - m11));\n  }\n  r.u2 = vec2(-r.u1.y, r.u1.x);\n  return r;\n}\n"];var Z=n(6532),Q=n(2362);const $=T.pB.create();class ee extends C.sP{defineShader(e){const t=this.rank;(0,R.dt)(e,"float",WebGL2RenderingContext.FLOAT,!1,"CenterAndRadii",t,2),e.addVertexCode("\nstruct SubspaceParams {\n  highp vec3 subspaceCenter;\n  highp vec3 subspaceRadii;\n  highp float clipCoefficient;\n  bool cull;\n};\nSubspaceParams getSubspaceParams() {\n  SubspaceParams params;\n  highp float modelCenter[".concat(t,"] = getCenterAndRadii0();\n  highp float modelRadii[").concat(t,"] = getCenterAndRadii1();\n  float radiusAdjustment = 1.0;\n  float clipCoefficient = 1.0;\n  for (int i = 0; i < ").concat(t,"; ++i) {\n    float r = modelRadii[i];\n    float c = modelCenter[i];\n    float x = uModelClipBounds[i];\n    float clipRadius = uModelClipBounds[i + ").concat(t,"];\n    if (r != 0.0 && clipRadius != 0.0) {\n      float d = c - x;\n      d = d * d;\n      radiusAdjustment -= d / (r * r);\n    }\n    float e = abs(x - clamp(x, c - r, c + r)) * clipRadius;\n    clipCoefficient *= max(0.0, 1.0 - e);\n  }\n  radiusAdjustment = sqrt(max(0.0, radiusAdjustment));\n  params.subspaceCenter = projectModelVectorToSubspace(modelCenter);\n  params.subspaceRadii = projectModelVectorToSubspace(modelRadii) * radiusAdjustment;\n  params.clipCoefficient = clipCoefficient;\n  params.cull = clipCoefficient == 0.0 || radiusAdjustment == 0.0;\n  return params;\n}\nvoid setEllipsoidFillColor(vec4 color) {\n  vColor = color;\n}\n"))}enable(e,t,n){super.enable(e,t,(e=>{const i=e.vertexShaderInputBinders.CenterAndRadii;i.enable(1),this.gl.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,t.buffer.buffer),i.bind(this.geometryDataStride,t.bufferOffset),n(e),i.disable()}))}}(0,C.rK)(f.UJ.ELLIPSOID,{sliceViewRenderHelper:class extends ee{constructor(){super(...arguments),this.shaderGetter=this.getDependentShader("annotation/ellipsoid/crossSection",(e=>{(0,A.N)(e),this.defineShader(e),e.addUniform("highp mat4","uViewportToObject"),e.addUniform("highp mat4","uObjectToViewport"),e.addUniform("highp mat4","uViewportToDevice"),e.addAttribute("highp vec2","aCornerOffset"),e.addVarying("highp vec2","vCircleCoord"),e.addVarying("highp float","vClipCoefficient"),e.addVertexCode(K),e.addVertexCode(X),e.addVertexCode(Z.W6),e.setVertexMain("\nSubspaceParams params = getSubspaceParams();\nif (params.cull) {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n  return;\n}\nvClipCoefficient = params.clipCoefficient;\nmat3 Aobject = mat3(0.0);\nfor (int i = 0; i < 3; ++i) {\n  float r = max(params.subspaceRadii[i], 1e-3);\n  Aobject[i][i] = 1.0 / (r * r);\n}\nmat3 RviewportToObject = mat3(uViewportToObject);\nmat3 Aviewport = transpose(RviewportToObject) * Aobject * RviewportToObject;\nvec3 cViewport = (uObjectToViewport * vec4(params.subspaceCenter, 1.0)).xyz;\nEllipseQuadraticForm quadraticForm = computeCrossSectionEllipse(Aviewport, cViewport);\nvec2 u1, u2;\nfloat a, b;\nCenterOrientEllipse centerOrient = computeCenterOrientEllipse(quadraticForm);\nvec2 cornerOffset = getQuadVertexPosition(vec2(-1.0, -1.0), vec2(1.0, 1.0));\nvec2 viewportCorner = centerOrient.k +\n  centerOrient.u1 * cornerOffset.x * centerOrient.a +\n  centerOrient.u2 * cornerOffset.y * centerOrient.b;\nif (centerOrient.valid) {\n  gl_Position = uViewportToDevice * vec4(viewportCorner, 0.0, 1.0);\n} else {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n}\nvCircleCoord = cornerOffset;\n".concat(this.invokeUserMain,"\n").concat(this.setPartIndex(e),";\n")),e.setFragmentMain("\nif (dot(vCircleCoord, vCircleCoord) > 1.0) {\n  discard;\n}\nemitAnnotation(vec4(vColor.rgb, vColor.a * vClipCoefficient));\n")})),this.vertexIdHelper=this.registerDisposer(A.u.get(this.gl))}draw(e){this.enable(this.shaderGetter,e,(t=>{const n=t.gl,i=e.renderContext.sliceView.projectionParameters.value,r=T.pB.multiply($,e.renderSubspaceInvModelMatrix,i.invViewMatrix);n.uniformMatrix4fv(t.uniform("uViewportToObject"),!1,r),n.uniformMatrix4fv(t.uniform("uViewportToDevice"),!1,i.projectionMat);const o=$;T.pB.invert(o,r),n.uniformMatrix4fv(t.uniform("uObjectToViewport"),!1,o);const s=this.vertexIdHelper;s.enable(),(0,Z.Nm)(n,1,e.count),s.disable()}))}},perspectiveViewRenderHelper:class extends ee{constructor(){super(...arguments),this.sphereRenderHelper=this.registerDisposer(new Q.mQ(this.gl,10,10)),this.shaderGetter=this.getDependentShader("annotation/ellipsoid/projection",(e=>{this.defineShader(e),this.sphereRenderHelper.defineShader(e),e.addUniform("highp vec4","uLightDirection"),e.addUniform("highp mat4","uNormalTransform"),e.addVarying("highp float","vClipCoefficient"),e.setVertexMain("\nSubspaceParams params = getSubspaceParams();\nif (params.cull) {\n  gl_Position = vec4(2.0, 0.0, 0.0, 1.0);\n  return;\n}\nvClipCoefficient = params.clipCoefficient;\n".concat(this.invokeUserMain,"\nemitSphere(uModelViewProjection, uNormalTransform, params.subspaceCenter, params.subspaceRadii, uLightDirection);\n").concat(this.setPartIndex(e),";\n")),e.setFragmentMain("\nemitAnnotation(vec4(vColor.rgb * vLightingFactor, vColor.a * vClipCoefficient));\n")})),this.tempLightVec=new Float32Array(4)}draw(e){this.enable(this.shaderGetter,e,(t=>{const n=t.gl;let i=this.tempLightVec;var r=e.renderContext;let o=r.lightDirection,s=r.ambientLighting,a=r.directionalLighting;T.eR.scale(i,o,a),i[3]=s,n.uniform4fv(t.uniform("uLightDirection"),i),n.uniformMatrix4fv(t.uniform("uNormalTransform"),!1,T.pB.transpose(T.pB.create(),e.renderSubspaceInvModelMatrix)),this.sphereRenderHelper.draw(t,e.count)}))}},defineShaderNoOpSetters(e){e.addVertexCode("\nvoid setEllipsoidFillColor(vec4 color) {}\n")},pickIdsPerInstance:1,snapPosition:()=>{},getRepresentativePoint(e,t){e.set(t.center)},updateViaRepresentativePoint:(e,t)=>r()(r()({},e),{center:new Float32Array(t)})});function te(e){e.addVertexCode("\n void setAxisEndpointMarkerSize(float startSize, float endSize) {}\n void setAxisEndpointMarkerBorderWidth(float startSize, float endSize) {}\n void setAxisEndpointMarkerColor(vec4 startColor, vec4 endColor) {}\n void setAxisEndpointMarkerBorderColor(vec4 startColor, vec4 endColor) {}\n ")}function ne(e){e.addVertexCode("\n void setAxisWidth(float width) {}\n void setAxisColor(vec4 startColor, vec4 endColor) {}\n ")}function ie(e){e.addVertexCode("\n void setSphereColor(vec4 color) {}\n ")}class re extends C.sP{constructor(){super(...arguments),this.sphereShader=this.registerDisposer(new D.Xp(this.gl)),this.vertexIdHelper=this.registerDisposer(A.u.get(this.gl)),this.edgeShaderGetter=this.getDependentShader("annotation/sphere/axis",(e=>{const t=this.rank;this.defineShader(e),(0,M.VU)(e),e.addVarying("highp float[".concat(t,"]"),"vModelPosition"),e.addVertexCode("\nfloat ng_LineWidth;\n"),te(e),ie(e),e.addVertexCode("\nvoid setAxisWidth(float width) {\n  ng_LineWidth = width;\n}\nvoid setAxisColor(vec4 startColor, vec4 endColor) {\n  vColor = mix(startColor, endColor, getLineEndpointCoefficient());\n}\n"),e.setVertexMain("\nfloat modelPositionA[".concat(t,"] = getVertexPosition0();\nfloat modelPositionB[").concat(t,"] = getVertexPosition1();\nfor (int i = 0; i < ").concat(t,"; ++i) {\n  vModelPosition[i] = mix(modelPositionA[i], modelPositionB[i], getLineEndpointCoefficient());\n}\nng_LineWidth = 1.0;\nvColor = vec4(0.0, 0.0, 0.0, 0.0);\n").concat(this.invokeUserMain,"\nemitLine(uModelViewProjection * vec4(projectModelVectorToSubspace(modelPositionA), 1.0),\n         uModelViewProjection * vec4(projectModelVectorToSubspace(modelPositionB), 1.0),\n         ng_LineWidth);\n").concat(this.setPartIndex(e),";\n")),e.setFragmentMain("\nfloat clipCoefficient = getSubspaceClipCoefficient(vModelPosition);\nemitAnnotation(vec4(vColor.rgb, vColor.a * getLineAlpha() *\n                                ".concat(this.getCrossSectionFadeFactor()," *\n                                clipCoefficient));\n"))})),this.endpointShaderGetter=this.getDependentShader("annotation/sphere/endpoint",(e=>{const t=this.rank;this.defineShader(e),(0,D.fg)(e,this.targetIsSliceView),e.addVarying("highp float","vClipCoefficient"),e.addVarying("highp vec4","vBorderColor"),ne(e),ie(e),e.addVertexCode("\nfloat ng_markerDiameter;\nfloat ng_markerBorderWidth;\nint getEndpointIndex() {\n  return gl_VertexID / ".concat(D.d$,";\n}\nvoid setAxisEndpointMarkerSize(float startSize, float endSize) {\n  ng_markerDiameter = mix(startSize, endSize, float(getEndpointIndex()));\n}\nvoid setAxisEndpointMarkerBorderWidth(float startSize, float endSize) {\n  ng_markerBorderWidth = mix(startSize, endSize, float(getEndpointIndex()));\n}\nvoid setAxisEndpointMarkerColor(vec4 startColor, vec4 endColor) {\n  vColor = mix(startColor, endColor, float(getEndpointIndex()));\n}\nvoid setAxisEndpointMarkerBorderColor(vec4 startColor, vec4 endColor) {\n  vBorderColor = mix(startColor, endColor, float(getEndpointIndex()));\n}\n")),e.setVertexMain("\nfloat modelPosition[".concat(t,"] = getVertexPosition0();\nfloat modelPositionB[").concat(t,"] = getVertexPosition1();\nfor (int i = 0; i < ").concat(t,"; ++i) {\n  modelPosition[i] = mix(modelPosition[i], modelPositionB[i], float(getEndpointIndex()));\n}\nvClipCoefficient = getSubspaceClipCoefficient(modelPosition);\nvColor = vec4(0.0, 0.0, 0.0, 0.0);\nvBorderColor = vec4(0.0, 0.0, 0.0, 1.0);\nng_markerDiameter = 5.0;\nng_markerBorderWidth = 1.0;\n").concat(this.invokeUserMain,"\nemitCircle(uModelViewProjection * vec4(projectModelVectorToSubspace(modelPosition), 1.0), ng_markerDiameter, ng_markerBorderWidth);\n").concat(this.setPartIndex(e,"uint(getEndpointIndex()) + 1u"),";\n")),e.setFragmentMain("\nvec4 color = getCircleColor(vColor, vBorderColor);\ncolor.a *= vClipCoefficient;\nemitAnnotation(color);\n")})),this.sphereShadeGetter=this.getDependentShader("annotation/sphere/sphere",(e=>{const t=this.rank;this.defineShader(e),this.sphereShader.defineShader(e),e.addVarying("highp float","vClipCoefficient"),ne(e),te(e),e.addVertexCode("\n void setSphereColor(vec4 color) {\n   vColor = color;\n }\n "),e.setVertexMain("\n float modelPosition[".concat(t,"] = getVertexPosition0();\n float modelPositionB[").concat(t,"] = getVertexPosition1();\n float diameter = 0.0;\n for (int i = 0; i < ").concat(t,"; ++i) {\n   float dx = modelPosition[i] - modelPositionB[i];\n   diameter += dx * dx;\n   modelPosition[i] = (modelPosition[i] + modelPositionB[i]) * 0.5;\n }\n float radius = sqrt(diameter) * 0.5;\n if (radius > 0.0) {\n   vClipCoefficient = getRadiusAdjustment(vec3(modelPosition[0], modelPosition[1], modelPosition[2]), radius);\n } else {\n   vClipCoefficient = 1.0;\n }\n\n // vClipCoefficient = getSubspaceClipCoefficient(modelPosition);\n vColor = vec4(1.0, 0.0, 0.0, 0.5);\n // vColor = vec4(defaultColor(), 0.5);\n ").concat(this.invokeUserMain,"\n // float radius = diameter * 0.5;\n emitSphere(uModelViewProjection, uNormalTransform, projectModelVectorToSubspace(modelPosition), vec3(radius, radius, radius), uLightDirection);\n ").concat(this.setPartIndex(e),";\n ")),e.setFragmentMain("\n     vec4 color = vColor;\n     color.a *= vClipCoefficient;\n     emitAnnotation(color);\n ")}))}defineShader(e){(0,A.N)(e);const t=this.rank;(0,R.dt)(e,"float",WebGL2RenderingContext.FLOAT,!1,"VertexPosition",t,2)}enable(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super.enable(e,t,(e=>{const r=e.vertexShaderInputBinders.VertexPosition;r.enable(1),this.gl.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,t.buffer.buffer),r.bind(this.serializedBytesPerAnnotation,t.bufferOffset);const o=this.vertexIdHelper;i&&o.enable(),n(e),i&&o.disable(),r.disable()}))}drawEdges(e){this.enable(this.edgeShaderGetter,e,(t=>{(0,M.Cy)(t,e.renderContext.projectionParameters,1),(0,M.wo)(t.gl,1,e.count)}))}drawEndpoints(e){this.enable(this.endpointShaderGetter,e,(t=>{(0,D.Yu)(t,e.renderContext.projectionParameters,{featherWidthInPixels:.5}),(0,D.aK)(t.gl,2,e.count)}))}drawSphere(e){this.enable(this.sphereShadeGetter,e,(t=>{this.sphereShader.draw(t,e,e.count)}),!1)}draw(e){this.drawEdges(e),this.drawEndpoints(e),this.drawSphere(e)}}(0,C.rK)(f.UJ.SPHERE,{sliceViewRenderHelper:re,perspectiveViewRenderHelper:re,defineShaderNoOpSetters(e){te(e),ne(e),ie(e)},pickIdsPerInstance:3,snapPosition(e,t,n,i){const r=e.length,o=new Float32Array(t,n,2*r);0===i?function(e,t){const n=e.length;(0,T._q)(e,t.subarray(0,n),t.subarray(n),e)}(e,o):function(e,t,n){const i=e.length,r=i*n;for(let o=0;o<i;++o)e[o]=t[r+o]}(e,o,i-1)},getRepresentativePoint(e,t,n){e.set(0===n||1===n?t.pointA:t.pointB)},updateViaRepresentativePoint(e,t,n){let i=r()({},e);const o=t.length;switch(n){case 0:{const n=e.pointA,i=e.pointB,s=new Float32Array(o),a=new Float32Array(o);for(let e=0;e<o;++e){const r=s[e]=t[e];a[e]=i[e]+(r-n[e])}return r()(r()({},e),{pointA:s,pointB:a})}case 1:return r()(r()({},e),{pointA:new Float32Array(t)});case 2:return r()(r()({},e),{pointB:new Float32Array(t)})}return i}});var oe=n(2282),se=n(6094),ae=n(5795),le=n(6560),ce=n(3985),de=n(4874),ue=n(739),he=n(6210),pe=n(6874),fe=n(7184);const ge=T.pB.create(),me=T.eR.create();function ve(e){e.addUniform("highp vec3","uTranslation"),e.addUniform("highp mat4","uProjectionMatrix"),e.addUniform("highp vec3","uChunkDataSize"),e.addUniform("highp vec3","uLowerClipBound"),e.addUniform("highp vec3","uUpperClipBound"),e.setFragmentMain("\nemit(vec4(1.0, 1.0, 1.0, getLineAlpha()), 0u);\n")}const ye={defineShader(e){ve(e),(0,M.VU)(e),e.addVertexCode("\nconst vec3[24] boxCornerOffsets = vec3[](\n  vec3(0, 0, 0), vec3(0, 0, 1),  // e1\n  vec3(1, 0, 0), vec3(1, 0, 1),  // e2\n  vec3(0, 1, 0), vec3(0, 1, 1),  // e3\n  vec3(1, 1, 0), vec3(1, 1, 1),  // e4\n  vec3(0, 0, 0), vec3(0, 1, 0),  // e5\n  vec3(0, 0, 1), vec3(0, 1, 1),  // e6\n  vec3(1, 0, 0), vec3(1, 1, 0),  // e7\n  vec3(1, 0, 1), vec3(1, 1, 1),  // e8\n  vec3(0, 0, 0), vec3(1, 0, 0),  // e9\n  vec3(0, 0, 1), vec3(1, 0, 1),  // e10\n  vec3(0, 1, 0), vec3(1, 1, 0),  // e11\n  vec3(0, 1, 1), vec3(1, 1, 1)  // e12\n);\n"),e.setVertexMain("\nint edgeIndex = gl_VertexID / ".concat(M.bn,";\nvec3 cornerA = max(uLowerClipBound, min(uUpperClipBound, uTranslation));\nvec3 cornerB = max(uLowerClipBound, min(uUpperClipBound, uTranslation + uChunkDataSize));\nvec3 vertexPosition1 = mix(cornerA, cornerB, boxCornerOffsets[edgeIndex * 2]);\nvec3 vertexPosition2 = mix(cornerA, cornerB, boxCornerOffsets[edgeIndex * 2 + 1]);\nemitLine(uProjectionMatrix * vec4(vertexPosition1, 1.0),\n         uProjectionMatrix * vec4(vertexPosition2, 1.0),\n         2.0);\n"))},initialize(e,t){(0,M.Cy)(e,t,1)},draw(e,t,n){const i=e.gl,r=ge,o=t.chunkLayout;T.pB.multiply(r,n.viewProjectionMat,o.transform),i.uniformMatrix4fv(e.uniform("uProjectionMatrix"),!1,r),i.uniform3fv(e.uniform("uChunkDataSize"),o.size),i.uniform3fv(e.uniform("uLowerClipBound"),t.lowerClipDisplayBound),i.uniform3fv(e.uniform("uUpperClipBound"),t.upperClipDisplayBound);const s=o.size,a=t.curPositionInChunks,l=t.chunkDisplayDimensionIndices,c=me;for(let d=0;d<3;++d){const e=l[d];c[d]=(-1===e?0:a[e])*s[d]}i.uniform3fv(e.uniform("uTranslation"),c),(0,M.wo)(i,L.Z9,1)}},be={defineShader(e){(0,k.xo)(e),ve(e),(0,M.VU)(e),e.setVertexMain("\nint vertexIndex1 = gl_VertexID / ".concat(M.bn,";\nint vertexIndex2 = vertexIndex1 == 5 ? 0 : vertexIndex1 + 1;\nvec3 vertexPosition1 = getBoundingBoxPlaneIntersectionVertexPosition(uChunkDataSize, uTranslation, uLowerClipBound, uUpperClipBound, vertexIndex1);\nvec3 vertexPosition2 = getBoundingBoxPlaneIntersectionVertexPosition(uChunkDataSize, uTranslation, uLowerClipBound, uUpperClipBound, vertexIndex2);\nemitLine(uProjectionMatrix * vec4(vertexPosition1, 1.0),\n         uProjectionMatrix * vec4(vertexPosition2, 1.0),\n         2.0);\n"))},initialize(e,t){(0,M.Cy)(e,t,1)},draw(e,t,n){const i=e.gl,r=ge,o=t.chunkLayout;T.pB.multiply(r,n.viewProjectionMat,o.transform),i.uniformMatrix4fv(e.uniform("uProjectionMatrix"),!1,r),i.uniform3fv(e.uniform("uChunkDataSize"),o.size),i.uniform3fv(e.uniform("uLowerClipBound"),t.lowerClipDisplayBound),i.uniform3fv(e.uniform("uUpperClipBound"),t.upperClipDisplayBound);const s=o.size,a=t.curPositionInChunks,l=t.chunkDisplayDimensionIndices,c=me;for(let d=0;d<3;++d){const e=l[d];c[d]=(-1===e?0:a[e])*s[d]}i.uniform3fv(e.uniform("uTranslation"),c),(0,k.oo)(e,n.viewportNormalInGlobalCoordinates,n.centerDataPosition,o.transform,o.invTransform),(0,M.wo)(i,6,1)}};var Se=n(7160),we=n(7562),xe=n(1783),Ce=n(8164),ke=n(6344),Ee=n(843),Te=n(9080),Le=n(7799),Pe=function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=x()(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&S()(t,n,s),s};const De=T.pB.create();let Me=class extends((0,Ee.Mz)(ae.tB)){constructor(e,t,n,i){super(i),this.chunkManager=e,this.source=t,this.segmentationStates=n,this.initializeCounterpart(this.chunkManager.rpc,{chunkManager:this.chunkManager.rpcId,source:t.rpcId,segmentationStates:this.serializeDisplayState()});this.registerDisposer(n.changed.add((()=>{const e={id:this.rpcId,segmentationStates:this.serializeDisplayState()};this.rpc.invoke(oe.Mx,e)})))}serializeDisplayState(){const e=this.segmentationStates.value;if(void 0!==e)return e.map((e=>null==e?e:(0,ue.sendVisibleSegmentsState)(e.segmentationGroupState.value)))}};Me=Pe([(0,Le.R6)(oe.XD)],Me);class Ie extends we.O8{constructor(e,t){super(),this.chunkManager=e,this.state=t,this.layerChunkProgressInfo=new se.IL,this.numPickIds=0,this.generation=-1,this.redrawNeeded=new ke.IY,this.serializedAnnotations=void 0,this.handleChangeAffectingBuffer=()=>{this.generation=-1,this.redrawNeeded.dispatch()},this.segmentationStates=this.registerDisposer((0,Se.Uq)((e=>{var t=this.state;const n=t.displayState,i=t.source,r=n.relationshipStates;return n.displayUnfiltered.value?void 0:i.relationships.map((e=>{const t=r.get(e);return t.showMatches.value?t.segmentationState.value:void 0}))}),[this.state.displayState.relationshipStates],((e,t)=>void 0===e||void 0===t?e===t:(0,E.r1)(e,t)))),this.registerDisposer(t),this.registerDisposer(this.source.changed.add(this.handleChangeAffectingBuffer)),this.registerDisposer((0,Se.no)(((e,t)=>{if(this.handleChangeAffectingBuffer(),void 0!==t)for(const n of t)null!=n&&e.registerDisposer((0,Se.aM)(((e,t)=>{e.registerDisposer(t.visibleSegments.changed.add((()=>this.handleChangeAffectingBuffer()))),e.registerDisposer(t.segmentEquivalences.changed.add((()=>this.handleChangeAffectingBuffer())))}),n.segmentationGroupState))}),this.segmentationStates)),this.source instanceof f.vd||(this.sharedObject=this.registerDisposer(new Me(e,this.source,this.segmentationStates,this.layerChunkProgressInfo)));const n=this.state.displayState;this.registerDisposer(n.color.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(n.shader.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(n.shaderControls.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.hoverState.changed.add(this.redrawNeeded.dispatch)),this.registerDisposer(this.transform.changed.add(this.redrawNeeded.dispatch))}get source(){return this.state.source}get transform(){return this.state.transform}get hoverState(){return this.state.displayState.hoverState}get visibility(){const e=this.sharedObject;if(void 0!==e)return e.visibility}get gl(){return this.chunkManager.gl}updateBuffer(){const e=this.source;if(e instanceof f.vd){const t=e.changed.count;if(this.generation!==t){let n=this.buffer;void 0===n&&(n=this.buffer=this.registerDisposer(new P.h(this.chunkManager.gl))),this.generation=t;const i=this.serializedAnnotations=function(e,t){const n=new f.oL(e.annotationPropertySerializers);for(const i of e)(void 0===t||t(i))&&n.add(i);return n.serialize()}(e,function(e){if(void 0!==e)return t=>{const n=t.relatedSegments;if(void 0===n)return!1;for(let r=0,o=n.length;r<o;++r){const t=e[r];if(null==t)continue;var i=t.segmentationGroupState.value;const o=i.visibleSegments,s=i.segmentEquivalences;for(const e of n[r])if(o.has(s.get(e)))return!0}return!1}}(this.segmentationStates.value));n.setData(this.serializedAnnotations.data),this.numPickIds=(0,m.nm)(i)}}}}function Re(e){const t=e.chunkTransform.modelTransform.unpaddedRank,n=new Float32Array(2*t),i=new Float32Array(3*t);i.fill(0),n.fill(1,t);const r=e.numChunkDisplayDims,o=e.chunkDisplayDimensionIndices;for(let s=0;s<r;++s){const e=o[s];n[t+e]=0,i[3*e+s]=1}return{modelClipBounds:n,renderSubspaceTransform:i}}function Ae(e,t,n){n.clearMessages();const i=e=>{n.addMessage({severity:Ce.TU.error,message:e})};if(void 0!==e.error)return i(e.error);const r=(0,ce.IH)(e.modelTransform,t.displayDimensionIndices);let o;try{o=(0,ce.SZ)(e,r)}catch(a){return i(a.message)}var s=Re(o);return{chunkTransform:e,chunkDisplayTransform:o,modelClipBounds:s.modelClipBounds,renderSubspaceTransform:s.renderSubspaceTransform}}function Oe(e,t){return class extends e{constructor(e,t){super(),this.base=e,this.renderScaleHistogram=t,this.curRank=-1,this.renderHelpers=[],this.isAnnotation=!0;const n=e.visibility;void 0!==n&&this.registerDisposer(n.add(this.visibility)),this.registerDisposer(this.renderScaleHistogram.visibility.add(this.visibility)),this.registerDisposer((()=>{for(const e of this.renderHelpers)e.dispose()})),this.role=e.state.role,this.registerDisposer(e.redrawNeeded.add(this.redrawNeeded.dispatch)),this.handleRankChanged()}handleRankChanged(){const e=this.base.source.rank;if(e===this.curRank)return;this.curRank=e,this.tempChunkPosition=new Float32Array(e);const n=this.renderHelpers,i=this.gl;for(const t of n)t.dispose();const r=this.base.source.properties,o=this.base.state.displayState;for(const s of f.PB){const a=(0,C.Ag)(s),l=a[t],c=n[s]=new l(i,s,e,r,o.shaderControls,o.fallbackShaderControls,o.shaderError);c.pickIdsPerInstance=a.pickIdsPerInstance,c.targetIsSliceView="sliceViewRenderHelper"===t}}attach(e){super.attach(e),this.handleRankChanged();const t=this.chunkTransform,n=e.view.displayDimensionRenderInfo.value;e.state={chunkTransform:t,displayDimensionRenderInfo:n,chunkRenderParameters:Ae(t,n,e.messages)}}updateAttachmentState(e){const t=e.state;this.handleRankChanged();const n=this.chunkTransform,i=e.view.displayDimensionRenderInfo.value;if(void 0!==t&&t.chunkTransform===n&&t.displayDimensionRenderInfo===i)return t.chunkRenderParameters;t.chunkTransform=n,t.displayDimensionRenderInfo=i;return t.chunkRenderParameters=Ae(n,i,e.messages)}get chunkTransform(){return this.base.state.chunkTransform.value}updateModelClipBounds(e,t){const n=t.modelClipBounds,i=this.curRank,r=t.chunkTransform;(0,ce.Mk)(n.subarray(0,i),e.projectionParameters.globalPosition,this.base.state.localPosition.value,r.layerRank,r.combinedGlobalLocalToChunkTransform)}get gl(){return this.base.chunkManager.gl}drawGeometryChunkData(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!e.bufferValid){let t=e.buffer;void 0===t&&(t=e.buffer=new P.h(this.gl));const n=e.serializedAnnotations;t.setData(n.data),e.numPickIds=(0,m.nm)(n),e.bufferValid=!0}this.drawGeometry(e,t,n,i)}drawGeometry(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const r=this.base,o=n.chunkDisplayTransform,s=e.serializedAnnotations,a=s.typeToIdMaps,l=s.typeToOffset;let c=0;t.emitPickID&&(c=t.pickIDs.register(this,e.numPickIds,0,0,e));const d=r.hoverState.value,u=T.pB.multiply(De,t.projectionParameters.viewProjectionMat,o.displaySubspaceModelMatrix),h={annotationLayer:r,renderContext:t,selectedIndex:0,basePickId:c,buffer:e.buffer,bufferOffset:0,count:0,modelViewProjectionMatrix:u,modelClipBounds:n.modelClipBounds,subspaceMatrix:n.renderSubspaceTransform,renderSubspaceModelMatrix:o.displaySubspaceModelMatrix,renderSubspaceInvModelMatrix:o.displaySubspaceInvModelMatrix,chunkDisplayTransform:o};for(const p of f.PB){const e=a[p];let t=e.size;if(t>0){const n=(0,C.Ag)(p);let r=4294967295;if(void 0!==d){const t=e.get(d.id);void 0!==t&&(r=t*n.pickIdsPerInstance)}t=Math.round(t*i),h.count=t,h.bufferOffset=l[p],h.selectedIndex=r,this.renderHelpers[p].draw(h),h.basePickId+=t*n.pickIdsPerInstance}}}updateMouseState(e,t,n,i){const r=i.serializedAnnotations,o=r.typeToIds,s=r.typeToOffset,a=this.curRank,l=this.chunkTransform;if(void 0===l.error)for(const c of f.PB){const t=o[c],i=(0,C.Ag)(c),d=i.pickIdsPerInstance;if(n<t.length*d){const o=Math.floor(n/d),u=t[o],h=n%d;e.pickedAnnotationId=u,e.pickedAnnotationLayer=this.base.state,e.pickedOffset=h,e.pickedAnnotationBuffer=r.data.buffer,e.pickedAnnotationType=c,e.pickedAnnotationBufferBaseOffset=r.data.byteOffset+s[c],e.pickedAnnotationIndex=o,e.pickedAnnotationCount=t.length;const p=this.tempChunkPosition,f=l.chunkToLayerTransform,g=l.combinedGlobalLocalToChunkTransform,m=l.layerRank,v=l.modelTransform.globalToRenderLayerDimensions,b=e.position;if(!(0,ce.Mk)(p,b,this.base.state.localPosition.value,m,g))return;const S=this.base.source.annotationPropertySerializers[c];i.snapPosition(p,e.pickedAnnotationBuffer,e.pickedAnnotationBufferBaseOffset+e.pickedAnnotationIndex*S.propertyGroupBytes[0],h);const w=v.length;for(let e=0;e<w;++e){const t=v[e];if(-1===t)continue;let n=f[(a+1)*a+t];for(let e=0;e<a;++e)n+=p[e]*f[e*(m+1)+t];y()(n)&&(b[e]=n)}return}n-=t.length*d}}transformPickedValue(e){const t=e.pickedAnnotationBuffer;if(void 0===t)return;const n=this.base.source.properties;if(0===n.length)return;const i=e.pickedAnnotationBufferBaseOffset,r=e.pickedAnnotationType,o=e.pickedAnnotationIndex,s=e.pickedAnnotationCount,a=this.base.source.annotationPropertySerializers,l=new Array(n.length);return a[r].deserialize(new DataView(t),i,o,s,xe.H$.LITTLE===xe.Hp,l),(0,f.zC)(n[0],l[0])}isReady(){const e=this.base.source;if(!(e instanceof m.oZ))return!0;const t=this.base.segmentationStates.value;if(void 0===t)return!0;for(let n=0,i=t.length;n<i;++n){const i=t[n];if(null===i)return!1;if(void 0===i)continue;const r=e.segmentFilteredSources[n].chunks;let o=!1;if((0,de.SH)(i.segmentationGroupState.value,(e=>{const t=(0,de.dH)(e);r.has(t)||(o=!0)})),o)return!1}return!0}}}const Ne=e=>class extends e{constructor(){super(...arguments),this.layerChunkProgressInfo=this.base.layerChunkProgressInfo}draw(e,t){const n=this.updateAttachmentState(t);if(0===this.curRank||void 0===n)return;this.updateModelClipBounds(e,n);const i=this.base.source;if(i instanceof f.vd){const t=this.base;t.updateBuffer(),this.drawGeometry(t,e,n)}else{const t=this.renderScaleHistogram;t.begin(this.base.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber),this.drawGeometryChunkData(i.temporary.data,e,n);const r=this.base.segmentationStates.value;let o=0,s=0;if(void 0!==r)for(let a=0,l=r.length;a<l;++a){const t=r[a];if(null==t)continue;const l=i.segmentFilteredSources[a].chunks;(0,de.SH)(t.segmentationGroupState.value,(t=>{const i=(0,de.dH)(t),r=l.get(i);if(void 0!==r&&r.state===se.HU.GPU_MEMORY){const t=r.data;if(void 0===t)return;this.drawGeometryChunkData(t,e,n),++o}else++s}))}t.add(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,o,s)}}},_e=Oe(le.r,"perspectiveViewRenderHelper");class Ve extends(Ne(_e)){}const Be=e=>class extends e{constructor(e){super(e.annotationLayer,e.renderScaleHistogram),this.wireFrameRenderHelper=this instanceof fe.j?be:ye,this.wireFrameShaderGetter=(0,Te.P9)(this,this.gl,{memoizeKey:"annotation/wireFrameShader:".concat(this instanceof fe.j),parameters:(0,Se.XZ)(void 0),defineShader:e=>{this.wireFrameRenderHelper.defineShader(e)}}),this.renderScaleTarget=e.renderScaleTarget,this.registerDisposer(this.renderScaleTarget.changed.add(this.redrawNeeded.dispatch));const t=this.registerDisposer(new ae.tB(this.layerChunkProgressInfo)),n=this.base.chunkManager.rpc;t.RPC_TYPE_ID=oe.hR,t.initializeCounterpart(n,{chunkManager:this.base.chunkManager.rpcId,localPosition:this.registerDisposer(he.a.makeFromExisting(n,this.base.state.localPosition)).rpcId,renderScaleTarget:this.registerDisposer(he.a.makeFromExisting(n,this.renderScaleTarget)).rpcId}),this.backend=t}attach(e){super.attach(e),e.state.sources=e.registerDisposer((0,Se.no)(((t,n,i)=>{const o=(0,pe.AK)(i,n,(e=>this.base.state.source.getSources(e)),e.messages,this);for(const e of o)for(const n of e)t.registerDisposer(n.source),r()(n,Re(n.chunkDisplayTransform));return e.view.flushBackendProjectionParameters(),this.backend.rpc.invoke(oe.j4,{layer:this.backend.rpcId,view:e.view.rpcId,displayDimensionRenderInfo:i,sources:(0,pe.Zi)(o)}),this.redrawNeeded.dispatch(),o}),this.base.state.transform,e.view.displayDimensionRenderInfo))}draw(e,t){const n=this.updateAttachmentState(t);if(0===this.curRank||void 0===n)return;const i=t.state.sources.value;if(0===i.length)return;this.updateModelClipBounds(e,n);const r=this.renderScaleHistogram;r.begin(this.base.chunkManager.chunkQueueManager.frameNumberCounter.frameNumber);const o=e.projectionParameters;let s;if(e.wireFrame){const t=this.wireFrameShaderGetter(e.emitter).shader;if(null===t)return;t.bind(),this.wireFrameRenderHelper.initialize(t,o),s=t}(0,oe.N8)(o,this.base.state.localPosition.value,this.renderScaleTarget.value,i[0],(()=>{}),((t,i,a,l,c)=>{const d=t.source.chunks.get(t.curPositionInChunks.join());let u;if(void 0===d||d.state!==se.HU.GPU_MEMORY)u=0;else{const i=d.data;if(void 0===i)return;void 0!==s?this.wireFrameRenderHelper.draw(s,t,o):this.drawGeometryChunkData(i,e,n,a),u=1}r.add(l,c,u,1-u)}))}},Fe=Be(_e),Ue=Be(Oe(fe.j,"sliceViewRenderHelper")),ze=Ne(Oe(fe.j,"sliceViewRenderHelper"));var je=n(3436),Ge=n(3056),We=n(7965),He=n(890),qe=n(3240),Ye=n(2038),Je=n(2328),Ke=n(2303),Xe=n(3162),Ze=n(1058),Qe=n(2729),$e=n(8774),et=n(2240),tt=n(8194),nt=n(9799),it=n(680),rt=n(5701),ot=n(6348),st=n(6410),at=n(7772),lt=n(1301),ct=n(1908),dt=n(8946),ut=n(2608),ht=n(1259);class pt extends we.O8{constructor(){super(...arguments),this.changed=new ke.IY,this.isLoadingChanged=new ke.IY,this.states=[],this.relationships=[],this.loadingCount=0}get value(){return this.states}get isLoading(){return 0!==this.loadingCount}markLoading(){return this.loadingCount++,()=>{0===--this.loadingCount&&this.isLoadingChanged.dispatch()}}sort(){this.states.sort(((e,t)=>{let n=e.sourceIndex-t.sourceIndex;return 0!==n?n:e.subsourceIndex-t.subsourceIndex}))}updateRelationships(){const e=new(p());for(const t of this.states)for(const n of t.source.relationships)e.add(n);this.relationships=u()(e)}add(e){return this.states.push(e),this.sort(),this.updateRelationships(),this.changed.dispatch(),()=>{const t=this.states.indexOf(e);this.states.splice(t,1),this.updateRelationships(),this.changed.dispatch()}}}function ft(e,t,n){void 0===t.error&&e.setLayerPosition(t.modelTransform,n)}function gt(e,t,n){const i=t.layerRank,r=new Float32Array(i);f.lc[e.type].visitGeometry(e,((e,o)=>{r.set(e);const s=new Float32Array(i);(o?Qe._U:Qe.vo)(s,t.chunkToLayerTransform,i+1,r,i),n(s,o)}))}class mt extends dt.oz{constructor(e,t){super(),this.layer=e,this.displayState=t,this.previousSelectedState=void 0,this.previousHoverId=void 0,this.previousHoverAnnotationLayerState=void 0,this.virtualListSource={length:0,render:e=>this.render(e),changed:new ke.HN},this.virtualList=new ut.w({source:this.virtualListSource}),this.listElements=[],this.updated=!1,this.mutableControls=document.createElement("div"),this.headerRow=document.createElement("div"),this.attachedAnnotationStates=new(c()),this.forceUpdateView=()=>{this.updated=!1,this.updateView()},this.globalDimensionIndices=[],this.localDimensionIndices=[],this.curCoordinateSpaceGeneration=-1,this.prevCoordinateSpaceGeneration=-1,this.columnWidths=[],this.gridTemplate="",this.selectedAnnotationState=(0,Se.ol)(((e,t)=>{var n;if(void 0===e)return;const i=this.layer,r=null===(n=e.layers.find((e=>e.layer===i)))||void 0===n?void 0:n.state;if(void 0===r)return;const o=r.annotationId;if(void 0===o)return;const s=this.annotationStates.states.find((e=>e.sourceIndex===r.annotationSourceIndex&&(void 0===r.annotationSubsource||e.subsourceId===r.annotationSubsource)));return void 0!==s?{annotationId:o,annotationLayerState:s,pin:t}:void 0}),this.layer.manager.root.selectionState,this.layer.manager.root.selectionState.pin),this.element.classList.add("neuroglancer-annotation-layer-view"),this.registerDisposer(this.visibility.changed.add((()=>this.updateView()))),this.registerDisposer(e.annotationStates.changed.add((()=>this.updateAttachedAnnotationLayerStates()))),this.headerRow.classList.add("neuroglancer-annotation-list-header");const n=document.createElement("div");n.className="neuroglancer-annotation-toolbox",e.initializeAnnotationLayerViewTab(this);const i=this.registerDisposer(new rt.G(this.displayState.color));i.element.title="Change annotation display color",this.registerDisposer(new We.cY((0,Se.ol)((e=>null!==e.match(/\bdefaultColor\b/)),t.shaderControls.processedFragmentMain),i.element)),n.appendChild(i.element);const r=this.mutableControls,o=(0,lt.m)({text:f.lc[f.UJ.POINT].icon,title:"Annotate point",onClick:()=>{this.layer.tool.value=new Et(this.layer,{})}});r.appendChild(o);const s=(0,lt.m)({text:f.lc[f.UJ.AXIS_ALIGNED_BOUNDING_BOX].icon,title:"Annotate bounding box",onClick:()=>{this.layer.tool.value=new Dt(this.layer,{})}});r.appendChild(s);const a=(0,lt.m)({text:f.lc[f.UJ.LINE].icon,title:"Annotate line",onClick:()=>{this.layer.tool.value=new Mt(this.layer,{})}});r.appendChild(a);const l=(0,lt.m)({text:f.lc[f.UJ.SPHERE].icon,title:"Annotate Sphere",onClick:()=>{this.layer.tool.value=new It(this.layer,{})}});r.appendChild(l);const d=(0,lt.m)({text:f.lc[f.UJ.ELLIPSOID].icon,title:"Annotate ellipsoid",onClick:()=>{this.layer.tool.value=new Rt(this.layer,{})}});r.appendChild(d),n.appendChild(r),this.element.appendChild(n),this.element.appendChild(this.headerRow);const u=this.virtualList;u.element.classList.add("neuroglancer-annotation-list"),this.element.appendChild(u.element),this.virtualList.element.addEventListener("mouseleave",(()=>{this.displayState.hoverState.value=void 0}));const h=(0,He.pL)();this.registerDisposer(new $e.qy(this.virtualList.element,h)),this.virtualList.element.title=h.describe(),this.registerDisposer(this.displayState.hoverState.changed.add((()=>this.updateHoverView()))),this.registerDisposer(this.selectedAnnotationState.changed.add((()=>this.updateSelectionView()))),this.registerDisposer(this.layer.localCoordinateSpace.changed.add((()=>{this.updateCoordinateSpace(),this.updateView()}))),this.registerDisposer(this.layer.manager.root.coordinateSpace.changed.add((()=>{this.updateCoordinateSpace(),this.updateView()}))),this.updateCoordinateSpace(),this.updateAttachedAnnotationLayerStates(),this.updateSelectionView()}get annotationStates(){return this.layer.annotationStates}updateAttachedAnnotationLayerStates(){const e=this.annotationStates.states,t=this.attachedAnnotationStates,n=new(c());for(const r of t){var i=(0,a.A)(r,2);const n=i[0],o=i[1];e.includes(n)||(t.delete(n),o.refCounted.dispose())}for(const r of e){const e=t.get(r);if(void 0!==e){n.set(r,e);continue}const i=r.source,o=new we.O8;(i instanceof f.vd||i instanceof m.oZ)&&(o.registerDisposer(i.childAdded.add((e=>this.addAnnotationElement(e,r)))),o.registerDisposer(i.childUpdated.add((e=>this.updateAnnotationElement(e,r)))),o.registerDisposer(i.childDeleted.add((e=>this.deleteAnnotationElement(e,r)))),o.registerDisposer(i.childRefreshed.add((()=>this.clearAnnotationElement(r))))),o.registerDisposer(r.transform.changed.add(this.forceUpdateView)),n.set(r,{refCounted:o,annotations:[],idToIndex:new(c()),listOffset:0})}this.attachedAnnotationStates=n,t.clear(),this.updateCoordinateSpace(),this.forceUpdateView()}updateCoordinateSpace(){const e=this.layer.localCoordinateSpace.value,t=this.layer.manager.root.coordinateSpace.value,n=[],i=[];for(let r=0,o=t.rank;r<o;++r)this.annotationStates.states.some((e=>{const t=e.transform.value;return void 0===t.error&&-1!==t.globalToRenderLayerDimensions[r]}))&&n.push(r);for(let r=0,o=e.rank;r<o;++r)this.annotationStates.states.some((e=>{const t=e.transform.value;return void 0===t.error&&-1!==t.localToRenderLayerDimensions[r]}))&&i.push(r);(0,E.r1)(n,this.globalDimensionIndices)&&(0,E.r1)(i,this.localDimensionIndices)||(this.localDimensionIndices=i,this.globalDimensionIndices=n,++this.curCoordinateSpaceGeneration)}getRenderedAnnotationListElement(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.attachedAnnotationStates.get(e);if(void 0==i)return;const r=i.idToIndex.get(t);if(void 0===r)return;const o=i.listOffset+r;return n&&this.virtualList.scrollItemIntoView(r),this.virtualList.getItemElement(o)}clearSelectionClass(){const e=this.previousSelectedState;if(void 0===e)return;this.previousSelectedState=void 0;const t=this.getRenderedAnnotationListElement(e.annotationLayerState,e.annotationId);void 0!==t&&t.classList.remove("neuroglancer-annotation-selected")}clearHoverClass(){const e=this.previousHoverId,t=this.previousHoverAnnotationLayerState;if(void 0!==t){this.previousHoverAnnotationLayerState=void 0,this.previousHoverId=void 0;const n=this.getRenderedAnnotationListElement(t,e);void 0!==n&&n.classList.remove("neuroglancer-annotation-hover")}}updateSelectionView(){const e=this.selectedAnnotationState.value,t=this.previousSelectedState;if(t===e||void 0!==t&&void 0!==e&&t.annotationId===e.annotationId&&t.annotationLayerState===e.annotationLayerState&&t.pin===e.pin)return;if(this.clearSelectionClass(),this.previousSelectedState=e,void 0===e)return;const n=this.getRenderedAnnotationListElement(e.annotationLayerState,e.annotationId,e.pin);void 0!==n&&n.classList.add("neuroglancer-annotation-selected")}updateHoverView(){const e=this.displayState.hoverState.value;let t,n;void 0!==e&&(t=e.id,n=e.annotationLayerState);const i=this.previousHoverId,r=this.previousHoverAnnotationLayerState;if(t===i&&n===r)return;if(this.clearHoverClass(),this.previousHoverId=t,this.previousHoverAnnotationLayerState=n,void 0===t)return;const o=this.getRenderedAnnotationListElement(n,t);void 0!==o&&o.classList.add("neuroglancer-annotation-hover")}render(e){var t=this.listElements[e];const n=t.annotation,i=t.state;return this.makeAnnotationListElement(n,i)}setColumnWidth(e,t){t+=2;const n=this.columnWidths;n[e]>t||(n[e]=t,this.element.style.setProperty("--neuroglancer-column-".concat(e,"-width"),"".concat(t,"ch")))}updateView(){if(!this.visible)return;if(this.curCoordinateSpaceGeneration!==this.prevCoordinateSpaceGeneration){this.updated=!1;this.columnWidths.length=0;const e=this.headerRow,t=document.createElement("div");t.style.gridColumn="symbol";const n=document.createElement("div");n.style.gridColumn="delete",(0,Xe.gS)(e),e.appendChild(t);let i=0,r="[symbol] 2ch";const o=(t,n)=>{const o=document.createElement("div");o.classList.add("neuroglancer-annotations-view-dimension");const s=document.createElement("span");s.classList.add("neuroglancer-annotations-view-dimension-name"),s.textContent=t.names[n];const a=document.createElement("scale");a.classList.add("neuroglancer-annotations-view-dimension-scale"),a.textContent=(0,et.NJ)(t.scales[n],t.units[n],{precision:2}),o.appendChild(s),o.appendChild(a),o.style.gridColumn="dim ".concat(i+1),this.setColumnWidth(i,a.textContent.length+s.textContent.length+3),r+=" [dim] var(--neuroglancer-column-".concat(i,"-width)"),++i,e.appendChild(o)},s=this.layer.manager.root.coordinateSpace.value;for(const l of this.globalDimensionIndices)o(s,l);const a=this.layer.localCoordinateSpace.value;for(const l of this.localDimensionIndices)o(a,l);e.appendChild(n),r+=" [delete] 2ch",this.gridTemplate=r,e.style.gridTemplateColumns=r,this.prevCoordinateSpaceGeneration=this.curCoordinateSpaceGeneration}if(this.updated)return;let e=!1;const t=this.listElements;t.length=0;for(const r of this.attachedAnnotationStates){var n=(0,a.A)(r,2);const i=n[0],o=n[1];if(i.source.readonly||(e=!0),void 0!==i.chunkTransform.value.error)continue;const s=i.source,l=u()(s);o.annotations=l;const c=o.idToIndex;c.clear();for(let e=0,t=l.length;e<t;++e)c.set(l[e].id,e);for(const e of l)t.push({state:i,annotation:e})}const i=this.virtualListSource.length;this.updateListLength(),this.virtualListSource.changed.dispatch([{retainCount:0,deleteCount:i,insertCount:t.length}]),this.mutableControls.style.display=e?"contents":"none",this.resetOnUpdate()}updateListLength(){let e=0;for(const t of this.attachedAnnotationStates.values())t.listOffset=e,e+=t.annotations.length;this.virtualListSource.length=e}clearAnnotationElement(e){if(!this.visible)return void(this.updated=!1);if(!this.updated)return void this.updateView();const t=this.attachedAnnotationStates.get(e);if(void 0!==t){const e=t.annotations.length;t.annotations=[],t.idToIndex.clear(),this.listElements=[],this.updateListLength(),this.virtualListSource.changed.dispatch([{retainCount:0,deleteCount:e,insertCount:0}])}this.resetOnUpdate()}addAnnotationElement(e,t){if(!this.visible)return void(this.updated=!1);if(!this.updated)return void this.updateView();const n=this.attachedAnnotationStates.get(t);if(void 0!==n){const i=n.annotations.length;n.annotations.push(e),n.idToIndex.set(e.id,i);const r=n.listOffset+i;this.listElements.splice(r,0,{state:t,annotation:e}),this.updateListLength(),this.virtualListSource.changed.dispatch([{retainCount:r,deleteCount:0,insertCount:1}])}this.resetOnUpdate()}updateAnnotationElement(e,t){if(!this.visible)return void(this.updated=!1);if(!this.updated)return void this.updateView();const n=this.attachedAnnotationStates.get(t);if(void 0!==n){const t=n.idToIndex.get(e.id);if(void 0!==t){const i=n.listOffset+t;n.annotations[t]=e,this.listElements[i].annotation=e,this.virtualListSource.changed.dispatch([{retainCount:i,deleteCount:1,insertCount:1}])}}this.resetOnUpdate()}deleteAnnotationElement(e,t){if(!this.visible)return void(this.updated=!1);if(!this.updated)return void this.updateView();const n=this.attachedAnnotationStates.get(t);if(void 0!==n){const t=n.idToIndex,i=t.get(e);if(void 0!==i){const r=n.listOffset+i,o=n.annotations;o.splice(i,1),t.delete(e);for(let e=i,n=o.length;e<n;++e)t.set(o[e].id,e);this.listElements.splice(r,1),this.updateListLength(),this.virtualListSource.changed.dispatch([{retainCount:r,deleteCount:1,insertCount:0}])}}this.resetOnUpdate()}resetOnUpdate(){this.clearHoverClass(),this.clearSelectionClass(),this.updated=!0,this.updateHoverView(),this.updateSelectionView()}makeAnnotationListElement(e,t){const n=t.chunkTransform.value,i=document.createElement("div");i.classList.add("neuroglancer-annotation-list-entry"),i.style.gridTemplateColumns=this.gridTemplate;const r=document.createElement("div");let o;r.className="neuroglancer-annotation-icon",r.textContent=f.lc[e.type].icon,i.appendChild(r);let s=0;if(gt(e,n,((r,a)=>{++s;const l=document.createElement("div");l.className="neuroglancer-annotation-position",i.appendChild(l);let c=0;const d=(e,t)=>{for(const n of e){const e=t[n];if(-1!==e){const t=Math.floor(r[e]),n=document.createElement("div"),i=t.toString();n.textContent=i,n.classList.add("neuroglancer-annotation-coordinate"),n.style.gridColumn="dim ".concat(c+1),this.setColumnWidth(c,i.length),l.appendChild(n)}++c}};d(this.globalDimensionIndices,n.modelTransform.globalToRenderLayerDimensions),d(this.localDimensionIndices,n.modelTransform.localToRenderLayerDimensions),t.source.readonly||void 0===o&&(o=(0,st.w)({title:"Delete annotation",onClick:n=>{n.stopPropagation(),n.preventDefault();const i=t.source.getReference(e.id);try{t.source.delete(i)}finally{i.dispose()}}}),o.classList.add("neuroglancer-annotation-list-entry-delete"),i.appendChild(o))})),e.description){++s;const t=document.createElement("div");t.classList.add("neuroglancer-annotation-description"),t.textContent=e.description,i.appendChild(t)}r.style.gridRow="span ".concat(s),void 0!==o&&(o.style.gridRow="span ".concat(s)),i.addEventListener("mouseenter",(()=>{this.displayState.hoverState.value={id:e.id,partIndex:0,annotationLayerState:t},this.layer.selectAnnotation(t,e.id,!1)})),i.addEventListener("action:select-position",(n=>{n.stopPropagation(),this.layer.selectAnnotation(t,e.id,"toggle")})),i.addEventListener("action:pin-annotation",(n=>{n.stopPropagation(),this.layer.selectAnnotation(t,e.id,!0)})),i.addEventListener("action:move-to-annotation",(t=>{t.stopPropagation(),t.preventDefault();const i=n.layerRank,r=new Float32Array(i),o=new Float32Array(i);!function(e,t){switch(t.type){case f.UJ.AXIS_ALIGNED_BOUNDING_BOX:case f.UJ.LINE:case f.UJ.SPHERE:nt.WQ(e,t.pointA,t.pointB),nt.hs(e,e,.5);break;case f.UJ.POINT:e.set(t.point);break;case f.UJ.ELLIPSOID:e.set(t.center)}}(r,e),Qe.vo(o,n.chunkToLayerTransform,i+1,r,i),ft(this.layer,n,o)}));const a=this.selectedAnnotationState.value;return void 0!==a&&a.annotationLayerState===t&&a.annotationId===e.id&&i.classList.add("neuroglancer-annotation-selected"),i}}class vt extends dt.oz{constructor(e){super(),this.layer=e,this.layerView=this.registerDisposer(new mt(this.layer,this.layer.annotationDisplayState));const t=this.element;t.classList.add("neuroglancer-annotations-tab"),t.appendChild(this.layerView.element)}}function yt(e){let t=[];const n=e.source.relationships,i=e.displayState.relationshipStates;for(let r=0,o=n.length;r<o;++r){const e=i.get(n[r]).segmentationState.value;null!=e&&e.segmentSelectionState.hasSelectedSegment?t[r]=[e.segmentSelectionState.selectedSegment.clone()]:t[r]=[]}return t}class bt extends qe.a0{constructor(e,t){super(e)}get annotationLayer(){for(const e of this.layer.annotationStates.states)if(!e.source.readonly)return e}}const St="annotatePoint",wt="annotateLine",xt="annotateBoundingBox",Ct="annotateEllipsoid",kt="annotateSphere";class Et extends bt{constructor(){super(...arguments),this.sourceSignalUpdated=!1}trigger(e){const t=this.annotationLayer;if(void 0!==t&&e.updateUnconditionally()){const n=Tt(e,t);if(void 0===n)return;const i={id:"",description:"",relatedSegments:yt(t),point:n,type:f.UJ.POINT,properties:t.source.properties.map((e=>e.default))},r=t.source.add(i,!0);t.source instanceof m.oZ?this.sourceSignalUpdated||(t.source.childAdded.add((e=>{void 0===e.source&&this.layer.selectAnnotation(t,e.id,!0,!ht.sw.expectingExternalUI)})),this.sourceSignalUpdated=!0):this.layer.selectAnnotation(t,r.id,!0),r.dispose()}}get description(){return"annotate point"}toJSON(){return St}}function Tt(e,t){const n=t.chunkTransform.value;if(void 0!==n.error)return;const i=new Float32Array(n.modelTransform.unpaddedRank);return(0,ce.Mk)(i,e.unsnappedPosition,t.localPosition.value,n.layerRank,n.combinedGlobalLocalToChunkTransform)?i:void 0}class Lt extends bt{trigger(e){const t=this.annotationLayer;if(void 0!==t&&e.updateUnconditionally()){const n=()=>{const n=this.inProgressAnnotation,i=n.reference,r=this.getUpdatedAnnotation(i.value,e,t);s()((0,f.RB)(r,t.source))!==s()((0,f.RB)(i.value,t.source))&&(n.annotationLayer.source.update(i,r),this.layer.selectAnnotation(t,i.id,!0,!ht.sw.expectingExternalUI))};if(void 0===this.inProgressAnnotation){const i=t.source.add(this.getInitialAnnotation(e,t),!1);this.layer.selectAnnotation(t,i.id,!0,!ht.sw.expectingExternalUI);const r=e.changed.add(n),o=()=>{r(),i.dispose()};this.inProgressAnnotation={annotationLayer:t,reference:i,disposer:o}}else n(),this.inProgressAnnotation.annotationLayer.source.commit(this.inProgressAnnotation.reference),this.inProgressAnnotation.disposer(),this.inProgressAnnotation=void 0}}disposed(){this.deactivate(),super.disposed()}deactivate(){void 0!==this.inProgressAnnotation&&(this.inProgressAnnotation.annotationLayer.source.delete(this.inProgressAnnotation.reference),this.inProgressAnnotation.disposer(),this.inProgressAnnotation=void 0)}}class Pt extends Lt{getInitialAnnotation(e,t){const n=Tt(e,t);return{id:"",type:this.annotationType,description:"",pointA:n,pointB:n,properties:t.source.properties.map((e=>e.default))}}getUpdatedAnnotation(e,t,n){const i=Tt(t,n);return void 0===i?e:r()(r()({},e),{pointB:i})}}class Dt extends Pt{get description(){return"annotate bounding box"}getUpdatedAnnotation(e,t,n){const i=super.getUpdatedAnnotation(e,t,n),r=i.pointA,o=i.pointB,s=r.length;for(let a=0;a<s;++a)r[a]===o[a]&&(o[a]+=1);return i}toJSON(){return xt}}Dt.prototype.annotationType=f.UJ.AXIS_ALIGNED_BOUNDING_BOX;class Mt extends Pt{get description(){return"annotate line"}getInitialAnnotation(e,t){const n=super.getInitialAnnotation(e,t);return this.initialRelationships=n.relatedSegments=yt(t),n}getUpdatedAnnotation(e,t,n){const i=super.getUpdatedAnnotation(e,t,n),r=this.initialRelationships,o=yt(n);return i.relatedSegments=void 0===r?o:u()(o,((e,t)=>{const n=r[t];return e=e.filter((e=>-1===n.findIndex((t=>tt.Uint64.equal(e,t))))),[...n,...e]})),i}toJSON(){return wt}}Mt.prototype.annotationType=f.UJ.LINE;class It extends Pt{get description(){return"annotate sphere"}getInitialAnnotation(e,t){const n=super.getInitialAnnotation(e,t);return this.initialRelationships=n.relatedSegments=yt(t),n}getUpdatedAnnotation(e,t,n){const i=super.getUpdatedAnnotation(e,t,n),r=this.initialRelationships,o=yt(n);return i.relatedSegments=void 0===r?o:u()(o,((e,t)=>{const n=r[t];return e=e.filter((e=>-1===n.findIndex((t=>tt.Uint64.equal(e,t))))),[...n,...e]})),i}toJSON(){return kt}}It.prototype.annotationType=f.UJ.SPHERE;class Rt extends Lt{getInitialAnnotation(e,t){const n=Tt(e,t);return{type:f.UJ.ELLIPSOID,id:"",description:"",segments:yt(t),center:n,radii:T.eR.fromValues(0,0,0),properties:t.source.properties.map((e=>e.default))}}getUpdatedAnnotation(e,t,n){const i=Tt(t,n);if(void 0===i)return e;const o=e.center,s=o.length;for(let r=0;r<s;++r)i[r]=Math.abs(o[r]-i[r]);return r()(r()({},e),{radii:i})}get description(){return"annotate ellipsoid"}toJSON(){return Ct}}(0,qe.li)(St,((e,t)=>new Et(e,t))),(0,qe.li)(xt,((e,t)=>new Dt(e,t))),(0,qe.li)(wt,((e,t)=>new Mt(e,t))),(0,qe.li)(Ct,((e,t)=>new Rt(e,t))),(0,qe.li)(kt,((e,t)=>new It(e,t)));const At=Ze.n5.fromObject({enter:{action:"commit"},escape:{action:"cancel"}});function Ot(e,t,n,i){return new at.p(n,((n,r,o)=>{const s=document.createElement("div");s.classList.add("neuroglancer-related-segment-list"),null!=n&&o.registerDisposer((0,ue.bindSegmentListWidth)(n,s));const a=document.createElement("div");a.classList.add("neuroglancer-related-segment-list-header");const l=(0,ot.C)({title:"Copy segment IDs",onClick:()=>{(0,Je.B)(t.map((e=>e.toString())).join(", "))}});let c;if(a.appendChild(l),null!=n&&(c=document.createElement("input"),c.type="checkbox",c.addEventListener("change",(()=>{const e=n.segmentationGroupState.value.visibleSegments,i=t.some((t=>!e.has(t)));for(const n of t)e.set(n,i)})),a.appendChild(c)),void 0!==i){const e=(0,st.w)({title:"Remove all IDs",onClick:()=>{i([])}});a.appendChild(e)}const d=document.createElement("span");if(d.classList.add("neuroglancer-related-segment-list-title"),d.textContent=e,a.appendChild(d),void 0!==i){const e=(0,it.G)({title:"Add related segment ID",onClick:()=>{const e=new we.O8,r=o.registerDisposer((0,we.K9)(e)),a=document.createElement("div");a.classList.add("neuroglancer-segment-list-entry"),a.classList.add("neuroglancer-segment-list-entry-new");const l=(0,ot.C)({});if(l.classList.add("neuroglancer-segment-list-entry-copy"),a.appendChild(l),null!=n){const e=document.createElement("input");e.classList.add("neuroglancer-segment-list-entry-visible-checkbox"),e.type="checkbox",a.appendChild(e)}const c=(0,st.w)({title:"Cancel adding new segment ID",onClick:()=>{r()}});c.classList.add("neuroglancer-segment-list-entry-delete"),a.appendChild(c);const d=document.createElement("input");d.autocomplete="off",d.spellcheck=!1,d.classList.add("neuroglancer-segment-list-entry-id");e.registerDisposer(new Ze.cL(d,At)).allShortcutsAreGlobal=!0;const u=()=>{const e=new tt.Uint64;return e.tryParseString(d.value)?(d.dataset.valid="true",e):void(d.dataset.valid="false")};u(),d.addEventListener("input",(()=>{u()})),d.addEventListener("blur",(()=>{const e=u();void 0!==e&&i([...t,e]),r()})),(0,Ze.qZ)(d,"cancel",r),(0,Ze.qZ)(d,"commit",(()=>{const e=u();void 0!==e&&i([...t,e]),r()})),a.appendChild(d),s.appendChild(a),d.focus(),e.registerDisposer((()=>{d.value="",a.remove()}))}});a.appendChild(e)}s.appendChild(a);const u=[],h=ue.SegmentWidgetFactory.make(null!==n&&void 0!==n?n:void 0,!1);for(const e of t){const n=h.get(e);if(u.push(n),void 0!==i){const r=(0,st.w)({title:"Remove ID",onClick:n=>{i(t.filter((t=>!tt.Uint64.equal(t,e)))),n.stopPropagation()}});r.classList.add("neuroglancer-segment-list-entry-delete"),n.children[0].appendChild(r)}s.appendChild(n)}if(null!=n){const e=o.registerCancellable((0,Ye.t)((()=>{const e=n.segmentationGroupState.value.visibleSegments;let i=0;for(const n of t)e.has(n)&&++i;for(const t of u)h.update(t);c.checked=i===t.length&&i>0,c.indeterminate=i>0&&i<t.length})));e(),e.flush(),(0,ue.registerCallbackWhenSegmentationDisplayStateChanged)(n,o,e),o.registerDisposer(n.segmentationGroupState.changed.add(e))}r.appendChild(s)}))}const Nt="annotationColor";function _t(e){return class extends e{constructor(){let e;super(...arguments),this.annotationStates=this.registerDisposer(new pt),this.annotationDisplayState=new g.lH,this.annotationCrossSectionRenderScaleHistogram=new je.zD,this.annotationCrossSectionRenderScaleTarget=(0,je.fm)(8),this.annotationProjectionRenderScaleHistogram=new je.zD,this.annotationProjectionRenderScaleTarget=(0,je.fm)(8),this.annotationDisplayState.color.changed.add(this.specificationChanged.dispatch),this.annotationDisplayState.shader.changed.add(this.specificationChanged.dispatch),this.annotationDisplayState.shaderControls.changed.add(this.specificationChanged.dispatch),this.tabs.add("annotations",{label:"Annotations",order:10,getter:()=>new vt(this)});const t=()=>{const t=this.isReady;t&&void 0!==e?(e(),e=void 0):t||void 0!==e||(e=this.annotationStates.markLoading())};this.readyStateChanged.add(t),t();const n=this.manager.layerSelectedValues.mouseState;this.registerDisposer(n.changed.add((()=>{if(n.active){const e=n.pickedAnnotationLayer;if(void 0!==e&&this.annotationStates.states.includes(e)){const t=this.annotationDisplayState.hoverState.value;return void(void 0!==t&&t.id===n.pickedAnnotationId&&t.partIndex===n.pickedOffset&&t.annotationLayerState===e||(this.annotationDisplayState.hoverState.value={id:n.pickedAnnotationId,partIndex:n.pickedOffset,annotationLayerState:e}))}}this.annotationDisplayState.hoverState.value=void 0})))}initializeAnnotationLayerViewTab(e){}restoreState(e){super.restoreState(e),this.annotationDisplayState.color.restoreState(e[Nt])}captureSelectionState(e,t){super.captureSelectionState(e,t);const n=t.pickedAnnotationLayer;void 0!==n&&this.annotationStates.states.includes(n)&&(e.annotationId=t.pickedAnnotationId,e.annotationType=t.pickedAnnotationType,e.annotationBuffer=new Uint8Array(t.pickedAnnotationBuffer,t.pickedAnnotationBufferBaseOffset),e.annotationIndex=t.pickedAnnotationIndex,e.annotationCount=t.pickedAnnotationCount,e.annotationPartIndex=t.pickedOffset,e.annotationSourceIndex=n.sourceIndex,e.annotationSubsource=n.subsourceId)}displayAnnotationState(e,t,n){if(void 0===e.annotationId)return!1;const i=this.annotationStates.states.find((t=>t.sourceIndex===e.annotationSourceIndex&&(void 0===e.annotationSubsource||t.subsourceId===e.annotationSubsource)));if(void 0===i)return!1;i.source,m.oZ;const o=n.registerDisposer(i.source.getReference(e.annotationId));return t.appendChild(n.registerDisposer(new at.p(n.registerDisposer(new Se.wP((()=>({annotation:o,chunkTransform:i.chunkTransform})))),((t,n,s)=>{let a,{annotation:l,chunkTransform:c}=t;if(null==l)if(void 0!==e.annotationType&&void 0!==e.annotationBuffer){const t=f.lc[e.annotationType],n=i.source.rank,r=t.serializedBytes(n),o=e.annotationBuffer.byteOffset,s=new DataView(e.annotationBuffer.buffer),c=xe.H$.LITTLE===xe.Hp,d=i.source.properties,u=new f.nx(n,r,d),h=e.annotationIndex,p=e.annotationCount;l=t.deserialize(s,o+u.propertyGroupBytes[0]*h,c,n,e.annotationId),u.deserialize(s,o,h,p,c,l.properties=new Array(d.length)),i.source.hasNonSerializedProperties()&&(a="Loading...")}else a=null===l?"Annotation not found":"Loading...";if(null!=l){const e=void 0===c.error?c.layerRank:0,t=document.createElement("div");t.classList.add("neuroglancer-selected-annotation-details-position-grid"),t.style.gridTemplateColumns="[icon] 0fr [copy] 0fr repeat(".concat(e,", [dim] 0fr [coord] 0fr) [move] 0fr [delete] 0fr"),n.appendChild(t);const a=f.lc[l.type],u=document.createElement("div");if(u.className="neuroglancer-selected-annotation-details-icon",u.textContent=a.icon,t.appendChild(u),0!==e){const n=c.modelTransform.layerDimensionNames;for(let i=0;i<e;++i){const e=document.createElement("div");e.classList.add("neuroglancer-selected-annotation-details-position-dim"),e.textContent=n[i],e.style.gridColumn="dim ".concat(i+1),t.appendChild(e)}gt(l,c,((n,i)=>{const r=(0,ot.C)({title:"Copy position",onClick:()=>{(0,Je.B)(n.map((e=>Math.floor(e))).join(", "))}});r.style.gridColumn="copy",t.appendChild(r);for(let o=0;o<e;++o){const e=document.createElement("div");e.classList.add("neuroglancer-selected-annotation-details-position-coord"),e.style.gridColumn="coord ".concat(o+1),e.textContent=Math.floor(n[o]).toString(),t.appendChild(e)}if(!i){const e=(0,ct.b)({title:"Move to position",onClick:()=>{ft(this,c,n)}});e.style.gridColumn="move",t.appendChild(e)}}))}if(!i.source.readonly){const e=(0,st.w)({title:"Delete annotation",onClick:()=>{i.source.delete(o)}});e.classList.add("neuroglancer-selected-annotation-details-delete"),t.appendChild(e)}var d=i.source;const h=d.relationships,p=d.properties,g=i.source.readonly;for(let i=0,r=p.length;i<r;++i){const e=p[i],t=document.createElement("label");t.classList.add("neuroglancer-annotation-property");const r=document.createElement("span");r.classList.add("neuroglancer-annotation-property-label"),r.textContent=e.identifier,t.appendChild(r);const o=e.description;void 0!==o&&(t.title=o);const s=l.properties[i],a=document.createElement("span");switch(a.classList.add("neuroglancer-annotation-property-value"),e.type){case"rgb":{const e=(0,Ke.unpackRGB)(s),t=(0,Ke.serializeColor)(e);a.textContent=t,a.style.backgroundColor=t,a.style.color=(0,Ke.useWhiteBackground)(e)?"white":"black";break}case"rgba":{const e=(0,Ke.unpackRGB)(s);a.textContent=(0,Ke.serializeColor)((0,Ke.unpackRGBA)(s)),a.style.backgroundColor=(0,Ke.serializeColor)((0,Ke.unpackRGB)(s)),a.style.color=(0,Ke.useWhiteBackground)(e)?"white":"black";break}default:a.textContent=(0,f.Y9)(e,s)}t.appendChild(a),n.appendChild(t)}const v=l.relatedSegments;for(let l=0,c=h.length;l<c;++l){const e=void 0===v?[]:v[l];if(0===e.length&&g)continue;const t=l,a=h[l];n.appendChild(s.registerDisposer(Ot(a,e,i.displayState.relationshipStates.get(a).segmentationState,g?void 0:e=>{const n=o.value;if(null==n)return;let s=n.relatedSegments;s=void 0===s?i.source.relationships.map((()=>[])):s.slice(),s[t]=e;const a=r()(r()({},n),{relatedSegments:s});i.source.update(o,a),i.source.commit(o)})).element)}let y=null,b=i.source;if(b instanceof m.oZ&&b.makeEditWidget&&(y=b.makeEditWidget(o),y&&(y.className="neuroglancer-annotation-details-description",n.appendChild(y))),(!i.source.readonly||l.description)&&null===y)if(i.source.readonly){const e=document.createElement("div");e.className="neuroglancer-annotation-details-description",e.textContent=l.description||"",n.appendChild(e)}else{const e=document.createElement("textarea");e.value=l.description||"",e.rows=3,e.className="neuroglancer-annotation-details-description",e.placeholder="Description",e.addEventListener("change",(()=>{const t=e.value;i.source.update(o,r()(r()({},l),{description:t||void 0})),i.source.commit(o)})),n.appendChild(e)}}if(void 0!==a){const e=document.createElement("div");e.classList.add("neuroglancer-selection-annotation-status"),e.textContent=a,n.appendChild(e)}}))).element),!0}displaySelectionState(e,t,n){let i=this.displayAnnotationState(e,t,n);return super.displaySelectionState(e,t,n)&&(i=!0),i}addLocalAnnotations(e,t,n){const i=e.subsourceEntry,r=new g.s0({localPosition:this.localPosition,transform:e.getRenderLayerTransform(),source:t,displayState:this.annotationDisplayState,dataSource:e.loadedDataSource.layerDataSource,subsourceIndex:e.subsourceIndex,subsourceId:i.id,role:n});this.addAnnotationLayerState(r,e)}addStaticAnnotations(e){const t=e.subsourceEntry.subsource.staticAnnotations;return void 0!==t&&(e.activate((()=>{this.addLocalAnnotations(e,t,Ge.gY.DEFAULT_ANNOTATION)})),!0)}addAnnotationLayerState(e,t){const n=t.activated;n.registerDisposer(this.annotationStates.add(e));const i=new Ie(this.manager.chunkManager,e.addRef());if(i.source instanceof m.oZ){const e=new Ue({annotationLayer:i.addRef(),renderScaleTarget:this.annotationCrossSectionRenderScaleTarget,renderScaleHistogram:this.annotationCrossSectionRenderScaleHistogram});n.registerDisposer(t.messages.addChild(e.messages));const r=new Fe({annotationLayer:i.addRef(),renderScaleTarget:this.annotationProjectionRenderScaleTarget,renderScaleHistogram:this.annotationProjectionRenderScaleHistogram});n.registerDisposer(t.messages.addChild(r.messages)),n.registerDisposer((0,Se.no)(((t,n)=>{n&&(t.registerDisposer(this.addRenderLayer(e.addRef())),t.registerDisposer(this.addRenderLayer(r.addRef())))}),this.annotationDisplayState.displayUnfiltered))}{const e=new ze(i,this.annotationCrossSectionRenderScaleHistogram);n.registerDisposer(this.addRenderLayer(e)),n.registerDisposer(t.messages.addChild(e.messages))}{const e=new Ve(i.addRef(),this.annotationProjectionRenderScaleHistogram);n.registerDisposer(this.addRenderLayer(e)),n.registerDisposer(t.messages.addChild(e.messages))}}selectAnnotation(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.manager.root.selectionState.captureSingleLayerState(this,(n=>(n.annotationId=t,n.annotationSourceIndex=e.sourceIndex,n.annotationSubsource=e.subsourceId,!0)),n,i)}toJSON(){const e=super.toJSON();return e[Nt]=this.annotationDisplayState.color.toJSON(),e}}}},890:(e,t,n)=>{n.d(t,{o6:()=>d,pL:()=>u,yx:()=>p});var i=n(8602);let r,o,s,a,l,c;function d(){return void 0===o&&(o=i.n5.fromObject({"control+mousedown2":"select-position"})),o}function u(){return void 0===s&&(s=i.n5.fromObject({click0:"pin-annotation",mousedown2:"move-to-annotation"},{parents:[[d(),0]]})),s}function h(){return void 0===a&&(a=i.n5.fromObject({arrowleft:"x-",arrowright:"x+",arrowup:"y-",arrowdown:"y+",comma:"z-",period:"z+",bracketleft:"t-",bracketright:"t+",keyz:"snap","control+equal":"zoom-in","alt+equal":"depth-range-decrease","control+shift+equal":"zoom-in","alt+shift+equal":"depth-range-decrease","control+minus":"zoom-out","alt+minus":"depth-range-increase",keyr:"rotate-relative-z-",keye:"rotate-relative-z+","shift+arrowdown":"rotate-relative-x-","shift+arrowup":"rotate-relative-x+","shift+arrowleft":"rotate-relative-y-","shift+arrowright":"rotate-relative-y+","control+wheel":{action:"zoom-via-wheel",preventDefault:!0},"alt+wheel":{action:"adjust-depth-range-via-wheel",preventDefault:!0},"at:wheel":{action:"z+1-via-wheel",preventDefault:!0},"at:shift+wheel":{action:"z+10-via-wheel",preventDefault:!0},"at:alt+mousedown2":"copy-segment-id","at:alt+shift+mousedown2":"add-copy-segment-id","at:dblclick0":"select","at:control+mousedown0":"annotate","at:mousedown2":"move-to-mouse-position","at:alt+mousedown0":"move-annotation","at:control+alt+mousedown2":"delete-annotation","at:touchpinch":"zoom-via-touchpinch","at:touchrotate":"rotate-in-plane-via-touchrotate","at:touchtranslate2":"translate-in-plane-via-touchtranslate","at:touchhold1":"move-to-mouse-position","at:touchtap1x2":"select","at:touchtap2x3":"snap"},{label:"All Data Panels",parents:[[d(),0]]})),a}function p(e){e.global.addParent(function(){if(void 0===r){const e=new i.n5;e.set("keyl","recolor"),e.set("keyx","clear-segments"),e.set("keys","toggle-show-slices"),e.set("keyb","toggle-scale-bar"),e.set("keyv","toggle-default-annotations"),e.set("keya","toggle-axis-lines"),e.set("keyo","toggle-orthographic-projection");for(let t=1;t<=9;++t)e.set("digit"+t,"toggle-layer-"+t),e.set("control+digit"+t,"select-layer-"+t),e.set("alt+digit"+t,"toggle-pick-layer-"+t);for(let t=0;t<26;++t){const n=String.fromCharCode(97+t),i=String.fromCharCode(65+t);e.set("alt?+control?+shift+key".concat(n),"tool-".concat(i))}e.set("keyn","add-layer"),e.set("keyh","help"),e.set("space","toggle-layout"),e.set("shift+space","toggle-layout-alternative"),e.set("backslash","toggle-show-statistics"),r=e}return r}(),Number.NEGATIVE_INFINITY),e.sliceView.addParent((void 0===c&&(c=i.n5.fromObject({"at:mousedown0":{action:"translate-via-mouse-drag",stopPropagation:!0},"at:shift+mousedown0":{action:"rotate-via-mouse-drag",stopPropagation:!0},"at:touchtranslate1":"translate-z-via-touchtranslate"},{parents:[[h(),Number.NEGATIVE_INFINITY]]})),c),Number.NEGATIVE_INFINITY),e.perspectiveView.addParent((void 0===l&&(l=i.n5.fromObject({"at:mousedown0":{action:"rotate-via-mouse-drag",stopPropagation:!0},"at:shift+mousedown0":{action:"translate-via-mouse-drag",stopPropagation:!0},"at:touchtranslate1":"rotate-out-of-plane-via-touchtranslate"},{parents:[[h(),Number.NEGATIVE_INFINITY]]})),l),Number.NEGATIVE_INFINITY)}},9548:(e,t,n)=>{n.d(t,{H:()=>c,m:()=>d});var i=n(9735),r=n(3162);let o,s=[];function a(e){const t=function(){if(void 0===o){const e=o=document.createElement("div");e.classList.add("neuroglancer-drag-status"),document.body.appendChild(e)}return o}();(0,r.gS)(t),"string"===typeof e?t.appendChild(document.createTextNode(e)):t.appendChild(e()),t.style.display=""}function l(e,t){(0,i.U8)(s,(n=>!(n.target===e&&n.operation===t)))}function c(e,t,n){l(e,t),s.push({target:e,operation:t,status:n}),a(n)}function d(e,t){l(e,t);const n=0===s.length?void 0:s[s.length-1];void 0===n?void 0!==o&&((0,r.gS)(o),o.style.display="none"):a(n.status)}},8868:(e,t,n)=>{n.d(t,{AZ:()=>x,ri:()=>S,vm:()=>b});var i=n(974),r=n.n(i),o=n(1274),s=n.n(o),a=n(2982),l=n(3651),c=n.n(l),d=n(7160),u=n(4228),h=n(9735),p=n(7562),f=n(7970),g=n(6344);const m="tab",v="tabs",y="panels",b=c()(c()({},u.n7),{row:0}),S=c()(c()({},u.n7),{visible:!0,row:0});class w extends p.O8{constructor(e){super(),this.panels=e,this.layer=this.panels.layer,this.location=new u.c1(S),this.tabsChanged=new g.HN,this.selectedTab=new d.B0(void 0),this.tabs=[]}initialize(){const e=this.panels;this.tabsChanged.add(e.specificationChanged.dispatch),this.selectedTab.changed.add(e.specificationChanged.dispatch),this.location.changed.add((()=>{var t;e.specificationChanged.dispatch();const n=this.layer,i=n.manager.root.selectedLayer;if((null===(t=i.layer)||void 0===t?void 0:t.layer)!==n)return;if(this!==n.panels.panels[0])return;const r=this.location.value;i.location.value!==r&&(i.location.value=r,i.location.locationChanged.dispatch())})),this.location.locationChanged.add((()=>{this.location.visible||this!==this.panels.panels[0]&&this.panels.removePanel(this)}))}normalizeTabs(){const e=this.tabs;if(0===e.length)return void(this.selectedTab.value=void 0);const t=this.layer.tabs.options,n=e=>{var n;return null!==(n=t.get(e).order)&&void 0!==n?n:0};e.sort(((e,t)=>n(e)-n(t)));const i=this.selectedTab,r=i.value;void 0!==r&&e.includes(r)||(i.value=e[0])}pin(){var e;const t=this.layer,n=t.manager.root.selectedLayer;if((null===(e=n.layer)||void 0===e?void 0:e.layer)!==t)return;if(this!==t.panels.panels[0])return;if(0===this.tabs.length)return;const i=this.panels,r=t.registerDisposer(new w(i));i.panels.splice(0,1,r),i.panels.push(this),i.updateTabs(),r.initialize(),n.layerManager.layersChanged.dispatch(),this.panels.specificationChanged.dispatch()}unpin(){var e;const t=this.panels,n=t.panels.indexOf(this);if(-1===n||0===n)return;const i=this.layer,r=i.manager.root.selectedLayer,o=null===(e=r.layer)||void 0===e?void 0:e.layer;if(r.visible&&null!=o&&o!=i){o.panels.panels[0].pin()}t.panels.splice(n,1);var l=t.panels.splice(0,1,this);const c=(0,a.A)(l,1)[0];if(void 0===this.explicitTabs)i.unregisterDisposer(c);else{t.panels.push(c);for(let e=1,n=t.panels.length;e<n;++e){const n=t.panels[e];void 0===n.explicitTabs&&(n.explicitTabs=new(s())(n.tabs))}}this.explicitTabs=void 0,t.updateTabs(),r.layer=i.managedLayer,r.location.value=this.location.value,r.location.locationChanged.dispatch(),r.layerManager.layersChanged.dispatch(),this.panels.specificationChanged.dispatch()}splitOffTab(e,t){if(!this.tabs.includes(e))return;const n=this.panels;{const t=this.explicitTabs;void 0!==t&&t.delete(e)}const i=this.layer,r=i.registerDisposer(new w(n));r.location.value=t,r.explicitTabs=new(s())([e]),n.panels.splice(1,0,r),n.updateTabs(),r.initialize(),i.manager.root.layerManager.layersChanged.dispatch(),n.specificationChanged.dispatch()}moveTabTo(e,t){if(!this.tabs.includes(e))return;{const t=this.explicitTabs;void 0!==t&&t.delete(e)}{const n=t.explicitTabs;void 0!==n&&n.add(e)}const n=this.panels;n.updateTabs(),t.selectedTab.value=e,n.specificationChanged.dispatch()}mergeInto(e){const t=e.explicitTabs;if(void 0!==t)for(const n of this.tabs)t.add(n);this.panels.removePanel(this)}}class x{constructor(e){this.layer=e,this.specificationChanged=new g.HN,this.updating=!1,this.panels=[e.registerDisposer(new w(this))]}restoreState(e){const t=this.panels;t[0].selectedTab.value=(0,f.verifyOptionalObjectProperty)(e,m,f.verifyString);const n=this.layer,i=n.tabs,o=new(s())(i.options.keys());(0,f.verifyOptionalObjectProperty)(e,y,(e=>(0,f.parseArray)(e,(e=>{(0,f.verifyObject)(e);const i=new w(this);i.location.restoreState(e),i.location.visible&&(i.selectedTab.value=(0,f.verifyOptionalObjectProperty)(e,m,f.verifyString),i.explicitTabs=(0,f.verifyOptionalObjectProperty)(e,v,(e=>{const t=new(s());for(const n of(0,f.verifyStringArray)(e))o.has(n)&&(o.delete(n),t.add(n));return t})),void 0===i.explicitTabs?(i.tabs=r()(o),o.clear()):i.tabs=r()(i.explicitTabs),0!==i.tabs.length&&(i.normalizeTabs(),n.registerDisposer(i),i.initialize(),t.push(i)))})))),t[0].tabs=r()(o),t[0].normalizeTabs(),this.panels[0].initialize()}removePanel(e){if(this.updating)return;const t=this.panels.indexOf(e);this.panels.splice(t,1),this.layer.unregisterDisposer(e),this.updateTabs()}updateTabs(){var e;const t=this.layer,n=t.tabs,i=new(s())(n.options.keys()),o=this.panels;this.updating=!0;const a=e=>{const t=e.tabs;if(void 0===e.explicitTabs)e.tabs=r()(i),i.clear();else{e.tabs=r()(e.explicitTabs);for(const t of e.tabs)i.delete(t)}(0,h.r1)(t,e.tabs)||(e.normalizeTabs(),e.tabsChanged.dispatch())};for(let r=1;r<o.length;){const e=o[r];e.location.visible&&(a(e),0!==e.tabs.length)?++r:(o.splice(r,1),t.unregisterDisposer(e))}if(a(o[0]),0===o[0].tabs.length){const t=this.layer.manager.root.selectedLayer;(null===(e=t.layer)||void 0===e?void 0:e.layer)===this.layer&&(t.location.visible=!1)}this.updating=!1}toJSON(){var e;const t=this.panels,n={};if(n[m]=t[0].selectedTab.value,t.length>1){const i=[];for(let n=1,o=t.length;n<o;++n){const o=t[n],s=null!==(e=o.location.toJSON())&&void 0!==e?e:{};s[m]=o.selectedTab.value;const a=o.explicitTabs;void 0!==a&&(s[v]=r()(a)),i.push(s)}n[y]=i}return n}}},4527:(e,t,n)=>{n.d(t,{N:()=>v,m:()=>m});var i=n(3111),r=n.n(i),o=n(1234),s=n.n(o),a=n(890),l=n(2564),c=n(2328),d=n(8774),u=n(7921),h=n(6348),p=n(7772),f=n(1301),g=n(1908);function m(e){return e.closest(".neuroglancer-selection-details")}class v extends l.wv{constructor(e,t,n,i){super(e,t.location),this.sidePanelManager=e,this.state=t,this.manager=n,this.selectedLayer=i,this.body=document.createElement("div");const o=this.element,l=this.body;o.classList.add("neuroglancer-selection-details"),this.registerDisposer(new d.qy(this.element,(0,a.o6)()));const m=this.addTitleBar({title:"Selection"}).titleBar,v=(0,f.m)({svg:r(),title:"Previous selection",onClick:()=>{this.state.goBack()}}),y=(0,f.m)({svg:s(),title:"Next selection",onClick:()=>{this.state.goForward()}});m.appendChild(v),m.appendChild(y),m.appendChild(this.registerDisposer(new u.R(t.pin,{text:"\ud83d\udccc\ufe0e",enableTitle:"Pin selection",disableTitle:"Unpin selection"})).element),l.classList.add("neuroglancer-selection-details-body"),this.addBody(l),l.appendChild(this.registerDisposer(new p.p(t,((e,n,i)=>{if(!t.location.visible)return;if(v.style.visibility=t.canGoBack()?"visible":"hidden",y.style.visibility=t.canGoForward()?"visible":"hidden",void 0===e)return;if(void 0!==e.position){const t=document.createElement("div");t.classList.add("neuroglancer-selection-details-position");const i=(0,h.C)({title:"Copy position",onClick:()=>{(0,c.B)(a.map((e=>Math.floor(e))).join(", "))}});t.appendChild(i);var r=e.coordinateSpace;const o=r.rank,s=r.names,a=e.position;for(let e=0;e<o;++e){const n=document.createElement("span");n.classList.add("neuroglancer-selection-details-position-dimension");const i=document.createElement("span");i.classList.add("neuroglancer-selection-details-position-dimension-name"),i.textContent=s[e];const r=document.createElement("span");r.classList.add("neuroglancer-selection-details-position-dimension-coordinate"),r.textContent=Math.floor(a[e]).toString(),n.appendChild(i),n.appendChild(r),t.appendChild(n)}const l=(0,g.b)({title:"Move to position",onClick:()=>{this.manager.globalPosition.value=a}});t.appendChild(l),n.appendChild(t)}for(const t of e.layers){const e=t.layer;n.appendChild(i.registerDisposer(new p.p({value:void 0,changed:e.managedLayer.layerChanged},((n,i,r)=>{if(e.wasDisposed)return;if(!e.isReady)return;const o=document.createElement("div");if(o.classList.add("neuroglancer-selection-details-layer-body"),!e.displaySelectionState(t.state,o,r))return;const s=document.createElement("div");i.appendChild(s),s.classList.add("neuroglancer-selection-details-layer");const a=document.createElement("div");a.classList.add("neuroglancer-selection-details-layer-title"),a.textContent=e.managedLayer.name,a.addEventListener("click",(()=>{this.selectedLayer.layer=e.managedLayer,this.selectedLayer.visible=!0})),a.title="Click to show layer side panel",s.appendChild(a),s.appendChild(o)}))).element)}}))).element)}close(){super.close(),this.state.value=void 0,this.state.pin.value=!0}}},2564:(e,t,n)=>{n.d(t,{RT:()=>T,oY:()=>g,wv:()=>E});var i=n(1274),r=n.n(i),o=n(3651),s=n.n(o),a=n(9548),l=n(4228),c=n(7562),d=n(3162),u=n(3234),h=n(6344),p=n(843),f=n(3141);const g="neuroglancer-drag-over",m={row:"row",column:"col"},v={left:"right",right:"left",top:"bottom",bottom:"top"},y={left:"column",right:"column",top:"row",bottom:"row"},b={left:"row",right:"row",top:"column",bottom:"column"},S={row:"width",column:"height"},w={row:"left",column:"top"},x={row:"right",column:"bottom"},C={left:"marginLeft",right:"marginRight",top:"marginTop",bottom:"marginBottom"},k={left:-1,right:1,top:-1,bottom:1};class E extends c.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.c1;super(),this.sidePanelManager=e,this.location=t,this.element=document.createElement("div"),this.visibility=new p.gH(p.gH.VISIBLE);const n=this.element;n.classList.add("neuroglancer-side-panel"),n.draggable=!0,n.addEventListener("dragstart",(e=>{this.sidePanelManager.startDrag(this.makeDragSource(),e),n.style.backgroundColor="black",setTimeout((()=>{n.style.backgroundColor=""}),0),(0,a.H)(n,"drag",(()=>document.createTextNode("Drag side panel to move it to the left/right/top/bottom of another panel")))})),n.addEventListener("dragend",(e=>{this.sidePanelManager.endDrag(),(0,a.m)(n,"drag")}))}makeDragSource(){return{dropAsNewPanel:e=>{const t=this.location.value;this.location.value=s()(s()({},t),e),this.location.locationChanged.dispatch()}}}close(){this.location.visible=!1}addTitleBar(e){const t=document.createElement("div");t.classList.add("neuroglancer-side-panel-titlebar");const n=e.title;let i;void 0!==n&&(i=document.createElement("div"),i.classList.add("neuroglancer-side-panel-title"),i.textContent=n,t.appendChild(i));const r=(0,f.j)({title:"Close panel",onClick:()=>{this.close()}});return r.style.order="100",t.appendChild(r),this.element.appendChild(t),{titleBar:t,titleElement:i,closeButton:r}}addBody(e){e.draggable=!0,e.addEventListener("dragstart",(e=>{e.preventDefault(),e.stopPropagation()})),this.element.appendChild(e)}}class T extends c.O8{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.gH(p.gH.VISIBLE);super(),this.display=e,this.center=t,this.visibility=n,this.element=document.createElement("div"),this.centerColumn=document.createElement("div"),this.beforeRender=new h.HN,this.sides={left:this.makeSidePanelSideState("left"),right:this.makeSidePanelSideState("right"),top:this.makeSidePanelSideState("top"),bottom:this.makeSidePanelSideState("bottom")},this.registeredPanels=new(r()),this.layoutNeedsUpdate=!1,this.invalidateLayout=()=>{this.layoutNeedsUpdate=!0,this.display.scheduleRedraw()};const i=this.element,o=this.centerColumn;i.style.display="flex",i.style.flex="1",i.style.flexDirection="row",o.style.display="flex",o.style.flex="1",o.style.flexDirection="column",o.style.flexBasis="0px",o.style.minWidth="0px",this.render(),this.registerDisposer(e.updateStarted.add((()=>{this.beforeRender.dispatch(),this.layoutNeedsUpdate&&(this.render(),++e.resizeGeneration)}))),this.registerDisposer(this.visibility.changed.add(this.invalidateLayout))}get visible(){return this.visibility.visible}makeSidePanelSideState(e){return{flexGroups:[],outerDropZoneElement:this.makeDropZone(e,k[e]*(1/0),0,e,!1)}}hasDroppablePanel(){return void 0!==this.dragSource}startDrag(e,t){setTimeout((()=>{this.dragSource===e&&(this.element.dataset.neuroglancerSidePanelDrag="true")}),0),this.dragSource=e,t.stopPropagation(),t.dataTransfer.setData("neuroglancer-side-panel","")}endDrag(){delete this.element.dataset.neuroglancerSidePanelDrag,this.dragSource=void 0}makeDropZone(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=document.createElement("div");o.className="neuroglancer-side-panel-drop-zone";const s=y[i],l=b[i];return o.style[S[l]]="".concat(10,"px"),o.style[S[s]]="100%",r?(o.style.position="absolute",o.style[i]="50%",o.style[C[i]]="-${size/2}px"):(o.style.position="relative",o.style[C[v[i]]]="-".concat(10,"px")),o.addEventListener("dragenter",(e=>{this.hasDroppablePanel()&&(o.classList.add(g),e.preventDefault(),(0,a.H)(o,"drop",(()=>document.createTextNode("Drop side panel as new ".concat(s)))))})),o.addEventListener("dragleave",(()=>{(0,a.m)(o,"drop"),o.classList.remove(g)})),o.addEventListener("dragover",(e=>{this.hasDroppablePanel()&&e.preventDefault()})),o.addEventListener("drop",(i=>{const r=this.dragSource;if(void 0===r)return;(0,a.m)(o,"drop"),o.classList.remove(g);const s=y[e];r.dropAsNewPanel({side:e,row:"column"===s?n:t,col:"row"===s?n:t}),this.dragSource=void 0,i.preventDefault(),i.stopPropagation()})),o}registerPanel(e){return this.registeredPanels.add(e),this.invalidateLayout(),e.location.locationChanged.add(this.invalidateLayout),()=>{this.unregisterPanel(e)}}unregisterPanel(e){var t;this.registeredPanels.delete(e),e.location.locationChanged.remove(this.invalidateLayout),null===(t=e.panel)||void 0===t||t.dispose(),this.invalidateLayout()}disposed(){for(const e of this.registeredPanels){const t=e.panel;null===t||void 0===t||t.dispose()}super.disposed()}render(){this.layoutNeedsUpdate=!1;const e={left:[],right:[],top:[],bottom:[]};for(const i of this.registeredPanels)e[i.location.value.side].push(i);const t=t=>this.renderSide(t,this.sides[t].flexGroups,e[t]),n=this;(0,d.bu)(this.element,function*(){yield n.sides.left.outerDropZoneElement,yield*t("left"),yield n.centerColumn,yield*t("right"),yield n.sides.right.outerDropZoneElement}()),(0,d.bu)(this.centerColumn,function*(){yield n.sides.top.outerDropZoneElement,yield*t("top"),yield n.center,yield*t("bottom"),yield n.sides.bottom.outerDropZoneElement}())}makeCrossGutter(e,t){const n=document.createElement("div");n.style.position="relative";const i=b[e];n.className="neuroglancer-resize-gutter-".concat("row"===i?"horizontal":"vertical"),n.addEventListener("pointerdown",(r=>{if("button"in r&&0!==r.button)return;r.preventDefault();const o=this.sides[e].flexGroups[t];if(void 0===o||!o.visible)return;let s=o.element.getBoundingClientRect()[S[i]];const l=o.minSize,c=()=>{(0,a.H)(n,"drag","Drag to resize, current ".concat(S[i]," is ").concat(o.crossSize,"px"))};c(),(0,u.i)(r,((t,n,r)=>{s-=k[e]*("row"===i?n:r),o.crossSize=Math.max(l,Math.round(s)),c(),this.invalidateLayout()}),(()=>{(0,a.m)(n,"drag")}))}));const r=this.makeDropZone(e,t-.5*k[e],0,e,!0);return n.appendChild(r),n}makeFlexGutter(e,t,n){const i=document.createElement("div");i.style.position="relative";const r=y[e];i.className="neuroglancer-resize-gutter-".concat("row"===r?"horizontal":"vertical"),i.addEventListener("pointerdown",(o=>{if("button"in o&&0!==o.button)return;o.preventDefault();const l=this.sides[e].flexGroups[t];if(void 0===l||!l.visible)return;const c=l.cells,d=c[n];if(void 0===d||!d.registeredPanel.location.visible)return;let h=n+1;for(;h<c.length&&!c[h].registeredPanel.location.visible;)++h;if(h===c.length)return;const p=c[h],f=()=>{(0,a.H)(i,"drag","Drag to resize, current ".concat(S[r]," ratio is ")+"".concat(d.registeredPanel.location.value.flex," : ")+"".concat(p.registeredPanel.location.value.flex))};f(),(0,u.i)(o,(e=>{const t=d.registeredPanel.panel,n=p.registeredPanel.panel;if(void 0===t||void 0===n)return;const i=t.element.getBoundingClientRect(),o=n.element.getBoundingClientRect(),a=Math.max(.1,Math.min(.9,"column"===r?(e.clientY-i.top)/(o.bottom-i.top):(e.clientX-i.left)/(o.right-i.left))),l=d.registeredPanel.location.value,c=p.registeredPanel.location.value,u=l.flex+c.flex;d.registeredPanel.location.value=s()(s()({},l),{flex:Math.round(a*u*100)/100}),p.registeredPanel.location.value=s()(s()({},c),{flex:Math.round((1-a)*u*100)/100}),f(),d.registeredPanel.location.locationChanged.dispatch(),p.registeredPanel.location.locationChanged.dispatch(),this.invalidateLayout()}),(()=>{(0,a.m)(i,"drag")}))}));const o=this.makeDropZone(e,t,n+.5,w[y[e]],!0);return i.appendChild(o),i}renderSide(e,t,n){const i=m[b[e]],r=m[y[e]];n.sort(((e,t)=>{const n=e.location.value,o=t.location.value,s=n[r]-o[r];return 0!==s?s:n[i]-o[i]}));const o=this;return function*(){let a=0,l=n.length,c=0;for(;a<l;){const u=n[a].location.value[r];let h=a,p=0,f=0;do{const C=n[h].location.value;if(C[r]!==u)break;C.visible&&(++p,f=Math.max(f,C.minSize)),++h}while(h<l);const g=p>0;let m=t[c];if(void 0===m){const E=o.makeCrossGutter(e,c),T=document.createElement("div");T.className="neuroglancer-side-panel-".concat(y[e]),m=t[c]={element:T,gutterElement:E,cells:[],crossSize:-1,minSize:f,visible:g,beginDropZone:o.makeDropZone(e,c,-1/0,w[y[e]]),endDropZone:o.makeDropZone(e,c,1/0,x[y[e]])}}else m.visible=g,m.minSize=f,m.crossSize=Math.max(m.crossSize,f);function*v(){yield m.beginDropZone;let t=0;for(let l=a,d=0;l<h;++l,++d){const a=n[l];let u=m.cells[d];void 0===u?u=m.cells[d]={registeredPanel:a,gutterElement:void 0}:u.registeredPanel=a;const h=u.registeredPanel.location.value;-1==m.crossSize&&(m.crossSize=Math.max(f,h.size)),(h[r]!==c||h[i]!==d||h.visible&&h.size!==m.crossSize)&&(u.registeredPanel.location.value=s()(s()({},h),{[r]:c,[i]:d,size:h.visible?m.crossSize:h.size}),u.registeredPanel.location.changed.dispatch());const g=h.visible&&o.visibility.visible;let v=a.panel;g?(++t,void 0===v&&(v=a.panel=a.makePanel()),v.element.style.flex=p>1?"".concat(h.flex):"1",yield v.element,t===p?u.gutterElement=void 0:(void 0===u.gutterElement&&(u.gutterElement=o.makeFlexGutter(e,c,d)),yield u.gutterElement)):void 0!==v&&(v.dispose(),a.panel=void 0)}yield m.endDropZone}(0,d.bu)(m.element,v()),m.cells.length=h-a,g&&(m.element.style[S[b[e]]]="".concat(m.crossSize,"px"),k[e]>0?(yield m.gutterElement,yield m.element):(yield m.element,yield m.gutterElement)),a=h,++c}t.length=c}()}}},4228:(e,t,n)=>{n.d(t,{c1:()=>d,n7:()=>c});var i=n(984),r=n.n(i),o=n(3651),s=n.n(o),a=n(7970),l=n(6344);const c={side:"right",col:0,row:1/0,flex:1,size:300,minSize:100,visible:!1};class d{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;this.defaultValue=e,this.value=t,this.changed=new l.HN,this.locationChanged=new l.HN,this.locationChanged.add(this.changed.dispatch);const n=this;this.watchableVisible={get value(){return n.visible},set value(e){n.visible=e},changed:n.locationChanged}}toJSON(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultValue;const t={},n=this.value;for(const i in n)n[i]!==e[i]&&(t[i]=n[i]);return t}get visible(){return this.value.visible}set visible(e){const t=this.value;t.visible!==e&&(this.value=s()(s()({},t),{visible:e}),this.locationChanged.dispatch())}reset(){this.value!==this.defaultValue&&(this.value=this.defaultValue,this.locationChanged.dispatch())}restoreState(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultValue;if(void 0===e)return;(0,a.verifyObject)(e);const n={side:(0,a.verifyOptionalObjectProperty)(e,"side",(e=>{if("left"!==e&&"right"!==e&&"top"!==e&&"bottom"!==e)throw new Error('Expected "left", "right", "top", or "bottom", but received: '.concat(r()(e)));return e}),t.side),col:(0,a.verifyOptionalObjectProperty)(e,"col",a.verifyFiniteFloat,t.col),row:(0,a.verifyOptionalObjectProperty)(e,"row",a.verifyFiniteFloat,t.row),flex:(0,a.verifyOptionalObjectProperty)(e,"flex",a.verifyFiniteFloat,t.flex),size:(0,a.verifyOptionalObjectProperty)(e,"size",a.verifyPositiveInt,t.size),visible:(0,a.verifyOptionalObjectProperty)(e,"visible",a.verifyBoolean,t.visible),minSize:t.minSize};this.value=n,this.locationChanged.dispatch()}}},3240:(e,t,n)=>{n.d(t,{H_:()=>R,JU:()=>A,L0:()=>O,NL:()=>S,QB:()=>I,a0:()=>w,he:()=>P,li:()=>T,st:()=>M,tB:()=>D,zA:()=>L});var i=n(3008),r=n.n(i),o=n(2982),s=n(608),a=n.n(s),l=n(984),c=n.n(l),d=n(5491),u=n.n(d),h=n(9859),p=n(2038),f=n(7562),g=n(8602),m=n(7970),v=n(6344);const y=/^[A-Z]$/;class b extends f.O8{constructor(e,t){super(),this.tool=e,this.inputEventMapBinder=t}bindAction(e,t){this.registerDisposer((0,g.qZ)(window,e,t))}bindInputEventMap(e){this.inputEventMapBinder(e,this)}cancel(){this==this.tool.layer.manager.root.toolBinder.activeTool_&&this.tool.layer.manager.root.toolBinder.deactivate_()}}class S extends f.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.layer=e,this.toggle=t,this.changed=new v.HN,this.keyBinding=void 0}get mouseState(){return this.layer.manager.root.layerSelectedValues.mouseState}unbind(){const e=this.layer,t=this.keyBinding;void 0!==t&&e.toolBinder.set(t,void 0)}}class w extends f.O8{constructor(e){super(),this.layer=e,this.changed=new v.HN}get mouseState(){return this.layer.manager.root.layerSelectedValues.mouseState}deactivate(){}unbind(){const e=this.layer;e.tool.value===this&&(e.tool.value=void 0)}}function x(e,t){var n;if(void 0===t)return;"string"===typeof t&&(t={type:t}),(0,m.verifyObject)(t);const i=(0,m.verifyObjectProperty)(t,"type",m.verifyString);let r=null===(n=E.get(e.constructor))||void 0===n?void 0:n.get(i);if(void 0===r&&(r=k.get(i)),void 0===r)throw new Error("Invalid tool type: ".concat(c()(t),"."));return r(e,t)}const C=new(a()),k=new(a()),E=new(a());function T(e,t){C.set(e,t)}function L(e,t,n){let i=E.get(e);void 0===i&&(i=new(a()),E.set(e,i)),i.set(t,n)}class P extends f.O8{constructor(e){super(),this.layer=e,this.changed=new v.HN}get value(){return this.value_}set value(e){e!==this.value_&&(this.unregister(),void 0!==e&&(e.changed.add(this.changed.dispatch),this.value_=e),this.changed.dispatch())}unregister(){const e=this.value_;void 0!==e&&(e.changed.remove(this.changed.dispatch),e.dispose(),this.value_=void 0)}disposed(){this.unregister(),super.disposed()}restoreState(e){this.value=function(e,t){if(void 0===t)return;"string"===typeof t&&(t={type:t}),(0,m.verifyObject)(t);const n=(0,m.verifyObjectProperty)(t,"type",m.verifyString),i=C.get(n);if(void 0===i)throw new Error("Invalid tool type: ".concat(c()(t),"."));return i(e,t)}(this.layer,e)}reset(){this.value=void 0}toJSON(){const e=this.value_;if(void 0!==e)return e.toJSON()}}class D extends f.O8{constructor(e){super(),this.inputEventMapBinder=e,this.bindings=new(a()),this.changed=new v.HN,this.debounceDeactivate=this.registerCancellable(u()((()=>this.deactivate_()),100)),this.debounceReactivate=this.registerCancellable(u()((()=>this.reactivateQueuedTool()),100))}get(e){return this.bindings.get(e)}set(e,t){const n=this.bindings,i=n.get(e);if(void 0!==i){i.keyBinding=void 0,n.delete(e);const t=i.layer.toolBinder;t.bindings.delete(e),t.jsonToKey.delete(c()(i.toJSON())),this.destroyTool(i),t.changed.dispatch()}if(void 0!==t){const i=t.layer.toolBinder,r=c()(t.toJSON()),o=i.jsonToKey.get(r);if(void 0!==o){const e=i.bindings.get(o);e.keyBinding=void 0,n.delete(o),i.bindings.delete(o),i.jsonToKey.delete(r),this.destroyTool(e)}i.bindings.set(e,t),t.keyBinding=e,i.jsonToKey.set(r,e),n.set(e,t),i.changed.dispatch()}this.changed.dispatch()}activate(e){const t=this.get(e);if(void 0===t)return void this.deactivate_();this.debounceDeactivate.cancel(),this.debounceReactivate.cancel();const n=this.activeTool_;if(t===(null===n||void 0===n?void 0:n.tool))return void(t.toggle&&this.deactivate_());void 0!==n&&(n.tool.toggle&&!t.toggle&&(this.queuedTool=n.tool),this.deactivate_());const i=new b(t,this.inputEventMapBinder);if(this.activeTool_=i,!t.toggle){const t="Key".concat(e);i.registerEventListener(window,"keyup",(e=>{e.code===t&&(this.debounceDeactivate(),this.debounceReactivate())})),i.registerEventListener(window,"blur",(()=>{this.debounceDeactivate(),this.debounceReactivate()}))}return t.activate(i),t}reactivateQueuedTool(){if(this.queuedTool){const e=new b(this.queuedTool,this.inputEventMapBinder);this.activeTool_=e,this.queuedTool.activate(e),this.queuedTool=void 0}}destroyTool(e){var t;this.queuedTool===e&&(this.queuedTool=void 0),(null===(t=this.activeTool_)||void 0===t?void 0:t.tool)===e&&this.deactivate_(),e.dispose()}disposed(){this.deactivate_(),super.disposed()}deactivate_(){this.debounceDeactivate.cancel();const e=this.activeTool_;void 0!==e&&(this.activeTool_=void 0,e.dispose())}}class M{constructor(e){this.layer=e,this.bindings=new(a()),this.jsonToKey=new(a()),this.changed=new v.HN,e.registerDisposer((()=>this.clear()))}get globalBinder(){return this.layer.manager.root.toolBinder}get(e){return this.bindings.get(e)}set(e,t){this.globalBinder.set(e,t)}setJson(e,t){const n=x(this.layer,t);void 0!==n&&this.set(e,n)}removeJsonString(e){const t=this.jsonToKey.get(e);void 0!==t&&this.set(t,void 0)}toJSON(){const e=this.bindings;if(0===e.size)return;const t={};for(const i of e){var n=(0,o.A)(i,2);const e=n[0],r=n[1];t[e]=r.toJSON()}return t}clear(){const e=this.globalBinder,t=this.bindings;if(0!==t.size){for(const i of t){var n=(0,o.A)(i,2);const t=n[0],r=n[1];r.keyBinding=void 0,e.bindings.delete(t),e.destroyTool(r)}t.clear(),this.jsonToKey.clear(),e.changed.dispatch(),this.changed.dispatch()}}reset(){this.clear()}restoreState(e){if(void 0!==e){(0,m.verifyObject)(e);for(const n of r()(e)){var t=(0,o.A)(n,2);const e=t[0],i=t[1];if(!e.match(y))throw new Error("Invalid tool key: ".concat(c()(e)));const r=x(this.layer,i);if(void 0===r)return;this.set(e,r)}}}}class I extends f.O8{constructor(e,t){super(),this.layer=e,this.toolJson=t,this.element=document.createElement("div"),this.toolJsonString=c()(this.toolJson);const n=this.element;n.classList.add("neuroglancer-tool-key-binding"),this.registerDisposer(e.toolBinder.changed.add(this.registerCancellable((0,p.t)((()=>this.updateView()))))),this.updateView(),n.title="click \u2192 bind key, dbclick \u2192 unbind",n.addEventListener("dblclick",(()=>{this.layer.toolBinder.removeJsonString(this.toolJsonString)})),R(this,n,(e=>this.layer.toolBinder.setJson(e,this.toolJson)))}updateView(){const e=this.layer.toolBinder.jsonToKey.get(this.toolJsonString);this.element.textContent=null!==e&&void 0!==e?e:" "}}function R(e,t,n){let i;t.addEventListener("mousedown",(t=>{if(0!==t.button||void 0!==i)return;t.preventDefault(),t.stopPropagation(),i=new f.O8,e.registerDisposer(i);i.registerDisposer(new h.M(!1)).setText("Press A-Z to bind key"),i.registerEventListener(window,"keydown",(e=>{const t=e.code.match(/^Key([A-Z])$/);if(null===t)return;e.stopPropagation(),e.preventDefault();const i=t[1];n(i)}),{capture:!0}),i.registerEventListener(window,"mouseup",(t=>{0===t.button&&void 0!==i&&(t.preventDefault(),t.stopPropagation(),e.unregisterDisposer(i),i.dispose(),i=void 0)}))})),t.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation()}))}function A(e,t,n){const i=document.createElement("div");i.classList.add("neuroglancer-tool-button"),i.appendChild(e.registerDisposer(new I(t,n.toolJson)).element);const r=document.createElement("div");return r.classList.add("neuroglancer-tool-button-label"),r.textContent=n.label,n.title&&(r.title=n.title),i.appendChild(r),i}function O(e){var t=function(e){const t=e.registerDisposer(new h.M(!1));t.element.classList.add("neuroglancer-tool-status");const n=document.createElement("div");n.classList.add("neuroglancer-tool-status-content"),t.element.appendChild(n);const i=e.inputEventMapBinder;return e.inputEventMapBinder=(e,n)=>{const r=document.createElement("div");r.textContent=e.describe(),r.classList.add("neuroglancer-tool-status-bindings"),t.element.appendChild(r),i(e,n)},{message:t,content:n}}(e);const n=t.message,i=t.content,r=document.createElement("div");r.classList.add("neuroglancer-tool-status-header");const o=document.createElement("div");o.classList.add("neuroglancer-tool-status-header-container"),o.appendChild(r),i.appendChild(o);const s=document.createElement("div");return s.classList.add("neuroglancer-tool-status-body"),i.appendChild(s),{message:n,body:s,header:r}}},338:(e,t,n)=>{n.r(t),n.d(t,{UrlHashBinding:()=>g,encodeFragment:()=>f});var i=n(984),r=n.n(i),o=n(5491),s=n.n(o),a=n(9859),l=n(7160),c=n(7562),d=n(2686),u=n(7970),h=n(3398),p=n(233);function f(e){return encodeURI(e).replace(/[!'()*;,]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}class g extends c.O8{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.root=e,this.credentialsManager=t,this.parseError=new l.B0(void 0);var i=n.updateDelayMilliseconds;const r=void 0===i?200:i;var o=n.defaultFragment;const a=void 0===o?"{}":o;this.registerEventListener(window,"hashchange",(()=>this.updateFromUrlHash()));const c=s()((()=>this.setUrlHash()),r);this.registerDisposer(e.changed.add(c)),this.registerDisposer((()=>c.cancel())),this.defaultFragment=a}setUrlHash(){const e=(0,p.$s)(this.root);if(e.generation!==this.prevStateGeneration){this.prevStateGeneration=e.generation;let t=f(r()(e.value));t!==this.prevStateString&&(this.prevStateString=t,"{}"===decodeURIComponent(t)?history.replaceState(null,"","#"):history.replaceState(null,"","#!"+t))}}updateFromUrlHash(){try{let t=location.href.replace(/^[^#]+/,"");if(""!==t&&"#"!==t&&"#!"!==t||(t="#!"+this.defaultFragment),t.match(/^#!([a-z][a-z\d+-.]*):\/\//)){const n=t.substring(2);var e=(0,h.n)(n,this.credentialsManager);const i=e.url,r=e.credentialsProvider;a.M.forPromise((0,h.G)(r,i,{},d.cj).then((e=>{(0,u.verifyObject)(e),this.root.reset(),this.root.restoreState(e)})),{initialMessage:"Loading state from ".concat(n),errorPrefix:"Error loading state:"})}else if(t.startsWith("#!+")){t=t.slice(3),t=decodeURIComponent(t);let e=(0,u.urlSafeParse)(t);(0,u.verifyObject)(e),this.root.restoreState(e),this.prevStateString=void 0}else{if(!t.startsWith("#!"))throw new Error('URL hash is expected to be of the form "#!{...}" or "#!+{...}".');{if(t=t.slice(2),t=decodeURIComponent(t),t===this.prevStateString)return;this.prevStateString=t,this.root.reset();let e=(0,u.urlSafeParse)(t);(0,u.verifyObject)(e),this.root.restoreState(e)}}this.parseError.value=void 0}catch(t){this.parseError.value=t}}}},2038:(e,t,n)=>{n.d(t,{t:()=>o});var i=n(3651),r=n.n(i);function o(e){let t=-1;return r()((()=>{-1===t&&(t=requestAnimationFrame((()=>{t=-1,e()})))}),{flush:()=>{-1!==t&&(t=-1,e())},cancel:()=>{-1!==t&&(cancelAnimationFrame(t),t=-1)}})}},9735:(e,t,n)=>{function i(e,t){let n=e.length,i=0;for(let r=0;r<n;++r)t(e[r],r,e)&&(e[i]=e[r],++i);e.length=i}function r(e,t){if(e.length===t)return e;let n=new e.constructor(t);return n.set(e),n}function o(e,t,n,i){const r=e.length/t,o=e.length*n*i,s=new e.constructor(o),a=e.length*i,l=t,c=t*i;for(let d=0;d<r;++d)for(let r=0;r<t;++r){const o=e[d*t+r],u=d*c+r;for(let e=0;e<n;++e)for(let t=0;t<i;++t)s[e*a+t*l+u]=o}return s}function s(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.length;for(;i<r;){const o=i+r-1>>1,s=n(t,e[o]);if(s>0)i=o+1;else{if(!(s<0))return o;r=o}}return~i}function a(e,t,n){let i=t-e;for(;i>0;){let t=Math.floor(i/2),r=e+t;n(r)?i=t:(e=r+1,i-=t+1)}return e}function l(e,t){const n=[];for(let i=0,r=e.length;i<r;++i)e[i]===t&&n.push(i);return n}function c(e,t){const n=e.length;if(t.length!==n)return!1;for(let i=0;i<n;++i)if(e[i]!==t[i])return!1;return!0}function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;const i=e.length;if(t.length!==i)return!1;for(let r=0;r<i;++r)if(!n(e[r],t[r]))return!1;return!0}function u(e,t,n){const i=[];if(n===t){for(let t=0;t<e;++t)i[t]=t;return i}i[n]=t;for(let r=0,o=0;r<e;)r!==t?(o===n&&++o,i[o++]=r++):++r;return i}function h(e,t,n){for(let i=0,r=n.length;i<r;++i){const r=n[i];-1!==r&&(e[i]=t[r])}return e}function p(e){const t=[];for(let n=0,i=e.length;n<i;++n){const i=e[n];for(let e=0,n=i.length;e<n;++e){let n=t[e];void 0===n&&(n=t[e]=[]),n.push(i[e])}}return t}function f(e,t){const n=[];let i=0;for(let o=0,s=t.length;o<s;++o){var r=t[o];const s=r.retainCount,a=r.deleteCount,l=r.insertCount;0!==s&&(n.push(e.slice(i,i+s)),i+=s),i+=a,0!==l&&n.push(new Array(l))}return i!==e.length&&n.push(e.slice(i)),new Array(0).concat(...n)}function g(e,t,n){const i=[];let r=0,o=0,s=e.length,a=t.length;for(;r<s&&o<a;){let l,c=e[r],d=t[o];if(l=n(c,d),0!==l)if(l<0){let t=1;for(;++r<s&&(l=n(e[r],d))<0;)++t;i.push({retainCount:0,deleteCount:t,insertCount:0})}else if(l>0){let e=1;for(;++o<a&&(l=n(c,t[o]))>0;)++e;i.push({retainCount:0,deleteCount:0,insertCount:e})}else;else{let c=1;for(++r,++o;r<s&&o<a&&0===(l=n(e[r],t[o]));)++c,++r,++o;i.push({retainCount:c,deleteCount:0,insertCount:0})}}return(r<s||o<a)&&i.push({retainCount:0,deleteCount:s-r,insertCount:a-o}),i}function m(e,t,n,i,r,o){let s=0,a=0;if(0!==e&&0!==t)for(;;){const l=n(s,a);if(l<0){if(i(s),++s===e)break}else if(l>0){if(r(a),++a===t)break}else if(o(s,a),++s,++a,s===e||a===t)break}for(;s<e;)i(s),++s;for(;a<t;)r(a),++a}n.d(t,{CS:()=>o,El:()=>s,NT:()=>m,RO:()=>p,U8:()=>i,b8:()=>h,eL:()=>f,eN:()=>l,ep:()=>u,jx:()=>r,lX:()=>a,q9:()=>g,r1:()=>c,wm:()=>d})},6740:(e,t,n)=>{n.d(t,{j:()=>u});var i=n(5491),r=n.n(i),o=n(7562),s=n(3162);const a=class{static insertAfter(e,t){let n=e.next0;t.next0=n,t.prev0=e,e.next0=t,n.prev0=t}static insertBefore(e,t){let n=e.prev0;t.prev0=n,t.next0=e,e.prev0=t,n.next0=t}static front(e){let t=e.next0;return t===e?null:t}static back(e){let t=e.prev0;return t===e?null:t}static pop(e){let t=e.next0,n=e.prev0;return t.prev0=n,n.next0=t,e.next0=null,e.prev0=null,e}static*iterator(e){for(let t=e.next0;t!==e;t=t.next0)yield t}static*reverseIterator(e){for(let t=e.prev0;t!==e;t=t.prev0)yield t}static initializeHead(e){e.next0=e.prev0=e}};const l=new class{constructor(){a.initializeHead(this)}},c=window.top===window,d=r()((()=>{if(!c)return;const e=document.activeElement;if(null===e||e===document.body){const e=a.front(l);null!==e&&e.element.focus({preventScroll:!0})}}));window.addEventListener("focus",(()=>{d()}),!0),window.addEventListener("blur",(()=>{d()}),!0);class u extends o.O8{constructor(e){super(),this.element=e,this.prev0=null,this.next0=null,this.lastFocusedElement=null,this.scheduleUpdateFocus=this.registerCancellable(r()((()=>{const e=document.activeElement,t=this.element;t.contains(e)||(0,s.Hf)(e)||(null==e||e!==this.lastFocusedElement&&!e.contains(t)||this.element.focus({preventScroll:!0}),this.lastFocusedElement=null)}),0)),e.tabIndex=-1,this.registerEventListener(e,"pointerdown",(t=>{t.target===e&&(this.lastFocusedElement=null,e.focus({preventScroll:!0}))})),this.registerEventListener(e,"mouseenter",(()=>{this.lastFocusedElement=document.activeElement,this.scheduleUpdateFocus()})),this.registerEventListener(e,"mouseleave",(()=>{this.scheduleUpdateFocus.cancel()})),a.insertBefore(l,this),this.registerEventListener(e,"focus",(()=>{a.pop(this),a.insertAfter(l,this)})),d()}disposed(){a.pop(this),super.disposed()}}},2959:(e,t,n)=>{n.d(t,{Dq:()=>l,Qi:()=>u,fx:()=>d,gI:()=>p,wS:()=>a,y3:()=>h});var i=n(7399),r=n.n(i),o=n(1274),s=n.n(o);const a=new class{constructor(){this.name="CancellationError",this.message="CANCELED"}toString(){return"CANCELED"}};function l(e){if(!0===e.isCanceled)throw a}const c=()=>{},d={isCanceled:!1,add:()=>c,remove:c};class u{cancel(){const e=this.handlers;if(null!==e&&(this.handlers=null,void 0!==e))for(let t of e)t()}get isCanceled(){return null===this.handlers}add(e){let t=this.handlers;return null===t?(e(),c):(void 0===t&&(t=this.handlers=new(s())),t.add(e),()=>{this.remove(e)})}remove(e){const t=this.handlers;null!=t&&t.delete(e)}}class h extends u{constructor(){super(...arguments),this.consumers=new(s())}addConsumer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;const t=this.consumers;t.has(e)||e.isCanceled||(t.add(e),e.add((()=>{t.delete(e),0===t.size&&this.cancel()})))}}function p(e,t){return new(r())(((n,i)=>{if(e===d)return void t(n,i,d);const r=new u,o=e.add((()=>{r.cancel()}));t((e=>{o(),n(e)}),(e=>{o(),i(e)}),r)}))}},2328:(e,t,n)=>{n.d(t,{B:()=>r});var i=n(7562);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text/plain",n=!1;const r=(0,i.K6)(document,"copy",(i=>{const r=i.clipboardData;null!==r&&(r.setData(t,e),n=!0),i.stopPropagation(),i.preventDefault()}),!0);try{document.execCommand("copy")}finally{r()}return n}},2303:(e,t,n)=>{n.r(t),n.d(t,{TrackableOptionalRGB:()=>w,TrackableRGB:()=>S,getRelativeLuminance:()=>y,packColor:()=>p,parseColorSerialization:()=>d,parseRGBAColorSpecification:()=>u,parseRGBColorSpecification:()=>h,serializeColor:()=>m,srgbGammaExpand:()=>v,unpackRGB:()=>f,unpackRGBA:()=>g,useWhiteBackground:()=>b});var i=n(2982),r=n(984),o=n.n(r),s=n(7160);const a=new Float32Array(1);var l=n(3835),c=n(3819);function d(e){const t=/^rgba\(([0-9]+), ([0-9]+), ([0-9]+), (0(?:\.[0-9]+)?)\)$/;{const n=e.match(t);if(null!==n)return[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseFloat(n[4])]}const n=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/;{const t=e.match(n);if(null!==t)return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1]}throw new Error("Invalid serialized color: ".concat(o()(e),"."))}function u(e){try{if("string"!==typeof e)throw new Error("Expected string, but received ".concat(o()(e),"."));const t=document.createElement("canvas").getContext("2d");t.fillStyle=e;const n=d(t.fillStyle);return l.ln.fromValues(n[0]/255,n[1]/255,n[2]/255,n[3])}catch(t){throw new Error("Failed to parse color specification: ".concat(t.message))}}function h(e){return u(e).subarray(0,3)}function p(e){const t=void 0===e[3]?3:4;let n=0;for(let i=0;i<t;i++)n=(n<<8>>>0)+Math.min(255,Math.max(0,Math.round(255*e[t-1-i])));return n}function f(e){return l.eR.fromValues((e>>>0&255)/255,(e>>>8&255)/255,(e>>>16&255)/255)}function g(e){return l.ln.fromValues((e>>>0&255)/255,(e>>>8&255)/255,(e>>>16&255)/255,(e>>>24&255)/255)}function m(e){if(void 0===e[3]||1===e[3]){let t="#";for(let n=0;n<3;++n)t+=(0,c.sY)(Math.min(255,Math.max(0,Math.round(255*e[n]))));return t}{let t="rgba(";for(let n=0;n<3;++n)0!==n&&(t+=", "),t+=Math.min(255,Math.max(0,Math.round(255*e[n])));return t+=", ".concat(function(e){a[0]=e,e=a[0];for(let t=1;t<21;++t){let n=e.toPrecision(t);if(a[0]=parseFloat(n),a[0]===e)return n}return e.toString()}(e[3]),")"),t}}function v(e){return e<=.03928?e/12.92:((e+.055)/1.055)**2.4}function y(e){var t=(0,i.A)(e,3);const n=t[0],r=t[1],o=t[2];return.2126*v(n)+.7152*v(r)+.0722*v(o)}function b(e){return y(e)<=.179}class S extends s.B0{constructor(e){super(l.eR.clone(e)),this.defaultValue=e}toString(){return m(this.value)}toJSON(){return l.eR.equals(this.value,this.defaultValue)?void 0:m(this.value)}reset(){this.value=l.eR.clone(this.defaultValue)}restoreState(e){if(void 0===e)return void this.reset();const t=this.value,n=h(e);l.eR.equals(t,n)||(this.value=n)}}class w extends s.B0{constructor(){super(void 0)}toJSON(){const e=this.value;if(void 0!==e)return m(e)}reset(){this.value=void 0}restoreState(e){if(void 0===e)return void this.reset();const t=this.value,n=h(e);void 0!==t&&l.eR.equals(t,n)||(this.value=n)}}},8491:(e,t,n)=>{function i(e,t,n,i){t*=6;let r=Math.floor(t),o=t-r,s=i*(1-n),a=i*(1-n*o),l=i*(1-n*(1-o));switch(r%6){case 0:e[0]=i,e[1]=l,e[2]=s;break;case 1:e[0]=a,e[1]=i,e[2]=s;break;case 2:e[0]=s,e[1]=i,e[2]=l;break;case 3:e[0]=s,e[1]=a,e[2]=i;break;case 4:e[0]=l,e[1]=s,e[2]=i;break;case 5:e[0]=i,e[1]=s,e[2]=a}return e}function r(e,t,n,i){const r=Math.max(Math.max(t,n),i),o=Math.min(Math.min(t,n),i);if(e[2]=r,o===r)e[0]=0,e[1]=0;else{const s=r-o;e[1]=s/r,e[0]=t===r?(n-i)/s:n===r?2+(i-t)/s:4+(t-n)/s,e[0]/=6,e[0]<0&&(e[0]+=1),e[0]>1&&(e[0]-=1)}return e}n.d(t,{M:()=>i,w:()=>r})},6974:(e,t,n)=>{n.d(t,{BH:()=>c,Hj:()=>d,KV:()=>a,Q9:()=>l});var i=n(3651),r=n.n(i),o=n(5553);const s={offset:0,completions:[]};function a(e,t){return t.offset+=e,t}function l(e,t){let n=[];for(let i of t)i.startsWith(e)&&n.push({value:i});return n.sort(((e,t)=>(0,o.e)(e.value,t.value))),n}function c(e,t,n,i){let r=[];for(let o of t){let t=n(o);t.startsWith(e)&&r.push({value:t,description:i(o)})}return r.sort(((e,t)=>(0,o.e)(e.value,t.value))),r}async function d(e,t){return async function(e,t,n){if(e.startsWith("{"))return s;const i=e.match(/^(?:(.*)[&;])?([^&;]*)$/)[2];let o=e.length-i.length;const l=i.indexOf("=");if(-1===l){const e=await t(i);return{offset:e.offset+o,completions:e.completions.map((e=>r()(r()({},e),{value:"".concat(e.value,"=")})))}}return a(o+l+1,await n(i.substring(0,l),i.substring(l+1)))}(e,(async e=>{const n=[];for(const i of t){const t=i.key;t.value.startsWith(e)&&n.push(t)}return{offset:0,completions:n}}),(async(e,n)=>{for(const i of t)if(i.key.value===e)return{offset:0,completions:i.values.filter((e=>e.value.startsWith(n)))};return s}))}},9043:(e,t,n)=>{var i;n.d(t,{L8:()=>r,dp:()=>s,iV:()=>o,pe:()=>i}),function(e){e[e.UINT8=0]="UINT8",e[e.INT8=1]="INT8",e[e.UINT16=2]="UINT16",e[e.INT16=3]="INT16",e[e.UINT32=4]="UINT32",e[e.INT32=5]="INT32",e[e.UINT64=6]="UINT64",e[e.FLOAT32=7]="FLOAT32"}(i||(i={}));const r={[i.UINT8]:!1,[i.INT8]:!0,[i.UINT16]:!1,[i.INT16]:!0,[i.UINT32]:!1,[i.INT32]:!0,[i.UINT64]:!1,[i.FLOAT32]:void 0},o={[i.UINT8]:1,[i.INT8]:1,[i.UINT16]:2,[i.INT16]:2,[i.UINT32]:4,[i.INT32]:4,[i.UINT64]:8,[i.FLOAT32]:4},s={[i.UINT8]:Uint8Array,[i.INT8]:Int8Array,[i.UINT16]:Uint16Array,[i.INT16]:Int16Array,[i.UINT32]:Uint32Array,[i.INT32]:Int32Array,[i.UINT64]:Uint32Array,[i.FLOAT32]:Float32Array};i.UINT8,i.INT8,i.UINT16,i.INT16,i.UINT32,i.INT32,i.UINT64,i.FLOAT32},7562:(e,t,n)=>{n.d(t,{$F:()=>r,K6:()=>o,K9:()=>l,O8:()=>s,fL:()=>a});function i(e){"object"===typeof e?e.dispose():e()}function r(e){for(let t=e.length;t>0;--t)i(e[t-1])}function o(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}class s{constructor(){this.refCount=1}addRef(){return++this.refCount,this}dispose(){0===--this.refCount&&this.refCountReachedZero()}refCountReachedZero(){this.disposed();let e=this.disposers;void 0!==e&&(r(e),this.disposers=void 0),this.wasDisposed=!0}disposed(){}registerDisposer(e){let t=this.disposers;return null==t?this.disposers=[e]:t.push(e),e}unregisterDisposer(e){let t=this.disposers;if(null!=t){let n=t.indexOf(e);-1!==n&&t.splice(n,1)}return e}registerEventListener(e,t,n,i){this.registerDisposer(o(e,t,n,i))}registerCancellable(e){return this.registerDisposer((()=>{e.cancel()})),e}}class a extends s{constructor(e){super(),this.value=e}}function l(e){return()=>{if(void 0!==e){let t=e;e=void 0,i(t)}}}},3162:(e,t,n)=>{function i(e){for(;;){let t=e.firstChild;if(!t)break;e.removeChild(t)}}function r(e){let t=e.parentElement;return!!t&&(t.removeChild(e),!0)}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.max(1,e.value.length);const n="".concat(t,"ch");e.style.width!==n&&(e.style.width="0px",e.offsetWidth,e.style.width=n)}function s(e,t){let n=e.firstElementChild;for(const i of t)i!==n&&e.insertBefore(i,n),n=i.nextElementSibling;for(;null!==n;){let t=n.nextElementSibling;e.removeChild(n),n=t}}function a(e){return e instanceof HTMLElement&&!!(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e.isContentEditable)}function l(e){const t=e.cloneNode(!0);return t.style.position="absolute",document.body.appendChild(t),t.getBoundingClientRect()}n.d(t,{Hf:()=>a,MY:()=>l,bu:()=>s,fh:()=>r,gS:()=>i,qi:()=>o})},1783:(e,t,n)=>{var i;n.d(t,{H$:()=>i,Hp:()=>r}),function(e){e[e.LITTLE=0]="LITTLE",e[e.BIG=1]="BIG"}(i||(i={}));const r=function(){const e=Uint16Array.of(4386);return 17===new Uint8Array(e.buffer)[0]?i.BIG:i.LITTLE}()},304:(e,t,n)=>{function i(e){try{return e()}catch(t){return{error:t.message}}}function r(e){if(void 0!==e.error)throw new Error(e.error);return e}n.d(t,{P:()=>r,T:()=>i})},8602:(e,t,n)=>{n.d(t,{n5:()=>b,Pt:()=>x,Tg:()=>S,z3:()=>C,Up:()=>g,qZ:()=>k});var i,r=n(608),o=n.n(r),s=n(1190),a=n.n(s),l=n(2982),c=n(3651),d=n.n(c),u=n(984),h=n.n(u),p=n(7562);class f{constructor(e){if(this.parents=new Array,this.parentPriorities=new Array,this.bindings=new(o()),void 0!==e){this.parents.push(...e.parents),this.parentPriorities.push(...e.parentPriorities);for(const n of e.bindings){var t=(0,l.A)(n,2);const e=t[0],i=t[1];this.bindings.set(e,i)}}}addParent(e,t){const n=this.parents,i=this.parentPriorities;let r=0;const o=n.length;for(;r<o&&t<i[r];)++r;return n.splice(r,0,e),i.splice(r,0,t),()=>{this.removeParent(e)}}removeParent(e){const t=this.parents.indexOf(e);if(-1===t)throw new Error("Attempt to remove non-existent parent map.");this.parents.splice(t,1),this.parentPriorities.splice(t,1)}set(e,t){this.bindings.set(e,t)}delete(e){this.bindings.delete(e)}clear(){this.bindings.clear(),this.parents.length=0,this.parentPriorities.length=0}get(e){const t=this.parents,n=this.parentPriorities,i=n.length;let r,o=0;for(;o<i&&n[o]>0;++o)if(r=t[o].get(e),void 0!==r)return r;if(r=this.bindings.get(e),void 0!==r)return r;for(;o<i;++o)if(r=t[o].get(e),void 0!==r)return r}*getAll(e){const t=this.parents,n=this.parentPriorities,i=n.length;let r;for(;0<i&&n[0]>0;)r=t[0].get(e),void 0!==r&&(yield r);for(r=this.bindings.get(e),void 0!==r&&(yield r);0<i;)r=t[0].get(e),void 0!==r&&(yield r)}*entries(){const e=this.parents,t=this.parentPriorities,n=t.length;let i=0;for(;i<n&&t[i]>0;++i)yield*e[i].entries();for(yield*this.bindings.entries();i<n;++i)yield*e[i].entries()}}function g(e){return(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.metaKey?4:0)|(e.shiftKey?8:0)}function m(e,t){let n="";return 1&t&&(n+="control+"),2&t&&(n+="alt+"),4&t&&(n+="meta+"),8&t&&(n+="shift+"),n+=e,n}function v(e){const t=e.indexOf(":");let n;if(-1!==t&&(n=e.substring(0,t),"at"!==n&&"bubble"!==n))throw new Error("Invalid event phase: ".concat(h()(n)));const i=e.substring(t+1).split("+");let r,o=0,s=0;e:for(let a of i)switch(a){case"control":o|=1;break;case"control?":s|=1;break;case"alt":o|=2;break;case"alt?":s|=2;break;case"meta":o|=4;break;case"meta?":s|=4;break;case"shift":o|=8;break;case"shift?":s|=8;break;default:if(void 0!==r){r=void 0;break e}r=a}if(void 0===r||o&s)throw new Error("Invalid event identifier: ".concat(h()(e)));return{phase:n,keyName:r,modifiers:o,optionalModifiers:s}}function*y(e){const t=e.phase,n=function*(e,t,n){0===n&&(yield m(e,t));for(let i=0;i<16;++i)(i&(t|n))===i&&(i&t)===t&&(yield m(e,i))}(e.keyName,e.modifiers,e.optionalModifiers);if(void 0===t)for(const i of n)yield"at:".concat(i),yield"bubble:".concat(i);else for(const i of n)yield"".concat(t,":").concat(i)}!function(e){e[e.CONTROL=1]="CONTROL",e[e.ALT=2]="ALT",e[e.META=4]="META",e[e.SHIFT=8]="SHIFT"}(i||(i={}));class b extends f{static fromObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new b;if(n.label=t.label,void 0!==t.parents)for(const r of t.parents){var i=(0,l.A)(r,2);const e=i[0],t=i[1];n.addParent(e,t)}for(const r of a()(e))n.set(r,e[r]);return n}setFromObject(e){for(const t of a()(e))this.set(t,e[t])}set(e,t){const n=v(e),i=function(e,t){const n=function(e,t,n){let i="";return 1&t&&(i+="control+"),1&n&&(i+="control?+"),2&t&&(i+="alt+"),2&n&&(i+="alt?+"),4&t&&(i+="meta+"),4&n&&(i+="meta?+"),8&t&&(i+="shift+"),8&n&&(i+="shift?+"),i+=e,i}(e.keyName,e.modifiers,e.optionalModifiers);return"string"===typeof t?{action:t,originalEventIdentifier:n}:d()(d()({},t),{originalEventIdentifier:n})}(n,t);for(const r of y(n))super.set(r,i)}delete(e){for(const t of y(v(e)))super.delete(t)}describe(){const e=[],t=new(o());for(const i of this.entries()){const e=(0,l.A)(i,2)[1];t.set(e.originalEventIdentifier,e.action)}for(const i of t){var n=(0,l.A)(i,2);const t=n[0],r=n[1];e.push("".concat(t,"\u2192").concat(r))}return e.join(", ")}}function S(e,t,n){if(void 0===n)return;!1!==n.stopPropagation&&e.stopPropagation();const i=new CustomEvent("action:"+n.action,{bubbles:!0,detail:t,cancelable:!0}),r=!e.target.dispatchEvent(i);(!1!==n.preventDefault||r)&&e.preventDefault()}const w=[];function x(e,t,n,i,r){const o=w[n]+":"+e;S(t,i,r.get(o))}function C(e,t,n,i){x(m(e,g(t)),t,t.eventPhase,n,i)}function k(e,t,n,i){return(0,p.K6)(e,"action:".concat(t),n,i)}w[Event.AT_TARGET]="at",w[Event.CAPTURING_PHASE]="capture",w[Event.BUBBLING_PHASE]="bubble"},3835:(e,t,n)=>{n.d(t,{p9:()=>Zi,Qi:()=>fr,PC:()=>dr,_S:()=>ar,sJ:()=>pr,I1:()=>hr,bS:()=>mr,r3:()=>Xi,qp:()=>cr,T_:()=>lr,T2:()=>Qi,Oi:()=>er,yb:()=>$i,w0:()=>s,_A:()=>sr,pB:()=>i,xK:()=>tr,_q:()=>or,Yu:()=>a,Jh:()=>ur,vs:()=>ir,uD:()=>rr,Zc:()=>l,eR:()=>r,nL:()=>nr,ln:()=>o});var i={};n.r(i),n.d(i,{add:()=>Z,adjoint:()=>S,clone:()=>p,copy:()=>f,create:()=>h,determinant:()=>w,equals:()=>ne,exactEquals:()=>te,frob:()=>X,fromQuat:()=>j,fromQuat2:()=>_,fromRotation:()=>I,fromRotationTranslation:()=>N,fromRotationTranslationScale:()=>U,fromRotationTranslationScaleOrigin:()=>z,fromScaling:()=>M,fromTranslation:()=>D,fromValues:()=>g,fromXRotation:()=>R,fromYRotation:()=>A,fromZRotation:()=>O,frustum:()=>G,getRotation:()=>F,getScaling:()=>B,getTranslation:()=>V,identity:()=>v,invert:()=>b,lookAt:()=>Y,mul:()=>ie,multiply:()=>x,multiplyScalar:()=>$,multiplyScalarAndAdd:()=>ee,ortho:()=>q,perspective:()=>W,perspectiveFromFieldOfView:()=>H,rotate:()=>E,rotateX:()=>T,rotateY:()=>L,rotateZ:()=>P,scale:()=>k,set:()=>m,str:()=>K,sub:()=>re,subtract:()=>Q,targetTo:()=>J,translate:()=>C,transpose:()=>y});var r={};n.r(r),n.d(r,{add:()=>ue,angle:()=>Ue,bezier:()=>Re,ceil:()=>ge,clone:()=>se,copy:()=>ce,create:()=>oe,cross:()=>De,dist:()=>Je,distance:()=>xe,div:()=>Ye,divide:()=>fe,dot:()=>Pe,equals:()=>We,exactEquals:()=>Ge,floor:()=>me,forEach:()=>Qe,fromValues:()=>le,hermite:()=>Ie,inverse:()=>Te,len:()=>Xe,length:()=>ae,lerp:()=>Me,max:()=>ye,min:()=>ve,mul:()=>qe,multiply:()=>pe,negate:()=>Ee,normalize:()=>Le,random:()=>Ae,rotateX:()=>Ve,rotateY:()=>Be,rotateZ:()=>Fe,round:()=>be,scale:()=>Se,scaleAndAdd:()=>we,set:()=>de,sqrDist:()=>Ke,sqrLen:()=>Ze,squaredDistance:()=>Ce,squaredLength:()=>ke,str:()=>je,sub:()=>He,subtract:()=>he,transformMat3:()=>Ne,transformMat4:()=>Oe,transformQuat:()=>_e,zero:()=>ze});var o={};n.r(o),n.d(o,{add:()=>rt,ceil:()=>lt,clone:()=>et,copy:()=>nt,create:()=>$e,cross:()=>Ct,dist:()=>Nt,distance:()=>gt,div:()=>Ot,divide:()=>at,dot:()=>xt,equals:()=>It,exactEquals:()=>Mt,floor:()=>ct,forEach:()=>Ft,fromValues:()=>tt,inverse:()=>St,len:()=>Vt,length:()=>vt,lerp:()=>kt,max:()=>ut,min:()=>dt,mul:()=>At,multiply:()=>st,negate:()=>bt,normalize:()=>wt,random:()=>Et,round:()=>ht,scale:()=>pt,scaleAndAdd:()=>ft,set:()=>it,sqrDist:()=>_t,sqrLen:()=>Bt,squaredDistance:()=>mt,squaredLength:()=>yt,str:()=>Dt,sub:()=>Rt,subtract:()=>ot,transformMat4:()=>Tt,transformQuat:()=>Lt,zero:()=>Pt});var s={};n.r(s),n.d(s,{add:()=>un,adjoint:()=>Kt,clone:()=>jt,copy:()=>Gt,create:()=>Ut,determinant:()=>Xt,equals:()=>mn,exactEquals:()=>gn,frob:()=>dn,fromMat2d:()=>on,fromMat4:()=>zt,fromQuat:()=>sn,fromRotation:()=>nn,fromScaling:()=>rn,fromTranslation:()=>tn,fromValues:()=>Wt,identity:()=>qt,invert:()=>Jt,mul:()=>vn,multiply:()=>Zt,multiplyScalar:()=>pn,multiplyScalarAndAdd:()=>fn,normalFromMat4:()=>an,projection:()=>ln,rotate:()=>$t,scale:()=>en,set:()=>Ht,str:()=>cn,sub:()=>yn,subtract:()=>hn,translate:()=>Qt,transpose:()=>Yt});var a={};n.r(a),n.d(a,{add:()=>Gn,calculateW:()=>Pn,clone:()=>Fn,conjugate:()=>Nn,copy:()=>zn,create:()=>bn,dot:()=>qn,equals:()=>ei,exactEquals:()=>$n,exp:()=>Dn,fromEuler:()=>Vn,fromMat3:()=>_n,fromValues:()=>Un,getAngle:()=>Cn,getAxisAngle:()=>xn,identity:()=>Sn,invert:()=>On,len:()=>Kn,length:()=>Jn,lerp:()=>Yn,ln:()=>Mn,mul:()=>Wn,multiply:()=>kn,normalize:()=>Qn,pow:()=>In,random:()=>An,rotateX:()=>En,rotateY:()=>Tn,rotateZ:()=>Ln,rotationTo:()=>ti,scale:()=>Hn,set:()=>jn,setAxes:()=>ii,setAxisAngle:()=>wn,slerp:()=>Rn,sqlerp:()=>ni,sqrLen:()=>Zn,squaredLength:()=>Xn,str:()=>Bn});var l={};n.r(l),n.d(l,{add:()=>di,angle:()=>Vi,ceil:()=>fi,clone:()=>si,copy:()=>li,create:()=>oi,cross:()=>Di,dist:()=>qi,distance:()=>wi,div:()=>Hi,divide:()=>pi,dot:()=>Pi,equals:()=>zi,exactEquals:()=>Ui,floor:()=>gi,forEach:()=>Ki,fromValues:()=>ai,inverse:()=>Ti,len:()=>ji,length:()=>Ci,lerp:()=>Mi,max:()=>vi,min:()=>mi,mul:()=>Wi,multiply:()=>hi,negate:()=>Ei,normalize:()=>Li,random:()=>Ii,rotate:()=>_i,round:()=>yi,scale:()=>bi,scaleAndAdd:()=>Si,set:()=>ci,sqrDist:()=>Yi,sqrLen:()=>Ji,squaredDistance:()=>xi,squaredLength:()=>ki,str:()=>Fi,sub:()=>Gi,subtract:()=>ui,transformMat2:()=>Ri,transformMat2d:()=>Ai,transformMat3:()=>Oi,transformMat4:()=>Ni,zero:()=>Bi});var c=1e-6,d="undefined"!==typeof Float32Array?Float32Array:Array,u=Math.random;Math.PI;function h(){var e=new d(16);return d!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function p(e){var t=new d(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function f(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function g(e,t,n,i,r,o,s,a,l,c,u,h,p,f,g,m){var v=new d(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=i,v[4]=r,v[5]=o,v[6]=s,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=h,v[12]=p,v[13]=f,v[14]=g,v[15]=m,v}function m(e,t,n,i,r,o,s,a,l,c,d,u,h,p,f,g,m){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=d,e[10]=u,e[11]=h,e[12]=p,e[13]=f,e[14]=g,e[15]=m,e}function v(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function b(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],d=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15],y=n*a-i*s,b=n*l-r*s,S=n*c-o*s,w=i*l-r*a,x=i*c-o*a,C=r*c-o*l,k=d*g-u*f,E=d*m-h*f,T=d*v-p*f,L=u*m-h*g,P=u*v-p*g,D=h*v-p*m,M=y*D-b*P+S*L+w*T-x*E+C*k;return M?(M=1/M,e[0]=(a*D-l*P+c*L)*M,e[1]=(r*P-i*D-o*L)*M,e[2]=(g*C-m*x+v*w)*M,e[3]=(h*x-u*C-p*w)*M,e[4]=(l*T-s*D-c*E)*M,e[5]=(n*D-r*T+o*E)*M,e[6]=(m*S-f*C-v*b)*M,e[7]=(d*C-h*S+p*b)*M,e[8]=(s*P-a*T+c*k)*M,e[9]=(i*T-n*P-o*k)*M,e[10]=(f*x-g*S+v*y)*M,e[11]=(u*S-d*x-p*y)*M,e[12]=(a*E-s*L-l*k)*M,e[13]=(n*L-i*E+r*k)*M,e[14]=(g*b-f*w-m*y)*M,e[15]=(d*w-u*b+h*y)*M,e):null}function S(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],d=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15];return e[0]=a*(h*v-p*m)-u*(l*v-c*m)+g*(l*p-c*h),e[1]=-(i*(h*v-p*m)-u*(r*v-o*m)+g*(r*p-o*h)),e[2]=i*(l*v-c*m)-a*(r*v-o*m)+g*(r*c-o*l),e[3]=-(i*(l*p-c*h)-a*(r*p-o*h)+u*(r*c-o*l)),e[4]=-(s*(h*v-p*m)-d*(l*v-c*m)+f*(l*p-c*h)),e[5]=n*(h*v-p*m)-d*(r*v-o*m)+f*(r*p-o*h),e[6]=-(n*(l*v-c*m)-s*(r*v-o*m)+f*(r*c-o*l)),e[7]=n*(l*p-c*h)-s*(r*p-o*h)+d*(r*c-o*l),e[8]=s*(u*v-p*g)-d*(a*v-c*g)+f*(a*p-c*u),e[9]=-(n*(u*v-p*g)-d*(i*v-o*g)+f*(i*p-o*u)),e[10]=n*(a*v-c*g)-s*(i*v-o*g)+f*(i*c-o*a),e[11]=-(n*(a*p-c*u)-s*(i*p-o*u)+d*(i*c-o*a)),e[12]=-(s*(u*m-h*g)-d*(a*m-l*g)+f*(a*h-l*u)),e[13]=n*(u*m-h*g)-d*(i*m-r*g)+f*(i*h-r*u),e[14]=-(n*(a*m-l*g)-s*(i*m-r*g)+f*(i*l-r*a)),e[15]=n*(a*h-l*u)-s*(i*h-r*u)+d*(i*l-r*a),e}function w(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],d=e[9],u=e[10],h=e[11],p=e[12],f=e[13],g=e[14],m=e[15];return(t*s-n*o)*(u*m-h*g)-(t*a-i*o)*(d*m-h*f)+(t*l-r*o)*(d*g-u*f)+(n*a-i*s)*(c*m-h*p)-(n*l-r*s)*(c*g-u*p)+(i*l-r*a)*(c*f-d*p)}function x(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],d=t[7],u=t[8],h=t[9],p=t[10],f=t[11],g=t[12],m=t[13],v=t[14],y=t[15],b=n[0],S=n[1],w=n[2],x=n[3];return e[0]=b*i+S*a+w*u+x*g,e[1]=b*r+S*l+w*h+x*m,e[2]=b*o+S*c+w*p+x*v,e[3]=b*s+S*d+w*f+x*y,b=n[4],S=n[5],w=n[6],x=n[7],e[4]=b*i+S*a+w*u+x*g,e[5]=b*r+S*l+w*h+x*m,e[6]=b*o+S*c+w*p+x*v,e[7]=b*s+S*d+w*f+x*y,b=n[8],S=n[9],w=n[10],x=n[11],e[8]=b*i+S*a+w*u+x*g,e[9]=b*r+S*l+w*h+x*m,e[10]=b*o+S*c+w*p+x*v,e[11]=b*s+S*d+w*f+x*y,b=n[12],S=n[13],w=n[14],x=n[15],e[12]=b*i+S*a+w*u+x*g,e[13]=b*r+S*l+w*h+x*m,e[14]=b*o+S*c+w*p+x*v,e[15]=b*s+S*d+w*f+x*y,e}function C(e,t,n){var i,r,o,s,a,l,c,d,u,h,p,f,g=n[0],m=n[1],v=n[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*v+t[12],e[13]=t[1]*g+t[5]*m+t[9]*v+t[13],e[14]=t[2]*g+t[6]*m+t[10]*v+t[14],e[15]=t[3]*g+t[7]*m+t[11]*v+t[15]):(i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],d=t[7],u=t[8],h=t[9],p=t[10],f=t[11],e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=d,e[8]=u,e[9]=h,e[10]=p,e[11]=f,e[12]=i*g+a*m+u*v+t[12],e[13]=r*g+l*m+h*v+t[13],e[14]=o*g+c*m+p*v+t[14],e[15]=s*g+d*m+f*v+t[15]),e}function k(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function E(e,t,n,i){var r,o,s,a,l,d,u,h,p,f,g,m,v,y,b,S,w,x,C,k,E,T,L,P,D=i[0],M=i[1],I=i[2],R=Math.hypot(D,M,I);return R<c?null:(D*=R=1/R,M*=R,I*=R,r=Math.sin(n),s=1-(o=Math.cos(n)),a=t[0],l=t[1],d=t[2],u=t[3],h=t[4],p=t[5],f=t[6],g=t[7],m=t[8],v=t[9],y=t[10],b=t[11],S=D*D*s+o,w=M*D*s+I*r,x=I*D*s-M*r,C=D*M*s-I*r,k=M*M*s+o,E=I*M*s+D*r,T=D*I*s+M*r,L=M*I*s-D*r,P=I*I*s+o,e[0]=a*S+h*w+m*x,e[1]=l*S+p*w+v*x,e[2]=d*S+f*w+y*x,e[3]=u*S+g*w+b*x,e[4]=a*C+h*k+m*E,e[5]=l*C+p*k+v*E,e[6]=d*C+f*k+y*E,e[7]=u*C+g*k+b*E,e[8]=a*T+h*L+m*P,e[9]=l*T+p*L+v*P,e[10]=d*T+f*L+y*P,e[11]=u*T+g*L+b*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function T(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],d=t[9],u=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+d*i,e[6]=a*r+u*i,e[7]=l*r+h*i,e[8]=c*r-o*i,e[9]=d*r-s*i,e[10]=u*r-a*i,e[11]=h*r-l*i,e}function L(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],d=t[9],u=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-d*i,e[2]=a*r-u*i,e[3]=l*r-h*i,e[8]=o*i+c*r,e[9]=s*i+d*r,e[10]=a*i+u*r,e[11]=l*i+h*r,e}function P(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],d=t[5],u=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+d*i,e[2]=a*r+u*i,e[3]=l*r+h*i,e[4]=c*r-o*i,e[5]=d*r-s*i,e[6]=u*r-a*i,e[7]=h*r-l*i,e}function D(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function M(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function I(e,t,n){var i,r,o,s=n[0],a=n[1],l=n[2],d=Math.hypot(s,a,l);return d<c?null:(s*=d=1/d,a*=d,l*=d,i=Math.sin(t),o=1-(r=Math.cos(t)),e[0]=s*s*o+r,e[1]=a*s*o+l*i,e[2]=l*s*o-a*i,e[3]=0,e[4]=s*a*o-l*i,e[5]=a*a*o+r,e[6]=l*a*o+s*i,e[7]=0,e[8]=s*l*o+a*i,e[9]=a*l*o-s*i,e[10]=l*l*o+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function R(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function A(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=i+i,l=r+r,c=o+o,d=i*a,u=i*l,h=i*c,p=r*l,f=r*c,g=o*c,m=s*a,v=s*l,y=s*c;return e[0]=1-(p+g),e[1]=u+y,e[2]=h-v,e[3]=0,e[4]=u-y,e[5]=1-(d+g),e[6]=f+m,e[7]=0,e[8]=h+v,e[9]=f-m,e[10]=1-(d+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function _(e,t){var n=new d(3),i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=i*i+r*r+o*o+s*s;return h>0?(n[0]=2*(a*s+u*i+l*o-c*r)/h,n[1]=2*(l*s+u*r+c*i-a*o)/h,n[2]=2*(c*s+u*o+a*r-l*i)/h):(n[0]=2*(a*s+u*i+l*o-c*r),n[1]=2*(l*s+u*r+c*i-a*o),n[2]=2*(c*s+u*o+a*r-l*i)),N(e,t,n),e}function V(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function B(e,t){var n=t[0],i=t[1],r=t[2],o=t[4],s=t[5],a=t[6],l=t[8],c=t[9],d=t[10];return e[0]=Math.hypot(n,i,r),e[1]=Math.hypot(o,s,a),e[2]=Math.hypot(l,c,d),e}function F(e,t){var n=new d(3);B(n,t);var i=1/n[0],r=1/n[1],o=1/n[2],s=t[0]*i,a=t[1]*r,l=t[2]*o,c=t[4]*i,u=t[5]*r,h=t[6]*o,p=t[8]*i,f=t[9]*r,g=t[10]*o,m=s+u+g,v=0;return m>0?(v=2*Math.sqrt(m+1),e[3]=.25*v,e[0]=(h-f)/v,e[1]=(p-l)/v,e[2]=(a-c)/v):s>u&&s>g?(v=2*Math.sqrt(1+s-u-g),e[3]=(h-f)/v,e[0]=.25*v,e[1]=(a+c)/v,e[2]=(p+l)/v):u>g?(v=2*Math.sqrt(1+u-s-g),e[3]=(p-l)/v,e[0]=(a+c)/v,e[1]=.25*v,e[2]=(h+f)/v):(v=2*Math.sqrt(1+g-s-u),e[3]=(a-c)/v,e[0]=(p+l)/v,e[1]=(h+f)/v,e[2]=.25*v),e}function U(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3],l=r+r,c=o+o,d=s+s,u=r*l,h=r*c,p=r*d,f=o*c,g=o*d,m=s*d,v=a*l,y=a*c,b=a*d,S=i[0],w=i[1],x=i[2];return e[0]=(1-(f+m))*S,e[1]=(h+b)*S,e[2]=(p-y)*S,e[3]=0,e[4]=(h-b)*w,e[5]=(1-(u+m))*w,e[6]=(g+v)*w,e[7]=0,e[8]=(p+y)*x,e[9]=(g-v)*x,e[10]=(1-(u+f))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function z(e,t,n,i,r){var o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,d=s+s,u=a+a,h=o*c,p=o*d,f=o*u,g=s*d,m=s*u,v=a*u,y=l*c,b=l*d,S=l*u,w=i[0],x=i[1],C=i[2],k=r[0],E=r[1],T=r[2],L=(1-(g+v))*w,P=(p+S)*w,D=(f-b)*w,M=(p-S)*x,I=(1-(h+v))*x,R=(m+y)*x,A=(f+b)*C,O=(m-y)*C,N=(1-(h+g))*C;return e[0]=L,e[1]=P,e[2]=D,e[3]=0,e[4]=M,e[5]=I,e[6]=R,e[7]=0,e[8]=A,e[9]=O,e[10]=N,e[11]=0,e[12]=n[0]+k-(L*k+M*E+A*T),e[13]=n[1]+E-(P*k+I*E+O*T),e[14]=n[2]+T-(D*k+R*E+N*T),e[15]=1,e}function j(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,d=i*s,u=i*a,h=r*s,p=r*a,f=r*l,g=o*s,m=o*a,v=o*l;return e[0]=1-u-f,e[1]=d+v,e[2]=h-m,e[3]=0,e[4]=d-v,e[5]=1-c-f,e[6]=p+g,e[7]=0,e[8]=h+m,e[9]=p-g,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function G(e,t,n,i,r,o,s){var a=1/(n-t),l=1/(r-i),c=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e}function W(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(o=1/(i-r),e[10]=(r+i)*o,e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e}function H(e,t,n,i){var r=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(r+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-a)*l*.5,e[9]=(r-o)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e}function q(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1,e}function Y(e,t,n,i){var r,o,s,a,l,d,u,h,p,f,g=t[0],m=t[1],y=t[2],b=i[0],S=i[1],w=i[2],x=n[0],C=n[1],k=n[2];return Math.abs(g-x)<c&&Math.abs(m-C)<c&&Math.abs(y-k)<c?v(e):(u=g-x,h=m-C,p=y-k,r=S*(p*=f=1/Math.hypot(u,h,p))-w*(h*=f),o=w*(u*=f)-b*p,s=b*h-S*u,(f=Math.hypot(r,o,s))?(r*=f=1/f,o*=f,s*=f):(r=0,o=0,s=0),a=h*s-p*o,l=p*r-u*s,d=u*o-h*r,(f=Math.hypot(a,l,d))?(a*=f=1/f,l*=f,d*=f):(a=0,l=0,d=0),e[0]=r,e[1]=a,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=d,e[10]=p,e[11]=0,e[12]=-(r*g+o*m+s*y),e[13]=-(a*g+l*m+d*y),e[14]=-(u*g+h*m+p*y),e[15]=1,e)}function J(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=i[0],l=i[1],c=i[2],d=r-n[0],u=o-n[1],h=s-n[2],p=d*d+u*u+h*h;p>0&&(d*=p=1/Math.sqrt(p),u*=p,h*=p);var f=l*h-c*u,g=c*d-a*h,m=a*u-l*d;return(p=f*f+g*g+m*m)>0&&(f*=p=1/Math.sqrt(p),g*=p,m*=p),e[0]=f,e[1]=g,e[2]=m,e[3]=0,e[4]=u*m-h*g,e[5]=h*f-d*m,e[6]=d*g-u*f,e[7]=0,e[8]=d,e[9]=u,e[10]=h,e[11]=0,e[12]=r,e[13]=o,e[14]=s,e[15]=1,e}function K(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function X(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Z(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Q(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function $(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function ee(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e}function te(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ne(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],d=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=t[0],S=t[1],w=t[2],x=t[3],C=t[4],k=t[5],E=t[6],T=t[7],L=t[8],P=t[9],D=t[10],M=t[11],I=t[12],R=t[13],A=t[14],O=t[15];return Math.abs(n-b)<=c*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-S)<=c*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-w)<=c*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(o-x)<=c*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-C)<=c*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-k)<=c*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(l-E)<=c*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(d-T)<=c*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(u-L)<=c*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(h-P)<=c*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(p-D)<=c*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(f-M)<=c*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(g-I)<=c*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(m-R)<=c*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(v-A)<=c*Math.max(1,Math.abs(v),Math.abs(A))&&Math.abs(y-O)<=c*Math.max(1,Math.abs(y),Math.abs(O))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ie=x,re=Q;function oe(){var e=new d(3);return d!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function se(e){var t=new d(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ae(e){var t=e[0],n=e[1],i=e[2];return Math.hypot(t,n,i)}function le(e,t,n){var i=new d(3);return i[0]=e,i[1]=t,i[2]=n,i}function ce(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function de(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function ue(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function he(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function pe(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function fe(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function ge(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function me(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function ve(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function ye(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function be(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Se(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function we(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function xe(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.hypot(n,i,r)}function Ce(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function ke(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function Ee(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Te(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Le(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Pe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function De(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s,e}function Me(e,t,n,i){var r=t[0],o=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e}function Ie(e,t,n,i,r,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),d=s*(3-2*o);return e[0]=t[0]*a+n[0]*l+i[0]*c+r[0]*d,e[1]=t[1]*a+n[1]*l+i[1]*c+r[1]*d,e[2]=t[2]*a+n[2]*l+i[2]*c+r[2]*d,e}function Re(e,t,n,i,r,o){var s=1-o,a=s*s,l=o*o,c=a*s,d=3*o*a,u=3*l*s,h=l*o;return e[0]=t[0]*c+n[0]*d+i[0]*u+r[0]*h,e[1]=t[1]*c+n[1]*d+i[1]*u+r[1]*h,e[2]=t[2]*c+n[2]*d+i[2]*u+r[2]*h,e}function Ae(e,t){t=t||1;var n=2*u()*Math.PI,i=2*u()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e}function Oe(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e}function Ne(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e}function _e(e,t,n){var i=n[0],r=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2],d=r*c-o*l,u=o*a-i*c,h=i*l-r*a,p=r*h-o*u,f=o*d-i*h,g=i*u-r*d,m=2*s;return d*=m,u*=m,h*=m,p*=2,f*=2,g*=2,e[0]=a+d+p,e[1]=l+u+f,e[2]=c+h+g,e}function Ve(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Be(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Fe(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Ue(e,t){var n=le(e[0],e[1],e[2]),i=le(t[0],t[1],t[2]);Le(n,n),Le(i,i);var r=Pe(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}function ze(e){return e[0]=0,e[1]=0,e[2]=0,e}function je(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ge(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function We(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(n-o)<=c*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=c*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=c*Math.max(1,Math.abs(r),Math.abs(a))}var He=he,qe=pe,Ye=fe,Je=xe,Ke=Ce,Xe=ae,Ze=ke,Qe=function(){var e=oe();return function(t,n,i,r,o,s){var a,l;for(n||(n=3),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();function $e(){var e=new d(4);return d!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function et(e){var t=new d(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function tt(e,t,n,i){var r=new d(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function nt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function it(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e}function rt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function ot(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function st(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function at(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function lt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function ct(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function dt(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function ut(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function ht(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function pt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function ft(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e}function gt(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],o=t[3]-e[3];return Math.hypot(n,i,r,o)}function mt(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],o=t[3]-e[3];return n*n+i*i+r*r+o*o}function vt(e){var t=e[0],n=e[1],i=e[2],r=e[3];return Math.hypot(t,n,i,r)}function yt(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r}function bt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function St(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function wt(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=o*s,e}function xt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ct(e,t,n,i){var r=n[0]*i[1]-n[1]*i[0],o=n[0]*i[2]-n[2]*i[0],s=n[0]*i[3]-n[3]*i[0],a=n[1]*i[2]-n[2]*i[1],l=n[1]*i[3]-n[3]*i[1],c=n[2]*i[3]-n[3]*i[2],d=t[0],u=t[1],h=t[2],p=t[3];return e[0]=u*c-h*l+p*a,e[1]=-d*c+h*s-p*o,e[2]=d*l-u*s+p*r,e[3]=-d*a+u*o-h*r,e}function kt(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e[3]=a+i*(n[3]-a),e}function Et(e,t){var n,i,r,o,s,a;t=t||1;do{s=(n=2*u()-1)*n+(i=2*u()-1)*i}while(s>=1);do{a=(r=2*u()-1)*r+(o=2*u()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return e[0]=t*n,e[1]=t*i,e[2]=t*r*l,e[3]=t*o*l,e}function Tt(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}function Lt(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2],c=n[3],d=c*i+a*o-l*r,u=c*r+l*i-s*o,h=c*o+s*r-a*i,p=-s*i-a*r-l*o;return e[0]=d*c+p*-s+u*-l-h*-a,e[1]=u*c+p*-a+h*-s-d*-l,e[2]=h*c+p*-l+d*-a-u*-s,e[3]=t[3],e}function Pt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Dt(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Mt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function It(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=t[0],a=t[1],l=t[2],d=t[3];return Math.abs(n-s)<=c*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=c*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=c*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-d)<=c*Math.max(1,Math.abs(o),Math.abs(d))}var Rt=ot,At=st,Ot=at,Nt=gt,_t=mt,Vt=vt,Bt=yt,Ft=function(){var e=$e();return function(t,n,i,r,o,s){var a,l;for(n||(n=4),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function Ut(){var e=new d(9);return d!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function zt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function jt(e){var t=new d(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Gt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Wt(e,t,n,i,r,o,s,a,l){var c=new d(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=r,c[5]=o,c[6]=s,c[7]=a,c[8]=l,c}function Ht(e,t,n,i,r,o,s,a,l,c){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e}function qt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Yt(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Jt(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],d=t[8],u=d*s-a*c,h=-d*o+a*l,p=c*o-s*l,f=n*u+i*h+r*p;return f?(f=1/f,e[0]=u*f,e[1]=(-d*i+r*c)*f,e[2]=(a*i-r*s)*f,e[3]=h*f,e[4]=(d*n-r*l)*f,e[5]=(-a*n+r*o)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(s*n-i*o)*f,e):null}function Kt(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],d=t[8];return e[0]=s*d-a*c,e[1]=r*c-i*d,e[2]=i*a-r*s,e[3]=a*l-o*d,e[4]=n*d-r*l,e[5]=r*o-n*a,e[6]=o*c-s*l,e[7]=i*l-n*c,e[8]=n*s-i*o,e}function Xt(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*(c*o-s*l)+n*(-c*r+s*a)+i*(l*r-o*a)}function Zt(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],d=t[7],u=t[8],h=n[0],p=n[1],f=n[2],g=n[3],m=n[4],v=n[5],y=n[6],b=n[7],S=n[8];return e[0]=h*i+p*s+f*c,e[1]=h*r+p*a+f*d,e[2]=h*o+p*l+f*u,e[3]=g*i+m*s+v*c,e[4]=g*r+m*a+v*d,e[5]=g*o+m*l+v*u,e[6]=y*i+b*s+S*c,e[7]=y*r+b*a+S*d,e[8]=y*o+b*l+S*u,e}function Qt(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],d=t[7],u=t[8],h=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=h*i+p*s+c,e[7]=h*r+p*a+d,e[8]=h*o+p*l+u,e}function $t(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],d=t[7],u=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*i+h*s,e[1]=p*r+h*a,e[2]=p*o+h*l,e[3]=p*s-h*i,e[4]=p*a-h*r,e[5]=p*l-h*o,e[6]=c,e[7]=d,e[8]=u,e}function en(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function tn(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function nn(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function rn(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function on(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function sn(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,d=i*s,u=i*a,h=r*s,p=r*a,f=r*l,g=o*s,m=o*a,v=o*l;return e[0]=1-u-f,e[3]=d-v,e[6]=h+m,e[1]=d+v,e[4]=1-c-f,e[7]=p-g,e[2]=h-m,e[5]=p+g,e[8]=1-c-u,e}function an(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],d=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15],y=n*a-i*s,b=n*l-r*s,S=n*c-o*s,w=i*l-r*a,x=i*c-o*a,C=r*c-o*l,k=d*g-u*f,E=d*m-h*f,T=d*v-p*f,L=u*m-h*g,P=u*v-p*g,D=h*v-p*m,M=y*D-b*P+S*L+w*T-x*E+C*k;return M?(M=1/M,e[0]=(a*D-l*P+c*L)*M,e[1]=(l*T-s*D-c*E)*M,e[2]=(s*P-a*T+c*k)*M,e[3]=(r*P-i*D-o*L)*M,e[4]=(n*D-r*T+o*E)*M,e[5]=(i*T-n*P-o*k)*M,e[6]=(g*C-m*x+v*w)*M,e[7]=(m*S-f*C-v*b)*M,e[8]=(f*x-g*S+v*y)*M,e):null}function ln(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function cn(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function dn(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function un(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function hn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function pn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function fn(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e}function gn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function mn(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],d=e[7],u=e[8],h=t[0],p=t[1],f=t[2],g=t[3],m=t[4],v=t[5],y=t[6],b=t[7],S=t[8];return Math.abs(n-h)<=c*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-p)<=c*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=c*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(o-g)<=c*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(s-m)<=c*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-v)<=c*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-y)<=c*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(d-b)<=c*Math.max(1,Math.abs(d),Math.abs(b))&&Math.abs(u-S)<=c*Math.max(1,Math.abs(u),Math.abs(S))}var vn=Zt,yn=hn;function bn(){var e=new d(4);return d!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Sn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function wn(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function xn(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>c?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function Cn(e,t){var n=qn(e,t);return Math.acos(2*n*n-1)}function kn(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],d=n[3];return e[0]=i*d+s*a+r*c-o*l,e[1]=r*d+s*l+o*a-i*c,e[2]=o*d+s*c+i*l-r*a,e[3]=s*d-i*a-r*l-o*c,e}function En(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-i*a,e}function Tn(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-o*a,e[1]=r*l+s*a,e[2]=o*l+i*a,e[3]=s*l-r*a,e}function Ln(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e}function Pn(e,t){var n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e}function Dn(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=Math.sqrt(n*n+i*i+r*r),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return e[0]=n*l,e[1]=i*l,e[2]=r*l,e[3]=a*Math.cos(s),e}function Mn(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=Math.sqrt(n*n+i*i+r*r),a=s>0?Math.atan2(s,o)/s:0;return e[0]=n*a,e[1]=i*a,e[2]=r*a,e[3]=.5*Math.log(n*n+i*i+r*r+o*o),e}function In(e,t,n){return Mn(e,t),Hn(e,e,n),Dn(e,e),e}function Rn(e,t,n,i){var r,o,s,a,l,d=t[0],u=t[1],h=t[2],p=t[3],f=n[0],g=n[1],m=n[2],v=n[3];return(o=d*f+u*g+h*m+p*v)<0&&(o=-o,f=-f,g=-g,m=-m,v=-v),1-o>c?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(a=1-i,l=i),e[0]=a*d+l*f,e[1]=a*u+l*g,e[2]=a*h+l*m,e[3]=a*p+l*v,e}function An(e){var t=u(),n=u(),i=u(),r=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*n),e[1]=r*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e}function On(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=o*a,e}function Nn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function _n(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*s+s]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*o+s]-t[3*s+o])*n,e[o]=(t[3*o+r]+t[3*r+o])*n,e[s]=(t[3*s+r]+t[3*r+s])*n}return e}function Vn(e,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),d=Math.cos(i);return e[0]=o*l*d-s*a*c,e[1]=s*a*d+o*l*c,e[2]=s*l*c-o*a*d,e[3]=s*l*d+o*a*c,e}function Bn(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Fn=et,Un=tt,zn=nt,jn=it,Gn=rt,Wn=kn,Hn=pt,qn=xt,Yn=kt,Jn=vt,Kn=Jn,Xn=yt,Zn=Xn,Qn=wt,$n=Mt,ei=It,ti=function(){var e=oe(),t=le(1,0,0),n=le(0,1,0);return function(i,r,o){var s=Pe(r,o);return s<-.999999?(De(e,t,r),Xe(e)<1e-6&&De(e,n,r),Le(e,e),wn(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(De(e,r,o),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,Qn(i,i))}}(),ni=function(){var e=bn(),t=bn();return function(n,i,r,o,s,a){return Rn(e,i,s,a),Rn(t,r,o,a),Rn(n,e,t,2*a*(1-a)),n}}(),ii=function(){var e=Ut();return function(t,n,i,r){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Qn(t,_n(t,e))}}(),ri=n(9735);function oi(){var e=new d(2);return d!=Float32Array&&(e[0]=0,e[1]=0),e}function si(e){var t=new d(2);return t[0]=e[0],t[1]=e[1],t}function ai(e,t){var n=new d(2);return n[0]=e,n[1]=t,n}function li(e,t){return e[0]=t[0],e[1]=t[1],e}function ci(e,t,n){return e[0]=t,e[1]=n,e}function di(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ui(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function hi(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function pi(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function fi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function gi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function mi(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function vi(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function yi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function bi(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function Si(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e}function wi(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.hypot(n,i)}function xi(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function Ci(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function ki(e){var t=e[0],n=e[1];return t*t+n*n}function Ei(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Ti(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Li(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e}function Pi(e,t){return e[0]*t[0]+e[1]*t[1]}function Di(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e}function Mi(e,t,n,i){var r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e}function Ii(e,t){t=t||1;var n=2*u()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Ri(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e}function Ai(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e}function Oi(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e}function Ni(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}function _i(e,t,n,i){var r=t[0]-n[0],o=t[1]-n[1],s=Math.sin(i),a=Math.cos(i);return e[0]=r*a-o*s+n[0],e[1]=r*s+o*a+n[1],e}function Vi(e,t){var n=e[0],i=e[1],r=t[0],o=t[1],s=n*n+i*i;s>0&&(s=1/Math.sqrt(s));var a=r*r+o*o;a>0&&(a=1/Math.sqrt(a));var l=(n*r+i*o)*s*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Bi(e){return e[0]=0,e[1]=0,e}function Fi(e){return"vec2("+e[0]+", "+e[1]+")"}function Ui(e,t){return e[0]===t[0]&&e[1]===t[1]}function zi(e,t){var n=e[0],i=e[1],r=t[0],o=t[1];return Math.abs(n-r)<=c*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-o)<=c*Math.max(1,Math.abs(i),Math.abs(o))}var ji=Ci,Gi=ui,Wi=hi,Hi=pi,qi=wi,Yi=xi,Ji=ki,Ki=function(){var e=oi();return function(t,n,i,r,o,s){var a,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();const Xi=h(),Zi=["x","y","z"],Qi=[le(1,0,0),le(0,1,0),le(0,0,1)],$i=(le(0,0,0),tt(0,0,0,0)),er=le(1,1,1);le(1/0,1/0,1/0),bn();function tr(e){return e[0]*e[1]*e[2]}function nr(e){return"".concat(e[0],",").concat(e[1],",").concat(e[2])}function ir(e,t,n){let i=t[0],r=t[1],o=t[2];return e[0]=n[0]*i+n[4]*r+n[8]*o,e[1]=n[1]*i+n[5]*r+n[9]*o,e[2]=n[2]*i+n[6]*r+n[10]*o,e}function rr(e,t,n){let i=t[0],r=t[1],o=t[2];return e[0]=n[0]*i+n[1]*r+n[2]*o,e[1]=n[4]*i+n[5]*r+n[6]*o,e[2]=n[8]*i+n[9]*r+n[10]*o,e}function or(e,t,n,i){const r=e.length;let o=function(e,t,n){const i=n.length;let r=0;for(let s=0;s<i;++s)r+=(e[s]-t[s])**2;let o=0;for(let s=0;s<i;++s){const i=e[s];o-=(i-n[s])*(t[s]-i)}return o/Math.max(r,1e-6)}(t,n,i);o=Math.max(0,Math.min(1,o));for(let s=0;s<r;++s){const i=t[s];e[s]=i+o*(n[s]-i)}return e}function sr(e,t){const n=t[0],i=t[1],r=t[2],o=t[4],s=t[5],a=t[6],l=t[8],c=t[9],d=t[10];return e[0]=n,e[1]=i,e[2]=r,e[3]=o,e[4]=s,e[5]=a,e[6]=l,e[7]=c,e[8]=d,e}function ar(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],d=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15];e[0]=o+n,e[1]=c+s,e[2]=p+d,e[3]=v+f,e[4]=o-n,e[5]=c-s,e[6]=p-d,e[7]=v-f,e[8]=o+i,e[9]=c+a,e[10]=p+u,e[11]=v+g,e[12]=o-i,e[13]=c-a,e[14]=p-u,e[15]=v-g;const y=o+r,b=c+l,S=p+h,w=v+m,x=o-r,C=c-l,k=p-h,E=v-m,T=Math.sqrt(y**2+b**2+S**2);e[16]=y/T,e[17]=b/T,e[18]=S/T,e[19]=w/T;const L=Math.sqrt(x**2+C**2+k**2);return e[20]=x/L,e[21]=C/L,e[22]=k/L,e[23]=E/L,e}function lr(e,t,n,i,r,o,s){for(let a=0;a<6;++a){const l=s[4*a],c=s[4*a+1],d=s[4*a+2],u=s[4*a+3];if(Math.max(l*e,l*i)+Math.max(c*t,c*r)+Math.max(d*n,d*o)+u<0)return!1}return!0}function cr(e,t,n,i,r,o,s){for(let a=0;a<4;++a){const l=s[4*a],c=s[4*a+1],d=s[4*a+2],u=s[4*a+3];if(Math.max(l*e,l*i)+Math.max(c*t,c*r)+Math.max(d*n,d*o)+u<0)return!1}{const a=5,l=s[4*a],c=s[4*a+1],d=s[4*a+2],u=s[4*a+3],h=Math.max(l*e,l*i)+Math.max(c*t,c*r)+Math.max(d*n,d*o),p=Math.min(l*e,l*i)+Math.min(c*t,c*r)+Math.min(d*n,d*o),f=1e-6*Math.abs(u);if(p>-u+f||h<-u-f)return!1}return!0}function dr(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=n.length,o=[],s=i?1:t+1,a=i?t+1:1;for(let l=0;l<r;++l){const i=n[l];for(let n=0;n<t;++n)0!==e[n*s+i*a]&&(o[n]=!0)}return(0,ri.eN)(o,!0)}function ur(e,t,n){for(let i=0;i<3;++i){const r=n[i];for(let n=0;n<3;++n)e[i+3*n]=r*t[i+3*n]}return e}function hr(e){if(1===e[15]){const t=2/Math.abs(e[10]);return 2/Math.abs(e[0])*(2/Math.abs(e[5]))*t}const t=e[10],n=2*e[14]/(2*t-2),i=(t-1)*n/(t+1);return 4/(e[0]*e[5])/3*(Math.abs(i)**3-Math.abs(n)**3)}function pr(e){if(1===e[15]){return 2/Math.abs(e[10])}const t=e[10],n=2*e[14]/(2*t-2),i=(t-1)*n/(t+1);return Math.abs(i-n)}function fr(e){return e[2]=0,e[6]=0,e[10]=0,e[14]=0,e}const gr=oe();function mr(e,t){t[0]=t[1]=t[2]=Number.POSITIVE_INFINITY,t[3]=t[4]=t[5]=Number.NEGATIVE_INFINITY;for(let n=0;n<8;++n){gr[0]=2*(1&n)-1,gr[1]=2*(n>>>1&1)-1,gr[2]=2*(n>>>2&1)-1,Oe(gr,gr,e);for(let e=0;e<3;++e){const n=gr[e];t[e]=Math.min(t[e],n),t[e+3]=Math.max(t[e+3],n)}}}},3819:(e,t,n)=>{function i(e){return("0"+e.toString(16)).slice(-2)}function r(e){return Array.prototype.map.call(e,i).join("")}function o(e){if(!/^(?:[0-9a-fA-F]{2})*$/.test(e))throw new Error("Invalid hex-encoded string");const t=e.length/2,n=new Uint8Array(t);for(let i=0;i<t;++i)n[i]=parseInt(e.substr(2*i,2),16);return n}n.d(t,{MT:()=>o,aO:()=>r,sY:()=>i})},2686:(e,t,n)=>{n.d(t,{Bk:()=>p,Dl:()=>f,El:()=>g,Rc:()=>u,cj:()=>h,j$:()=>c});var i=n(3651),r=n.n(i),o=n(984),s=n.n(o),a=n(2959),l=n(8194);class c extends Error{constructor(e,t,n,i){let r="Fetching ".concat(s()(e)," resulted in HTTP error ").concat(t);n&&(r+=": ".concat(n)),r+=".",super(r),this.name="HttpError",this.message=r,this.url=e,this.status=t,this.statusText=n,i&&(this.response=i)}static fromResponse(e){return new c(e.url,e.status,e.statusText,e)}static fromRequestError(e,t){if(t instanceof TypeError){let t;return t="string"===typeof e?e:e.url,new c(t,0,"Network or CORS error")}return t}}async function d(e,t){let n;try{n=await fetch(e,t)}catch(i){throw c.fromRequestError(e,i)}if(!n.ok)throw c.fromResponse(n);return n}function u(e){return e.arrayBuffer()}function h(e){return e.json()}async function p(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.fx;if(i===a.fx){const i=await d(e,t);return await n(i)}const o=new AbortController,s=i.add((()=>o.abort()));try{const i=await d(e,r()(r()({},t),{signal:o.signal}));return await n(i)}finally{s()}}new l.Uint64;function f(e){let t=e.match(/^([^:\/]+):\/\/([^\/]+)((?:\/.*)?)$/);if(null===t)throw new Error("Invalid URL: ".concat(s()(e)));return{protocol:t[1],host:t[2],path:t[3]}}function g(e){return e instanceof c&&(0===e.status||403===e.status||404===e.status)}},7970:(e,t,n)=>{n.r(t),n.d(t,{emptyToUndefined:()=>me,expectArray:()=>W,jsonToUrlSafe:()=>U,normalizeStringLiteral:()=>V,parseArray:()=>H,parseFiniteVec:()=>C,parseFixedLengthArray:()=>q,parseIntVec:()=>k,parseQueryStringParameters:()=>ae,parseXYZ:()=>x,pythonLiteralParse:()=>G,pythonLiteralToJSON:()=>j,stableStringify:()=>E,unparseQueryStringParameters:()=>le,urlSafeParse:()=>z,urlSafeStringify:()=>D,urlSafeStringifyString:()=>L,urlSafeToJSON:()=>F,valueOr:()=>ne,verify3dDimensions:()=>he,verify3dScale:()=>ue,verify3dVec:()=>de,verifyBoolean:()=>ge,verifyEnumString:()=>ce,verifyFiniteFloat:()=>b,verifyFiniteNonNegativeFloat:()=>S,verifyFinitePositiveFloat:()=>w,verifyFloat:()=>y,verifyFloat01:()=>se,verifyInt:()=>J,verifyIntegerArray:()=>fe,verifyMapKey:()=>Z,verifyNonnegativeInt:()=>X,verifyObject:()=>Y,verifyObjectAsMap:()=>oe,verifyObjectProperty:()=>ie,verifyOptionalBoolean:()=>te,verifyOptionalInt:()=>ee,verifyOptionalObjectProperty:()=>re,verifyOptionalString:()=>$,verifyPositiveInt:()=>K,verifyString:()=>Q,verifyStringArray:()=>pe});var i=n(608),r=n.n(i),o=n(974),s=n.n(o),a=n(2395),l=n.n(a),c=n(1190),d=n.n(c),u=n(8178),h=n.n(u),p=n(984),f=n.n(p),g=n(6392),m=n.n(g),v=n(3835);function y(e){let t=typeof e;if("number"===t||"string"===t){let t=parseFloat(""+e);if(!m()(t))return t}throw new Error("Expected floating-point number, but received: ".concat(f()(e),"."))}function b(e){let t=y(e);if(h()(t))return t;throw new Error("Expected finite floating-point number, but received: ".concat(t,"."))}function S(e){let t=y(e);if(h()(t)&&t>=0)return t;throw new Error("Expected finite non-negative floating-point number, but received: ".concat(t,"."))}function w(e){let t=b(e);if(t>0)return t;throw new Error("Expected positive finite floating-point number, but received: ".concat(t,"."))}function x(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y;Y(t),e[0]=e[1]=e[2]=0;for(const i of d()(t))switch(i){case"x":e[0]=n(t[i]);break;case"y":e[1]=n(t[i]);break;case"z":e[2]=n(t[i]);break;default:throw new Error("Expected object to have keys ['x', 'y', 'z'], but received: ".concat(f()(t),"."))}return e}function C(e,t){let n=e.length;if(!Array.isArray(t)||t.length!==n)throw new Error("Incompatible sizes");for(let i=0;i<n;++i)if(!h()(parseFloat(t[i])))throw new Error("Non-finite value.");for(let i=0;i<n;++i)e[i]=parseFloat(t[i]);return e}function k(e,t){let n=e.length;if(!Array.isArray(t)||t.length!==n)throw new Error("Incompatible sizes.");for(let i=0;i<n;++i){let e=parseInt(t[i],void 0);if(!l()(e))throw new Error("Non-integer value.")}for(let i=0;i<n;++i)e[i]=parseInt(t[i],void 0);return e}function E(e){if("object"===typeof e){if(null===e)return"null";if(Array.isArray(e)){let t="[",n=e.length,i=0;if(i<n)for(t+=E(e[i]);++i<n;)t+=",",t+=E(e[i]);return t+="]",t}let t="{",n=d()(e).sort(),i=0,r=n.length;if(i<r){let o=n[i];for(t+=f()(o),t+=":",t+=E(e[o]);++i<r;)t+=",",o=n[i],t+=f()(o),t+=":",t+=E(e[o])}return t+="}",t}return f()(e)}function T(e){return e.replace(/['"]/g,(e=>'"'===e?"'":'"'))}function L(e){return T(f()(T(e)))}const P="_";function D(e){if("object"===typeof e){if(null===e)return"null";let t=e.toJSON;if("function"===typeof t)return D(t.call(e));if(Array.isArray(e)){let t="[",n=e.length,i=0;if(i<n)for(t+=D(e[i]);++i<n;)t+=P,t+=D(e[i]);return t+="]",t}let n="{",i=d()(e),r=!0;for(let o of i){let t=e[o];if(void 0===t)continue;let i=D(t);i&&(r?r=!1:n+=P,n+=L(o),n+=":",n+=i)}return n+="}",n}return"string"===typeof e?L(e):f()(e)}const M=/('(?:[^'\\]|(?:\\.))*')/,I=/("(?:[^"\\]|(?:\\.))*")/,R=new RegExp("".concat(M.source,"|").concat(I.source)),A=new RegExp("".concat(I.source,"|").concat(M.source)),O=/^((?:[^"'\\]|(?:\\[^']))*)("|\\')/,N=/^((?:[^"'\\]|(?:\\.))*)'/;function _(e,t,n,i){if(e.length>=2&&e.charAt(0)===t&&e.charAt(e.length-1)===t){let r=e.substr(1,e.length-2),o=n;for(;r.length>0;){let e=r.match(i);if(null===e){o+=r;break}o+=e[1],e[2]===n?(o+="\\",o+=n):o+=t,r=r.substr(e.index+e[0].length)}return o+=n,o}return e}function V(e){return _(e,"'",'"',O)}function B(e,t,n){const i=/[&_,]/g;let r,o,s;'"'===n?(r="'",o=O,s=R):(r='"',o=N,s=A);let a="";for(;e.length>0;){let l,c,d=e.match(s);if(null===d)l=e,e="",c="";else{l=e.substr(0,d.index),e=e.substr(d.index+d[0].length);let t=d[1];c=void 0!==t?_(t,r,n,o):d[2]}a+=l.replace(i,t),a+=c}return a}function F(e){return B(e,",",'"')}function U(e){return B(e,"_","'")}function z(e){return JSON.parse(F(e))}function j(e){let t="";for(;e.length>0;){let n,i,r=e.match(R);if(null===r)n=e,e="",i="";else{n=e.substr(0,r.index),e=e.substr(r.index+r[0].length);let t=r[1];i=void 0!==t?V(t):r[2]}t+=n.replace(/\(/g,"[").replace(/\)/g,"]").replace("True","true").replace("False","false").replace(/,\s*([\}\]])/g,"$1"),t+=i}return t}function G(e){return JSON.parse(j(e))}function W(e,t){if(!Array.isArray(e))throw new Error("Expected array, but received: ".concat(f()(e),"."));if(void 0!==t&&e.length!==t)throw new Error("Expected array of length ".concat(t,", but received: ").concat(f()(e),"."));return e}function H(e,t){if(!Array.isArray(e))throw new Error("Expected array, but received: ".concat(f()(e),"."));return e.map(t)}function q(e,t,n){const i=e.length;if(!Array.isArray(t)||t.length!==i)throw new Error("Expected length ".concat(i," array, but received: ").concat(f()(t),"."));for(let r=0;r<i;++r)e[r]=n(t[r],r);return e}function Y(e){if("object"!==typeof e||null==e||Array.isArray(e))throw new Error("Expected JSON object, but received: ".concat(f()(e),"."));return e}function J(e){let t=parseInt(e,10);if(!l()(t))throw new Error("Expected integer, but received: ".concat(f()(e),"."));return t}function K(e){let t=J(e);if(t<=0)throw new Error("Expected positive integer, but received: ".concat(t,"."));return t}function X(e){const t=J(e);if(t<0)throw new Error("Expected non-negative integer, but received: ".concat(t,"."));return t}function Z(e,t){let n=t.get(e);if(void 0===n)throw new Error("Expected one of ".concat(f()(s()(t.keys())),", ")+"but received: ".concat(f()(e),"."));return n}function Q(e){if("string"!==typeof e)throw new Error("Expected string, but received: ".concat(f()(e),"."));return e}function $(e){if(void 0!==e)return Q(e)}function ee(e){if(void 0!==e)return J(e)}function te(e){if(void 0!==e){if("boolean"===typeof e)return e;if("true"===e)return!0;if("false"===e)return!1;throw new Error("Expected string or boolean but received: ".concat(f()(e)))}}function ne(e,t){return void 0===e?t:e}function ie(e,t,n){let i=Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;try{return n(i)}catch(r){throw new Error("Error parsing ".concat(f()(t)," property: ").concat(r.message))}}function re(e,t,n,i){return ie(e,t,(e=>void 0===e?i:n(e)))}function oe(e,t){Y(e);let n=new(r());for(let r of d()(e))try{n.set(r,t(e[r]))}catch(i){throw new Error("Error parsing value associated with key ".concat(f()(r),": ").concat(i.message))}return n}function se(e){if("number"!==typeof e||!h()(e)||e<0||e>1)throw new Error("Expected floating point number in [0,1], but received: ".concat(f()(e),"."));return e}function ae(e){if(""===e)return{};if(e.startsWith("{"))return z(e);{let t={},n=e.split(/[&;]/);for(let e of n){let n=e.match(/^([^=&;]+)=([^&;]*)$/);if(null===n)throw new Error("Invalid query string part: ".concat(f()(e),"."));t[n[1]]=decodeURIComponent(n[2])}return t}}function le(e){if(void 0===e)return"";const t=d()(e);return 0===t.length?"":t.some((t=>"string"!==typeof e[t]))?f()(e):t.map((t=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t])))).join("&")}function ce(e,t){if("string"===typeof e&&null!==e.match(/^[a-zA-Z]/)&&(e=e.toUpperCase(),t.hasOwnProperty(e)))return t[e];throw new Error("Invalid enum value: ".concat(f()(e),"."))}function de(e){return q(v.eR.create(),e,b)}function ue(e){return q(v.eR.create(),e,w)}function he(e){return q(v.eR.create(),e,K)}function pe(e){if(!Array.isArray(e))throw new Error("Expected array, received: ".concat(f()(e),"."));for(let t of e)if("string"!==typeof t)throw new Error("Expected string, received: ".concat(f()(t),"."));return e}function fe(e){if(!Array.isArray(e))throw new Error("Expected array, received: ".concat(f()(e),"."));for(let t of e)if(!l()(t))throw new Error("Expected integer, received: ".concat(f()(t),"."));return e}function ge(e){if("boolean"!==typeof e)throw new Error("Expected boolean, received: ".concat(f()(e)));return e}function me(e){for(const t in e)return e}},1058:(e,t,n)=>{n.d(t,{YT:()=>l,cL:()=>u,n5:()=>a.n5,qZ:()=>a.qZ});var i=n(1274),r=n.n(i),o=n(7160),s=n(7562),a=n(8602);const l=new o.B0(0);window.addEventListener("keydown",(e=>{l.value=(0,a.Up)(e)})),window.addEventListener("keyup",(e=>{l.value=(0,a.Up)(e)}));const c=new(r())(["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","escape","pause"]),d=new(r())(["color","date","datetime","datetime-local","email","month","number","password","search","tel","text","time","url","week"]);class u extends s.O8{constructor(e,t){super(),this.target=e,this.eventMap=t,this.modifierShortcutsAreGlobal=!0,this.allShortcutsAreGlobal=!1,this.allowSpaceKeyOnButtons=!1,this.registerEventListener(e,"keydown",this.handleKeyDown.bind(this),!1)}shouldIgnoreEvent(e,t){var n=t.target;let i=n.tagName;if(n===this.target)return!1;var r="TEXTAREA"===i||"INPUT"===i||"BUTTON"===i||"SELECT"===i,o=!r&&(n.isContentEditable||n.ownerDocument&&"on"===n.ownerDocument.designMode);return!(!r&&!o)&&(!this.allShortcutsAreGlobal&&!c.has(e)&&(!!o||(!(!this.modifierShortcutsAreGlobal||!(t.altKey||t.ctrlKey||t.metaKey))||("INPUT"===i&&d.has(n.type)?"enter"!==e:"INPUT"!==i&&"BUTTON"!==i||!this.allowSpaceKeyOnButtons&&"space"===e))))}handleKeyDown(e){const t=function(e){return e.code.toLowerCase()}(e);this.shouldIgnoreEvent(t,e)||(0,a.z3)(t,e,e,this.eventMap)}}},679:(e,t,n)=>{n.d(t,{Md:()=>b,_:()=>v,LK:()=>y,Os:()=>C,gt:()=>D,Ho:()=>M,Xw:()=>I,ZL:()=>m,M_:()=>S,fS:()=>T,Ct:()=>A,Nt:()=>R,Zo:()=>x,qM:()=>P,DZ:()=>L,Gr:()=>w});var i=n(2395),r=n.n(i),o=n(984),s=n.n(o),a=n(8178),l=n.n(a),c=n(9043),d=n(1783);const u=5e-324,h=new Float64Array(1),p=new Uint32Array(h.buffer);var f=n(7970),g=n(8194);const m={[c.pe.UINT8]:[0,255],[c.pe.INT8]:[-128,127],[c.pe.UINT16]:[0,65535],[c.pe.INT16]:[-32768,32767],[c.pe.UINT32]:[0,4294967295],[c.pe.INT32]:[-2147483648,2147483647],[c.pe.UINT64]:[g.Uint64.ZERO,new g.Uint64(4294967295,4294967295)],[c.pe.FLOAT32]:[0,1]};function v(e,t){if("number"===typeof t){const n=e[0];return(t-n)/(e[1]-n)}{const n=e[0],i=e[1];let r;r=g.Uint64.compare(t,n)<0?-g.Uint64.subtract(k,n,t).toNumber():g.Uint64.subtract(k,t,n).toNumber();let o=g.Uint64.absDifference(k,i,n).toNumber();return g.Uint64.compare(n,i)>0&&(o*=-1),r/o}}function y(e,t,n){if("number"===typeof e[0]){let i=e[0]*(1-n)+e[1]*n;if(t!==c.pe.FLOAT32){const e=m[t];i=Math.round(i),i=Math.max(e[0],i),i=Math.min(e[1],i)}return i}{let t=e[0],r=e[1];if(g.Uint64.compare(t,r)>0){var i=[r,t];t=i[0],r=i[1],n=1-n}const o=g.Uint64.subtract(k,r,t).toNumber(),s=new g.Uint64;return n<=0?(k.setFromNumber(o*-n),g.Uint64.subtract(s,t,g.Uint64.min(k,t))):n>=1?(k.setFromNumber(o*(n-1)),g.Uint64.add(s,r,k),g.Uint64.less(s,r)&&(s.low=s.high=4294967295)):(k.setFromNumber(o*n),g.Uint64.add(s,t,k),g.Uint64.less(s,t)&&(s.low=s.high=4294967295)),s}}function b(e,t){return"number"===typeof t?Math.min(Math.max(e[0],t),e[1]):g.Uint64.min(g.Uint64.max(e[0],t),e[1])}function S(e,t){return[b(e,t[0]),b(e,t[1])]}function w(e){if(C(e[0],e[1])<=0)return e;throw new Error("Invalid interval: [".concat(e[0],", ").concat(e[1],"]"))}function x(e){return C(e[0],e[1])<=0?e:[e[1],e[0]]}function C(e,t){return"number"===typeof e?e-t:g.Uint64.compare(e,t)}const k=new g.Uint64,E=new g.Uint64;function T(e,t){return"number"===typeof t?Math.abs(t-e[0])<Math.abs(t-e[1])?0:1:g.Uint64.less(g.Uint64.absDifference(k,e[0],t),g.Uint64.absDifference(E,e[1],t))?0:1}function L(e,t){let n;switch(n="string"!==typeof t?""+t:t,e){case c.pe.UINT64:return g.Uint64.parseString(n);case c.pe.FLOAT32:{const e=parseFloat(n);if(!l()(e))throw new Error("Invalid float32 value: ".concat(s()(n)));return e}default:{const t=parseInt(n),i=m[e];if(!r()(t)||t<i[0]||t>i[1])throw new Error("Invalid ".concat(c.pe[e].toLowerCase()," value: ").concat(s()(n)));return t}}}function P(e,t){return(0,f.parseFixedLengthArray)(new Array(2),e,(e=>L(t,e)))}function D(e,t,n){return e===c.pe.UINT64?g.Uint64.equal(t[0],n[0])&&g.Uint64.equal(t[1],n[1]):t[0]===n[0]&&t[1]===n[1]}function M(e,t){if(!D(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:m[t]))return t===c.pe.UINT64?[e[0].toString(),e[1].toString()]:e}function I(e,t,n){switch(e){case c.pe.FLOAT32:return function(e,t){if(isNaN(e)||isNaN(t))return NaN;if(e===t)return t;if(0===e)return t<0?-u:u;h[0]=e;const n=d.Hp===d.H$.LITTLE?0:1,i=1-n;return t>e===e>0?4294967295===p[n]?(p[n]=0,p[i]+=1):p[n]+=1:0===p[n]?(p[n]=4294967295,p[i]-=1):p[n]-=1,h[0]}(t,n*(1/0));case c.pe.UINT64:const i=t;return-1===n?0===i.low&&0===i.high?i:g.Uint64.decrement(new g.Uint64,i):4294967295===i.low&&4294967295===i.high?i:g.Uint64.increment(new g.Uint64,i);default:{const i=m[e];return Math.max(i[0],Math.min(i[1],t+n))}}}function R(e,t){switch(e){case c.pe.FLOAT32:return 0;case c.pe.UINT64:return.5/g.Uint64.absDifference(k,t[0],t[1]).toNumber();default:return.5/Math.abs(t[0]-t[1])}}function A(e,t){switch(e){case c.pe.FLOAT32:return 1;case c.pe.UINT64:{const e=g.Uint64.absDifference(k,t[0],t[1]).toNumber();return e/(e+1)}default:{const e=Math.abs(t[0]-t[1]);return e/(e+1)}}}},2729:(e,t,n)=>{function i(e,t,n,i,r,o,s,a,l){for(let c=0;c<s;++c)for(let s=0;s<l;++s){let l=0;for(let e=0;e<a;++e)l+=n[c+i*e]*r[e+o*s];e[c+t*s]=l}return e}function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return function(e,t,n){for(let i=0;i<n;++i){const r=t*i;e.fill(0,r,r+n),e[r+i]=1}return e}(new e(t*n),t,Math.min(t,n))}function o(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=t.length,r=n?i+1:i,o=new e(r*(i+1));n&&(o[o.length-1]=1);for(let s=0;s<i;++s)o[(r+1)*s]=t[s];return o}function s(e,t,n){for(let i=0;i<n;++i)for(let r=0;r<n;++r)if(e[i*t+r]!=(i===r?1:0))return!1;return!0}function a(e,t,n,i,r,o){for(let s=0;s<o;++s){const o=s*i,a=s*t;for(let t=0;t<r;++t)e[a+t]=n[o+t]}return e}function l(e,t,n,i){a(e,t+1,n,i+1,i,i);for(let r=0;r<i;++r)e[(t+1)*t+r]=n[(i+1)*i+r];e[e.length-1]=1;for(let r=i;r<t;++r)e[(t+1)*r+r]=1;return e}let c;function d(e,t,n,i,r){return a(e,t,n,i,r,r),function(e,t,n){let i=1;(void 0===c||c.length<n)&&(c=new Uint32Array(n));for(let r=0;r<n;++r)c[r]=r;for(let r=0;r<n;++r){const o=t*r;let s=r;{let t=Math.abs(e[o+r]);for(let i=r+1;i<n;++i){const n=Math.abs(e[o+i]);n>t&&(t=n,s=i)}}if(r!==s){i*=-1;for(let i=0;i<n;++i){const n=t*i,o=e[n+r];e[n+r]=e[n+s],e[n+s]=o}{const e=c[r];c[r]=c[s],c[s]=e}}const a=e[o+r],l=1/a;i*=a;for(let i=0;i<n;++i)e[t*i+r]*=l;e[o+r]=l;for(let i=0;i<n;++i){if(i===r)continue;const o=-e[t*r+i];for(let s=0;s<n;++s){const n=t*s;e[n+i]+=o*e[n+r]}e[t*r+i]=o*l}}for(let r=0;r<n;++r){let i=c[r];for(;i!==r;){const o=t*r,s=t*i;for(let t=0;t<n;++t){const n=o+t,i=s+t,r=e[n];e[n]=e[i],e[i]=r}const a=c[r]=c[i];c[i]=i,i=a}}return i}(e,t,r)}function u(e,t,n,i,r,o){for(let s=0;s<o;++s){const o=t*s,a=i*s;for(let t=0;t<r;++t)if(e[o+t]!==n[a+t])return!1}return!0}function h(e,t,n,i,r){for(let o=0;o<r;++o){let s=t[n*r+o];for(let e=0;e<r;++e)s+=t[n*e+o]*i[e];e[o]=s}return e}function p(e,t,n,i,r){for(let o=0;o<r;++o){let s=0;for(let e=0;e<r;++e)s+=t[n*e+o]*i[e];e[o]=s}return e}n.d(t,{Aw:()=>l,C:()=>a,DA:()=>r,DI:()=>d,LC:()=>u,Lk:()=>s,_U:()=>p,lw:()=>i,nx:()=>o,vo:()=>h})},5870:(e,t,n)=>{n.d(t,{d:()=>a,e:()=>l});var i=n(608),r=n.n(i),o=n(7562),s=n(7970);class a{constructor(){this.map=new(r())}get(e,t){let n=this.map,i=n.get(e);return void 0===i?(i=t(),i.registerDisposer((()=>{n.delete(e)})),n.set(e,i)):i.addRef(),i}}class l extends a{get(e,t){return"string"!==typeof e&&(e=(0,s.stableStringify)(e)),super.get(e,t)}getUncounted(e,t){return this.get(e,(()=>new o.fL(t()))).value}}},8164:(e,t,n)=>{n.d(t,{Mf:()=>a,TU:()=>i});var i,r=n(281),o=n.n(r),s=n(6344);!function(e){e[e.info=0]="info",e[e.warning=1]="warning",e[e.error=2]="error"}(i||(i={}));class a{constructor(){this.changed=new s.IY,this.messages=[],this.children=[]}addMessage(e){this.messages.push(e),this.changed.dispatch()}clearMessages(){const e=this.messages;0!==e.length&&(e.length=0,this.changed.dispatch())}isEmpty(){return 0===this.messages.length&&!this.children.some((e=>!e.isEmpty()))}addChild(e){return this.children.push(e),e.changed.add(this.changed.dispatch),e.isEmpty()||this.changed.dispatch(),()=>{const t=this.children;t.splice(t.indexOf(e),1),e.changed.remove(this.changed.dispatch),e.isEmpty()||this.changed.dispatch()}}*[o()](){yield*this.messages;for(const e of this.children)yield*e}}},8774:(e,t,n)=>{n.d(t,{n5:()=>r.n5,qy:()=>o});var i=n(7562),r=n(8602);class o extends i.O8{constructor(e,t,n){super(),this.target=e,this.eventMap=t,this.registerEventListener(e,"wheel",(e=>{void 0!==n&&n(e),this.dispatch("wheel",e)})),this.registerEventListener(e,"click",(e=>{void 0!==n&&n(e),this.dispatch("click".concat(e.button),e)})),this.registerEventListener(e,"dblclick",(e=>{void 0!==n&&n(e),this.dispatch("dblclick".concat(e.button),e)})),this.registerEventListener(e,"mousedown",(e=>{void 0!==n&&n(e);let t=e.button;2===t&&1===(3&e.buttons)&&(t=0),this.dispatch("mousedown".concat(t),e)})),this.registerEventListener(e,"mouseup",(e=>{void 0!==n&&n(e),this.dispatch("mouseup".concat(e.button),e)}))}dispatch(e,t){(0,r.z3)(e,t,t,this.eventMap)}}},3234:(e,t,n)=>{function i(e,t,n){const i=e.view.document;let r=e.clientX,o=e.clientY;const s=e=>{const n=e.clientX-r,i=e.clientY-o;r=e.clientX,o=e.clientY,t(e,n,i)},a=e.button,l=e=>{i.removeEventListener("pointermove",s,!0),i.removeEventListener("pointerup",c,!1),void 0!==n&&n(e,e.clientX-r,e.clientY-o)},c=e=>{e.button===a&&l(e)};i.addEventListener("pointermove",s,!0),i.addEventListener("pointerup",c,!1),i.addEventListener("pointercancel",l,!1)}n.d(t,{i:()=>i})},1877:(e,t,n)=>{function i(e,t){let n="";for(let i=0;i<=t&&(n=e.toFixed(i),parseFloat(n)!==e);++i);return n}n.d(t,{I:()=>i})},2311:(e,t,n)=>{n.d(t,{R:()=>l});var i=n(984),r=n.n(i),o=n(9176);const s=n.n(o)()("objectId");let a=0;function l(e){if(e instanceof Object){let t=e[s];return void 0===t&&(t=e[s]=a++),"o".concat(t)}return""+r()(e)}},4035:(e,t,n)=>{function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;const t=Math.ceil(e/32),n=new Uint32Array(t);crypto.getRandomValues(n);let i="";for(let r=0;r<t;++r)i+=("00000000"+n[r].toString(16)).slice(-8);return i}function r(e){let t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(let n=0,i=t.length;n<i;n+=65536)crypto.getRandomValues(t.subarray(n,Math.min(i,n+65536)));return e}function o(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}n.d(t,{UY:()=>r,Yr:()=>i,z7:()=>o})},7882:(e,t,n)=>{n.d(t,{D2:()=>d,bj:()=>u,dW:()=>c});var i=n(2784),r=n(2959),o=n(2686),s=n(6256);class a extends i.uw{constructor(e){super(),this.bucket=e,this.get=(0,i.uO)((async()=>{var e;const t=this.bucket,n=await(0,o.Bk)("https://s3.amazonaws.com/".concat(t,"?location"),{},(e=>e.text())),i=(new DOMParser).parseFromString(n,"application/xml").querySelector("LocationConstraint");if(null===i)throw new Error("Unable to determine location of S3 bucket: ".concat(t));return{region:(null===(e=i.textContent)||void 0===e?void 0:e.trim())||"us-east-1"}}))}}let l;function c(e){return void 0===l&&(l=new i.qr,l.register("s3",(e=>new a(e)))),l.getCredentialsProvider("s3",e)}async function d(e,t,n,i,s){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:r.fx;const l=(await e.get()).credentials.region;return await(0,o.Bk)("https://".concat(t,".s3.").concat(l,".amazonaws.com").concat(n),i,s,a)}async function u(e,t,n){const i=c(e),r=(await i.get()).credentials.region;return await(0,s.X)(void 0,"s3://".concat(e),"https://".concat(e,".s3.").concat(r,".amazonaws.com"),t,n)}},6256:(e,t,n)=>{n.d(t,{X:()=>r});var i=n(8781);async function r(e,t,n,r,o){if(!r.startsWith("/"))throw null;const s=await async function(e,t,n,r,o){const s=await(0,i.Y)(e,"".concat(t,"?prefix=").concat(encodeURIComponent(n))+"&delimiter=".concat(encodeURIComponent(r)),{},(e=>e.text()),o),a=(new DOMParser).parseFromString(s,"application/xml"),l=a.evaluate('//*[name()="CommonPrefixes"]/*[name()="Prefix"]',a,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null),c=[];for(let i=0,u=l.snapshotLength;i<u;++i)c.push(l.snapshotItem(i).textContent||"");const d=a.evaluate('//*[name()="Contents"]/*[name()="Key"]',a,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(let i=0,u=d.snapshotLength;i<u;++i)c.push(d.snapshotItem(i).textContent||"");return c}(e,n,r.substring(1),"/",o);let a=r.lastIndexOf("/");return{offset:a+t.length+1,completions:s.map((e=>({value:e.substring(a)})))}}},2240:(e,t,n)=>{n.d(t,{CD:()=>b,Gh:()=>C,KQ:()=>m,NJ:()=>S,W7:()=>w,i_:()=>y,rh:()=>x});var i=n(984),r=n.n(i),o=n(8178),s=n.n(o),a=n(6392),l=n.n(a),c=n(6326),d=n.n(c),u=n(608),h=n.n(u),p=n(9735);const f=[{prefix:"Y",exponent:24},{prefix:"Z",exponent:21},{prefix:"E",exponent:18},{prefix:"P",exponent:15},{prefix:"T",exponent:12},{prefix:"G",exponent:9},{prefix:"M",exponent:6},{prefix:"k",exponent:3},{prefix:"",exponent:0},{prefix:"m",exponent:-3},{prefix:"\xb5",exponent:-6},{prefix:"n",exponent:-9},{prefix:"p",exponent:-12},{prefix:"f",exponent:-15},{prefix:"a",exponent:-18},{prefix:"z",exponent:-21},{prefix:"y",exponent:-24}],g=[{prefix:"c",exponent:-2},{prefix:"u",exponent:-6},...f],m=new(h());m.set("",{unit:"",exponent:0});const v=new(h());for(const k of g){const e=k.prefix,t=k.exponent;v.set(t,e);for(const n of["m","s","Hz","rad/s"])m.set("".concat(e).concat(n),{unit:n,exponent:t})}function y(e){const t=d()(e),n=f.length,i=(0,p.lX)(0,n,(e=>f[e].exponent<=t));return f[Math.min(i,n-1)]}function b(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i=n.precision;const r=void 0===i?6:i;var o=n.elide1;const s=void 0===o||o;let a,l=e,c="";if(""!==t){const t=y(e);c=t.prefix,l=C(e,-t.exponent)}if(s&&1===l)return{scale:"",unit:t,prefix:c};if(0!=r){a=l<1||l>=1e3?l.toPrecision(r):l.toFixed(r);const e=a.indexOf("e");let t,n;-1!==e?(t=a.substring(0,e),n=a.substring(e)):(t=a,n="");const i=t.match(/.*\.(?:[0-9]*[1-9])?(0+)$/);null!==i&&(t=t.substring(0,t.length-i[1].length),t.endsWith(".")&&(t=t.substring(0,t.length-1)),a=t+n)}else a=l.toString();return{scale:a,unit:t,prefix:c}}function S(e,t,n){var i=b(e,t,n);const r=i.scale,o=i.unit,s=i.prefix;return"".concat(r).concat(s).concat(o)}function w(e){if(""===e)return{scale:1,unit:""};const t=e.match(/^((?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)?([\xb5a-zA-Z]+)?$/);if(null===t)return;const n=t[1];let i=void 0===n?1:Number(n);if(l()(i))return;let r="";if(void 0!==t[2]){const e=m.get(t[2]);if(void 0===e)return;r=e.unit,e.exponent>0?i*=10**e.exponent:i/=10**-e.exponent}return i<=0||!s()(i)?void 0:{scale:i,unit:r}}function x(e){const t=m.get(e);if(void 0===t)throw new Error("Invalid unit: ".concat(r()(e)));return t}function C(e,t){return t>=0?e*10**t:e/10**-t}},6344:(e,t,n)=>{n.d(t,{$$:()=>a,HN:()=>o,IY:()=>s});var i=n(1274),r=n.n(i);class o{constructor(){this.handlers=new(r()),this.count=0;const e=this;this.dispatch=function(){++e.count,e.handlers.forEach((e=>{e.apply(this,arguments)}))}}add(e){return this.handlers.add(e),()=>this.remove(e)}remove(e){return this.handlers.delete(e)}dispose(){this.handlers=void 0}}class s extends o{}const a={count:0,add:e=>()=>{},remove:e=>!1}},3398:(e,t,n)=>{n.d(t,{G:()=>d,n:()=>c});var i=n(8781),r=n(2959),o=n(2686),s=n(7882);function a(e,t){return e.getCredentialsProvider("middleauthapp",new URL(t).origin)}function l(e,t,n){const i=n.match(/^\/([^\/]+)/);if(null!==i)return"undefined"!==typeof NEUROGLANCER_PYTHON_INTEGRATION?e.getCredentialsProvider("gcs",{bucket:i[1]}):e.getCredentialsProvider("ngauth_gcs",{authServer:t,bucket:i[1]})}function c(e,t){const n=(0,o.Dl)(e);switch(n.protocol){case"gs":case"gs+json":case"gs+xml":return{credentialsProvider:"undefined"!==typeof NEUROGLANCER_PYTHON_INTEGRATION?t.getCredentialsProvider("gcs",{bucket:n.host}):void 0,url:e};case"gs+ngauth+http":return{credentialsProvider:l(t,"http://".concat(n.host),n.path),url:"gs:/"+n.path};case"gs+ngauth+https":return{credentialsProvider:l(t,"https://".concat(n.host),n.path),url:"gs:/"+n.path};case"gs+xml+ngauth+http":return{credentialsProvider:l(t,"http://".concat(n.host),n.path),url:"gs+xml:/"+n.path};case"gs+xml+ngauth+https":return{credentialsProvider:l(t,"https://".concat(n.host),n.path),url:"gs+xml:/"+n.path};case"middleauth+https":return{credentialsProvider:a(t,e=e.substr(11)),url:e};case"s3":return{credentialsProvider:(0,s.dW)(n.host),url:e};default:return{credentialsProvider:void 0,url:e}}}async function d(e,t,n,a){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.fx;const c=(0,o.Dl)(t);switch(c.protocol){case"gs":return(0,i.Y)(e,"https://www.googleapis.com/storage/v1/b/".concat(c.host,"/o/")+"".concat(encodeURIComponent(c.path.substring(1)),"?alt=media&")+"neuroglancerOrigin=".concat(encodeURIComponent(location.origin)),n,a,l);case"gs+json":return(0,i.Y)(e,"https://storage.googleapis.com/storage/v1/b/".concat(c.host,"/o/").concat(encodeURIComponent(c.path.substring(1)),"?alt=media"),n,a,l);case"gs+xml":return(0,i.Y)(e,"https://storage.googleapis.com/".concat(c.host).concat(c.path),n,a,l);case"s3":return(0,s.D2)(e,c.host,c.path,n,a,l);default:return(0,i.Y)(e,t,n,a,l)}}},5553:(e,t,n)=>{function i(e,t){return e<t?-1:e>t?1:0}n.d(t,{e:()=>i})},233:(e,t,n)=>{n.d(t,{$s:()=>m,dp:()=>f,wX:()=>p});var i=n(2055),r=n.n(i),o=(n(3651),n(2982)),s=n(984),a=n.n(s),l=n(608),c=n.n(l),d=n(7562),u=n(7970),h=n(6344);function p(e,t,n){(0,u.verifyOptionalObjectProperty)(e,t,(e=>n.restoreState(e)))}class f extends d.O8{constructor(){super(...arguments),this.children=new(c()),this.changed=new h.IY}add(e,t){if(this.children.has(e))throw new Error("Key ".concat(a()(e)," already registered."));return this.children.set(e,t),t.changed.add(this.changed.dispatch),this.changed.dispatch(),()=>{this.remove(e)}}remove(e){const t=this.children;if(t.has(e))throw new Error("Key ".concat(a()(e)," not registered."));const n=t.get(e);this.children.delete(e),n.changed.remove(this.changed.dispatch),this.changed.dispatch()}disposed(){const e=this.changed;for(let t of this.children.values())t.changed.remove(e.dispatch);this.children=void 0,super.disposed()}toJSON(){const e=this.baseJSON();for(let n of this.children){var t=(0,o.A)(n,2);let i=t[0],r=t[1];e[i]=r.toJSON()}return e}baseJSON(){return{}}reset(){for(let e of this.children.values())e.reset()}restoreState(e){(0,u.verifyObject)(e);for(let i of this.children){var t=(0,o.A)(i,2);let r=t[0],s=t[1];try{if(e.hasOwnProperty(r)){const t=e[r];if(void 0===t)continue;s.restoreState(t)}}catch(n){throw new Error("Error restoring property ".concat(a()(r),": ").concat(n.message))}}}}const g=new(r());function m(e){let t=g.get(e);const n=e.changed.count;if(void 0!==t&&t.generation===n)return t;let i;if(e instanceof f){i=e.baseJSON();for(let t of e.children){var r=(0,o.A)(t,2);let e=r[0],n=r[1];i[e]=m(n).value}}else i=e.toJSON();return void 0===t?(t={generation:n,value:i},g.set(e,t)):(t.generation=n,t.value=i),t}},6429:(e,t,n)=>{n.d(t,{F:()=>o});var i=n(7970),r=n(6344);class o{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;this.enumType=e,this.value_=t,this.defaultValue=n,this.changed=new r.IY}set value(e){this.value_!==e&&(this.value_=e,this.changed.dispatch())}get value(){return this.value_}reset(){this.value=this.defaultValue}restoreState(e){this.value=(0,i.verifyEnumString)(e,this.enumType)}toJSON(){if(this.value_!==this.defaultValue)return this.enumType[this.value_].toLowerCase()}}},8194:(e,t,n)=>{n.r(t),n.d(t,{Uint64:()=>p});var i=n(984),r=n.n(i),o=n(8250),s=n.n(o),a=n(4117),l=n.n(a);const c=new Uint32Array(2),d=4294967296;let u=[];for(let f=2;f<=36;++f){let e=Math.floor(32/l()(f)),t=Math.pow(f,e),n="^[0-".concat(String.fromCharCode("0".charCodeAt(0)+Math.min(9,f-1)));f>10&&(n+="a-".concat(String.fromCharCode("a".charCodeAt(0)+f-11)),n+="A-".concat(String.fromCharCode("A".charCodeAt(0)+f-11)));let i=Math.ceil(64/l()(f));n+="]{1,".concat(i,"}$");let r=new RegExp(n);u[f]={lowDigits:e,lowBase:t,pattern:r}}function h(e,t){const n=65535&(e>>>=0),i=e>>>16,r=65535&(t>>>=0),o=t>>>16;let s=(n*r>>>16)+i*r,a=s>>>16;s=(65535&s)+n*o,a+=s>>>16;let l=a>>>16;return a=(65535&a)+i*o,l+=a>>>16,((65535&l)<<16|65535&a)>>>0}class p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.low=e,this.high=t}clone(){return new p(this.low,this.high)}assign(e){this.low=e.low,this.high=e.high}toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=this.low,n=this.high;if(0===n)return t.toString(e);n*=d;var i=u[e];let r=i.lowBase,o=i.lowDigits,s=n%r;n=Math.floor(n/r),t+=s,n+=Math.floor(t/r),t%=r;let a=t.toString(e);return n.toString(e)+"0".repeat(o-a.length)+a}static less(e,t){return e.high<t.high||e.high===t.high&&e.low<t.low}static compare(e,t){return e.high-t.high||e.low-t.low}static equal(e,t){return e.low===t.low&&e.high===t.high}static min(e,t){return p.less(e,t)?e:t}static max(e,t){return p.less(e,t)?t:e}static random(){return crypto.getRandomValues(c),new p(c[0],c[1])}tryParseString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;var n=u[t];const i=n.lowDigits,r=n.lowBase;if(!n.pattern.test(e))return!1;if(e.length<=i)return this.low=parseInt(e,t),this.high=0,!0;const o=e.length-i,a=parseInt(e.substr(o),t),l=parseInt(e.substr(0,o),t);let c,p;if(r===d)c=l,p=a;else{const e=s()(l,r)>>>0;c=h(l,r)+(s()(Math.floor(l/d),r)>>>0),p=a+e,p>=d&&(++c,p-=d)}return p>>>0===p&&c>>>0===c&&(this.low=p,this.high=c,!0)}parseString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!this.tryParseString(e,t))throw new Error("Failed to parse string as uint64 value: ".concat(r()(e),"."));return this}static parseString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(new p).parseString(e,t)}valid(){let e=this.low,t=this.high;return e>>>0===e&&t>>>0===t}toJSON(){return this.toString()}static lshift(e,t,n){const i=t.low,r=t.high;return 0===n?(e.low=i,e.high=r):n<32?(e.low=i<<n,e.high=r<<n|i>>>32-n):(e.low=0,e.high=i<<n-32),e}static rshift(e,t,n){const i=t.low,r=t.high;return 0===n?(e.low=i,e.high=r):n<32?(e.low=i>>>n|r<<32-n,e.high=r>>>n):(e.low=r>>>n-32,e.high=0),e}static or(e,t,n){return e.low=t.low|n.low,e.high=t.high|n.high,e}static xor(e,t,n){return e.low=t.low^n.low,e.high=t.high^n.high,e}static and(e,t,n){return e.low=t.low&n.low,e.high=t.high&n.high,e}static add(e,t,n){let i=t.low+n.low,r=t.high+n.high;const o=i>>>0;return o!==i&&(r+=1),e.low=o,e.high=r>>>0,e}static addUint32(e,t,n){let i=t.low+n,r=t.high;const o=i>>>0;return o!==i&&(r+=1),e.low=o,e.high=r>>>0,e}static decrement(e,t){let n=t.low,i=t.high;return 0===n&&(i-=1),e.low=n-1>>>0,e.high=i>>>0,e}static increment(e,t){let n=t.low,i=t.high;return 4294967295===n&&(i+=1),e.low=n+1>>>0,e.high=i>>>0,e}static subtract(e,t,n){let i=t.low-n.low,r=t.high-n.high;const o=i>>>0;return o!==i&&(r-=1),e.low=o,e.high=r>>>0,e}static absDifference(e,t,n){return p.less(t,n)?p.subtract(e,n,t):p.subtract(e,t,n)}static multiplyUint32(e,t,n){const i=t.low,r=t.high;return e.low=s()(i,n)>>>0,e.high=s()(r,n)+h(i,n)>>>0,e}static lowMask(e,t){return 0===t?e.high=e.low=0:t<=32?(e.high=0,e.low=4294967295>>>32-t):(e.high=4294967295>>>t-32,e.low=4294967295),e}toNumber(){return this.low+4294967296*this.high}setFromNumber(e){(e=Math.round(e))<0?this.low=this.high=0:e>=0x10000000000000000?this.low=this.high=4294967295:(this.low=e%4294967296,this.high=Math.floor(e/4294967296))}}p.ZERO=new p(0,0),p.ONE=new p(1,0)},9799:(e,t,n)=>{function i(e,t,n){const i=e.length;for(let r=0;r<i;++r)e[r]=t[r]+n[r];return e}function r(e,t,n){const i=e.length;for(let r=0;r<i;++r)e[r]=t[r]-n[r];return e}function o(e,t,n,i){const r=e.length;for(let o=0;o<r;++o)e[o]=t[o]+n[o]*i;return e}function s(e,t,n){const i=e.length;for(let r=0;r<i;++r)e[r]=t[r]*n;return e}function a(e){let t=1;for(let n=0,i=e.length;n<i;++n)t*=e[n];return t}function l(e,t,n){const i=e.length;for(let r=0;r<i;++r)e[r]=Math.min(t[r],n[r]);return e}n.d(t,{J:()=>d,Ln:()=>o,Re:()=>r,WQ:()=>i,_e:()=>a,hs:()=>s,jk:()=>l,qE:()=>c});const c=new Float32Array(0),d=new Float64Array(0);Float64Array.of(1,1,1)},1648:(e,t,n)=>{n.d(t,{g:()=>h});var i=n(7797),r=n.n(i),o=n(281),s=n.n(o),a=n(2982),l=n(608),c=n.n(l),d=n(7562),u=n(6344);class h extends d.O8{constructor(e,t){if(super(),this.register=e,this.changed=new u.IY,this.disposerMap=new(c()),void 0===t)this.map=new(c());else{const i=this.map=new(c())(t),r=this.disposerMap;for(const t of i){var n=(0,a.A)(t,2);const i=n[0],o=n[1],s=new d.O8;r.set(i,s),e(s,o,i)}}}get value(){return this.map}set(e,t){const n=this.map,i=this.disposerMap;let r=i.get(e);return void 0!==r&&r.dispose(),r=new d.O8,i.set(e,r),n.set(e,t),this.register(r,t,e),this.changed.dispatch(),this}delete(e){const t=this.map,n=this.disposerMap,i=n.get(e);return void 0!==i&&(i.dispose(),n.delete(e),t.delete(e),this.changed.dispatch(),!0)}get(e){return this.map.get(e)}has(e){return this.map.has(e)}get size(){return this.map.size}[s()](){return r()(this.map)}clear(){const e=this.map,t=this.disposerMap;if(e.size>0){for(const e of t.values())e.dispose();e.clear(),t.clear(),this.changed.dispatch()}}values(){return this.map.values()}keys(){return this.map.keys()}disposed(){const e=this.map,t=this.disposerMap;for(const n of t.values())n.dispose();e.clear(),t.clear(),super.disposed()}}},5103:(e,t,n)=>{n.d(t,{d:()=>s});const i=0,r=1,o=2;function s(e){let t=0;switch(e.deltaMode){case i:t=.005;break;case r:t=.1;break;case o:t=2}return Math.exp(e.deltaY*t)}},1259:(e,t,n)=>{n.d(t,{jM:()=>Ki,sw:()=>Ji});var i=n(3651),r=n.n(i),o=n(984),s=n.n(o),a=n(3732),l=n.n(a),c=n(4702),d=n.n(c),u=n(5016),h=n.n(u),p=n(6679),f=n.n(p),g=n(5491),m=n.n(g),v=n(5795),y=n(8332),b=n(9285),S=n(1190),w=n.n(S),x=n(2982),C=n(1274),k=n.n(C),E=n(608),T=n.n(E);function L(e,t){return n=>{n.style.flex=e,t(n)}}function P(e,t){return n=>{n.style.display="flex",n.style.flexDirection=e;for(let e of t){let t=n.ownerDocument.createElement("div");n.appendChild(t),e(t)}}}var D=n(201),M=n(7562),I=n(3835),R=n(9981),A=n(8167);const O=I.pB.create();function N(e,t){const n=I.pB.identity(O),i=e.globalPosition;var r=e.displayDimensionRenderInfo;const o=r.canonicalVoxelFactors,s=r.displayDimensionIndices;for(let a=0;a<3;++a){const e=s[a];n[12+a]=-1===e?0:i[e],n[5*a]=t/o[a]}return I.pB.multiply(n,e.viewProjectionMat,n),n}class _ extends M.O8{constructor(e){super(),this.gl=e,this.vertexBuffer=this.registerDisposer(R.h.fromData(e,new Float32Array([0,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1]),e.ARRAY_BUFFER,e.STATIC_DRAW));let t=.5;this.colorBuffer=this.registerDisposer(R.h.fromData(e,new Float32Array([1,0,0,t,1,0,0,t,0,1,0,t,0,1,0,t,0,0,1,t,0,0,1,t]),e.ARRAY_BUFFER,e.STATIC_DRAW)),this.trivialColorShader=this.registerDisposer((0,A.gP)(e))}static get(e){return e.memoize.get("SliceViewPanel:AxesLineHelper",(()=>new _(e)))}draw(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.trivialColorShader,i=this.gl;n.bind(),i.uniformMatrix4fv(n.uniform("uProjectionMatrix"),!1,e);let r=n.attribute("aVertexPosition");this.vertexBuffer.bindToVertexAttrib(r,4);let o=n.attribute("aColor");this.colorBuffer.bindToVertexAttrib(o,4),t&&(i.colorMask(!1,!1,!1,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.colorMask(!0,!0,!0,!0),i.enable(i.BLEND),i.blendFunc(i.ONE_MINUS_DST_ALPHA,i.DST_ALPHA)),i.lineWidth(1),i.drawArrays(i.LINES,0,6),t&&i.disable(i.BLEND),i.disableVertexAttribArray(r),i.disableVertexAttribArray(o)}}var V=n(1434),B=n(2858);var F=n(6560),U=n(5603),z=n(2108);class j{constructor(){this.renderLayers=[null],this.pickData=[null],this.values=[0,0,0],this.nextPickID=1}clear(){this.renderLayers.length=1,this.pickData.length=1,this.values.length=3,this.nextPickID=1}registerUint64(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this.register(e,n,t.low,t.high,i)}register(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=this.renderLayers,s=this.values,a=this.nextPickID;this.nextPickID+=t;let l=o.length;o[l]=e;let c=3*l;return s[c]=a,s[c+1]=n,s[c+2]=i,this.pickData[l]=r,a}setMouseState(e,t){const n=this.renderLayers,i=this.values;let r=0,o=n.length-1;for(;r<o;){const e=Math.ceil(r+(o-r)/2);i[3*e]>t?o=e-1:r=e}const s=e.pickedRenderLayer=n[r],a=3*r,l=e.pickedOffset=t-i[a];let c=e.pickedValue;c.low=i[a+1],c.high=i[a+2],e.pickedAnnotationId=void 0,e.pickedAnnotationLayer=void 0,e.pickedAnnotationBuffer=void 0,e.pickedAnnotationBufferBaseOffset=void 0,e.pickedAnnotationIndex=void 0,e.pickedAnnotationCount=void 0,e.pickedAnnotationType=void 0;const d=this.pickData[r];null!==s&&s.updateMouseState(e,c,l,d)}}var G=n(3985),W=n(6740),H=n(8602),q=n(1058),Y=n(2729),J=n(8774),K=n(3234),X=n(492),Z=n.n(X);const Q=Math.PI/20;function $(e,t){return Math.sqrt(e*e+t*t)}function ee(e){var t=(0,x.A)(e,2);let n=t[0],i=t[1];if(n.identifier>i.identifier){var r=[n,i];i=r[0],n=r[1]}const o=n.clientX-i.clientX,s=n.clientY-i.clientY;return{distance:$(o,s),angle:Math.atan2(o,s)}}class te extends M.O8{constructor(e,t){super(),this.target=e,this.eventMap=t,this.prevTouches=new(T()),this.moved=!1,this.prevAngle=0,this.rotated=!1,this.prevDistance=0,this.pinched=!1,this.prevCenterX=0,this.prevCenterY=0,this.translated=!1,this.startHold=this.registerCancellable(Z()(((e,t,n,i)=>{const r={event:e,centerX:n,centerY:i};this.dispatch("touchhold".concat(e.targetTouches.length),e,r,t)}),1e3,{leading:!1,trailing:!0})),this.numPriorTaps=0,this.priorTapNumTouches=0,this.tapStartTime=0,this.tapEndTime=0,this.curTapNumTouches=0,this.registerEventListener(e,"touchstart",(e=>{this.handleTouchEvent(e)})),this.registerEventListener(e,"touchmove",(e=>{this.handleTouchEvent(e)})),this.registerEventListener(e,"touchend",(e=>{this.handleTouchEvent(e)}))}dispatch(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.eventPhase;(0,H.Pt)(e,t,i,n,this.eventMap)}handleTouchEvent(e){if(e.target!==this.target)return;e.preventDefault();const t=new(T()),n=this.prevTouches,i=this.prevEvent;let r=0,o=0;for(const f of e.targetTouches)t.set(f.identifier,f),r+=f.clientX,o+=f.clientY;r/=t.size,o/=t.size;for(const f of n.entries()){var s=(0,x.A)(f,2);const e=s[0],i=s[1],r=t.get(e);if(void 0===r)n.delete(e);else{const e=r.clientX-i.clientX,t=r.clientY-i.clientY;(Math.abs(e)>=10||Math.abs(t)>=10)&&(this.moved=!0)}}if(void 0===i||i.targetTouches.length!==t.size||0==t.size){if(this.moved=!1,"touchstart"===e.type)this.startHold(e,e.eventPhase,r,o),void 0!==i&&0!==i.targetTouches.length||(this.tapStartTime=Date.now(),this.curTapNumTouches=0),this.curTapNumTouches=Math.max(this.curTapNumTouches,e.targetTouches.length);else{if("touchend"==e.type){const t=Date.now();if(0===e.targetTouches.length&&t-this.tapStartTime<400){(this.curTapNumTouches!==this.priorTapNumTouches||t-this.tapEndTime>=500)&&(this.numPriorTaps=0),++this.numPriorTaps,this.tapEndTime=t,this.priorTapNumTouches=this.curTapNumTouches;const n={event:e,centerX:r,centerY:o};this.dispatch("touchtap".concat(this.curTapNumTouches,"x").concat(this.numPriorTaps),e,n)}}this.startHold.cancel()}if(this.prevTouches=t,this.prevEvent=e,this.prevCenterX=r,this.prevCenterY=o,this.translated=!1,2===t.size){var a=ee(t.values());const e=a.distance,n=a.angle;this.prevDistance=e,this.prevAngle=n,this.rotated=!1,this.pinched=!1}return}if(!this.moved)return;this.tapStartTime=0,this.startHold.cancel(),this.prevTouches=t,this.prevEvent=e;let l=this.prevCenterX,c=this.prevCenterY,d=this.translated;const u=r-l,h=o-c;if(!1===d&&$(u,h)>=10&&(d=this.translated=!0),!0===d&&(0!==u||0!==h)){this.prevCenterX=r,this.prevCenterY=o;const n={event:e,deltaX:u,deltaY:h,centerX:r,centerY:o};this.dispatch("touchtranslate".concat(t.size),e,n)}if(2===t.size){var p=ee(t.values());const n=p.distance,i=p.angle;let s=this.pinched,a=this.rotated,l=this.prevDistance,c=this.prevAngle;!1===s&&Math.abs(n-l)>=20&&(this.pinched=s=!0);const d=function(e,t){const n=2*Math.PI,i=Math.abs(e-t)%n;return Math.min(i,n-i)}(i,c);if(!1===a&&d>=Q&&(this.rotated=a=!0),!0===s&&n!=l){this.prevDistance=n;const t={event:e,distance:n,prevDistance:l,centerX:r,centerY:o};this.dispatch("touchpinch",e,t)}!0===a&&i!==c&&(this.prevAngle=i,this.dispatch("touchrotate",e,{event:e,centerX:r,centerY:o,angle:i,prevAngle:c}))}}}var ne=n(5103);const ie=I.eR.create();class re{constructor(){this.pickIDs=new j,this.viewportWidth=0,this.viewportHeight=0,this.invTransform=I.pB.create(),this.frameNumber=-1}}class oe{constructor(){this.buffer=null,this.glWindowX=0,this.glWindowY=0}}const se=11,ae=(()=>{const e=(e,t)=>(e-5)**2+(t-5)**2;let t=new Uint32Array(121),n=0;for(let i=0;i<se;++i)for(let r=0;r<se;++r)e(i,r)>25||(t[n++]=r*se+i);return t=t.subarray(0,n),t.sort(((t,n)=>{const i=t%se,r=n%se,o=(n-r)/se;return e(i,(t-i)/se)-e(r,o)})),t})();function le(e,t,n,i,r,o,s){const a=i-5,l=r-5;if(!(a>=0&&l>=0&&a+se<=o&&l+se<=s))for(let c=0;c<se;++c)for(let i=0;i<se;++i){const r=a+i,d=l+c;(r<0||d<0||r>=o||d>=s)&&(e[t+(d*se+r)*n]=0)}}class ce extends V.yD{constructor(e,t,n){super(e,t,n.visibility),this.viewer=n,this.mouseX=-1,this.mouseY=-1,this.pickRequestPending=!1,this.mouseStateForcer=()=>this.blockOnPickRequest(),this.pickingData=[new re,new re],this.pickRequests=[new oe,new oe],this.pickBufferContents=new Float32Array(968),this.pickTimerId=-1,this.nextPickRequestTime=0,this.pendingPickRequestTimerId=-1,this.pendingPickRequestTimerExpired=()=>{this.pendingPickRequestTimerId=-1,this.pickRequestPending&&this.attemptToIssuePickRequest()},this.inputEventMap=n.inputEventMap,t.classList.add("neuroglancer-rendered-data-panel"),t.classList.add("neuroglancer-panel"),t.classList.add("neuroglancer-noselect"),"undefined"!==typeof NEUROGLANCER_SHOW_OBJECT_SELECTION_TOOLTIP&&!0===NEUROGLANCER_SHOW_OBJECT_SELECTION_TOOLTIP&&(t.title="Double click to toggle display of object under mouse pointer.  Control+rightclick to pin/unpin selection."),this.registerDisposer(new W.j(t)),this.registerDisposer(new q.cL(t,this.inputEventMap)),this.registerDisposer(new J.qy(t,this.inputEventMap,(e=>{this.onMousemove(e)}))),this.registerDisposer(new te(t,this.inputEventMap)),this.registerEventListener(t,"mousemove",this.onMousemove.bind(this)),this.registerEventListener(t,"touchstart",this.onTouchstart.bind(this)),this.registerEventListener(t,"mouseleave",(()=>this.onMouseout())),this.registerEventListener(t,"mouseover",(e=>{e.target!==t&&this.onMouseout()}),!0),(0,H.qZ)(t,"select-position",(()=>{this.viewer.selectionDetailsState.select(!1)})),(0,H.qZ)(t,"snap",(()=>{this.navigationState.pose.snap()})),(0,H.qZ)(t,"zoom-in",(()=>{this.navigationState.zoomBy(.5)})),(0,H.qZ)(t,"zoom-out",(()=>{this.navigationState.zoomBy(2)})),(0,H.qZ)(t,"depth-range-decrease",(()=>{this.navigationState.depthRange.value*=.5})),(0,H.qZ)(t,"depth-range-increase",(()=>{this.navigationState.depthRange.value*=2}));for(let i=0;i<3;++i){let e=I.p9[i];for(let n of[-1,1]){let r=n<0?"-":"+";(0,H.qZ)(t,"rotate-relative-".concat(e).concat(r),(()=>{this.navigationState.pose.rotateRelative(I.T2[i],.1*n)}));let o=I.eR.create();(0,H.qZ)(t,"".concat(e).concat(r),(()=>{let e=this.navigationState,t=o;t[0]=0,t[1]=0,t[2]=0,t[i]=n,e.pose.translateVoxelsRelative(t,!0)}))}}(0,H.qZ)(t,"zoom-via-wheel",(e=>{const t=e.detail;this.onMousemove(t,!1),this.zoomByMouse((0,ne.d)(t))})),(0,H.qZ)(t,"adjust-depth-range-via-wheel",(e=>{const t=e.detail;this.navigationState.depthRange.value*=(0,ne.d)(t)})),(0,H.qZ)(t,"translate-via-mouse-drag",(e=>{(0,K.i)(e.detail,((e,t,n)=>{this.translateByViewportPixels(t,n)}))})),(0,H.qZ)(t,"translate-in-plane-via-touchtranslate",(e=>{const t=e.detail;this.translateByViewportPixels(t.deltaX,t.deltaY)})),(0,H.qZ)(t,"translate-z-via-touchtranslate",(e=>{const t=e.detail;let n=this.navigationState,i=ie;i[0]=0,i[1]=0,i[2]=t.deltaY+t.deltaX,n.pose.translateVoxelsRelative(i,!0)}));for(const i of[1,10])(0,H.qZ)(t,"z+".concat(i,"-via-wheel"),(e=>{const t=e.detail;let n=this.navigationState,r=ie,o=0!==t.deltaY?t.deltaY:t.deltaX;r[0]=0,r[1]=0,r[2]=(o>0?-1:1)*i,n.pose.translateVoxelsRelative(r,!0)}));(0,H.qZ)(t,"move-to-mouse-position",(()=>{const e=this.viewer.mouseState;e.updateUnconditionally()&&(this.navigationState.position.value=e.position)})),(0,H.qZ)(t,"snap",(()=>this.navigationState.pose.snap())),(0,H.qZ)(t,"move-annotation",(e=>{const t=this.viewer.mouseState,n=t.pickedAnnotationId,i=t.pickedAnnotationLayer;if(void 0!==i&&void 0!==n){e.stopPropagation();let r=i.source.getReference(n),o=r.value;const s=(0,z.Ag)(o.type),a=t.pickedOffset,l=i.chunkTransform.value;if(void 0!==l.error)return;const c=l.layerRank,d=new Float32Array(c);s.getRepresentativePoint(d,o,t.pickedOffset);let u=I.Zc.set(I.Zc.create(),0,0);t.updateUnconditionally()&&(0,K.i)(e.detail,((e,t,n)=>{I.Zc.add(u,u,[t,n]);const h=new Float32Array(c);Y.vo(h,l.chunkToLayerTransform,c+1,d,c);const p=ie,f=this.navigationState.pose.displayDimensions.value.displayDimensionIndices;(0,G.iz)(p,h,l.modelTransform,f),this.translateDataPointByViewportPixels(p,p,u[0],u[1]),(0,G.IB)(h,p,l.modelTransform,f);const g=new Float32Array(c);Y.vo(g,l.layerToChunkTransform,c+1,h,c);let m=s.updateViaRepresentativePoint(o,g,a);i.source.update(r,m)}),(e=>{i.source.commit(r),r.dispose()}))}})),(0,H.qZ)(t,"delete-annotation",(()=>{const e=this.viewer.mouseState,t=e.pickedAnnotationId,n=e.pickedAnnotationLayer;if(void 0!==n&&!n.source.readonly&&void 0!==t){const e=n.source.getReference(t);try{n.source.delete(e)}finally{e.dispose()}}})),(0,H.qZ)(t,"zoom-via-touchpinch",(e=>{const t=e.detail;this.handleMouseMove(t.centerX,t.centerY);const n=t.prevDistance/t.distance;n>.1&&n<10&&this.zoomByMouse(n)}))}cancelPickRequests(){const e=this.gl;for(const t of this.pickRequests){const n=t.sync;null!==n&&e.deleteSync(n),t.sync=null}clearTimeout(this.pickTimerId),this.pickTimerId=-1}issuePickRequestInternal(e){const t=this.gl;let n=e.buffer;null===n?(n=e.buffer=t.createBuffer(),t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,n),t.bufferData(WebGL2RenderingContext.PIXEL_PACK_BUFFER,3872,WebGL2RenderingContext.STREAM_READ)):t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,n);const i=this.renderViewport;let r=this.mouseX-i.visibleLeftFraction*i.logicalWidth,o=i.height-(this.mouseY-i.visibleTopFraction*i.logicalHeight);this.issuePickRequest(r,o),e.sync=t.fenceSync(WebGL2RenderingContext.SYNC_GPU_COMMANDS_COMPLETE,0),e.frameNumber=this.context.frameNumber,e.glWindowX=r,e.glWindowY=o,t.flush(),t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,null),-1===this.pickTimerId&&this.scheduleCheckForPickRequestCompletion(),this.pickRequestPending=!1;const s=this.pickRequests;e!==s[0]&&(s[1]=s[0],s[0]=e),this.nextPickRequestTime=Date.now()+30}completePickInternal(e){const t=this.gl,n=this.pickBufferContents;t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,e.buffer),t.getBufferSubData(WebGL2RenderingContext.PIXEL_PACK_BUFFER,0,n),t.bindBuffer(WebGL2RenderingContext.PIXEL_PACK_BUFFER,null);const i=this.pickingData,r=e.frameNumber;this.completePickRequest(e.glWindowX,e.glWindowY,n,i[0].frameNumber===r?i[0]:i[1])}scheduleCheckForPickRequestCompletion(){this.pickTimerId=window.setTimeout((()=>{this.pickTimerId=-1,this.checkForPickRequestCompletion()}),0)}checkForPickRequestCompletion(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.context.frameNumber,i=-1;e&&(--n,i=n-1);const r=this.pickRequests,o=this.gl;let s,a=!1,l=!1;for(const d of r){const e=d.sync;if(null===e)continue;const r=d.frameNumber;if(!l&&r>=n-1)if(t||o.getSyncParameter(e,WebGL2RenderingContext.SYNC_STATUS)===WebGL2RenderingContext.SIGNALED)this.completePickInternal(d),l=!0;else if(r!==i){a=!0;continue}o.deleteSync(e),d.sync=null,s=d}const c=this.pickTimerId;a&&-1===c?this.scheduleCheckForPickRequestCompletion():a||-1===c||(window.clearTimeout(c),this.pickTimerId=-1),!e&&void 0!==s&&this.pickRequestPending&&this.canIssuePickRequest()&&this.issuePickRequestInternal(s)}blockOnPickRequest(){this.pickRequestPending&&(this.cancelPickRequests(),this.nextPickRequestTime=0,this.attemptToIssuePickRequest()),this.checkForPickRequestCompletion(!1,!0)}draw(){var e=this.renderViewport;const t=e.width,n=e.height;this.checkForPickRequestCompletion(!0);const i=this.pickingData;i[0]=i[1];const r=this.context.frameNumber,o=i[1];o.frameNumber=r,o.viewportWidth=t,o.viewportHeight=n,o.pickIDs.clear(),this.drawWithPicking(o)?(this.nextPickRequestTime=0,this.mouseX>=0&&this.attemptToIssuePickRequest()):o.frameNumber=-1}canIssuePickRequest(){const e=Date.now(),t=this.nextPickRequestTime,n=this.pendingPickRequestTimerId;return!(e<t)||(-1==n&&(this.pendingPickRequestTimerId=window.setTimeout(this.pendingPickRequestTimerExpired,t-e)),!1)}attemptToIssuePickRequest(){if(!this.canIssuePickRequest())return;const e=this.context.frameNumber,t=this.gl,n=this.pickRequests;for(const i of n){let n=i.sync;if(null!==n){if(!(i.frameNumber<e-1))continue;t.deleteSync(n)}return void this.issuePickRequestInternal(i)}}updateMousePosition(e,t){if(e===this.mouseX&&t===this.mouseY)return;if(this.mouseX=e,this.mouseY=t,e<0)return this.pickRequestPending=!1,void this.cancelPickRequests();const n=this.context.frameNumber,i=this.pickingData[1];i.frameNumber===n&&this.renderViewport.width===i.viewportWidth&&this.renderViewport.height===i.viewportHeight&&(this.pickRequestPending=!0,this.attemptToIssuePickRequest())}onMouseout(){this.updateMousePosition(-1,-1),this.viewer.mouseState.setForcer(void 0)}handleMouseMove(e,t){const n=this.element,i=n.getBoundingClientRect(),r=e-(i.left+n.clientLeft),o=t-(i.top+n.clientTop),s=this.viewer.mouseState;s.pageX=e+window.scrollX,s.pageY=t+window.scrollY,s.setForcer(this.mouseStateForcer),this.updateMousePosition(r,o)}onMousemove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.element;t&&e.target!==n||this.handleMouseMove(e.clientX,e.clientY)}onTouchstart(e){let t=this.element;if(e.target!==t||1!==e.targetTouches.length)return;var n=e.targetTouches[0];const i=n.clientX,r=n.clientY;this.handleMouseMove(i,r)}disposed(){this.viewer.mouseState.removeForcer(this.mouseStateForcer);const e=this.gl;this.cancelPickRequests();const t=this.pendingPickRequestTimerId;-1!==t&&window.clearTimeout(t);for(const n of this.pickRequests)e.deleteBuffer(n.buffer);super.disposed()}}var de=n(3056),ue=n(6874),he=n(7965),pe=n(1648),fe=n(843),ge=n(706),me=n(6326),ve=n.n(me),ye=n(7160),be=n(7970),Se=n(2240),we=n(8336);const xe=[1.5,2,3,5,7.5,10];class Ce{constructor(){this.allowedSignificands=xe,this.targetLengthInPixels=0,this.physicalSizePerPixel=0,this.prevPhysicalSizePerPixel=0,this.prevTargetLengthInPixels=0,this.prevPhysicalUnit="\0"}update(){let e=this.physicalSizePerPixel,t=this.targetLengthInPixels;if(this.prevPhysicalSizePerPixel===e&&this.prevTargetLengthInPixels===t&&this.prevPhysicalUnit===this.physicalUnit)return!1;this.prevPhysicalSizePerPixel=e,this.prevTargetLengthInPixels=t,this.prevPhysicalUnit=this.physicalUnit;const n=t*e,i=Math.floor(ve()(n)),r=10**i,o=n/r;let s=1;for(let c of this.allowedSignificands){if(!(Math.abs(c-o)<Math.abs(s-o)))break;s=c}const a=s*r,l=(0,Se.i_)(a);return this.lengthInPixels=Math.round(a/e),this.physicalUnit="".concat(l.prefix).concat(this.physicalBaseUnit),this.physicalLength=s*10**(i-l.exponent),!0}}class ke extends M.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ce;super(),this.gl=e,this.dimensions=t,this.texture=null,this.width=0,this.height=0,this.label="",this.factor=1,this.priorOptions=void 0,this.prevLabel=""}update(e){const t=this.dimensions,n=this.label;let i=this.texture;if(!t.update()&&null!==i&&e===this.priorOptions&&n==this.prevLabel)return;null===i&&(i=this.texture=this.gl.createTexture());var r=function(e,t,n,i,r){const o=document.createElement("canvas"),s=o.getContext("2d"),a=r.textHeightInPixels*r.scaleFactor,l="bold ".concat(a,"px ").concat(r.fontName);s.font=l,s.fillStyle="white";const c="".concat(i).concat(e.physicalLength," ").concat(e.physicalUnit),d=s.measureText(c),u=Math.max(e.lengthInPixels,d.width),h=r.barHeightInPixels*r.scaleFactor,p=r.barTopMarginInPixels*r.scaleFactor,f=h+p+a,g=r.paddingInPixels*r.scaleFactor,m=f+2*g,v=u+2*g;return o.width=v,o.height=m,s.font=l,s.textAlign="center",s.fillStyle="rgba(0, 0, 0, 0.3)",s.fillRect(0,0,v,m),s.fillStyle="white",s.fillText(c,v/2,m-g-h-p),s.fillRect(g,m-g-h,e.lengthInPixels,h),(0,we.uN)(t,n,o),{width:v,height:m}}(t,this.gl,i,n,e);const o=r.width,s=r.height;this.priorOptions=e,this.prevLabel=n,this.width=o,this.height=s}disposed(){this.gl.deleteTexture(this.texture),this.texture=null,super.disposed()}}class Ee extends M.O8{constructor(e){super(),this.gl=e,this.scaleBarCopyHelper=this.registerDisposer(ge.DG.get(this.gl)),this.scaleBars=[];for(let t=0;t<3;++t)this.scaleBars.push(this.registerDisposer(new ke(e)))}draw(e,t,n,i,r){const o=this.scaleBars,s=t.displayRank,a=t.displayDimensionIndices,l=t.canonicalVoxelFactors,c=t.globalDimensionNames,d=t.displayDimensionUnits,u=t.displayDimensionScales,h=n.factors,p=Math.min(r.maxWidthFraction*e.logicalWidth,r.maxWidthInPixels*r.scaleFactor);let f=0;for(let y=0;y<s;++y){const e=a[y],t=d[y],n=h[e];let r,s,g;for(r=0;r<f&&(s=o[r],g=s.dimensions,g.physicalBaseUnit!==t||s.factor!==n);++r);r===f&&(++f,s=o[r],s.label="",g=s.dimensions,s.factor=n,g.physicalBaseUnit=t,g.targetLengthInPixels=p,g.physicalSizePerPixel=u[y]*i/l[y]),s.label+="".concat(c[e]," ")}const g=this.gl,m=this.scaleBarCopyHelper;let v=r.bottomPixelOffset*r.scaleFactor;for(let y=f-1;y>=0;--y){const t=o[y];1===f?t.label="":t.label+=": ",t.update(r),g.viewport(r.leftPixelOffset*r.scaleFactor-e.visibleLeftFraction*e.logicalWidth,v-(1-(e.visibleTopFraction+e.visibleHeightFraction))*e.logicalHeight,t.width,t.height),m.draw(t.texture),v+=t.height+r.marginPixelsBetweenScaleBars*r.scaleFactor}}}const Te=r()(r()({},{scaleFactor:1,textHeightInPixels:15,barHeightInPixels:8,barTopMarginInPixels:5,fontName:"sans-serif",paddingInPixels:2}),{maxWidthInPixels:100,maxWidthFraction:.25,leftPixelOffset:10,bottomPixelOffset:10,marginPixelsBetweenScaleBars:5});function Le(e){const t=r()({},Te);for(const n of["textHeightInPixels","barTopMarginInPixels","barHeightInPixels","paddingInPixels","scaleFactor","maxWidthInPixels","maxWidthFraction","leftPixelOffset","bottomPixelOffset"])(0,be.verifyObjectProperty)(e,n,(e=>{void 0!==e&&(t[n]=(0,be.verifyFloat)(e))}));return(0,be.verifyObjectProperty)(e,"fontName",(e=>{void 0!==e&&(t.fontName=(0,be.verifyString)(e))})),t}class Pe extends ye.DN{constructor(){super(Te,Le)}}var De,Me=n(7799);!function(e){e[e.COLOR=0]="COLOR",e[e.Z=1]="Z",e[e.PICK=2]="PICK",e[e.NUM_TEXTURES=3]="NUM_TEXTURES"}(De||(De={}));const Ie=["\nfloat computeOITWeight(float alpha) {\n  float a = min(1.0, alpha) * 8.0 + 0.01;\n  float b = -gl_FragCoord.z * 0.95 + 1.0;\n  return a * a * a * b * b * b;\n}\n","\nvoid emit(vec4 color, highp uint pickId) {\n  float weight = computeOITWeight(color.a);\n  vec4 accum = color * weight;\n  v4f_fragData0 = vec4(accum.rgb, color.a);\n  v4f_fragData1 = vec4(accum.a, 0.0, 0.0, 0.0);\n}\n"];function Re(e){e.addOutputBuffer("vec4","out_color",De.COLOR),e.addOutputBuffer("highp vec4","out_z",De.Z),e.addOutputBuffer("highp vec4","out_pickId",De.PICK),e.addFragmentCode("\nvoid emit(vec4 color, highp uint pickId) {\n  out_color = color;\n  float zValue = 1.0 - gl_FragCoord.z;\n  out_z = vec4(zValue, zValue, zValue, 1.0);\n  float pickIdFloat = float(pickId);\n  out_pickId = vec4(pickIdFloat, pickIdFloat, pickIdFloat, 1.0);\n}\n")}function Ae(e){e.addOutputBuffer("vec4","v4f_fragData0",0),e.addOutputBuffer("vec4","v4f_fragData1",1),e.addFragmentCode(Ie)}const Oe=I.eR.create(),Ne=I.ln.create(),_e=I.pB.create();function Ve(e){e.addOutputBuffer("vec4","v4f_fragColor",null),e.setFragmentMain("\nvec4 v0 = getValue0();\nvec4 v1 = getValue1();\nvec4 accum = vec4(v0.rgb, v1.r);\nfloat revealage = v0.a;\n\nv4f_fragColor = vec4(accum.rgb / accum.a, revealage);\n")}const Be=(0,fe.Mz)(Me.T6);class Fe extends Be{constructor(e){super(),this.panel=e}initializeCounterpart(e,t){this.sharedProjectionParameters=this.registerDisposer(new de.jL(e,this.panel.projectionParameters)),t.projectionParameters=this.sharedProjectionParameters.rpcId,super.initializeCounterpart(e,t)}}class Ue extends ce{constructor(e,t,n){super(e,t,n),this.sliceViews=this.registerDisposer(new pe.g(((e,t,n)=>{e.registerDisposer(n),e.registerDisposer(n.visibility.add(this.visibility))}))),this.axesLineHelper=this.registerDisposer(_.get(this.gl)),this.sliceViewRenderHelper=this.registerDisposer(ue.wb.get(this.gl,Re)),this.offscreenFramebuffer=this.registerDisposer(new ge.Mi(this.gl,{colorBuffers:[new ge.iB(this.gl,WebGL2RenderingContext.RGBA8,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.UNSIGNED_BYTE),new ge.iB(this.gl,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RED,WebGL2RenderingContext.FLOAT),new ge.iB(this.gl,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RED,WebGL2RenderingContext.FLOAT)],depthBuffer:new ge.oL(this.gl)})),this.offscreenCopyHelper=this.registerDisposer(ge.DG.get(this.gl)),this.transparencyCopyHelper=this.registerDisposer(ge.DG.get(this.gl,Ve,2)),this.scaleBars=this.registerDisposer(new Ee(this.gl)),this.projectionParameters=this.registerDisposer(new de.tT({navigationState:this.navigationState,update:(e,t)=>{const n=e.invViewMatrix,i=e.projectionMat,r=e.logicalWidth/e.logicalHeight,o=Math.PI/4;let s=t.relativeDepthRange;let a=t.zoomFactor.value/2;if(this.viewer.orthographicProjection.value){const e=Math.max(.1,1-s),t=1+s;I.pB.ortho(i,-r,r,-1,1,e,t)}else{const e=1/Math.tan(o/2);s/=e;const t=Math.max(.1,1-s),n=1+s;a*=e,I.pB.perspective(i,o,r,t,n)}(0,V.sD)(e,i),t.pose.toMat4(n,a),I.pB.scale(n,n,I.eR.set(Oe,1,-1,-1)),I.pB.translate(n,n,I.T2[2]),(0,U.wO)(e)}})),this.projectionParameters.changed.add((()=>this.context.scheduleRedraw()));const i=this.sharedObject=this.registerDisposer(new Fe(this));if(i.RPC_TYPE_ID="perspective_view/PerspectiveView",i.initializeCounterpart(n.rpc,{}),i.visibility.add(this.visibility),this.visibleLayerTracker=(0,B.du)(this.viewer.layerManager,F.r,this.viewer.visibleLayerRoles,this),(0,H.qZ)(t,"rotate-via-mouse-drag",(e=>{(0,K.i)(e.detail,((e,t,n)=>{this.navigationState.pose.rotateRelative(I.T2[1],t/4*Math.PI/180),this.navigationState.pose.rotateRelative(I.T2[0],-n/4*Math.PI/180)}))})),(0,H.qZ)(t,"rotate-in-plane-via-touchrotate",(e=>{const t=e.detail;this.navigationState.pose.rotateRelative(I.T2[2],t.angle-t.prevAngle)})),(0,H.qZ)(t,"rotate-out-of-plane-via-touchtranslate",(e=>{const t=e.detail;this.navigationState.pose.rotateRelative(I.T2[1],t.deltaX/4*Math.PI/180),this.navigationState.pose.rotateRelative(I.T2[0],-t.deltaY/4*Math.PI/180)})),n.showSliceViewsCheckbox){let e=this.registerDisposer(new he.Fo(n.showSliceViews));e.element.className="perspective-panel-show-slice-views neuroglancer-noselect";let t=document.createElement("label");t.className="perspective-panel-show-slice-views neuroglancer-noselect",t.appendChild(document.createTextNode("Sections")),t.appendChild(e.element),this.element.appendChild(t)}this.registerDisposer(n.orthographicProjection.changed.add((()=>{this.projectionParameters.update(),this.scheduleRedraw()}))),this.registerDisposer(n.showScaleBar.changed.add((()=>this.scheduleRedraw()))),this.registerDisposer(n.scaleBarOptions.changed.add((()=>this.scheduleRedraw()))),this.registerDisposer(n.showSliceViews.changed.add((()=>this.scheduleRedraw()))),this.registerDisposer(n.showAxisLines.changed.add((()=>this.scheduleRedraw()))),this.registerDisposer(n.crossSectionBackgroundColor.changed.add((()=>this.scheduleRedraw()))),this.registerDisposer(n.perspectiveViewBackgroundColor.changed.add((()=>this.scheduleRedraw()))),this.registerDisposer(n.wireFrame.changed.add((()=>this.scheduleRedraw()))),this.sliceViews.changed.add((()=>this.scheduleRedraw()))}get rpc(){return this.sharedObject.rpc}get rpcId(){return this.sharedObject.rpcId}get displayDimensionRenderInfo(){return this.navigationState.displayDimensionRenderInfo}flushBackendProjectionParameters(){this.sharedObject.sharedProjectionParameters.flush()}translateByViewportPixels(e,t){const n=Oe;var i=this.projectionParameters.value;const r=i.viewProjectionMat,o=i.invViewProjectionMat,s=i.logicalWidth,a=i.logicalHeight;this.viewer.navigationState.pose.updateDisplayPosition((i=>{I.eR.transformMat4(n,i,r),n[0]+=-2*e/s,n[1]+=2*t/a,I.eR.transformMat4(i,n,o)}))}get navigationState(){return this.viewer.navigationState}ensureBoundsUpdated(){super.ensureBoundsUpdated(),this.projectionParameters.setViewport(this.renderViewport)}isReady(){if(!this.visible)return!0;for(const a of this.sliceViews){var e=(0,x.A)(a,2);const t=e[0];if((e[1]||this.viewer.showSliceViews.value)&&!t.isReady())return!1}this.ensureBoundsUpdated();var t=this.renderViewport;const n=t.width,i=t.height;if(0===n||0===i)return!0;const r={projectionParameters:this.projectionParameters.value},o=this.visibleLayerTracker.visibleLayers;for(const a of o){var s=(0,x.A)(a,2);const e=s[0],t=s[1];if(!e.isReady(r,t))return!1}return!0}disposed(){this.sliceViews.clear(),super.disposed()}getDepthArray(){if(!this.navigationState.valid)return;const e=this.offscreenFramebuffer;var t=this.renderViewport;const n=t.width,i=t.height,r=n*i,o=new Float32Array(4*r);try{e.bindSingle(De.Z),this.gl.readPixels(0,0,n,i,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.FLOAT,o)}finally{e.framebuffer.unbind()}const s=new Float32Array(r);for(let a=0;a<r;++a)s[a]=o[4*a];return s}issuePickRequest(e,t){const n=this.offscreenFramebuffer;n.readPixelFloat32IntoBuffer(De.Z,e-5,t-5,0,se,se),n.readPixelFloat32IntoBuffer(De.PICK,e-5,t-5,1936,se,se)}completePickRequest(e,t,n,i){const r=this.viewer.mouseState;r.pickedRenderLayer=null,le(n,0,4,e,t,i.viewportWidth,i.viewportHeight);const o=ae.length;for(let s=0;s<o;++s){const o=ae[s];let a=n[4*o];if(0===a)continue;const l=o%se,c=(o-l)/se;let d=1-a;Oe[0]=2*(e+l-5)/i.viewportWidth-1,Oe[1]=2*(t+c-5)/i.viewportHeight-1,Oe[2]=2*d-1,I.eR.transformMat4(Oe,Oe,i.invTransform);let u=r.position,h=r.unsnappedPosition;const p=this.navigationState.position.value,f=p.length;u.length!==f&&(u=r.position=new Float32Array(f)),h.length!==f&&(h=r.unsnappedPosition=new Float32Array(f)),u.set(p),r.coordinateSpace=this.navigationState.coordinateSpace.value;const g=this.navigationState.pose.displayDimensions.value,m=g.displayDimensionIndices;for(let e=0,t=m.length;e<t;++e)u[m[e]]=Oe[e];h.set(u);const v=n[484+4*o];return i.pickIDs.setMouseState(r,v),r.displayDimensions=g,void r.setActive(!0)}r.setActive(!1)}translateDataPointByViewportPixels(e,t,n,i){const r=Oe;var o=this.projectionParameters.value;const s=o.viewProjectionMat,a=o.invViewProjectionMat,l=o.width,c=o.height;return I.eR.transformMat4(r,t,s),r[0]+=2*n/l,r[1]+=-2*i/c,I.eR.transformMat4(e,r,a)}get transparentConfiguration(){let e=this.transparentConfiguration_;return void 0===e&&(e=this.transparentConfiguration_=this.registerDisposer(new ge.Mi(this.gl,{colorBuffers:(0,ge.Ns)(this.gl,2,this.gl.RGBA32F,this.gl.RGBA,this.gl.FLOAT),depthBuffer:this.offscreenFramebuffer.depthBuffer.addRef()}))),e}drawWithPicking(e){if(!this.navigationState.valid)return!1;var t=this.renderViewport;const n=t.width,i=t.height,r=this.viewer.showSliceViews.value;for(const b of this.sliceViews){var o=(0,x.A)(b,2);const e=o[0];(o[1]||r)&&e.updateRendering()}let s=this.gl;this.offscreenFramebuffer.bind(n,i),s.disable(s.SCISSOR_TEST),s.enable(WebGL2RenderingContext.STENCIL_TEST),s.stencilMask(4294967295),s.clearStencil(0),s.clear(WebGL2RenderingContext.STENCIL_BUFFER_BIT),s.stencilOp(WebGL2RenderingContext.KEEP,WebGL2RenderingContext.KEEP,WebGL2RenderingContext.REPLACE),s.stencilFunc(WebGL2RenderingContext.ALWAYS,1,1);const a=this.viewer.perspectiveViewBackgroundColor.value;this.gl.clearColor(a[0],a[1],a[2],0),s.clear(s.DEPTH_BUFFER_BIT),s.clearBufferfv(WebGL2RenderingContext.COLOR,De.COLOR,[a[0],a[1],a[2],0]),s.clearBufferfv(WebGL2RenderingContext.COLOR,De.Z,I.yb),s.clearBufferfv(WebGL2RenderingContext.COLOR,De.PICK,I.yb),s.enable(s.DEPTH_TEST);const l=this.projectionParameters.value;let c=I.eR.create();I.eR.transformQuat(c,I.T2[2],this.navigationState.pose.orientation.orientation),I.eR.scale(c,c,-1);const d={wireFrame:this.viewer.wireFrame.value,projectionParameters:l,lightDirection:c,ambientLighting:.2,directionalLighting:.8,pickIDs:e.pickIDs,emitter:Re,emitColor:!0,emitPickID:!0,alreadyEmittedPickID:!1};I.pB.copy(e.invTransform,l.invViewProjectionMat);const u=this.visibleLayerTracker.visibleLayers;let h=!1,p=!1;for(const b of u){var f=(0,x.A)(b,2);const e=f[0],t=f[1];e.isTransparent?h=!0:e.isAnnotation?p=!0:e.draw(d,t)}if(this.drawSliceViews(d),p){s.enable(WebGL2RenderingContext.BLEND),s.depthFunc(WebGL2RenderingContext.LEQUAL),s.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA);for(const e of u){var g=(0,x.A)(e,2);const t=g[0],n=g[1];t.isAnnotation&&t.draw(d,n)}s.depthFunc(WebGL2RenderingContext.LESS),s.disable(WebGL2RenderingContext.BLEND)}if(this.viewer.showAxisLines.value&&this.drawAxisLines(),s.stencilOp(WebGL2RenderingContext.KEEP,WebGL2RenderingContext.KEEP,WebGL2RenderingContext.KEEP),h){s.depthMask(!1),s.enable(WebGL2RenderingContext.BLEND);const e=this.transparentConfiguration;e.bind(n,i),this.gl.clearColor(0,0,0,1),s.clear(WebGL2RenderingContext.COLOR_BUFFER_BIT),d.emitter=Ae,s.blendFuncSeparate(WebGL2RenderingContext.ONE,WebGL2RenderingContext.ONE,WebGL2RenderingContext.ZERO,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA),d.emitPickID=!1;for(const t of u){var m=(0,x.A)(t,2);const e=m[0],n=m[1];e.isTransparent&&e.draw(d,n)}s.disable(WebGL2RenderingContext.DEPTH_TEST),this.offscreenFramebuffer.bindSingle(De.COLOR),s.blendFunc(WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA,WebGL2RenderingContext.SRC_ALPHA),this.transparencyCopyHelper.draw(e.colorBuffers[0].texture,e.colorBuffers[1].texture),s.depthMask(!0),s.disable(WebGL2RenderingContext.BLEND),s.enable(WebGL2RenderingContext.DEPTH_TEST),this.offscreenFramebuffer.bind(n,i),s.enable(WebGL2RenderingContext.STENCIL_TEST),s.drawBuffers([s.NONE,s.COLOR_ATTACHMENT1,s.COLOR_ATTACHMENT2]),d.emitter=Re,d.emitPickID=!0,d.emitColor=!1,s.stencilFunc(WebGL2RenderingContext.NOTEQUAL,3,1),s.stencilOp(WebGL2RenderingContext.KEEP,WebGL2RenderingContext.KEEP,WebGL2RenderingContext.REPLACE),s.stencilMask(2);for(const t of u){var v=(0,x.A)(t,2);const e=v[0],n=v[1];e.isTransparent&&e.transparentPickEnabled&&e.draw(d,n)}s.stencilFunc(WebGL2RenderingContext.EQUAL,0,3),s.stencilOp(WebGL2RenderingContext.KEEP,WebGL2RenderingContext.KEEP,WebGL2RenderingContext.KEEP),s.stencilMask(0);for(const t of u){var y=(0,x.A)(t,2);const e=y[0],n=y[1];e.isTransparent&&!e.transparentPickEnabled&&e.draw(d,n)}}if(s.stencilMask(4294967295),s.disable(WebGL2RenderingContext.STENCIL_TEST),this.viewer.showScaleBar.value&&this.viewer.orthographicProjection.value){s.drawBuffers([s.COLOR_ATTACHMENT0]),s.disable(WebGL2RenderingContext.DEPTH_TEST),s.enable(WebGL2RenderingContext.BLEND),s.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA);const e=this.scaleBars,t=this.viewer.scaleBarOptions.value;e.draw(this.renderViewport,this.navigationState.displayDimensionRenderInfo.value,this.navigationState.relativeDisplayScales.value,this.navigationState.zoomFactor.value/this.renderViewport.logicalHeight,t),s.disable(WebGL2RenderingContext.BLEND)}return this.offscreenFramebuffer.unbind(),this.setGLClippedViewport(),this.offscreenCopyHelper.draw(this.offscreenFramebuffer.colorBuffers[De.COLOR].texture),!0}drawSliceViews(e){let t=this.sliceViewRenderHelper,n=e.lightDirection,i=e.ambientLighting,r=e.directionalLighting,o=e.projectionParameters.viewProjectionMat;const s=this.viewer.showSliceViews.value;for(const c of this.sliceViews){var a=(0,x.A)(c,2);const e=a[0];if(!a[1]&&!s)continue;var l=e.projectionParameters.value;const d=l.width,u=l.height,h=l.invViewMatrix,p=l.viewportNormalInCanonicalCoordinates;if(0===d||0===u||!e.valid)continue;let f=i+Math.abs(I.eR.dot(n,p))*r,g=_e;I.pB.identity(g),g[0]=d/2,g[5]=-u/2,I.pB.multiply(g,h,g),I.pB.multiply(g,o,g);const m=Ne,v=this.viewer.crossSectionBackgroundColor.value;m[0]=v[0],m[1]=v[1],m[2]=v[2],m[3]=1,t.draw(e.offscreenFramebuffer.colorBuffers[0].texture,g,I.ln.fromValues(f,f,f,1),Ne,0,0,1,1)}}drawAxisLines(){const e=this.viewer.navigationState.zoomFactor.value,t=this.projectionParameters.value,n=e*(Math.min(t.logicalWidth,t.logicalHeight)/this.renderViewport.logicalHeight/4),i=this.gl;i.drawBuffers([i.COLOR_ATTACHMENT0]),this.axesLineHelper.draw(N(t,n),!1)}zoomByMouse(e){this.navigationState.zoomBy(e)}}var ze,je=n(7184);function Ge(e){e.addOutputBuffer("vec4","out_fragColor",0),e.addOutputBuffer("highp vec4","out_pickId",1),e.addFragmentCode("\nvoid emit(vec4 color, highp uint pickId) {\n  out_fragColor = color;\n  float pickIdFloat = float(pickId);\n  out_pickId = vec4(pickIdFloat, pickIdFloat, pickIdFloat, 1.0);\n}\n")}function We(e){e.addOutputBuffer("vec4","out_fragColor",null),e.addFragmentCode("\nvoid emit(vec4 color, highp uint pickId) {\n  out_fragColor = color;\n}\n")}!function(e){e[e.COLOR=0]="COLOR",e[e.PICK=1]="PICK",e[e.NUM_TEXTURES=2]="NUM_TEXTURES"}(ze||(ze={}));const He=I.eR.create(),qe=I.eR.create(),Ye=I.ln.create();class Je extends ce{constructor(e,t,n,i){super(e,t,i),this.sliceView=n,this.axesLineHelper=this.registerDisposer(_.get(this.gl)),this.sliceViewRenderHelper=this.registerDisposer(ue.wb.get(this.gl,We)),this.colorFactor=I.ln.fromValues(1,1,1,1),this.pickIDs=new j,this.offscreenFramebuffer=this.registerDisposer(new ge.Mi(this.gl,{colorBuffers:[new ge.iB(this.gl,WebGL2RenderingContext.RGBA8,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.UNSIGNED_BYTE),new ge.iB(this.gl,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RED,WebGL2RenderingContext.FLOAT)]})),this.offscreenCopyHelper=this.registerDisposer(ge.DG.get(this.gl)),this.scaleBars=this.registerDisposer(new Ee(this.gl)),i.wireFrame.changed.add((()=>this.scheduleRedraw())),(0,H.qZ)(t,"rotate-via-mouse-drag",(e=>{const t=this.viewer.mouseState;if(t.updateUnconditionally()){const n=Float32Array.from(t.position);(0,K.i)(e.detail,((e,t,i)=>{const r=this.navigationState.pose,o=I.eR.transformQuat(He,I.T2[0],r.orientation.orientation),s=I.eR.transformQuat(qe,I.T2[1],r.orientation.orientation);this.viewer.navigationState.pose.rotateAbsolute(s,-t/4*Math.PI/180,n),this.viewer.navigationState.pose.rotateAbsolute(o,-i/4*Math.PI/180,n)}))}})),(0,H.qZ)(t,"rotate-in-plane-via-touchrotate",(e=>{const t=e.detail,n=this.viewer.mouseState;this.handleMouseMove(t.centerX,t.centerY),n.updateUnconditionally()&&this.navigationState.pose.rotateAbsolute(this.sliceView.projectionParameters.value.viewportNormalInCanonicalCoordinates,t.angle-t.prevAngle,n.position)})),this.registerDisposer(n),this.visibleLayerTracker=(0,B.du)(this.viewer.layerManager,je.j,this.viewer.visibleLayerRoles,this),this.registerDisposer(i.crossSectionBackgroundColor.changed.add((()=>this.scheduleRedraw()))),this.registerDisposer(n.visibility.add(this.visibility)),this.registerDisposer(n.viewChanged.add((()=>{this.visible&&e.scheduleRedraw()}))),this.registerDisposer(i.showAxisLines.changed.add((()=>{this.visible&&this.scheduleRedraw()}))),this.registerDisposer(i.showScaleBar.changed.add((()=>{this.visible&&this.context.scheduleRedraw()}))),this.registerDisposer(i.scaleBarOptions.changed.add((()=>{this.visible&&this.context.scheduleRedraw()})))}flushBackendProjectionParameters(){this.sliceView.flushBackendProjectionParameters()}get displayDimensionRenderInfo(){return this.navigationState.displayDimensionRenderInfo}get rpc(){return this.sliceView.rpc}get rpcId(){return this.sliceView.rpcId}get navigationState(){return this.sliceView.navigationState}translateByViewportPixels(e,t){this.viewer.navigationState.pose.updateDisplayPosition((n=>{I.eR.set(n,-e,-t,0),I.eR.transformMat4(n,n,this.sliceView.projectionParameters.value.invViewMatrix)}))}translateDataPointByViewportPixels(e,t,n,i){const r=this.sliceView.projectionParameters.value;return I.eR.transformMat4(e,t,r.viewMatrix),I.eR.set(e,e[0]+n,e[1]+i,e[2]),I.eR.transformMat4(e,e,r.invViewMatrix),e}isReady(){if(!this.visible)return!1;const e=this.sliceView;if(this.ensureBoundsUpdated(),!e.isReady())return!1;const t={projectionParameters:e.projectionParameters.value,sliceView:e};for(const i of this.visibleLayerTracker.visibleLayers){var n=(0,x.A)(i,2);const e=n[0],r=n[1];if(!e.isReady(t,r))return!1}return!0}drawWithPicking(e){const t=this.sliceView;if(!t.valid)return!1;t.updateRendering();const n=t.projectionParameters.value,i=n.width,r=n.height,o=n.invViewProjectionMat;I.pB.copy(e.invTransform,o);const s=this.gl;this.offscreenFramebuffer.bind(i,r),s.disable(WebGL2RenderingContext.SCISSOR_TEST),this.gl.clearColor(0,0,0,0),s.clear(WebGL2RenderingContext.COLOR_BUFFER_BIT);const a=Ye,l=this.viewer.crossSectionBackgroundColor.value;a[0]=l[0],a[1]=l[1],a[2]=l[2],a[3]=1,this.offscreenFramebuffer.bindSingle(ze.COLOR),this.sliceViewRenderHelper.draw(t.offscreenFramebuffer.colorBuffers[0].texture,I.r3,this.colorFactor,a,0,0,1,1);const c=this.visibleLayerTracker.visibleLayers;let d=this.pickIDs;d.clear();const u={wireFrame:this.viewer.wireFrame.value,projectionParameters:n,pickIDs:d,emitter:Ge,emitColor:!0,emitPickID:!0,sliceView:t};this.offscreenFramebuffer.bind(i,r),s.enable(WebGL2RenderingContext.BLEND),s.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA);for(const p of c){var h=(0,x.A)(p,2);const e=h[0],t=h[1];e.draw(u,t)}if(s.disable(WebGL2RenderingContext.BLEND),this.viewer.showAxisLines.value||this.viewer.showScaleBar.value){if(this.offscreenFramebuffer.bindSingle(ze.COLOR),this.viewer.showAxisLines.value){const e=Math.min(n.logicalWidth,n.logicalHeight)/4*1.5,t=this.viewer.navigationState.zoomFactor.value;this.axesLineHelper.draw((0,I.Qi)(N(n,e*t)))}this.viewer.showScaleBar.value&&(s.enable(WebGL2RenderingContext.BLEND),s.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA),this.scaleBars.draw(n,this.navigationState.displayDimensionRenderInfo.value,this.navigationState.relativeDisplayScales.value,this.navigationState.zoomFactor.value,this.viewer.scaleBarOptions.value),s.disable(WebGL2RenderingContext.BLEND))}return this.offscreenFramebuffer.unbind(),this.setGLClippedViewport(),this.offscreenCopyHelper.draw(this.offscreenFramebuffer.colorBuffers[ze.COLOR].texture),!0}ensureBoundsUpdated(){super.ensureBoundsUpdated(),this.sliceView.projectionParameters.setViewport(this.renderViewport)}issuePickRequest(e,t){this.offscreenFramebuffer.readPixelFloat32IntoBuffer(ze.PICK,e-5,t-5,0,se,se)}completePickRequest(e,t,n,i){const r=this.viewer.mouseState;r.pickedRenderLayer=null,le(n,0,4,e,t,i.viewportWidth,i.viewportHeight);const o=i.viewportWidth,s=i.viewportHeight,a=ae.length,l=this.navigationState.position.value,c=l.length,d=this.navigationState.pose.displayDimensions.value,u=d.displayRank,h=d.displayDimensionIndices,p=(n,r,a)=>{const c=e+n,d=t+r;He[0]=2*c/o-1,He[1]=2*d/s-1,He[2]=0,I.eR.transformMat4(He,He,i.invTransform),a.set(l);for(let e=0;e<u;++e)a[h[e]]=He[e]};let f=r.unsnappedPosition;f.length!==c&&(f=r.unsnappedPosition=new Float32Array(c)),r.coordinateSpace=this.navigationState.coordinateSpace.value,r.displayDimensions=d,p(0,0,f);const g=(e,t,n)=>{let i=r.position;i.length!==c&&(i=r.position=new Float32Array(c)),p(e-5,t-5,i),this.pickIDs.setMouseState(r,n),r.setActive(!0)};for(let m=0;m<a;++m){const e=ae[m],t=n[4*m];if(0===t)continue;const i=e%se;return void g(i,(e-i)/se,t)}g(5,5,0)}zoomByMouse(e){const t=this.navigationState;if(!t.valid)return;var n=this.sliceView.projectionParameters.value;const i=n.width,r=n.height,o=n.invViewMatrix;var s=n.displayDimensionRenderInfo;const a=s.displayDimensionIndices,l=s.displayRank;let c=this.mouseX,d=this.mouseY;c-=i/2,d-=r/2;const u=this.navigationState.position.value;for(let h=0;h<l;++h){const t=a[h],n=o[h]*c+o[4+h]*d;u[t]+=n*(1-e)}this.navigationState.position.changed.dispatch(),t.zoomBy(e)}}var Ke=n(3162),Xe=n(6344),Ze=n(233),Qe=n(8178),$e=n.n(Qe),et=n(3816),tt=n.n(et),nt=n(974),it=n.n(nt),rt=n(4117),ot=n.n(rt),st=n(2038),at=n(9735),lt=n(1877);const ct=["#f00","#0f0","#00f"],dt=J.n5.fromObject({arrowup:{action:"move-up"},arrowdown:{action:"move-down"},wheel:{action:"adjust-via-wheel"},enter:{action:"commit"},escape:{action:"cancel"}});function ut(e){if(e<1||e>1024){const t=0|ot()(e),n=e/2**t;return"".concat((0,lt.I)(n,1),"p").concat(t)}return e.toString()}const ht=[e=>e.name,e=>e.scaleFactor];class pt extends M.O8{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"px";super(),this.displayDimensionRenderInfo=e,this.zoom=t,this.depthRange=n,this.displayUnit=i,this.element=document.createElement("div"),this.dimensionGridContainer=document.createElement("div"),this.depthGridContainer=document.createElement("div"),this.defaultCheckbox=document.createElement("input"),this.dimensionElements=it()(Array(3),((e,t)=>{const n=document.createElement("div");n.classList.add("neuroglancer-display-dimensions-widget-dimension"),n.style.display="contents",(0,q.qZ)(n,"adjust-via-wheel",(e=>{const n=e.detail.deltaY;0!==n&&this.zoomDimension(t,tt()(n))}));const i=document.createElement("input");i.classList.add("neuroglancer-display-dimensions-widget-name"),i.title="Change display dimensions",i.spellcheck=!1,i.autocomplete="off",i.style.color=ct[t],i.style.gridColumn="1",i.style.gridRow="".concat(t+1),i.addEventListener("focus",(()=>{i.select()})),n.appendChild(i);const r=document.createElement("span");r.classList.add("neuroglancer-display-dimensions-widget-scale-factor");const o=document.createElement("input");o.spellcheck=!1,o.title="Change relative scale at which dimension is displayed",o.autocomplete="off",r.style.gridColumn="2",r.style.gridRow="".concat(t+1),o.addEventListener("focus",(()=>{o.select()})),r.appendChild(o),n.appendChild(r);const s=document.createElement("span");s.classList.add("neuroglancer-display-dimensions-widget-scale"),s.style.gridColumn="3",s.style.gridRow="".concat(t+1),n.appendChild(s),this.dimensionGridContainer.appendChild(n);const a={name:i,container:n,scaleFactor:o,scale:s,scaleFactorModified:!1};i.addEventListener("input",(()=>{(0,Ke.qi)(i),this.updateNameValidity()})),(0,q.qZ)(i,"commit",(()=>{this.updateNames()})),i.addEventListener("blur",(e=>{const t=e.relatedTarget;this.dimensionElements.some((e=>e.name===t))||this.updateNames()||this.updateView()})),r.addEventListener("click",(e=>{e.target!==o&&(o.focus(),e.preventDefault())})),o.addEventListener("input",(()=>{(0,Ke.qi)(o),a.scaleFactorModified=!0})),(0,q.qZ)(o,"commit",(()=>{this.updateScaleFactors()})),o.addEventListener("blur",(()=>{this.updateScaleFactors()||this.updateView()}));for(const l of ht)(0,q.qZ)(l(a),"move-up",(()=>{0!==t&&l(this.dimensionElements[t-1]).focus()})),(0,q.qZ)(l(a),"move-down",(()=>{2!==t&&l(this.dimensionElements[t+1]).focus()}));return a})),this.scheduleUpdateView=(0,st.t)((()=>this.updateView()));const r=this.element,o=this.dimensionGridContainer,s=this.defaultCheckbox,a=document.createElement("label"),l=this.registerCancellable(m()((()=>{r.dataset.active="false"}),2e3)),c=()=>{r.dataset.active="true",l()};this.registerDisposer(t.changed.add(c)),this.registerDisposer(e.relativeDisplayScales.changed.add(c)),this.registerDisposer(n.changed.add(c)),r.classList.add("neuroglancer-display-dimensions-widget"),r.appendChild(o),o.classList.add("neuroglancer-display-dimensions-widget-dimension-grid"),r.addEventListener("pointerleave",(()=>{const e=document.activeElement;e instanceof HTMLElement&&r.contains(e)&&e.blur()})),s.type="checkbox",a.appendChild(s),a.appendChild(document.createTextNode("Default")),a.title="Display first 3 dimensions",a.classList.add("neuroglancer-display-dimensions-widget-default"),s.addEventListener("change",(()=>{this.updateDefault()})),o.appendChild(a),this.registerDisposer(e),this.registerDisposer(n),this.registerDisposer(t.changed.add(this.scheduleUpdateView)),this.registerDisposer(e.changed.add(this.scheduleUpdateView));this.registerDisposer(new q.cL(r,dt)).allShortcutsAreGlobal=!0,this.registerDisposer(new J.qy(r,dt)),(0,q.qZ)(o,"cancel",(()=>{this.updateView();const e=document.activeElement;e instanceof HTMLElement&&r.contains(e)&&e.blur()}));const d=this.depthGridContainer;d.classList.add("neuroglancer-depth-range-widget-grid"),r.appendChild(d);const u=document.createElement("label"),h=document.createElement("input");h.type="checkbox",u.classList.add("neuroglancer-depth-range-relative-checkbox-label"),h.classList.add("neuroglancer-depth-range-relative-checkbox"),u.appendChild(h),u.appendChild(document.createTextNode("Zoom-relative")),h.addEventListener("change",(()=>{const e=h.checked;let t=this.depthRange.value;e!==t<0&&(t=e?-t/this.zoom.value:-t*this.zoom.value,this.depthRange.value=t)})),u.title="Depth range is multiplied by scale",r.appendChild(u),(0,q.qZ)(d,"adjust-via-wheel",(e=>{const t=e.detail.deltaY;if(0===t)return;const n=this.depthRange.value;this.depthRange.value=n*2**tt()(t)})),this.registerDisposer((0,ye.no)(((e,t,n)=>{let{factors:i}=n;(0,Ke.gS)(d);const r=t.displayRank,o=t.globalDimensionNames,s=t.displayDimensionIndices,a=t.displayDimensionUnits,l=t.displayDimensionScales,c=t.canonicalVoxelFactors,u=[],p=()=>{h.checked=this.depthRange.value<0;let e=this.depthRange.value;e<0&&(e*=-this.zoom.value);for(const t of u){const n=t.input;n.value=(0,Se.NJ)(e*t.scale,t.unit,{precision:2,elide1:!1}),(0,Ke.qi)(n)}},f=e=>{const t=(0,Se.W7)(e.input.value);if(void 0===t||t.unit!==e.unit)return!1;let n=t.scale/e.scale;return this.depthRange.value<0&&(n=-n/this.zoom.value),this.depthRange.value=n,!0};for(let h=0;h<r;++h){const e=s[h],t=o[e],n=a[h],r=i[e];let g=u.find((e=>e.unit===n&&e.factor===r));if(void 0===g){const e=document.createElement("div");e.title="Visible depth range",e.style.display="contents",d.appendChild(e);const t=document.createElement("span");t.textContent="\xb1",e.appendChild(t);const i=document.createElement("input");i.spellcheck=!1,i.autocomplete="off",i.addEventListener("focus",(()=>{i.select()})),(0,q.qZ)(i,"commit",(()=>{f(g)})),i.addEventListener("change",(()=>{f(g)||p()})),i.addEventListener("input",(()=>{(0,Ke.qi)(i)})),e.appendChild(i);const o=document.createElement("span");o.classList.add("neuroglancer-depth-range-widget-dimension-names"),e.appendChild(o),g={unit:n,factor:r,dimensionNames:[],input:i,label:o,scale:l[h]/c[h]},u.push(g)}g.dimensionNames.push(t)}for(const d of u)d.dimensionNames.length!==r&&(d.label.textContent=d.dimensionNames.join(" "));e.registerDisposer((0,q.qZ)(d,"cancel",(()=>{p();const e=document.activeElement;e instanceof HTMLElement&&d.contains(e)&&e.blur()})));const g=e.registerCancellable((0,st.t)(p));e.registerDisposer(this.depthRange.changed.add(g)),e.registerDisposer(this.zoom.changed.add(g)),p()}),e,this.relativeDisplayScales)),this.updateView()}zoomDimension(e,t){this.updateScaleFactors();const n=this.displayDimensions,i=this.relativeDisplayScales,r=n.value.displayDimensionIndices[e];if(-1===r)return;const o=i.value.factors,s=new Float64Array(o);s[r]*=2**-t,i.setFactors(s)}updateNameValidity(){const e=this.dimensionElements,t=this.displayDimensions.value.displayDimensionIndices,n=e.map((e=>e.name.value)),i=(0,y.ii)(n),r=this.displayDimensions.coordinateSpace.value.names,o=n.length;for(let s=0;s<o;++s){let o=i[s];const a=n[s];let l=-1;0===a.length?o=!0:(l=r.indexOf(a),-1===l&&(o=!1));const c=e[s];c.name.dataset.isValid=o.toString(),c.container.dataset.isModified=(l!==t[s]).toString()}}get displayDimensions(){return this.displayDimensionRenderInfo.displayDimensions}get relativeDisplayScales(){return this.displayDimensionRenderInfo.relativeDisplayScales}updateNames(){const e=this.dimensionElements.map((e=>e.name.value)).filter((e=>e.length>0));if(!(0,y.RV)(e))return!1;const t=this.displayDimensionRenderInfo.displayDimensions;if(0===e.length)return t.reset(),!0;const n=new Int32Array(3);n.fill(-1);const i=t.coordinateSpace.value.names,r=e.length;for(let o=0;o<r;++o){const t=i.indexOf(e[o]);if(-1===t)return!1;n[o]=t}return(0,at.r1)(n,t.value.displayDimensionIndices)||t.setDimensionIndices(r,n),!0}updateDefault(){this.displayDimensions.default=this.defaultCheckbox.checked}updateScaleFactors(){const e=this.displayDimensions,t=this.relativeDisplayScales;var n=e.value;const i=n.displayDimensionIndices,r=n.displayRank,o=t.value.factors,s=this.dimensionElements,a=new Float64Array(o);for(let l=0;l<r;++l){const e=s[l];if(!e.scaleFactorModified)continue;const t=Number(e.scaleFactor.value),n=i[l];!$e()(t)||t<=0||(a[n]=t)}return(0,at.r1)(a,o)||t.setFactors(a),!0}updateView(){const e=this.dimensionElements,t=this.displayDimensions.default;var n=this.displayDimensionRenderInfo.value;const i=n.displayDimensionIndices,r=n.canonicalVoxelFactors,o=n.displayDimensionUnits,s=n.displayDimensionScales,a=n.globalDimensionNames,l=this.relativeDisplayScales.value.factors;this.defaultCheckbox.checked=t;const c=this.zoom.value,d=i[0];let u=!0;if(-1!==d){const e=o[0],t=l[d];for(let n=1;n<3;++n){const r=i[n];if(-1!==r&&(o[n]!==e||l[r]!==t)){u=!1;break}}}for(let h=0;h<3;++h){const t=i[h],n=e[h];if(delete n.name.dataset.isValid,n.container.dataset.isModified=(-1===t).toString(),-1===t)n.name.value="",n.scale.textContent="",n.scaleFactor.value="";else{n.name.value=a[t];const e=s[h]*c/r[h];if(0!==h&&u)n.scale.textContent="";else{const t=(0,Se.NJ)(e,o[h],{precision:2,elide1:!1});n.scale.textContent="".concat(t,"/").concat(this.displayUnit)}n.scaleFactor.value=ut(l[t])}(0,Ke.qi)(n.name),(0,Ke.qi)(n.scaleFactor)}}disposed(){(0,Ke.fh)(this.element),super.disposed()}}const ft=new(T())([["xy",void 0],["xz",I.Yu.rotateX(I.Yu.create(),I.Yu.create(),Math.PI/2)],["yz",I.Yu.rotateY(I.Yu.create(),I.Yu.create(),Math.PI/2)]]),gt=new(T())([["4panel","\u25f1"],["3d","\u25fb"]]);function mt(e,t){return function(e,t){let n;return n=void 0===t?e.navigationState.addRef():new D.kt(new D.aI(e.navigationState.pose.position.addRef(),e.navigationState.pose.displayDimensionRenderInfo.addRef(),D.EC.makeRelative(e.navigationState.pose.orientation,t)),e.navigationState.zoomFactor.addRef(),e.navigationState.depthRange.addRef()),new ue.Eb(e.chunkManager,e.layerManager,n,e.wireFrame)}(e,ft.get(t))}function vt(e){return{crossSectionBackgroundColor:e.crossSectionBackgroundColor,perspectiveViewBackgroundColor:e.perspectiveViewBackgroundColor,selectionDetailsState:e.selectionDetailsState,mouseState:e.mouseState,layerManager:e.layerManager,showAxisLines:e.showAxisLines,wireFrame:e.wireFrame,visibleLayerRoles:e.visibleLayerRoles,selectedLayer:e.selectedLayer,visibility:e.visibility,scaleBarOptions:e.scaleBarOptions}}function yt(e){const t=e.viewer;return r()(r()({},vt(t)),{navigationState:t.perspectiveNavigationState,inputEventMap:t.inputEventBindings.perspectiveView,orthographicProjection:e.specification.orthographicProjection,showScaleBar:t.showScaleBar,rpc:t.chunkManager.rpc})}function bt(e){return r()(r()({},vt(e)),{navigationState:e.navigationState,inputEventMap:e.inputEventBindings.sliceView})}function St(e,t){const n=t.navigationState;t.element.appendChild(e.registerDisposer(new pt(n.pose.displayDimensionRenderInfo.addRef(),n.zoomFactor,n.depthRange.addRef(),t instanceof Je?"px":"vh")).element)}function wt(e,t,n){const i=document.createElement("div");i.className="neuroglancer-data-panel-layout-controls",e.registerDisposer((()=>(0,Ke.fh)(i)));for(let r=0;r<2;++r){const i=n[Math.min(n.length-1,r)];e.registerDisposer((0,H.qZ)(t.element,0===r?"toggle-layout":"toggle-layout-alternative",(t=>{e.container.name=i,t.stopPropagation()})))}for(const r of n){const t=document.createElement("button"),n=document.createElement("div");t.appendChild(n),n.textContent=gt.get(r),t.title="Switch to ".concat(r," layout."),t.addEventListener("click",(()=>{e.container.name=r})),i.appendChild(t)}t.element.appendChild(i)}function xt(e,t){const n=new ue.Eb(e.chunkManager,e.layerManager,t.navigationState.addRef(),e.wireFrame),i=()=>{const e=t.width.value,i=t.height.value;n.projectionParameters.setViewport({width:e,height:i,logicalWidth:e,logicalHeight:i,visibleLeftFraction:0,visibleTopFraction:0,visibleWidthFraction:1,visibleHeightFraction:1})};return n.registerDisposer(t.width.changed.add(i)),n.registerDisposer(t.height.changed.add(i)),i(),n}function Ct(e,t,n){const i=new(T());(()=>{const r=new(k());for(const s of n.values()){if(r.add(s),i.has(s))continue;const n=xt(e,s);t.sliceViews.set(n,!0),i.set(s,n)}for(const e of i){var o=(0,x.A)(e,2);const n=o[0],i=o[1];r.has(n)||t.sliceViews.delete(i)}})()}class kt extends M.O8{constructor(e,t,n,i){super(),this.container=e,this.rootElement=t,this.viewer=n;let o=(s=n,new(T())([["xy",mt(s,"xy")],["xz",mt(s,"xz")],["yz",mt(s,"yz")]]));var s;let a=n.display;const l=r()(r()({},yt(e)),{showSliceViews:n.showPerspectiveSliceViews,showSliceViewsCheckbox:!0}),c=r()(r()({},bt(n)),{showScaleBar:n.showScaleBar}),d=r()(r()({},bt(n)),{showScaleBar:new he.C_(!1,!1)}),u=(e,t,n,i)=>{const r=this.registerDisposer(new Je(a,t,o.get(e),n));return i&&St(this,r),wt(this,r,[e,"".concat(e,"-3d")]),r};let h=[L(1,P("column",[L(1,P("row",[L(1,(e=>{u("xy",e,c,!0)})),L(1,(e=>{u("xz",e,d,!1)}))])),L(1,P("row",[L(1,(e=>{let t=this.registerDisposer(new Ue(a,e,l));for(let n of o.values())t.sliceViews.set(n.addRef(),!1);St(this,t),Ct(n,t,i),wt(this,t,["3d"])})),L(1,(e=>{u("yz",e,d,!1)}))]))]))];P("row",h)(t)}disposed(){(0,Ke.gS)(this.rootElement),super.disposed()}}class Et extends M.O8{constructor(e,t,n,i,o,s){super(),this.container=e,this.rootElement=t,this.viewer=n,this.direction=i;let a=mt(n,o),l=n.display;const c=r()(r()({},yt(e)),{showSliceViews:n.showPerspectiveSliceViews,showSliceViewsCheckbox:!0}),d=r()(r()({},bt(n)),{showScaleBar:n.showScaleBar});L(1,P(i,[L(1,(e=>{const t=this.registerDisposer(new Je(l,e,a,d));St(this,t),wt(this,t,[o,"4panel"])})),L(1,(e=>{let t=this.registerDisposer(new Ue(l,e,c));t.sliceViews.set(a.addRef(),!1),Ct(n,t,s),St(this,t),wt(this,t,["3d","4panel"])}))]))(t)}disposed(){(0,Ke.gS)(this.rootElement),super.disposed()}}class Tt extends M.O8{constructor(e,t,n,i){super(),this.container=e,this.rootElement=t,this.viewer=n;let o=mt(n,i);const s=r()(r()({},bt(n)),{showScaleBar:n.showScaleBar});P("row",[L(1,(e=>{const t=this.registerDisposer(new Je(n.display,e,o,s));St(this,t),wt(this,t,["4panel","".concat(i,"-3d")])}))])(t)}disposed(){(0,Ke.gS)(this.rootElement),super.disposed()}}class Lt extends M.O8{constructor(e,t,n,i){super(),this.container=e,this.rootElement=t,this.viewer=n;let o=r()(r()({},yt(e)),{showSliceViews:new he.C_(!1,!1)});P("row",[L(1,(e=>{const t=this.registerDisposer(new Ue(n.display,e,o));Ct(n,t,i),St(this,t),wt(this,t,["4panel"])}))])(t)}disposed(){(0,Ke.gS)(this.rootElement),super.disposed()}}const Pt=new(T())([["4panel",{factory:(e,t,n,i)=>new kt(e,t,n,i)}],["3d",{factory:(e,t,n,i)=>new Lt(e,t,n,i)}]]);for(const Xi of ft.keys()){Pt.set(Xi,{factory:(e,t,n)=>new Tt(e,t,n,Xi)});const e="".concat(Xi,"-3d");gt.set(Xi,"\u25fb"),gt.set(e,"\u25eb"),Pt.set(e,{factory:(e,t,n,i)=>new Et(e,t,n,"row",Xi,i)})}function Dt(e){let t=Pt.get(e);if(void 0===t)throw new Error("Invalid layout name: ".concat(s()(e),"."));return t}function Mt(e){return Dt(e),e}class It extends M.O8{constructor(e){super(),this.width=new ye.DN(1e3,be.verifyPositiveInt),this.height=new ye.DN(1e3,be.verifyPositiveInt),this.changed=new Xe.IY,this.position=new D.ru(e.position.addRef()),this.position.changed.add(this.changed.dispatch),this.orientation=new D.Ti(e.pose.orientation.addRef()),this.orientation.changed.add(this.changed.dispatch),this.width.changed.add(this.changed.dispatch),this.height.changed.add(this.changed.dispatch),this.scale=new D.MT(e.zoomFactor.addRef(),e.zoomFactor.displayDimensionRenderInfo.addRef()),this.scale.changed.add(this.changed.dispatch),this.navigationState=this.registerDisposer(new D.kt(new D.aI(this.position.value,e.pose.displayDimensionRenderInfo.addRef(),this.orientation.value),this.scale.value,e.depthRange.addRef()))}restoreState(e){(0,be.verifyObject)(e),(0,Ze.wX)(e,"width",this.width),(0,Ze.wX)(e,"height",this.height),(0,Ze.wX)(e,"position",(0,D.fj)(this.position)),(0,Ze.wX)(e,"orientation",this.orientation),(0,Ze.wX)(e,"scale",this.scale),(0,Ze.wX)(e,"zoom",(0,D.fj)(this.scale))}reset(){this.width.reset(),this.height.reset(),this.position.reset(),this.orientation.reset(),this.scale.reset()}toJSON(){return{width:this.width.toJSON(),height:this.height.toJSON(),position:this.position.toJSON(),orientation:this.orientation.toJSON(),scale:this.scale.toJSON()}}}class Rt extends pe.g{constructor(e){super(((e,t)=>e.registerDisposer(e.registerDisposer(t).changed.add(this.changed.dispatch)))),this.parentNavigationState=e,this.registerDisposer(e)}restoreState(e){(0,be.verifyObject)(e);for(const t of w()(e)){const n=new It(this.parentNavigationState);try{this.set(t,n.addRef()),n.restoreState(e[t])}finally{n.dispose()}}}reset(){this.clear()}toJSON(){if(0===this.size)return;const e={};for(const n of this){var t=(0,x.A)(n,2);const i=t[0],r=t[1];e[i]=r.toJSON()}return e}}class At extends M.O8{constructor(e,t){super(),this.changed=new Xe.IY,this.orthographicProjection=new he.C_(!1),this.type=new ye.DN(t,Mt),this.type.changed.add(this.changed.dispatch),this.crossSections=this.registerDisposer(new Rt(e.addRef())),this.crossSections.changed.add(this.changed.dispatch),this.orthographicProjection.changed.add(this.changed.dispatch),this.registerDisposer(e)}reset(){this.crossSections.clear(),this.orthographicProjection.reset(),this.type.reset()}restoreState(e){this.crossSections.clear(),this.orthographicProjection.reset(),"string"===typeof e?this.type.restoreState(e):((0,be.verifyObject)(e),(0,be.verifyObjectProperty)(e,"type",(e=>this.type.restoreState(e))),(0,be.verifyObjectProperty)(e,"orthographicProjection",(e=>this.orthographicProjection.restoreState(e))),(0,be.verifyObjectProperty)(e,"crossSections",(e=>void 0!==e&&this.crossSections.restoreState(e))))}toJSON(){const e=this.type,t=this.crossSections,n=this.orthographicProjection.toJSON();return 0===t.size&&void 0===n?e.value:{type:e.value,crossSections:t.toJSON(),orthographicProjection:n}}}class Ot extends M.O8{constructor(e,t){super(),this.viewer=e,this.element=document.createElement("div"),this.specification=this.registerDisposer(new At(this.viewer.navigationState.addRef(),t)),this.element.style.flex="1";const n=this.registerCancellable(m()((()=>this.updateLayout()),0));this.specification.type.changed.add(n),(0,H.qZ)(this.element,"toggle-orthographic-projection",(()=>this.specification.orthographicProjection.toggle())),this.registerDisposer(this.viewer.display.updateStarted.add((()=>n.flush()))),n()}get name(){return this.specification.type.value}set name(e){this.specification.type.value=e}get changed(){return this.specification.changed}toJSON(){return this.specification.toJSON()}restoreState(e){this.specification.restoreState(e)}reset(){this.specification.reset()}disposeLayout(){let e=this.layout;void 0!==e&&(e.dispose(),this.layout=void 0)}updateLayout(){this.disposeLayout(),this.layout=Dt(this.name).factory(this,this.element,this.viewer,this.specification.crossSections)}disposed(){this.disposeLayout(),super.disposed()}}var Nt=n(9312),_t=n(3008),Vt=n.n(_t),Bt=n(6688),Ft=n.n(Bt),Ut=n(9859),zt=n(2686),jt=n(3398),Gt=n(1301);const Wt="undefined"!==typeof STATE_SERVERS&&w()(STATE_SERVERS).length>0;class Ht extends M.O8{constructor(e){if(super(),this.element=document.createElement("div"),this.button=(0,Gt.m)({text:"Share",title:"Share State"}),"undefined"===typeof STATE_SERVERS)throw new Error("Cannot construct StateSare without defining STATE_SERVERS");if(w()(STATE_SERVERS).length>1){const n=document.createElement("select");n.style.marginRight="5px",this.registerDisposer(e.selectedStateServer.changed.add((()=>{const t=e.selectedStateServer.value;Ft()(STATE_SERVERS).map((e=>e.url)).includes(t)&&(n.value=t)}))),this.registerEventListener(n,"change",(()=>{e.selectedStateServer.value=n.value}));for(let e of Vt()(STATE_SERVERS)){var t=(0,x.A)(e,2);let i=t[0],r=t[1];const o=document.createElement("option");o.textContent=i,o.value=r.url,o.selected=!!r.default,n.appendChild(o)}this.element.appendChild(n),this.selectStateServerElement=n}this.element.appendChild(this.button),this.registerEventListener(this.button,"click",(()=>{const t=this.selectStateServerElement?this.selectStateServerElement.value:Ft()(STATE_SERVERS)[0].url,n=new URL(t).protocol;var i=(0,jt.n)(t,b.X);const r=i.url,o=i.credentialsProvider;Ut.M.forPromise((0,jt.G)(o,r,{method:"POST",headers:{"Content-Type":"application/json"},body:s()(e.state.toJSON())},zt.cj).then((e=>{const t=new URL(e);t.protocol=n;const i="".concat(window.location.origin,"/#!").concat(t);navigator.clipboard.writeText(i).then((()=>{Ut.M.showTemporaryMessage("Share link copied to clipboard")}))})).catch((()=>{Ut.M.showTemporaryMessage("Could not access state server.",4e3)})),{initialMessage:"Posting state to ".concat(t,"."),delay:!0,errorPrefix:""})}))}disposed(){this.element.remove(),super.disposed()}}var qt=n(2564),Yt=n(4228);function Jt(e){return e.startsWith("key")?e.substring(3):e.startsWith("digit")||e.startsWith("arrow")?e.substring(5):e}const Kt=r()(r()({},Yt.n7),{side:"left",row:1});class Xt{constructor(){this.location=new Yt.c1(Kt)}get changed(){return this.location.changed}toJSON(){return(0,be.emptyToUndefined)(this.location.toJSON())}reset(){this.location.reset()}restoreState(e){this.location.restoreState(e)}}class Zt extends qt.wv{constructor(e,t,n,i,r){super(e,t.location),this.bindings=n,this.toolBinder=r,this.scroll=document.createElement("div"),this.addTitleBar({title:"Help"});const o=document.createElement("div");o.classList.add("neuroglancer-help-body");const s=this.scroll;s.classList.add("neuroglancer-help-scroll-container"),o.appendChild(s),this.addBody(o);const a=this.registerCancellable((0,st.t)((()=>this.updateView())));this.registerDisposer(r.changed.add(a)),this.registerDisposer(i.layersChanged.add(a)),this.updateView()}updateView(){const e=this.scroll,t=this.bindings,n=this.toolBinder;(0,Ke.gS)(e);const i=new(T());function r(e,t){for(const i of e.parents)void 0!==i.label?o(i.label,i):r(i,t);for(const i of e.bindings.entries()){var n=(0,x.A)(i,2);const e=n[0],r=n[1],o=e.indexOf(":"),s=e.substring(o+1);t.set(s,r.action)}}function o(e,t){if(i.has(t))return;const n={label:e,entries:new(T())};r(t,n.entries),i.set(t,n)}for(const h of t){var s=(0,x.A)(h,2);o(s[0],s[1])}const a=(t,n)=>{let i=document.createElement("h2");i.textContent=t,e.appendChild(i);for(const o of n){var r=(0,x.A)(o,2);const t=r[0],n=r[1];let i=document.createElement("div");i.className="dt",i.textContent=t.split("+").map(Jt).join("+");let s=document.createElement("div");s.className="dd",s.textContent=n,e.appendChild(i),e.appendChild(s)}},l=new(T());for(const h of n.bindings){var c=(0,x.A)(h,2);const e=c[0],t=c[1];let n=l.get(t.layer);void 0===n&&(n=[],l.set(t.layer,n)),n.push(["shift+key".concat(e.toLowerCase()),t.description])}const d=it()(l.entries());d.length>0&&(d[0][0].manager.root.layerManager.updateNonArchivedLayerIndices(),d.sort(((e,t)=>e[0].managedLayer.nonArchivedLayerIndex-t[0].managedLayer.nonArchivedLayerIndex)));for(const h of d){var u=(0,x.A)(h,2);const e=u[0],t=u[1];t.sort(),a("Tool bindings for layer ".concat(e.managedLayer.nonArchivedLayerIndex+1,": ").concat(e.managedLayer.name),t)}for(const h of i.values())a(h.label,h.entries)}}var Qt=n(281),$t=n.n(Qt),en=n(9176),tn=n.n(en);class nn extends M.O8{constructor(e){super(),this.element=document.createElement("div"),this.parentDisposers=new(T()),this.disabledValue=!1,this.opened=new Xe.IY,this.closed=new Xe.IY;const t=this.element;t.className="neuroglancer-context-menu",t.style.display="none",t.tabIndex=-1,document.body.appendChild(t),void 0!==e&&this.registerParent(e)}get disabled(){return this.disabledValue}set disabled(e){this.disabledValue!==e&&(this.disabledValue=e,e&&this.hide())}get open(){return void 0!==this.menuDisposer}registerParent(e){const t=this.parentDisposers;t.has(e)||t.set(e,(0,M.K6)(e,"contextmenu",(e=>{this.show(e),e.stopPropagation(),e.preventDefault()})))}show(e){if(this.disabledValue)return;this.hide();const t=this.element,n=(0,M.K6)(document,"mousedown",(e=>{e.target instanceof Node&&!t.contains(e.target)&&this.hide()}),!0),i=(0,M.K6)(document,"keydown",(e=>{"Escape"===e.code&&this.hide()}),!0);this.opened.dispatch(),function(e,t){e.style.display="block";const n=e.offsetWidth,i=e.offsetHeight,r=document.documentElement.clientWidth,o=document.documentElement.clientHeight,s=document.documentElement.scrollLeft+Math.min(r-n,t.clientX),a=document.documentElement.scrollTop+Math.min(o-i,t.clientY);e.style.left=s+"px",e.style.top=a+"px"}(t,e),this.menuDisposer=()=>{i(),n(),t.style.display="none"}}unregisterParent(e){const t=this.parentDisposers,n=t.get(e);void 0!==n&&(n(),t.delete(e))}disposed(){const e=this.parentDisposers;for(const t of e.values())t();e.clear(),(0,Ke.fh)(this.element)}hide(){void 0!==this.menuDisposer&&(this.menuDisposer(),this.menuDisposer=void 0,this.closed.dispatch())}}var rn=n(9548),on=n(5792),sn=n.n(on),an=n(3819);function ln(e){return(0,an.aO)((new TextEncoder).encode(e))}function cn(e,t){var n;if(e.startsWith(t))try{const i=(n=e.substring(t.length),(new TextDecoder).decode((0,an.MT)(n)));return JSON.parse(i)}catch(i){return}}let dn;function un(e,t){return e.dataTransfer.dropEffect=t,dn=t,t}function hn(){return dn}const pn="neuroglancer-layer\0";let fn;function gn(e,t){var n,i,r;let o;e.dataTransfer.setData((i=pn,r=t.layers.map((e=>({name:e.name,visible:e.visible}))),i+ln(s()(r))),s()({layers:t.layers.map((e=>e.toJSON())),layout:t.layoutSpec})),void 0!==fn&&fn.disposer();let a=()=>{t.manager.unregisterDisposer(a);for(const e of t.layers)e.dispose();t.manager.dispose(),fn===o&&(fn=void 0)};fn=o={manager:t.manager.addRef(),layers:t.layers.map((e=>e.addRef())),layoutSpec:t.layoutSpec,isLayerListPanel:null!==(n=t.isLayerListPanel)&&void 0!==n&&n,disposer:a}}function mn(){if(void 0!==fn){if("move"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"none")){const e=new(k())(fn.layers);fn.manager.layerManager.filter((t=>!e.has(t)))}fn.disposer()}}function vn(e){return function(e,t){for(const n of e){const e=cn(n,t);if(void 0!==e)return{parameters:e,dragType:n}}}(e.dataTransfer.types,pn)}function yn(e){if(void 0!==fn&&fn.manager.rootLayers===e.rootLayers)return fn}class bn{initializeExternalLayers(e){const t=this.dragType;if(void 0!==t)try{var n=JSON.parse(e.dataTransfer.getData(t));const r=n.layers,o=n.layout;if(!Array.isArray(r)||this.numSourceLayers!==r.length)throw new Error("Invalid layer drop data");this.layoutSpec=o;for(const e of this.layers){var i=(0,x.A)(e,2);const t=i[0],n=i[1];(0,B.G$)(t,r[n])}}catch(r){return!1}return!0}updateArchiveStates(e){const t=this.targetIsLayerListPanel,n=e.dataTransfer.dropEffect;for(const i of this.layers.keys()){let e=t;t&&!i.archived&&"copy"!==n&&this.sourceIsLayerListPanel&&(e=!1),(i.archived!==e||e&&i.visible)&&(i.archived=e,e&&(i.visible=!1),i.layerChanged.dispatch())}}get method(){return void 0!==this.sourceManager?this.manager===this.sourceManager&&this.sourceIsLayerListPanel===this.targetIsLayerListPanel?"move":"link":"copy"}compatibleWithMethod(e){return this.method===e||(!this.forceCopy||"copy"===e)&&(!this.moveSupported&&"move"===e)}}function Sn(e,t,n){let i;i=e.shiftKey?"copy":e.ctrlKey&&n?"move":t;let r="";const o=e=>{""!==r&&(r+=", "),r+=e};return"none"!==t&&i!==t&&(e.shiftKey?o("release SHIFT to ".concat(t)):o("release CONTROL to ".concat(t))),"copy"!==i&&o("hold SHIFT to copy"),"move"!==i&&n&&"move"!==t&&o("hold CONTROL to move"),{dropEffect:i,dropEffectMessage:r}}function wn(e,t,n,i){const r=yn(t);let o,s=!1;return void 0===r?o="copy":i?(r.isLayerListPanel||(s=!0),o="link"):r.manager===t&&r.isLayerListPanel===n?(o="move",s=!0):n?o="none":(r.isLayerListPanel||(s=!0),o="link"),Sn(e,o,s)}function xn(e,t,n){const i=n.forceCopy,r=n.newTarget;var o=n.isLayerListPanel;const s=void 0!==o&&o,a=yn(t);if(!i&&void 0!==a){const e=!r&&a.manager===t&&(a.isLayerListPanel===s||a.isLayerListPanel),n=new bn;return n.manager=t,n.numSourceLayers=a.layers.length,n.sourceManager=a.manager,n.targetIsLayerListPanel=s,n.sourceIsLayerListPanel=a.isLayerListPanel,n.moveSupported=e,n.layers=new(T()),n.forceCopy=!1,n.layoutSpec=a.layoutSpec,e?a.layers.forEach(((e,t)=>{n.layers.set(e,t)})):a.layers.forEach(((e,i)=>{!r&&t.layerManager.has(e)||n.layers.set(e.addRef(),i)})),n}const l=vn(e);if(void 0!==l)try{const e=(0,be.parseArray)(l.parameters,((e,n)=>{const i=(0,be.verifyObjectProperty)(e,"name",be.verifyString);let r=(0,be.verifyObjectProperty)(e,"visible",be.verifyBoolean);const o=new B.Qk(i,t);return s&&(r=!1),o.visible=r,o.archived=s,[o,n]})),n=new bn;return n.numSourceLayers=e.length,n.targetIsLayerListPanel=s,n.sourceIsLayerListPanel=!1,n.sourceManager=void 0,n.moveSupported=!1,n.forceCopy=void 0!==a,n.manager=t,n.dragType=l.dragType,n.layers=new(T())(e),n}catch(c){}}function Cn(e,t){return!e.moveSupported&&(e.manager.layerManager.filter((t=>!e.layers.has(t))),void 0!==t&&e.layers.has(t))}function kn(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];function r(t,r){let o=e.dropLayers;var s=r?wn(t,e.manager,i,!1):{dropEffect:hn(),dropEffectMessage:""};const a=s.dropEffect,l=s.dropEffectMessage;if(void 0===a)return;un(t,a);let c=!0;if(void 0===o||o.compatibleWithMethod(a)||(e.dropLayers=void 0,!Cn(o,n))){if(void 0===o){if(o=e.dropLayers=xn(t,e.manager,{forceCopy:"copy"===a,newTarget:!1,isLayerListPanel:i}),void 0===o)return;c="move"===o.method}if(void 0!==n&&o.layers.has(n))return{dropLayers:o,dropEffect:a,dropEffectMessage:l};if(c){const t=e.manager.layerManager,i=new(k());let r=Number.POSITIVE_INFINITY;const s=t.managedLayers=t.managedLayers.filter(((e,t)=>!o.layers.has(e)||(r===Number.POSITIVE_INFINITY&&(r=t),i.add(e),!1)));let a;void 0!==n?(a=s.indexOf(n),r<=a&&++a):a=s.length;for(const e of o.layers.keys())i.has(e)||o.layers.delete(e);s.splice(a,0,...o.layers.keys()),t.layersChanged.dispatch()}else{let t;void 0!==n&&(t=e.manager.layerManager.managedLayers.indexOf(n));for(const n of o.layers.keys())e.manager.add(n,t)}return{dropLayers:o,dropEffect:a,dropEffectMessage:l}}}t.addEventListener("dragenter",(t=>{void 0!==r(t,!0)?t.preventDefault():(0,rn.m)(e.element,"drop")})),t.addEventListener("drop",(t=>{var n;t.preventDefault(),e.dragEnterCount=0,(0,rn.m)(e.element,"drop");const i=null===(n=r(t,!1))||void 0===n?void 0:n.dropLayers;e.dropLayers=void 0,void 0!==i&&(i.initializeExternalLayers(t)?(i.updateArchiveStates(t),mn("move"===i.method?void 0:t.dataTransfer.dropEffect)):Cn(i))})),t.addEventListener("dragover",(t=>{const n=r(t,!0);if(void 0===n)return void(0,rn.m)(e.element,"drop");const i=n.dropLayers,o=n.dropEffect,s=n.dropEffectMessage,a=i.layers.size;let l="";const c=1===i.numSourceLayers?"":"s",d=i.numSourceLayers;if("none"===o)l="Cannot link dragged layer".concat(c," here");else{const e=d===a?"".concat(d):"".concat(a,"/").concat(d);l="Drop to ".concat(o," ").concat(e," layer").concat(c)}s&&(l+=" (".concat(s,")")),(0,rn.H)(e.element,"drop",l),t.preventDefault(),t.stopPropagation()}))}function En(e,t,n,i){t.draggable=!0,t.addEventListener("dragstart",(r=>{(0,rn.H)(t,"drag","Drag layer to another layer bar/panel (including in another Neuroglancer window), or to the left/top/right/bottom edge of a layer group"),gn(r,{manager:e.manager,layers:[n],layoutSpec:i.getLayoutSpec(),isLayerListPanel:i.isLayerListPanel}),r.stopPropagation()})),t.addEventListener("dragend",(()=>{(0,rn.m)(t,"drag"),mn()}))}function Tn(e){e.element.addEventListener("dragenter",(()=>{++e.dragEnterCount})),e.element.addEventListener("dragleave",(()=>{if(0!==--e.dragEnterCount)return;(0,rn.m)(e.element,"drop");const t=e.dropLayers;void 0!==t&&(Cn(t),e.manager.layerManager.layersChanged.dispatch(),e.dropLayers=void 0)}))}var Ln=n(3141),Pn=n(6410),Dn=n(3606),Mn=n(575);class In extends M.O8{constructor(e,t){var n;super(),this.layer=e,this.panel=t,this.element=document.createElement("div"),this.layerNumberElement=document.createElement("div"),this.labelElement=document.createElement("div"),this.visibleProgress=document.createElement("div"),this.prefetchProgress=document.createElement("div"),this.labelElementText=document.createTextNode(""),this.valueElement=document.createElement("div"),this.maxLength=0,this.prevValueText="";const i=this.element,r=this.labelElement,o=this.layerNumberElement,s=this.valueElement,a=this.visibleProgress,l=this.prefetchProgress,c=this.labelElementText;i.className="neuroglancer-layer-item neuroglancer-noselect",i.appendChild(a),i.appendChild(l),r.className="neuroglancer-layer-item-label",r.appendChild(c),a.className="neuroglancer-layer-item-visible-progress",l.className="neuroglancer-layer-item-prefetch-progress",o.className="neuroglancer-layer-item-number",s.className="neuroglancer-layer-item-value";const d=document.createElement("div");d.className="neuroglancer-layer-item-value-container";const u=document.createElement("div");u.className="neuroglancer-layer-item-button-container";const h=(0,Ln.j)();h.title="Remove layer from this layer group";const p=(0,Ln.Y)();p.title="Refresh data",this.registerEventListener(p,"click",(e=>{e.stopPropagation();const t=this.layer.layer;if(t&&t.dataSources&&t.dataSources[0].loadState){const e=t.dataSources[0].loadState;if(e instanceof Mn.eE){const t=e.dataSource;if(t&&t.subsources[0]&&t.subsources[0].subsource){const e=t.subsources[0].subsource.annotation;(null===e||void 0===e?void 0:e.invalidateCache)&&e.invalidateCache()}}}})),h.addEventListener("click",(e=>{this.panel.layerManager===this.panel.manager.rootLayers?this.layer.setArchived(!0):this.layer.containers.size>2?this.panel.layerManager.removeManagedLayer(this.layer):this.layer.setArchived(!0),e.stopPropagation()}));const f=(0,Pn.w)();f.title="Delete this layer",f.addEventListener("click",(e=>{(0,B.TC)(this.layer),e.stopPropagation()})),i.appendChild(o),d.appendChild(s),d.appendChild(u),u.appendChild(h),u.appendChild(f),i.appendChild(r),(null===(n=e.layer)||void 0===n?void 0:n.allowingRefresh)&&i.appendChild(p),i.appendChild(d);const g=this.registerDisposer(new Dn.uf(e.localPosition,e.localCoordinateSpaceCombiner,{copyButton:!1}));i.appendChild(g.element),g.element.addEventListener("click",(e=>{e.stopPropagation()})),g.element.addEventListener("dblclick",(e=>{e.stopPropagation()})),i.addEventListener("click",(n=>{n.ctrlKey?t.selectedLayer.toggle(e):n.altKey?e.pickEnabled=!e.pickEnabled:e.setVisible(!e.visible)})),i.addEventListener("contextmenu",(n=>{t.selectedLayer.layer=e,t.selectedLayer.visible=!0,n.stopPropagation(),n.preventDefault()})),En(t,i,e,{getLayoutSpec:()=>t.getLayoutSpecForDrag()}),kn(this.panel,i,this.layer)}update(){const e=this.layer,t=this.element;this.labelElementText.textContent=e.name,t.dataset.visible=e.visible.toString(),t.dataset.selected=(e===this.panel.selectedLayer.layer).toString(),t.dataset.pick=e.pickEnabled.toString();let n="Click to ".concat(e.visible?"hide":"show",", control+click to show side panel");e.supportsPickOption&&(n+=", alt+click to ".concat(e.pickEnabled?"disable":"enable"," spatial object selection")),n+=", drag to move, shift+drag to copy",t.title=n}disposed(){this.element.remove(),super.disposed()}}class Rn extends M.O8{constructor(e,t,n,i,r,o){super(),this.display=e,this.manager=t,this.viewerNavigationState=n,this.selectedLayer=i,this.getLayoutSpecForDrag=r,this.showLayerHoverValues=o,this.layerWidgets=new(T()),this.element=document.createElement("div"),this.layerUpdateNeeded=!0,this.valueUpdateNeeded=!1,this.layerWidgetInsertionPoint=document.createElement("div"),this.positionWidget=this.registerDisposer(new Dn.uf(this.viewerNavigationState.position.value,this.manager.root.coordinateSpaceCombiner)),this.dragEnterCount=0,this.scheduleUpdate=this.registerCancellable((0,st.t)((()=>this.update()))),this.registerDisposer(i);const s=this.element;s.className="neuroglancer-layer-panel",this.registerDisposer(t.layerSelectedValues.changed.add((()=>{this.handleLayerValuesChanged()}))),this.registerDisposer(t.layerManager.layersChanged.add((()=>{this.handleLayersChanged()}))),this.registerDisposer(i.changed.add((()=>{this.handleLayersChanged()}))),this.registerDisposer(o.changed.add((()=>{this.handleLayerItemValueChanged()}))),this.element.dataset.showHoverValues=this.showLayerHoverValues.value.toString(),this.layerWidgetInsertionPoint.style.display="none",this.element.appendChild(this.layerWidgetInsertionPoint);let a=(0,Gt.m)({svg:sn(),title:"Click to add layer, control+click/right click/\u2318+click to add local annotation layer."});a.classList.add("neuroglancer-layer-add-button");let l=this.dropZone=document.createElement("div");l.className="neuroglancer-layer-panel-drop-zone";const c=e=>{if(e.ctrlKey||e.metaKey||"contextmenu"===e.type){const e=(0,B.Ar)(this.manager,"annotation",{type:"annotation",source:"local://annotations"});this.manager.add(e),this.selectedLayer.layer=e,this.selectedLayer.visible=!0}else this.addLayerMenu()};this.registerEventListener(a,"click",c),this.registerEventListener(a,"contextmenu",c),s.appendChild(a),s.appendChild(l),this.registerDisposer(function(e){return e.draggable=!0,(0,M.K6)(e,"dragstart",(e=>{e.stopPropagation(),e.preventDefault()}))}(a)),s.appendChild(this.positionWidget.element);const d=()=>{const e=this.viewerNavigationState.position.link.value;this.positionWidget.element.style.display=e===D.hb.LINKED?"none":""};this.registerDisposer(this.viewerNavigationState.position.link.changed.add(d)),d(),this.update(),this.updateChunkStatistics(),Tn(this),kn(this,l,void 0),this.registerDisposer(e.updateStarted.add((()=>this.updateLayers()))),this.registerDisposer(t.chunkManager.layerChunkStatisticsUpdated.add(this.registerCancellable((0,st.t)((()=>this.updateChunkStatistics())))))}get layerManager(){return this.manager.layerManager}disposed(){this.layerWidgets.forEach((e=>e.dispose())),this.layerWidgets=void 0,(0,Ke.fh)(this.element),super.disposed()}handleLayersChanged(){this.layerUpdateNeeded=!0,this.handleLayerValuesChanged()}handleLayerValuesChanged(){this.valueUpdateNeeded||(this.valueUpdateNeeded=!0,this.scheduleUpdate())}handleLayerItemValueChanged(){this.element.dataset.showHoverValues=this.showLayerHoverValues.value.toString()}update(){if(this.valueUpdateNeeded=!1,this.updateLayers(),!1===this.showLayerHoverValues.value)return;let e=this.manager.layerSelectedValues;for(let n of this.layerWidgets){var t=(0,x.A)(n,2);let i=t[0],r=t[1],o=i.layer,s="";if(null!==o){let t=e.get(o);if(void 0!==t){const e=t.value;void 0!==e&&(s=""+e)}}if(s!==r.prevValueText){if(r.prevValueText=s,s.length>r.maxLength){const e=r.maxLength=s.length;r.valueElement.style.width="".concat(e,"ch")}r.valueElement.textContent=s}}}updateChunkStatistics(){for(const t of this.layerWidgets){var e=(0,x.A)(t,2);const n=e[0],i=e[1];let r=0,o=0,s=0,a=0;const l=n.layer;if(null!==l)for(const e of l.renderLayers){const t=e.layerChunkProgressInfo;r+=t.numVisibleChunksNeeded,o+=t.numVisibleChunksAvailable,s+=t.numPrefetchChunksNeeded,a+=t.numPrefetchChunksAvailable}i.visibleProgress.style.width="".concat(o/Math.max(1,r)*100,"%"),i.prefetchProgress.style.width="".concat(a/Math.max(1,s)*100,"%")}}updateLayers(){var e;if(!this.layerUpdateNeeded)return;this.layerUpdateNeeded=!1;let t=this.element,n=new(k()),i=this.layerWidgetInsertionPoint.nextElementSibling;this.manager.rootLayers.updateNonArchivedLayerIndices();for(const o of this.manager.layerManager.managedLayers){if(o.archived&&!(null===(e=this.dropLayers)||void 0===e?void 0:e.layers.has(o)))continue;n.add(o);let r=this.layerWidgets.get(o);const s=o.nonArchivedLayerIndex;void 0===r&&(r=new In(o,this),this.layerWidgets.set(o,r)),r.layerNumberElement.textContent=""+(1+s),r.update();let a=r.element;a!==i&&t.insertBefore(r.element,i),i=a.nextElementSibling}for(let o of this.layerWidgets){var r=(0,x.A)(o,2);let e=r[0],t=r[1];n.has(e)||(this.layerWidgets.delete(e),t.dispose())}}addLayerMenu(){(0,B.ZV)(this.manager,this.selectedLayer)}}function An(e,t){const n=(0,M.K6)(e,"drop",(e=>{if(e.preventDefault(),-1!==e.dataTransfer.types.indexOf(Dn.sd)){e.stopPropagation();const n=(0,be.verifyObject)(JSON.parse(e.dataTransfer.getData(Dn.sd))),i=(0,be.verifyObjectProperty)(n,"dimensions",y.tJ),r=(0,be.verifyObjectProperty)(n,"position",(e=>(0,be.parseArray)(e,be.verifyFiniteFloat)));if(r.length!==i.length)throw new Error("length mismatch between position and dimensions");const o=r.length,s=t.coordinateSpace.value.names,a=t.value;for(let e=0;e<o;++e){const t=s.indexOf(i[e]);-1!==t&&(a[t]=r[e])}t.changed.dispatch()}})),i=e=>{-1!==e.dataTransfer.types.indexOf(Dn.sd)&&(e.dataTransfer.dropEffect="link",e.preventDefault(),e.stopPropagation())},r=(0,M.K6)(e,"dragenter",i),o=(0,M.K6)(e,"dragover",i);return()=>{r(),o(),n()}}var On=n(7372);const Nn="neuroglancer-layer-group-viewer";function _n(e){return-1!==e.dataTransfer.types.indexOf(Nn)}let Vn;function Bn(e,t){const n=function(e){return Vn&&Vn.viewer.layerSpecification.rootLayers===e.rootLayers?Vn.viewer:void 0}(t);let i,r=!1;return void 0===n||n.layerSpecification===n.layerSpecification.root?i="copy":(r=!0,i="move"),Sn(e,i,r)}class Fn extends M.O8{constructor(e){super(),this.relativeDisplayScales=new D.zX(e.navigationState.pose.relativeDisplayScales.addRef()),this.displayDimensions=new D.Dm(e.navigationState.pose.displayDimensions.addRef()),this.position=new D.ru(e.navigationState.position.addRef()),this.crossSectionOrientation=new D.Ti(e.navigationState.pose.orientation.addRef()),this.displayDimensionRenderInfo=this.registerDisposer(new D.Ey(this.relativeDisplayScales.value,this.displayDimensions.value)),this.crossSectionScale=new D.MT(e.navigationState.zoomFactor.addRef(),this.displayDimensionRenderInfo.addRef()),this.crossSectionDepthRange=new D.QA(e.navigationState.depthRange.addRef(),this.displayDimensionRenderInfo),this.projectionDepthRange=new D.QA(e.perspectiveNavigationState.depthRange.addRef(),this.displayDimensionRenderInfo),this.navigationState=this.registerDisposer(new D.kt(new D.aI(this.position.value,this.displayDimensionRenderInfo.addRef(),this.crossSectionOrientation.value),this.crossSectionScale.value,this.crossSectionDepthRange.value)),this.projectionOrientation=new D.Ti(e.perspectiveNavigationState.pose.orientation.addRef()),this.projectionScale=new D.MT(e.perspectiveNavigationState.zoomFactor.addRef(),this.displayDimensionRenderInfo.addRef()),this.projectionNavigationState=this.registerDisposer(new D.kt(new D.aI(this.position.value.addRef(),this.displayDimensionRenderInfo.addRef(),this.projectionOrientation.value),this.projectionScale.value,this.projectionDepthRange.value))}copyToParent(){for(const e of[this.relativeDisplayScales,this.displayDimensions,this.position,this.crossSectionOrientation,this.crossSectionScale,this.projectionOrientation,this.projectionScale])e.copyToPeer()}register(e){e.add("dimensionRenderScales",this.relativeDisplayScales),e.add("displayDimensions",this.displayDimensions),e.add("position",(0,D.fj)(this.position)),e.add("crossSectionOrientation",this.crossSectionOrientation),e.add("crossSectionScale",this.crossSectionScale),e.add("crossSectionDepth",this.crossSectionDepthRange),e.add("projectionOrientation",this.projectionOrientation),e.add("projectionScale",this.projectionScale),e.add("projectionDepth",this.projectionDepthRange)}}class Un extends M.O8{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.element=e,this.viewerState=t,this.state=new Ze.dp,this.options=r()({showLayerPanel:new he.C_(!0),showViewerMenu:!1,showLayerHoverValues:new he.C_(!0)},n),this.layerSpecification=this.registerDisposer(t.layerSpecification),this.viewerNavigationState=this.registerDisposer(new Fn(t)),this.viewerNavigationState.register(this.state),this.layerSpecification instanceof B.R8?this.state.add("layers",this.layerSpecification):this.state.add("layers",{changed:this.layerSpecification.changed,toJSON:()=>this.layerSpecification.layerManager.managedLayers.map((e=>e.name)),reset:()=>{throw new Error("not implemented")},restoreState:()=>{throw new Error("not implemented")}}),e.classList.add("neuroglancer-layer-group-viewer"),this.registerDisposer(new W.j(e)),this.layout=this.registerDisposer(new Ot(this,"xy")),this.state.add("layout",this.layout),this.registerActionBindings(),this.registerDisposer(this.layerManager.useDirectly()),this.registerDisposer(An(e,this.navigationState.position)),this.registerDisposer(this.options.showLayerPanel.changed.add(this.registerCancellable(m()((()=>this.updateUI()),0)))),this.makeUI()}get perspectiveNavigationState(){return this.viewerNavigationState.projectionNavigationState}get navigationState(){return this.viewerNavigationState.navigationState}get selectionDetailsState(){return this.layerSpecification.root.selectionState}get display(){return this.viewerState.display}get selectedLayer(){return this.viewerState.selectedLayer}get layerManager(){return this.layerSpecification.layerManager}get chunkManager(){return this.layerSpecification.chunkManager}get mouseState(){return this.viewerState.mouseState}get showAxisLines(){return this.viewerState.showAxisLines}get wireFrame(){return this.viewerState.wireFrame}get showScaleBar(){return this.viewerState.showScaleBar}get showPerspectiveSliceViews(){return this.viewerState.showPerspectiveSliceViews}get inputEventBindings(){return this.viewerState.inputEventBindings}get visibility(){return this.viewerState.visibility}get visibleLayerRoles(){return this.viewerState.visibleLayerRoles}get crossSectionBackgroundColor(){return this.viewerState.crossSectionBackgroundColor}get perspectiveViewBackgroundColor(){return this.viewerState.perspectiveViewBackgroundColor}get scaleBarOptions(){return this.viewerState.scaleBarOptions}get changed(){return this.state.changed}bindAction(e,t){this.registerDisposer((0,H.qZ)(this.element,e,t))}registerActionBindings(){this.bindAction("add-layer",(()=>{this.layerPanel&&this.layerPanel.addLayerMenu()})),this.bindAction("t-",(()=>{this.navigationState.pose.translateNonDisplayDimension(0,-1)})),this.bindAction("t+",(()=>{this.navigationState.pose.translateNonDisplayDimension(0,1)}))}toJSON(){return r()({type:"viewer"},this.state.toJSON())}reset(){this.state.reset()}restoreState(e){this.state.restoreState(e),(0,Ze.wX)(e,"crossSectionZoom",(0,D.fj)(this.viewerNavigationState.crossSectionScale)),(0,Ze.wX)(e,"perspectiveZoom",(0,D.fj)(this.viewerNavigationState.projectionScale)),(0,Ze.wX)(e,"perspectiveOrientation",this.viewerNavigationState.projectionOrientation)}makeUI(){this.element.style.flex="1",this.element.style.display="flex",this.element.style.flexDirection="column",this.element.appendChild(this.layout.element),this.updateUI()}updateUI(){const e=this.options,t=e.showLayerPanel.value;if(void 0!==this.layerPanel&&!t)return this.layerPanel.dispose(),void(this.layerPanel=void 0);if(t&&void 0===this.layerPanel){const t=this.layerPanel=new Rn(this.display,this.layerSpecification,this.viewerNavigationState,this.viewerState.selectedLayer.addRef(),(()=>this.layout.toJSON()),this.options.showLayerHoverValues);if(e.showViewerMenu?(t.registerDisposer(function(e,t){const n=new nn(e),i=n.element;i.classList.add("neuroglancer-layer-group-viewer-context-menu");const r=document.createElement("button");r.textContent="Remove layer group",i.appendChild(r),n.registerEventListener(r,"click",(()=>{t.layerSpecification.layerManager.clear()}));const o=t.viewerNavigationState;for(const a of[["Render scale factors",o.relativeDisplayScales.link],["Render dimensions",o.displayDimensions.link],["Position",o.position.link],["Cross-section orientation",o.crossSectionOrientation.link],["Cross-section zoom",o.crossSectionScale.link],["Cross-section depth range",o.crossSectionDepthRange.link],["3-D projection orientation",o.projectionOrientation.link],["3-D projection zoom",o.projectionScale.link],["3-D projection depth range",o.projectionDepthRange.link]]){var s=(0,x.A)(a,2);const e=s[0],t=s[1],r=n.registerDisposer(new On.c(t)),o=document.createElement("label");o.style.display="flex",o.style.flexDirection="row",o.style.whiteSpace="nowrap",o.textContent=e,o.appendChild(r.element),i.appendChild(o)}return n}(t.element,this)),t.element.title="Right click for options, drag to move/copy layer group."):t.element.title="Drag to move/copy layer group.","undefined"!==typeof NEUROGLANCER_SHOW_LAYER_BAR_EXTRA_BUTTONS&&!0===NEUROGLANCER_SHOW_LAYER_BAR_EXTRA_BUTTONS){{const e=document.createElement("button");e.textContent="Clear segments",e.title='De-select all objects ("x")',e.addEventListener("click",(e=>{(0,H.Tg)(e,e,{action:"clear-segments"})})),t.element.appendChild(e)}for(const e of["3d","xy","xz","yz"]){const n=document.createElement("button");n.textContent=e,n.title="Switch to ".concat(e," layout"),n.addEventListener("click",(()=>{let t;t=this.layout.name===e?"3d"!==e?"".concat(e,"-3d"):"4panel":e,this.layout.name=t})),t.element.appendChild(n)}}t.element.draggable=!0;const n=t.element;n.addEventListener("dragstart",(e=>{(0,rn.H)(t.element,"drag","Drag layer group to the left/top/right/bottom edge of a layer group, or to another layer bar/panel (including in another Neuroglancer window)"),gn(e,{manager:this.layerSpecification,layers:this.layerManager.managedLayers,layoutSpec:this.layout.toJSON()});const n=()=>{Vn&&Vn.viewer===this&&(Vn=void 0),this.unregisterDisposer(n)};Vn={viewer:this,disposer:n},this.registerDisposer(n);const i=this.toJSON();delete i.layers,e.dataTransfer.setData(Nn,s()(i)),t.element.style.backgroundColor="black",setTimeout((()=>{t.element.style.backgroundColor=""}),0)})),t.element.addEventListener("dragend",(()=>{(0,rn.m)(n,"drag"),mn(),void 0!==Vn&&Vn.viewer===this&&Vn.disposer()})),this.element.insertBefore(n,this.element.firstChild)}}disposed(){(0,Ke.gS)(this.element);const e=this.layerPanel;void 0!==e&&(e.dispose(),this.layerPanel=void 0),super.disposed()}}const zn=tn()("layoutComponentContainer");class jn extends M.O8{constructor(e,t,n){super(),this.viewer=e,this.parent=n,this.changed=new Xe.IY,this.element=document.createElement("div");const i=this.element;i.style.display="flex",i.style.flex="1",i.style.position="relative",i.style.alignItems="stretch",i[zn]=this,this.setSpecification(t);const r=[],o=e=>{const t=document.createElement("div");let n;switch(t.className="neuroglancer-layout-split-drop-zone",t.style[e]="0",e){case"left":case"right":n="row",t.style.width="10px",t.style.height="100%";break;case"top":case"bottom":n="column",t.style.height="10px",t.style.width="100%"}t.style.display="none",r.push({element:t,direction:n,orientation:e}),i.appendChild(t),Hn(t,this.viewer.layerSpecification,(()=>this.split(e).newContainer.component),"row"===n?"column":"row")};o("left"),o("right"),o("top"),o("bottom");let s=!1;i.addEventListener("dragenter",(e=>{if(!s&&void 0!==vn(e)){s=!0;for(const e of r){const t=e.element,i=e.direction,r=e.orientation;if(void 0!==n&&i===n.direction&&(("left"===r||"top"===r)&&n.get(0)!==this||("bottom"===r||"right"===r)&&n.get(n.length-1)!==this))continue;const o=this.component;o instanceof qn&&o.direction===i||(t.style.display="block")}}}),!0),i.addEventListener("drop",(e=>{if(s){s=!1;for(const e of r){e.element.style.display="none"}}}),!0),i.addEventListener("dragleave",(e=>{const t=e.relatedTarget;if(s&&!(t instanceof HTMLElement&&this.element.contains(t))){s=!1;for(const e of r){e.element.style.display="none"}}}),!0)}unsetComponent(){const e=this.componentValue;void 0!==e&&(e.changed.remove(this.changed.dispatch),this.element.removeChild(e.element),e.dispose())}get component(){return this.componentValue}setComponent(e){if(this.unsetComponent(),this.componentValue=e,e.changed.add(this.changed.dispatch),this.element.appendChild(e.element),e instanceof Un){const t=e.layerManager,n=e.registerCancellable(m()((()=>{0===t.managedLayers.length&&this.dispose()}),0));e.registerDisposer(t.layersChanged.add((()=>{0===t.managedLayers.length&&n()}))),n()}else if(e instanceof qn){const t=e.registerCancellable(m()((()=>{const t=e.length;if(0===t&&void 0!==this.parent)this.dispose();else if(1===t){const t=e.get(0).component;let n;if(void 0===this.parent&&t instanceof Un){n=t.layout.specification.toJSON(),t.viewerNavigationState.copyToParent();const e=t.layerManager.managedLayers,i=new(k())(e),r=t.layerSpecification;r.rootLayers.filter((e=>i.has(e)||e.archived));const o=[],s=r.rootLayers.managedLayers;for(let t=0,n=s.length;t<n;++t)i.has(s[t])&&o.push(t);for(let t=0,n=e.length;t<n;++t)s[o[t]]=e[t];r.rootLayers.layersChanged.dispatch()}else n=t.toJSON();this.setSpecification(n)}}),0));e.registerDisposer(e.changed.add((()=>{e.length<2&&t()}))),t()}this.changed.dispatch()}toJSON(){return this.component.toJSON()}setSpecification(e){this.setComponent(function(e,t){const n=document.createElement("div");if(n.style.flex="1",n.style.width="0px","string"===typeof t){if(void 0!==e.parent)throw new Error("Invalid layout component specification: ".concat(s()(t)));return new Wn(n,t,e.viewer)}(0,be.verifyObject)(t);const i=(0,be.verifyObjectProperty)(t,"type",be.verifyString);switch(i){case"row":case"column":return new qn(n,i,(0,be.verifyObjectProperty)(t,"children",(t=>{const n=(0,be.parseArray)(t,(e=>e));if(void 0===e.parent&&0===n.length)throw new Error("Stack layout requires at least one child.");return n})),e);case"viewer":{const i=e.viewer,s=new B.R8(i.layerSpecification.addRef()),a=new Un(n,r()({display:i.display,layerSpecification:s},Gn(i)),{showLayerPanel:i.uiControlVisibility.showLayerPanel,showViewerMenu:!0,showLayerHoverValues:i.uiControlVisibility.showLayerHoverValues});try{a.restoreState(t)}catch(o){throw a.dispose(),o}return a}default:return new Wn(n,t,e.viewer)}}(this,e))}static getFromElement(e){return e[zn]}disposed(){this.unsetComponent(),this.componentValue=void 0,super.disposed()}split(e){const t={type:"viewer"},n=this.parent;if(void 0!==n){if("left"===e&&"row"===n.direction||"top"===e&&"column"===n.direction)return{newContainer:n.insertChild(t,this),existingContainer:this};if("right"===e&&"row"===n.direction||"bottom"===e&&"column"===n.direction)return{newContainer:n.insertChild(t),existingContainer:this}}let i;const r=this.component;let o,s;i=r instanceof Wn?r.layerGroupViewer.toJSON():r.toJSON();const a="left"===e||"right"===e?"row":"column";switch(e){case"left":case"top":o={type:a,children:[t,i]},s=0;break;case"right":case"bottom":o={type:a,children:[i,t]},s=1}this.setSpecification(o);const l=this.component;return{newContainer:l.get(s),existingContainer:l.get(1-s)}}}function Gn(e){return{mouseState:e.mouseState,showAxisLines:e.showAxisLines,wireFrame:e.wireFrame,showScaleBar:e.showScaleBar,scaleBarOptions:e.scaleBarOptions,showPerspectiveSliceViews:e.showPerspectiveSliceViews,inputEventBindings:e.inputEventBindings,visibility:e.visibility,selectedLayer:e.selectedLayer,visibleLayerRoles:e.visibleLayerRoles,navigationState:e.navigationState.addRef(),perspectiveNavigationState:e.perspectiveNavigationState.addRef(),crossSectionBackgroundColor:e.crossSectionBackgroundColor,perspectiveViewBackgroundColor:e.perspectiveViewBackgroundColor}}class Wn extends M.O8{constructor(e,t,n){super(),this.element=e,this.layerGroupViewer=this.registerDisposer(new Un(e,r()({display:n.display,layerSpecification:n.layerSpecification.addRef()},Gn(n)),{showLayerPanel:n.uiControlVisibility.showLayerPanel,showViewerMenu:!1,showLayerHoverValues:n.uiControlVisibility.showLayerHoverValues})),this.layerGroupViewer.layout.restoreState(t)}toJSON(){return this.layerGroupViewer.layout.specification.toJSON()}get changed(){return this.layerGroupViewer.layout.changed}}function Hn(e,t,n,i){e.addEventListener("dragenter",(t=>{void 0!==vn(t)&&e.classList.add("neuroglancer-drag-over")})),e.addEventListener("dragleave",(()=>{(0,rn.m)(e,"drop"),e.classList.remove("neuroglancer-drag-over")})),e.addEventListener("dragover",(n=>{const r=(t,i)=>{t.dropEffectMessage&&(i+=" (".concat(t.dropEffectMessage,")")),(0,rn.H)(e,"drop",i),n.stopPropagation(),n.preventDefault()};if(_n(n)){const e=Bn(n,t);return un(n,e.dropEffect),void r(e,"Drop to ".concat(e.dropEffect," layer group as new ").concat(i))}if(void 0===vn(n));else{const e=function(e,t,n,i){const r=wn(e,t,n,i);return un(e,r.dropEffect),r}(n,t,!1,!0);r(e,"Drop to ".concat(e.dropEffect," layer as new ").concat(i))}})),e.addEventListener("drop",(i=>{let r,o;if(e.classList.remove("neuroglancer-drag-over"),(0,rn.m)(e,"drop"),_n(i)){i.stopPropagation();try{o=JSON.parse(i.dataTransfer.getData(Nn))}catch(a){return}if(r=xn(i,t,{forceCopy:!1,newTarget:!0}),void 0===r)return}else{if(r=xn(i,t,{forceCopy:"copy"===hn(),newTarget:!0}),void 0===r)return;o=r.layoutSpec}if(!r.initializeExternalLayers(i)){if(!r.moveSupported)for(const e of r.layers.keys())e.dispose();return}i.preventDefault();mn(i.dataTransfer.dropEffect=hn());const s=n();r.updateArchiveStates(i);for(const e of r.layers.keys())s.layerSpecification.add(e);try{s.restoreState(o)}catch(l){s.layout.reset()}}))}class qn extends M.O8{constructor(e,t,n,i){super(),this.element=e,this.direction=t,this.container=i,this.changed=new Xe.IY,e.classList.add("neuroglancer-stack-layout"),e.classList.add("neuroglancer-stack-layout-".concat(t)),e.style.display="flex",e.style.flexDirection=t,e.appendChild(this.makeDropPlaceholder(this));for(const r of n)this.insertChild(r)}get length(){return(this.element.childElementCount-1)/2}makeDropPlaceholder(e){const t=document.createElement("div");return t.className="neuroglancer-stack-layout-drop-placeholder",Hn(t,this.viewer.layerSpecification,(()=>{const e=t.nextElementSibling;let n;null!==e&&(n=jn.getFromElement(e));return this.insertChild({type:"viewer",layers:[]},n).component}),"row"===this.direction?"column":"row"),e.registerDisposer((()=>{(0,Ke.fh)(t)})),t}get viewer(){return this.container.viewer}get(e){return jn.getFromElement(this.element.children[2*e+1])}insertChild(e,t){const n=new jn(this.viewer,e,this),i=this.makeDropPlaceholder(n);n.element.classList.add("neuroglancer-stack-layout-child"),n.registerDisposer(n.changed.add(this.changed.dispatch)),n.registerDisposer((()=>{this.element.removeChild(n.element),this.changed.dispatch()}));const r=void 0!==t?t.element:null;return this.element.insertBefore(n.element,r),this.element.insertBefore(i,r),this.changed.dispatch(),n}disposed(){this.clear(),super.disposed()}clear(){for(;0!==this.length;)this.get(0).dispose()}*[$t()](){const e=this.length;for(let t=0;t<e;++t)yield this.get(t)}toJSON(){return{type:this.direction,children:it()(this).map((e=>e.toJSON()))}}}class Yn extends M.O8{constructor(e,t){super(),this.viewer=e,this.defaultSpecification=t,this.container=this.registerDisposer(new jn(this.viewer,this.defaultSpecification,void 0))}get changed(){return this.container.changed}get element(){return this.container.element}reset(){this.container.setSpecification(this.defaultSpecification)}restoreState(e){this.container.setSpecification(e)}disposed(){super.disposed()}toJSON(){return this.container.toJSON()}}var Jn=n(7445),Kn=n(2667),Xn=n.n(Kn),Zn=n(2383),Qn=n.n(Zn),$n=n(9230),ei=n.n($n),ti=n(8868),ni=n(7921),ii=n(8946);const ri=J.n5.fromObject({escape:{action:"cancel"}});class oi extends M.O8{constructor(e){super(),this.layer=e,this.element=document.createElement("input");const t=this.element;t.classList.add("neuroglancer-layer-side-panel-name"),t.spellcheck=!1,t.autocomplete="off";this.registerDisposer(new q.cL(t,ri)).allShortcutsAreGlobal=!0,(0,q.qZ)(t,"cancel",(e=>{this.updateView(),t.blur(),e.stopPropagation(),e.preventDefault()})),t.title="Rename layer",this.registerDisposer(e.layerChanged.add((()=>this.updateView()))),t.addEventListener("change",(()=>this.updateModel())),t.addEventListener("blur",(()=>this.updateModel())),this.updateView()}updateView(){this.element.value=this.layer.name}updateModel(){(0,B.Rs)(this.layer,this.element.value)}}class si extends M.O8{constructor(e){super(),this.layer=e,this.element=document.createElement("select"),this.measureElement=document.createElement("div");const t=this.element,n=this.measureElement;t.classList.add("neuroglancer-layer-side-panel-type"),n.classList.add("neuroglancer-layer-side-panel-type-measure"),t.title="Change layer type",document.body.appendChild(n);for(const r of B.vK){var i=(0,x.A)(r,2);const e=i[0],n=i[1];if(n.type!==e)continue;const o=document.createElement("option");o.textContent=n.typeAbbreviation,o.value=e,t.appendChild(o)}t.addEventListener("change",(()=>{const e=t.value,n=B.vK.get(e);(0,B.QG)(this.layer.managedLayer,n)})),this.updateView()}updateView(){const e=this.layer.type,t=this.element,n=this.measureElement;n.textContent=this.layer.constructor.typeAbbreviation,t.value=e,t.style.width="".concat(n.offsetWidth,"px")}disposed(){this.measureElement.remove()}}class ai extends qt.wv{constructor(e,t){super(e,t.location),this.panelState=t;const n=this.layer=t.layer,i=this.element;const o=this.addTitleBar({}).titleBar;o.classList.add("neuroglancer-layer-side-panel-title"),o.appendChild(this.registerDisposer(new si(n)).element),o.appendChild(this.registerDisposer(new oi(n.managedLayer)).element),this.registerDisposer((0,ye.W1)((e=>{i.dataset.neuroglancerLayerVisible=e.toString()}),{get value(){return n.managedLayer.visible},changed:n.managedLayer.layerChanged}));const a=this.registerDisposer(new ni.R({get value(){return n.managedLayer.pickEnabled},set value(e){n.managedLayer.pickEnabled=e},changed:n.managedLayer.layerChanged},{svg:ei(),enableTitle:"Spatial object selection: disabled",disableTitle:"Spatial object selection: enabled"}));this.registerDisposer(new he.cY({get value(){return n.managedLayer.supportsPickOption},changed:n.managedLayer.layerChanged},a.element)),o.appendChild(a.element);const l={get value(){return t!==n.panels.panels[0]},set value(e){e?t.pin():t.unpin()},changed:n.manager.root.layerManager.layersChanged};o.appendChild(this.registerDisposer(new ni.R(l,{text:"\ud83d\udccc\ufe0e",enableTitle:"Pin panel to this layer",disableTitle:"Unpin panel to this layer"})).element),this.registerDisposer((0,ye.W1)((e=>{i.dataset.neuroglancerLayerPanelPinned=e.toString()}),l)),o.appendChild((0,Pn.w)({title:"Delete layer",onClick:()=>{(0,B.TC)(this.layer.managedLayer)}})),this.tabView=new ii.JQ({makeTab:e=>n.tabs.options.get(e).getter(),selectedTab:t.selectedTab,tabs:this.registerDisposer(new ye.pz({get value(){return t.tabs.map((e=>({id:e,label:n.tabs.options.get(e).label})))},changed:t.tabsChanged})),handleTabElement:(e,i)=>{i.draggable=!0,i.addEventListener("dragstart",(o=>{o.stopPropagation(),o.dataTransfer.setData("neuroglancer-side-panel","");let a="Drag tab to dock as new panel to the left/right/top/bottom of another panel";t.panels.panels.find((e=>e!==t&&e.location.visible))&&(a+=", or move tab to other ".concat(s()(n.managedLayer.name)," panel")),(0,rn.H)(i,"drag",a),this.sidePanelManager.startDrag({dropAsNewPanel:t=>{this.panelState.splitOffTab(e,r()(r()({},ti.ri),t))},canDropAsTabs:e=>e instanceof ai&&e.layer===this.layer&&e!==this?1:0,dropAsTab:t=>{this.panelState.moveTabTo(e,t.panelState)}},o)})),i.addEventListener("dragend",(e=>{(0,rn.m)(i,"drag"),this.sidePanelManager.endDrag()}))}},this.visibility),this.tabView.element.style.flex="1",this.tabView.element.classList.add("neuroglancer-layer-side-panel-tab-view"),this.tabView.element.style.position="relative",this.tabView.element.appendChild(this.makeTabDropZone()),this.addBody(this.tabView.element),this.registerDisposer(t.tabsChanged.add((()=>{0===t.tabs.length&&(this.location.visible=!1)})))}makeDragSource(){return r()(r()({},super.makeDragSource()),{canDropAsTabs:e=>e instanceof ai&&e.layer===this.layer&&e!==this?this.panelState.tabs.length:0,dropAsTab:e=>{this.panelState.mergeInto(e.panelState)}})}makeTabDropZone(){const e=document.createElement("div");return e.className="neuroglancer-side-panel-drop-zone",e.style.position="absolute",e.style.left="20px",e.style.right="20px",e.style.bottom="20px",e.style.top="20px",e.addEventListener("dragenter",(t=>{var n;const i=this.sidePanelManager.dragSource,r=null===(n=null===i||void 0===i?void 0:i.canDropAsTabs)||void 0===n?void 0:n.call(i,this);r&&(e.classList.add(qt.oY),(0,rn.H)(e,"drop","Move ".concat(r," ").concat(1===r?"tab":"tabs"," to this panel")),t.preventDefault())})),e.addEventListener("dragleave",(()=>{(0,rn.m)(e,"drop"),e.classList.remove(qt.oY)})),e.addEventListener("dragover",(e=>{var t;const n=this.sidePanelManager.dragSource;(null===(t=null===n||void 0===n?void 0:n.canDropAsTabs)||void 0===t?void 0:t.call(n,this))&&e.preventDefault()})),e.addEventListener("drop",(t=>{var n;(0,rn.m)(e,"drop");const i=this.sidePanelManager.dragSource;(null===(n=null===i||void 0===i?void 0:i.canDropAsTabs)||void 0===n?void 0:n.call(i,this))&&(e.classList.remove(qt.oY),i.dropAsTab(this),t.preventDefault(),t.stopPropagation())})),e}}class li extends M.O8{constructor(e,t){super(),this.sidePanelManager=e,this.selectedLayerState=t,this.layerSidePanels=new(T()),this.generation=0,this.layersNeedUpdate=!0;const n=()=>{this.layersNeedUpdate=!0,this.sidePanelManager.display.scheduleRedraw()};this.registerDisposer(t.changed.add(n)),this.registerDisposer(t.layerManager.layersChanged.add(n)),this.registerDisposer(e.beforeRender.add((()=>this.update())))}getSelectedUserLayer(){var e,t;return null!==(t=null===(e=this.selectedLayerState.layer)||void 0===e?void 0:e.layer)&&void 0!==t?t:void 0}update(){var e;if(!this.layersNeedUpdate)return;const t=this.selectedLayerState.layerManager;let n=++this.generation;this.layersNeedUpdate=!1;const i=this.layerSidePanels,r=e=>{let t=i.get(e);void 0===t?(t={generation:n,unregister:this.sidePanelManager.registerPanel({location:e.location,makePanel:()=>new ai(this.sidePanelManager,e)})},i.set(e,t)):t.generation=n};{const t=this.getSelectedUserLayer(),n=this.selectedLayerState.location;if(void 0!==t&&n.visible){null===(e=this.placeholderSelectedLayerPanel)||void 0===e||e.call(this),this.placeholderSelectedLayerPanel=void 0;const i=t.panels.panels[0];i.location.value=n.value,r(i)}else void 0===this.placeholderSelectedLayerPanel&&(this.placeholderSelectedLayerPanel=this.sidePanelManager.registerPanel({location:n,makePanel:()=>new qt.wv(this.sidePanelManager,n)}))}for(const s of t.managedLayers){const e=s.layer;if(null===e)continue;const t=e.panels.panels;for(let n=1,i=t.length;n<i;++n)r(t[n])}for(const s of i){var o=(0,x.A)(s,2);const e=o[0],t=o[1];t.generation!==n&&(t.unregister(),i.delete(e))}}disposed(){var e;null===(e=this.placeholderSelectedLayerPanel)||void 0===e||e.call(this);for(const t of this.layerSidePanels.values()){(0,t.unregister)()}}}const ci=r()(r()({},Yt.n7),{side:"left",row:0});class di{constructor(){this.location=new Yt.c1(ci)}get changed(){return this.location.changed}restoreState(e){void 0!==e&&this.location.restoreState(e)}reset(){this.location.reset()}toJSON(){return(0,be.emptyToUndefined)(this.location.toJSON())}}class ui extends M.O8{constructor(e){super(),this.layer=e,this.element=document.createElement("div");const t=this.element,n=(0,Gt.m)({svg:Qn(),title:"Hide layer",onClick:()=>{this.layer.setVisible(!1)}}),i=(0,Gt.m)({svg:Xn(),title:"Show layer",onClick:()=>{this.layer.setVisible(!0)}});t.appendChild(i),t.appendChild(n);const r=()=>{const e=this.layer.visible;n.style.display=e?"":"none",i.style.display=e?"none":""};r(),this.registerDisposer(e.layerChanged.add(r))}}class hi extends M.O8{constructor(e,t){super(),this.panel=e,this.layer=t,this.element=document.createElement("div"),this.numberElement=document.createElement("div"),this.generation=-1;const n=this.element,i=this.numberElement;n.classList.add("neuroglancer-layer-list-panel-item"),i.classList.add("neuroglancer-layer-list-panel-item-number"),n.appendChild(this.registerDisposer(new he.Fo({get value(){return!t.archived},set value(e){t.setArchived(!e)},changed:t.layerChanged},{enableTitle:"Archive layer (disable and remove from layer groups)",disableTitle:"Unarchive layer (enable and add to all layer groups)"})).element),n.appendChild(i),n.appendChild(this.registerDisposer(new ui(t)).element),n.appendChild(this.registerDisposer(new oi(t)).element),n.appendChild(this.registerDisposer(function(e){const t=e.manager.root.selectedLayer,n=new ni.R({get value(){return t.layer===e&&t.visible},set value(n){n?(t.layer=e,t.visible=!0):t.visible=!1},changed:t.changed},{backgroundScheme:"dark",enableTitle:"Show layer side panel",disableTitle:"Hide layer side panel",svg:l()});return n.element.classList.add("neuroglancer-layer-list-panel-item-controls"),n}(t)).element);const r=(0,Pn.w)({title:"Delete layer",onClick:()=>{(0,B.TC)(this.layer)}});r.classList.add("neuroglancer-layer-list-panel-item-delete"),n.appendChild(r),En(e,n,t,{isLayerListPanel:!0,getLayoutSpec:()=>{}}),kn(e,n,t,!0),n.addEventListener("click",(n=>{n.ctrlKey?(e.selectedLayer.toggle(t),n.preventDefault()):n.altKey&&(t.pickEnabled=!t.pickEnabled,n.preventDefault())})),n.addEventListener("contextmenu",(n=>{e.selectedLayer.toggle(t),n.stopPropagation(),n.preventDefault()}))}}class pi extends qt.wv{constructor(e,t,n){super(e,n.location),this.manager=t,this.state=n,this.items=new(T()),this.itemContainer=document.createElement("div"),this.layerDropZone=document.createElement("div"),this.dragEnterCount=0,this.generation=-1;const i=this.itemContainer,r=this.layerDropZone;const o=this.addTitleBar({title:""}).titleElement;this.titleElement=o,i.classList.add("neuroglancer-layer-list-panel-items"),this.addBody(i),r.style.flex="1";const s=this.registerCancellable((0,st.t)((()=>this.render())));this.visibility.changed.add(s),this.registerDisposer(this.layerManager.layersChanged.add(s)),this.registerDisposer(this.selectedLayer.changed.add(s)),Tn(this),kn(this,r,void 0,!0),this.render()}get layerManager(){return this.manager.layerManager}get selectedLayer(){return this.manager.selectedLayer}render(){const e=this,t=this.selectedLayer.layer,n=++this.generation;let i=0,r=0,o=0;this.layerManager.updateNonArchivedLayerIndices(),(0,Ke.bu)(this.itemContainer,function*(){const s=e.items;let a=0;for(const t of e.layerManager.managedLayers)t.archived||++a;const l="".concat((a+1).toString().length,"ch");for(const d of e.layerManager.managedLayers){d.visible?++i:d.archived?++o:++r;let a=s.get(d);void 0===a?(a=e.registerDisposer(new hi(e,d)),s.set(d,a),a.generation=n):a.generation=n;const c=d.nonArchivedLayerIndex;a.numberElement.style.width=l,-1===c?a.numberElement.style.visibility="hidden":(a.numberElement.style.visibility="",a.numberElement.textContent="".concat(c+1)),a.element.dataset.selected=(d===t).toString(),a.element.dataset.archived=d.archived.toString(),yield a.element}for(const t of s){var c=(0,x.A)(t,2);const i=c[0],r=c[1];n!==r.generation&&(s.delete(i),e.unregisterDisposer(r),r.dispose())}yield e.layerDropZone}());let s="Layers";if(i||r||o){s+=" (";let e="";i+r&&(s+="".concat(i,"/").concat(r+i," visible"),e=", "),o&&(s+="".concat(e).concat(o," archived")),s+=")"}this.titleElement.textContent=s}}class fi extends M.O8{constructor(e){super(),this.layerManager=e,this.element=document.createElement("div");const t=this.registerCancellable((0,st.t)((()=>this.render())));this.registerDisposer(e.layersChanged.add(t)),this.render()}render(){let e=0;const t=this.layerManager.managedLayers;for(const i of t)i.archived&&++e;const n=this.element;if(0!==e){const i=t.length;n.textContent="".concat(i-e,"/").concat(i)}else n.textContent=""}}var gi=n(4527),mi=(n(9402),n(5622),n(5916),n(593),n(7323)),vi=n.n(mi);class yi extends Jn.hJ{constructor(e){super(),this.viewer=e,this.parsedValue=null,this.debouncedValueUpdater=m()((()=>{const e=this.textEditor.getValue();try{const t=JSON.parse(e);this.parsedValue=t,this.applyButton.disabled=!1,this.textEditor.setOption("lint",void 0)}catch(t){this.parsedValue=null,this.applyButton.disabled=!0;let n=0,i=0,r="Unknown parse error";if(t instanceof Error){const o=t.message.match(/^((?:.|\n)*) in JSON at position ([0-9]+)$/);if(null!==o){r=o[1];const t=parseInt(o[2],10),s=e.substring(0,t).split("\n");n=s.length-1,i=s[s.length-1].length}else r=t.message}this.textEditor.setOption("lint",{getAnnotations:()=>[{message:r,severity:"error",from:vi().Pos(n,i)}]})}}),100),this.content.classList.add("neuroglancer-state-editor");const t=this.applyButton=document.createElement("button");t.textContent="Apply changes",this.content.appendChild(t),t.addEventListener("click",(()=>this.applyChanges())),t.disabled=!0;const n=this.closeButton=document.createElement("button");n.classList.add("close-button"),n.textContent="Close",this.content.appendChild(n),n.addEventListener("click",(()=>this.dispose()));const i=this.downloadButton=document.createElement("button");i.textContent="Download",i.title="Download state as a JSON file",this.content.appendChild(i),i.addEventListener("click",(()=>this.downloadState())),this.textEditor=vi()((e=>{}),{value:"",mode:{name:"javascript",json:!0},foldGutter:!0,gutters:["CodeMirror-lint-markers","CodeMirror-foldgutter"]}),this.updateView(),this.textEditor.on("change",(()=>{this.debouncedValueUpdater()})),this.content.appendChild(this.textEditor.getWrapperElement()),this.textEditor.refresh()}downloadState(){const e=document.createElement("a"),t=new Blob([this.getJson()],{type:"text/json"}),n=URL.createObjectURL(t);e.href=n,e.download="state.json",e.click(),document.body.removeChild(e)}applyChanges(){null!==this.parsedValue&&(this.viewer.state.reset(),this.viewer.state.restoreState(this.parsedValue)),this.applyButton.disabled=!0}updateView(){this.textEditor.setValue(this.getJson()),this.textEditor.execCommand("foldAll"),this.textEditor.execCommand("unfold")}getJson(){return s()((0,Ze.$s)(this.viewer.state).value,null,"  ")}}var bi=n(7392),Si=n(6094);const wi={side:"bottom",size:100,minSize:50,row:0,col:0,flex:1,visible:!1};class xi{constructor(){this.location=new Yt.c1(wi)}get changed(){return this.location.changed}restoreState(e){this.location.restoreState(e)}reset(){this.location.reset()}toJSON(){return(0,be.emptyToUndefined)(this.location.toJSON())}}function Ci(e){const t=new(T());return function e(n,i){if("object"===typeof n)for(const t of w()(n))e(n[t],i+"."+t);else t.set(i,""+n)}(e,""),t}function ki(e){const t=e.map(Ci),n=function(e){const t=new(k());t.add(".type");const n=new(k());function i(n,i){for(const r of t)if(e[n].get(r)!==e[i].get(r))return!0;return!1}for(let r=0,o=e.length;r<o;++r){for(const t of e[r].keys())n.add(t);let o=[];for(let e=0;e<r;++e)i(r,e)||o.push(e);for(;o.length>0;){let i,s=o;for(const a of n){if(t.has(a))continue;const n=[];for(const t of o)e[t].get(a)===e[r].get(a)&&n.push(t);if(n.length<s.length&&(s=n,i=a),0===n.length)break}if(void 0===i)break;o=s,t.add(i)}}return it()(t)}(t);return t.map((e=>function(e,t){const n={};for(const i of t){const t=e.get(i);if(void 0!==t){if(""===i)return t;n[i]=t}}return s()(n)}(e,n)))}const Ei=[{label:"Visible chunks/T",key:"visibleChunksTotal",getter:e=>{let t=0;for(let n=0;n<Si.ES;++n)t+=e[(0,Si.rY)(n,Si.il.VISIBLE)*Si.WS+Si.o0.numChunks];return t}},{label:"Visible chunks/D",key:"visibleChunksDownloading",getter:e=>e[(0,Si.rY)(Si.HU.DOWNLOADING,Si.il.VISIBLE)*Si.WS+Si.o0.numChunks]},{label:"Visible chunks/M",key:"visibleChunksSystemMemory",getter:e=>e[(0,Si.rY)(Si.HU.SYSTEM_MEMORY,Si.il.VISIBLE)*Si.WS+Si.o0.numChunks]+e[(0,Si.rY)(Si.HU.SYSTEM_MEMORY_WORKER,Si.il.VISIBLE)*Si.WS+Si.o0.numChunks]},{label:"Visible chunks/G",key:"visibleChunksGpuMemory",getter:e=>e[(0,Si.rY)(Si.HU.GPU_MEMORY,Si.il.VISIBLE)*Si.WS+Si.o0.numChunks]},{label:"Visible chunks/F",key:"visibleChunksFailed",getter:e=>e[(0,Si.rY)(Si.HU.FAILED,Si.il.VISIBLE)*Si.WS+Si.o0.numChunks]},{label:"Visible memory",key:"visibleGpuMemory",getter:e=>e[(0,Si.rY)(Si.HU.GPU_MEMORY,Si.il.VISIBLE)*Si.WS+Si.o0.gpuMemoryBytes]},{label:"Download latency",key:"downloadLatency",getter:e=>e[(0,Si.oS)(Si.DJ.totalTime)]/e[(0,Si.oS)(Si.DJ.totalChunks)]}];class Ti extends qt.wv{constructor(e,t,n){super(e,n.location),this.chunkQueueManager=t,this.displayState=n,this.data=void 0,this.requestDataTimerId=-1,this.dataRequested=!1,this.body=document.createElement("div"),this.debouncedUpdateView=this.registerCancellable(m()((()=>this.updateView()),0));const i=this.body;i.classList.add("neuroglancer-statistics-panel-body"),this.addTitleBar({title:"Chunk statistics"}),this.addBody(i),this.requestData()}disposed(){window.clearTimeout(this.requestDataTimerId),super.disposed()}requestData(){if(this.dataRequested)return;const e=this.chunkQueueManager;this.dataRequested=!0,e.getStatistics().then((e=>{this.dataRequested=!1,this.data=e,this.debouncedUpdateView(),this.requestDataTimerId=window.setTimeout((()=>{this.requestDataTimerId=-1,this.requestData()}),1e3)}))}updateView(){const e=this.data;if(void 0===e)return;const t=document.createElement("table"),n=[];for(const r of e){var i=(0,x.A)(r,2);const e=i[0],t=i[1],o=[e];for(const n of Ei){const e=n.getter;o.push(e(t))}n.push(o)}const o=ki(n.map((e=>{return t=e[0],r()({type:t.RPC_TYPE_ID},t.key||{});var t}))),s=new(T());o.forEach(((e,t)=>{s.set(n[t][0],e)}));{const e=document.createElement("thead");let n=document.createElement("tr");e.appendChild(n);const i=e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)};let r;i("Name");for(const t of Ei){const e=t.label,o=e.indexOf("/");let s=e;if(-1!==o){if(s=e.substring(0,o),s===r){++n.lastElementChild.colSpan;continue}r=s}i(s)}n=document.createElement("tr"),e.appendChild(n);{const e=document.createElement("td");n.appendChild(e)}for(const t of Ei){const e=t.label,i=e.indexOf("/");let r="";-1!==i&&(r=e.substring(i+1));const o=document.createElement("td");o.textContent=r,n.appendChild(o)}t.appendChild(e)}const a=document.createElement("tbody");for(const r of n){var l=(0,bi.A)(r);const e=l[0],t=l.slice(1),n=document.createElement("tr"),i=e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)};i(s.get(e));for(const r of t)i(""+r);a.appendChild(n)}t.appendChild(a),(0,Ke.gS)(this.body),this.body.appendChild(t)}}var Li=n(3240),Pi=n(5701),Di=n(6392),Mi=n.n(Di);class Ii extends M.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.model=e,this.element=document.createElement("label"),this.inputElement=document.createElement("input");let n=t.validator,i=t.label;const r=this.element,o=this.inputElement;void 0===n&&(n=e instanceof ye.DN?e.validator:e=>e),this.validator=n,void 0!==i&&(r.textContent=i),r.appendChild(o),r.className="neuroglancer-number-input",o.type="text",this.registerDisposer(this.model.changed.add((()=>this.updateView()))),this.registerEventListener(o,"change",(()=>this.updateModel())),this.updateView()}updateView(){this.inputElement.value=""+this.model.value}updateModel(){let e=parseFloat(this.inputElement.value.trim());if(Mi()(e))this.updateView();else try{e=this.validator(e),this.model.value=e}catch(t){this.updateView()}}disposed(){(0,Ke.fh)(this.element),super.disposed()}}var Ri=n(4492);const Ai=r()(r()({},Yt.n7),{side:"left",row:2});class Oi{constructor(){this.location=new Yt.c1(Ai)}get changed(){return this.location.changed}toJSON(){return(0,be.emptyToUndefined)(this.location.toJSON())}reset(){this.location.reset()}restoreState(e){this.location.restoreState(e)}}class Ni extends qt.wv{constructor(e,t,n){super(e,t.location),this.addTitleBar({title:"Settings"});const i=document.createElement("div");i.classList.add("neuroglancer-settings-body");let r=document.createElement("div");r.classList.add("neuroglancer-settings-scroll-container"),i.appendChild(r),this.addBody(i);{const e=this.registerDisposer(new Ri.I(n.title));e.element.placeholder="Title",e.element.classList.add("neuroglancer-settings-title"),r.appendChild(e.element)}const o=(e,t)=>{const n=this.registerDisposer(new Ii(t,{label:e}));n.element.classList.add("neuroglancer-settings-limit-widget"),r.appendChild(n.element)};o("GPU memory limit",n.chunkQueueManager.capacities.gpuMemory.sizeLimit),o("System memory limit",n.chunkQueueManager.capacities.systemMemory.sizeLimit),o("Concurrent chunk requests",n.chunkQueueManager.capacities.download.itemLimit);const s=(e,t)=>{const n=document.createElement("label");n.textContent=e;const i=this.registerDisposer(new he.Fo(t));n.appendChild(i.element),r.appendChild(n)};s("Show axis lines",n.showAxisLines),s("Show scale bar",n.showScaleBar),s("Show cross sections in 3-d",n.showPerspectiveSliceViews),s("Show default annotations",n.showDefaultAnnotations),s("Show chunk statistics",n.statisticsDisplayState.location.watchableVisible),s("Wire frame rendering",n.wireFrame),s("Enable prefetching",n.chunkQueueManager.enablePrefetch);const a=(e,t)=>{const n=document.createElement("label");n.textContent=e;const i=this.registerDisposer(new Pi.G(t));n.appendChild(i.element),r.appendChild(n)};a("Cross-section background",n.crossSectionBackgroundColor),a("Projection background",n.perspectiveViewBackgroundColor)}}var _i=n(2303),Vi=n(5553);class Bi extends M.O8{constructor(e,t){super(),this.selectedLayer=e,this.toolBinder=t,this.element=document.createElement("div"),this.viewContext=void 0,this.updateView=this.registerCancellable((0,st.t)((()=>{let e=this.viewContext;void 0!==e&&(this.unregisterDisposer(e),e.dispose()),this.viewContext=e=this.registerDisposer(new M.O8),(0,Ke.gS)(this.element);const t=this.selectedTool;void 0!==t&&this.element.appendChild(this.makeWidget(e,t));const n=it()(this.toolBinder.bindings);n.sort(((e,t)=>{let[n]=e,[i]=t;return(0,Vi.e)(n,i)}));for(const i of n){const t=(0,x.A)(i,2)[1];this.element.appendChild(this.makeWidget(e,t))}})));this.element.className="neuroglancer-annotation-tool-status",this.registerDisposer(e.changed.add((()=>this.selectedLayerChanged()))),this.registerDisposer(t.changed.add(this.updateView)),this.registerDisposer(this.selectedLayer.layerManager.layersChanged.add(this.updateView)),this.selectedLayerChanged()}get selectedTool(){const e=this.selectedLayer.layer;if(void 0===e)return;const t=e.layer;return null!==t?t.tool.value:void 0}selectedLayerChanged(){let e=this.unbindPreviousLayer;void 0!==e&&e();const t=this.selectedLayer.layer;void 0!==t&&(this.unbindPreviousLayer=t.specificationChanged.add((()=>{this.updateView()}))),this.updateView()}disposed(){const e=this.unbindPreviousLayer;void 0!==e&&e(),this.unbindPreviousLayer=void 0}makeWidget(e,t){const n=document.createElement("div");n.title="dblclick \u2192 unbind",t instanceof Li.NL&&(n.title+=", click \u2192 bind key"),n.className="neuroglancer-annotation-tool-status-widget";const i=document.createElement("div");i.className="neuroglancer-annotation-tool-status-widget-layer-number";const r=t.layer.managedLayer;r.manager.rootLayers.updateNonArchivedLayerIndices();const o=r.nonArchivedLayerIndex;i.textContent=(o+1).toString();const s=document.createElement("div");if(s.className="neuroglancer-annotation-tool-status-widget-description",s.textContent=t.description,n.addEventListener("dblclick",(()=>{t instanceof Li.a0?t.layer.tool.value=void 0:this.toolBinder.set(t.keyBinding,void 0)})),t instanceof Li.NL){const i=document.createElement("div");i.className="neuroglancer-annotation-tool-status-widget-key",i.textContent=t.keyBinding,n.appendChild(i),(0,Li.H_)(e,n,(e=>t.layer.toolBinder.set(e,t.addRef())))}return n.appendChild(i),n.appendChild(s),n}}var Fi=n(2328),Ui=n(338),zi=n(6348);class ji extends M.O8{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super(),this.gl=e,this.frameNumberCounter=t;const i=n+"chunk_worker.bundle.js";this.worker=new Worker(i),this.chunkQueueManager=this.registerDisposer(new v.YZ(new Me.yo(this.worker),this.gl,this.frameNumberCounter,{gpuMemory:new v.yV({defaultItemLimit:1e6,defaultSizeLimit:1e9}),systemMemory:new v.yV({defaultItemLimit:1e7,defaultSizeLimit:2e9}),download:new v.yV({defaultItemLimit:100,defaultSizeLimit:Number.POSITIVE_INFINITY}),compute:new v.yV({defaultItemLimit:128,defaultSizeLimit:5e8})})),this.chunkQueueManager.registerDisposer((()=>this.worker.terminate())),this.chunkManager=this.registerDisposer(new v.Vk(this.chunkQueueManager))}get rpc(){return this.chunkQueueManager.rpc}}const Gi=["showHelpButton","showSettingsButton","showEditStateButton","showLayerListPanelButton","showSelectionPanelButton","showLayerSidePanelButton","showLocation","showAnnotationToolStatus"],Wi=[...Gi,"showLayerPanel","showLayerHoverValues"],Hi=[...Wi,"showUIControls","showPanelBorders"];const qi="undefined"!==typeof NEUROGLANCER_OVERRIDE_DEFAULT_VIEWER_OPTIONS?NEUROGLANCER_OVERRIDE_DEFAULT_VIEWER_OPTIONS:{showLayerDialog:!0,resetStateWhenEmpty:!0};class Yi extends Ze.dp{constructor(e){super(),this.viewer=e,this.add("title",e.title),this.add("dimensions",e.coordinateSpace),this.add("relativeDisplayScales",e.relativeDisplayScales),this.add("displayDimensions",e.displayDimensions),this.add("position",e.position),this.add("crossSectionOrientation",e.crossSectionOrientation),this.add("crossSectionScale",e.crossSectionScale),this.add("crossSectionDepth",e.crossSectionDepthRange),this.add("projectionOrientation",e.projectionOrientation),this.add("projectionScale",e.projectionScale),this.add("projectionDepth",e.projectionDepthRange),this.add("layers",e.layerSpecification),this.add("showAxisLines",e.showAxisLines),this.add("wireFrame",e.wireFrame),this.add("showScaleBar",e.showScaleBar),this.add("showDefaultAnnotations",e.showDefaultAnnotations),this.add("showSlices",e.showPerspectiveSliceViews),this.add("gpuMemoryLimit",e.dataContext.chunkQueueManager.capacities.gpuMemory.sizeLimit),this.add("prefetch",e.dataContext.chunkQueueManager.enablePrefetch),this.add("systemMemoryLimit",e.dataContext.chunkQueueManager.capacities.systemMemory.sizeLimit),this.add("concurrentDownloads",e.dataContext.chunkQueueManager.capacities.download.itemLimit),this.add("selectedLayer",e.selectedLayer),this.add("crossSectionBackgroundColor",e.crossSectionBackgroundColor),this.add("projectionBackgroundColor",e.perspectiveViewBackgroundColor),this.add("layout",e.layout),this.add("statistics",e.statisticsDisplayState),this.add("helpPanel",e.helpPanelState),this.add("settingsPanel",e.settingsPanelState),this.add("selection",e.selectionDetailsState),this.add("layerListPanel",e.layerListPanelState),this.add("partialViewport",e.partialViewport),this.add("selectedStateServer",e.selectedStateServer)}restoreState(e){const t=this.viewer;super.restoreState(e),(0,be.verifyOptionalObjectProperty)(e,"navigation",(e=>{(0,be.verifyObject)(e),(0,be.verifyOptionalObjectProperty)(e,"pose",(e=>{(0,be.verifyObject)(e),(0,be.verifyOptionalObjectProperty)(e,"position",(e=>{(0,be.verifyObject)(e),(0,Ze.wX)(e,"voxelCoordinates",t.position),(0,be.verifyOptionalObjectProperty)(e,"voxelSize",(e=>{const n=(0,be.parseFixedLengthArray)(new Float64Array(3),e,be.verifyFinitePositiveFloat);for(let t=0;t<3;++t)n[t]*=1e-9;t.coordinateSpace.value=(0,y.d)({valid:!1,names:["x","y","z"],units:["m","m","m"],scales:n})}))})),(0,Ze.wX)(e,"orientation",t.crossSectionOrientation)})),(0,Ze.wX)(e,"zoomFactor",t.crossSectionScale.legacyJsonView)})),(0,Ze.wX)(e,"perspectiveOrientation",t.projectionOrientation),(0,Ze.wX)(e,"perspectiveZoom",t.projectionScale.legacyJsonView),(0,Ze.wX)(e,"perspectiveViewBackgroundColor",t.perspectiveViewBackgroundColor)}}const Ji={expectingExternalUI:!1};class Ki extends M.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.display=e,this.title=new ye.DN(void 0,be.verifyString),this.coordinateSpace=new y.W6,this.position=this.registerDisposer(new D.yX(this.coordinateSpace)),this.relativeDisplayScales=this.registerDisposer(new D.x_(this.coordinateSpace)),this.displayDimensions=this.registerDisposer(new D.nA(this.coordinateSpace)),this.displayDimensionRenderInfo=this.registerDisposer(new D.Ey(this.relativeDisplayScales.addRef(),this.displayDimensions.addRef())),this.crossSectionOrientation=this.registerDisposer(new D.EC),this.crossSectionScale=this.registerDisposer(new D.wP(this.displayDimensionRenderInfo.addRef())),this.projectionOrientation=this.registerDisposer(new D.EC),this.crossSectionDepthRange=this.registerDisposer(new D._v(-10,this.displayDimensionRenderInfo)),this.projectionDepthRange=this.registerDisposer(new D._v(-50,this.displayDimensionRenderInfo)),this.projectionScale=this.registerDisposer(new D.Yu(this.displayDimensionRenderInfo.addRef())),this.navigationState=this.registerDisposer(new D.kt(new D.aI(this.position.addRef(),this.displayDimensionRenderInfo.addRef(),this.crossSectionOrientation.addRef()),this.crossSectionScale.addRef(),this.crossSectionDepthRange.addRef())),this.perspectiveNavigationState=this.registerDisposer(new D.kt(new D.aI(this.position.addRef(),this.displayDimensionRenderInfo.addRef(),this.projectionOrientation.addRef()),this.projectionScale.addRef(),this.projectionDepthRange.addRef())),this.mouseState=new B.vC,this.layerManager=this.registerDisposer(new B.TR),this.selectedLayer=this.registerDisposer(new B.u7(this.layerManager.addRef())),this.showAxisLines=new he.C_(!0,!0),this.wireFrame=new he.C_(!1,!1),this.showScaleBar=new he.C_(!0,!0),this.showPerspectiveSliceViews=new he.C_(!0,!0),this.visibleLayerRoles=(0,de.cs)(),this.showDefaultAnnotations=new he.C_(!0,!0),this.crossSectionBackgroundColor=new _i.TrackableRGB(I.eR.fromValues(.5,.5,.5)),this.perspectiveViewBackgroundColor=new _i.TrackableRGB(I.eR.fromValues(0,0,0)),this.scaleBarOptions=new Pe,this.partialViewport=new V.p9,this.statisticsDisplayState=new xi,this.helpPanelState=new Xt,this.settingsPanelState=new Oi,this.layerSelectedValues=this.registerDisposer(new B.nB(this.layerManager,this.mouseState)),this.selectionDetailsState=this.registerDisposer(new B.D0(this.coordinateSpace,this.layerSelectedValues)),this.selectedStateServer=new ye.DN("",be.verifyString),this.layerListPanelState=new di,this.resetInitiated=new Xe.IY,this.makeUrlFromState=e=>Ji.expectingExternalUI?"/#!"+(0,Ui.encodeFragment)(s()(e)):window.location.toString(),this.uiControlVisibility={},this.visible=!0,this.toolInputEventMapBinder=(e,t)=>{t.registerDisposer(this.inputEventBindings.sliceView.addParent(e,Number.POSITIVE_INFINITY)),t.registerDisposer(this.inputEventBindings.perspectiveView.addParent(e,Number.POSITIVE_INFINITY))},this.toolBinder=this.registerDisposer(new Li.tB(this.toolInputEventMapBinder));var n=t.dataContext;const i=void 0===n?new ji(e.gl,e,t.bundleRoot):n;var o=t.visibility;const a=void 0===o?new fe.gH(fe.gH.VISIBLE):o;var l=t.inputEventBindings;const c=void 0===l?{global:new q.n5,sliceView:new q.n5,perspectiveView:new q.n5}:l;var d=t.element;const u=void 0===d?e.makeCanvasOverlayElement():d;var h=t.dataSourceProvider;const p=void 0===h?(0,Nt.Q)({credentialsManager:b.X}):h;var f=t.uiConfiguration;const g=void 0===f?Object.fromEntries(Hi.map((e=>[e,new he.C_(!0)]))):f;this.visibility=a,this.inputEventBindings=c,this.element=u,this.dataSourceProvider=p,this.uiConfiguration=g,this.registerDisposer((0,ye.W1)((e=>{this.display.applyWindowedViewportToElement(u,e)}),this.partialViewport)),this.registerDisposer((()=>(0,Ke.fh)(this.element))),this.dataContext=this.registerDisposer(i),function(e,t){for(const n of Hi){const i=t[n];void 0!==i&&(e[n].value=i)}}(g,t);const v=r()(r()({},qi),t),S=v.resetStateWhenEmpty,w=v.showLayerDialog;for(const r of Wi)this.uiControlVisibility[r]=this.makeUiControlVisibilityState(r);this.registerDisposer(this.uiConfiguration.showPanelBorders.changed.add((()=>{this.updateShowBorders()}))),this.showLayerDialog=w,this.resetStateWhenEmpty=S,this.layerSpecification=new B.Mh(this.display,this.dataSourceProvider,this.layerManager,this.chunkManager,this.selectionDetailsState,this.selectedLayer,this.navigationState.coordinateSpace,this.navigationState.pose.position,this.toolBinder),this.registerDisposer(e.updateStarted.add((()=>{this.onUpdateDisplay()}))),this.showDefaultAnnotations.changed.add((()=>{this.showDefaultAnnotations.value?this.visibleLayerRoles.add(de.gY.DEFAULT_ANNOTATION):this.visibleLayerRoles.delete(de.gY.DEFAULT_ANNOTATION)})),this.registerDisposer(this.navigationState.changed.add((()=>{this.handleNavigationStateChanged()})));const x=this.registerCancellable(m()((()=>{!this.wasDisposed&&0===this.layerManager.managedLayers.length&&this.resetStateWhenEmpty&&(this.navigationState.reset(),this.perspectiveNavigationState.pose.orientation.reset(),this.perspectiveNavigationState.zoomFactor.reset(),this.resetInitiated.dispatch(),!Jn._w&&this.showLayerDialog&&this.visibility.visible&&(0,B.ZV)(this.layerSpecification,this.selectedLayer))})));this.layerManager.layersChanged.add(x),x(),this.registerDisposer(this.dataContext.chunkQueueManager.visibleChunksChanged.add((()=>{this.layerSelectedValues.handleLayerChange()}))),this.registerDisposer(this.dataContext.chunkQueueManager.visibleChunksChanged.add((()=>{this.visible&&e.scheduleRedraw()}))),this.makeUI(),this.updateShowBorders(),this.registerActionListeners(),this.registerEventActionBindings(),this.registerDisposer(An(u,this.navigationState.position)),this.state=new Yi(this)}get chunkManager(){return this.dataContext.chunkManager}get chunkQueueManager(){return this.dataContext.chunkQueueManager}get expectingExternalUI(){return Ji.expectingExternalUI}set expectingExternalUI(e){Ji.expectingExternalUI=e}makeUiControlVisibilityState(e){const t=this.uiConfiguration.showUIControls,n=this.uiConfiguration[e];return this.registerDisposer((0,ye.Kk)(((e,t)=>e&&t),t,n))}get inputEventMap(){return this.inputEventBindings.global}updateShowBorders(){const e=this.element,t="neuroglancer-show-panel-borders";this.uiConfiguration.showPanelBorders.value?e.classList.add(t):e.classList.remove(t)}makeUI(){const e=this.element;e.classList.add("neuroglancer-viewer"),e.classList.add("neuroglancer-noselect"),e.style.display="flex",e.style.flexDirection="column";const t=document.createElement("div");t.classList.add("neuroglancer-viewer-top-row"),t.style.display="flex",t.style.flexDirection="row",t.style.alignItems="stretch";const n=this.registerDisposer(new Dn.uf(this.navigationState.position,this.layerSpecification.coordinateSpaceCombiner));this.registerDisposer(new he.cY(this.uiControlVisibility.showLocation,n.element)),t.appendChild(n.element);const i=this.registerDisposer(new Dn.l7(document.createElement("div"),this.mouseState,this.navigationState.coordinateSpace));if(i.element.style.flex="1",i.element.style.alignSelf="center",this.registerDisposer(new he.cY(this.uiControlVisibility.showLocation,i.element)),t.appendChild(i.element),"undefined"!==typeof NEUROGLANCER_CREDIT_LINK){let e=NEUROGLANCER_CREDIT_LINK;Array.isArray(e)||(e=[e]);for(const n of e){const e=n.url,i=n.text,r=document.createElement("a");r.style.marginRight="5px",r.href=e,r.textContent=i,r.style.fontFamily="sans-serif",r.style.color="yellow",r.target="_blank",t.appendChild(r)}}const r=this.registerDisposer(new Bi(this.selectedLayer,this.toolBinder));if(t.appendChild(r.element),this.registerDisposer(new he.cY(this.uiControlVisibility.showAnnotationToolStatus,r.element)),Wt){const e=this.registerDisposer(new Ht(this));t.appendChild(e.element)}{const e=this.layerListPanelState,n=this.registerDisposer(new ni.R(e.location.watchableVisible,{svg:d(),backgroundScheme:"dark",enableTitle:"Show layer list panel",disableTitle:"Hide layer list panel"}));n.element.insertAdjacentElement("afterbegin",this.registerDisposer(new fi(this.layerManager)).element),this.registerDisposer(new he.cY(this.uiControlVisibility.showLayerListPanelButton,n.element)),t.appendChild(n.element)}{const e=this.selectionDetailsState,n=this.registerDisposer(new ni.R(e.location.watchableVisible,{svg:h(),backgroundScheme:"dark",enableTitle:"Show selection details panel",disableTitle:"Hide selection details panel"}));this.registerDisposer(new he.cY(this.uiControlVisibility.showSelectionPanelButton,n.element)),t.appendChild(n.element)}{const e=this.selectedLayer,n=this.registerDisposer(new ni.R({get value(){return e.visible},set value(t){e.visible=t},changed:e.location.locationChanged},{svg:l(),backgroundScheme:"dark",enableTitle:"Show layer side panel",disableTitle:"Hide layer side panel"}));this.registerDisposer(new he.cY(this.uiControlVisibility.showLayerSidePanelButton,n.element)),t.appendChild(n.element)}{const e=(0,Gt.m)({text:"{}",title:"Edit JSON state"});this.registerEventListener(e,"click",(()=>{this.editJsonState()})),this.registerDisposer(new he.cY(this.uiControlVisibility.showEditStateButton,e)),t.appendChild(e)}{const e=(0,zi.C)({title:"Copy view URL to clipboard",onClick:()=>{const e=(0,Fi.B)(this.makeUrlFromState(this.state.toJSON()));Ut.M.showTemporaryMessage(e?"URL copied to clipboard":"Failed to copy URL to clipboard")}});t.appendChild(e)}{const e=this.helpPanelState,n=this.registerDisposer(new ni.R(e.location.watchableVisible,{text:"?",backgroundScheme:"dark",enableTitle:"Show help panel",disableTitle:"Hide help panel"}));this.registerDisposer(new he.cY(this.uiControlVisibility.showHelpButton,n.element)),t.appendChild(n.element)}{const e=this.settingsPanelState,n=this.registerDisposer(new ni.R(e.location.watchableVisible,{svg:f(),backgroundScheme:"dark",enableTitle:"Show settings panel",disableTitle:"Hide settings panel"}));this.registerDisposer(new he.cY(this.uiControlVisibility.showSettingsButton,n.element)),t.appendChild(n.element)}this.registerDisposer(new he.cY((0,ye.Kk)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>e||t),!1)}),...Gi.map((e=>this.uiControlVisibility[e]))),t)),e.appendChild(t),this.layout=this.registerDisposer(new Yn(this,"4panel")),this.sidePanelManager=this.registerDisposer(new qt.RT(this.display,this.layout.element,this.visibility)),this.registerDisposer(this.sidePanelManager.registerPanel({location:this.layerListPanelState.location,makePanel:()=>new pi(this.sidePanelManager,this.layerSpecification,this.layerListPanelState)})),this.registerDisposer(new li(this.sidePanelManager,this.selectedLayer.addRef())),this.registerDisposer(this.sidePanelManager.registerPanel({location:this.selectionDetailsState.location,makePanel:()=>new gi.N(this.sidePanelManager,this.selectionDetailsState,this.layerSpecification,this.selectedLayer)})),e.appendChild(this.sidePanelManager.element),this.closeSelectionTab=()=>{for(const e of this.sidePanelManager.registeredPanels)e.panel instanceof gi.N&&e.panel.close()},this.registerDisposer(this.sidePanelManager.registerPanel({location:this.statisticsDisplayState.location,makePanel:()=>new Ti(this.sidePanelManager,this.chunkQueueManager,this.statisticsDisplayState)})),this.registerDisposer(this.sidePanelManager.registerPanel({location:this.helpPanelState.location,makePanel:()=>{const e=this.inputEventBindings;return new Zt(this.sidePanelManager,this.helpPanelState,[["Global",e.global],["Cross section view",e.sliceView],["3-D projection view",e.perspectiveView]],this.layerManager,this.toolBinder)}})),this.registerDisposer(this.sidePanelManager.registerPanel({location:this.settingsPanelState.location,makePanel:()=>new Ni(this.sidePanelManager,this.settingsPanelState,this)}));const o=()=>{const t=this.visibility.visible;t!==this.visible&&(e.style.visibility=t?"inherit":"hidden",this.visible=t)};o(),this.registerDisposer(this.visibility.changed.add(o))}registerEventActionBindings(){const e=this.element;this.registerDisposer(new q.cL(e,this.inputEventMap)),this.registerDisposer(new W.j(e))}bindAction(e,t){this.registerDisposer((0,H.qZ)(this.element,e,t))}bindCallback(e,t){this.registerDisposer((0,H.qZ)(this.element,e,(()=>{t(this)})))}registerActionListeners(){for(const e of["recolor","clear-segments"])this.bindAction(e,(()=>{this.layerManager.invokeAction(e),this.closeSelectionTab&&this.closeSelectionTab()}));for(const e of["select"])this.bindAction(e,(()=>{this.mouseState.updateUnconditionally(),this.layerManager.invokeAction(e)}));for(const e of["copy-segment-id","add-copy-segment-id"])this.bindAction(e,(()=>{this.mouseState.updateUnconditionally(),this.layerManager.invokeAction(e,this.selectedLayer.layer)}));this.bindAction("help",(()=>this.toggleHelpPanel()));for(let e=1;e<=9;++e)this.bindAction("toggle-layer-".concat(e),(()=>{const t=this.layerManager.getLayerByNonArchivedIndex(e-1);void 0!==t&&t.setVisible(!t.visible)})),this.bindAction("toggle-pick-layer-".concat(e),(()=>{const t=this.layerManager.getLayerByNonArchivedIndex(e-1);void 0!==t&&(t.pickEnabled=!t.pickEnabled)})),this.bindAction("select-layer-".concat(e),(()=>{const t=this.layerManager.getLayerByNonArchivedIndex(e-1);void 0!==t&&(this.selectedLayer.layer=t,this.selectedLayer.visible=!0)}));for(let e=0;e<26;++e){const t=String.fromCharCode(65+e);this.bindAction("tool-".concat(t),(()=>{this.activateTool(t)}))}this.bindAction("annotate",(()=>{const e=this.selectedLayer.layer;if(void 0===e)return void Ut.M.showTemporaryMessage("The annotate command requires a layer to be selected.");const t=e.layer;null!==t&&void 0!==t.tool.value?t.tool.value.trigger(this.mouseState):Ut.M.showTemporaryMessage("The selected layer (".concat(s()(e.name),") does not have an active annotation tool."))})),this.bindAction("toggle-axis-lines",(()=>this.showAxisLines.toggle())),this.bindAction("toggle-scale-bar",(()=>this.showScaleBar.toggle())),this.bindAction("toggle-default-annotations",(()=>this.showDefaultAnnotations.toggle())),this.bindAction("toggle-show-slices",(()=>this.showPerspectiveSliceViews.toggle())),this.bindAction("toggle-show-statistics",(()=>this.showStatistics()))}toggleHelpPanel(){this.helpPanelState.location.visible=!this.helpPanelState.location.visible}activateTool(e){this.toolBinder.activate(e)}editJsonState(){new yi(this)}copyJsonStateToUrl(){(0,Fi.B)(this.makeUrlFromState(this.state.toJSON()))}showStatistics(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;void 0===e&&(e=!this.statisticsDisplayState.location.visible),this.statisticsDisplayState.location.visible=e}get gl(){return this.display.gl}onUpdateDisplay(){this.visible&&(this.dataContext.chunkQueueManager.chunkUpdateDeadline=null)}handleNavigationStateChanged(){if(this.visible){let e=this.dataContext.chunkQueueManager;null===e.chunkUpdateDeadline&&(e.chunkUpdateDeadline=Date.now()+10)}}}},843:(e,t,n)=>{n.d(t,{Mz:()=>c,S2:()=>l,gH:()=>a});var i=n(608),r=n.n(i),o=n(6210),s=n(7160);class a extends s.B0{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.NEGATIVE_INFINITY)}get visible(){return this.value===Number.POSITIVE_INFINITY}get ignored(){return this.value===Number.NEGATIVE_INFINITY}}a.VISIBLE=Number.POSITIVE_INFINITY,a.IGNORED=Number.NEGATIVE_INFINITY;class l extends a{constructor(){super(...arguments),this.contributors=new(r())}add(e){const t=this.contributors,n=e.changed.add((()=>{this.update()})),i=()=>{t.delete(i),n(),this.update()};return t.set(i,e),this.update(),i}update(){let e=Number.NEGATIVE_INFINITY;for(const t of this.contributors.values())e=Math.max(e,t.value);this.value=e}}function c(e){return class extends e{constructor(){super(...arguments),this.visibility=new l}initializeCounterpart(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.visibility=this.registerDisposer(o.a.makeFromExisting(e,this.visibility)).rpcId,super.initializeCounterpart(e,t)}}}},605:(e,t,n)=>{n.d(t,{D_:()=>s,KA:()=>a,Z9:()=>i,rE:()=>r});const i=12,r=8,o=6,s="\nvec3 getBoxFaceVertexPosition(int vertexIndex) {\n  const vec3 vertexPositions[] = vec3[](\n  // Front face\n  vec3(0.0, 0.0,  1.0), // 0\n  vec3(1.0, 0.0,  1.0), // 1\n  vec3(1.0,  1.0,  1.0), // 2\n  vec3(0.0,  1.0,  1.0), // 3\n\n  // Back face\n  vec3(0.0, 0.0, 0.0), // 4\n  vec3(0.0,  1.0, 0.0), // 5\n  vec3(1.0,  1.0, 0.0), // 6\n  vec3(1.0, 0.0, 0.0), // 7\n\n  // Top face\n  vec3(0.0,  1.0, 0.0), // 8\n  vec3(0.0,  1.0,  1.0), // 9\n  vec3(1.0,  1.0,  1.0), // 10\n  vec3(1.0,  1.0, 0.0), // 11\n\n  // Bottom face\n  vec3(0.0, 0.0, 0.0), // 12\n  vec3( 1.0, 0.0, 0.0), // 13\n  vec3( 1.0, 0.0,  1.0), // 14\n  vec3(0.0, 0.0,  1.0), // 15\n\n  // Right face\n  vec3( 1.0, 0.0, 0.0), // 16\n  vec3( 1.0,  1.0, 0.0), // 17\n  vec3( 1.0,  1.0,  1.0), // 18\n  vec3( 1.0, 0.0,  1.0), // 19\n\n  // Left face\n  vec3(0.0, 0.0, 0.0), // 20\n  vec3(0.0, 0.0,  1.0), // 21\n  vec3(0.0,  1.0,  1.0), // 22\n  vec3(0.0,  1.0, 0.0) // 23\n  );\n  const int indices[] = int[](\n    0,  1,  2,      0,  2,  3,    // front\n    4,  5,  6,      4,  6,  7,    // back\n    8,  9,  10,     8,  10, 11,   // top\n    12, 13, 14,     12, 14, 15,   // bottom\n    16, 17, 18,     16, 18, 19,   // right\n    20, 21, 22,     20, 22, 23   // left\n  );\n  return vertexPositions[indices[vertexIndex]];\n}\n";function a(e,t,n){e.drawArraysInstanced(WebGL2RenderingContext.TRIANGLES,0,6*o*t,n)}},9981:(e,t,n)=>{n.d(t,{h:()=>s,x:()=>a});var i=n(7562),r=n(7970),o=n(2311);class s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WebGL2RenderingContext.ARRAY_BUFFER;this.gl=e,this.bufferType=t,this.gl=e,this.buffer=e.createBuffer()}bind(){this.gl.bindBuffer(this.bufferType,this.buffer)}bindToVertexAttrib(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WebGL2RenderingContext.FLOAT,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.bind(),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,t,n,i,r,o)}bindToVertexAttribI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WebGL2RenderingContext.UNSIGNED_INT,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.bind(),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribIPointer(e,t,n,i,r)}setData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WebGL2RenderingContext.STATIC_DRAW,n=this.gl;this.bind(),n.bufferData(this.bufferType,e,t)}dispose(){this.gl.deleteBuffer(this.buffer),this.buffer=void 0,this.gl=void 0}static fromData(e,t,n,i){let r=new s(e,n);return r.setData(t,i),r}}function a(e,t,n){for(var a=arguments.length,l=new Array(a>3?a-3:0),c=3;c<a;c++)l[c-3]=arguments[c];return e.memoize.get((0,r.stableStringify)({id:"getMemoizedBuffer",getter:(0,o.R)(n),args:l}),(()=>{const r=new i.fL(s.fromData(e,n(...l),t,WebGL2RenderingContext.STATIC_DRAW));return r.registerDisposer(r.value),r}))}},9182:(e,t,n)=>{n.d(t,{Xp:()=>u,Yu:()=>c,aK:()=>d,d$:()=>a,fg:()=>l});var i=n(6532),r=n(7562),o=n(2362),s=n(3835);const a=i.QD;function l(e,t){e.addVertexCode(i.W6),e.addUniform("highp vec3","uCircleParams"),e.addVarying("highp vec4","vCircleCoord"),e.addVertexCode("\nvoid emitCircle(vec4 position, float diameter, float borderWidth) {\n  gl_Position = position;\n  float totalDiameter = diameter + 2.0 * (borderWidth + uCircleParams.z);\n  if (diameter == 0.0) totalDiameter = 0.0;\n  vec2 circleCornerOffset = getQuadVertexPosition(vec2(-1.0, -1.0), vec2(1.0, 1.0));\n  gl_Position.xy += circleCornerOffset * uCircleParams.xy * gl_Position.w * totalDiameter;\n  vCircleCoord.xy = circleCornerOffset;\n  if (borderWidth == 0.0) {\n    vCircleCoord.z = totalDiameter;\n    vCircleCoord.w = 1e-6;\n  } else {\n    vCircleCoord.z = diameter / totalDiameter;\n    vCircleCoord.w = uCircleParams.z / totalDiameter;\n  }\n}\n"),t?e.addFragmentCode("\nfloat getCircleAlphaMultiplier() {\n  return 1.0 - 2.0 * abs(0.5 - gl_FragCoord.z);\n}\n"):e.addFragmentCode("\nfloat getCircleAlphaMultiplier() {\n  return 1.0;\n}\n"),e.addFragmentCode("\nvec4 getCircleColor(vec4 interiorColor, vec4 borderColor) {\n  float radius = length(vCircleCoord.xy);\n  if (radius > 1.0) {\n    discard;\n  }\n\n  float borderColorFraction = clamp((radius - vCircleCoord.z) / vCircleCoord.w, 0.0, 1.0);\n  float feather = clamp((1.0 - radius) / vCircleCoord.w, 0.0, 1.0);\n  vec4 color = mix(interiorColor, borderColor, borderColorFraction);\n\n  return vec4(color.rgb, color.a * feather * getCircleAlphaMultiplier());\n}\n")}function c(e,t,n){e.gl.uniform3f(e.uniform("uCircleParams"),1/t.width,1/t.height,Math.max(1e-6,n.featherWidthInPixels))}function d(e,t,n){(0,i.Nm)(e,t,n)}class u extends r.O8{constructor(e){super(),this.lightDirection=new Float32Array([1,0,0,0]),this.sphereHelper=this.registerDisposer(new o.mQ(e,20,20))}defineShader(e){e.addUniform("highp vec4","uLightDirection"),e.addUniform("highp mat4","uNormalTransform"),e.addVertexCode("\nfloat getRadiusAdjustment(vec3 vertex, float r) {\n  float radiusAdjustment = 1.0;\n  for (int i = 0; i < 3; ++i) {\n    if (r != 0.0) {\n      float d = vertex[i] - uModelClipBounds[i];\n      radiusAdjustment -= d * d / (r * r);\n    }\n  }\n\n  return sqrt(max(0.1, radiusAdjustment));\n}\n    "),this.sphereHelper.defineShader(e)}draw(e,t,n){const i=e.gl;i.uniformMatrix4fv(e.uniform("uNormalTransform"),!1,s.pB.transpose(s.pB.create(),t.renderSubspaceInvModelMatrix)),i.uniform4f(e.uniform("uLightDirection"),this.lightDirection[0],this.lightDirection[1],this.lightDirection[2],this.lightDirection[3]),this.sphereHelper.draw(e,n)}}},251:(e,t,n)=>{n.d(t,{o:()=>i});const i="vec3 colormapJet(float x) {\n  vec3 result;\n  result.r = x < 0.89 ? ((x - 0.35) / 0.31) : (1.0 - (x - 0.89) / 0.11 * 0.5);\n  result.g = x < 0.64 ? ((x - 0.125) * 4.0) : (1.0 - (x - 0.64) / 0.27);\n  result.b = x < 0.34 ? (0.5 + x * 0.5 / 0.11) : (1.0 - (x - 0.34) / 0.31);\n  return clamp(result, 0.0, 1.0);\n}\nvec3 colormapCubehelix(float x) {\n  float xclamp = clamp(x, 0.0, 1.0);\n  float angle = 2.0 * 3.1415926 * (4.0 / 3.0 + xclamp);\n  float amp = xclamp * (1.0 - xclamp) / 2.0;\n  vec3 result;\n  float cosangle = cos(angle);\n  float sinangle = sin(angle);\n  result.r = -0.14861 * cosangle + 1.78277 * sinangle;\n  result.g = -0.29227 * cosangle + -0.90649 * sinangle;\n  result.b = 1.97294 * cosangle;\n  result = clamp(xclamp + amp * result, 0.0, 1.0);\n  return result;\n}\n"},9080:(e,t,n)=>{n.d(t,{P9:()=>m,RH:()=>p,Wh:()=>g,qK:()=>v,vk:()=>f});var i=n(3651),r=n.n(i),o=n(984),s=n.n(o),a=n(608),l=n.n(a),c=n(7160),d=n(7970),u=n(2311),h=n(858);function p(){return new c.B0(void 0)}function f(e){return new c.DN(e,d.verifyString)}function g(e,t,n){const i=new(l()),r=n.parameters,o=n.fallbackParameters,a=n.shaderError;var u=n.encodeParameters;const p=void 0===u?e=>e:u;var f=n.extraParameters;const g=void 0===f?(0,c.XZ)(void 0):f;var m=n.encodeExtraParameters;const v=void 0===m?e=>e:m,y=n.getContextKey,b=n.defineShader;void 0!==a&&(a.value=void 0);var S=n.encodeContext;const w=void 0===S?y:S,x=(0,d.stableStringify)(n.memoizeKey);function C(e,n,i){const r=s()({id:x,context:w(e),parameters:p(n),extraParameters:v(i)});return t.memoize.get(r,(()=>{const r=new h.N5(t);return b(r,e,n,i),r.build()}))}return e.registerDisposer((()=>{for(const e of i.values()){const t=e.shader;null!==t&&t.dispose()}})),function(e){const t=y(e);let n=i.get(t);void 0===n&&(n={parametersGeneration:-1,extraParametersGeneration:-1,shader:null,fallback:!1,parameters:r.value,extraParameters:g.value},i.set(t,n));const s=r.changed.count,l=g.changed.count;if(s===n.parametersGeneration&&l===n.extraParametersGeneration)return n;const c=n.parameters=r.value,d=n.extraParameters=g.value,u=n.shader;n.parametersGeneration=s,n.extraParametersGeneration=l;let h=null;try{h=C(e,c,d),n.fallback=!1,void 0!==o&&(o.value=c),void 0!==a&&(a.value=null)}catch(p){if(void 0!==a&&(a.value=p),void 0!==o)try{const t=o.value;h=C(e,t,d),n.parameters=t,n.fallback=!0}catch(f){}}return null!==u&&u.dispose(),n.shader=h,n}}function m(e,t,n){return g(e,t,r()(r()({},n),{getContextKey:e=>e,encodeContext:e=>(0,u.R)(e),defineShader:(e,t,i,r)=>(e.require(t),n.defineShader(e,i,r))}))}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"\n#line ".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0," ").concat(t,"\n")+e}},863:(e,t,n)=>{n.d(t,{B:()=>h,h:()=>m});var i=n(9176),r=n.n(i),o=n(7562),s=n(843),a=n(9981),l=n(706),c=n(858),d=n(6098),u=n(8336);class h extends o.O8{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.S2;super(),this.channels=e,this.bounds=t,this.visibility=n,this.framebuffers=[],this.producerVisibility=new s.S2,this.frameNumber=-1}getFramebuffers(e){const t=this.framebuffers;for(;t.length<this.channels.value.length;){const n=new l.Mi(e,{colorBuffers:(0,l.Ns)(e,1,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RED,WebGL2RenderingContext.FLOAT)});t.push(n)}return t}disposed(){for(const e of this.framebuffers)e.dispose();this.framebuffers.length=0}}const p=r()("histogramDataSamplerTextureUnit"),f=r()("histogramDepthTextureUnit"),g=4096;class m extends o.O8{constructor(e){super(),this.gl=e,this.shader=this.registerDisposer((()=>{const e=new c.N5(this.gl);return e.addOutputBuffer("vec4","outputValue",0),e.addAttribute("float","aInput1"),e.addTextureSampler("sampler2D","uDataSampler",p),e.addTextureSampler("sampler2D","uDepthSampler",f),e.addVertexCode(d.A0),e.setVertexMain("\nfloat uRandomSeed = 0.0;\nvec2 p = vec2(simpleFloatHash(vec2(aInput1 + float(gl_VertexID), uRandomSeed + float(gl_InstanceID))),\n              simpleFloatHash(vec2(aInput1 + float(gl_VertexID) + 10.0, 5.0 + uRandomSeed + float(gl_InstanceID))));\nfloat dataValue = texture(uDataSampler, p).x;\nfloat stencilValue = texture(uDepthSampler, p).x;\nif (stencilValue == 1.0) {\n  gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\n} else {\n  gl_Position = vec4(2.0 * (dataValue * 255.0 + 0.5) / 256.0 - 1.0, 0.0, 0.0, 1.0);\n}\ngl_PointSize = 1.0;\n"),e.setFragmentMain("\noutputValue = vec4(1.0, 1.0, 1.0, 1.0);\n"),e.build()})()),this.inputIndexBuffer=this.registerDisposer((0,a.x)(this.gl,WebGL2RenderingContext.ARRAY_BUFFER,(()=>new Uint8Array(g))))}static get(e){return e.memoize.get("textureHistogramGeneration",(()=>new m(e)))}compute(e,t,n,i,r){const o=this.gl,s=this.shader,a=i.getFramebuffers(o);s.bind(),o.enable(WebGL2RenderingContext.BLEND),o.disable(WebGL2RenderingContext.SCISSOR_TEST),o.disable(WebGL2RenderingContext.DEPTH_TEST),o.blendFunc(WebGL2RenderingContext.ONE,WebGL2RenderingContext.ONE),this.inputIndexBuffer.value.bindToVertexAttrib(s.attribute("aInput1"),1,WebGL2RenderingContext.UNSIGNED_BYTE,!0);const l=s.textureUnit(p),c=s.textureUnit(f);o.activeTexture(WebGL2RenderingContext.TEXTURE0+c),o.bindTexture(WebGL2RenderingContext.TEXTURE_2D,t),(0,u.ut)(o),o.activeTexture(WebGL2RenderingContext.TEXTURE0+l);const d=i.frameNumber;i.frameNumber=r;for(let h=0;h<e;++h)o.bindTexture(WebGL2RenderingContext.TEXTURE_2D,n[h].texture),(0,u.ut)(o),a[h].bind(256,1),r!==d&&(o.clearColor(0,0,0,0),o.clear(WebGL2RenderingContext.COLOR_BUFFER_BIT)),o.drawArraysInstanced(WebGL2RenderingContext.POINTS,0,g,4);o.disable(WebGL2RenderingContext.BLEND)}}},6754:(e,t,n)=>{n.d(t,{SN:()=>S,Xh:()=>v,Yy:()=>y});var i=n(4117),r=n.n(i),o=n(9043),s=n(8194),a=n(6098);const l={[o.pe.UINT8]:"vec2",[o.pe.INT8]:"vec2",[o.pe.UINT16]:"vec2",[o.pe.INT16]:"vec2",[o.pe.FLOAT32]:"vec2",[o.pe.UINT32]:"Uint32LerpParameters",[o.pe.INT32]:"Int32LerpParameters",[o.pe.UINT64]:"Uint64LerpParameters"},c={[o.pe.UINT8]:"",[o.pe.INT8]:"",[o.pe.UINT16]:"",[o.pe.INT16]:"",[o.pe.FLOAT32]:"",[o.pe.UINT32]:"\nstruct Uint32LerpParameters {\n  uint offset;\n  int shift;\n  float multiplier;\n};\n",[o.pe.INT32]:"\nstruct Int32LerpParameters {\n  int offset;\n  int shift;\n  float multiplier;\n};\n",[o.pe.UINT64]:[a.sZ,"\nstruct Uint64LerpParameters {\n  uint64_t offset;\n  int shift;\n  float multiplier;\n};\n"]};function d(e){const t=(0,a.mh)(e);let n="\nfloat computeInvlerp(".concat(t," inputValue, vec2 p) {\n  float outputValue = float(toRaw(inputValue));\n  outputValue = (outputValue - p[0]) * p[1];\n  return outputValue;\n}\n");return[a.xs[e],n]}function u(e){const t=(0,a.mh)(e);let n=e===o.pe.INT32?"int":"uint",i=l[e];return[a.xs[e],c[e],"\nfloat computeInvlerp(".concat(t," inputValue, ").concat(i," p) {\n  ").concat(n," v = toRaw(inputValue);\n  uint x;\n  if (v >= p.offset) {\n    x = uint(v - p.offset);\n  } else {\n    x = uint(p.offset - v);\n    p.multiplier = -p.multiplier;\n  }\n  x >>= p.shift;\n  return float(x) * p.multiplier;\n}\n")]}const h={[o.pe.UINT8]:d(o.pe.UINT8),[o.pe.INT8]:d(o.pe.INT8),[o.pe.UINT16]:d(o.pe.UINT16),[o.pe.INT16]:d(o.pe.INT16),[o.pe.FLOAT32]:d(o.pe.FLOAT32),[o.pe.UINT32]:u(o.pe.UINT32),[o.pe.INT32]:u(o.pe.INT32),[o.pe.UINT64]:[a.sZ,a.Xz,a.cz,a.uZ,c[o.pe.UINT64],"\nfloat computeInvlerp(uint64_t inputValue, Uint64LerpParameters p) {\n  if (compareLessThan(inputValue, p.offset)) {\n    inputValue = subtract(p.offset, inputValue);\n    p.multiplier = -p.multiplier;\n  } else {\n    inputValue = subtract(inputValue, p.offset);\n  }\n  uint shifted = shiftRight(inputValue, p.shift).value[0];\n  return float(shifted) * p.multiplier;\n}\n"]};function p(e){const t=(0,a.mh)(e);let n="\n".concat(t," computeLerp(float inputValue, vec2 p) {\n  inputValue = inputValue / p[1] + p[0];\n");return e===o.pe.FLOAT32?n+="return inputValue;\n":n+="return ".concat(o.pe[e].toLowerCase(),"FromFloat(round(inputValue));\n"),n+="\n}\n",[a.xs[e],n]}function f(e){const t=(0,a.mh)(e);let n=l[e];return[a.xs[e],c[e],a.bC,e===o.pe.UINT32?a.NQ:a.oX,e===o.pe.UINT32?a.AE:a.Zu,"\n".concat(t," computeLerp(float inputValue, ").concat(n," p) {\n  inputValue = inputValue / p.multiplier;\n  uint x = uint(clamp(round(abs(inputValue)), 0.0, 4294967295.0));\n  uint xShifted = shiftLeftSaturate(x, p.shift);\n  if (inputValue >= 0.0) {\n    return ").concat(t,"(addSaturate(p.offset, xShifted));\n  } else {\n    return ").concat(t,"(subtractSaturate(p.offset, xShifted));\n  }\n}\n")]}const g={[o.pe.UINT8]:p(o.pe.UINT8),[o.pe.INT8]:p(o.pe.INT8),[o.pe.UINT16]:p(o.pe.UINT16),[o.pe.INT16]:p(o.pe.INT16),[o.pe.FLOAT32]:p(o.pe.FLOAT32),[o.pe.UINT32]:f(o.pe.UINT32),[o.pe.INT32]:f(o.pe.INT32),[o.pe.UINT64]:[a.sZ,a.Xz,a.CQ,a.US,a.rL,a.uZ,a.fZ,c[o.pe.UINT64],"\nuint64_t computeLerp(float inputValue, Uint64LerpParameters p) {\n  inputValue = inputValue / p.multiplier;\n  uint64_t x = uint64_t(uvec2(uint(clamp(round(abs(inputValue)), 0.0, 4294967295.0)), 0u));\n  uint64_t shifted = shiftLeft(x, p.shift);\n  if (!equals(shiftRight(shifted, p.shift), x)) {\n    return uint64_t(uvec2(0xffffffffu, 0xffffffffu));\n  }\n  if (inputValue >= 0.0) {\n    return addSaturate(p.offset, shifted);\n  } else {\n    return subtractSaturate(p.offset, shifted);\n  }\n}\n"]};function m(e,t,n){const i="uLerpParams_".concat(t),r="uLerpBounds_".concat(t),s="uLerpScalar_".concat(t);let a="";switch(n){case o.pe.INT8:case o.pe.UINT8:case o.pe.INT16:case o.pe.UINT16:case o.pe.FLOAT32:e.addUniform("vec2",i);break;case o.pe.INT32:case o.pe.UINT32:{const t=l[n];e.addUniform("".concat(n===o.pe.INT32?"i":"u","vec2"),r),e.addUniform("float",s),a+="\n#define ".concat(i," ").concat(t,"(").concat(r,"[0], int(").concat(r,"[1]), ").concat(s,")\n");break}case o.pe.UINT64:e.addUniform("uvec3",r),e.addUniform("float",s),a+="\n#define ".concat(i," Uint64LerpParameters(uint64_t(").concat(r,".xy), int(").concat(r,"[2]), ").concat(s,")\n")}return[c[n],a]}function v(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return[a.xs[n],m(e,t,n),h[n],"\nfloat ".concat(t,"(").concat((0,a.mh)(n)," inputValue) {\n  float v = computeInvlerp(inputValue, uLerpParams_").concat(t,");\n  ").concat(i?"v = clamp(v, 0.0, 1.0);":"","\n  return v;\n}\n")]}function y(e,t,n){return[a.xs[n],m(e,t,n),g[n],"\n".concat((0,a.mh)(n)," ").concat(t,"(float inputValue) {\n  return computeLerp(inputValue, uLerpParams_").concat(t,");\n}\n")]}const b=new s.Uint64;function S(e,t,n,i){const a=e.gl;switch(n){case o.pe.INT8:case o.pe.UINT8:case o.pe.INT16:case o.pe.UINT16:case o.pe.FLOAT32:a.uniform2f(e.uniform("uLerpParams_".concat(t)),i[0],1/(i[1]-i[0]));break;case o.pe.INT32:case o.pe.UINT32:{const s=i[0],l=i[1]-s,c=Math.max(0,Math.ceil(r()(Math.abs(l)))-24),d=Math.pow(2,c)/l,u=e.uniform("uLerpBounds_".concat(t));n===o.pe.UINT32?a.uniform2ui(u,s,c):a.uniform2i(u,s,c),a.uniform1f(e.uniform("uLerpScalar_".concat(t)),d);break}case o.pe.UINT64:{const n=i[0],o=i[1];s.Uint64.absDifference(b,o,n);const l=b.high>0?32+Math.ceil(r()(b.high)):Math.ceil(r()(b.low)),c=Math.max(0,l-24);s.Uint64.rshift(b,b,c);let d=1/b.low;s.Uint64.compare(n,o)>0&&(d*=-1);const u=e.uniform("uLerpBounds_".concat(t));a.uniform3ui(u,n.low,n.high,c),a.uniform1f(e.uniform("uLerpScalar_".concat(t)),d)}}}},7520:(e,t,n)=>{n.d(t,{Cy:()=>l,VU:()=>s,bn:()=>o,wo:()=>a});var i=n(6532),r=n(6098);const o=i.QD;function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.addVertexCode(i.W6),e.addUniform("highp vec3","uLineParams"),e.addVarying("highp float","vLineCoord"),e.addVarying("highp float","vLineFeatherFraction"),t&&(e.addVarying("highp float","vEndpointFraction"),e.addVarying("highp float","vLineCoordT"),e.addVarying("highp float","vLineBorderStartFraction")),e.addVertexCode(r.v1),e.addVertexCode("\nvec2 getLineOffset() { return getQuadVertexPosition(vec2(0.0, -1.0), vec2(1.0, 1.0)); }\nfloat getLineEndpointCoefficient() { return getLineOffset().x; }\nuint getLineEndpointIndex() { return uint(getLineEndpointCoefficient()); }\nvoid emitLine(vec4 vertexAClip, vec4 vertexBClip, float lineWidthInPixels\n              ".concat(t?", float borderWidth":"",") {\n  if (!clipLineToDepthRange(vertexAClip, vertexBClip)) {\n    gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\n    return;\n  }\n  vec3 vertexADevice = vertexAClip.xyz / vertexAClip.w;\n  vec3 vertexBDevice = vertexBClip.xyz / vertexBClip.w;\n\n  vec2 lineDirectionUnnormalized = vertexBDevice.xy - vertexADevice.xy;\n  vec2 lineDirection;\n  float linePixelLength = length(lineDirectionUnnormalized / uLineParams.xy * 0.5);\n\n  if (linePixelLength < 1e-3) {\n    lineDirection = vec2(1.0, 0.0);\n    vertexADevice.z = vertexBDevice.z = 0.0;\n  } else {\n    lineDirection = normalize(lineDirectionUnnormalized);\n  }\n  vec2 lineNormal = normalize(vec2(lineDirection.y, -lineDirection.x) / uLineParams.yx * uLineParams.xy);\n\n  vec2 lineOffset = getLineOffset();\n  gl_Position = vec4(mix(vertexADevice, vertexBDevice, lineOffset.x), 1.0);\n  float totalLineWidth = lineWidthInPixels + 2.0 * uLineParams.z ").concat(t?" + 2.0 * borderWidth":"",";\n  if (lineWidthInPixels == 0.0) totalLineWidth = 0.0;\n  vLineFeatherFraction = max(1e-6, uLineParams.z) / totalLineWidth;\n  gl_Position.xy += (lineOffset.y * lineNormal\n                     ").concat(t?"+ lineDirection * (2.0 * lineOffset.x - 1.0)":"",")\n                  * totalLineWidth * uLineParams.xy;\n  vLineCoord = lineOffset.y;\n  ").concat(t?"vEndpointFraction = totalLineWidth / (linePixelLength + totalLineWidth * 2.0);":"","\n  ").concat(t?"vLineCoordT = lineOffset.x; vLineBorderStartFraction = lineWidthInPixels / totalLineWidth;":"","\n}\nvoid emitLine(mat4 projection, vec3 vertexA, vec3 vertexB, float lineWidthInPixels\n              ").concat(t?", float borderWidth":"",") {\n  emitLine(projection * vec4(vertexA, 1.0), projection * vec4(vertexB, 1.0),\n           lineWidthInPixels\n           ").concat(t?", borderWidth":"",");\n}\n")),t&&e.addFragmentCode("\nvec4 getRoundedLineColor(vec4 interiorColor, vec4 borderColor) {\n  float radius;\n  if (vLineCoordT < vEndpointFraction || vLineCoordT > 1.0 - vEndpointFraction) {\n    radius = length(vec2(1.0 - min(vLineCoordT, 1.0 - vLineCoordT) / vEndpointFraction,\n                         vLineCoord));\n    if (radius > 1.0) {\n      discard;\n    }\n  } else {\n    radius = abs(vLineCoord);\n  }\n  float borderColorFraction = clamp((radius - vLineBorderStartFraction) / vLineFeatherFraction, 0.0, 1.0);\n  float feather = clamp((1.0 - radius) / vLineFeatherFraction, 0.0, 1.0);\n  vec4 color = mix(interiorColor, borderColor, borderColorFraction);\n  return vec4(color.rgb, color.a * feather);\n}\n"),e.addFragmentCode("\nfloat getLineAlpha() {\n  return clamp((1.0 - abs(vLineCoord)) / vLineFeatherFraction, 0.0, 1.0);\n}\n")}function a(e,t,n){(0,i.Nm)(e,t,n)}function l(e,t,n){e.gl.uniform3f(e.uniform("uLineParams"),1/t.width,1/t.height,n)}},706:(e,t,n)=>{n.d(t,{DG:()=>y,Mi:()=>v,Ns:()=>m,f_:()=>g,iB:()=>f,oL:()=>h});var i=n(7562),r=n(3835),o=n(2311),s=n(5798),a=n(8336),l=n(8167);class c extends i.O8{constructor(){super(...arguments),this.width=Number.NaN,this.height=Number.NaN}hasSize(e,t){return this.width===e&&this.height===t}resize(e,t){this.hasSize(e,t)||(this.width=e,this.height=t,this.performResize())}}class d extends c{constructor(e,t){super(),this.gl=e,this.internalformat=t,this.renderbuffer=null,this.renderbuffer=e.createRenderbuffer()}performResize(){let e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,this.renderbuffer),e.renderbufferStorage(e.RENDERBUFFER,this.internalformat,this.width,this.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}disposed(){this.gl.deleteRenderbuffer(this.renderbuffer)}attachToFramebuffer(e){let t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,this.renderbuffer)}}class u extends d{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e,t?e.DEPTH_STENCIL:e.DEPTH_COMPONENT16),this.gl=e,this.includeStencilBuffer=t}attachToFramebuffer(){let e=this.gl;super.attachToFramebuffer(this.includeStencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT)}}class h extends u{constructor(e){super(e,!0)}}class p extends i.O8{constructor(e){super(),this.gl=e,this.framebuffer=this.gl.createFramebuffer()}disposed(){this.gl.deleteFramebuffer(this.framebuffer)}bind(){let e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer)}unbind(){let e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)}}class f extends c{constructor(e,t,n,i){super(),this.gl=e,this.internalFormat=t,this.format=n,this.dataType=i,this.texture=e.createTexture()}performResize(){(0,a.yS)(this.gl,this.texture,this.width,this.height,this.internalFormat,this.format,this.dataType)}disposed(){this.gl.deleteTexture(this.texture)}attachToFramebuffer(e){let t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this.texture,0)}}class g extends f{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:WebGL2RenderingContext.DEPTH_COMPONENT16,arguments.length>2&&void 0!==arguments[2]?arguments[2]:WebGL2RenderingContext.DEPTH_COMPONENT,arguments.length>3&&void 0!==arguments[3]?arguments[3]:WebGL2RenderingContext.UNSIGNED_SHORT)}attachToFramebuffer(){super.attachToFramebuffer(this.format===WebGL2RenderingContext.DEPTH_COMPONENT?WebGL2RenderingContext.DEPTH_ATTACHMENT:WebGL2RenderingContext.DEPTH_STENCIL_ATTACHMENT)}}function m(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WebGL2RenderingContext.RGBA8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:WebGL2RenderingContext.RGBA,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:WebGL2RenderingContext.UNSIGNED_BYTE,o=new Array;for(let s=0;s<t;++s)o[s]=new f(e,n,i,r);return o}class v extends i.O8{constructor(e,t){super(),this.gl=e,this.width=Number.NaN,this.height=Number.NaN,this.fullAttachmentList=new Array,this.attachmentVerified=!1,this.singleAttachmentList=[this.gl.COLOR_ATTACHMENT0];var n=t.framebuffer;let i=void 0===n?new p(e):n,r=t.colorBuffers,o=t.depthBuffer;this.framebuffer=this.registerDisposer(i),this.colorBuffers=r,this.depthBuffer=o,void 0!==o&&this.registerDisposer(o);let s=this.fullAttachmentList;r.forEach(((t,n)=>{this.registerDisposer(t),s[n]=e.COLOR_ATTACHMENT0+n}))}hasSize(e,t){return this.width===e&&this.height===t}bind(e,t){this.width=e,this.height=t,this.framebuffer.bind();let n=this.gl,i=this.depthBuffer;void 0!==i?(i.resize(e,t),i.attachToFramebuffer()):n.framebufferRenderbuffer(WebGL2RenderingContext.FRAMEBUFFER,WebGL2RenderingContext.DEPTH_STENCIL_ATTACHMENT,WebGL2RenderingContext.RENDERBUFFER,null),this.colorBuffers.forEach(((i,r)=>{i.resize(e,t),i.attachToFramebuffer(n.COLOR_ATTACHMENT0+r)})),n.drawBuffers(this.fullAttachmentList),this.verifyAttachment(),n.viewport(0,0,e,t)}bindSingle(e){let t=this.gl;this.framebuffer.bind(),0!==e&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0),t.bindTexture(t.TEXTURE_2D,null),this.colorBuffers[e].attachToFramebuffer(t.COLOR_ATTACHMENT0),t.drawBuffers(this.singleAttachmentList)}unbind(){this.framebuffer.unbind()}readPixelFloat32IntoBuffer(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=this.gl;try{this.bindSingle(e),s.readPixels(t,n,r,o,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.FLOAT,i)}finally{this.framebuffer.unbind()}}verifyAttachment(){if(this.attachmentVerified)return;let e=this.gl,t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer configuration not supported: ".concat(t));this.attachmentVerified=!0}}class y extends i.O8{constructor(e,t){super(),this.gl=e,this.shader=t,this.copyVertexPositionsBuffer=(0,s.kl)(this.gl),this.copyTexCoordsBuffer=(0,s.kl)(this.gl,0,0,1,1),this.registerDisposer(t)}draw(){let e=this.gl,t=this.shader;t.bind();let n=arguments.length;for(let r=0;r<n;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,r<0||arguments.length<=r?void 0:arguments[r]);e.uniformMatrix4fv(t.uniform("uProjectionMatrix"),!1,r.r3);let i=t.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(i,2);let o=t.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(o,2),e.drawArrays(e.TRIANGLE_FAN,0,4),e.disableVertexAttribArray(i),e.disableVertexAttribArray(o);for(let r=0;r<n;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null)}static get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.Me,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e.memoize.get("OffscreenCopyHelper:".concat(n,":").concat((0,o.R)(t)),(()=>new y(e,(0,l.PE)(e,t,n))))}}},6532:(e,t,n)=>{n.d(t,{Nm:()=>o,QD:()=>i,W6:()=>r});const i=6,r="\nvec2 getQuadVertexPosition(vec2 lower, vec2 upper) {\n  const vec2 coeffs[] = vec2[](\n    vec2(0.0, 0.0),\n    vec2(0.0, 1.0),\n    vec2(1.0, 1.0),\n    vec2(1.0, 1.0),\n    vec2(1.0, 0.0),\n    vec2(0.0, 0.0)\n  );\n  int v = gl_VertexID % 6;\n  return mix(lower, upper, coeffs[v]);\n}\n";function o(e,t,n){e.drawArraysInstanced(WebGL2RenderingContext.TRIANGLES,0,i*t,n)}},858:(e,t,n)=>{n.d(t,{N5:()=>b,Ym:()=>g,ye:()=>v});var i=n(1274),r=n.n(i),o=n(608),s=n.n(o),a=n(7562);const l=!1;var c;!function(e){e[e.VERTEX=WebGL2RenderingContext.VERTEX_SHADER]="VERTEX",e[e.FRAGMENT=WebGL2RenderingContext.FRAGMENT_SHADER]="FRAGMENT"}(c||(c={}));class d extends Error{constructor(e,t,n,i){const r="Error compiling ".concat(c[e].toLowerCase()," shader: ").concat(n);super(r),this.name="ShaderCompilationError",this.log=n,this.message=r,this.shaderType=e,this.source=t,this.errorMessages=i}}class u extends Error{constructor(e,t,n){const i="Error linking shader: ".concat(n);super(i),this.name="ShaderLinkError",this.log=n,this.message=i,this.vertexSource=e,this.fragmentSource=t}}function h(e,t,n){var i=e.createShader(n);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){let o=e.getShaderInfoLog(i)||"";if(l){let e=t.replace("<","&lt;").replace(">","&gt;").split("\n"),n="<pre>";n+=o.replace("<","&lt;").replace(">","&gt;")+"\n",e.forEach(((e,t)=>{n+="".concat(t+1,": ").concat(e,"\n")})),n+="\n</pre>",console.log(n);let i=window.open("about:blank","_blank");if(null!==i)try{i.document.write(n)}catch(r){}}throw new d(n,t,o,function(e){e=e.replace("\0","");let t=[];for(let n of e.split("\n")){let e=n.match(/^ERROR:\s*(\d+):(\d+)\s*(.+)$/);null!==e?t.push({message:e[3].trim(),file:parseInt(e[1],10),line:parseInt(e[2],10)}):(e=n.match(/^ERROR:\s*(.+)$/),null!==e?t.push({message:e[1]}):(n=n.trim(),n&&t.push({message:n})))}return t}(o))}return i}let p;class f extends a.O8{constructor(e,t,n,i,r,o){super(),this.gl=e,this.vertexSource=t,this.fragmentSource=n,this.attributes=new(s()),this.uniforms=new(s()),this.vertexShaderInputBinders={};let a=this.vertexShader=h(e,t,e.VERTEX_SHADER),c=this.fragmentShader=h(e,n,e.FRAGMENT_SHADER),d=e.createProgram();if(e.attachShader(d,a),e.attachShader(d,c),l&&(null===o||void 0===o?void 0:o.length)&&(e.transformFeedbackVaryings(d,o.map((e=>e.name)),WebGL2RenderingContext.INTERLEAVED_ATTRIBS),this.vertexDebugOutputs=o),e.linkProgram(d),!e.getProgramParameter(d,e.LINK_STATUS)){let i=e.getProgramInfoLog(d)||"";throw new u(t,n,i)}this.program=d;let p=this.uniforms,f=this.attributes;if(i)for(let s of i)p.set(s,e.getUniformLocation(d,s));if(r)for(let s of r)f.set(s,e.getAttribLocation(d,s))}uniform(e){return this.uniforms.get(e)}attribute(e){return this.attributes.get(e)}textureUnit(e){return this.textureUnits.get(e)}bind(){p=this,this.gl.useProgram(this.program)}disposed(){let e=this.gl;e.deleteShader(this.vertexShader),this.vertexShader=void 0,e.deleteShader(this.fragmentShader),this.fragmentShader=void 0,e.deleteProgram(this.program),this.program=void 0,this.gl=void 0,this.attributes=void 0,this.uniforms=void 0}}function g(e,t,n,i,r){if(e.drawArraysInstanced(t,n,i,r),!l||!(null===p||void 0===p?void 0:p.vertexDebugOutputs))return;const o=p.vertexDebugOutputs;let s=0;for(const l of o)s+=y[l.typeName];const a=e.createBuffer(),c=s*i*r;e.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,a),e.bufferData(WebGL2RenderingContext.ARRAY_BUFFER,c,WebGL2RenderingContext.DYNAMIC_DRAW),e.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,null),e.bindBufferBase(WebGL2RenderingContext.TRANSFORM_FEEDBACK_BUFFER,0,a),e.beginTransformFeedback(WebGL2RenderingContext.POINTS),e.enable(WebGL2RenderingContext.RASTERIZER_DISCARD),e.drawArraysInstanced(WebGL2RenderingContext.POINTS,n,i,r),e.disable(WebGL2RenderingContext.RASTERIZER_DISCARD),e.endTransformFeedback(),e.bindBufferBase(WebGL2RenderingContext.TRANSFORM_FEEDBACK_BUFFER,0,null),e.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,a);const d=new Uint8Array(c);e.getBufferSubData(WebGL2RenderingContext.ARRAY_BUFFER,0,d,0,c),e.bindBuffer(WebGL2RenderingContext.ARRAY_BUFFER,null),e.deleteBuffer(a);let u=0;const h=new Float32Array(d.buffer);for(let l=0;l<r;++l)for(let e=0;e<i;++e){let t="i=".concat(l," v=").concat(e,":");for(const e of o)switch(t+=" ".concat(e.name,"="),e.typeName){case"float":t+="".concat(h[u++]);break;case"vec2":t+="".concat(h[u++],",").concat(h[u++]);break;case"vec3":t+="".concat(h[u++],",").concat(h[u++],",").concat(h[u++]);break;case"vec4":t+="".concat(h[u++],",").concat(h[u++],",").concat(h[u++],",").concat(h[u++])}console.log(t)}}class m{constructor(){this.code="",this.parts=new(r())}add(e){if(!this.parts.has(e))switch(this.parts.add(e),typeof e){case"string":this.code+=e;break;case"function":this.add(e());break;default:if(!Array.isArray(e))throw console.log("Invalid code type",e),new Error("Invalid code type");for(let t of e)this.add(t)}}toString(){return this.code}}const v={sampler2D:WebGL2RenderingContext.TEXTURE_2D,isampler2D:WebGL2RenderingContext.TEXTURE_2D,usampler2D:WebGL2RenderingContext.TEXTURE_2D,sampler3D:WebGL2RenderingContext.TEXTURE_3D,isampler3D:WebGL2RenderingContext.TEXTURE_3D,usampler3D:WebGL2RenderingContext.TEXTURE_3D},y={float:4,vec2:8,vec3:12,vec4:16};class b{constructor(e){this.gl=e,this.nextSymbolID=0,this.nextTextureUnit=0,this.uniformsCode="",this.attributesCode="",this.varyingsCodeVS="",this.varyingsCodeFS="",this.fragmentExtensionsSet=new(r()),this.fragmentExtensions="",this.vertexCode=new m,this.vertexMain="",this.fragmentCode=new m,this.outputBufferCode="",this.fragmentMain="",this.required=new(r()),this.uniforms=new Array,this.attributes=new Array,this.initializers=[],this.textureUnits=new(s()),this.vertexDebugOutputs=[]}addVertexPositionDebugOutput(){this.vertexDebugOutputs.push({typeName:"vec4",name:"gl_Position"})}addVertexDebugOutput(e,t){this.addVarying(e,t),this.vertexDebugOutputs.push({typeName:e,name:t})}allocateTextureUnit(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.textureUnits.has(e))throw new Error("Duplicate texture unit symbol: "+e.toString());let n=this.nextTextureUnit;return this.nextTextureUnit+=t,this.textureUnits.set(e,n),n}addTextureSampler(e,t,n,i){let r=this.allocateTextureUnit(n,i);return this.addUniform("highp ".concat(e),t,i),this.addInitializer((e=>{if(i){let n=new Int32Array(i);for(let e=0;e<i;++e)n[e]=e+r;e.gl.uniform1iv(e.uniform(t),n)}else e.gl.uniform1i(e.uniform(t),r)})),r}symbol(e){return e+this.nextSymbolID++}addAttribute(e,t,n){return this.attributes.push(t),void 0!==n&&(this.attributesCode+="layout(location = ".concat(n,")")),this.attributesCode+="in ".concat(e," ").concat(t,";\n"),t}addVarying(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.varyingsCodeVS+="".concat(n," out ").concat(e," ").concat(t,";\n"),this.varyingsCodeFS+="".concat(n," in ").concat(e," ").concat(t,";\n")}addOutputBuffer(e,t,n){null!==n&&(this.outputBufferCode+="layout(location = ".concat(n,") ")),this.outputBufferCode+="out ".concat(e," ").concat(t,";\n")}addUniform(e,t,n){return this.uniforms.push(t),this.uniformsCode+=null!=n?"uniform ".concat(e," ").concat(t,"[").concat(n,"];\n"):"uniform ".concat(e," ").concat(t,";\n"),t}addFragmentExtension(e){this.fragmentExtensionsSet.has(e)||(this.fragmentExtensionsSet.add(e),this.fragmentExtensions+="#extension ".concat(e," : require\n"))}addVertexCode(e){this.vertexCode.add(e)}addFragmentCode(e){this.fragmentCode.add(e)}setVertexMain(e){this.vertexMain=e}addVertexMain(e){this.vertexMain=(this.vertexMain||"")+e}setFragmentMain(e){this.fragmentMain="void main() {\n".concat(e,"\n}\n")}setFragmentMainFunction(e){this.fragmentMain=e}addInitializer(e){this.initializers.push(e)}require(e){this.required.has(e)||(this.required.add(e),e(this))}build(){let e="#version 300 es\nprecision highp float;\nprecision highp int;\n".concat(this.uniformsCode,"\n").concat(this.attributesCode,"\n").concat(this.varyingsCodeVS,"\n").concat(this.vertexCode,"\nvoid main() {\n").concat(this.vertexMain,"\n}\n"),t="#version 300 es\n".concat(this.fragmentExtensions,"\nprecision highp float;\nprecision highp int;\n").concat(this.uniformsCode,"\n").concat(this.varyingsCodeFS,"\n").concat(this.outputBufferCode,"\n").concat(this.fragmentCode,"\n").concat(this.fragmentMain,"\n"),n=new f(this.gl,e,t,this.uniforms,this.attributes,this.vertexDebugOutputs);n.textureUnits=this.textureUnits;let i=this.initializers;if(i.length>0){n.bind();for(let e of i)e(n)}return n}}},6098:(e,t,n)=>{n.d(t,{A0:()=>E,AE:()=>P,CQ:()=>l,Hp:()=>o,KN:()=>g,Kc:()=>b,MJ:()=>v,MX:()=>x,NQ:()=>L,QH:()=>a,Tm:()=>S,US:()=>u,Xz:()=>c,Z6:()=>r,ZK:()=>y,Zu:()=>M,bC:()=>T,c:()=>w,cz:()=>d,dG:()=>C,dt:()=>N,fT:()=>m,fZ:()=>f,mh:()=>I,oX:()=>D,rL:()=>h,sZ:()=>s,uZ:()=>p,v1:()=>k,xs:()=>R});var i=n(9043);const r="\nfloat mixLinear(float x, float y, float a) { return mix(x, y, a); }\n";var o="\nvec3 hueToRgb(float hue) {\n  float hue6 = hue * 6.0;\n  float r = abs(hue6 - 3.0) - 1.0;\n  float g = 2.0 - abs(hue6 - 2.0);\n  float b = 2.0 - abs(hue6 - 4.0);\n  return clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 hsvToRgb(vec3 c) {\n  vec3 hueRgb = hueToRgb(c.x);\n  return c.z * ((hueRgb - 1.0) * c.y + 1.0);\n}\n";const s="\nstruct uint64_t {\n  highp uvec2 value;\n};\nstruct uint64x2_t {\n  highp uvec4 value;\n};\nuint64_t mixLinear(uint64_t x, uint64_t y, float a) {\n  return x;\n}\nuint64_t toUint64(uint64_t x) { return x; }\n",a=[s,"\nuint64_t unpackUint64leFromUint32(highp uvec2 x) {\n  uint64_t result;\n  result.value = x;\n  return result;\n}\nuint64x2_t unpackUint64leFromUint32(highp uvec4 x) {\n  uint64x2_t result;\n  result.value = x;\n  return result;\n}\n"],l=[s,"\nbool equals(uint64_t a, uint64_t b) {\n  return a.value == b.value;\n}\n"],c=[s,"\nbool compareLessThan(uint64_t a, uint64_t b) {\n  return (a.value[1] < b.value[1])||\n         (a.value[1] == b.value[1] && a.value[0] < b.value[0]);\n}\n"],d=[s,"\nuint64_t subtract(uint64_t a, uint64_t b) {\n  if (a.value[0] < b.value[0]) {\n    --a.value[1];\n  }\n  a.value -= b.value;\n  return a;\n}\n"],u=[[s,"\nuint64_t add(uint64_t a, uint64_t b) {\n  a.value[0] += b.value[0];\n  if (a.value[0] < b.value[0]) {\n    ++a.value[1];\n  }\n  a.value[1] += b.value[1];\n  return a;\n}\n"],c,"\nuint64_t addSaturate(uint64_t a, uint64_t b) {\n  a = add(a, b);\n  if (compareLessThan(a, b)) {\n    a.value = uvec2(0xffffffffu, 0xffffffffu);\n  }\n  return a;\n}\n"],h=[d,c,"\nuint64_t subtractSaturate(uint64_t a, uint64_t b) {\n  b = subtract(a, b);\n  if (compareLessThan(a, b)) {\n    b.value = uvec2(0u, 0u);\n  }\n  return b;\n}\n"],p=[s,"\nuint64_t shiftRight(uint64_t a, int shift) {\n  if (shift >= 32) {\n    return uint64_t(uvec2(a.value[1] >> (shift - 32), 0u));\n  } else if (shift == 0) {\n    return a;\n  } else {\n    return uint64_t(uvec2((a.value[0] >> shift) | (a.value[1] << (32 - shift)), a.value[1] >> shift));\n  }\n}\n"],f=[s,"\nuint64_t shiftLeft(uint64_t a, int shift) {\n  if (shift >= 32) {\n    return uint64_t(uvec2(0u, a.value[0] << (shift - 32)));\n  } else if (shift == 0) {\n    return a;\n  } else {\n    return uint64_t(uvec2(a.value[0] << shift, (a.value[1] << shift) | (a.value[0] >> (32 - shift))));\n  }\n}\n"],g=[s,"\nstruct uint8_t {\n  highp uint value;\n};\nstruct uint8x2_t {\n  highp uvec2 value;\n};\nstruct uint8x3_t {\n  highp uvec3 value;\n};\nstruct uint8x4_t {\n  highp uvec4 value;\n};\nuint8_t mixLinear(uint8_t x, uint8_t y, highp float a) {\n  return uint8_t(uint(round(mix(float(x.value), float(y.value), a))));\n}\nhighp uint toRaw(uint8_t x) { return x.value; }\nhighp float toNormalized(uint8_t x) { return float(x.value) / 255.0; }\nhighp uvec2 toRaw(uint8x2_t x) { return x.value; }\nhighp vec2 toNormalized(uint8x2_t x) { return vec2(x.value) / 255.0; }\nhighp uvec3 toRaw(uint8x3_t x) { return x.value; }\nvec3 toNormalized(uint8x3_t x) { return vec3(x.value) / 255.0; }\nhighp uvec4 toRaw(uint8x4_t x) { return x.value; }\nvec4 toNormalized(uint8x4_t x) { return vec4(x.value) / 255.0; }\nuint64_t toUint64(uint8_t x) {\n  uint64_t result;\n  result.value[0] = x.value;\n  result.value[1] = 0u;\n  return result;\n}\nuint8_t uint8FromFloat(highp float x) {\n  return uint8_t(uint(clamp(x, 0.0, 255.0)));\n}\n"],m=[s,"\nstruct int8_t {\n  highp int value;\n};\nstruct int8x2_t {\n  highp ivec2 value;\n};\nstruct int8x3_t {\n  highp ivec3 value;\n};\nstruct int8x4_t {\n  highp ivec4 value;\n};\nint8_t mixLinear(int8_t x, int8_t y, highp float a) {\n  return int8_t(int(round(mix(float(x.value), float(y.value), a))));\n}\nhighp int toRaw(int8_t x) { return x.value; }\nhighp ivec2 toRaw(int8x2_t x) { return x.value; }\nhighp ivec3 toRaw(int8x3_t x) { return x.value; }\nhighp ivec4 toRaw(int8x4_t x) { return x.value; }\nuint64_t toUint64(int8_t x) {\n  uint64_t result;\n  result.value[0] = uint(x.value);\n  result.value[1] = uint(x.value >> 31);\n  return result;\n}\nint8_t int8FromFloat(highp float x) {\n  return int8_t(int(clamp(x, -128.0, 127.0)));\n}\n"],v="\nhighp float toRaw(highp float x) { return x; }\nhighp float toNormalized(highp float x) { return x; }\nvec2 toRaw(vec2 x) { return x; }\nvec2 toNormalized(vec2 x) { return x; }\nvec3 toRaw(vec3 x) { return x; }\nvec3 toNormalized(vec3 x) { return x; }\nvec4 toRaw(vec4 x) { return x; }\nvec4 toNormalized(vec4 x) { return x; }\n",y=[s,"\nstruct uint16_t {\n  highp uint value;\n};\nstruct uint16x2_t {\n  highp uvec2 value;\n};\nuint16_t mixLinear(uint16_t x, uint16_t y, highp float a) {\n  return uint16_t(uint(round(mix(float(x.value), float(y.value), a))));\n}\nhighp uint toRaw(uint16_t x) { return x.value; }\nhighp float toNormalized(uint16_t x) { return float(toRaw(x)) / 65535.0; }\nhighp uvec2 toRaw(uint16x2_t x) { return x.value; }\nhighp vec2 toNormalized(uint16x2_t x) { return vec2(toRaw(x)) / 65535.0; }\nuint64_t toUint64(uint16_t x) {\n  uint64_t result;\n  result.value[0] = x.value;\n  result.value[1] = 0u;\n  return result;\n}\nuint16_t uint16FromFloat(highp float x) {\n  return uint16_t(uint(clamp(x, 0.0, 65535.0)));\n}\n"],b=[s,"\nstruct int16_t {\n  highp int value;\n};\nstruct int16x2_t {\n  highp ivec2 value;\n};\nint16_t mixLinear(int16_t x, int16_t y, highp float a) {\n  return int16_t(int(round(mix(float(x.value), float(y.value), a))));\n}\nhighp int toRaw(int16_t x) { return x.value; }\nhighp ivec2 toRaw(int16x2_t x) { return x.value; }\nuint64_t toUint64(int16_t x) {\n  uint64_t result;\n  result.value[0] = uint(x.value);\n  result.value[1] = uint(x.value >> 31);\n  return result;\n}\nint16_t int16FromFloat(highp float x) {\n  return int16_t(int(clamp(x, -32768.0, 32767.0)));\n}\n"],S=[s,"\nstruct uint32_t {\n  highp uint value;\n};\nuint32_t mixLinear(uint32_t x, uint32_t y, highp float a) {\n  return uint32_t(uint(round(mix(float(x.value), float(y.value), a))));\n}\nhighp float toNormalized(uint32_t x) { return float(x.value) / 4294967295.0; }\nhighp uint toRaw(uint32_t x) { return x.value; }\nuint64_t toUint64(uint32_t x) {\n  uint64_t result;\n  result.value[0] = x.value;\n  result.value[1] = 0u;\n  return result;\n}\nuint32_t uint32FromFloat(highp float x) {\n  return uint32_t(uint(clamp(x, 0.0, 4294967295.0)));\n}\n"],w=[s,"\nstruct int32_t {\n  highp int value;\n};\nint32_t mixLinear(int32_t x, int32_t y, highp float a) {\n  return int32_t(int(round(mix(float(x.value), float(y.value), a))));\n}\nhighp int toRaw(int32_t x) { return x.value; }\nuint64_t toUint64(int32_t x) {\n  uint64_t result;\n  result.value[0] = uint(x.value);\n  result.value[1] = uint(x.value >> 31);\n  return result;\n}\nint32_t int32FromFloat(highp float x) {\n  return int32_t(int(clamp(x, 2147483648.0, 2147483647.0)));\n}\n"];var x="\nhighp int getFortranOrderIndex(ivec3 subscripts, ivec3 size) {\n  return subscripts.x + size.x * (subscripts.y + size.y * subscripts.z);\n}\n";const C="\nhighp uint log2Exact(highp uint i) {\n  highp uint r;\n  r = uint((i & 0xAAAAAAAAu) != 0u);\n  r |= uint((i & 0xFFFF0000u) != 0u) << 4;\n  r |= uint((i & 0xFF00FF00u) != 0u) << 3;\n  r |= uint((i & 0xF0F0F0F0u) != 0u) << 2;\n  r |= uint((i & 0xCCCCCCCCu) != 0u) << 1;\n  return r;\n}\n",k="\nbool clipLineToDepthRange(inout highp vec4 a, inout highp vec4 b) {\n  highp float tmin = 0.0, tmax = 1.0;\n  highp float k1 = b.w - a.w + a.z - b.z;\n  highp float k2 = a.w - b.w + a.z - b.z;\n  highp float q1 = (a.z - a.w) / k1;\n  highp float q2 = (a.z + a.w) / k2;\n  if (k1 > 0.0) tmin = max(tmin, q1);\n  else if (k1 < 0.0) tmax = min(tmax, q1);\n  if (k2 > 0.0) tmax = min(tmax, q2);\n  else if (k2 < 0.0) tmin = max(tmin, q2);\n  if (tmin <= tmax) {\n    highp vec4 tempA = a;\n    highp vec4 tempB = b;\n    a = mix(tempA, tempB, tmin);\n    b = mix(tempA, tempB, tmax);\n    return true;\n  }\n  return false;\n}\n",E="\nhighp float simpleFloatHash(highp vec2 co) {\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n",T="\nhighp uint shiftLeftSaturate(highp uint x, int shiftAmount) {\n  highp uint result = x << shiftAmount;\n  if ((result >> shiftAmount) != x) return 0xffffffffu;\n  return result;\n}\n",L="\nhighp uint addSaturate(highp uint x, highp uint y) {\n  highp uint result = x + y;\n  if (result < x) return 0xffffffffu;\n  return result;\n}\n",P="\nhighp uint subtractSaturate(highp uint x, highp uint y) {\n  highp uint result = x - y;\n  if (result > x) return 0u;\n  return result;\n}\n",D=[L,"\nhighp int addSaturate(highp int x, highp uint y) {\n  if (x >= 0) {\n    return int(min(addSaturate(y, uint(x)), 0x7fffffffu));\n  } else if (y >= uint(-x)) {\n    return int(min(y - uint(-x), 0x7fffffffu));\n  } else {\n    return -int(min(uint(-x) - y, 0x80000000u));\n  }\n}\n"],M=[L,"\nhighp int subtractSaturate(highp int x, highp uint y) {\n  if (x < 0) {\n    return -int(min(addSaturate(uint(-x), uint(y)), 0x80000000u));\n  } else if (uint(x) >= y) {\n    return x - int(y);\n  } else {\n    return -int(min(y - uint(x), 0x80000000u));\n  }\n}\n"];function I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(e){case i.pe.FLOAT32:if(1===t)return"float";if(t>1&&t<=4)return"vec".concat(t);break;case i.pe.UINT8:case i.pe.INT8:case i.pe.UINT16:case i.pe.INT16:case i.pe.UINT32:case i.pe.INT32:case i.pe.UINT64:{const n=i.L8[e]?"":"u",r=8*i.iV[e];if(1===t)return"".concat(n,"int").concat(r,"_t");if(t>1&&t*r<=32)return"".concat(n,"int").concat(r,"x").concat(t,"_t");break}}throw new Error("No shader type for ".concat(i.pe[e],"[").concat(t,"]."))}const R={[i.pe.UINT8]:g,[i.pe.INT8]:m,[i.pe.UINT16]:y,[i.pe.INT16]:b,[i.pe.UINT32]:S,[i.pe.INT32]:w,[i.pe.UINT64]:s,[i.pe.FLOAT32]:v};function A(e,t){return 1===t?e:"float"===e?"vec".concat(t):"".concat(e[0],"vec").concat(t)}const O={[WebGL2RenderingContext.UNSIGNED_BYTE]:1,[WebGL2RenderingContext.BYTE]:1,[WebGL2RenderingContext.UNSIGNED_SHORT]:2,[WebGL2RenderingContext.SHORT]:2,[WebGL2RenderingContext.FLOAT]:4,[WebGL2RenderingContext.INT]:4,[WebGL2RenderingContext.UNSIGNED_INT]:4};function N(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=0,l=o*s;for(;l>0;){const n=Math.min(4,l),i=A(t,n);l-=n,e.addAttribute("highp "+i,"a".concat(r).concat(a)),++a}l=o*s;let c="";for(let u=0;u<s;++u){c+="highp ".concat(t,"[").concat(o,"] get").concat(r).concat(u,"() {\n  highp ").concat(t,"[").concat(o,"] result;\n");for(let e=0;e<o;++e){const t=u*o+e,n=Math.floor(t/4),i=t%4;c+="  result[".concat(e,"] = a").concat(r).concat(n),0===i&&t===l-1||(c+="[".concat(i,"]")),c+=";\n"}c+="  return result;\n",c+="}\n"}e.addVertexCode(c);const d=O[n];e.addInitializer((e=>{const o=[];for(let t=0;t<a;++t)o[t]=e.attribute("a".concat(r).concat(t));e.vertexShaderInputBinders[r]={enable(t){const n=e.gl;for(let e=0;e<a;++e){const i=o[e];n.enableVertexAttribArray(i),n.vertexAttribDivisor(i,t)}},disable(){const t=e.gl;for(let e=0;e<a;++e){const n=o[e];t.vertexAttribDivisor(n,0),t.disableVertexAttribArray(n)}},bind(r,s){const c=e.gl;for(let e=0;e<a;++e){const a=o[e],u=Math.min(4,l-4*e);"float"===t?c.vertexAttribPointer(a,u,n,i,r,s):c.vertexAttribIPointer(a,Math.min(4,l-4*e),n,r,s),s+=d*u}}}}))}},4011:(e,t,n)=>{n.d(t,{PH:()=>I,TZ:()=>C,a$:()=>R,dB:()=>O,kk:()=>E});var i=n(984),r=n.n(i),o=n(2395),s=n.n(o),a=n(2982),l=n(608),c=n.n(l),d=n(7965),u=n(7160),h=n(9735),p=n(2303),f=n(7562),g=n(7970),m=n(679),v=n(6344),y=n(863),b=n(6754);function S(e){const t=/^(?:-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?|"(?:\\.|[^\\"])*"|true|false|:|\s+|,|\[|\]|\{|\})/;let n=0,i=e;e:for(;e.length;){const i=e.match(t);if(null===i)break;const r=i[0];switch(r.charAt(0)){case"[":case"{":++n;break;case"]":case"}":if(--n<0)return-1;break;case",":if(0===n)break e;break;default:if(0===n){e=e.substring(r.length);break e}}e=e.substring(r.length)}return 0!==n?-1:i.length-e.length}function w(e,t){"number"===typeof e&&(e=[e]);const n=new Array(t);return(0,g.parseFixedLengthArray)(n,e,(e=>{if(!s()(e)||e<0)throw new Error("Expected non-negative integer, but received: ".concat(r()(e)));return e})),n}const x=new(c())([["slider",function(e,t){let n,i,r,o,l=[];"float"!==e&&"uint"!==e&&"int"!==e&&l.push("type must be float, int, or uint");for(const d of t){var c=(0,a.A)(d,2);const t=c[0],u=c[1],h=()=>{if("number"===typeof u)return"int"!==e&&"uint"!==e||(s()(u)||l.push("Expected ".concat(t," argument to be an integer")),"uint"===e&&u<0&&l.push("Expected ".concat(t," argument to be an unsigned integer"))),u;l.push("Expected ".concat(t," argument to be a number"))};"min"===t?n=h():"max"===t?i=h():"default"===t?o=h():"step"===t?r=h():l.push("Invalid parameter: ".concat(t))}return void 0===n&&l.push("min must be specified"),void 0===i&&l.push("max must be specified"),void 0!==n&&void 0!==i&&(n>i&&l.push("min must be less than max"),void 0===r&&(r="float"===e?(i-n)/100:1),void 0!==o?(o<n||o>i)&&l.push("default must be within valid range"):o="float"===e?(n+i)/2:n),l.length>0?{errors:l}:{control:{type:"slider",valueType:e,min:n,max:i,step:r,default:o},errors:void 0}}],["color",function(e,t){let n="white",i=[];"vec3"!==e&&i.push("type must be vec3");for(const o of t){var r=(0,a.A)(o,2);const e=r[0],t=r[1];"default"===e?"string"!==typeof t?i.push("Expected default argument to be a string"):n=t:i.push("Invalid parameter: ".concat(e))}return i.length>0?{errors:i}:{control:{type:"color",valueType:e,defaultString:n,default:(0,p.parseRGBColorSpecification)(n)},errors:void 0}}],["invlerp",function(e,t,n){let i=[];const o=n.imageData;if(void 0===o)return i.push("invlerp control not supported"),{errors:i};"invlerp"!==e&&i.push("type must be invlerp");let s=new Array(o.channelRank).fill(0);const l=o.dataType;let c,d=!0,u=m.ZL[l];for(let f of t){var h=(0,a.A)(f,2);let e=h[0],t=h[1];try{switch(e){case"range":u=(0,m.qM)(t,l);break;case"window":c=(0,m.Gr)((0,m.qM)(t,l));break;case"clamp":"boolean"!==typeof t?i.push("Invalid clamp value: ".concat(r()(t))):d=t;break;case"channel":s=w(t,s.length);break;default:i.push("Invalid parameter: ".concat(e))}}catch(p){i.push("Invalid ".concat(e," value: ").concat(p.message))}}return i.length>0?{errors:i}:{control:{type:"invlerp",dataType:l,clamp:d,default:{range:u,window:null!==c&&void 0!==c?c:(0,m.Zo)(u),channel:s}},errors:void 0}}],["checkbox",function(e,t){let n=!1,i=[];"bool"!==e&&i.push("type must be bool");for(const o of t){var r=(0,a.A)(o,2);const e=r[0],t=r[1];if("default"===e){if("boolean"!==typeof t){i.push("Expected ".concat(e," argument to be a boolean"));continue}n=t}else i.push("Invalid parameter: ".concat(e))}return i.length>0?{errors:i}:{control:{type:"checkbox",valueType:e,default:n},errors:void 0}}]]);function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=function(e){return e.replace(/\/\/.*?$|\/\*(?:.|\n)*?\*\/|'(?:\\.|[^\\'])*'|"(?:\\.|[^\\"])*"/gm,(e=>e.startsWith("/")?e.replace(/[^\s]/g," "):e))}(e);const n=/^([_a-zA-Z][_a-zA-Z0-9]*)[ \t]+([a-z][a-zA-Z0-9_]*)(?:[ \t]+([a-z]+))?[ \t]*(?:\([ \t]*(.*)\)[ \t]*)?/;let i=[];const r=new(c()),o=e.replace(/^[ \t]*#[ \t]*uicontrol[ \t]+(.*)$/gm,((o,s,a)=>{var l;const d=s.match(n),u=()=>Math.max(0,e.substring(0,a).split("\n").length-1);if(null===d)return i.push({line:u(),message:"Invalid #uicontrol syntax, expected: #uicontrol <type> <name> <control>(<param>=<value>, ...)"}),"";const h=d[1],p=d[2],f=null!==(l=d[3])&&void 0!==l?l:h;var g=function(e){let t=[],n=new(c());if(void 0===e)return{errors:t,parameters:n};const i=/^([_a-z][_a-zA-Z0-9]*)[ \t]*=/;for(;0!=(e=e.trim()).length;){const r=e.match(i);if(null===r){t.push("Invalid #uicontrol parameter syntax, expected: <param>=<value>, ...");break}const o=r[1];let s,a=S(e=e.substring(r[0].length));if(a<=0){t.push("Invalid #uicontrol parameter syntax, expected: <param>=<value>, ...");break}try{s=JSON.parse(e.substring(0,a))}catch(l){t.push("Invalid #uicontrol parameter value for ".concat(o,": ").concat(s));break}n.has(o)?t.push("Duplicate #uicontrol parameter: ".concat(o)):n.set(o,s),(e=(e=e.substring(a)).trim()).length>0&&!e.startsWith(",")&&t.push("Invalid #uicontrol parameter syntax, expected: <param>=<value>, ..."),e=e.substring(1)}return{parameters:n,errors:t}}(d[4]);const m=g.parameters,v=g.errors;for(const e of v)i.push({line:u(),message:e});if(r.has(p)&&i.push({line:u(),message:"Duplicate definition for control ".concat(p)}),v.length>0)return"";const y=x.get(f);if(void 0===y)return i.push({line:u(),message:"Invalid control type ".concat(f)}),"";const b=y(h,m,t);if(void 0!==b.errors){for(const e of b.errors)i.push({line:u(),message:e});return""}return r.set(p,b.control),""}));return{source:e,code:o,errors:i,controls:r}}function k(e){return"u_shaderControl_".concat(e)}function E(e,t){const n=e.builderValues;for(const r of e.parseResult.controls){var i=(0,a.A)(r,2);const e=i[0],o=i[1],s=k(e),l=n[e];switch(o.type){case"invlerp":{const n=[(0,b.Xh)(t,s,o.dataType,o.clamp),"\nfloat ".concat(s,"() {\n  return ").concat(s,"(getDataValue(").concat(l.channel.join(","),"));\n}\n")];t.addFragmentCode(n),t.addFragmentCode("#define ".concat(e," ").concat(s,"\n"));break}case"checkbox":{const n="#define ".concat(e," ").concat(l.value,"\n");t.addFragmentCode(n),t.addVertexCode(n);break}default:t.addUniform("highp ".concat(o.valueType),s),t.addVertexCode("#define ".concat(e," ").concat(s,"\n")),t.addFragmentCode("#define ".concat(e," ").concat(s,"\n"))}}}function T(e){if(void 0!==e)return r()(function(e){const t={};for(const i of e){var n=(0,a.A)(i,2);const e=n[0],r=n[1];t[e]=r}return t}(e))}class L{constructor(){this.changed=new v.IY,this.controls=void 0}get value(){return this.controls}set value(e){T(e)!==T(this.controls)&&(this.controls=e,this.changed.dispatch())}}class P extends u.DN{constructor(e,t){super(t,(n=>function(e,t,n){return void 0===e?n:((0,g.verifyObject)(e),{range:(0,g.verifyOptionalObjectProperty)(e,"range",(e=>(0,m.qM)(e,t)),n.range),window:(0,g.verifyOptionalObjectProperty)(e,"window",(e=>(0,m.Gr)((0,m.qM)(e,t))),n.window),channel:(0,g.verifyOptionalObjectProperty)(e,"channel",(e=>w(e,n.channel.length)),n.channel)})}(n,e,t))),this.dataType=e,this.defaultValue=t}toJSON(){var e=this.value;const t=e.range,n=e.window,i=e.channel,r=this.dataType,o=this.defaultValue,s=(0,m.Ho)(t,r,o.range),a=(0,m.Ho)(n,r,o.window),l=(0,h.r1)(o.channel,i)?void 0:i;if(void 0!==s||void 0!==a||void 0!==l)return{range:s,window:a,channel:l}}}function D(e){switch(e.type){case"slider":return{trackable:new u.DN(e.default,(t=>{let n;if(n="float"===e.valueType?(0,g.verifyFiniteFloat)(t):(0,g.verifyInt)(t),n<e.min||n>e.max)throw new Error("".concat(r()(t)," is outside valid range [").concat(e.min,", ").concat(e.max,"]"));return n})),getBuilderValue:()=>null};case"color":return{trackable:new p.TrackableRGB(e.default),getBuilderValue:()=>null};case"invlerp":return{trackable:new P(e.dataType,e.default),getBuilderValue:t=>({channel:t.channel,dataType:e.dataType})};case"checkbox":return{trackable:new d.C_(e.default),getBuilderValue:e=>({value:e})}}}function M(e,t){return r()(e)+"\0"+t.source}function I(e){const t={};for(const r of e.controls){var n=(0,a.A)(r,2);const e=n[0];var i=D(n[1]);const o=i.trackable,s=i.getBuilderValue;t[e]=s(o.value)}return{builderValues:t,parseResult:e,key:M(t,e)}}class R extends f.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.XZ)({}),n=arguments.length>2?arguments[2]:void 0;super(),this.fragmentMain=e,this.dataContext=t,this.channelCoordinateSpaceCombiner=n,this.changed=new v.IY,this.controls=new L,this.fragmentMainGeneration=-1,this.dataContextGeneration=-1,this.parseErrors_=[],this.processedFragmentMain_="",this.controlsGeneration=-1,this.parseResultChanged=new v.IY,this.state_=new(c()),this.unparsedJson=void 0,this.registerDisposer(e.changed.add((()=>this.handleFragmentMainChanged()))),this.registerDisposer(this.controls.changed.add((()=>this.handleControlsChanged()))),this.registerDisposer(this.dataContext.changed.add((()=>this.handleFragmentMainChanged()))),this.handleFragmentMainChanged();const i=this;this.parseErrors={changed:this.parseResultChanged,get value(){return i.handleFragmentMainChanged(),i.parseErrors_}},this.processedFragmentMain={changed:this.parseResultChanged,get value(){return i.handleFragmentMainChanged(),i.processedFragmentMain_}},this.parseResult={changed:this.parseResultChanged,get value(){return i.parseResult_}},this.builderState=(0,u.Uq)(((e,t)=>{const n={};for(const o of t){var i=(0,a.A)(o,2);const e=i[0];var r=i[1];const t=r.trackable,s=(0,r.getBuilderValue)(t.value);n[e]=s}return{key:M(n,e),parseResult:e,builderValues:n}}),[this.parseResult,this],((e,t)=>e.key===t.key));const r=(0,u.Uq)((e=>{const t=[];for(const n of e.values()){const e=n.control,i=n.trackable;"invlerp"===e.type&&t.push({channel:i.value.channel})}return t}),[this],((e,t)=>(0,h.wm)(e,t,((e,t)=>(0,h.r1)(e.channel,t.channel))))),o=(0,u.ol)((e=>{const t=[];for(const n of e.values()){const e=n.control,i=n.trackable;"invlerp"===e.type&&t.push(i.value.window)}return t}),this);this.histogramSpecifications=this.registerDisposer(new y.B(r,o))}handleFragmentMainChanged(){const e=this.fragmentMain.changed.count,t=this.dataContext.changed.count;if(e===this.fragmentMainGeneration&&t===this.dataContextGeneration)return;this.fragmentMainGeneration=e,this.dataContextGeneration=t;const n=this.dataContext.value;if(null===n)this.parseResult_={source:"",code:"",controls:new(c()),errors:[{line:0,message:"Loading"}]},this.parseErrors_=[],this.processedFragmentMain_="",this.controls.value=void 0;else{const e=this.parseResult_=C(this.fragmentMain.value,n);this.parseErrors_=e.errors,this.processedFragmentMain_=e.code,0===e.errors.length&&(this.controls.value=e.controls)}this.parseResultChanged.dispatch()}handleControlsChanged(){const e=this.controls.changed.count;if(e===this.controlsGeneration)return;this.controlsGeneration=e;const t=this.controls.value;if(void 0===t)return;let n=!1;const i=this.state_,o=this.unparsedJson;for(const r of i){var s=(0,a.A)(r,2);const e=s[0],o=s[1];void 0!==t.get(e)||(o.trackable.changed.remove(this.changed.dispatch),i.delete(e),n=!0)}for(const u of t){var l=(0,a.A)(u,2);const e=l[0],t=l[1];let s=i.get(e);if(void 0!==s&&r()(s.control)!==r()(t)&&(s.trackable.changed.remove(this.changed.dispatch),s=void 0),void 0===s){var c=D(t);s={control:t,trackable:c.trackable,getBuilderValue:c.getBuilderValue},s.trackable.changed.add(this.changed.dispatch),i.set(e,s),n=!0}if(void 0!==o&&o.hasOwnProperty(e)){n=!0;try{s.trackable.restoreState(o[e])}catch(d){}}}void 0!==o&&(n=!0),this.unparsedJson=void 0,n&&this.changed.dispatch()}get state(){return this.controls.changed.count!==this.controlsGeneration&&this.handleControlsChanged(),this.state_}get value(){return this.state}restoreState(e){if(void 0===e)return;const t=this.state;(0,g.verifyObject)(e);if(void 0===this.controls.value)return this.unparsedJson=e,void this.changed.dispatch();for(const r of t){var n=(0,a.A)(r,2);const t=n[0],o=n[1].trackable;if(o.reset(),e.hasOwnProperty(t))try{o.restoreState(e[t])}catch(i){}}this.unparsedJson=void 0}reset(){for(const e of this.state.values())e.trackable.reset();void 0!==this.unparsedJson&&(this.unparsedJson=void 0,this.changed.dispatch())}toJSON(){const e=this.state,t=this.unparsedJson;if(void 0!==t)return t;const n={};let i=!0;for(const o of e){var r=(0,a.A)(o,2);const e=r[0],t=r[1].trackable.toJSON();void 0!==t&&(n[e]=t,i=!1)}return i?void 0:n}}function A(e,t,n,i,r){const o=k(n),s=t.uniform(o);switch(i.type){case"slider":switch(i.valueType){case"int":case"uint":e.uniform1i(s,r);break;case"float":e.uniform1f(s,r)}break;case"color":e.uniform3fv(s,r);break;case"invlerp":(0,b.SN)(t,o,i.dataType,r.range)}}function O(e,t,n,i){const o=n.state;if(n.controls.value===i)for(const r of o){var s=(0,a.A)(r,2);const n=s[0],i=s[1];A(e,t,n,i.control,i.trackable.value)}else for(const c of i){var l=(0,a.A)(c,2);const n=l[0],i=l[1],s=o.get(n);A(e,t,n,i,void 0!==s&&r()(s.control)===r()(i)?s.trackable.value:i.default)}}},2362:(e,t,n)=>{n.d(t,{mQ:()=>a});var i=n(7562),r=n(9981);function o(e,t){const n=new Float32Array((e+1)*(t+1)*3);let i=0;for(let r=0;r<=e;++r){const o=r*Math.PI/e,s=Math.sin(o),a=Math.cos(o);for(let e=0;e<=t;++e){const r=2*e*Math.PI/t,o=Math.sin(r),l=Math.cos(r);n[i++]=l*s,n[i++]=a,n[i++]=o*s}}return n}function s(e,t){const n=new Uint16Array(e*t*6);let i=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const o=r*(t+1)+e,s=o+t+1;n[i++]=o,n[i++]=s,n[i++]=o+1,n[i++]=s,n[i++]=s+1,n[i++]=o+1}return n}class a extends i.O8{constructor(e,t,n){super(),this.vertexBuffer=this.registerDisposer((0,r.x)(e,WebGL2RenderingContext.ARRAY_BUFFER,o,t,n)).value,this.indexBuffer=this.registerDisposer((0,r.x)(e,WebGL2RenderingContext.ELEMENT_ARRAY_BUFFER,s,t,n)).value,this.numIndices=t*n*6}defineShader(e){e.addAttribute("highp vec3","aSphereVertex"),e.addVarying("highp float","vLightingFactor"),e.addVertexCode("\nvoid emitSphere(mat4 projectionMatrix, mat4 normalTransformMatrix, vec3 centerPosition, vec3 radii, vec4 lightDirection) {\n  vec3 vertexPosition = aSphereVertex * radii + centerPosition;\n  gl_Position = projectionMatrix * vec4(vertexPosition, 1.0);\n  vec3 normal = normalize((normalTransformMatrix * vec4(aSphereVertex / max(radii, 1e-6), 0.0)).xyz);\n  vLightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\n}\n")}draw(e,t){const n=e.attribute("aSphereVertex");this.vertexBuffer.bindToVertexAttrib(n,3,WebGL2RenderingContext.FLOAT,!1),this.indexBuffer.bind(),e.gl.drawElementsInstanced(WebGL2RenderingContext.TRIANGLES,this.numIndices,WebGL2RenderingContext.UNSIGNED_SHORT,0,t),e.gl.disableVertexAttribArray(n)}}},5798:(e,t,n)=>{n.d(t,{kl:()=>s});var i=n(9735),r=n(9981);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return(0,i.CS)(new Float32Array([e,t,e,r,n,r,n,t]),2,o,s)}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return(0,r.x)(e,WebGL2RenderingContext.ARRAY_BUFFER,o,t,n,i,s,a,l).value}},8336:(e,t,n)=>{function i(e){e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_MIN_FILTER,WebGL2RenderingContext.NEAREST),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_MAG_FILTER,WebGL2RenderingContext.NEAREST),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_WRAP_S,WebGL2RenderingContext.CLAMP_TO_EDGE),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_WRAP_T,WebGL2RenderingContext.CLAMP_TO_EDGE)}function r(e){e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_MIN_FILTER,WebGL2RenderingContext.NEAREST),e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_MAG_FILTER,WebGL2RenderingContext.NEAREST),e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_WRAP_S,WebGL2RenderingContext.CLAMP_TO_EDGE),e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_WRAP_T,WebGL2RenderingContext.CLAMP_TO_EDGE),e.texParameteri(WebGL2RenderingContext.TEXTURE_3D,WebGL2RenderingContext.TEXTURE_WRAP_R,WebGL2RenderingContext.CLAMP_TO_EDGE)}function o(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:WebGL2RenderingContext.RGBA8,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:WebGL2RenderingContext.RGBA,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:WebGL2RenderingContext.UNSIGNED_BYTE;e.activeTexture(WebGL2RenderingContext.TEXTURE0+e.tempTextureUnit),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,t),i(e),e.texImage2D(WebGL2RenderingContext.TEXTURE_2D,0,o,n,r,0,s,a,null),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}function s(e,t,n){e.activeTexture(WebGL2RenderingContext.TEXTURE0+e.tempTextureUnit),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,t),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_MIN_FILTER,WebGL2RenderingContext.LINEAR),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_MAG_FILTER,WebGL2RenderingContext.LINEAR),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_WRAP_S,WebGL2RenderingContext.CLAMP_TO_EDGE),e.texParameteri(WebGL2RenderingContext.TEXTURE_2D,WebGL2RenderingContext.TEXTURE_WRAP_T,WebGL2RenderingContext.CLAMP_TO_EDGE),e.pixelStorei(WebGL2RenderingContext.UNPACK_FLIP_Y_WEBGL,1),e.pixelStorei(WebGL2RenderingContext.UNPACK_ALIGNMENT,4),e.texImage2D(WebGL2RenderingContext.TEXTURE_2D,0,WebGL2RenderingContext.RGBA8,WebGL2RenderingContext.RGBA,WebGL2RenderingContext.UNSIGNED_BYTE,n),e.pixelStorei(WebGL2RenderingContext.UNPACK_FLIP_Y_WEBGL,0),e.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}n.d(t,{$5:()=>r,uN:()=>s,ut:()=>i,yS:()=>o})},2025:(e,t,n)=>{n.d(t,{Gv:()=>P,PC:()=>C,R6:()=>L,YY:()=>w,iY:()=>S,nC:()=>c,nh:()=>k,pK:()=>x});var i=n(4117),r=n.n(i),o=n(9735),s=n(9043),a=n(6098),l=n(8336);class c{}const d=[-1,WebGL2RenderingContext.RED_INTEGER,WebGL2RenderingContext.RG_INTEGER,WebGL2RenderingContext.RGB_INTEGER,WebGL2RenderingContext.RGBA_INTEGER],u=[-1,WebGL2RenderingContext.RED,WebGL2RenderingContext.RG,WebGL2RenderingContext.RGB,WebGL2RenderingContext.RGBA],h=["","r","rg","rgb","rgba"],p=[-1,WebGL2RenderingContext.R8UI,WebGL2RenderingContext.RG8UI,WebGL2RenderingContext.RGB8UI,WebGL2RenderingContext.RGBA8UI],f=[-1,WebGL2RenderingContext.R8I,WebGL2RenderingContext.RG8I,WebGL2RenderingContext.RGB8I,WebGL2RenderingContext.RGBA8I],g=[-1,WebGL2RenderingContext.R16UI,WebGL2RenderingContext.RG16UI,WebGL2RenderingContext.RGB16UI,WebGL2RenderingContext.RGBA16UI],m=[-1,WebGL2RenderingContext.R16I,WebGL2RenderingContext.RG16I,WebGL2RenderingContext.RGB16I,WebGL2RenderingContext.RGBA16I],v=[-1,WebGL2RenderingContext.R32UI,WebGL2RenderingContext.RG32UI,WebGL2RenderingContext.RGB32UI,WebGL2RenderingContext.RGBA32UI],y=[-1,WebGL2RenderingContext.R32I,WebGL2RenderingContext.RG32I,WebGL2RenderingContext.RGB32I,WebGL2RenderingContext.RGBA32I],b=[-1,WebGL2RenderingContext.R32F,WebGL2RenderingContext.RG32F,WebGL2RenderingContext.RGB32F,WebGL2RenderingContext.RGBA32F];function S(e){return e===s.pe.FLOAT32?"":s.L8[e]?"i":"u"}function w(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;switch(t){case s.pe.UINT8:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=p[n],e.textureFormat=d[n],e.texelType=WebGL2RenderingContext.UNSIGNED_BYTE,e.arrayElementsPerTexel=n,e.arrayConstructor=Uint8Array,e.samplerPrefix="u",e;case s.pe.INT8:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=f[n],e.textureFormat=d[n],e.texelType=WebGL2RenderingContext.BYTE,e.arrayElementsPerTexel=n,e.arrayConstructor=Int8Array,e.samplerPrefix="i",e;case s.pe.UINT16:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=g[n],e.textureFormat=d[n],e.texelType=WebGL2RenderingContext.UNSIGNED_SHORT,e.arrayElementsPerTexel=n,e.arrayConstructor=Uint16Array,e.samplerPrefix="u",e;case s.pe.INT16:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=m[n],e.textureFormat=d[n],e.texelType=WebGL2RenderingContext.SHORT,e.arrayElementsPerTexel=n,e.arrayConstructor=Int16Array,e.samplerPrefix="i",e;case s.pe.UINT32:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=v[n],e.textureFormat=d[n],e.texelType=WebGL2RenderingContext.UNSIGNED_INT,e.arrayElementsPerTexel=1,e.arrayConstructor=Uint32Array,e.samplerPrefix="u",e;case s.pe.INT32:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=y[n],e.textureFormat=d[n],e.texelType=WebGL2RenderingContext.INT,e.arrayElementsPerTexel=1,e.arrayConstructor=Int32Array,e.samplerPrefix="i",e;case s.pe.UINT64:if(n<1||n>2)break;return e.texelsPerElement=1,e.textureInternalFormat=v[2*n],e.textureFormat=d[2*n],e.texelType=WebGL2RenderingContext.UNSIGNED_INT,e.arrayElementsPerTexel=2*n,e.arrayConstructor=Uint32Array,e.samplerPrefix="u",e;case s.pe.FLOAT32:if(n<1||n>4)break;return e.texelsPerElement=1,e.textureInternalFormat=b[n],e.textureFormat=u[n],e.texelType=WebGL2RenderingContext.FLOAT,e.arrayElementsPerTexel=n,e.arrayConstructor=Float32Array,e.samplerPrefix="",e}throw new Error("No supported texture format for ".concat(s.pe[t],"[").concat(n,"]."))}function x(e,t,n){const i=t.arrayConstructor,s=t.arrayElementsPerTexel,a=t.textureInternalFormat,c=t.textureFormat,d=t.texelsPerElement,u=e.maxTextureSize,h=n.length/s;if(h*d>u*u)throw new Error("Number of elements exceeds maximum texture size: "+d+" * "+h);const p=Math.ceil(h/u),f=Math.ceil(r()(p)),g=(1<<f)*d,m=Math.ceil(h/(1<<f)),v=g*m*s;n.constructor!==i&&(n=new i(n.buffer,n.byteOffset,n.byteLength/i.BYTES_PER_ELEMENT));let y=(0,o.jx)(n,v);e.pixelStorei(WebGL2RenderingContext.UNPACK_ALIGNMENT,1),(0,l.ut)(e),e.texImage2D(WebGL2RenderingContext.TEXTURE_2D,0,a,g,m,0,c,t.texelType,y)}function C(e,t,n,i,r){const o=t.arrayConstructor,s=t.textureInternalFormat,a=t.textureFormat,c=t.texelsPerElement;n.constructor!==o&&(n=new o(n.buffer,n.byteOffset,n.byteLength/o.BYTES_PER_ELEMENT)),e.pixelStorei(WebGL2RenderingContext.UNPACK_ALIGNMENT,1),(0,l.ut)(e),e.texImage2D(WebGL2RenderingContext.TEXTURE_2D,0,s,i*c,r,0,a,t.texelType,n)}function k(e,t,n,i,r,o){const s=t.arrayConstructor,a=t.textureInternalFormat,c=t.textureFormat,d=t.texelsPerElement;n.constructor!==s&&(n=new s(n.buffer,n.byteOffset,n.byteLength/s.BYTES_PER_ELEMENT)),e.pixelStorei(WebGL2RenderingContext.UNPACK_ALIGNMENT,1),(0,l.$5)(e),e.texImage3D(WebGL2RenderingContext.TEXTURE_3D,0,a,i*d,r,o,0,c,t.texelType,n)}function E(e){switch(e){case s.pe.UINT8:return a.KN;case s.pe.INT8:return a.fT;case s.pe.UINT16:return a.ZK;case s.pe.INT16:return a.Kc;case s.pe.UINT32:return a.Tm;case s.pe.INT32:return a.c;case s.pe.UINT64:return a.sZ;case s.pe.FLOAT32:return a.MJ}}function T(e,t,n,i,r,o){const l=(0,a.mh)(r,o);let c=[E(r)],d="\n".concat(l," ").concat(e,"(").concat(i," index) {\n");switch(r){case s.pe.UINT8:case s.pe.UINT16:case s.pe.UINT32:d+="\n  ".concat(l," result;\n  highp uvec4 temp;\n  ").concat(t,"(").concat(n,", index, temp);\n  result.value = temp.").concat(h[o],";\n  return result;\n");break;case s.pe.INT8:case s.pe.INT16:case s.pe.INT32:d+="\n  ".concat(l," result;\n  highp ivec4 temp;\n  ").concat(t,"(").concat(n,", index, temp);\n  result.value = temp.").concat(h[o],";\n  return result;\n");break;case s.pe.UINT64:c.push(a.QH),d+="\n  highp uvec4 temp;\n  ".concat(t,"(").concat(n,", index, temp);\n  return unpackUint64leFromUint32(temp.").concat(h[2*o],");\n");break;case s.pe.FLOAT32:c.push(a.MJ),d+="\n  highp vec4 temp;\n  ".concat(t,"(").concat(n,", index, temp);\n  return temp.").concat(h[o],";\n")}return d+="\n}\n",c.push(d),c}class L{constructor(e){this.key=e,this.readTextureValue="readTextureValue_".concat(this.key)}defineShader(e){}getReadTextureValueCode(e,t){let n="\nvoid ".concat(this.readTextureValue,"(highp ").concat(t,"sampler2D sampler, highp uint index");for(let i=0;i<e;++i)n+=", out ".concat(t,"vec4 output").concat(i);n+=") {\n  highp int width = textureSize(sampler, 0).x / ".concat(e,";\n  highp uint log2width = log2Exact(uint(width));\n  highp int y = int(index >> log2width);\n  highp int x = int((index - (uint(y) << log2width)) * ").concat(e,"u);\n");for(let i=0;i<e;++i)n+="\n  output".concat(i," = texelFetch(sampler, ivec2(x + ").concat(i,", y), 0);\n");return n+="\n}\n",[a.dG,n]}getAccessor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const r=S(n);return[this.getReadTextureValueCode(1,r),...T(e,this.readTextureValue,t,"highp uint",n,i)]}}class P{constructor(e,t){this.key=e,this.textureDims=t,this.readTextureValue="readTextureValue_".concat(this.key)}getReadTextureValueCode(e,t){const n=this.textureDims;let i="\nvoid ".concat(this.readTextureValue,"(highp ").concat(t,"sampler").concat(this.textureDims,"D sampler, highp ivec").concat(n," p");for(let r=0;r<e;++r)i+=", out ".concat(t,"vec4 output").concat(r);i+=") {\n";for(let r=0;r<e;++r)i+="\n  output".concat(r," = texelFetch(sampler, ivec").concat(n,"(p.x * ").concat(e," + ").concat(r,", p.y\n                                         ").concat(3===n?", p.z":"","), 0);\n");return i+="\n}\n",i}getAccessor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const r=S(n);return[this.getReadTextureValueCode(1,r),...T(e,this.readTextureValue,t,"highp ivec".concat(this.textureDims),n,i)]}}},8167:(e,t,n)=>{n.d(t,{Me:()=>o,PE:()=>s,gP:()=>a});var i=n(2311),r=n(858);function o(e){e.addOutputBuffer("vec4","v4f_fragColor",null),e.setFragmentMain("v4f_fragColor = getValue0();")}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e.memoize.get("elementWiseTextureShader:".concat(n,":").concat((0,i.R)(t)),(()=>{let i=new r.N5(e);i.addVarying("vec2","vTexCoord"),i.addUniform("sampler2D","uSampler",n),i.addInitializer((t=>{let i=[];for(let e=0;e<n;++e)i[e]=e;e.uniform1iv(t.uniform("uSampler"),i)}));for(let e=0;e<n;++e)i.addFragmentCode("\nvec4 getValue".concat(e,"() {\n  return texture(uSampler[").concat(e,"], vTexCoord);\n}\n"));return i.addUniform("mat4","uProjectionMatrix"),i.require(t),i.addAttribute("vec4","aVertexPosition"),i.addAttribute("vec2","aTexCoord"),i.setVertexMain("vTexCoord = aTexCoord; gl_Position = uProjectionMatrix * aVertexPosition;"),i.build()}))}function a(e){return e.memoize.get("trivialColorShader",(()=>{let t=new r.N5(e);return t.addVarying("vec4","vColor"),t.addOutputBuffer("vec4","v4f_fragColor",null),t.setFragmentMain("v4f_fragColor = vColor;"),t.addAttribute("vec4","aVertexPosition"),t.addAttribute("vec4","aColor"),t.addUniform("mat4","uProjectionMatrix"),t.setVertexMain("vColor = aColor; gl_Position = uProjectionMatrix * aVertexPosition;"),t.build()}))}},8913:(e,t,n)=>{n.d(t,{N:()=>o,u:()=>s});var i=n(7562),r=n(9981);function o(e){e.addAttribute("int","aDummyVertexId",0),e.addVertexCode("\nint getVertexId () {\n  return aDummyVertexId + gl_VertexID;\n}\n#define gl_VertexID (getVertexId())\n")}class s extends i.O8{constructor(e){super(),this.buffer=new r.h(e),this.size=0}disposed(){this.buffer.dispose()}enable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256;const t=this.buffer,n=t.gl;t.bind(),e>this.size&&(this.size=e,n.bufferData(WebGL2RenderingContext.ARRAY_BUFFER,new Int32Array(e),WebGL2RenderingContext.STATIC_DRAW)),n.vertexAttribIPointer(0,1,WebGL2RenderingContext.INT,0,0),n.vertexAttribDivisor(0,0),n.enableVertexAttribArray(0)}disable(){this.buffer.gl.disableVertexAttribArray(0)}static get(e){return e.memoize.get("VertexIdHelper",(()=>new s(e)))}}},680:(e,t,n)=>{n.d(t,{G:()=>l});var i=n(3651),r=n.n(i),o=n(5792),s=n.n(o),a=n(1301);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.m)(r()({svg:s()},e))}},7921:(e,t,n)=>{n.d(t,{R:()=>a});var i=n(3651),r=n.n(i),o=n(7562),s=n(1301);class a extends o.O8{constructor(e,t){super(),this.element=(0,s.m)(r()(r()({},t),{onClick:()=>{e.value=!e.value}})),this.element.classList.add("neuroglancer-checkbox-icon"),this.element.classList.add("dark"===t.backgroundScheme?"dark-background":"light-background");const n=()=>{const n=e.value;this.element.dataset.checked=n?"true":"false",this.element.title=(n?t.disableTitle:t.enableTitle)||""};this.registerDisposer(e.changed.add(n)),n()}}},3141:(e,t,n)=>{n.d(t,{Y:()=>u,j:()=>d});var i=n(3651),r=n.n(i),o=n(5556),s=n.n(o),a=n(8905),l=n.n(a),c=n(1301);function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,c.m)(r()({svg:s()},e))}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,c.m)(r()({svg:l()},e))}},5701:(e,t,n)=>{n.d(t,{G:()=>a});var i=n(2303),r=n(8491),o=n(7562),s=n(3835);class a extends o.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>s.eR.fromValues(1,0,0);super(),this.model=e,this.getDefaultColor=t,this.element=document.createElement("input");const n=this.element;n.classList.add("neuroglancer-color-widget"),n.type="color",n.addEventListener("change",(()=>this.updateModel())),n.addEventListener("input",(()=>this.updateModel())),n.addEventListener("wheel",(e=>{e.stopPropagation(),e.preventDefault(),this.adjustHueViaWheel(e)})),this.registerDisposer(e.changed.add((()=>this.updateView()))),this.updateView()}getRGB(){var e;return null!==(e=this.model.value)&&void 0!==e?e:this.getDefaultColor()}updateView(){this.element.value=(0,i.serializeColor)(this.getRGB())}updateModel(){this.model.value=(0,i.parseRGBColorSpecification)(this.element.value)}adjustHueViaWheel(e){const t=this.getRGB(),n=s.eR.create();(0,r.w)(n,t[0],t[1],t[2]);const i=e.deltaY;let o=Math.round(256*n[0]);o+=i>0?1:i<0?-1:0,o=(o+256)%256,n[0]=o/256,(0,r.M)(n,n[0],n[1],n[2]),this.model.value=n}}},6348:(e,t,n)=>{n.d(t,{C:()=>l});var i=n(3651),r=n.n(i),o=n(6247),s=n.n(o),a=n(1301);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.m)(r()({svg:s()},e))}},6410:(e,t,n)=>{n.d(t,{w:()=>l});var i=n(3651),r=n.n(i),o=n(7331),s=n.n(o),a=n(1301);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(0,a.m)(r()({svg:s()},e));return t.firstElementChild.style.fill="white",t}},7772:(e,t,n)=>{n.d(t,{p:()=>l});var i=n(2038),r=n(7562),o=n(3162),s=n(843);class a extends r.O8{constructor(e){super(),this.redraw=e}}class l extends r.O8{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.gH(s.gH.VISIBLE);super(),this.model=e,this.render=t,this.visibility=n,this.element=document.createElement("div"),this.generation=-1,this.currentViewDisposer=void 0,this.debouncedUpdateView=this.registerCancellable((0,i.t)((()=>this.updateView()))),this.element.style.display="contents",this.registerDisposer(e.changed.add(this.debouncedUpdateView)),this.registerDisposer(n.changed.add((()=>{this.visible&&this.debouncedUpdateView()}))),this.updateView()}get visible(){return this.visibility.visible}updateView(){if(!this.visible)return;const e=this.model;if(e.changed.count===this.generation)return;this.disposeCurrentView();const t=this.currentViewDisposer=new a(this.debouncedUpdateView);this.render(e.value,this.element,t)}disposeCurrentView(){let e=this.currentViewDisposer;void 0!==e&&e.dispose(),(0,o.gS)(this.element)}disposed(){this.disposeCurrentView(),super.disposed()}}},7372:(e,t,n)=>{n.d(t,{c:()=>l});var i=n(1190),r=n.n(i),o=n(608),s=n.n(o),a=n(7562);class l extends a.O8{constructor(e){super(),this.model=e,this.element=document.createElement("select"),this.valueIndexMap=new(s());const t=this.element,n=this.valueIndexMap;let i=0;for(const o of r()(e.enumType))if(isNaN(Number(o))){const r=document.createElement("option");r.textContent=r.value=o.toLowerCase(),t.appendChild(r),n.set(e.enumType[o],i),++i}this.registerDisposer(e.changed.add((()=>this.updateView()))),this.registerEventListener(t,"change",(()=>this.updateModel())),this.registerEventListener(t,"wheel",(e=>{e.preventDefault(),e.stopPropagation(),this.adjustViaWheel(e)})),this.updateView()}adjustViaWheel(e){const t=this.element;let n=e.deltaY;n>0?(t.selectedIndex=(t.options.length+t.selectedIndex-1)%t.options.length,this.updateModel()):n<0&&(t.selectedIndex=(t.options.length+t.selectedIndex+1)%t.options.length,this.updateModel())}updateView(){this.element.selectedIndex=this.valueIndexMap.get(this.model.value)}updateModel(){this.model.restoreState(this.element.value)}}},154:(e,t,n)=>{n.d(t,{G:()=>s});var i=n(3651),r=n.n(i),o=n(1301);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.m)(r()({text:"?"},e))}},1301:(e,t,n)=>{function i(e){const t=e.title,n=e.onClick,i=e.href;let r;void 0!==i?(r=document.createElement("a"),r.href=i,r.target="_blank"):r=document.createElement("div"),void 0!==t&&(r.title=t),void 0!==n&&r.addEventListener("click",n);const o=e.svg;return r.className="neuroglancer-icon",void 0!==o&&(r.innerHTML=o),void 0!==e.text&&r.appendChild(document.createTextNode(e.text)),r}n.d(t,{m:()=>i})},1532:(e,t,n)=>{n.d(t,{X$:()=>K,bh:()=>X,kh:()=>_,m7:()=>J,sB:()=>B,sw:()=>Y});var i=n(2395),r=n.n(i),o=n(9176),s=n.n(o),a=n(8178),l=n.n(a),c=n(3651),d=n.n(c),u=n(3111),h=n.n(u),p=n(1234),f=n.n(p),g=n(1434),m=n(2038),v=n(7562),y=n(3162),b=n(8602),S=n(679),w=n(8774),x=n(3234),C=n(8194),k=n(5103),E=n(9981),T=n(9080),L=n(6754),P=n(7520),D=n(858),M=n(6098),I=n(5798),R=n(8336),A=n(1301),O=n(8946);const N=b.n5.fromObject({"shift?+mousedown0":{action:"set"},"shift?+alt+mousedown0":{action:"adjust-window-via-drag"},"shift?+wheel":{action:"zoom-via-wheel"}});class _ extends v.O8{constructor(e,t,n,i){super(),this.element=e,this.dataType=t,this.getModel=n,this.setModel=i,e.title=N.describe(),this.registerDisposer(new w.qy(e,N)),(0,b.qZ)(e,"set",(e=>{const t=e.detail,n=this.getModel(),i=this.getTargetValue(t);if(void 0===i)return;const r=(0,S.M_)(n.window,n.range),o=(0,S.fS)(r,i),s=e=>{const t=this.getModel();this.setModel(B(t,"range",o,e))};s(i),(0,x.i)(t,(e=>{const t=this.getTargetValue(e);void 0!==t&&s(t)}))})),(0,b.qZ)(e,"adjust-window-via-drag",(e=>{const t=e.detail,n=this.getTargetFraction(t),i=this.getWindowLerp(n),r=n<.5?0:1,o=e=>{const t=this.getModel();this.setModel(B(t,"window",r,e))};(0,x.i)(t,(e=>{const t=this.getModel().window,n=this.getTargetFraction(e);o(0===r?(0,S.LK)([i,t[1]],this.dataType,-n/(1-n)):(0,S.LK)([t[0],i],this.dataType,1/n))}))})),(0,b.qZ)(e,"zoom-via-wheel",(e=>{const t=e.detail,n=(0,k.d)(t),i=this.getTargetFraction(t),r=this.dataType,o=this.getModel(),s=(0,S.LK)(o.window,r,i*(1-n)),a=(0,S.LK)(o.window,r,(1-i)*n+i);this.setModel(d()(d()({},o),{window:[s,a],range:o.range}))}))}getTargetFraction(e){const t=this.element.getBoundingClientRect();return(e.clientX-t.left)/t.width}getWindowLerp(e){return(0,S.LK)(this.getModel().window,this.dataType,e)}getTargetValue(e){const t=this.getTargetFraction(e);if(l()(t))return this.getWindowLerp(t)}}const V=s()("histogramSamplerTexture");function B(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=d()({},e),s=e[t];if(o[t]=[s[0],s[1]],o[t][n]=i,"window"===t&&(0,S.Os)(i,s[1-n])*(2*n-1)<0&&(o[t][1-n]=i),"range"===t&&r){const t=[e.window[0],e.window[1]];for(let e=0;e<2;++e)(0,S.Os)(i,t[e])*(2*e-1)>0&&(t[e]=i);o.window=t}return o}const F=255;class U extends g.Y5{constructor(e){super(e.display,document.createElement("div"),e.visibility),this.parent=e,this.controller=this.registerDisposer(new _(this.element,this.parent.dataType,(()=>this.parent.trackable.value),(e=>{this.parent.trackable.value=e}))),this.dataValuesBuffer=this.registerDisposer((0,E.x)(this.gl,WebGL2RenderingContext.ARRAY_BUFFER,(()=>{const e=new Uint8Array(F*P.bn);for(let t=0;t<F;++t)for(let n=0;n<P.bn;++n)e[t*P.bn+n]=t;return e}))).value,this.lineShader=this.registerDisposer((()=>{const e=new D.N5(this.gl);return(0,P.VU)(e),e.addTextureSampler("sampler2D","uHistogramSampler",V),e.addOutputBuffer("vec4","out_color",0),e.addAttribute("uint","aDataValue"),e.addUniform("float","uBoundsFraction"),e.addVertexCode("\nfloat getCount(int i) {\n  return texelFetch(uHistogramSampler, ivec2(i, 0), 0).x;\n}\nvec4 getVertex(float cdf, int i) {\n  float x;\n  if (i == 0) {\n    x = -1.0;\n  } else if (i == 255) {\n    x = 1.0;\n  } else {\n    x = float(i) / 254.0 * uBoundsFraction * 2.0 - 1.0;\n  }\n  return vec4(x, cdf * (2.0 - uLineParams.y) - 1.0 + uLineParams.y * 0.5, 0.0, 1.0);\n}\n"),e.setVertexMain("\nint lineNumber = int(aDataValue);\nint dataValue = lineNumber;\nfloat cumSum = 0.0;\nfor (int i = 0; i <= dataValue; ++i) {\n  cumSum += getCount(i);\n}\nfloat total = cumSum + getCount(dataValue + 1);\nfloat cumSumEnd = dataValue == ".concat(254," ? cumSum : total;\nif (dataValue == ").concat(254,") {\n  cumSum + getCount(dataValue + 1);\n}\nfor (int i = dataValue + 2; i < 256; ++i) {\n  total += getCount(i);\n}\ntotal = max(total, 1.0);\nfloat cdf1 = cumSum / total;\nfloat cdf2 = cumSumEnd / total;\nemitLine(getVertex(cdf1, lineNumber), getVertex(cdf2, lineNumber + 1), 1.0);\n")),e.setFragmentMain("\nout_color = vec4(0.0, 1.0, 1.0, getLineAlpha());\n"),e.build()})()),this.regionCornersBuffer=(0,I.kl)(this.gl,0,-1,1,1),this.regionShader=this.registerDisposer((()=>{const e=new D.N5(this.gl);return e.addAttribute("vec2","aVertexPosition"),e.addUniform("vec2","uBounds"),e.addUniform("vec4","uColor"),e.addOutputBuffer("vec4","out_color",0),e.setVertexMain("\ngl_Position = vec4(mix(uBounds[0], uBounds[1], aVertexPosition.x) * 2.0 - 1.0, aVertexPosition.y, 0.0, 1.0);\n"),e.setFragmentMain("\nout_color = uColor;\n"),e.build()})());this.element.classList.add("neuroglancer-invlerp-cdfpanel")}get drawOrder(){return 100}drawIndirect(){const e=this.lineShader,t=this.gl,n=this.regionShader;var i=this.parent;const r=i.dataType,o=i.trackable.value;this.setGLLogicalViewport(),t.clearColor(0,0,0,0),t.clear(WebGL2RenderingContext.COLOR_BUFFER_BIT),t.enable(WebGL2RenderingContext.BLEND),t.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA),t.disable(WebGL2RenderingContext.DEPTH_TEST),t.disable(WebGL2RenderingContext.STENCIL_TEST);{n.bind(),t.uniform4f(n.uniform("uColor"),.2,.2,.2,1);const e=(0,S._)(o.window,o.range[0]),i=(0,S._)(o.window,o.range[1]),s=(0,S.Ct)(r,o.window);t.uniform2f(n.uniform("uBounds"),Math.min(e,i)*s,Math.max(e,i)*s+(1-s));const a=n.attribute("aVertexPosition");this.regionCornersBuffer.bindToVertexAttrib(a,2,WebGL2RenderingContext.FLOAT),t.drawArrays(WebGL2RenderingContext.TRIANGLE_FAN,0,4),t.disableVertexAttribArray(a)}if(this.parent.histogramSpecifications.producerVisibility.visible){const n=this.renderViewport;e.bind(),(0,P.Cy)(e,{width:n.logicalWidth,height:n.logicalHeight},1);const i=e.textureUnit(V);t.uniform1f(e.uniform("uBoundsFraction"),(0,S.Ct)(r,o.window)),t.activeTexture(WebGL2RenderingContext.TEXTURE0+i),t.bindTexture(WebGL2RenderingContext.TEXTURE_2D,this.parent.texture),(0,R.ut)(t);const s=e.attribute("aDataValue");this.dataValuesBuffer.bindToVertexAttribI(s,1,WebGL2RenderingContext.UNSIGNED_BYTE),(0,P.wo)(t,F,1),t.disableVertexAttribArray(s),t.bindTexture(WebGL2RenderingContext.TEXTURE_2D,null)}t.disable(WebGL2RenderingContext.BLEND)}isReady(){return!0}}function z(){}class j extends g.Y5{constructor(e){super(e.display,document.createElement("div"),e.visibility),this.parent=e,this.cornersBuffer=(0,I.kl)(this.gl,-1,-1,1,1);this.element.classList.add("neuroglancer-invlerp-legend-panel");const t=this.shaderOptions=e.legendShaderOptions;this.shaderGetter=(0,T.P9)(this,this.gl,d()(d()({},t),{memoizeKey:{id:"colorLegendShader",base:t.memoizeKey},defineShader:(e,n,i)=>{e.addOutputBuffer("vec4","v4f_fragData0",0),e.addAttribute("vec2","aVertexPosition"),e.addUniform("float","uLegendOffset"),e.addVarying("float","vLinearPosition"),e.setVertexMain("\ngl_Position = vec4(aVertexPosition, 0.0, 1.0);\nvLinearPosition = -uLegendOffset + ((aVertexPosition.x + 1.0) * 0.5) * (1.0 + 2.0 * uLegendOffset);\n");const r=this.parent.dataType,o=(0,M.mh)(r);e.addFragmentCode((0,L.Yy)(e,"ng_colorLegendLerp",r)),e.addFragmentCode("\nvoid emit(vec4 v) {\n  v4f_fragData0 = v;\n}\n".concat(o," getDataValue() {\n  return ng_colorLegendLerp(vLinearPosition);\n}\n").concat(o," getDataValue(int dummyChannel) {\n  return getDataValue();\n}\n").concat(o," getInterpolatedDataValue() {\n  return getDataValue();\n}\n").concat(o," getInterpolatedDataValue(int dummyChannel) {\n  return getDataValue();\n}\n")),t.defineShader(e,n,i)}}))}drawIndirect(){const e=this.shaderGetter(z),t=e.shader;if(null===t)return;this.setGLLogicalViewport();const n=this.gl;n.clearColor(0,0,0,0),n.clear(WebGL2RenderingContext.COLOR_BUFFER_BIT),t.bind(),this.shaderOptions.initializeShader(e),n.enable(WebGL2RenderingContext.BLEND);var i=this.parent;const r=i.trackable.value.window,o=i.dataType;(0,L.SN)(t,"ng_colorLegendLerp",this.parent.dataType,r);const s=(0,S.Nt)(o,r);n.uniform1f(t.uniform("uLegendOffset"),l()(s)?s:0),n.blendFunc(WebGL2RenderingContext.SRC_ALPHA,WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA),n.disable(WebGL2RenderingContext.DEPTH_TEST),n.disable(WebGL2RenderingContext.STENCIL_TEST);const a=t.attribute("aVertexPosition");this.cornersBuffer.bindToVertexAttrib(a,2,WebGL2RenderingContext.FLOAT),n.drawArrays(WebGL2RenderingContext.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(a)}isReady(){return!0}}function G(e,t){const n=document.createElement("input");return n.addEventListener("focus",(()=>{n.select()})),n.classList.add("neuroglancer-invlerp-widget-bound"),n.classList.add("neuroglancer-invlerp-widget-".concat(e,"-bound")),n.type="text",n.spellcheck=!1,n.autocomplete="off",n.title="range"===e?"Data value that maps to ".concat(t):"".concat(0===t?"Lower":"Upper"," bound for distribution"),n}function W(e,t,n){const i=document.createElement("div");i.classList.add("neuroglancer-invlerp-widget-bounds"),i.classList.add("neuroglancer-invlerp-widget-".concat(e,"-bounds"));const r=[G(e,0),G(e,1)];for(let s=0;s<2;++s){const i=r[s];i.addEventListener("input",(()=>{H(i)})),i.addEventListener("change",(()=>{const r=n.value,o=r[e];try{const o=(0,S.DZ)(t,i.value);n.value=B(r,e,s,o,!0)}catch(a){q(i,o[s])}}))}let o;return i.appendChild(r[0]),i.appendChild(r[1]),"range"===e&&(o=[document.createElement("div"),document.createElement("div"),document.createElement("div")],o[1].classList.add("neuroglancer-invlerp-widget-range-spacer"),i.insertBefore(o[0],r[0]),i.insertBefore(o[1],r[1]),i.appendChild(o[2])),{container:i,inputs:r,spacers:o}}function H(e){(0,y.qi)(e,Math.max(1,e.value.length+.1))}function q(e,t){let n;n=t instanceof C.Uint64||r()(t)?t.toString():t.toPrecision(6),e.value=n,H(e)}function Y(e){const t=e.value,n=t.range;e.value=d()(d()({},t),{range:[n[1],n[0]]})}function J(e,t,n){const i=t.value,r=(0,S.LK)(i.range,e,.5-n/2),o=(0,S.LK)(i.range,e,.5+n/2);t.value=d()(d()({},i),{range:[r,o]})}function K(e,t,n,i,r){const o=Math.exp(r),s=t.value,a=(0,S.LK)(n,e,.5-o/2+i),l=(0,S.LK)(n,e,.5+o/2+i);t.value=d()(d()({},s),{range:[a,l]})}class X extends O.oz{constructor(e,t,n,i,r,o,s){super(e),this.display=t,this.dataType=n,this.trackable=i,this.histogramSpecifications=r,this.histogramIndex=o,this.legendShaderOptions=s,this.cdfPanel=this.registerDisposer(new U(this)),this.boundElements={range:W("range",this.dataType,this.trackable),window:W("window",this.dataType,this.trackable)},this.registerDisposer(r.visibility.add(this.visibility));const a=this.element,l=this.boundElements;if(void 0!==s){const e=this.registerDisposer(new j(this));a.appendChild(e.element)}const c=e=>{const t=(0,A.m)({svg:e,title:"Invert range",onClick:()=>{this.invertRange()}});return l.range.spacers[1].appendChild(t),t};this.invertArrows=[c(f()),c(h())],a.appendChild(l.range.container),a.appendChild(this.cdfPanel.element),a.classList.add("neuroglancer-invlerp-widget"),a.appendChild(l.window.container),this.updateView(),this.registerDisposer(i.changed.add(this.registerCancellable((0,m.t)((()=>this.updateView())))))}get texture(){return this.histogramSpecifications.getFramebuffers(this.display.gl)[this.histogramIndex].colorBuffers[0].texture}invertRange(){Y(this.trackable)}updateView(){const e=this.boundElements,t=this.trackable.value,n=this.dataType;for(let d=0;d<2;++d)q(e.range.inputs[d],t.range[d]),q(e.window.inputs[d],t.window[d]);const i=(0,S.Os)(t.range[0],t.range[1])>0;e.range.container.style.flexDirection=i?"row-reverse":"row";const r=(0,S.M_)(t.window,t.range),o=e.range.spacers,s=(0,S.Ct)(n,t.window),a=(0,S._)(t.window,r[i?1:0])*s,l=(0,S._)(t.window,r[i?0:1])*s+(1-s);o[i?2:0].style.width="".concat(100*a,"%"),o[i?0:2].style.width="".concat(100*(1-l),"%");const c=this.invertArrows;c[i?1:0].style.display="",c[i?0:1].style.display="none"}}},8093:(e,t,n)=>{n.d(t,{KZ:()=>c,jH:()=>a,ok:()=>d});var i=n(3240),r=n(843),o=n(7772);function s(e,t,n,i){const r=document.createElement("label");r.classList.add("neuroglancer-layer-control-container");const o=document.createElement("div");o.classList.add("neuroglancer-layer-control-label-container");const s=document.createElement("div");s.classList.add("neuroglancer-layer-control-label"),o.appendChild(s);const a=document.createElement("div");a.classList.add("neuroglancer-layer-control-label-text-container"),a.appendChild(document.createTextNode(n.label)),s.appendChild(a),n.title&&(s.title=n.title),r.appendChild(o);var l=n.makeControl(t,e,{labelContainer:o,labelTextContainer:a,display:t.manager.root.display,visibility:i});const c=l.control,d=l.controlElement;return d.classList.add("neuroglancer-layer-control-control"),r.appendChild(d),{controlContainer:r,label:s,labelContainer:o,labelTextContainer:a,control:c}}class a extends i.NL{constructor(e,t){super(e),this.options=t}activate(e){const t=this.options,n=this.layer,o=t.isValid;if(void 0!==o&&!o(n).value)return;var a=(0,i.L0)(e);const l=a.header,c=a.body;var d=s(e,n,t,new r.gH(r.gH.VISIBLE));const u=d.controlContainer,h=d.control,p=d.labelContainer;l.appendChild(p),c.appendChild(u),t.activateTool(e,h)}get description(){var e;const t=this.options;return null!==(e=t.toolDescription)&&void 0!==e?e:t.label}toJSON(){return this.options.toolJson}}function l(e,t,n,r){var o=s(e,t,n,r);const a=o.controlContainer,l=o.label;return a.classList.add("neuroglancer-layer-options-control-container"),l.prepend(e.registerDisposer(new i.QB(t,n.toolJson)).element),a}function c(e,t,n,i){const r=i.isValid;return void 0===r?l(e,t,i,n):e.registerDisposer(new o.p(r(t),((e,r,o)=>{e&&r.appendChild(l(o,t,i,n))}),n)).element}function d(e,t){const n=t.toolJson,r="string"===typeof n?n:n.type;(0,i.zA)(e,r,(e=>new a(e,t)))}},441:(e,t,n)=>{n.d(t,{Y:()=>r});var i=n(7965);function r(e){return{makeControl:(t,n)=>{const r=e(t),o=n.registerDisposer(new i.Fo(r));return{control:o,controlElement:o.element}},activateTool:(e,t)=>{t.model.value=!t.model.value}}}},3625:(e,t,n)=>{n.d(t,{Y:()=>s});var i=n(8602),r=n(5701);const o=i.n5.fromObject({"at:shift+wheel":{action:"adjust-hue-via-wheel"}});function s(e){return{makeControl:(t,n)=>{const i=e(t),o=n.registerDisposer(new r.G(i));return{control:o,controlElement:o.element}},activateTool:(e,t)=>{e.bindInputEventMap(o),e.bindAction("adjust-via-wheel",(e=>{e.stopPropagation(),e.preventDefault(),t.adjustHueViaWheel(e.detail)}))}}}},5041:(e,t,n)=>{n.d(t,{k:()=>s});var i=n(8602),r=n(7372);const o=i.n5.fromObject({"at:shift+wheel":{action:"adjust-via-wheel"}});function s(e){return{makeControl:(t,n)=>{const i=e(t),o=n.registerDisposer(new r.c(i));return{control:o,controlElement:o.element}},activateTool:(e,t)=>{e.bindInputEventMap(o),e.bindAction("adjust-via-wheel",(e=>{e.stopPropagation(),e.preventDefault(),t.adjustViaWheel(e.detail)}))}}}},217:(e,t,n)=>{n.d(t,{k:()=>l});var i=n(8602),r=n(7562),o=n(3162);class s extends r.O8{constructor(e){let{min:t=0,max:n=1,step:i=.01}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.value=e,this.element=document.createElement("label"),this.inputElement=document.createElement("input"),this.numericInputElement=document.createElement("input");let r=this.element,o=this.inputElement,s=this.numericInputElement;r.className="range-slider";const a=e=>{e.min=""+t,e.max=""+n,e.step=""+i,e.valueAsNumber=this.value.value,this.registerEventListener(e,"change",(()=>this.inputValueChanged(e))),this.registerEventListener(e,"input",(()=>this.inputValueChanged(e))),this.registerEventListener(e,"wheel",(t=>{this.adjustViaWheel(e,t)}))};o.type="range",a(o),s.type="number";const l=Math.max(t.toString().length,n.toString().length,Math.min(n,t+i).toString().length,Math.max(t,n-i).toString().length);s.style.width=l+2+"ch",a(s),r.appendChild(o),r.appendChild(s),e.changed.add((()=>{this.inputElement.valueAsNumber=this.value.value,this.numericInputElement.valueAsNumber=this.value.value}))}inputValueChanged(e){this.value.value=e.valueAsNumber}adjustViaWheel(e,t){const n=this.inputElement;let i=t.deltaY;i>0?(n.stepUp(),this.inputValueChanged(e)):i<0&&(n.stepDown(),this.inputValueChanged(e))}disposed(){(0,o.fh)(this.element),super.disposed()}}const a=i.n5.fromObject({"at:shift+wheel":{action:"adjust-via-wheel"}});function l(e){return{makeControl:(t,n)=>{var i=e(t);const r=i.value,o=i.options,a=n.registerDisposer(new s(r,o));return{control:a,controlElement:a.element}},activateTool:(e,t)=>{e.bindInputEventMap(a),e.bindAction("adjust-via-wheel",(e=>{e.stopPropagation(),e.preventDefault(),t.adjustViaWheel(t.inputElement,e.detail)}))}}}},1821:(e,t,n)=>{n.d(t,{F:()=>l});var i=n(3651),r=n.n(i),o=n(4093),s=n.n(o),a=n(1301);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.m)(r()({svg:s()},e))}},1908:(e,t,n)=>{n.d(t,{b:()=>s});var i=n(3651),r=n.n(i),o=n(1301);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.m)(r()({text:"\u2197"},e))}},3606:(e,t,n)=>{n.d(t,{l7:()=>W,sd:()=>N,uf:()=>G});var i,r=n(7528),o=n(974),s=n.n(o),a=n(3651),l=n.n(a),c=n(2395),d=n.n(c),u=n(2982),h=n(3816),p=n.n(h),f=n(984),g=n.n(f),m=n(608),v=n.n(m),y=n(8178),b=n.n(y),S=n(8528),w=n.n(S),x=n(8332),C=n(9859),k=n(2038),E=n(9735),T=n(2328),L=n(7562),P=n(3162),D=n(3835),M=n(1058),I=n(8774),R=n(3234),A=n(2240),O=n(6348);const N="neuroglancer-position",_=I.n5.fromObject({arrowup:{action:"adjust-up"},arrowdown:{action:"adjust-down"},arrowleft:{action:"maybe-tab-backward",preventDefault:!1},arrowright:{action:"maybe-tab-forward",preventDefault:!1},tab:{action:"tab-forward"},"shift+tab":{action:"tab-backward"},wheel:{action:"adjust-via-wheel"},backspace:{action:"delete-backward",preventDefault:!1},enter:{action:"commit"},escape:{action:"cancel"}}),V=[e=>e.nameElement,e=>e.coordinate,e=>e.scaleElement];function B(e,t){const n=e.coordinateArrays[t];return void 0===n?n:""!=e.units[t]||1!==e.scales[t]?null:n}class F{constructor(e,t){this.coordinateSpace=e,this.container=document.createElement("div"),this.nameContainer=document.createElement("span"),this.nameElement=document.createElement("input"),this.scaleContainer=document.createElement("span"),this.scaleElement=document.createElement("input"),this.coordinate=document.createElement("input"),this.coordinateLabel=document.createElement("span"),this.coordinateLabelWidth=0,this.dropdownOwner=void 0,this.modified=!1,this.draggingPosition=!1,this.hasFocus=!1;const n=this.container,o=this.scaleElement,s=this.scaleContainer,a=this.coordinate,l=this.nameElement,c=this.nameContainer,d=this.coordinateLabel;n.title="",n.classList.add("neuroglancer-position-dimension"),n.draggable=!0,n.tabIndex=-1,n.appendChild(c),n.appendChild(o),c.appendChild(l),c.title="Drag to reorder, double click to rename.  Names ending in ' or ^ indicate dimensions local to the layer; names ending in ^ indicate channel dimensions (image layers only).",s.appendChild(o),l.classList.add("neuroglancer-position-dimension-name"),l.disabled=!0,l.spellcheck=!1,l.autocomplete="off",l.required=!0,l.placeholder=" ",s.classList.add("neuroglancer-position-dimension-scale-container"),o.classList.add("neuroglancer-position-dimension-scale"),o.disabled=!0,o.spellcheck=!1,o.autocomplete="off",n.appendChild(s),n.appendChild(a),a.type="text",a.classList.add("neuroglancer-position-dimension-coordinate"),a.spellcheck=!1,a.autocomplete="off",a.pattern=w()(i||(i=(0,r.A)(["(-?d+(?:.(?:d+)?)?)"],["(-?\\d+(?:\\.(?:\\d+)?)?)"])));const u=B(e,t);if(null!=u){let e=0;for(const t of u.labels)e=Math.max(e,t.length);this.coordinateLabelWidth=e,d.style.width="".concat(e+2,"ch"),n.appendChild(d)}a.required=!0,a.placeholder=" ",d.classList.add("neuroglancer-position-dimension-coordinate-label")}}function U(e,t,n,i){return Math.floor((e-t)*(i-1)/(n-t))}function z(e,t){(0,P.qi)(e,t.length+1)}function j(e){const t=e.value;(0,P.qi)(e),e.parentElement.dataset.isEmpty=""===t?"true":"false"}class G extends L.O8{constructor(e,t){let{copyButton:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.position=e,this.combiner=t,this.element=document.createElement("div"),this.dimensionContainer=document.createElement("div"),this.coordinateSpace=void 0,this.dimensionWidgets=new(v()),this.dimensionWidgetList=[],this.dragSource=void 0;const i=this.element,r=this.dimensionContainer;if(this.registerDisposer(e.coordinateSpace.changed.add(this.registerCancellable((0,k.t)((()=>this.updateDimensions()))))),i.className="neuroglancer-position-widget",r.style.display="contents",i.appendChild(r),n){const t=(0,O.C)({title:"Copy position to clipboard",onClick:()=>{const e=(0,T.B)(this.getPositionText());C.M.showTemporaryMessage(e?"Position copied to clipboard":"Failed to copy position to clipboard")}});t.addEventListener("dragstart",(t=>{t.dataTransfer.setData(N,g()({position:e.toJSON(),dimensions:e.coordinateSpace.value.names})),t.dataTransfer.setData("text",this.getPositionText()),t.stopPropagation()})),t.draggable=!0,i.appendChild(t)}this.registerDisposer(e.changed.add(this.registerCancellable((0,k.t)((()=>this.updateView())))));this.registerDisposer(new M.cL(i,_)).allShortcutsAreGlobal=!0,this.registerDisposer(new I.qy(i,_)),this.registerDisposer((0,M.qZ)(i,"cancel",(e=>{this.coordinateSpace=void 0,this.updateView(),this.closeDropdown();const t=e.target;t instanceof HTMLElement&&t.blur()}))),this.updateView()}openRegularDropdown(e,t){t.classList.add("neuroglancer-position-dimension-dropdown");const n=document.createElement("canvas"),i=n.getContext("2d"),r=document.createElement("div"),o=document.createElement("div");o.appendChild(r);const s=document.createTextNode("");r.appendChild(s);const a=document.createElement("div"),l=document.createElement("div");o.classList.add("neuroglancer-position-dimension-dropdown-lowerbound"),a.classList.add("neuroglancer-position-dimension-dropdown-upperbound"),l.classList.add("neuroglancer-position-dimension-dropdown-hoverposition"),t.appendChild(o),t.appendChild(a),t.appendChild(l),t.appendChild(n);const c=100;let d,u,h;n.width=35,n.height=c,a.style.marginTop="".concat(99,"px");const p=()=>{const o=this.dimensionWidgetList.indexOf(e);if(-1===o)return;const p=e.coordinateSpace,f=function(e,t,n){const i=e.boundingBoxes,r=e.bounds,o=Math.floor(r.lowerBounds[t]),s=Math.ceil(r.upperBounds[t]-1);if(!b()(o)||!b()(s))return;const a=[],l=e=>U(e,o,s,n),c=e.rank;for(const d of i){const e=(0,x.UC)(d,t,c);void 0!==e&&(e.lower=l(e.lower),e.upper=l(Math.ceil(e.upper-1)),a.push(e))}return a.sort(((e,t)=>{const n=e.lower-t.lower;return 0!==n?n:t.upper-t.upper})),(0,E.U8)(a,((e,t)=>{if(0===t)return!0;const n=a[t-1];return n.lower!==e.lower||n.upper!==e.upper})),{lowerBound:o,upperBound:s,normalizedBounds:a}}(p,o,c);if(void 0===f||p.bounds.lowerBounds[o]+1===p.bounds.upperBounds[o])return t.style.display="none",void(e.container.dataset.dropdownVisible=void 0);e.container.dataset.dropdownVisible="true",t.style.display="";const g=f.lowerBound,m=f.upperBound;d=g,u=m,s.textContent=g.toString(),a.textContent=m.toString(),function(e,t,n){t.clearRect(0,0,e.width,e.height);const i=n.normalizedBounds;function r(e){t.fillRect(0,e,10,1)}t.fillStyle="#fff";for(const a of i){const e=a.lower,t=a.upper;r(e),r(t)}const o=i.length;t.fillStyle="#ccc";for(let a=0;a<o;++a){var s=i[a];const e=s.lower,n=s.upper,r=Math.floor(15*a/o),l=Math.max(1,15/o);t.fillRect(r+10,e,l,n+1-e)}}(n,i,f);const v=this.position.value[o];if(v>=g&&v<=m&&(i.fillStyle="#f66",i.fillRect(0,U(v,g,m,c),35,1)),void 0!==h&&h>=g&&h<=m){i.fillStyle="#66f";const e=U(h,g,m,c);i.fillRect(0,e,35,1),l.textContent=h.toString();const t=r.clientHeight;r.style.visibility=e>t?"":"hidden",a.style.visibility=e<c-t?"":"hidden",l.style.display="",l.style.visibility="visible",l.style.marginTop="".concat(e,"px")}else r.style.visibility="",l.style.display="none",a.style.visibility=""},f=e.dropdownOwner,g=f.registerCancellable((0,k.t)(p));f.registerDisposer(this.position.changed.add(g));const m=e=>{if(void 0===d||void 0===u)return;const t=n.getBoundingClientRect();let i=(e.clientY-t.top)/t.height;return i=Math.max(0,i),i=Math.min(1,i),Math.round(i*(u-d))+d},v=t=>{const n=this.dimensionWidgetList.indexOf(e);if(-1===n)return;const i=m(t);if(void 0===i)return;const r=this.position,o=r.value;o[n]=i+.5,e.modified=!1,r.value=o};n.addEventListener("pointermove",(e=>{const t=m(e);h=t,g()})),n.addEventListener("pointerleave",(()=>{h=void 0,g()})),n.addEventListener("pointerdown",(t=>{t.preventDefault(),t.stopPropagation(),t.ctrlKey||t.altKey||t.shiftKey||t.metaKey||((0,R.i)(t,(t=>{void 0!==e.dropdownOwner&&(h=void 0,v(t),g(),e.draggingPosition=!0)}),(()=>{e.draggingPosition=!1,this.updateDropdownVisibility(e)})),v(t))})),p()}openCoordinateArrayDropdown(e,t,n){t.classList.add("neuroglancer-position-dimension-coordinate-dropdown");const i=n.coordinates,r=n.labels,o=[],s=i.length;t.style.setProperty("--neuroglancer-coordinate-label-width","".concat(e.coordinateLabelWidth,"ch"));for(let a=0;a<s;++a){const n=document.createElement("div");n.classList.add("neuroglancer-dimension-dropdown-coordinate-entry");const s=document.createElement("div");s.classList.add("neuroglancer-dimension-dropdown-coordinate");const l=document.createElement("div");l.classList.add("neuroglancer-dimension-dropdown-coordinate-label"),l.textContent=r[a],s.textContent=i[a].toString(),n.appendChild(s),n.appendChild(l),n.addEventListener("click",(()=>{const t=this.dimensionWidgetList.indexOf(e);if(-1===t)return;const n=this.position,r=n.value;r[t]=i[a]+.5,e.modified=!1,n.value=r})),t.appendChild(n),o.push({entryElement:n,coordinateElement:s,labelElement:l})}}openDropdown(e){if(void 0!==e.dropdownOwner)return;const t=this.dimensionWidgetList.indexOf(e);if(-1===t)return;this.closeDropdown();const n=e.dropdownOwner=new L.O8,i=document.createElement("div");i.draggable=!0,i.addEventListener("dragstart",(e=>{e.stopPropagation(),e.preventDefault()})),i.addEventListener("pointerenter",(()=>{e.hasFocus=!0})),i.tabIndex=-1,e.container.appendChild(i);const r=B(e.coordinateSpace,t);null==r?this.openRegularDropdown(e,i):this.openCoordinateArrayDropdown(e,i,r),this.widgetWithOpenDropdown=e,n.registerDisposer((()=>{(0,P.fh)(i),e.dropdownOwner=void 0,delete e.container.dataset.dropdownVisible,this.widgetWithOpenDropdown=void 0})),n.registerEventListener(document,"pointerdown",(t=>{const n=t.target;n instanceof Node&&e.container.contains(n)||this.closeDropdown(e)}),{capture:!0})}closeDropdown(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.widgetWithOpenDropdown;if(void 0===e)return;const t=e.dropdownOwner;void 0!==t&&t.dispose()}pasteString(e,t){for(;;){e.coordinate.focus();const n=t.match(/^\s*(-?\d+(?:\.(?:\d+)?)?)((?:\s+(?![\s,]))|(?:\s*,\s*))?/);if(null===n)break;if(void 0!==n[1]&&document.execCommand("insertText",void 0,n[1]),void 0===n[2])break;{const i=this.dimensionWidgetList,r=i.indexOf(e);if(-1===r||r+1===i.length)break;const o=t.substring(n[0].length);e=i[r+1],t=o}}}reorderDimensionTo(e,t){if(e===t)return;const n=this.position.coordinateSpace;n.value=(0,x.dq)(n.value,e,t)}updateDropdownVisibility(e){e.hasFocus||e.draggingPosition?this.openDropdown(e):this.closeDropdown(e)}newDimension(e,t){const n=new F(e,t);n.container.addEventListener("dragstart",(e=>{this.dragSource=n,e.stopPropagation(),e.dataTransfer.setData("neuroglancer-dimension","")})),n.container.addEventListener("dragenter",(e=>{const t=this.dragSource;if(void 0===t||t===n)return;const i=this.dimensionWidgetList,r=i.indexOf(t),o=i.indexOf(n);-1!==r&&-1!==o&&(e.preventDefault(),this.reorderDimensionTo(o,r))})),n.container.addEventListener("dragend",(e=>{this.dragSource===n&&(this.dragSource=void 0)})),n.nameContainer.addEventListener("dblclick",(()=>{n.nameElement.disabled=!1,n.nameElement.focus(),n.nameElement.select()})),n.scaleContainer.addEventListener("dblclick",(()=>{n.scaleElement.disabled=!1,n.scaleElement.focus(),n.scaleElement.select()})),n.coordinate.addEventListener("focus",(()=>{n.coordinate.select()})),n.container.addEventListener("focusin",(()=>{n.hasFocus=!0,this.updateDropdownVisibility(n)})),n.container.addEventListener("focusout",(e=>{const t=e.relatedTarget;t instanceof Node&&n.container.contains(t)||(n.hasFocus=!1,this.updateDropdownVisibility(n))})),n.container.addEventListener("click",(e=>{e.target instanceof HTMLInputElement&&!e.target.disabled||n.coordinate.focus()})),n.coordinate.addEventListener("paste",(e=>{const t=n.coordinate,i=t.value,r=e.clipboardData;if(null===r)return;let o=r.getData("text"),s=t.selectionEnd,a=t.selectionStart;if(0!==a||s!==i.length){null==a&&(a=0),null==s&&(s=0);const e=o.match(/[^\-0-9\.]/);null!==e&&(o=o.substring(0,e.index)),o.length>0&&document.execCommand("insertText",void 0,o)}else this.pasteString(n,o);e.preventDefault(),e.stopPropagation()})),n.coordinate.addEventListener("input",(()=>{n.modified=!0;const e=n.coordinate,t=e.value;let i=e.selectionDirection,r=e.selectionEnd,o=e.selectionStart;null===o&&(o=0),null===r&&(r=o);let s="";const a=/[^\-0-9\.]/g;s+=t.substring(0,o).replace(a,"");const l=s.length;s+=t.substring(o,r).replace(a,"");const c=s.length;s+=t.substring(r).replace(a,""),e.value=s,e.selectionStart=l,e.selectionEnd=c,e.selectionDirection=i,z(e,s),r===o&&r===t.length&&t.match(/^(-?\d+(?:\.(?:\d+)?)?)((?:\s+(?![\s,]))|(?:\s*,\s*))$/)&&this.selectAdjacentCoordinate(n,1)})),n.nameElement.addEventListener("input",(()=>{const e=n.nameElement;(0,P.qi)(e),this.updateNameValidity()})),n.scaleElement.addEventListener("input",(()=>{j(n.scaleElement),this.updateScaleValidity(n)})),n.coordinate.addEventListener("blur",(e=>{const t=e.relatedTarget;this.dimensionWidgetList.some((e=>e.coordinate===t))||n.modified&&this.updatePosition()})),n.nameElement.addEventListener("blur",(e=>{n.nameElement.disabled=!0;const t=e.relatedTarget;this.dimensionWidgetList.some((e=>e.nameElement===t))||this.updateNames()||this.forceUpdateDimensions()})),n.scaleElement.addEventListener("blur",(e=>{n.scaleElement.disabled=!0;const t=e.relatedTarget;this.dimensionWidgetList.some((e=>e.scaleElement===t))||this.updateScales()||this.forceUpdateDimensions()})),(0,M.qZ)(n.container,"adjust-via-wheel",(e=>{const t=e.detail.deltaY;0!==t&&this.adjustDimension(n,p()(t))})),(0,M.qZ)(n.container,"adjust-up",(()=>{this.adjustDimension(n,-1)})),(0,M.qZ)(n.container,"adjust-down",(()=>{this.adjustDimension(n,1)}));for(const i of V){const e=i(n);(0,M.qZ)(e,"maybe-tab-forward",(e=>{this.handleLeftRightMovement(e,n,1,i)})),(0,M.qZ)(e,"maybe-tab-backward",(e=>{this.handleLeftRightMovement(e,n,-1,i)})),(0,M.qZ)(e,"tab-forward",(()=>{this.selectAdjacentField(n,1,i)})),(0,M.qZ)(e,"tab-backward",(()=>{this.selectAdjacentField(n,-1,i)}))}return(0,M.qZ)(n.coordinate,"commit",(()=>{this.updatePosition()})),(0,M.qZ)(n.nameElement,"commit",(()=>{this.updateNames()})),(0,M.qZ)(n.scaleElement,"commit",(()=>{this.updateScales()})),(0,M.qZ)(n.coordinate,"delete-backward",(e=>{e.stopPropagation();const t=n.coordinate;t.selectionStart===t.selectionEnd&&0===t.selectionStart&&(e.preventDefault(),this.selectAdjacentCoordinate(n,-1))})),n}forceUpdateDimensions(){let e=this.position.coordinateSpace.value;e.valid||(e=x.Nj),this.coordinateSpace=e;const t=this.dimensionWidgets,n=this.dimensionWidgetList;n.length=0;var i=e;const r=i.names,o=i.ids,s=i.scales,a=i.units;(0,P.bu)(this.dimensionContainer,o.map(((i,o)=>{let l=t.get(i);void 0===l?(l=this.newDimension(e,o),t.set(i,l)):l.coordinateSpace=e;const c=r[o];l.nameElement.value=c,delete l.nameElement.dataset.isValid,(0,P.qi)(l.nameElement);const d=B(e,o);l.container.dataset.coordinateArray=void 0===d?"none":null===d?"invalid":"valid",l.scaleContainer.title="Drag to reorder, double click to change scale",null===d&&(l.scaleContainer.title+=".  Coordinate array disabled.  To use the coordinate array, remove the unit/scale.");var u=(0,A.CD)(s[o],a[o]);const h=u.scale,p=u.prefix,f=u.unit,g="".concat(h).concat(p).concat(f);return l.scaleElement.value=g,delete l.scaleElement.dataset.isValid,j(l.scaleElement),n.push(l),l.container})));for(const c of t){var l=(0,u.A)(c,2);const n=l[0],i=l[1];i.coordinateSpace!==e&&(this.closeDropdown(i),t.delete(n))}}updateDimensions(){this.position.coordinateSpace.value!==this.coordinateSpace&&this.forceUpdateDimensions()}selectAdjacentField(e,t,n){const i=this.dimensionWidgetList;let r=i.indexOf(e);if(-1!==r)for(;;){if(r+=t,r<0||r>=i.length)return!1;const e=n(i[r]);if("none"!==e.style.display)return e.disabled=!1,e.focus(),e.selectionStart=0,e.selectionEnd=e.value.length,e.selectionDirection=1===t?"forward":"backward",!0}}selectAdjacentCoordinate(e,t){return this.selectAdjacentField(e,t,(e=>e.coordinate))}handleLeftRightMovement(e,t,n,i){e.stopPropagation();const r=i(t);r.selectionStart===r.selectionEnd&&r.selectionStart===(1===n?r.value.length:0)&&this.selectAdjacentField(t,n,i)&&e.preventDefault()}updateNameValidity(){const e=this.dimensionWidgetList,t=e.map((e=>e.nameElement.value)),n=t.length,i=this.combiner.getRenameValidity(t);for(let r=0;r<n;++r)e[r].nameElement.dataset.isValid=!1===i[r]?"false":"true"}updateScaleValidity(e){const t=void 0!==(0,A.W7)(e.scaleElement.value);e.scaleElement.dataset.isValid=t.toString()}adjustDimension(e,t){const n=this.dimensionWidgetList.indexOf(e);if(-1===n)return;this.updatePosition();const i=this.position;if(!i.valid)return;const r=i.coordinateSpace.value.bounds,o=Float32Array.from(i.value);let s=Math.floor(o[n]+t);if(t>0){const e=r.upperBounds[n];b()(e)&&(s=Math.min(s,Math.ceil(e-1)))}else{const e=r.lowerBounds[n];b()(e)&&(s=Math.max(s,Math.floor(e)))}o[n]=s+.5,this.position.value=o,this.updateView()}updatePosition(){const e=this.dimensionWidgetList,t=this.position,n=t.value;if(void 0===n)return;const i=e.length;for(let r=0;r<i;++r){const t=e[r];t.modified=!1;const i=Number(t.coordinate.value);b()(i)&&(n[r]=i+(d()(i)?.5:0))}t.value=n}updateNames(){const e=this.dimensionWidgetList,t=this.position.coordinateSpace,n=t.value,i=e.map((e=>e.nameElement.value));if(this.combiner.getRenameValidity(i).includes(!1))return!1;const r=n.names;if((0,E.r1)(r,i))return!1;const o=n.timestamps.map(((e,t)=>r[t]===i[t]?e:Date.now())),s=l()(l()({},n),{names:i,timestamps:o});return t.value=s,!0}updateScales(){const e=this.dimensionWidgetList,t=this.position.coordinateSpace,n=t.value,i=e.map((e=>(0,A.W7)(e.scaleElement.value)));if(i.includes(void 0))return!1;const r=Float64Array.from(i,(e=>e.scale)),o=s()(i,(e=>e.unit)),a=n.scales,l=n.units;if((0,E.r1)(a,r)&&(0,E.r1)(l,o))return!1;const c=n.timestamps.map(((e,t)=>r[t]===a[t]&&o[t]===l[t]?e:Date.now())),d=(0,x.d)({valid:n.valid,rank:n.rank,scales:r,units:o,timestamps:c,ids:n.ids,names:n.names,boundingBoxes:n.boundingBoxes,coordinateArrays:n.coordinateArrays});return t.value=d,!0}getPositionText(){const e=this.position;return e.valid?e.value.map((e=>Math.floor(e))).join(", "):""}updateView(){this.updateDimensions();const e=this.position.value,t=this.dimensionWidgetList,n=t.length;if(void 0===e)return;const i=this.coordinateSpace;for(let r=0;r<n;++r){const n=t[r],o=n.coordinate,s=Math.floor(e[r]),a=s.toString();z(o,a),o.value=a;const l=B(i,r);let c="";if(null!=l){const e=l.coordinates,t=(0,E.El)(e,s,((e,t)=>e-t));t!==e.length&&(c=l.labels[t])}n.coordinateLabel.textContent=c}}disposed(){this.closeDropdown(),(0,P.fh)(this.element),super.disposed()}}class W extends L.O8{constructor(e,t,n){super(),this.element=e,this.mouseState=t,this.coordinateSpace=n,this.tempPosition=D.eR.create(),e.className="neuroglancer-mouse-position-widget";const i=this.registerCancellable((0,k.t)((()=>this.updateView())));this.registerDisposer(t.changed.add(i)),this.registerDisposer(n.changed.add(i))}updateView(){let e="";const t=this.mouseState,n=this.coordinateSpace.value;if(t.active&&void 0!==n){const i=t.position,r=n.rank,o=n.names;for(let t=0;t<r;++t)0!==t&&(e+="  "),e+="".concat(o[t]," ").concat(Math.floor(i[t]))}this.element.textContent=e}disposed(){(0,P.fh)(this.element),super.disposed()}}},551:(e,t,n)=>{n.d(t,{P:()=>P,r:()=>T});var i=n(8178),r=n.n(i),o=n(974),s=n.n(o),a=n(3816),l=n.n(a),c=n(4117),d=n.n(c),u=n(5491),h=n.n(u),p=n(492),f=n.n(p),g=n(3436),m=n(7160),v=n(2303),y=n(8491),b=n(7562),S=n(8602),w=n(3835),x=n(8774),C=n(1877),k=n(2240);const E=S.n5.fromObject({mousedown0:{action:"set"},wheel:{action:"adjust-via-wheel"},dblclick0:{action:"reset"}});class T extends b.O8{constructor(e,t){super(),this.histogram=e,this.target=t,this.label=document.createElement("div"),this.element=document.createElement("div"),this.canvas=document.createElement("canvas"),this.legend=document.createElement("div"),this.legendRenderScale=document.createElement("div"),this.legendSpatialScale=document.createElement("div"),this.legendChunks=document.createElement("div"),this.ctx=this.canvas.getContext("2d"),this.hoverTarget=new m.B0(void 0),this.throttledUpdateView=this.registerCancellable(f()((()=>this.debouncedUpdateView()),200,{leading:!0,trailing:!0})),this.debouncedUpdateView=this.registerCancellable(h()((()=>this.updateView()),0));const n=this.canvas,i=this.label,r=this.element,o=this.legend,s=this.legendRenderScale,a=this.legendSpatialScale,l=this.legendChunks;i.className="neuroglancer-render-scale-widget-prompt",r.className="neuroglancer-render-scale-widget",r.title=E.describe(),o.className="neuroglancer-render-scale-widget-legend",r.appendChild(i),r.appendChild(n),r.appendChild(o),s.title="Target resolution of data in screen pixels",l.title="Number of chunks rendered",o.appendChild(s),o.appendChild(l),o.appendChild(a),this.registerDisposer(e.changed.add(this.throttledUpdateView)),this.registerDisposer(e.visibility.changed.add(this.debouncedUpdateView)),this.registerDisposer(t.changed.add(this.debouncedUpdateView)),this.registerDisposer(new x.qy(n,E)),this.registerDisposer(t.changed.add(this.debouncedUpdateView)),this.registerDisposer(this.hoverTarget.changed.add(this.debouncedUpdateView));const c=e=>{const t=e.offsetX/n.width*g.Jo;return(0,g.Uz)(t)};this.registerEventListener(n,"pointermove",(e=>{this.hoverTarget.value=[c(e),e.offsetY]})),this.registerEventListener(n,"pointerleave",(()=>{this.hoverTarget.value=void 0})),this.registerDisposer((0,S.qZ)(n,"set",(e=>{this.target.value=c(e.detail)}))),this.registerDisposer((0,S.qZ)(n,"adjust-via-wheel",(e=>{this.adjustViaWheel(e.detail)}))),this.registerDisposer((0,S.qZ)(n,"reset",(e=>{this.reset(),e.preventDefault()})));const d=new ResizeObserver((()=>this.debouncedUpdateView()));d.observe(n),this.registerDisposer((()=>d.disconnect())),this.updateView()}adjustViaWheel(e){const t=e.deltaY;0!==t&&(this.hoverTarget.value=void 0,this.target.value*=2**l()(t),e.preventDefault())}reset(){this.hoverTarget.value=void 0,this.target.reset()}updateView(){const e=this.ctx,t=this.canvas,n=t.width=t.offsetWidth,i=t.height=t.offsetHeight,o=this.target.value,a=this.hoverTarget.value;{const e=this.legendRenderScale,t=function(e){if(e<1||e>1024){const t=0|d()(e),n=e/2**t;return"".concat((0,C.I)(n,1),"p").concat(t)}return Math.round(e)+""}(void 0===a?o:a[0]);e.textContent=t+" px"}function l(e){return e*n/g.Jo}e.clearRect(0,0,n,i);const c=this.histogram,u=c.value,h=c.spatialScales;c.visibility.visible||u.fill(0);const p=s()(h.keys());p.sort();const f=w.eR.create();let m=1;const b=h.size;let S=0,x=0;for(let r=0;r<g.Jo;++r){let e=0;for(let t=0;t<b;++t){const n=t*g.Jo*2+r,i=u[n],o=u[n+g.Jo];S+=i,x+=o,e+=i+o}m=Math.max(e,m)}const E=i/Math.log(1+m);function T(e){return i-Math.log(1+e)*E}let L;if(void 0!==a){const e=Math.floor((0,g.iC)(a[0]));if(e>=0&&e<g.Jo){let t=0;const n=a[1];for(let i=b-1;i>=0;--i){const r=p[i],o=2*h.get(r)*g.Jo+e,s=u[o]+u[o+g.Jo];if(0===s)continue;const a=Math.round(T(t));t+=s;if(Math.round(T(t))<=n&&n<=a){L=r;break}}}}if(void 0!==L){S=0,x=0;const e=2*h.get(L)*g.Jo;for(let t=0;t<g.Jo;++t){const n=e+t;S+=u[n],x+=u[n+g.Jo]}r()(L)?this.legendSpatialScale.textContent=(0,k.NJ)(L,"m",{precision:2,elide1:!1}):this.legendSpatialScale.textContent="unknown"}else this.legendSpatialScale.textContent="";this.legendChunks.textContent="".concat(S,"/").concat(S+x);const P=p.map((e=>{const t=e===L?.5:1;let n;n=r()(e)?(.1*d()(e)%1+1)%1:0,(0,y.M)(f,n,t,1);const i=(0,v.serializeColor)(f);(0,y.M)(f,n,t,.5);return[i,(0,v.serializeColor)(f)]}));for(let r=0;r<g.Jo;++r){let t=0;for(let n=b-1;n>=0;--n){const i=p[n],o=h.get(i)*g.Jo*2+r,s=u[o],a=u[o+g.Jo],c=s+a;if(0===c)continue;const d=Math.round(l(r)),f=Math.round(l(r+1)),m=Math.round(T(t));t+=c;const v=Math.round(T(t)),y=(s*v+a*m)/c;e.fillStyle=P[n][1],e.fillRect(d,v,f-d,y-v),e.fillStyle=P[n][0],e.fillRect(d,y,f-d,m-y)}}{const t=o;e.fillStyle="#fff";const n=l((0,g.iC)(t)),r=1;e.fillRect(Math.floor(n),0,r,i)}if(void 0!==a){const t=a[0];e.fillStyle="#888";const n=l((0,g.iC)(t)),r=1;e.fillRect(Math.floor(n),0,r,i)}}}const L=S.n5.fromObject({"at:shift+wheel":{action:"adjust-via-wheel"},"at:shift+dblclick0":{action:"reset"}});function P(e){return{makeControl:(t,n)=>{var i=e(t);const r=i.histogram,o=i.target,s=n.registerDisposer(new T(r,o));return{control:s,controlElement:s.element}},activateTool:(e,t)=>{e.bindInputEventMap(L),e.bindAction("adjust-via-wheel",(e=>{e.stopPropagation(),e.preventDefault(),t.adjustViaWheel(e.detail)})),e.bindAction("reset",(e=>{e.stopPropagation(),e.preventDefault(),t.reset()}))}}}},628:(e,t,n)=>{n.d(t,{h:()=>u});n(2955);var i=n(7323),r=n.n(i),o=n(8471),s=n.n(o),a=n(5491),l=n.n(a),c=n(7562),d=n(3162);s()(r());class u extends c.O8{constructor(e){super(),this.state=e,this.changingValue=!1,this.debouncedValueUpdater=l()((()=>{this.changingValue=!0;try{this.state.fragmentMain.value=this.textEditor.getValue()}finally{this.changingValue=!1}}),500),this.textEditor=r()((e=>{}),{value:this.state.fragmentMain.value,mode:"glsl",gutters:["CodeMirror-lint-markers"]}),this.textEditor.on("change",(()=>{this.setValidState(void 0),this.debouncedValueUpdater()})),this.registerDisposer(this.state.fragmentMain.changed.add((()=>{this.changingValue||this.textEditor.setValue(this.state.fragmentMain.value)}))),this.element.classList.add("neuroglancer-shader-code-widget"),this.registerDisposer(this.state.shaderError.changed.add((()=>{this.updateErrorState()})));const t=this.state.shaderControlState;void 0!==t&&this.registerDisposer(t.parseErrors.changed.add((()=>{this.updateErrorState()}))),this.updateErrorState();const n=new IntersectionObserver((e=>{e.some((e=>e.isIntersecting))&&this.textEditor.refresh()}),{root:document.body});n.observe(this.element),this.registerDisposer((()=>n.disconnect()))}get element(){return this.textEditor.getWrapperElement()}updateErrorState(){var e=this.state.sourceStringNumber;const t=void 0===e?1:e,n=this.state.shaderError.value;let i;const o=this.state.shaderControlState;i=void 0!==o?o.parseErrors.value:[],void 0===n&&0===i.length?this.setValidState(void 0):null!=n||0!==i.length?(this.textEditor.setOption("lint",{getAnnotations:()=>{const e=[];for(const t of i)e.push({message:t.message,severity:"error",from:r().Pos(t.line)});if(null!=n)if("ShaderCompilationError"===n.name)for(const i of n.errorMessages)e.push({message:i.message,severity:"error",from:r().Pos(i.file===t&&i.line||0)});else"ShaderLinkError"===n.name?e.push({message:n.log,severity:"error",from:r().Pos(0)}):e.push({message:n.message,severity:"error",from:r().Pos(0)});return e}}),this.setValidState(!1)):(this.textEditor.setOption("lint",void 0),this.setValidState(!0))}setValidState(e){let t=this.element;t.classList.remove("invalid-input"),t.classList.remove("valid-input"),!0===e?t.classList.add("valid-input"):!1===e&&t.classList.add("invalid-input")}disposed(){this.debouncedValueUpdater.flush(),this.debouncedValueUpdater=void 0,(0,d.fh)(this.element),this.textEditor=void 0,super.disposed()}}},4791:(e,t,n)=>{n.d(t,{SJ:()=>M,G6:()=>N});var i=n(2982),r=n(5491),o=n.n(r),s=n(3240),a=n(7562),l=n(3162),c=n(7970),d=n(8093),u=n(3651),h=n.n(u),p=n(974),f=n.n(p),g=n(201),m=n(9735),v=n(8602),y=n(679),b=n(3234),S=n(5103),w=n(1532),x=n(3606);const C=v.n5.fromObject({"at:shift+wheel":{action:"adjust-contrast-via-wheel"},"at:shift+mousedown0":{action:"adjust-via-drag"},"at:shift+mousedown2":{action:"invert-range"}});var k=n(441),E=n(3625),T=n(217),L=n(8946);function P(e,t){const n=e.shaderControlState,r=n.state.get(t);if(void 0===r)return;const o=r.control;switch(o.type){case"slider":return(0,T.k)((()=>({value:r.trackable,options:{min:o.min,max:o.max,step:o.step}})));case"color":return(0,E.Y)((()=>r.trackable));case"checkbox":return(0,k.Y)((()=>r.trackable));case"invlerp":{let l=0;for(const e of n.state){var s=(0,i.A)(e,2);const n=s[0],r=s[1].control.type;if(n===t)break;"invlerp"===r&&++l}return a=()=>({dataType:o.dataType,defaultChannel:o.default.channel,watchableValue:r.trackable,channelCoordinateSpaceCombiner:n.channelCoordinateSpaceCombiner,histogramSpecifications:n.histogramSpecifications,histogramIndex:l,legendShaderOptions:e.legendShaderOptions}),{makeControl:(e,t,n)=>{var i=a(e);const r=i.watchableValue,o=i.channelCoordinateSpaceCombiner,s=i.dataType,l=i.defaultChannel,c=i.histogramSpecifications,d=i.legendShaderOptions,u=i.histogramIndex;if(void 0!==o&&0!==l.length){const e=t.registerDisposer(new g.yX(o.combined)),i=t.registerDisposer(new x.uf(e,o,{copyButton:!1}));t.registerDisposer(e.changed.add((()=>{const t=e.value,n=f()(t,(e=>Math.floor(e))),i=r.value;(0,m.r1)(i.channel,n)||(r.value=h()(h()({},r.value),{channel:n}))})));const s=()=>{const t=e.value,n=r.value;(0,m.r1)(t,n.channel)||(t.set(n.channel),e.changed.dispatch())};s(),t.registerDisposer(r.changed.add(s)),n.labelContainer.appendChild(i.element)}const p=t.registerDisposer(new w.bh(n.visibility,n.display,s,r,c,u,0===l.length?d:void 0));return{control:p,controlElement:p.element}},activateTool:(e,t)=>{e.bindInputEventMap(C),e.bindAction("adjust-contrast-via-wheel",(e=>{e.stopPropagation();const n=(0,S.d)(e.detail);(0,w.m7)(t.dataType,t.trackable,n)})),e.bindAction("adjust-via-drag",(e=>{e.stopPropagation();let n=e.detail.screenX,i=e.detail.screenY,r=t.trackable.value.range,o=r,s=n,a=i;(0,b.i)(e.detail,(e=>{const l=t.trackable.value.range,c=e.screenX,d=e.screenY;(0,y.gt)(t.dataType,l,o)||(r=l,n=s,i=a),(0,w.X$)(t.dataType,t.trackable,r,2*(d-i)/screen.height,4*(c-n)/screen.width),o=t.trackable.value.range,s=c,a=d}))})),e.bindAction("invert-range",(e=>{e.stopPropagation(),(0,w.sw)(t.trackable)}))}}}}var a}function D(e,t,n){return{label:n,toolJson:A(n,t),makeControl:(t,i,r)=>P(e(t),n).makeControl(t,i,r),activateTool:(t,i)=>P(e(t.tool.layer),n).activateTool(t,i)}}class M extends L.oz{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(i.visibility),this.state=e,this.display=t,this.layer=n,this.options=i,this.controlDisposer=void 0;var r=i.toolId;const s=void 0===r?I:r;this.toolId=s;this.element.style.display="contents";const a=e.controls;this.registerDisposer(a.changed.add(this.registerCancellable(o()((()=>this.updateControls()),0)))),this.updateControls()}updateControls(){const e=this.element;void 0!==this.controlDisposer&&(this.controlDisposer.dispose(),(0,l.gS)(e));const t=this.controlDisposer=new a.O8,n=()=>({shaderControlState:this.state,legendShaderOptions:this.options.legendShaderOptions});for(const i of this.state.state.keys())e.appendChild((0,d.KZ)(t,this.layer,this.visibility,D(n,this.toolId,i)))}disposed(){var e;null===(e=this.controlDisposer)||void 0===e||e.dispose(),super.disposed()}}const I="shaderControl",R="control";function A(e,t){return{type:t,[R]:e}}class O extends d.jH{constructor(e,t,n,i){super(e,D((()=>t),n,i)),this.layerShaderControls=t,this.control=i,this.registerDisposer(t.shaderControlState.controls.changed.add(this.registerCancellable(o()((()=>{void 0===t.shaderControlState.state.get(i)&&this.unbind()})))))}activate(e){void 0!==this.layerShaderControls.shaderControlState.state.get(this.control)&&super.activate(e)}}function N(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I;(0,s.zA)(e,n,((e,i)=>{const r=(0,c.verifyObjectProperty)(i,R,c.verifyString);return new O(e,t(e),n,r)}))}},8946:(e,t,n)=>{n.d(t,{HJ:()=>m,JQ:()=>y,oz:()=>p});var i=n(2982),r=n(984),o=n.n(r),s=n(608),a=n.n(s),l=n(2038),c=n(7562),d=n(3162),u=n(6344),h=n(843);class p extends c.O8{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h.gH(h.gH.VISIBLE);super(),this.visibility=e,this.element=document.createElement("div");this.element.classList.add("neuroglancer-tab-content")}get visible(){return this.visibility.visible}disposed(){(0,d.fh)(this.element),super.disposed()}}class f extends c.O8{constructor(){super(...arguments),this.changed=new u.IY,this.options=new(a()),this.optionsChanged=new u.IY,this.selectedValue=void 0,this.defaultValue=void 0,this.ready_=!0}get value(){const e=this.selectedValue;return void 0!==e?e:this.defaultValue}set default(e){this.defaultValue!==e&&(this.defaultValue=e,this.changed.dispatch())}get default(){return this.defaultValue}set value(e){void 0!==e&&this.ready_&&!this.options.has(e)&&(e=void 0);this.selectedValue!==e&&(this.selectedValue=e,this.changed.dispatch())}get validValue(){const e=this.selectedValue;return void 0!==e&&this.options.has(e)?e:this.defaultValue}add(e,t){const n=this.options;if(n.has(e))throw new Error("Option already defined: ".concat(o()(e),"."));n.set(e,t),this.optionsChanged.dispatch(),void 0===this.defaultValue&&(this.default=e)}toJSON(){const e=this.value;if(e!==this.defaultValue)return e}reset(){this.value=void 0}get ready(){return this.ready_}set ready(e){e!==this.ready_&&(this.ready_=e,e&&(this.value=this.value),this.changed.dispatch())}restoreState(e){"string"!==typeof e&&(e=void 0),this.value=e}}class g extends c.O8{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.gH(h.gH.VISIBLE),i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(),this.getter=e,this.selected=t,this.visibility=n,this.invalidateByDefault=i,this.element=document.createElement("div"),this.tabs=new(a()),this.tabVisibilityChanged=new u.HN,this.debouncedUpdateSelectedTab=this.registerCancellable((0,l.t)((()=>this.updateSelectedTab())));this.element.className="neuroglancer-stack-view",this.registerDisposer(n.changed.add(this.debouncedUpdateSelectedTab)),this.registerDisposer(t.changed.add(this.debouncedUpdateSelectedTab)),this.updateSelectedTab()}get visible(){return this.visibility.visible}flush(){this.debouncedUpdateSelectedTab.flush()}invalidate(e){const t=this.tabs,n=t.get(e);void 0!==n&&(n.dispose(),t.delete(e),e===this.displayedTab&&(this.displayedTab=void 0,this.debouncedUpdateSelectedTab()))}hideTab(e){const t=this.tabs.get(e);void 0!==t&&(t.visibility.value=h.gH.IGNORED,t.element.style.display="none"),this.tabVisibilityChanged.dispatch(e,!1)}showTab(e){const t=this.tabs;let n=t.get(e);void 0===n&&(n=this.getter(e),this.element.appendChild(n.element),t.set(e,n)),n.element.style.display="",n.visibility.value=h.gH.VISIBLE,this.tabVisibilityChanged.dispatch(e,!0)}updateSelectedTab(){const e=this.displayedTab,t=this.visible?this.selected.value:void 0;(t!==e||void 0!==t&&!this.tabs.has(t))&&(void 0!==e&&this.hideTab(e),this.invalidateByDefault&&this.invalidateAll(),this.displayedTab=t,void 0!==t&&this.showTab(t))}invalidateAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;const t=this.tabs;for(const r of t){var n=(0,i.A)(r,2);const o=n[0],s=n[1];void 0!==e&&e(o)||(t.delete(o),s.dispose())}this.debouncedUpdateSelectedTab()}disposed(){this.invalidateAll(),(0,d.fh)(this.element),super.disposed()}}class m extends f{}function v(e,t){const n="neuroglancer-selected-tab-label";t?e.classList.add(n):e.classList.remove(n)}class y extends c.O8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.gH(h.gH.VISIBLE);super(),this.visibility=t,this.element=document.createElement("div"),this.tabBar=document.createElement("div"),this.tabLabels=new(a()),this.tabsGeneration=-1,this.debouncedUpdateView=this.registerCancellable((0,l.t)((()=>this.updateTabs()))),this.tabs=e.tabs,this.selectedTab=e.selectedTab,this.handleTabElement=e.handleTabElement;const n=this.element,i=this.tabBar;n.className="neuroglancer-tab-view",i.className="neuroglancer-tab-view-bar",n.appendChild(i),this.registerDisposer(t.changed.add(this.debouncedUpdateView));const r=this.stack=this.registerDisposer(new g(e.makeTab,e.selectedTab,this.visibility));n.appendChild(r.element),this.registerDisposer(e.tabs.changed.add(this.debouncedUpdateView)),this.registerDisposer(e.selectedTab.changed.add((()=>this.updateTabLabelStyles()))),this.updateTabs()}get visible(){return this.visibility.visible}updateTabLabelStyles(){const e=this.selectedTab.value;for(const n of this.tabLabels){var t=(0,i.A)(n,2);const r=t[0];v(t[1],r===e)}}updateTabs(){this.tabsGeneration!==this.tabs.changed.count&&(this.destroyTabs(),this.visible&&this.makeTabs())}destroyTabs(){if(-1!==this.tabsGeneration){if(this.tabLabels.clear(),this.visible){const e=this.tabs.value;this.stack.invalidateAll((t=>void 0!==e.find((e=>{let{id:n}=e;return n===t}))))}else this.stack.invalidateAll();(0,d.gS)(this.tabBar),this.tabsGeneration=-1}}makeTabs(){const e=this.tabBar,t=this.tabLabels,n=this.handleTabElement;for(const i of this.tabs.value){const r=i.id,o=i.label,s=document.createElement("div");s.classList.add("neuroglancer-tab-label"),s.textContent=o,s.addEventListener("click",(()=>{this.selectedTab.value=r})),void 0!==n&&n(r,s),t.set(r,s),e.appendChild(s)}this.updateTabLabelStyles(),this.tabsGeneration=this.tabs.changed.count}disposed(){(0,d.gS)(this.tabBar),this.tabLabels.clear(),(0,d.fh)(this.element),super.disposed()}}},4492:(e,t,n)=>{n.d(t,{I:()=>o});var i=n(7562),r=n(3162);class o extends i.O8{constructor(e){super(),this.model=e,this.element=document.createElement("input"),this.registerDisposer(e.changed.add((()=>this.updateView())));const t=this.element;t.type="text",this.registerEventListener(t,"change",(()=>this.updateModel())),this.updateView()}disposed(){(0,r.fh)(this.element)}updateView(){var e;this.element.value=(null!==(e=this.model.value)&&void 0!==e?e:"")+""}updateModel(){try{this.model.restoreState(this.element.value)}catch(e){}this.updateView()}}},2608:(e,t,n)=>{n.d(t,{w:()=>h});var i=n(2038),r=n(9735),o=n(7562),s=n(3162);const a=.5;class l{constructor(){this.anchorIndex=0,this.anchorClientOffset=0}splice(e){let t=this.anchorIndex,n=0;for(const i of e){if(n+=i.retainCount,t<n)break;const e=i.deleteCount;if(t<n+e){t=n;break}const r=i.insertCount;t=t-e+r,n+=r-r}this.anchorIndex=t}}class c{constructor(){this.startIndex=0,this.endIndex=0,this.anchorIndex=0,this.anchorOffset=0,this.scrollOffset=0}}class d{constructor(){this.itemSize=[],this.totalKnownSize=0,this.numItemsInTotalKnownSize=0}get averageSize(){return this.totalKnownSize/this.numItemsInTotalKnownSize}getEstimatedSize(e){var t;return null!==(t=this.itemSize[e])&&void 0!==t?t:this.averageSize}getEstimatedTotalSize(){return this.totalKnownSize/this.numItemsInTotalKnownSize*this.itemSize.length}getEstimatedOffset(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;t<e;++t)n+=this.getEstimatedSize(t);for(;t>e;--t)n-=this.getEstimatedSize(t-1);return n}getRangeSize(e,t){var n;let i=0;const r=this.itemSize,o=this.averageSize;for(let s=e;s<t;++s)i+=null!==(n=r[s])&&void 0!==n?n:o;return i}splice(e){let t=this.itemSize;t=this.itemSize=(0,r.eL)(t,e),this.totalKnownSize=t.reduce(((e,t)=>e+t),0),this.numItemsInTotalKnownSize=t.reduce((e=>e+1),0)}}function u(e,t,n,i,r,o){let s,l,c,d,u,h=o.anchorIndex,p=o.anchorClientOffset,f=r.getEstimatedOffset(h);if(0===i||0===r.totalKnownSize)s=Math.max(0,h-5),l=Math.min(n,s+10),u=h,c=0,d=p;else{const e=r.getEstimatedTotalSize(),o=Math.max(0,e-i);d=f-p,d=Math.max(0,Math.min(o,d));const g=d-1*i,m=d-a*i,v=d+i+a*i,y=f-p+i+1*i;s=Math.min(n,t.startIndex);let b=r.getEstimatedOffset(s,h,f);if(b<g)for(;s+1<n;++s){const e=r.getEstimatedSize(s);if(b+e>=m)break;b+=e}if(b>=m)for(;b>g&&s>0;--s){b-=r.getEstimatedSize(s-1)}l=Math.min(n,t.endIndex);let S=r.getEstimatedOffset(l,h,f);if(S<v)for(;S<=y&&l+1<=n;++l){S+=r.getEstimatedSize(l)}else if(S>=y)for(;l>s;--l){const e=r.getEstimatedSize(l-1);if(S-e<v)break;S-=e}for(u=h,c=f;u<s;++u){c+=r.getEstimatedSize(u)}for(;u>l;--u){c-=r.getEstimatedSize(u-1)}}e.startIndex=s,e.endIndex=l,e.anchorIndex=u,e.anchorOffset=c,e.scrollOffset=d}class h extends o.O8{constructor(e){super(),this.element=document.createElement("div"),this.scrollContent=document.createElement("div"),this.header=document.createElement("div"),this.body=document.createElement("div"),this.topItems=document.createElement("div"),this.bottomItems=document.createElement("div"),this.renderedItems=[],this.renderGeneration=-1,this.listGeneration=-1,this.newRenderedItems=[],this.state=new l,this.renderParams=new c,this.newRenderParams=new c,this.sizes=new d,this.debouncedUpdateView=this.registerCancellable((0,i.t)((()=>this.updateView()))),this.resizeObserver=new ResizeObserver((()=>this.updateView()));const t=e.selectedIndex;void 0!==t&&(this.state.anchorIndex=t,this.state.anchorClientOffset=0);const n=this.source=e.source;this.sizes.itemSize.length=n.length;const r=this.element,o=this.header,s=this.body,a=this.scrollContent,u=this.topItems,h=this.bottomItems;this.resizeObserver.observe(r),this.registerDisposer((()=>this.resizeObserver.disconnect())),r.appendChild(a),r.style.overflowAnchor="none",a.appendChild(o),a.appendChild(s),o.style.position="sticky",o.style.zIndex="1",o.style.top="0",e.horizontalScroll?(a.style.width="min-content",a.style.minWidth="100%",o.style.width="min-content",o.style.minWidth="100%",h.style.width="min-content",h.style.minWidth="100%"):(a.style.width="100%",o.style.width="100%",h.style.width="100%"),s.appendChild(u),s.appendChild(h),u.style.width="min-content",u.style.position="relative",u.style.height="0",u.style.minWidth="100%",h.style.height="0",h.style.position="relative",r.addEventListener("scroll",(()=>{const e=r.scrollTop;this.state.anchorClientOffset=this.renderParams.anchorOffset-e,this.renderParams.scrollOffset=e,this.debouncedUpdateView()})),void 0!==n.changed&&this.registerDisposer(n.changed.add((e=>{this.sizes.splice(e),this.state.splice(e),this.renderedItems.length=0,this.debouncedUpdateView()}))),void 0!==n.renderChanged&&this.registerDisposer(n.renderChanged.add(this.debouncedUpdateView))}updateView(){const e=this.element;if(0===e.offsetHeight)return;const t=e.clientHeight-this.header.offsetHeight,n=this.source,i=this.state,r=this.sizes,o=n.length,a=this.body,l=this.topItems,c=this.bottomItems,d=n.changed,h=n.renderChanged;let p;for(;;){p=this.newRenderParams;const b=this.renderParams;let S;if(u(p,b,o,t,r,i),void 0!==h&&h.count!==this.renderGeneration||void 0!==d&&d.count!==this.listGeneration?(this.renderGeneration=void 0===h?-1:h.count,this.listGeneration=void 0===d?-1:d.count,S=!0,this.renderedItems.length=0):S=!1,!S&&(m=b,!((g=p).startIndex<m.startIndex||g.endIndex>m.endIndex))){b.scrollOffset=p.scrollOffset,p=b;break}this.renderParams=p,this.newRenderParams=b;const w=this.renderedItems,x=this.newRenderedItems;x.length=0,this.renderedItems=x,this.newRenderedItems=w;const C=this.source,k=C.render;var f=p;const E=f.startIndex,T=f.endIndex,L=f.anchorIndex;function*P(e,t){for(let n=e;n<t;++n){let e=w[n];void 0===e&&(e=k.call(C,n)),x[n]=e,yield e}}(0,s.bu)(l,P(E,L)),(0,s.bu)(c,P(L,T));for(let D=E;D<T;++D){const M=x[D].getBoundingClientRect().height,I=r.itemSize[D];void 0!==I&&(r.totalKnownSize-=I,--r.numItemsInTotalKnownSize),r.itemSize[D]=M,r.totalKnownSize+=M,++r.numItemsInTotalKnownSize}}var g,m;!function(e,t){const n=t.getEstimatedOffset(e.anchorIndex),i=e.anchorOffset;e.anchorOffset=n,e.scrollOffset+=n-i}(p,r),i.anchorIndex=p.anchorIndex,i.anchorClientOffset=p.anchorOffset-p.scrollOffset;const v=r.getRangeSize(p.startIndex,p.anchorIndex),y=r.getEstimatedTotalSize();a.style.height="".concat(y,"px"),l.style.top="".concat(p.anchorOffset-v,"px"),c.style.top="".concat(p.anchorOffset,"px"),e.scrollTop=p.scrollOffset}getItemElement(e){return this.renderedItems[e]}forEachRenderedItem(e){var t=this.renderParams;const n=t.startIndex,i=t.endIndex,r=this.renderedItems;for(let o=n;o<i;++o){const t=r[o];void 0!==t&&e(t,o)}}scrollToTop(){this.state.anchorIndex=0,this.state.anchorClientOffset=0,this.debouncedUpdateView()}scrollItemIntoView(e){const t=this.sizes.getEstimatedOffset(e),n=t+this.sizes.getEstimatedSize(e),i=this.element.scrollTop;if(t<i)this.state.anchorIndex=e,this.state.anchorClientOffset=0;else{if(!(t>i&&n>i+this.element.offsetHeight))return;this.state.anchorIndex=e+1,this.state.anchorClientOffset=this.element.offsetHeight}this.debouncedUpdateView()}disposed(){(0,s.fh)(this.element)}}},7799:(e,t,n)=>{n.d(t,{IN:()=>v,R6:()=>b,T6:()=>m,eZ:()=>S,ks:()=>u,oJ:()=>p,yo:()=>g});var i=n(608),r=n.n(i),o=n(2959),s=n(7562);const a=!("undefined"!==typeof Window&&self instanceof Window),l="rpc.promise.response",c="rpc.promise.cancel";var d=new(r());function u(e,t){d.set(e,t)}class h extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}function p(e,t){u(e,(function(e){let n=e.id;const i=new o.Qi;let r=t.call(this,e,i);this.set(n,{promise:r,cancellationToken:i}),r.then((e=>{let{value:t,transfers:i}=e;this.delete(n),this.invoke(l,{id:n,value:t},i)}),(e=>{this.delete(n),this.invoke(l,{id:n,error:e.message,errorName:e.name})}))}))}u(c,(function(e){let t=e.id;const n=this.get(t);if(void 0!==n){n.cancellationToken.cancel()}})),u(l,(function(e){let t=e.id;var n=this.get(t);let i=n.resolve,r=n.reject;if(this.delete(t),e.hasOwnProperty("value"))i(e.value);else{e.errorName===o.wS.name?r(o.wS):r(new h(e.errorName,e.error))}}));const f=a?-1:0;class g{constructor(e){this.target=e,this.objects=new(r()),this.nextId=f,e.onmessage=e=>{let t=e.data;d.get(t.functionName).call(this,t)}}get numObjects(){return this.objects.size}set(e,t){this.objects.set(e,t)}delete(e){this.objects.delete(e)}get(e){return this.objects.get(e)}getRef(e){let t=e.id,n=this.get(t);return n.referencedGeneration=e.gen,n.addRef(),n}getOptionalRef(e){if(void 0===e)return;let t=e.id,n=this.get(t);return n.referencedGeneration=e.gen,n.addRef(),n}invoke(e,t,n){t.functionName=e,this.target.postMessage(t,n)}promiseInvoke(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.fx,i=arguments.length>3?arguments[3]:void 0;return(0,o.gI)(n,((n,r,o)=>{const s=t.id=this.newId();this.set(s,{resolve:n,reject:r}),this.invoke(e,t,i),o.add((()=>{this.invoke(c,{id:s})}))}))}newId(){return a?this.nextId--:this.nextId++}}class m extends s.O8{constructor(){super(...arguments),this.rpc=null,this.rpcId=null}initializeSharedObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.newId();this.rpc=e,this.rpcId=t,this.isOwner=!1,e.set(t,this)}initializeCounterpart(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.initializeSharedObject(e),this.unreferencedGeneration=0,this.referencedGeneration=0,this.isOwner=!0,t.id=this.rpcId,t.type=this.RPC_TYPE_ID,e.invoke("SharedObject.new",t)}dispose(){super.dispose()}addCounterpartRef(){return{id:this.rpcId,gen:++this.referencedGeneration}}refCountReachedZero(){!0===this.isOwner?this.referencedGeneration===this.unreferencedGeneration&&this.ownerDispose():!1===this.isOwner?this.rpc.invoke("SharedObject.refCountReachedZero",{id:this.rpcId,gen:this.referencedGeneration}):super.refCountReachedZero()}ownerDispose(){let e=this.rpc,t=this.rpcId;super.refCountReachedZero(),e.delete(t),e.invoke("SharedObject.dispose",{id:t})}counterpartRefCountReachedZero(e){this.unreferencedGeneration=e,0===this.refCount&&e===this.referencedGeneration&&this.ownerDispose()}}class v extends m{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null!=t&&e.initializeSharedObject(t,n.id)}(this,e,t)}}u("SharedObject.dispose",(function(e){let t=this.get(e.id);if(0!==t.refCount)throw new Error("Attempted to dispose object with non-zero reference count.");t.disposed(),this.delete(t.rpcId),t.rpcId=null,t.rpc=null}));u("Worker",(function(e){const t=e.port,n=e.path;new Worker(n).postMessage({port:t},[t])})),u("SharedObject.refCountReachedZero",(function(e){let t=this.get(e.id),n=e.gen;t.counterpartRefCountReachedZero(n)}));const y=new(r());function b(e){return t=>{t.prototype.RPC_TYPE_ID=e}}function S(e){return t=>{if(void 0!==e)t.prototype.RPC_TYPE_ID=e;else if(void 0===(e=t.prototype.RPC_TYPE_ID))throw new Error("RPC_TYPE_ID should have already been defined");y.set(e,t)}}u("SharedObject.new",(function(e){let t=e.type;--new(y.get(t))(this,e).refCount}))},8077:(e,t,n)=>{function i(e){return i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}t.Ay=void 0;var r=f(n(9950)),o=f(n(1942)),s=n(9821),a=n(739),l=n(1785),c=n(2303),d=n(4728),u=n(8194),h=n(7970),p=n(338);function f(e){return e&&e.__esModule?e:{default:e}}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w(e);if(t){var o=w(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"===typeof t))return t;return S(e)}(this,n)}}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var E,T={};function L(e){var t=e?T[e]:E;if(t)return t.layerManager}function P(e,t){var n=L(e);if(n)return n.managedLayers.filter((function(e){return e.name===t}))[0]}function D(e,t){var n=P(e,t);if(n&&n.layer instanceof s.AnnotationUserLayer)return n.layer}function M(e,t,n){var i=L(e);i&&t&&n&&(i.customSignalHandlerRemovers||(i.customSignalHandlerRemovers={}),i.customSignalHandlerRemovers[t]||(i.customSignalHandlerRemovers[t]=[]),i.customSignalHandlerRemovers[t].push(n))}function I(e,t){e&&e.customSignalHandlerRemovers&&e.customSignalHandlerRemovers[t]&&(e.customSignalHandlerRemovers[t].forEach((function(e){e()})),delete e.customSignalHandlerRemovers[t])}function R(e,t,n){e&&(e.expectingExternalTable=!0,e.selectedAnnotation&&!e.selectedAnnotation.changed.signalReady&&t.onAnnotationSelectionChanged&&(n(e.selectedAnnotation.changed.add((function(){t.onAnnotationSelectionChanged(e.selectedAnnotation.value)}))),n((function(){e.selectedAnnotation.changed.signalReady=!1})),e.selectedAnnotation.changed.signalReady=!0),function(e,t,n){var i=function(){var i=function(e){var t=function(e){if(e.dataSources&&e.dataSources.length>0&&e.dataSources[0].loadState_&&e.dataSources[0].loadState_.dataSource)return e.dataSources[0].loadState_.dataSource}(e);if(t)return t.subsources[0].subsource.annotation}(e);i&&function(e,t,n){e&&!e.signalReady&&(t.onAnnotationAdded&&n(e.childAdded.add((function(e){t.onAnnotationAdded(e)}))),t.onAnnotationDeleted&&n(e.childDeleted.add((function(e){t.onAnnotationDeleted(e)}))),t.onAnnotationUpdated&&n(e.childUpdated.add((function(e){t.onAnnotationUpdated(e)}))),t.onAnnotationChanged&&e.referencesChanged&&n(e.referencesChanged.add(t.onAnnotationChanged)),e.signalReady=!0,n((function(){e.signalReady=!1})))}(i,t,n)},r=e.dataSourcesChanged;r&&!r.signalReady&&(n(r.add(i)),r.signalReady=!0,n((function(){r.signalReady=!1})),i())}(e,t,n))}var A=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(s,e);var t,n,i,o=b(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),x(S(t=o.call(this,e)),"updateEventBindings",(function(e){var n=t.viewer.inputEventBindings,i=function t(n){var i=function(e,t,n){var i=e.get(t);i&&(e.delete(t),n&&e.set(n,i))},r=n.bindings;e.forEach((function(e){var t=Array.isArray(e)?e[0]:e,n="at:".concat(t),o=e[1]?"at:".concat(e[1]):void 0;i(r,n,o);var s="bubble:".concat(t),a=e[1]?"bubble:".concat(e[1]):void 0;i(r,s,a)})),n.parents.forEach((function(e){t(e)}))};i(n.global),i(n.perspectiveView),i(n.sliceView)})),x(S(t),"selectionDetailsStateChanged",(function(){if(t.viewer){var e=t.props.onSelectionDetailsStateChanged;e&&e()}})),x(S(t),"layersChanged",(function(){if(t.handlerRemovers&&t.handlerRemovers.forEach((function(e){return e()})),t.viewer){var e=t.props,n=e.onSelectedChanged,i=e.onVisibleChanged;if(n||i){t.handlerRemovers=[];var r,o=C(t.viewer.layerManager.managedLayers);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(s.layer instanceof l.SegmentationUserLayer){var a=s.layer.displayState.segmentSelectionState,c=s.layer.displayState.segmentationGroupState.value.visibleSegments;if(a&&n){var d=t.selectedChanged.bind(void 0,s),u=a.changed.add(d);t.handlerRemovers.push(u),s.registerDisposer(u)}if(c&&i){var h=t.visibleChanged.bind(void 0,s),p=c.changed.add(h);t.handlerRemovers.push(p),s.registerDisposer(p)}}}}catch(f){o.e(f)}finally{o.f()}}}})),x(S(t),"selectedChanged",(function(e){if(t.viewer){var n=t.props.onSelectedChanged;if(n){var i=e.layer.displayState.segmentSelectionState;if(i)n(i.hasSelectedSegment?i.selectedSegment:null,e)}}})),x(S(t),"visibleChanged",(function(e){if(t.viewer){var n=t.props.onVisibleChanged;if(n){var i=e.layer.displayState.segmentationGroupState.value.visibleSegments;i&&n(i,e)}}})),t.ngContainer=r.default.createRef(),t.viewer=null,t}return t=s,(n=[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.perspectiveZoom,i=t.viewerState,r=t.brainMapsClientId,o=t.eventBindingsToUpdate,s=t.onViewerStateChanged,a=t.callbacks,l=t.ngServer,c=t.key;if(this.viewer=(0,d.setupDefaultViewer)({brainMapsClientId:r,target:this.ngContainer.current,bundleRoot:"/"}),this.setCallbacks(a),o&&this.updateEventBindings(o),this.viewer.expectingExternalUI=!0,l&&(this.viewer.makeUrlFromState=function(e){var t=m({},e);return e.layers&&(t.layers=e.layers.filter((function(e){if(e.source){var t=e.source.url||e.source;if("string"===typeof t)return!t.startsWith("clio://")}return!0}))),"".concat(l,"/#!").concat((0,p.encodeFragment)(JSON.stringify(t)))}),this.viewer.selectionDetailsState&&this.viewer.selectionDetailsState.changed.add(this.selectionDetailsStateChanged),this.viewer.layerManager.layersChanged.add(this.layersChanged),i){var u=i;null===u.projectionScale&&delete u.projectionScale,null===u.crossSectionScale&&delete u.crossSectionScale,null===u.projectionOrientation&&delete u.projectionOrientation,null===u.crossSectionOrientation&&delete u.crossSectionOrientation,this.viewer.state.restoreState(u)}else this.viewer.state.restoreState({layers:{grayscale:{type:"image",source:"dvid://https://flyem.dvid.io/ab6e610d4fe140aba0e030645a1d7229/grayscalejpeg"},segmentation:{type:"segmentation",source:"dvid://https://flyem.dvid.io/d925633ed0974da78e2bb5cf38d01f4d/segmentation"}},perspectiveZoom:n,navigation:{zoomFactor:8}});this.viewer.state.changed.add((function(){if(s)try{e.viewer.state.viewer.position&&s(e.viewer.state.toJSON())}catch(t){console.debug(t)}})),c?T[c]=this.viewer:E=this.viewer,window.viewer=this.viewer}},{key:"componentDidUpdate",value:function(){var e,t=this,n={},i=C(this.viewer.layerManager.managedLayers);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r.layer instanceof l.SegmentationUserLayer){var o=r.layer.displayState.segmentSelectionState;n[r.name]=o.selectedSegment}}}catch(p){i.e(p)}finally{i.f()}var s=this.props.viewerState;if(s){var a=m({},s),c=[function(){t.viewer.state.restoreState(a)}];null===s.projectionScale&&(delete a.projectionScale,c.push((function(){t.viewer.projectionScale.reset()}))),null===s.crossSectionScale&&delete a.crossSectionScale,c.forEach((function(e){return e()}))}var d,u=C(this.viewer.layerManager.managedLayers);try{for(u.s();!(d=u.n()).done;){var h=d.value;h.layer instanceof l.SegmentationUserLayer&&h.layer.displayState.segmentSelectionState.set(n[h.name])}}catch(p){u.e(p)}finally{u.f()}"position"in s&&Array.isArray(s.position)&&0===s.position.length&&this.viewer.position.reset()}},{key:"componentWillUnmount",value:function(){var e=this.props.key;e?delete T[e]:E=void 0}},{key:"setCallbacks",value:function(e){var t=this;e.forEach((function(e){t.viewer.bindCallback(e.name,e.function),t.viewer.inputEventBindings.sliceView.set(e.event,e.name)}))}},{key:"render",value:function(){var e=this.props.perspectiveZoom;return r.default.createElement("div",{className:"neuroglancer-container",ref:this.ngContainer},r.default.createElement("p",null,"Neuroglancer here with zoom ",e))}}])&&v(t.prototype,n),i&&v(t,i),s}(r.default.Component);t.Ay=A,A.propTypes={perspectiveZoom:o.default.number,viewerState:o.default.object,brainMapsClientId:o.default.string,key:o.default.string,eventBindingsToUpdate:o.default.array,onSelectedChanged:o.default.func,onVisibleChanged:o.default.func,onSelectionDetailsStateChanged:o.default.func,callbacks:o.default.arrayOf(o.default.object),ngServer:o.default.string},A.defaultProps={perspectiveZoom:20,eventBindingsToUpdate:null,brainMapsClientId:null,viewerState:null,onSelectedChanged:null,onVisibleChanged:null,onSelectionDetailsStateChanged:null,key:null,callbacks:[],ngServer:null}},974:(e,t,n)=>{e.exports={default:n(3765),__esModule:!0}},7797:(e,t,n)=>{e.exports={default:n(3929),__esModule:!0}},1055:(e,t,n)=>{e.exports={default:n(2243),__esModule:!0}},984:(e,t,n)=>{e.exports={default:n(7828),__esModule:!0}},608:(e,t,n)=>{e.exports={default:n(4676),__esModule:!0}},8250:(e,t,n)=>{e.exports={default:n(6742),__esModule:!0}},6326:(e,t,n)=>{e.exports={default:n(3306),__esModule:!0}},4117:(e,t,n)=>{e.exports={default:n(4977),__esModule:!0}},3816:(e,t,n)=>{e.exports={default:n(1132),__esModule:!0}},8178:(e,t,n)=>{e.exports={default:n(5510),__esModule:!0}},2395:(e,t,n)=>{e.exports={default:n(2495),__esModule:!0}},6392:(e,t,n)=>{e.exports={default:n(9236),__esModule:!0}},3651:(e,t,n)=>{e.exports={default:n(3679),__esModule:!0}},6063:(e,t,n)=>{e.exports={default:n(8635),__esModule:!0}},3008:(e,t,n)=>{e.exports={default:n(4116),__esModule:!0}},5677:(e,t,n)=>{e.exports={default:n(7041),__esModule:!0}},4148:(e,t,n)=>{e.exports={default:n(2283),__esModule:!0}},1526:(e,t,n)=>{e.exports={default:n(994),__esModule:!0}},1190:(e,t,n)=>{e.exports={default:n(3962),__esModule:!0}},6688:(e,t,n)=>{e.exports={default:n(8252),__esModule:!0}},7399:(e,t,n)=>{e.exports={default:n(9643),__esModule:!0}},1274:(e,t,n)=>{e.exports={default:n(3382),__esModule:!0}},8528:(e,t,n)=>{e.exports={default:n(9452),__esModule:!0}},9176:(e,t,n)=>{e.exports={default:n(1563),__esModule:!0}},1288:(e,t,n)=>{e.exports={default:n(5404),__esModule:!0}},281:(e,t,n)=>{e.exports={default:n(2469),__esModule:!0}},2055:(e,t,n)=>{e.exports={default:n(123),__esModule:!0}},7737:(e,t,n)=>{e.exports={default:n(6565),__esModule:!0}},2683:(e,t)=>{t.A=function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}},2982:(e,t,n)=>{var i=o(n(1055)),r=o(n(7797));function o(e){return e&&e.__esModule?e:{default:e}}t.A=function(e,t){if(Array.isArray(e))return e;if((0,i.default)(Object(e)))return function(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var a,l=(0,r.default)(e);!(i=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(c){o=!0,s=c}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},7392:(e,t,n)=>{var i,r=n(974),o=(i=r)&&i.__esModule?i:{default:i};t.A=function(e){return Array.isArray(e)?e:(0,o.default)(e)}},3765:(e,t,n)=>{n(1280),n(6446),e.exports=n(9085).Array.from},3929:(e,t,n)=>{n(6467),n(1280),e.exports=n(7609)},2243:(e,t,n)=>{n(6467),n(1280),e.exports=n(7683)},7828:(e,t,n)=>{var i=n(9085),r=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}},4676:(e,t,n)=>{n(4983),n(1280),n(6467),n(6453),n(9318),n(8507),n(8506),e.exports=n(9085).Map},6742:(e,t,n)=>{n(6676),e.exports=n(9085).Math.imul},3306:(e,t,n)=>{n(2932),e.exports=n(9085).Math.log10},4977:(e,t,n)=>{n(3699),e.exports=n(9085).Math.log2},1132:(e,t,n)=>{n(9406),e.exports=n(9085).Math.sign},5510:(e,t,n)=>{n(7256),e.exports=n(9085).Number.isFinite},2495:(e,t,n)=>{n(8225),e.exports=n(9085).Number.isInteger},9236:(e,t,n)=>{n(4533),e.exports=n(9085).Number.isNaN},3679:(e,t,n)=>{n(521),e.exports=n(9085).Object.assign},8635:(e,t,n)=>{n(9333);var i=n(9085).Object;e.exports=function(e,t,n){return i.defineProperty(e,t,n)}},4116:(e,t,n)=>{n(3287),e.exports=n(9085).Object.entries},7041:(e,t,n)=>{n(7295);var i=n(9085).Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},2283:(e,t,n)=>{n(1711),e.exports=n(9085).Object.getOwnPropertySymbols},994:(e,t,n)=>{n(5584),e.exports=n(9085).Object.is},3962:(e,t,n)=>{n(7900),e.exports=n(9085).Object.keys},8252:(e,t,n)=>{n(3345),e.exports=n(9085).Object.values},9643:(e,t,n)=>{n(4983),n(1280),n(6467),n(4166),n(5596),n(2842),e.exports=n(9085).Promise},3382:(e,t,n)=>{n(4983),n(1280),n(6467),n(1715),n(4428),n(4313),n(7228),e.exports=n(9085).Set},9452:(e,t,n)=>{n(1166),e.exports=n(9085).String.raw},5404:(e,t,n)=>{n(1711),e.exports=n(9085).Symbol.for},1563:(e,t,n)=>{n(1711),n(4983),n(7783),n(1755),e.exports=n(9085).Symbol},2469:(e,t,n)=>{n(1280),n(6467),e.exports=n(5581).f("iterator")},123:(e,t,n)=>{n(4983),n(6467),n(3568),n(7842),n(31),e.exports=n(9085).WeakMap},6565:(e,t,n)=>{n(4983),n(6467),n(2490),n(4888),n(9657),e.exports=n(9085).WeakSet},1052:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},3839:e=>{e.exports=function(){}},1421:e=>{e.exports=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e}},9853:(e,t,n)=>{var i=n(7056);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},8653:(e,t,n)=>{var i=n(417);e.exports=function(e,t){var n=[];return i(e,!1,n.push,n,t),n}},35:(e,t,n)=>{var i=n(7130),r=n(9676),o=n(3e3);e.exports=function(e){return function(t,n,s){var a,l=i(t),c=r(l.length),d=o(s,c);if(e&&n!=n){for(;c>d;)if((a=l[d++])!=a)return!0}else for(;c>d;d++)if((e||d in l)&&l[d]===n)return e||d||0;return!e&&-1}}},5386:(e,t,n)=>{var i=n(653),r=n(2988),o=n(9907),s=n(9676),a=n(7199);e.exports=function(e,t){var n=1==e,l=2==e,c=3==e,d=4==e,u=6==e,h=5==e||u,p=t||a;return function(t,a,f){for(var g,m,v=o(t),y=r(v),b=i(a,f,3),S=s(y.length),w=0,x=n?p(t,S):l?p(t,0):void 0;S>w;w++)if((h||w in y)&&(m=b(g=y[w],w,v),e))if(n)x[w]=m;else if(m)switch(e){case 3:return!0;case 5:return g;case 6:return w;case 2:x.push(g)}else if(d)return!1;return u?-1:c||d?d:x}}},4671:(e,t,n)=>{var i=n(7056),r=n(4842),o=n(8999)("species");e.exports=function(e){var t;return r(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!r(t.prototype)||(t=void 0),i(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},7199:(e,t,n)=>{var i=n(4671);e.exports=function(e,t){return new(i(e))(t)}},5017:(e,t,n)=>{var i=n(1628),r=n(8999)("toStringTag"),o="Arguments"==i(function(){return arguments}());e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=Object(e),r))?n:o?i(t):"Object"==(s=i(t))&&"function"==typeof t.callee?"Arguments":s}},1628:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},3764:(e,t,n)=>{var i=n(3590).f,r=n(8978),o=n(8342),s=n(653),a=n(1421),l=n(417),c=n(8654),d=n(5111),u=n(9835),h=n(6006),p=n(5963).fastKey,f=n(6873),g=h?"_s":"size",m=function(e,t){var n,i=p(t);if("F"!==i)return e._i[i];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var d=e((function(e,i){a(e,d,t,"_i"),e._t=t,e._i=r(null),e._f=void 0,e._l=void 0,e[g]=0,void 0!=i&&l(i,n,e[c],e)}));return o(d.prototype,{clear:function(){for(var e=f(this,t),n=e._i,i=e._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete n[i.i];e._f=e._l=void 0,e[g]=0},delete:function(e){var n=f(this,t),i=m(n,e);if(i){var r=i.n,o=i.p;delete n._i[i.i],i.r=!0,o&&(o.n=r),r&&(r.p=o),n._f==i&&(n._f=r),n._l==i&&(n._l=o),n[g]--}return!!i},forEach:function(e){f(this,t);for(var n,i=s(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(i(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!m(f(this,t),e)}}),h&&i(d.prototype,"size",{get:function(){return f(this,t)[g]}}),d},def:function(e,t,n){var i,r,o=m(e,t);return o?o.v=n:(e._l=o={i:r=p(t,!0),k:t,v:n,p:i=e._l,n:void 0,r:!1},e._f||(e._f=o),i&&(i.n=o),e[g]++,"F"!==r&&(e._i[r]=o)),e},getEntry:m,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=f(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?d(0,"keys"==t?n.k:"values"==t?n.v:[n.k,n.v]):(e._t=void 0,d(1))}),n?"entries":"values",!n,!0),u(t)}}},777:(e,t,n)=>{var i=n(5017),r=n(8653);e.exports=function(e){return function(){if(i(this)!=e)throw TypeError(e+"#toJSON isn't generic");return r(this)}}},4679:(e,t,n)=>{var i=n(8342),r=n(5963).getWeak,o=n(9853),s=n(7056),a=n(1421),l=n(417),c=n(5386),d=n(6940),u=n(6873),h=c(5),p=c(6),f=0,g=function(e){return e._l||(e._l=new m)},m=function(){this.a=[]},v=function(e,t){return h(e.a,(function(e){return e[0]===t}))};m.prototype={get:function(e){var t=v(this,e);if(t)return t[1]},has:function(e){return!!v(this,e)},set:function(e,t){var n=v(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=p(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,o){var c=e((function(e,i){a(e,c,t,"_i"),e._t=t,e._i=f++,e._l=void 0,void 0!=i&&l(i,n,e[o],e)}));return i(c.prototype,{delete:function(e){if(!s(e))return!1;var n=r(e);return!0===n?g(u(this,t)).delete(e):n&&d(n,this._i)&&delete n[this._i]},has:function(e){if(!s(e))return!1;var n=r(e);return!0===n?g(u(this,t)).has(e):n&&d(n,this._i)}}),c},def:function(e,t,n){var i=r(o(t),!0);return!0===i?g(e).set(t,n):i[e._i]=n,e},ufstore:g}},7566:(e,t,n)=>{var i=n(7181),r=n(6460),o=n(5963),s=n(1713),a=n(7426),l=n(8342),c=n(417),d=n(1421),u=n(7056),h=n(7661),p=n(3590).f,f=n(5386)(0),g=n(6006);e.exports=function(e,t,n,m,v,y){var b=i[e],S=b,w=v?"set":"add",x=S&&S.prototype,C={};return g&&"function"==typeof S&&(y||x.forEach&&!s((function(){(new S).entries().next()})))?(S=t((function(t,n){d(t,S,e,"_c"),t._c=new b,void 0!=n&&c(n,v,t[w],t)})),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in x)||y&&"clear"==e||a(S.prototype,e,(function(n,i){if(d(this,S,e),!t&&y&&!u(n))return"get"==e&&void 0;var r=this._c[e](0===n?0:n,i);return t?this:r}))})),y||p(S.prototype,"size",{get:function(){return this._c.size}})):(S=m.getConstructor(t,e,v,w),l(S.prototype,n),o.NEED=!0),h(S,e),C[e]=S,r(r.G+r.W+r.F,C),y||m.setStrong(S,e,v),S}},9085:e=>{var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)},8534:(e,t,n)=>{var i=n(3590),r=n(4177);e.exports=function(e,t,n){t in e?i.f(e,t,r(0,n)):e[t]=n}},653:(e,t,n)=>{var i=n(1052);e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},8441:e=>{e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},6006:(e,t,n)=>{e.exports=!n(1713)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},3029:(e,t,n)=>{var i=n(7056),r=n(7181).document,o=i(r)&&i(r.createElement);e.exports=function(e){return o?r.createElement(e):{}}},7757:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},7976:(e,t,n)=>{var i=n(6146),r=n(6469),o=n(7258);e.exports=function(e){var t=i(e),n=r.f;if(n)for(var s,a=n(e),l=o.f,c=0;a.length>c;)l.call(e,s=a[c++])&&t.push(s);return t}},6460:(e,t,n)=>{var i=n(7181),r=n(9085),o=n(653),s=n(7426),a=n(6940),l="prototype",c=function(e,t,n){var d,u,h,p=e&c.F,f=e&c.G,g=e&c.S,m=e&c.P,v=e&c.B,y=e&c.W,b=f?r:r[t]||(r[t]={}),S=b[l],w=f?i:g?i[t]:(i[t]||{})[l];for(d in f&&(n=t),n)(u=!p&&w&&void 0!==w[d])&&a(b,d)||(h=u?w[d]:n[d],b[d]=f&&"function"!=typeof w[d]?n[d]:v&&u?o(h,i):y&&w[d]==h?function(e){var t=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,i)}return e.apply(this,arguments)};return t[l]=e[l],t}(h):m&&"function"==typeof h?o(Function.call,h):h,m&&((b.virtual||(b.virtual={}))[d]=h,e&c.R&&S&&!S[d]&&s(S,d,h)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},1713:e=>{e.exports=function(e){try{return!!e()}catch(t){return!0}}},417:(e,t,n)=>{var i=n(653),r=n(6713),o=n(4245),s=n(9853),a=n(9676),l=n(8827),c={},d={},u=e.exports=function(e,t,n,u,h){var p,f,g,m,v=h?function(){return e}:l(e),y=i(n,u,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(p=a(e.length);p>b;b++)if((m=t?y(s(f=e[b])[0],f[1]):y(e[b]))===c||m===d)return m}else for(g=v.call(e);!(f=g.next()).done;)if((m=r(g,y,f.value,t))===c||m===d)return m};u.BREAK=c,u.RETURN=d},7181:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},6940:e=>{var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},7426:(e,t,n)=>{var i=n(3590),r=n(4177);e.exports=n(6006)?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},9795:(e,t,n)=>{var i=n(7181).document;e.exports=i&&i.documentElement},5695:(e,t,n)=>{e.exports=!n(6006)&&!n(1713)((function(){return 7!=Object.defineProperty(n(3029)("div"),"a",{get:function(){return 7}}).a}))},450:e=>{e.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},2988:(e,t,n)=>{var i=n(1628);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},4245:(e,t,n)=>{var i=n(3455),r=n(8999)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||o[r]===e)}},4842:(e,t,n)=>{var i=n(1628);e.exports=Array.isArray||function(e){return"Array"==i(e)}},2169:(e,t,n)=>{var i=n(7056),r=Math.floor;e.exports=function(e){return!i(e)&&isFinite(e)&&r(e)===e}},7056:e=>{e.exports=function(e){return"object"===typeof e?null!==e:"function"===typeof e}},6713:(e,t,n)=>{var i=n(9853);e.exports=function(e,t,n,r){try{return r?t(i(n)[0],n[1]):t(n)}catch(s){var o=e.return;throw void 0!==o&&i(o.call(e)),s}}},2433:(e,t,n)=>{var i=n(8978),r=n(4177),o=n(7661),s={};n(7426)(s,n(8999)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=i(s,{next:r(1,n)}),o(e,t+" Iterator")}},8654:(e,t,n)=>{var i=n(595),r=n(6460),o=n(9988),s=n(7426),a=n(3455),l=n(2433),c=n(7661),d=n(5112),u=n(8999)("iterator"),h=!([].keys&&"next"in[].keys()),p="keys",f="values",g=function(){return this};e.exports=function(e,t,n,m,v,y,b){l(n,t,m);var S,w,x,C=function(e){if(!h&&e in L)return L[e];switch(e){case p:case f:return function(){return new n(this,e)}}return function(){return new n(this,e)}},k=t+" Iterator",E=v==f,T=!1,L=e.prototype,P=L[u]||L["@@iterator"]||v&&L[v],D=P||C(v),M=v?E?C("entries"):D:void 0,I="Array"==t&&L.entries||P;if(I&&(x=d(I.call(new e)))!==Object.prototype&&x.next&&(c(x,k,!0),i||"function"==typeof x[u]||s(x,u,g)),E&&P&&P.name!==f&&(T=!0,D=function(){return P.call(this)}),i&&!b||!h&&!T&&L[u]||s(L,u,D),a[t]=D,a[k]=g,v)if(S={values:E?D:C(f),keys:y?D:C(p),entries:M},b)for(w in S)w in L||o(L,w,S[w]);else r(r.P+r.F*(h||T),t,S);return S}},6438:(e,t,n)=>{var i=n(8999)("iterator"),r=!1;try{var o=[7][i]();o.return=function(){r=!0},Array.from(o,(function(){throw 2}))}catch(s){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var o=[7],a=o[i]();a.next=function(){return{done:n=!0}},o[i]=function(){return a},e(o)}catch(s){}return n}},5111:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},3455:e=>{e.exports={}},595:e=>{e.exports=!0},1660:e=>{e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},5963:(e,t,n)=>{var i=n(8162)("meta"),r=n(7056),o=n(6940),s=n(3590).f,a=0,l=Object.isExtensible||function(){return!0},c=!n(1713)((function(){return l(Object.preventExtensions({}))})),d=function(e){s(e,i,{value:{i:"O"+ ++a,w:{}}})},u=e.exports={KEY:i,NEED:!1,fastKey:function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,i)){if(!l(e))return"F";if(!t)return"E";d(e)}return e[i].i},getWeak:function(e,t){if(!o(e,i)){if(!l(e))return!0;if(!t)return!1;d(e)}return e[i].w},onFreeze:function(e){return c&&u.NEED&&l(e)&&!o(e,i)&&d(e),e}}},7201:(e,t,n)=>{var i=n(7181),r=n(4855).set,o=i.MutationObserver||i.WebKitMutationObserver,s=i.process,a=i.Promise,l="process"==n(1628)(s);e.exports=function(){var e,t,n,c=function(){var i,r;for(l&&(i=s.domain)&&i.exit();e;){r=e.fn,e=e.next;try{r()}catch(o){throw e?n():t=void 0,o}}t=void 0,i&&i.enter()};if(l)n=function(){s.nextTick(c)};else if(!o||i.navigator&&i.navigator.standalone)if(a&&a.resolve){var d=a.resolve(void 0);n=function(){d.then(c)}}else n=function(){r.call(i,c)};else{var u=!0,h=document.createTextNode("");new o(c).observe(h,{characterData:!0}),n=function(){h.data=u=!u}}return function(i){var r={fn:i,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}},3661:(e,t,n)=>{var i=n(1052);function r(e){var t,n;this.promise=new e((function(e,i){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=i})),this.resolve=i(t),this.reject=i(n)}e.exports.f=function(e){return new r(e)}},9447:(e,t,n)=>{var i=n(6006),r=n(6146),o=n(6469),s=n(7258),a=n(9907),l=n(2988),c=Object.assign;e.exports=!c||n(1713)((function(){var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=i}))?function(e,t){for(var n=a(e),c=arguments.length,d=1,u=o.f,h=s.f;c>d;)for(var p,f=l(arguments[d++]),g=u?r(f).concat(u(f)):r(f),m=g.length,v=0;m>v;)p=g[v++],i&&!h.call(f,p)||(n[p]=f[p]);return n}:c},8978:(e,t,n)=>{var i=n(9853),r=n(829),o=n(7757),s=n(8185)("IE_PROTO"),a=function(){},l="prototype",c=function(){var e,t=n(3029)("iframe"),i=o.length;for(t.style.display="none",n(9795).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;i--;)delete c[l][o[i]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(a[l]=i(e),n=new a,a[l]=null,n[s]=e):n=c(),void 0===t?n:r(n,t)}},3590:(e,t,n)=>{var i=n(9853),r=n(5695),o=n(5723),s=Object.defineProperty;t.f=n(6006)?Object.defineProperty:function(e,t,n){if(i(e),t=o(t,!0),i(n),r)try{return s(e,t,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},829:(e,t,n)=>{var i=n(3590),r=n(9853),o=n(6146);e.exports=n(6006)?Object.defineProperties:function(e,t){r(e);for(var n,s=o(t),a=s.length,l=0;a>l;)i.f(e,n=s[l++],t[n]);return e}},96:(e,t,n)=>{var i=n(7258),r=n(4177),o=n(7130),s=n(5723),a=n(6940),l=n(5695),c=Object.getOwnPropertyDescriptor;t.f=n(6006)?c:function(e,t){if(e=o(e),t=s(t,!0),l)try{return c(e,t)}catch(n){}if(a(e,t))return r(!i.f.call(e,t),e[t])}},8108:(e,t,n)=>{var i=n(7130),r=n(7858).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==o.call(e)?function(e){try{return r(e)}catch(t){return s.slice()}}(e):r(i(e))}},7858:(e,t,n)=>{var i=n(6750),r=n(7757).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,r)}},6469:(e,t)=>{t.f=Object.getOwnPropertySymbols},5112:(e,t,n)=>{var i=n(6940),r=n(9907),o=n(8185)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),i(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},6750:(e,t,n)=>{var i=n(6940),r=n(7130),o=n(35)(!1),s=n(8185)("IE_PROTO");e.exports=function(e,t){var n,a=r(e),l=0,c=[];for(n in a)n!=s&&i(a,n)&&c.push(n);for(;t.length>l;)i(a,n=t[l++])&&(~o(c,n)||c.push(n));return c}},6146:(e,t,n)=>{var i=n(6750),r=n(7757);e.exports=Object.keys||function(e){return i(e,r)}},7258:(e,t)=>{t.f={}.propertyIsEnumerable},2276:(e,t,n)=>{var i=n(6460),r=n(9085),o=n(1713);e.exports=function(e,t){var n=(r.Object||{})[e]||Object[e],s={};s[e]=t(n),i(i.S+i.F*o((function(){n(1)})),"Object",s)}},9347:(e,t,n)=>{var i=n(6006),r=n(6146),o=n(7130),s=n(7258).f;e.exports=function(e){return function(t){for(var n,a=o(t),l=r(a),c=l.length,d=0,u=[];c>d;)n=l[d++],i&&!s.call(a,n)||u.push(e?[n,a[n]]:a[n]);return u}}},3465:e=>{e.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},5060:(e,t,n)=>{var i=n(9853),r=n(7056),o=n(3661);e.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},4177:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},8342:(e,t,n)=>{var i=n(7426);e.exports=function(e,t,n){for(var r in t)n&&e[r]?e[r]=t[r]:i(e,r,t[r]);return e}},9988:(e,t,n)=>{e.exports=n(7426)},8116:e=>{e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},4090:(e,t,n)=>{var i=n(6460),r=n(1052),o=n(653),s=n(417);e.exports=function(e){i(i.S,e,{from:function(e){var t,n,i,a,l=arguments[1];return r(this),(t=void 0!==l)&&r(l),void 0==e?new this:(n=[],t?(i=0,a=o(l,arguments[2],2),s(e,!1,(function(e){n.push(a(e,i++))}))):s(e,!1,n.push,n),new this(n))}})}},7035:(e,t,n)=>{var i=n(6460);e.exports=function(e){i(i.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},9835:(e,t,n)=>{var i=n(7181),r=n(9085),o=n(3590),s=n(6006),a=n(8999)("species");e.exports=function(e){var t="function"==typeof r[e]?r[e]:i[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},7661:(e,t,n)=>{var i=n(3590).f,r=n(6940),o=n(8999)("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,o)&&i(e,o,{configurable:!0,value:t})}},8185:(e,t,n)=>{var i=n(9135)("keys"),r=n(8162);e.exports=function(e){return i[e]||(i[e]=r(e))}},9135:(e,t,n)=>{var i=n(9085),r=n(7181),o="__core-js_shared__",s=r[o]||(r[o]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:i.version,mode:n(595)?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},4987:(e,t,n)=>{var i=n(9853),r=n(1052),o=n(8999)("species");e.exports=function(e,t){var n,s=i(e).constructor;return void 0===s||void 0==(n=i(s)[o])?t:r(n)}},4817:(e,t,n)=>{var i=n(9588),r=n(8441);e.exports=function(e){return function(t,n){var o,s,a=String(r(t)),l=i(n),c=a.length;return l<0||l>=c?e?"":void 0:(o=a.charCodeAt(l))<55296||o>56319||l+1===c||(s=a.charCodeAt(l+1))<56320||s>57343?e?a.charAt(l):o:e?a.slice(l,l+2):s-56320+(o-55296<<10)+65536}}},4855:(e,t,n)=>{var i,r,o,s=n(653),a=n(450),l=n(9795),c=n(3029),d=n(7181),u=d.process,h=d.setImmediate,p=d.clearImmediate,f=d.MessageChannel,g=d.Dispatch,m=0,v={},y="onreadystatechange",b=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},S=function(e){b.call(e.data)};h&&p||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++m]=function(){a("function"==typeof e?e:Function(e),t)},i(m),m},p=function(e){delete v[e]},"process"==n(1628)(u)?i=function(e){u.nextTick(s(b,e,1))}:g&&g.now?i=function(e){g.now(s(b,e,1))}:f?(o=(r=new f).port2,r.port1.onmessage=S,i=s(o.postMessage,o,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(i=function(e){d.postMessage(e+"","*")},d.addEventListener("message",S,!1)):i=y in c("script")?function(e){l.appendChild(c("script"))[y]=function(){l.removeChild(this),b.call(e)}}:function(e){setTimeout(s(b,e,1),0)}),e.exports={set:h,clear:p}},3e3:(e,t,n)=>{var i=n(9588),r=Math.max,o=Math.min;e.exports=function(e,t){return(e=i(e))<0?r(e+t,0):o(e,t)}},9588:e=>{var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},7130:(e,t,n)=>{var i=n(2988),r=n(8441);e.exports=function(e){return i(r(e))}},9676:(e,t,n)=>{var i=n(9588),r=Math.min;e.exports=function(e){return e>0?r(i(e),9007199254740991):0}},9907:(e,t,n)=>{var i=n(8441);e.exports=function(e){return Object(i(e))}},5723:(e,t,n)=>{var i=n(7056);e.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},8162:e=>{var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},4493:(e,t,n)=>{var i=n(7181).navigator;e.exports=i&&i.userAgent||""},6873:(e,t,n)=>{var i=n(7056);e.exports=function(e,t){if(!i(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},8011:(e,t,n)=>{var i=n(7181),r=n(9085),o=n(595),s=n(5581),a=n(3590).f;e.exports=function(e){var t=r.Symbol||(r.Symbol=o?{}:i.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},5581:(e,t,n)=>{t.f=n(8999)},8999:(e,t,n)=>{var i=n(9135)("wks"),r=n(8162),o=n(7181).Symbol,s="function"==typeof o;(e.exports=function(e){return i[e]||(i[e]=s&&o[e]||(s?o:r)("Symbol."+e))}).store=i},8827:(e,t,n)=>{var i=n(5017),r=n(8999)("iterator"),o=n(3455);e.exports=n(9085).getIteratorMethod=function(e){if(void 0!=e)return e[r]||e["@@iterator"]||o[i(e)]}},7609:(e,t,n)=>{var i=n(9853),r=n(8827);e.exports=n(9085).getIterator=function(e){var t=r(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return i(t.call(e))}},7683:(e,t,n)=>{var i=n(5017),r=n(8999)("iterator"),o=n(3455);e.exports=n(9085).isIterable=function(e){var t=Object(e);return void 0!==t[r]||"@@iterator"in t||o.hasOwnProperty(i(t))}},6446:(e,t,n)=>{var i=n(653),r=n(6460),o=n(9907),s=n(6713),a=n(4245),l=n(9676),c=n(8534),d=n(8827);r(r.S+r.F*!n(6438)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,r,u,h=o(e),p="function"==typeof this?this:Array,f=arguments.length,g=f>1?arguments[1]:void 0,m=void 0!==g,v=0,y=d(h);if(m&&(g=i(g,f>2?arguments[2]:void 0,2)),void 0==y||p==Array&&a(y))for(n=new p(t=l(h.length));t>v;v++)c(n,v,m?g(h[v],v):h[v]);else for(u=y.call(h),n=new p;!(r=u.next()).done;v++)c(n,v,m?s(u,g,[r.value,v],!0):r.value);return n.length=v,n}})},8636:(e,t,n)=>{var i=n(3839),r=n(5111),o=n(3455),s=n(7130);e.exports=n(8654)(Array,"Array",(function(e,t){this._t=s(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):r(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},6453:(e,t,n)=>{var i=n(3764),r=n(6873),o="Map";e.exports=n(7566)(o,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=i.getEntry(r(this,o),e);return t&&t.v},set:function(e,t){return i.def(r(this,o),0===e?0:e,t)}},i,!0)},6676:(e,t,n)=>{var i=n(6460),r=Math.imul;i(i.S+i.F*n(1713)((function(){return-5!=r(4294967295,5)||2!=r.length})),"Math",{imul:function(e,t){var n=65535,i=+e,r=+t,o=n&i,s=n&r;return 0|o*s+((n&i>>>16)*s+o*(n&r>>>16)<<16>>>0)}})},2932:(e,t,n)=>{var i=n(6460);i(i.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},3699:(e,t,n)=>{var i=n(6460);i(i.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},9406:(e,t,n)=>{var i=n(6460);i(i.S,"Math",{sign:n(1660)})},7256:(e,t,n)=>{var i=n(6460),r=n(7181).isFinite;i(i.S,"Number",{isFinite:function(e){return"number"==typeof e&&r(e)}})},8225:(e,t,n)=>{var i=n(6460);i(i.S,"Number",{isInteger:n(2169)})},4533:(e,t,n)=>{var i=n(6460);i(i.S,"Number",{isNaN:function(e){return e!=e}})},521:(e,t,n)=>{var i=n(6460);i(i.S+i.F,"Object",{assign:n(9447)})},9333:(e,t,n)=>{var i=n(6460);i(i.S+i.F*!n(6006),"Object",{defineProperty:n(3590).f})},7295:(e,t,n)=>{var i=n(7130),r=n(96).f;n(2276)("getOwnPropertyDescriptor",(function(){return function(e,t){return r(i(e),t)}}))},5584:(e,t,n)=>{var i=n(6460);i(i.S,"Object",{is:n(8116)})},7900:(e,t,n)=>{var i=n(9907),r=n(6146);n(2276)("keys",(function(){return function(e){return r(i(e))}}))},4983:()=>{},4166:(e,t,n)=>{var i,r,o,s,a=n(595),l=n(7181),c=n(653),d=n(5017),u=n(6460),h=n(7056),p=n(1052),f=n(1421),g=n(417),m=n(4987),v=n(4855).set,y=n(7201)(),b=n(3661),S=n(3465),w=n(4493),x=n(5060),C="Promise",k=l.TypeError,E=l.process,T=E&&E.versions,L=T&&T.v8||"",P=l[C],D="process"==d(E),M=function(){},I=r=b.f,R=!!function(){try{var e=P.resolve(1),t=(e.constructor={})[n(8999)("species")]=function(e){e(M,M)};return(D||"function"==typeof PromiseRejectionEvent)&&e.then(M)instanceof t&&0!==L.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(i){}}(),A=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var n=e._c;y((function(){for(var i=e._v,r=1==e._s,o=0,s=function(t){var n,o,s,a=r?t.ok:t.fail,l=t.resolve,c=t.reject,d=t.domain;try{a?(r||(2==e._h&&V(e),e._h=1),!0===a?n=i:(d&&d.enter(),n=a(i),d&&(d.exit(),s=!0)),n===t.promise?c(k("Promise-chain cycle")):(o=A(n))?o.call(n,l,c):l(n)):c(i)}catch(u){d&&!s&&d.exit(),c(u)}};n.length>o;)s(n[o++]);e._c=[],e._n=!1,t&&!e._h&&N(e)}))}},N=function(e){v.call(l,(function(){var t,n,i,r=e._v,o=_(e);if(o&&(t=S((function(){D?E.emit("unhandledRejection",r,e):(n=l.onunhandledrejection)?n({promise:e,reason:r}):(i=l.console)&&i.error&&i.error("Unhandled promise rejection",r)})),e._h=D||_(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},_=function(e){return 1!==e._h&&0===(e._a||e._c).length},V=function(e){v.call(l,(function(){var t;D?E.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})}))},B=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},F=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw k("Promise can't be resolved itself");(t=A(e))?y((function(){var i={_w:n,_d:!1};try{t.call(e,c(F,i,1),c(B,i,1))}catch(r){B.call(i,r)}})):(n._v=e,n._s=1,O(n,!1))}catch(i){B.call({_w:n,_d:!1},i)}}};R||(P=function(e){f(this,P,C,"_h"),p(e),i.call(this);try{e(c(F,this,1),c(B,this,1))}catch(t){B.call(this,t)}},(i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(8342)(P.prototype,{then:function(e,t){var n=I(m(this,P));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=D?E.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&O(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new i;this.promise=e,this.resolve=c(F,e,1),this.reject=c(B,e,1)},b.f=I=function(e){return e===P||e===s?new o(e):r(e)}),u(u.G+u.W+u.F*!R,{Promise:P}),n(7661)(P,C),n(9835)(C),s=n(9085)[C],u(u.S+u.F*!R,C,{reject:function(e){var t=I(this);return(0,t.reject)(e),t.promise}}),u(u.S+u.F*(a||!R),C,{resolve:function(e){return x(a&&this===s?P:this,e)}}),u(u.S+u.F*!(R&&n(6438)((function(e){P.all(e).catch(M)}))),C,{all:function(e){var t=this,n=I(t),i=n.resolve,r=n.reject,o=S((function(){var n=[],o=0,s=1;g(e,!1,(function(e){var a=o++,l=!1;n.push(void 0),s++,t.resolve(e).then((function(e){l||(l=!0,n[a]=e,--s||i(n))}),r)})),--s||i(n)}));return o.e&&r(o.v),n.promise},race:function(e){var t=this,n=I(t),i=n.reject,r=S((function(){g(e,!1,(function(e){t.resolve(e).then(n.resolve,i)}))}));return r.e&&i(r.v),n.promise}})},1715:(e,t,n)=>{var i=n(3764),r=n(6873);e.exports=n(7566)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return i.def(r(this,"Set"),e=0===e?0:e,e)}},i)},1280:(e,t,n)=>{var i=n(4817)(!0);n(8654)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=i(t,n),this._i+=e.length,{value:e,done:!1})}))},1166:(e,t,n)=>{var i=n(6460),r=n(7130),o=n(9676);i(i.S,"String",{raw:function(e){for(var t=r(e.raw),n=o(t.length),i=arguments.length,s=[],a=0;n>a;)s.push(String(t[a++])),a<i&&s.push(String(arguments[a]));return s.join("")}})},1711:(e,t,n)=>{var i=n(7181),r=n(6940),o=n(6006),s=n(6460),a=n(9988),l=n(5963).KEY,c=n(1713),d=n(9135),u=n(7661),h=n(8162),p=n(8999),f=n(5581),g=n(8011),m=n(7976),v=n(4842),y=n(9853),b=n(7056),S=n(9907),w=n(7130),x=n(5723),C=n(4177),k=n(8978),E=n(8108),T=n(96),L=n(6469),P=n(3590),D=n(6146),M=T.f,I=P.f,R=E.f,A=i.Symbol,O=i.JSON,N=O&&O.stringify,_="prototype",V=p("_hidden"),B=p("toPrimitive"),F={}.propertyIsEnumerable,U=d("symbol-registry"),z=d("symbols"),j=d("op-symbols"),G=Object[_],W="function"==typeof A&&!!L.f,H=i.QObject,q=!H||!H[_]||!H[_].findChild,Y=o&&c((function(){return 7!=k(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a}))?function(e,t,n){var i=M(G,t);i&&delete G[t],I(e,t,n),i&&e!==G&&I(G,t,i)}:I,J=function(e){var t=z[e]=k(A[_]);return t._k=e,t},K=W&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},X=function(e,t,n){return e===G&&X(j,t,n),y(e),t=x(t,!0),y(n),r(z,t)?(n.enumerable?(r(e,V)&&e[V][t]&&(e[V][t]=!1),n=k(n,{enumerable:C(0,!1)})):(r(e,V)||I(e,V,C(1,{})),e[V][t]=!0),Y(e,t,n)):I(e,t,n)},Z=function(e,t){y(e);for(var n,i=m(t=w(t)),r=0,o=i.length;o>r;)X(e,n=i[r++],t[n]);return e},Q=function(e){var t=F.call(this,e=x(e,!0));return!(this===G&&r(z,e)&&!r(j,e))&&(!(t||!r(this,e)||!r(z,e)||r(this,V)&&this[V][e])||t)},$=function(e,t){if(e=w(e),t=x(t,!0),e!==G||!r(z,t)||r(j,t)){var n=M(e,t);return!n||!r(z,t)||r(e,V)&&e[V][t]||(n.enumerable=!0),n}},ee=function(e){for(var t,n=R(w(e)),i=[],o=0;n.length>o;)r(z,t=n[o++])||t==V||t==l||i.push(t);return i},te=function(e){for(var t,n=e===G,i=R(n?j:w(e)),o=[],s=0;i.length>s;)!r(z,t=i[s++])||n&&!r(G,t)||o.push(z[t]);return o};W||(a((A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===G&&t.call(j,n),r(this,V)&&r(this[V],e)&&(this[V][e]=!1),Y(this,e,C(1,n))};return o&&q&&Y(G,e,{configurable:!0,set:t}),J(e)})[_],"toString",(function(){return this._k})),T.f=$,P.f=X,n(7858).f=E.f=ee,n(7258).f=Q,L.f=te,o&&!n(595)&&a(G,"propertyIsEnumerable",Q,!0),f.f=function(e){return J(p(e))}),s(s.G+s.W+s.F*!W,{Symbol:A});for(var ne="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ie=0;ne.length>ie;)p(ne[ie++]);for(var re=D(p.store),oe=0;re.length>oe;)g(re[oe++]);s(s.S+s.F*!W,"Symbol",{for:function(e){return r(U,e+="")?U[e]:U[e]=A(e)},keyFor:function(e){if(!K(e))throw TypeError(e+" is not a symbol!");for(var t in U)if(U[t]===e)return t},useSetter:function(){q=!0},useSimple:function(){q=!1}}),s(s.S+s.F*!W,"Object",{create:function(e,t){return void 0===t?k(e):Z(k(e),t)},defineProperty:X,defineProperties:Z,getOwnPropertyDescriptor:$,getOwnPropertyNames:ee,getOwnPropertySymbols:te});var se=c((function(){L.f(1)}));s(s.S+s.F*se,"Object",{getOwnPropertySymbols:function(e){return L.f(S(e))}}),O&&s(s.S+s.F*(!W||c((function(){var e=A();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,i=[e],r=1;arguments.length>r;)i.push(arguments[r++]);if(n=t=i[1],(b(t)||void 0!==e)&&!K(e))return v(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!K(t))return t}),i[1]=t,N.apply(O,i)}}),A[_][B]||n(7426)(A[_],B,A[_].valueOf),u(A,"Symbol"),u(Math,"Math",!0),u(i.JSON,"JSON",!0)},3568:(e,t,n)=>{var i,r=n(7181),o=n(5386)(0),s=n(9988),a=n(5963),l=n(9447),c=n(4679),d=n(7056),u=n(6873),h=n(6873),p=!r.ActiveXObject&&"ActiveXObject"in r,f="WeakMap",g=a.getWeak,m=Object.isExtensible,v=c.ufstore,y=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},b={get:function(e){if(d(e)){var t=g(e);return!0===t?v(u(this,f)).get(e):t?t[this._i]:void 0}},set:function(e,t){return c.def(u(this,f),e,t)}},S=e.exports=n(7566)(f,y,b,c,!0,!0);h&&p&&(l((i=c.getConstructor(y,f)).prototype,b),a.NEED=!0,o(["delete","has","get","set"],(function(e){var t=S.prototype,n=t[e];s(t,e,(function(t,r){if(d(t)&&!m(t)){this._f||(this._f=new i);var o=this._f[e](t,r);return"set"==e?this:o}return n.call(this,t,r)}))})))},2490:(e,t,n)=>{var i=n(4679),r=n(6873),o="WeakSet";n(7566)(o,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return i.def(r(this,o),e,!0)}},i,!1,!0)},8506:(e,t,n)=>{n(4090)("Map")},8507:(e,t,n)=>{n(7035)("Map")},9318:(e,t,n)=>{var i=n(6460);i(i.P+i.R,"Map",{toJSON:n(777)("Map")})},3287:(e,t,n)=>{var i=n(6460),r=n(9347)(!0);i(i.S,"Object",{entries:function(e){return r(e)}})},3345:(e,t,n)=>{var i=n(6460),r=n(9347)(!1);i(i.S,"Object",{values:function(e){return r(e)}})},5596:(e,t,n)=>{var i=n(6460),r=n(9085),o=n(7181),s=n(4987),a=n(5060);i(i.P+i.R,"Promise",{finally:function(e){var t=s(this,r.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then((function(){return n}))}:e,n?function(n){return a(t,e()).then((function(){throw n}))}:e)}})},2842:(e,t,n)=>{var i=n(6460),r=n(3661),o=n(3465);i(i.S,"Promise",{try:function(e){var t=r.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},7228:(e,t,n)=>{n(4090)("Set")},4313:(e,t,n)=>{n(7035)("Set")},4428:(e,t,n)=>{var i=n(6460);i(i.P+i.R,"Set",{toJSON:n(777)("Set")})},7783:(e,t,n)=>{n(8011)("asyncIterator")},1755:(e,t,n)=>{n(8011)("observable")},31:(e,t,n)=>{n(4090)("WeakMap")},7842:(e,t,n)=>{n(7035)("WeakMap")},9657:(e,t,n)=>{n(4090)("WeakSet")},4888:(e,t,n)=>{n(7035)("WeakSet")},6467:(e,t,n)=>{n(8636);for(var i=n(7181),r=n(7426),o=n(3455),s=n(8999)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<a.length;l++){var c=a[l],d=i[c],u=d&&d.prototype;u&&!u[s]&&r(u,s,c),o[c]=o.Array}},593:(e,t,n)=>{!function(e){function t(t){return function(n,i){var r=i.line,o=n.getLine(r);function s(t){for(var s,a=i.ch,l=0;;){var c=a<=0?-1:o.lastIndexOf(t[0],a-1);if(-1!=c){if(1==l&&c<i.ch)break;if(s=n.getTokenTypeAt(e.Pos(r,c+1)),!/^(comment|string)/.test(s))return{ch:c+1,tokenType:s,pair:t};a=c-1}else{if(1==l)break;l=1,a=o.length}}}function a(t){var i,o,s=1,a=n.lastLine(),l=t.ch;e:for(var c=r;c<=a;++c)for(var d=n.getLine(c),u=c==r?l:0;;){var h=d.indexOf(t.pair[0],u),p=d.indexOf(t.pair[1],u);if(h<0&&(h=d.length),p<0&&(p=d.length),(u=Math.min(h,p))==d.length)break;if(n.getTokenTypeAt(e.Pos(c,u+1))==t.tokenType)if(u==h)++s;else if(! --s){i=c,o=u;break e}++u}return null==i||r==i?null:{from:e.Pos(r,l),to:e.Pos(i,o)}}for(var l=[],c=0;c<t.length;c++){var d=s(t[c]);d&&l.push(d)}for(l.sort((function(e,t){return e.ch-t.ch})),c=0;c<l.length;c++){var u=a(l[c]);if(u)return u}return null}}e.registerHelper("fold","brace",t([["{","}"],["[","]"]])),e.registerHelper("fold","brace-paren",t([["{","}"],["[","]"],["(",")"]])),e.registerHelper("fold","import",(function(t,n){function i(n){if(n<t.firstLine()||n>t.lastLine())return null;var i=t.getTokenAt(e.Pos(n,1));if(/\S/.test(i.string)||(i=t.getTokenAt(e.Pos(n,i.end+1))),"keyword"!=i.type||"import"!=i.string)return null;for(var r=n,o=Math.min(t.lastLine(),n+10);r<=o;++r){var s=t.getLine(r).indexOf(";");if(-1!=s)return{startCh:i.end,end:e.Pos(r,s)}}}var r,o=n.line,s=i(o);if(!s||i(o-1)||(r=i(o-2))&&r.end.line==o-1)return null;for(var a=s.end;;){var l=i(a.line+1);if(null==l)break;a=l.end}return{from:t.clipPos(e.Pos(o,s.startCh+1)),to:a}})),e.registerHelper("fold","include",(function(t,n){function i(n){if(n<t.firstLine()||n>t.lastLine())return null;var i=t.getTokenAt(e.Pos(n,1));return/\S/.test(i.string)||(i=t.getTokenAt(e.Pos(n,i.end+1))),"meta"==i.type&&"#include"==i.string.slice(0,8)?i.start+8:void 0}var r=n.line,o=i(r);if(null==o||null!=i(r-1))return null;for(var s=r;null!=i(s+1);)++s;return{from:e.Pos(r,o+1),to:t.clipPos(e.Pos(s))}}))}(n(7323))},5622:(e,t,n)=>{!function(e){function t(t,i,o,s){if(o&&o.call){var a=o;o=null}else a=r(t,o,"rangeFinder");"number"==typeof i&&(i=e.Pos(i,0));var l=r(t,o,"minFoldSize");function c(e){var n=a(t,i);if(!n||n.to.line-n.from.line<l)return null;if("fold"===s)return n;for(var r=t.findMarksAt(n.from),o=0;o<r.length;++o)if(r[o].__isFold){if(!e)return null;n.cleared=!0,r[o].clear()}return n}var d=c(!0);if(r(t,o,"scanUp"))for(;!d&&i.line>t.firstLine();)i=e.Pos(i.line-1,0),d=c(!1);if(d&&!d.cleared&&"unfold"!==s){var u=n(t,o,d);e.on(u,"mousedown",(function(t){h.clear(),e.e_preventDefault(t)}));var h=t.markText(d.from,d.to,{replacedWith:u,clearOnEnter:r(t,o,"clearOnEnter"),__isFold:!0});h.on("clear",(function(n,i){e.signal(t,"unfold",t,n,i)})),e.signal(t,"fold",t,d.from,d.to)}}function n(e,t,n){var i=r(e,t,"widget");if("function"==typeof i&&(i=i(n.from,n.to)),"string"==typeof i){var o=document.createTextNode(i);(i=document.createElement("span")).appendChild(o),i.className="CodeMirror-foldmarker"}else i&&(i=i.cloneNode(!0));return i}e.newFoldFunction=function(e,n){return function(i,r){t(i,r,{rangeFinder:e,widget:n})}},e.defineExtension("foldCode",(function(e,n,i){t(this,e,n,i)})),e.defineExtension("isFolded",(function(e){for(var t=this.findMarksAt(e),n=0;n<t.length;++n)if(t[n].__isFold)return!0})),e.commands.toggleFold=function(e){e.foldCode(e.getCursor())},e.commands.fold=function(e){e.foldCode(e.getCursor(),null,"fold")},e.commands.unfold=function(e){e.foldCode(e.getCursor(),{scanUp:!1},"unfold")},e.commands.foldAll=function(t){t.operation((function(){for(var n=t.firstLine(),i=t.lastLine();n<=i;n++)t.foldCode(e.Pos(n,0),{scanUp:!1},"fold")}))},e.commands.unfoldAll=function(t){t.operation((function(){for(var n=t.firstLine(),i=t.lastLine();n<=i;n++)t.foldCode(e.Pos(n,0),{scanUp:!1},"unfold")}))},e.registerHelper("fold","combine",(function(){var e=Array.prototype.slice.call(arguments,0);return function(t,n){for(var i=0;i<e.length;++i){var r=e[i](t,n);if(r)return r}}})),e.registerHelper("fold","auto",(function(e,t){for(var n=e.getHelpers(t,"fold"),i=0;i<n.length;i++){var r=n[i](e,t);if(r)return r}}));var i={rangeFinder:e.fold.auto,widget:"\u2194",minFoldSize:0,scanUp:!1,clearOnEnter:!0};function r(e,t,n){if(t&&void 0!==t[n])return t[n];var r=e.options.foldOptions;return r&&void 0!==r[n]?r[n]:i[n]}e.defineOption("foldOptions",null),e.defineExtension("foldOption",(function(e,t){return r(this,e,t)}))}(n(7323))},5916:(e,t,n)=>{!function(e){e.defineOption("foldGutter",!1,(function(t,r,o){o&&o!=e.Init&&(t.clearGutter(t.state.foldGutter.options.gutter),t.state.foldGutter=null,t.off("gutterClick",c),t.off("changes",u),t.off("viewportChange",h),t.off("fold",p),t.off("unfold",p),t.off("swapDoc",u),t.off("optionChange",d)),r&&(t.state.foldGutter=new n(i(r)),l(t),t.on("gutterClick",c),t.on("changes",u),t.on("viewportChange",h),t.on("fold",p),t.on("unfold",p),t.on("swapDoc",u),t.on("optionChange",d))}));var t=e.Pos;function n(e){this.options=e,this.from=this.to=0}function i(e){return!0===e&&(e={}),null==e.gutter&&(e.gutter="CodeMirror-foldgutter"),null==e.indicatorOpen&&(e.indicatorOpen="CodeMirror-foldgutter-open"),null==e.indicatorFolded&&(e.indicatorFolded="CodeMirror-foldgutter-folded"),e}function r(e,n){for(var i=e.findMarks(t(n,0),t(n+1,0)),r=0;r<i.length;++r)if(i[r].__isFold){var o=i[r].find(-1);if(o&&o.line===n)return i[r]}}function o(e){if("string"==typeof e){var t=document.createElement("div");return t.className=e+" CodeMirror-guttermarker-subtle",t}return e.cloneNode(!0)}function s(e,n,i){var s=e.state.foldGutter.options,l=n-1,c=e.foldOption(s,"minFoldSize"),d=e.foldOption(s,"rangeFinder"),u="string"==typeof s.indicatorFolded&&a(s.indicatorFolded),h="string"==typeof s.indicatorOpen&&a(s.indicatorOpen);e.eachLine(n,i,(function(n){++l;var i=null,a=n.gutterMarkers;if(a&&(a=a[s.gutter]),r(e,l)){if(u&&a&&u.test(a.className))return;i=o(s.indicatorFolded)}else{var p=t(l,0),f=d&&d(e,p);if(f&&f.to.line-f.from.line>=c){if(h&&a&&h.test(a.className))return;i=o(s.indicatorOpen)}}(i||a)&&e.setGutterMarker(n,s.gutter,i)}))}function a(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function l(e){var t=e.getViewport(),n=e.state.foldGutter;n&&(e.operation((function(){s(e,t.from,t.to)})),n.from=t.from,n.to=t.to)}function c(e,n,i){var o=e.state.foldGutter;if(o){var s=o.options;if(i==s.gutter){var a=r(e,n);a?a.clear():e.foldCode(t(n,0),s)}}}function d(e,t){"mode"==t&&u(e)}function u(e){var t=e.state.foldGutter;if(t){var n=t.options;t.from=t.to=0,clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout((function(){l(e)}),n.foldOnChangeTimeSpan||600)}}function h(e){var t=e.state.foldGutter;if(t){var n=t.options;clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout((function(){var n=e.getViewport();t.from==t.to||n.from-t.to>20||t.from-n.to>20?l(e):e.operation((function(){n.from<t.from&&(s(e,n.from,t.from),t.from=n.from),n.to>t.to&&(s(e,t.to,n.to),t.to=n.to)}))}),n.updateViewportTimeSpan||400)}}function p(e,t){var n=e.state.foldGutter;if(n){var i=t.line;i>=n.from&&i<n.to&&s(e,i,i+1)}}}(n(7323),n(5622))},2955:(e,t,n)=>{!function(e){var t="CodeMirror-lint-markers",n="CodeMirror-lint-line-";function i(t,n,i){var r=document.createElement("div");function o(t){if(!r.parentNode)return e.off(document,"mousemove",o);var n=Math.max(0,t.clientY-r.offsetHeight-5),i=Math.max(0,Math.min(t.clientX+5,r.ownerDocument.defaultView.innerWidth-r.offsetWidth));r.style.top=n+"px",r.style.left=i+"px"}return r.className="CodeMirror-lint-tooltip cm-s-"+t.options.theme,r.appendChild(i.cloneNode(!0)),t.state.lint.options.selfContain?t.getWrapperElement().appendChild(r):document.body.appendChild(r),e.on(document,"mousemove",o),o(n),null!=r.style.opacity&&(r.style.opacity=1),r}function r(e){e.parentNode&&e.parentNode.removeChild(e)}function o(e){e.parentNode&&(null==e.style.opacity&&r(e),e.style.opacity=0,setTimeout((function(){r(e)}),600))}function s(t,n,r,s){var a=i(t,n,r);function l(){e.off(s,"mouseout",l),a&&(o(a),a=null)}var c=setInterval((function(){if(a)for(var e=s;;e=e.parentNode){if(e&&11==e.nodeType&&(e=e.host),e==document.body)return;if(!e){l();break}}if(!a)return clearInterval(c)}),400);e.on(s,"mouseout",l)}function a(e,t,n){for(var i in this.marked=[],t instanceof Function&&(t={getAnnotations:t}),t&&!0!==t||(t={}),this.options={},this.linterOptions=t.options||{},l)this.options[i]=l[i];for(var i in t)l.hasOwnProperty(i)?null!=t[i]&&(this.options[i]=t[i]):t.options||(this.linterOptions[i]=t[i]);this.timeout=null,this.hasGutter=n,this.onMouseOver=function(t){S(e,t)},this.waitingFor=0}var l={highlightLines:!1,tooltips:!0,delay:500,lintOnChange:!0,getAnnotations:null,async:!1,selfContain:null,formatAnnotation:null,onUpdateLinting:null};function c(e){var n=e.state.lint;n.hasGutter&&e.clearGutter(t),n.options.highlightLines&&d(e);for(var i=0;i<n.marked.length;++i)n.marked[i].clear();n.marked.length=0}function d(e){e.eachLine((function(t){var n=t.wrapClass&&/\bCodeMirror-lint-line-\w+\b/.exec(t.wrapClass);n&&e.removeLineClass(t,"wrap",n[0])}))}function u(t,n,i,r,o){var a=document.createElement("div"),l=a;return a.className="CodeMirror-lint-marker CodeMirror-lint-marker-"+i,r&&((l=a.appendChild(document.createElement("div"))).className="CodeMirror-lint-marker CodeMirror-lint-marker-multiple"),0!=o&&e.on(l,"mouseover",(function(e){s(t,e,n,l)})),a}function h(e,t){return"error"==e?e:t}function p(e){for(var t=[],n=0;n<e.length;++n){var i=e[n],r=i.from.line;(t[r]||(t[r]=[])).push(i)}return t}function f(e){var t=e.severity;t||(t="error");var n=document.createElement("div");return n.className="CodeMirror-lint-message CodeMirror-lint-message-"+t,"undefined"!=typeof e.messageHTML?n.innerHTML=e.messageHTML:n.appendChild(document.createTextNode(e.message)),n}function g(t,n){var i=t.state.lint,r=++i.waitingFor;function o(){r=-1,t.off("change",o)}t.on("change",o),n(t.getValue(),(function(n,s){t.off("change",o),i.waitingFor==r&&(s&&n instanceof e&&(n=s),t.operation((function(){v(t,n)})))}),i.linterOptions,t)}function m(t){var n=t.state.lint;if(n){var i=n.options,r=i.getAnnotations||t.getHelper(e.Pos(0,0),"lint");if(r)if(i.async||r.async)g(t,r);else{var o=r(t.getValue(),n.linterOptions,t);if(!o)return;o.then?o.then((function(e){t.operation((function(){v(t,e)}))})):t.operation((function(){v(t,o)}))}}}function v(e,i){var r=e.state.lint;if(r){var o=r.options;c(e);for(var s=p(i),a=0;a<s.length;++a){var l=s[a];if(l){for(var d=null,g=r.hasGutter&&document.createDocumentFragment(),m=0;m<l.length;++m){var v=l[m],y=v.severity;y||(y="error"),d=h(d,y),o.formatAnnotation&&(v=o.formatAnnotation(v)),r.hasGutter&&g.appendChild(f(v)),v.to&&r.marked.push(e.markText(v.from,v.to,{className:"CodeMirror-lint-mark CodeMirror-lint-mark-"+y,__annotation:v}))}r.hasGutter&&e.setGutterMarker(a,t,u(e,g,d,l.length>1,o.tooltips)),o.highlightLines&&e.addLineClass(a,"wrap",n+d)}}o.onUpdateLinting&&o.onUpdateLinting(i,s,e)}}function y(e){var t=e.state.lint;t&&(clearTimeout(t.timeout),t.timeout=setTimeout((function(){m(e)}),t.options.delay))}function b(e,t,n){for(var i=n.target||n.srcElement,r=document.createDocumentFragment(),o=0;o<t.length;o++){var a=t[o];r.appendChild(f(a))}s(e,n,r,i)}function S(e,t){var n=t.target||t.srcElement;if(/\bCodeMirror-lint-mark-/.test(n.className)){for(var i=n.getBoundingClientRect(),r=(i.left+i.right)/2,o=(i.top+i.bottom)/2,s=e.findMarksAt(e.coordsChar({left:r,top:o},"client")),a=[],l=0;l<s.length;++l){var c=s[l].__annotation;c&&a.push(c)}a.length&&b(e,a,t)}}e.defineOption("lint",!1,(function(n,i,r){if(r&&r!=e.Init&&(c(n),!1!==n.state.lint.options.lintOnChange&&n.off("change",y),e.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver),clearTimeout(n.state.lint.timeout),delete n.state.lint),i){for(var o=n.getOption("gutters"),s=!1,l=0;l<o.length;++l)o[l]==t&&(s=!0);var d=n.state.lint=new a(n,i,s);d.options.lintOnChange&&n.on("change",y),0!=d.options.tooltips&&"gutter"!=d.options.tooltips&&e.on(n.getWrapperElement(),"mouseover",d.onMouseOver),m(n)}})),e.defineExtension("performLint",(function(){m(this)}))}(n(7323))},7323:function(e){e.exports=function(){var e=navigator.userAgent,t=navigator.platform,n=/gecko\/\d/i.test(e),i=/MSIE \d/.test(e),r=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),o=/Edge\/(\d+)/.exec(e),s=i||r||o,a=s&&(i?document.documentMode||6:+(o||r)[1]),l=!o&&/WebKit\//.test(e),c=l&&/Qt\/\d+\.\d+/.test(e),d=!o&&/Chrome\/(\d+)/.exec(e),u=d&&+d[1],h=/Opera\//.test(e),p=/Apple Computer/.test(navigator.vendor),f=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),g=/PhantomJS/.test(e),m=p&&(/Mobile\/\w+/.test(e)||navigator.maxTouchPoints>2),v=/Android/.test(e),y=m||v||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),b=m||/Mac/.test(t),S=/\bCrOS\b/.test(e),w=/win/i.test(t),x=h&&e.match(/Version\/(\d*\.\d*)/);x&&(x=Number(x[1])),x&&x>=15&&(h=!1,l=!0);var C=b&&(c||h&&(null==x||x<12.11)),k=n||s&&a>=9;function E(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var T,L=function(e,t){var n=e.className,i=E(t).exec(n);if(i){var r=n.slice(i.index+i[0].length);e.className=n.slice(0,i.index)+(r?i[1]+r:"")}};function P(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function D(e,t){return P(e).appendChild(t)}function M(e,t,n,i){var r=document.createElement(e);if(n&&(r.className=n),i&&(r.style.cssText=i),"string"==typeof t)r.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)r.appendChild(t[o]);return r}function I(e,t,n,i){var r=M(e,t,n,i);return r.setAttribute("role","presentation"),r}function R(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function A(e){var t,n=e.ownerDocument||e;try{t=e.activeElement}catch(i){t=n.body||null}for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}function O(e,t){var n=e.className;E(t).test(n)||(e.className+=(n?" ":"")+t)}function N(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)n[i]&&!E(n[i]).test(t)&&(t+=" "+n[i]);return t}T=document.createRange?function(e,t,n,i){var r=document.createRange();return r.setEnd(i||e,n),r.setStart(e,t),r}:function(e,t,n){var i=document.body.createTextRange();try{i.moveToElementText(e.parentNode)}catch(r){return i}return i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i};var _=function(e){e.select()};function V(e){return e.display.wrapper.ownerDocument}function B(e){return F(e.display.wrapper)}function F(e){return e.getRootNode?e.getRootNode():e.ownerDocument}function U(e){return V(e).defaultView}function z(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function j(e,t,n){for(var i in t||(t={}),e)!e.hasOwnProperty(i)||!1===n&&t.hasOwnProperty(i)||(t[i]=e[i]);return t}function G(e,t,n,i,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=i||0,s=r||0;;){var a=e.indexOf("\t",o);if(a<0||a>=t)return s+(t-o);s+=a-o,s+=n-s%n,o=a+1}}m?_=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:s&&(_=function(e){try{e.select()}catch(t){}});var W=function(){this.id=null,this.f=null,this.time=0,this.handler=z(this.onTimeout,this)};function H(e,t){for(var n=0;n<e.length;++n)if(e[n]==t)return n;return-1}W.prototype.onTimeout=function(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)},W.prototype.set=function(e,t){this.f=t;var n=+new Date+e;(!this.id||n<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=n)};var q=50,Y={toString:function(){return"CodeMirror.Pass"}},J={scroll:!1},K={origin:"*mouse"},X={origin:"+move"};function Z(e,t,n){for(var i=0,r=0;;){var o=e.indexOf("\t",i);-1==o&&(o=e.length);var s=o-i;if(o==e.length||r+s>=t)return i+Math.min(s,t-r);if(r+=o-i,i=o+1,(r+=n-r%n)>=t)return i}}var Q=[""];function $(e){for(;Q.length<=e;)Q.push(ee(Q)+" ");return Q[e]}function ee(e){return e[e.length-1]}function te(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=t(e[i],i);return n}function ne(e,t,n){for(var i=0,r=n(t);i<e.length&&n(e[i])<=r;)i++;e.splice(i,0,t)}function ie(){}function re(e,t){var n;return Object.create?n=Object.create(e):(ie.prototype=e,n=new ie),t&&j(t,n),n}var oe=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function se(e){return/\w/.test(e)||e>"\x80"&&(e.toUpperCase()!=e.toLowerCase()||oe.test(e))}function ae(e,t){return t?!!(t.source.indexOf("\\w")>-1&&se(e))||t.test(e):se(e)}function le(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var ce=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function de(e){return e.charCodeAt(0)>=768&&ce.test(e)}function ue(e,t,n){for(;(n<0?t>0:t<e.length)&&de(e.charAt(t));)t+=n;return t}function he(e,t,n){for(var i=t>n?-1:1;;){if(t==n)return t;var r=(t+n)/2,o=i<0?Math.ceil(r):Math.floor(r);if(o==t)return e(o)?t:n;e(o)?n=o:t=o+i}}function pe(e,t,n,i){if(!e)return i(t,n,"ltr",0);for(var r=!1,o=0;o<e.length;++o){var s=e[o];(s.from<n&&s.to>t||t==n&&s.to==t)&&(i(Math.max(s.from,t),Math.min(s.to,n),1==s.level?"rtl":"ltr",o),r=!0)}r||i(t,n,"ltr")}var fe=null;function ge(e,t,n){var i;fe=null;for(var r=0;r<e.length;++r){var o=e[r];if(o.from<t&&o.to>t)return r;o.to==t&&(o.from!=o.to&&"before"==n?i=r:fe=r),o.from==t&&(o.from!=o.to&&"before"!=n?i=r:fe=r)}return null!=i?i:fe}var me=function(){var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function n(n){return n<=247?e.charAt(n):1424<=n&&n<=1524?"R":1536<=n&&n<=1785?t.charAt(n-1536):1774<=n&&n<=2220?"r":8192<=n&&n<=8203?"w":8204==n?"b":"L"}var i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,r=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,a=/[1n]/;function l(e,t,n){this.level=e,this.from=t,this.to=n}return function(e,t){var c="ltr"==t?"L":"R";if(0==e.length||"ltr"==t&&!i.test(e))return!1;for(var d=e.length,u=[],h=0;h<d;++h)u.push(n(e.charCodeAt(h)));for(var p=0,f=c;p<d;++p){var g=u[p];"m"==g?u[p]=f:f=g}for(var m=0,v=c;m<d;++m){var y=u[m];"1"==y&&"r"==v?u[m]="n":o.test(y)&&(v=y,"r"==y&&(u[m]="R"))}for(var b=1,S=u[0];b<d-1;++b){var w=u[b];"+"==w&&"1"==S&&"1"==u[b+1]?u[b]="1":","!=w||S!=u[b+1]||"1"!=S&&"n"!=S||(u[b]=S),S=w}for(var x=0;x<d;++x){var C=u[x];if(","==C)u[x]="N";else if("%"==C){var k=void 0;for(k=x+1;k<d&&"%"==u[k];++k);for(var E=x&&"!"==u[x-1]||k<d&&"1"==u[k]?"1":"N",T=x;T<k;++T)u[T]=E;x=k-1}}for(var L=0,P=c;L<d;++L){var D=u[L];"L"==P&&"1"==D?u[L]="L":o.test(D)&&(P=D)}for(var M=0;M<d;++M)if(r.test(u[M])){var I=void 0;for(I=M+1;I<d&&r.test(u[I]);++I);for(var R="L"==(M?u[M-1]:c),A=R==("L"==(I<d?u[I]:c))?R?"L":"R":c,O=M;O<I;++O)u[O]=A;M=I-1}for(var N,_=[],V=0;V<d;)if(s.test(u[V])){var B=V;for(++V;V<d&&s.test(u[V]);++V);_.push(new l(0,B,V))}else{var F=V,U=_.length,z="rtl"==t?1:0;for(++V;V<d&&"L"!=u[V];++V);for(var j=F;j<V;)if(a.test(u[j])){F<j&&(_.splice(U,0,new l(1,F,j)),U+=z);var G=j;for(++j;j<V&&a.test(u[j]);++j);_.splice(U,0,new l(2,G,j)),U+=z,F=j}else++j;F<V&&_.splice(U,0,new l(1,F,V))}return"ltr"==t&&(1==_[0].level&&(N=e.match(/^\s+/))&&(_[0].from=N[0].length,_.unshift(new l(0,0,N[0].length))),1==ee(_).level&&(N=e.match(/\s+$/))&&(ee(_).to-=N[0].length,_.push(new l(0,d-N[0].length,d)))),"rtl"==t?_.reverse():_}}();function ve(e,t){var n=e.order;return null==n&&(n=e.order=me(e.text,t)),n}var ye=[],be=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var i=e._handlers||(e._handlers={});i[t]=(i[t]||ye).concat(n)}};function Se(e,t){return e._handlers&&e._handlers[t]||ye}function we(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var i=e._handlers,r=i&&i[t];if(r){var o=H(r,n);o>-1&&(i[t]=r.slice(0,o).concat(r.slice(o+1)))}}}function xe(e,t){var n=Se(e,t);if(n.length)for(var i=Array.prototype.slice.call(arguments,2),r=0;r<n.length;++r)n[r].apply(null,i)}function Ce(e,t,n){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),xe(e,n||t.type,e,t),De(t)||t.codemirrorIgnore}function ke(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var n=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),i=0;i<t.length;++i)-1==H(n,t[i])&&n.push(t[i])}function Ee(e,t){return Se(e,t).length>0}function Te(e){e.prototype.on=function(e,t){be(this,e,t)},e.prototype.off=function(e,t){we(this,e,t)}}function Le(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Pe(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function De(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Me(e){Le(e),Pe(e)}function Ie(e){return e.target||e.srcElement}function Re(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),b&&e.ctrlKey&&1==t&&(t=3),t}var Ae,Oe,Ne=function(){if(s&&a<9)return!1;var e=M("div");return"draggable"in e||"dragDrop"in e}();function _e(e){if(null==Ae){var t=M("span","\u200b");D(e,M("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Ae=t.offsetWidth<=1&&t.offsetHeight>2&&!(s&&a<8))}var n=Ae?M("span","\u200b"):M("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px");return n.setAttribute("cm-text",""),n}function Ve(e){if(null!=Oe)return Oe;var t=D(e,document.createTextNode("A\u062eA")),n=T(t,0,1).getBoundingClientRect(),i=T(t,1,2).getBoundingClientRect();return P(e),!(!n||n.left==n.right)&&(Oe=i.right-n.right<3)}var Be=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,n=[],i=e.length;t<=i;){var r=e.indexOf("\n",t);-1==r&&(r=e.length);var o=e.slice(t,"\r"==e.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(n.push(o.slice(0,s)),t+=s+1):(n.push(o),t=r+1)}return n}:function(e){return e.split(/\r\n?|\n/)},Fe=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(n){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},Ue=function(){var e=M("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),ze=null;function je(e){if(null!=ze)return ze;var t=D(e,M("span","x")),n=t.getBoundingClientRect(),i=T(t,0,1).getBoundingClientRect();return ze=Math.abs(n.left-i.left)>1}var Ge={},We={};function He(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),Ge[e]=t}function qe(e,t){We[e]=t}function Ye(e){if("string"==typeof e&&We.hasOwnProperty(e))e=We[e];else if(e&&"string"==typeof e.name&&We.hasOwnProperty(e.name)){var t=We[e.name];"string"==typeof t&&(t={name:t}),(e=re(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ye("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ye("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Je(e,t){t=Ye(t);var n=Ge[t.name];if(!n)return Je(e,"text/plain");var i=n(e,t);if(Ke.hasOwnProperty(t.name)){var r=Ke[t.name];for(var o in r)r.hasOwnProperty(o)&&(i.hasOwnProperty(o)&&(i["_"+o]=i[o]),i[o]=r[o])}if(i.name=t.name,t.helperType&&(i.helperType=t.helperType),t.modeProps)for(var s in t.modeProps)i[s]=t.modeProps[s];return i}var Ke={};function Xe(e,t){j(t,Ke.hasOwnProperty(e)?Ke[e]:Ke[e]={})}function Ze(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var n={};for(var i in t){var r=t[i];r instanceof Array&&(r=r.concat([])),n[i]=r}return n}function Qe(e,t){for(var n;e.innerMode&&(n=e.innerMode(t))&&n.mode!=e;)t=n.state,e=n.mode;return n||{mode:e,state:t}}function $e(e,t,n){return!e.startState||e.startState(t,n)}var et=function(e,t,n){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=n};function tt(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var n=e;!n.lines;)for(var i=0;;++i){var r=n.children[i],o=r.chunkSize();if(t<o){n=r;break}t-=o}return n.lines[t]}function nt(e,t,n){var i=[],r=t.line;return e.iter(t.line,n.line+1,(function(e){var o=e.text;r==n.line&&(o=o.slice(0,n.ch)),r==t.line&&(o=o.slice(t.ch)),i.push(o),++r})),i}function it(e,t,n){var i=[];return e.iter(t,n,(function(e){i.push(e.text)})),i}function rt(e,t){var n=t-e.height;if(n)for(var i=e;i;i=i.parent)i.height+=n}function ot(e){if(null==e.parent)return null;for(var t=e.parent,n=H(t.lines,e),i=t.parent;i;t=i,i=i.parent)for(var r=0;i.children[r]!=t;++r)n+=i.children[r].chunkSize();return n+t.first}function st(e,t){var n=e.first;e:do{for(var i=0;i<e.children.length;++i){var r=e.children[i],o=r.height;if(t<o){e=r;continue e}t-=o,n+=r.chunkSize()}return n}while(!e.lines);for(var s=0;s<e.lines.length;++s){var a=e.lines[s].height;if(t<a)break;t-=a}return n+s}function at(e,t){return t>=e.first&&t<e.first+e.size}function lt(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function ct(e,t,n){if(void 0===n&&(n=null),!(this instanceof ct))return new ct(e,t,n);this.line=e,this.ch=t,this.sticky=n}function dt(e,t){return e.line-t.line||e.ch-t.ch}function ut(e,t){return e.sticky==t.sticky&&0==dt(e,t)}function ht(e){return ct(e.line,e.ch)}function pt(e,t){return dt(e,t)<0?t:e}function ft(e,t){return dt(e,t)<0?e:t}function gt(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function mt(e,t){if(t.line<e.first)return ct(e.first,0);var n=e.first+e.size-1;return t.line>n?ct(n,tt(e,n).text.length):vt(t,tt(e,t.line).text.length)}function vt(e,t){var n=e.ch;return null==n||n>t?ct(e.line,t):n<0?ct(e.line,0):e}function yt(e,t){for(var n=[],i=0;i<t.length;i++)n[i]=mt(e,t[i]);return n}et.prototype.eol=function(){return this.pos>=this.string.length},et.prototype.sol=function(){return this.pos==this.lineStart},et.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},et.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},et.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},et.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},et.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},et.prototype.skipToEnd=function(){this.pos=this.string.length},et.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},et.prototype.backUp=function(e){this.pos-=e},et.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=G(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?G(this.string,this.lineStart,this.tabSize):0)},et.prototype.indentation=function(){return G(this.string,null,this.tabSize)-(this.lineStart?G(this.string,this.lineStart,this.tabSize):0)},et.prototype.match=function(e,t,n){if("string"!=typeof e){var i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&!1!==t&&(this.pos+=i[0].length),i)}var r=function(e){return n?e.toLowerCase():e};if(r(this.string.substr(this.pos,e.length))==r(e))return!1!==t&&(this.pos+=e.length),!0},et.prototype.current=function(){return this.string.slice(this.start,this.pos)},et.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},et.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},et.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};var bt=function(e,t){this.state=e,this.lookAhead=t},St=function(e,t,n,i){this.state=t,this.doc=e,this.line=n,this.maxLookAhead=i||0,this.baseTokens=null,this.baseTokenPos=1};function wt(e,t,n,i){var r=[e.state.modeGen],o={};Mt(e,t.text,e.doc.mode,n,(function(e,t){return r.push(e,t)}),o,i);for(var s=n.state,a=function(i){n.baseTokens=r;var a=e.state.overlays[i],l=1,c=0;n.state=!0,Mt(e,t.text,a.mode,n,(function(e,t){for(var n=l;c<e;){var i=r[l];i>e&&r.splice(l,1,e,r[l+1],i),l+=2,c=Math.min(e,i)}if(t)if(a.opaque)r.splice(n,l-n,e,"overlay "+t),l=n+2;else for(;n<l;n+=2){var o=r[n+1];r[n+1]=(o?o+" ":"")+"overlay "+t}}),o),n.state=s,n.baseTokens=null,n.baseTokenPos=1},l=0;l<e.state.overlays.length;++l)a(l);return{styles:r,classes:o.bgClass||o.textClass?o:null}}function xt(e,t,n){if(!t.styles||t.styles[0]!=e.state.modeGen){var i=Ct(e,ot(t)),r=t.text.length>e.options.maxHighlightLength&&Ze(e.doc.mode,i.state),o=wt(e,t,i);r&&(i.state=r),t.stateAfter=i.save(!r),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),n===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function Ct(e,t,n){var i=e.doc,r=e.display;if(!i.mode.startState)return new St(i,!0,t);var o=It(e,t,n),s=o>i.first&&tt(i,o-1).stateAfter,a=s?St.fromSaved(i,s,o):new St(i,$e(i.mode),o);return i.iter(o,t,(function(n){kt(e,n.text,a);var i=a.line;n.stateAfter=i==t-1||i%5==0||i>=r.viewFrom&&i<r.viewTo?a.save():null,a.nextLine()})),n&&(i.modeFrontier=a.line),a}function kt(e,t,n,i){var r=e.doc.mode,o=new et(t,e.options.tabSize,n);for(o.start=o.pos=i||0,""==t&&Et(r,n.state);!o.eol();)Tt(r,o,n.state),o.start=o.pos}function Et(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var n=Qe(e,t);return n.mode.blankLine?n.mode.blankLine(n.state):void 0}}function Tt(e,t,n,i){for(var r=0;r<10;r++){i&&(i[0]=Qe(e,n).mode);var o=e.token(t,n);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}St.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},St.prototype.baseToken=function(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},St.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},St.fromSaved=function(e,t,n){return t instanceof bt?new St(e,Ze(e.mode,t.state),n,t.lookAhead):new St(e,Ze(e.mode,t),n)},St.prototype.save=function(e){var t=!1!==e?Ze(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new bt(t,this.maxLookAhead):t};var Lt=function(e,t,n){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=n};function Pt(e,t,n,i){var r,o,s=e.doc,a=s.mode,l=tt(s,(t=mt(s,t)).line),c=Ct(e,t.line,n),d=new et(l.text,e.options.tabSize,c);for(i&&(o=[]);(i||d.pos<t.ch)&&!d.eol();)d.start=d.pos,r=Tt(a,d,c.state),i&&o.push(new Lt(d,r,Ze(s.mode,c.state)));return i?o:new Lt(d,r,c.state)}function Dt(e,t){if(e)for(;;){var n=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!n)break;e=e.slice(0,n.index)+e.slice(n.index+n[0].length);var i=n[1]?"bgClass":"textClass";null==t[i]?t[i]=n[2]:new RegExp("(?:^|\\s)"+n[2]+"(?:$|\\s)").test(t[i])||(t[i]+=" "+n[2])}return e}function Mt(e,t,n,i,r,o,s){var a=n.flattenSpans;null==a&&(a=e.options.flattenSpans);var l,c=0,d=null,u=new et(t,e.options.tabSize,i),h=e.options.addModeClass&&[null];for(""==t&&Dt(Et(n,i.state),o);!u.eol();){if(u.pos>e.options.maxHighlightLength?(a=!1,s&&kt(e,t,i,u.pos),u.pos=t.length,l=null):l=Dt(Tt(n,u,i.state,h),o),h){var p=h[0].name;p&&(l="m-"+(l?p+" "+l:p))}if(!a||d!=l){for(;c<u.start;)r(c=Math.min(u.start,c+5e3),d);d=l}u.start=u.pos}for(;c<u.pos;){var f=Math.min(u.pos,c+5e3);r(f,d),c=f}}function It(e,t,n){for(var i,r,o=e.doc,s=n?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>s;--a){if(a<=o.first)return o.first;var l=tt(o,a-1),c=l.stateAfter;if(c&&(!n||a+(c instanceof bt?c.lookAhead:0)<=o.modeFrontier))return a;var d=G(l.text,null,e.options.tabSize);(null==r||i>d)&&(r=a-1,i=d)}return r}function Rt(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var n=e.first,i=t-1;i>n;i--){var r=tt(e,i).stateAfter;if(r&&(!(r instanceof bt)||i+r.lookAhead<t)){n=i+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,n)}}var At=!1,Ot=!1;function Nt(){At=!0}function _t(){Ot=!0}function Vt(e,t,n){this.marker=e,this.from=t,this.to=n}function Bt(e,t){if(e)for(var n=0;n<e.length;++n){var i=e[n];if(i.marker==t)return i}}function Ft(e,t){for(var n,i=0;i<e.length;++i)e[i]!=t&&(n||(n=[])).push(e[i]);return n}function Ut(e,t,n){var i=n&&window.WeakSet&&(n.markedSpans||(n.markedSpans=new WeakSet));i&&e.markedSpans&&i.has(e.markedSpans)?e.markedSpans.push(t):(e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],i&&i.add(e.markedSpans)),t.marker.attachLine(e)}function zt(e,t,n){var i;if(e)for(var r=0;r<e.length;++r){var o=e[r],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==s.type&&(!n||!o.marker.insertLeft)){var a=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(i||(i=[])).push(new Vt(s,o.from,a?null:o.to))}}return i}function jt(e,t,n){var i;if(e)for(var r=0;r<e.length;++r){var o=e[r],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==s.type&&(!n||o.marker.insertLeft)){var a=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(i||(i=[])).push(new Vt(s,a?null:o.from-t,null==o.to?null:o.to-t))}}return i}function Gt(e,t){if(t.full)return null;var n=at(e,t.from.line)&&tt(e,t.from.line).markedSpans,i=at(e,t.to.line)&&tt(e,t.to.line).markedSpans;if(!n&&!i)return null;var r=t.from.ch,o=t.to.ch,s=0==dt(t.from,t.to),a=zt(n,r,s),l=jt(i,o,s),c=1==t.text.length,d=ee(t.text).length+(c?r:0);if(a)for(var u=0;u<a.length;++u){var h=a[u];if(null==h.to){var p=Bt(l,h.marker);p?c&&(h.to=null==p.to?null:p.to+d):h.to=r}}if(l)for(var f=0;f<l.length;++f){var g=l[f];null!=g.to&&(g.to+=d),null==g.from?Bt(a,g.marker)||(g.from=d,c&&(a||(a=[])).push(g)):(g.from+=d,c&&(a||(a=[])).push(g))}a&&(a=Wt(a)),l&&l!=a&&(l=Wt(l));var m=[a];if(!c){var v,y=t.text.length-2;if(y>0&&a)for(var b=0;b<a.length;++b)null==a[b].to&&(v||(v=[])).push(new Vt(a[b].marker,null,null));for(var S=0;S<y;++S)m.push(v);m.push(l)}return m}function Wt(e){for(var t=0;t<e.length;++t){var n=e[t];null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Ht(e,t,n){var i=null;if(e.iter(t.line,n.line+1,(function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;!n.readOnly||i&&-1!=H(i,n)||(i||(i=[])).push(n)}})),!i)return null;for(var r=[{from:t,to:n}],o=0;o<i.length;++o)for(var s=i[o],a=s.find(0),l=0;l<r.length;++l){var c=r[l];if(!(dt(c.to,a.from)<0||dt(c.from,a.to)>0)){var d=[l,1],u=dt(c.from,a.from),h=dt(c.to,a.to);(u<0||!s.inclusiveLeft&&!u)&&d.push({from:c.from,to:a.from}),(h>0||!s.inclusiveRight&&!h)&&d.push({from:a.to,to:c.to}),r.splice.apply(r,d),l+=d.length-3}}return r}function qt(e){var t=e.markedSpans;if(t){for(var n=0;n<t.length;++n)t[n].marker.detachLine(e);e.markedSpans=null}}function Yt(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function Jt(e){return e.inclusiveLeft?-1:0}function Kt(e){return e.inclusiveRight?1:0}function Xt(e,t){var n=e.lines.length-t.lines.length;if(0!=n)return n;var i=e.find(),r=t.find(),o=dt(i.from,r.from)||Jt(e)-Jt(t);if(o)return-o;var s=dt(i.to,r.to)||Kt(e)-Kt(t);return s||t.id-e.id}function Zt(e,t){var n,i=Ot&&e.markedSpans;if(i)for(var r=void 0,o=0;o<i.length;++o)(r=i[o]).marker.collapsed&&null==(t?r.from:r.to)&&(!n||Xt(n,r.marker)<0)&&(n=r.marker);return n}function Qt(e){return Zt(e,!0)}function $t(e){return Zt(e,!1)}function en(e,t){var n,i=Ot&&e.markedSpans;if(i)for(var r=0;r<i.length;++r){var o=i[r];o.marker.collapsed&&(null==o.from||o.from<t)&&(null==o.to||o.to>t)&&(!n||Xt(n,o.marker)<0)&&(n=o.marker)}return n}function tn(e,t,n,i,r){var o=tt(e,t),s=Ot&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),d=dt(c.from,n)||Jt(l.marker)-Jt(r),u=dt(c.to,i)||Kt(l.marker)-Kt(r);if(!(d>=0&&u<=0||d<=0&&u>=0)&&(d<=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?dt(c.to,n)>=0:dt(c.to,n)>0)||d>=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?dt(c.from,i)<=0:dt(c.from,i)<0)))return!0}}}function nn(e){for(var t;t=Qt(e);)e=t.find(-1,!0).line;return e}function rn(e){for(var t;t=$t(e);)e=t.find(1,!0).line;return e}function on(e){for(var t,n;t=$t(e);)e=t.find(1,!0).line,(n||(n=[])).push(e);return n}function sn(e,t){var n=tt(e,t),i=nn(n);return n==i?t:ot(i)}function an(e,t){if(t>e.lastLine())return t;var n,i=tt(e,t);if(!ln(e,i))return t;for(;n=$t(i);)i=n.find(1,!0).line;return ot(i)+1}function ln(e,t){var n=Ot&&t.markedSpans;if(n)for(var i=void 0,r=0;r<n.length;++r)if((i=n[r]).marker.collapsed){if(null==i.from)return!0;if(!i.marker.widgetNode&&0==i.from&&i.marker.inclusiveLeft&&cn(e,t,i))return!0}}function cn(e,t,n){if(null==n.to){var i=n.marker.find(1,!0);return cn(e,i.line,Bt(i.line.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==t.text.length)return!0;for(var r=void 0,o=0;o<t.markedSpans.length;++o)if((r=t.markedSpans[o]).marker.collapsed&&!r.marker.widgetNode&&r.from==n.to&&(null==r.to||r.to!=n.from)&&(r.marker.inclusiveLeft||n.marker.inclusiveRight)&&cn(e,t,r))return!0}function dn(e){for(var t=0,n=(e=nn(e)).parent,i=0;i<n.lines.length;++i){var r=n.lines[i];if(r==e)break;t+=r.height}for(var o=n.parent;o;o=(n=o).parent)for(var s=0;s<o.children.length;++s){var a=o.children[s];if(a==n)break;t+=a.height}return t}function un(e){if(0==e.height)return 0;for(var t,n=e.text.length,i=e;t=Qt(i);){var r=t.find(0,!0);i=r.from.line,n+=r.from.ch-r.to.ch}for(i=e;t=$t(i);){var o=t.find(0,!0);n-=i.text.length-o.from.ch,n+=(i=o.to.line).text.length-o.to.ch}return n}function hn(e){var t=e.display,n=e.doc;t.maxLine=tt(n,n.first),t.maxLineLength=un(t.maxLine),t.maxLineChanged=!0,n.iter((function(e){var n=un(e);n>t.maxLineLength&&(t.maxLineLength=n,t.maxLine=e)}))}var pn=function(e,t,n){this.text=e,Yt(this,t),this.height=n?n(this):1};function fn(e,t,n,i){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),qt(e),Yt(e,n);var r=i?i(e):1;r!=e.height&&rt(e,r)}function gn(e){e.parent=null,qt(e)}pn.prototype.lineNo=function(){return ot(this)},Te(pn);var mn={},vn={};function yn(e,t){if(!e||/^\s*$/.test(e))return null;var n=t.addModeClass?vn:mn;return n[e]||(n[e]=e.replace(/\S+/g,"cm-$&"))}function bn(e,t){var n=I("span",null,null,l?"padding-right: .1px":null),i={pre:I("pre",[n],"CodeMirror-line"),content:n,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var r=0;r<=(t.rest?t.rest.length:0);r++){var o=r?t.rest[r-1]:t.line,s=void 0;i.pos=0,i.addToken=wn,Ve(e.display.measure)&&(s=ve(o,e.doc.direction))&&(i.addToken=Cn(i.addToken,s)),i.map=[],En(o,i,xt(e,o,t!=e.display.externalMeasured&&ot(o))),o.styleClasses&&(o.styleClasses.bgClass&&(i.bgClass=N(o.styleClasses.bgClass,i.bgClass||"")),o.styleClasses.textClass&&(i.textClass=N(o.styleClasses.textClass,i.textClass||""))),0==i.map.length&&i.map.push(0,0,i.content.appendChild(_e(e.display.measure))),0==r?(t.measure.map=i.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(i.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(l){var a=i.content.lastChild;(/\bcm-tab\b/.test(a.className)||a.querySelector&&a.querySelector(".cm-tab"))&&(i.content.className="cm-tab-wrap-hack")}return xe(e,"renderLine",e,t.line,i.pre),i.pre.className&&(i.textClass=N(i.pre.className,i.textClass||"")),i}function Sn(e){var t=M("span","\u2022","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function wn(e,t,n,i,r,o,l){if(t){var c,d=e.splitSpaces?xn(t,e.trailingSpace):t,u=e.cm.state.specialChars,h=!1;if(u.test(t)){c=document.createDocumentFragment();for(var p=0;;){u.lastIndex=p;var f=u.exec(t),g=f?f.index-p:t.length-p;if(g){var m=document.createTextNode(d.slice(p,p+g));s&&a<9?c.appendChild(M("span",[m])):c.appendChild(m),e.map.push(e.pos,e.pos+g,m),e.col+=g,e.pos+=g}if(!f)break;p+=g+1;var v=void 0;if("\t"==f[0]){var y=e.cm.options.tabSize,b=y-e.col%y;(v=c.appendChild(M("span",$(b),"cm-tab"))).setAttribute("role","presentation"),v.setAttribute("cm-text","\t"),e.col+=b}else"\r"==f[0]||"\n"==f[0]?((v=c.appendChild(M("span","\r"==f[0]?"\u240d":"\u2424","cm-invalidchar"))).setAttribute("cm-text",f[0]),e.col+=1):((v=e.cm.options.specialCharPlaceholder(f[0])).setAttribute("cm-text",f[0]),s&&a<9?c.appendChild(M("span",[v])):c.appendChild(v),e.col+=1);e.map.push(e.pos,e.pos+1,v),e.pos++}}else e.col+=t.length,c=document.createTextNode(d),e.map.push(e.pos,e.pos+t.length,c),s&&a<9&&(h=!0),e.pos+=t.length;if(e.trailingSpace=32==d.charCodeAt(t.length-1),n||i||r||h||o||l){var S=n||"";i&&(S+=i),r&&(S+=r);var w=M("span",[c],S,o);if(l)for(var x in l)l.hasOwnProperty(x)&&"style"!=x&&"class"!=x&&w.setAttribute(x,l[x]);return e.content.appendChild(w)}e.content.appendChild(c)}}function xn(e,t){if(e.length>1&&!/  /.test(e))return e;for(var n=t,i="",r=0;r<e.length;r++){var o=e.charAt(r);" "!=o||!n||r!=e.length-1&&32!=e.charCodeAt(r+1)||(o="\xa0"),i+=o,n=" "==o}return i}function Cn(e,t){return function(n,i,r,o,s,a,l){r=r?r+" cm-force-border":"cm-force-border";for(var c=n.pos,d=c+i.length;;){for(var u=void 0,h=0;h<t.length&&!((u=t[h]).to>c&&u.from<=c);h++);if(u.to>=d)return e(n,i,r,o,s,a,l);e(n,i.slice(0,u.to-c),r,o,null,a,l),o=null,i=i.slice(u.to-c),c=u.to}}}function kn(e,t,n,i){var r=!i&&n.widgetNode;r&&e.map.push(e.pos,e.pos+t,r),!i&&e.cm.display.input.needsContentAttribute&&(r||(r=e.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",n.id)),r&&(e.cm.display.input.setUneditable(r),e.content.appendChild(r)),e.pos+=t,e.trailingSpace=!1}function En(e,t,n){var i=e.markedSpans,r=e.text,o=0;if(i)for(var s,a,l,c,d,u,h,p=r.length,f=0,g=1,m="",v=0;;){if(v==f){l=c=d=a="",h=null,u=null,v=1/0;for(var y=[],b=void 0,S=0;S<i.length;++S){var w=i[S],x=w.marker;if("bookmark"==x.type&&w.from==f&&x.widgetNode)y.push(x);else if(w.from<=f&&(null==w.to||w.to>f||x.collapsed&&w.to==f&&w.from==f)){if(null!=w.to&&w.to!=f&&v>w.to&&(v=w.to,c=""),x.className&&(l+=" "+x.className),x.css&&(a=(a?a+";":"")+x.css),x.startStyle&&w.from==f&&(d+=" "+x.startStyle),x.endStyle&&w.to==v&&(b||(b=[])).push(x.endStyle,w.to),x.title&&((h||(h={})).title=x.title),x.attributes)for(var C in x.attributes)(h||(h={}))[C]=x.attributes[C];x.collapsed&&(!u||Xt(u.marker,x)<0)&&(u=w)}else w.from>f&&v>w.from&&(v=w.from)}if(b)for(var k=0;k<b.length;k+=2)b[k+1]==v&&(c+=" "+b[k]);if(!u||u.from==f)for(var E=0;E<y.length;++E)kn(t,0,y[E]);if(u&&(u.from||0)==f){if(kn(t,(null==u.to?p+1:u.to)-f,u.marker,null==u.from),null==u.to)return;u.to==f&&(u=!1)}}if(f>=p)break;for(var T=Math.min(p,v);;){if(m){var L=f+m.length;if(!u){var P=L>T?m.slice(0,T-f):m;t.addToken(t,P,s?s+l:l,d,f+P.length==v?c:"",a,h)}if(L>=T){m=m.slice(T-f),f=T;break}f=L,d=""}m=r.slice(o,o=n[g++]),s=yn(n[g++],t.cm.options)}}else for(var D=1;D<n.length;D+=2)t.addToken(t,r.slice(o,o=n[D]),yn(n[D+1],t.cm.options))}function Tn(e,t,n){this.line=t,this.rest=on(t),this.size=this.rest?ot(ee(this.rest))-n+1:1,this.node=this.text=null,this.hidden=ln(e,t)}function Ln(e,t,n){for(var i,r=[],o=t;o<n;o=i){var s=new Tn(e.doc,tt(e.doc,o),o);i=o+s.size,r.push(s)}return r}var Pn=null;function Dn(e){Pn?Pn.ops.push(e):e.ownsGroup=Pn={ops:[e],delayedCallbacks:[]}}function Mn(e){var t=e.delayedCallbacks,n=0;do{for(;n<t.length;n++)t[n].call(null);for(var i=0;i<e.ops.length;i++){var r=e.ops[i];if(r.cursorActivityHandlers)for(;r.cursorActivityCalled<r.cursorActivityHandlers.length;)r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}while(n<t.length)}function In(e,t){var n=e.ownsGroup;if(n)try{Mn(n)}finally{Pn=null,t(n)}}var Rn=null;function An(e,t){var n=Se(e,t);if(n.length){var i,r=Array.prototype.slice.call(arguments,2);Pn?i=Pn.delayedCallbacks:Rn?i=Rn:(i=Rn=[],setTimeout(On,0));for(var o=function(e){i.push((function(){return n[e].apply(null,r)}))},s=0;s<n.length;++s)o(s)}}function On(){var e=Rn;Rn=null;for(var t=0;t<e.length;++t)e[t]()}function Nn(e,t,n,i){for(var r=0;r<t.changes.length;r++){var o=t.changes[r];"text"==o?Fn(e,t):"gutter"==o?zn(e,t,n,i):"class"==o?Un(e,t):"widget"==o&&jn(e,t,i)}t.changes=null}function _n(e){return e.node==e.text&&(e.node=M("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),s&&a<8&&(e.node.style.zIndex=2)),e.node}function Vn(e,t){var n=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(n&&(n+=" CodeMirror-linebackground"),t.background)n?t.background.className=n:(t.background.parentNode.removeChild(t.background),t.background=null);else if(n){var i=_n(t);t.background=i.insertBefore(M("div",null,n),i.firstChild),e.display.input.setUneditable(t.background)}}function Bn(e,t){var n=e.display.externalMeasured;return n&&n.line==t.line?(e.display.externalMeasured=null,t.measure=n.measure,n.built):bn(e,t)}function Fn(e,t){var n=t.text.className,i=Bn(e,t);t.text==t.node&&(t.node=i.pre),t.text.parentNode.replaceChild(i.pre,t.text),t.text=i.pre,i.bgClass!=t.bgClass||i.textClass!=t.textClass?(t.bgClass=i.bgClass,t.textClass=i.textClass,Un(e,t)):n&&(t.text.className=n)}function Un(e,t){Vn(e,t),t.line.wrapClass?_n(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var n=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=n||""}function zn(e,t,n,i){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var r=_n(t);t.gutterBackground=M("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px; width: "+i.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),r.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var s=_n(t),a=t.gutter=M("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px");if(a.setAttribute("aria-hidden","true"),e.display.input.setUneditable(a),s.insertBefore(a,t.text),t.line.gutterClass&&(a.className+=" "+t.line.gutterClass),!e.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(M("div",lt(e.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var l=0;l<e.display.gutterSpecs.length;++l){var c=e.display.gutterSpecs[l].className,d=o.hasOwnProperty(c)&&o[c];d&&a.appendChild(M("div",[d],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}}function jn(e,t,n){t.alignable&&(t.alignable=null);for(var i=E("CodeMirror-linewidget"),r=t.node.firstChild,o=void 0;r;r=o)o=r.nextSibling,i.test(r.className)&&t.node.removeChild(r);Wn(e,t,n)}function Gn(e,t,n,i){var r=Bn(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),Un(e,t),zn(e,t,n,i),Wn(e,t,i),t.node}function Wn(e,t,n){if(Hn(e,t.line,t,n,!0),t.rest)for(var i=0;i<t.rest.length;i++)Hn(e,t.rest[i],t,n,!1)}function Hn(e,t,n,i,r){if(t.widgets)for(var o=_n(n),s=0,a=t.widgets;s<a.length;++s){var l=a[s],c=M("div",[l.node],"CodeMirror-linewidget"+(l.className?" "+l.className:""));l.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),qn(l,c,n,i),e.display.input.setUneditable(c),r&&l.above?o.insertBefore(c,n.gutter||n.text):o.appendChild(c),An(l,"redraw")}}function qn(e,t,n,i){if(e.noHScroll){(n.alignable||(n.alignable=[])).push(t);var r=i.wrapperWidth;t.style.left=i.fixedPos+"px",e.coverGutter||(r-=i.gutterTotalWidth,t.style.paddingLeft=i.gutterTotalWidth+"px"),t.style.width=r+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-i.gutterTotalWidth+"px"))}function Yn(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!R(document.body,e.node)){var n="position: relative;";e.coverGutter&&(n+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(n+="width: "+t.display.wrapper.clientWidth+"px;"),D(t.display.measure,M("div",[e.node],null,n))}return e.height=e.node.parentNode.offsetHeight}function Jn(e,t){for(var n=Ie(t);n!=e.wrapper;n=n.parentNode)if(!n||1==n.nodeType&&"true"==n.getAttribute("cm-ignore-events")||n.parentNode==e.sizer&&n!=e.mover)return!0}function Kn(e){return e.lineSpace.offsetTop}function Xn(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Zn(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=D(e.measure,M("pre","x","CodeMirror-line-like")),n=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,i={left:parseInt(n.paddingLeft),right:parseInt(n.paddingRight)};return isNaN(i.left)||isNaN(i.right)||(e.cachedPaddingH=i),i}function Qn(e){return q-e.display.nativeBarWidth}function $n(e){return e.display.scroller.clientWidth-Qn(e)-e.display.barWidth}function ei(e){return e.display.scroller.clientHeight-Qn(e)-e.display.barHeight}function ti(e,t,n){var i=e.options.lineWrapping,r=i&&$n(e);if(!t.measure.heights||i&&t.measure.width!=r){var o=t.measure.heights=[];if(i){t.measure.width=r;for(var s=t.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-n.top)}}o.push(n.bottom-n.top)}}function ni(e,t,n){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};if(e.rest){for(var i=0;i<e.rest.length;i++)if(e.rest[i]==t)return{map:e.measure.maps[i],cache:e.measure.caches[i]};for(var r=0;r<e.rest.length;r++)if(ot(e.rest[r])>n)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}}function ii(e,t){var n=ot(t=nn(t)),i=e.display.externalMeasured=new Tn(e.doc,t,n);i.lineN=n;var r=i.built=bn(e,i);return i.text=r.pre,D(e.display.lineMeasure,r.pre),i}function ri(e,t,n,i){return ai(e,si(e,t),n,i)}function oi(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Ui(e,t)];var n=e.display.externalMeasured;return n&&t>=n.lineN&&t<n.lineN+n.size?n:void 0}function si(e,t){var n=ot(t),i=oi(e,n);i&&!i.text?i=null:i&&i.changes&&(Nn(e,i,n,Ni(e)),e.curOp.forceUpdate=!0),i||(i=ii(e,t));var r=ni(i,t,n);return{line:t,view:i,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function ai(e,t,n,i,r){t.before&&(n=-1);var o,s=n+(i||"");return t.cache.hasOwnProperty(s)?o=t.cache[s]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(ti(e,t.view,t.rect),t.hasHeights=!0),(o=hi(e,t,n,i)).bogus||(t.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}var li,ci={left:0,right:0,top:0,bottom:0};function di(e,t,n){for(var i,r,o,s,a,l,c=0;c<e.length;c+=3)if(a=e[c],l=e[c+1],t<a?(r=0,o=1,s="left"):t<l?o=1+(r=t-a):(c==e.length-3||t==l&&e[c+3]>t)&&(r=(o=l-a)-1,t>=l&&(s="right")),null!=r){if(i=e[c+2],a==l&&n==(i.insertLeft?"left":"right")&&(s=n),"left"==n&&0==r)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)i=e[2+(c-=3)],s="left";if("right"==n&&r==l-a)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)i=e[(c+=3)+2],s="right";break}return{node:i,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function ui(e,t){var n=ci;if("left"==t)for(var i=0;i<e.length&&(n=e[i]).left==n.right;i++);else for(var r=e.length-1;r>=0&&(n=e[r]).left==n.right;r--);return n}function hi(e,t,n,i){var r,o=di(t.map,n,i),l=o.node,c=o.start,d=o.end,u=o.collapse;if(3==l.nodeType){for(var h=0;h<4;h++){for(;c&&de(t.line.text.charAt(o.coverStart+c));)--c;for(;o.coverStart+d<o.coverEnd&&de(t.line.text.charAt(o.coverStart+d));)++d;if((r=s&&a<9&&0==c&&d==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():ui(T(l,c,d).getClientRects(),i)).left||r.right||0==c)break;d=c,c-=1,u="right"}s&&a<11&&(r=pi(e.display.measure,r))}else{var p;c>0&&(u=i="right"),r=e.options.lineWrapping&&(p=l.getClientRects()).length>1?p["right"==i?p.length-1:0]:l.getBoundingClientRect()}if(s&&a<9&&!c&&(!r||!r.left&&!r.right)){var f=l.parentNode.getClientRects()[0];r=f?{left:f.left,right:f.left+Oi(e.display),top:f.top,bottom:f.bottom}:ci}for(var g=r.top-t.rect.top,m=r.bottom-t.rect.top,v=(g+m)/2,y=t.view.measure.heights,b=0;b<y.length-1&&!(v<y[b]);b++);var S=b?y[b-1]:0,w=y[b],x={left:("right"==u?r.right:r.left)-t.rect.left,right:("left"==u?r.left:r.right)-t.rect.left,top:S,bottom:w};return r.left||r.right||(x.bogus=!0),e.options.singleCursorHeightPerLine||(x.rtop=g,x.rbottom=m),x}function pi(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!je(e))return t;var n=screen.logicalXDPI/screen.deviceXDPI,i=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*n,right:t.right*n,top:t.top*i,bottom:t.bottom*i}}function fi(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function gi(e){e.display.externalMeasure=null,P(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)fi(e.display.view[t])}function mi(e){gi(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function vi(e){return d&&v?-(e.body.getBoundingClientRect().left-parseInt(getComputedStyle(e.body).marginLeft)):e.defaultView.pageXOffset||(e.documentElement||e.body).scrollLeft}function yi(e){return d&&v?-(e.body.getBoundingClientRect().top-parseInt(getComputedStyle(e.body).marginTop)):e.defaultView.pageYOffset||(e.documentElement||e.body).scrollTop}function bi(e){var t=nn(e).widgets,n=0;if(t)for(var i=0;i<t.length;++i)t[i].above&&(n+=Yn(t[i]));return n}function Si(e,t,n,i,r){if(!r){var o=bi(t);n.top+=o,n.bottom+=o}if("line"==i)return n;i||(i="local");var s=dn(t);if("local"==i?s+=Kn(e.display):s-=e.display.viewOffset,"page"==i||"window"==i){var a=e.display.lineSpace.getBoundingClientRect();s+=a.top+("window"==i?0:yi(V(e)));var l=a.left+("window"==i?0:vi(V(e)));n.left+=l,n.right+=l}return n.top+=s,n.bottom+=s,n}function wi(e,t,n){if("div"==n)return t;var i=t.left,r=t.top;if("page"==n)i-=vi(V(e)),r-=yi(V(e));else if("local"==n||!n){var o=e.display.sizer.getBoundingClientRect();i+=o.left,r+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:i-s.left,top:r-s.top}}function xi(e,t,n,i,r){return i||(i=tt(e.doc,t.line)),Si(e,i,ri(e,i,t.ch,r),n)}function Ci(e,t,n,i,r,o){function s(t,s){var a=ai(e,r,t,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,Si(e,i,a,n)}i=i||tt(e.doc,t.line),r||(r=si(e,i));var a=ve(i,e.doc.direction),l=t.ch,c=t.sticky;if(l>=i.text.length?(l=i.text.length,c="before"):l<=0&&(l=0,c="after"),!a)return s("before"==c?l-1:l,"before"==c);function d(e,t,n){return s(n?e-1:e,1==a[t].level!=n)}var u=ge(a,l,c),h=fe,p=d(l,u,"before"==c);return null!=h&&(p.other=d(l,h,"before"!=c)),p}function ki(e,t){var n=0;t=mt(e.doc,t),e.options.lineWrapping||(n=Oi(e.display)*t.ch);var i=tt(e.doc,t.line),r=dn(i)+Kn(e.display);return{left:n,right:n,top:r,bottom:r+i.height}}function Ei(e,t,n,i,r){var o=ct(e,t,n);return o.xRel=r,i&&(o.outside=i),o}function Ti(e,t,n){var i=e.doc;if((n+=e.display.viewOffset)<0)return Ei(i.first,0,null,-1,-1);var r=st(i,n),o=i.first+i.size-1;if(r>o)return Ei(i.first+i.size-1,tt(i,o).text.length,null,1,1);t<0&&(t=0);for(var s=tt(i,r);;){var a=Mi(e,s,r,t,n),l=en(s,a.ch+(a.xRel>0||a.outside>0?1:0));if(!l)return a;var c=l.find(1);if(c.line==r)return c;s=tt(i,r=c.line)}}function Li(e,t,n,i){i-=bi(t);var r=t.text.length,o=he((function(t){return ai(e,n,t-1).bottom<=i}),r,0);return{begin:o,end:r=he((function(t){return ai(e,n,t).top>i}),o,r)}}function Pi(e,t,n,i){return n||(n=si(e,t)),Li(e,t,n,Si(e,t,ai(e,n,i),"line").top)}function Di(e,t,n,i){return!(e.bottom<=n)&&(e.top>n||(i?e.left:e.right)>t)}function Mi(e,t,n,i,r){r-=dn(t);var o=si(e,t),s=bi(t),a=0,l=t.text.length,c=!0,d=ve(t,e.doc.direction);if(d){var u=(e.options.lineWrapping?Ri:Ii)(e,t,n,o,d,i,r);a=(c=1!=u.level)?u.from:u.to-1,l=c?u.to:u.from-1}var h,p,f=null,g=null,m=he((function(t){var n=ai(e,o,t);return n.top+=s,n.bottom+=s,!!Di(n,i,r,!1)&&(n.top<=r&&n.left<=i&&(f=t,g=n),!0)}),a,l),v=!1;if(g){var y=i-g.left<g.right-i,b=y==c;m=f+(b?0:1),p=b?"after":"before",h=y?g.left:g.right}else{c||m!=l&&m!=a||m++,p=0==m?"after":m==t.text.length?"before":ai(e,o,m-(c?1:0)).bottom+s<=r==c?"after":"before";var S=Ci(e,ct(n,m,p),"line",t,o);h=S.left,v=r<S.top?-1:r>=S.bottom?1:0}return Ei(n,m=ue(t.text,m,1),p,v,i-h)}function Ii(e,t,n,i,r,o,s){var a=he((function(a){var l=r[a],c=1!=l.level;return Di(Ci(e,ct(n,c?l.to:l.from,c?"before":"after"),"line",t,i),o,s,!0)}),0,r.length-1),l=r[a];if(a>0){var c=1!=l.level,d=Ci(e,ct(n,c?l.from:l.to,c?"after":"before"),"line",t,i);Di(d,o,s,!0)&&d.top>s&&(l=r[a-1])}return l}function Ri(e,t,n,i,r,o,s){var a=Li(e,t,i,s),l=a.begin,c=a.end;/\s/.test(t.text.charAt(c-1))&&c--;for(var d=null,u=null,h=0;h<r.length;h++){var p=r[h];if(!(p.from>=c||p.to<=l)){var f=ai(e,i,1!=p.level?Math.min(c,p.to)-1:Math.max(l,p.from)).right,g=f<o?o-f+1e9:f-o;(!d||u>g)&&(d=p,u=g)}}return d||(d=r[r.length-1]),d.from<l&&(d={from:l,to:d.to,level:d.level}),d.to>c&&(d={from:d.from,to:c,level:d.level}),d}function Ai(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==li){li=M("pre",null,"CodeMirror-line-like");for(var t=0;t<49;++t)li.appendChild(document.createTextNode("x")),li.appendChild(M("br"));li.appendChild(document.createTextNode("x"))}D(e.measure,li);var n=li.offsetHeight/50;return n>3&&(e.cachedTextHeight=n),P(e.measure),n||1}function Oi(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=M("span","xxxxxxxxxx"),n=M("pre",[t],"CodeMirror-line-like");D(e.measure,n);var i=t.getBoundingClientRect(),r=(i.right-i.left)/10;return r>2&&(e.cachedCharWidth=r),r||10}function Ni(e){for(var t=e.display,n={},i={},r=t.gutters.clientLeft,o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s){var a=e.display.gutterSpecs[s].className;n[a]=o.offsetLeft+o.clientLeft+r,i[a]=o.clientWidth}return{fixedPos:_i(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:i,wrapperWidth:t.wrapper.clientWidth}}function _i(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function Vi(e){var t=Ai(e.display),n=e.options.lineWrapping,i=n&&Math.max(5,e.display.scroller.clientWidth/Oi(e.display)-3);return function(r){if(ln(e.doc,r))return 0;var o=0;if(r.widgets)for(var s=0;s<r.widgets.length;s++)r.widgets[s].height&&(o+=r.widgets[s].height);return n?o+(Math.ceil(r.text.length/i)||1)*t:o+t}}function Bi(e){var t=e.doc,n=Vi(e);t.iter((function(e){var t=n(e);t!=e.height&&rt(e,t)}))}function Fi(e,t,n,i){var r=e.display;if(!n&&"true"==Ie(t).getAttribute("cm-not-content"))return null;var o,s,a=r.lineSpace.getBoundingClientRect();try{o=t.clientX-a.left,s=t.clientY-a.top}catch(u){return null}var l,c=Ti(e,o,s);if(i&&c.xRel>0&&(l=tt(e.doc,c.line).text).length==c.ch){var d=G(l,l.length,e.options.tabSize)-l.length;c=ct(c.line,Math.max(0,Math.round((o-Zn(e.display).left)/Oi(e.display))-d))}return c}function Ui(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var n=e.display.view,i=0;i<n.length;i++)if((t-=n[i].size)<0)return i}function zi(e,t,n,i){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size),i||(i=0);var r=e.display;if(i&&n<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>t)&&(r.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=r.viewTo)Ot&&sn(e.doc,t)<r.viewTo&&Gi(e);else if(n<=r.viewFrom)Ot&&an(e.doc,n+i)>r.viewFrom?Gi(e):(r.viewFrom+=i,r.viewTo+=i);else if(t<=r.viewFrom&&n>=r.viewTo)Gi(e);else if(t<=r.viewFrom){var o=Wi(e,n,n+i,1);o?(r.view=r.view.slice(o.index),r.viewFrom=o.lineN,r.viewTo+=i):Gi(e)}else if(n>=r.viewTo){var s=Wi(e,t,t,-1);s?(r.view=r.view.slice(0,s.index),r.viewTo=s.lineN):Gi(e)}else{var a=Wi(e,t,t,-1),l=Wi(e,n,n+i,1);a&&l?(r.view=r.view.slice(0,a.index).concat(Ln(e,a.lineN,l.lineN)).concat(r.view.slice(l.index)),r.viewTo+=i):Gi(e)}var c=r.externalMeasured;c&&(n<c.lineN?c.lineN+=i:t<c.lineN+c.size&&(r.externalMeasured=null))}function ji(e,t,n){e.curOp.viewChanged=!0;var i=e.display,r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size&&(i.externalMeasured=null),!(t<i.viewFrom||t>=i.viewTo)){var o=i.view[Ui(e,t)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==H(s,n)&&s.push(n)}}}function Gi(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function Wi(e,t,n,i){var r,o=Ui(e,t),s=e.display.view;if(!Ot||n==e.doc.first+e.doc.size)return{index:o,lineN:n};for(var a=e.display.viewFrom,l=0;l<o;l++)a+=s[l].size;if(a!=t){if(i>0){if(o==s.length-1)return null;r=a+s[o].size-t,o++}else r=a-t;t+=r,n+=r}for(;sn(e.doc,n)!=n;){if(o==(i<0?0:s.length-1))return null;n+=i*s[o-(i<0?1:0)].size,o+=i}return{index:o,lineN:n}}function Hi(e,t,n){var i=e.display;0==i.view.length||t>=i.viewTo||n<=i.viewFrom?(i.view=Ln(e,t,n),i.viewFrom=t):(i.viewFrom>t?i.view=Ln(e,t,i.viewFrom).concat(i.view):i.viewFrom<t&&(i.view=i.view.slice(Ui(e,t))),i.viewFrom=t,i.viewTo<n?i.view=i.view.concat(Ln(e,i.viewTo,n)):i.viewTo>n&&(i.view=i.view.slice(0,Ui(e,n)))),i.viewTo=n}function qi(e){for(var t=e.display.view,n=0,i=0;i<t.length;i++){var r=t[i];r.hidden||r.node&&!r.changes||++n}return n}function Yi(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Ji(e,t){void 0===t&&(t=!0);var n=e.doc,i={},r=i.cursors=document.createDocumentFragment(),o=i.selection=document.createDocumentFragment(),s=e.options.$customCursor;s&&(t=!0);for(var a=0;a<n.sel.ranges.length;a++)if(t||a!=n.sel.primIndex){var l=n.sel.ranges[a];if(!(l.from().line>=e.display.viewTo||l.to().line<e.display.viewFrom)){var c=l.empty();if(s){var d=s(e,l);d&&Ki(e,d,r)}else(c||e.options.showCursorWhenSelecting)&&Ki(e,l.head,r);c||Zi(e,l,o)}}return i}function Ki(e,t,n){var i=Ci(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),r=n.appendChild(M("div","\xa0","CodeMirror-cursor"));if(r.style.left=i.left+"px",r.style.top=i.top+"px",r.style.height=Math.max(0,i.bottom-i.top)*e.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(e.getWrapperElement().className)){var o=xi(e,t,"div",null,null),s=o.right-o.left;r.style.width=(s>0?s:e.defaultCharWidth())+"px"}if(i.other){var a=n.appendChild(M("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"));a.style.display="",a.style.left=i.other.left+"px",a.style.top=i.other.top+"px",a.style.height=.85*(i.other.bottom-i.other.top)+"px"}}function Xi(e,t){return e.top-t.top||e.left-t.left}function Zi(e,t,n){var i=e.display,r=e.doc,o=document.createDocumentFragment(),s=Zn(e.display),a=s.left,l=Math.max(i.sizerWidth,$n(e)-i.sizer.offsetLeft)-s.right,c="ltr"==r.direction;function d(e,t,n,i){t<0&&(t=0),t=Math.round(t),i=Math.round(i),o.appendChild(M("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==n?l-e:n)+"px;\n                             height: "+(i-t)+"px"))}function u(t,n,i){var o,s,u=tt(r,t),h=u.text.length;function p(n,i){return xi(e,ct(t,n),"div",u,i)}function f(t,n,i){var r=Pi(e,u,null,t),o="ltr"==n==("after"==i)?"left":"right";return p("after"==i?r.begin:r.end-(/\s/.test(u.text.charAt(r.end-1))?2:1),o)[o]}var g=ve(u,r.direction);return pe(g,n||0,null==i?h:i,(function(e,t,r,u){var m="ltr"==r,v=p(e,m?"left":"right"),y=p(t-1,m?"right":"left"),b=null==n&&0==e,S=null==i&&t==h,w=0==u,x=!g||u==g.length-1;if(y.top-v.top<=3){var C=(c?S:b)&&x,k=(c?b:S)&&w?a:(m?v:y).left,E=C?l:(m?y:v).right;d(k,v.top,E-k,v.bottom)}else{var T,L,P,D;m?(T=c&&b&&w?a:v.left,L=c?l:f(e,r,"before"),P=c?a:f(t,r,"after"),D=c&&S&&x?l:y.right):(T=c?f(e,r,"before"):a,L=!c&&b&&w?l:v.right,P=!c&&S&&x?a:y.left,D=c?f(t,r,"after"):l),d(T,v.top,L-T,v.bottom),v.bottom<y.top&&d(a,v.bottom,null,y.top),d(P,y.top,D-P,y.bottom)}(!o||Xi(v,o)<0)&&(o=v),Xi(y,o)<0&&(o=y),(!s||Xi(v,s)<0)&&(s=v),Xi(y,s)<0&&(s=y)})),{start:o,end:s}}var h=t.from(),p=t.to();if(h.line==p.line)u(h.line,h.ch,p.ch);else{var f=tt(r,h.line),g=tt(r,p.line),m=nn(f)==nn(g),v=u(h.line,h.ch,m?f.text.length+1:null).end,y=u(p.line,m?0:null,p.ch).start;m&&(v.top<y.top-2?(d(v.right,v.top,null,v.bottom),d(a,y.top,y.left,y.bottom)):d(v.right,v.top,y.left-v.right,v.bottom)),v.bottom<y.top&&d(a,v.bottom,null,y.top)}n.appendChild(o)}function Qi(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval((function(){e.hasFocus()||nr(e),t.cursorDiv.style.visibility=(n=!n)?"":"hidden"}),e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function $i(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||tr(e))}function er(e){e.state.delayingBlurEvent=!0,setTimeout((function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&nr(e))}),100)}function tr(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(xe(e,"focus",e,t),e.state.focused=!0,O(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),l&&setTimeout((function(){return e.display.input.reset(!0)}),20)),e.display.input.receivedFocus()),Qi(e))}function nr(e,t){e.state.delayingBlurEvent||(e.state.focused&&(xe(e,"blur",e,t),e.state.focused=!1,L(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout((function(){e.state.focused||(e.display.shift=!1)}),150))}function ir(e){for(var t=e.display,n=t.lineDiv.offsetTop,i=Math.max(0,t.scroller.getBoundingClientRect().top),r=t.lineDiv.getBoundingClientRect().top,o=0,l=0;l<t.view.length;l++){var c=t.view[l],d=e.options.lineWrapping,u=void 0,h=0;if(!c.hidden){if(r+=c.line.height,s&&a<8){var p=c.node.offsetTop+c.node.offsetHeight;u=p-n,n=p}else{var f=c.node.getBoundingClientRect();u=f.bottom-f.top,!d&&c.text.firstChild&&(h=c.text.firstChild.getBoundingClientRect().right-f.left-1)}var g=c.line.height-u;if((g>.005||g<-.005)&&(r<i&&(o-=g),rt(c.line,u),rr(c.line),c.rest))for(var m=0;m<c.rest.length;m++)rr(c.rest[m]);if(h>e.display.sizerWidth){var v=Math.ceil(h/Oi(e.display));v>e.display.maxLineLength&&(e.display.maxLineLength=v,e.display.maxLine=c.line,e.display.maxLineChanged=!0)}}}Math.abs(o)>2&&(t.scroller.scrollTop+=o)}function rr(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var n=e.widgets[t],i=n.node.parentNode;i&&(n.height=i.offsetHeight)}}function or(e,t,n){var i=n&&null!=n.top?Math.max(0,n.top):e.scroller.scrollTop;i=Math.floor(i-Kn(e));var r=n&&null!=n.bottom?n.bottom:i+e.wrapper.clientHeight,o=st(t,i),s=st(t,r);if(n&&n.ensure){var a=n.ensure.from.line,l=n.ensure.to.line;a<o?(o=a,s=st(t,dn(tt(t,a))+e.wrapper.clientHeight)):Math.min(l,t.lastLine())>=s&&(o=st(t,dn(tt(t,l))-e.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function sr(e,t){if(!Ce(e,"scrollCursorIntoView")){var n=e.display,i=n.sizer.getBoundingClientRect(),r=null,o=n.wrapper.ownerDocument;if(t.top+i.top<0?r=!0:t.bottom+i.top>(o.defaultView.innerHeight||o.documentElement.clientHeight)&&(r=!1),null!=r&&!g){var s=M("div","\u200b",null,"position: absolute;\n                         top: "+(t.top-n.viewOffset-Kn(e.display))+"px;\n                         height: "+(t.bottom-t.top+Qn(e)+n.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(s),s.scrollIntoView(r),e.display.lineSpace.removeChild(s)}}}function ar(e,t,n,i){var r;null==i&&(i=0),e.options.lineWrapping||t!=n||(n="before"==t.sticky?ct(t.line,t.ch+1,"before"):t,t=t.ch?ct(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t);for(var o=0;o<5;o++){var s=!1,a=Ci(e,t),l=n&&n!=t?Ci(e,n):a,c=cr(e,r={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-i,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+i}),d=e.doc.scrollTop,u=e.doc.scrollLeft;if(null!=c.scrollTop&&(mr(e,c.scrollTop),Math.abs(e.doc.scrollTop-d)>1&&(s=!0)),null!=c.scrollLeft&&(yr(e,c.scrollLeft),Math.abs(e.doc.scrollLeft-u)>1&&(s=!0)),!s)break}return r}function lr(e,t){var n=cr(e,t);null!=n.scrollTop&&mr(e,n.scrollTop),null!=n.scrollLeft&&yr(e,n.scrollLeft)}function cr(e,t){var n=e.display,i=Ai(e.display);t.top<0&&(t.top=0);var r=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:n.scroller.scrollTop,o=ei(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);var a=e.doc.height+Xn(n),l=t.top<i,c=t.bottom>a-i;if(t.top<r)s.scrollTop=l?0:t.top;else if(t.bottom>r+o){var d=Math.min(t.top,(c?a:t.bottom)-o);d!=r&&(s.scrollTop=d)}var u=e.options.fixedGutter?0:n.gutters.offsetWidth,h=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:n.scroller.scrollLeft-u,p=$n(e)-n.gutters.offsetWidth,f=t.right-t.left>p;return f&&(t.right=t.left+p),t.left<10?s.scrollLeft=0:t.left<h?s.scrollLeft=Math.max(0,t.left+u-(f?0:10)):t.right>p+h-3&&(s.scrollLeft=t.right+(f?0:10)-p),s}function dr(e,t){null!=t&&(fr(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function ur(e){fr(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function hr(e,t,n){null==t&&null==n||fr(e),null!=t&&(e.curOp.scrollLeft=t),null!=n&&(e.curOp.scrollTop=n)}function pr(e,t){fr(e),e.curOp.scrollToPos=t}function fr(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,gr(e,ki(e,t.from),ki(e,t.to),t.margin))}function gr(e,t,n,i){var r=cr(e,{left:Math.min(t.left,n.left),top:Math.min(t.top,n.top)-i,right:Math.max(t.right,n.right),bottom:Math.max(t.bottom,n.bottom)+i});hr(e,r.scrollLeft,r.scrollTop)}function mr(e,t){Math.abs(e.doc.scrollTop-t)<2||(n||Yr(e,{top:t}),vr(e,t,!0),n&&Yr(e),Fr(e,100))}function vr(e,t,n){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),(e.display.scroller.scrollTop!=t||n)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function yr(e,t,n,i){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),(n?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!i||(e.doc.scrollLeft=t,Zr(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function br(e){var t=e.display,n=t.gutters.offsetWidth,i=Math.round(e.doc.height+Xn(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?n:0,docHeight:i,scrollHeight:i+Qn(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:n}}var Sr=function(e,t,n){this.cm=n;var i=this.vert=M("div",[M("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r=this.horiz=M("div",[M("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");i.tabIndex=r.tabIndex=-1,e(i),e(r),be(i,"scroll",(function(){i.clientHeight&&t(i.scrollTop,"vertical")})),be(r,"scroll",(function(){r.clientWidth&&t(r.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,s&&a<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Sr.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,n=e.scrollHeight>e.clientHeight+1,i=e.nativeBarWidth;if(n){this.vert.style.display="block",this.vert.style.bottom=t?i+"px":"0";var r=e.viewHeight-(t?i:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+r)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=n?i+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(n?i:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==i&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:n?i:0,bottom:t?i:0}},Sr.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Sr.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Sr.prototype.zeroWidthHack=function(){var e=b&&!f?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new W,this.disableVert=new W},Sr.prototype.enableZeroWidthBar=function(e,t,n){function i(){var r=e.getBoundingClientRect();("vert"==n?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=e?e.style.visibility="hidden":t.set(1e3,i)}e.style.visibility="",t.set(1e3,i)},Sr.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var wr=function(){};function xr(e,t){t||(t=br(e));var n=e.display.barWidth,i=e.display.barHeight;Cr(e,t);for(var r=0;r<4&&n!=e.display.barWidth||i!=e.display.barHeight;r++)n!=e.display.barWidth&&e.options.lineWrapping&&ir(e),Cr(e,br(e)),n=e.display.barWidth,i=e.display.barHeight}function Cr(e,t){var n=e.display,i=n.scrollbars.update(t);n.sizer.style.paddingRight=(n.barWidth=i.right)+"px",n.sizer.style.paddingBottom=(n.barHeight=i.bottom)+"px",n.heightForcer.style.borderBottom=i.bottom+"px solid transparent",i.right&&i.bottom?(n.scrollbarFiller.style.display="block",n.scrollbarFiller.style.height=i.bottom+"px",n.scrollbarFiller.style.width=i.right+"px"):n.scrollbarFiller.style.display="",i.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(n.gutterFiller.style.display="block",n.gutterFiller.style.height=i.bottom+"px",n.gutterFiller.style.width=t.gutterWidth+"px"):n.gutterFiller.style.display=""}wr.prototype.update=function(){return{bottom:0,right:0}},wr.prototype.setScrollLeft=function(){},wr.prototype.setScrollTop=function(){},wr.prototype.clear=function(){};var kr={native:Sr,null:wr};function Er(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&L(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new kr[e.options.scrollbarStyle]((function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),be(t,"mousedown",(function(){e.state.focused&&setTimeout((function(){return e.display.input.focus()}),0)})),t.setAttribute("cm-not-content","true")}),(function(t,n){"horizontal"==n?yr(e,t):mr(e,t)}),e),e.display.scrollbars.addClass&&O(e.display.wrapper,e.display.scrollbars.addClass)}var Tr=0;function Lr(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Tr,markArrays:null},Dn(e.curOp)}function Pr(e){var t=e.curOp;t&&In(t,(function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;Dr(e)}))}function Dr(e){for(var t=e.ops,n=0;n<t.length;n++)Mr(t[n]);for(var i=0;i<t.length;i++)Ir(t[i]);for(var r=0;r<t.length;r++)Rr(t[r]);for(var o=0;o<t.length;o++)Ar(t[o]);for(var s=0;s<t.length;s++)Or(t[s])}function Mr(e){var t=e.cm,n=t.display;jr(t),e.updateMaxLine&&hn(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<n.viewFrom||e.scrollToPos.to.line>=n.viewTo)||n.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new zr(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function Ir(e){e.updatedDisplay=e.mustUpdate&&Hr(e.cm,e.update)}function Rr(e){var t=e.cm,n=t.display;e.updatedDisplay&&ir(t),e.barMeasure=br(t),n.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=ri(t,n.maxLine,n.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(n.scroller.clientWidth,n.sizer.offsetLeft+e.adjustWidthTo+Qn(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,n.sizer.offsetLeft+e.adjustWidthTo-$n(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=n.input.prepareSelection())}function Ar(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&yr(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var n=e.focus&&e.focus==A(B(t));e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,n),(e.updatedDisplay||e.startHeight!=t.doc.height)&&xr(t,e.barMeasure),e.updatedDisplay&&Xr(t,e.barMeasure),e.selectionChanged&&Qi(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),n&&$i(e.cm)}function Or(e){var t=e.cm,n=t.display,i=t.doc;e.updatedDisplay&&qr(t,e.update),null==n.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(n.wheelStartX=n.wheelStartY=null),null!=e.scrollTop&&vr(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&yr(t,e.scrollLeft,!0,!0),e.scrollToPos&&sr(t,ar(t,mt(i,e.scrollToPos.from),mt(i,e.scrollToPos.to),e.scrollToPos.margin));var r=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(r)for(var s=0;s<r.length;++s)r[s].lines.length||xe(r[s],"hide");if(o)for(var a=0;a<o.length;++a)o[a].lines.length&&xe(o[a],"unhide");n.wrapper.offsetHeight&&(i.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&xe(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function Nr(e,t){if(e.curOp)return t();Lr(e);try{return t()}finally{Pr(e)}}function _r(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Lr(e);try{return t.apply(e,arguments)}finally{Pr(e)}}}function Vr(e){return function(){if(this.curOp)return e.apply(this,arguments);Lr(this);try{return e.apply(this,arguments)}finally{Pr(this)}}}function Br(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Lr(t);try{return e.apply(this,arguments)}finally{Pr(t)}}}function Fr(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,z(Ur,e))}function Ur(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var n=+new Date+e.options.workTime,i=Ct(e,t.highlightFrontier),r=[];t.iter(i.line,Math.min(t.first+t.size,e.display.viewTo+500),(function(o){if(i.line>=e.display.viewFrom){var s=o.styles,a=o.text.length>e.options.maxHighlightLength?Ze(t.mode,i.state):null,l=wt(e,o,i,!0);a&&(i.state=a),o.styles=l.styles;var c=o.styleClasses,d=l.classes;d?o.styleClasses=d:c&&(o.styleClasses=null);for(var u=!s||s.length!=o.styles.length||c!=d&&(!c||!d||c.bgClass!=d.bgClass||c.textClass!=d.textClass),h=0;!u&&h<s.length;++h)u=s[h]!=o.styles[h];u&&r.push(i.line),o.stateAfter=i.save(),i.nextLine()}else o.text.length<=e.options.maxHighlightLength&&kt(e,o.text,i),o.stateAfter=i.line%5==0?i.save():null,i.nextLine();if(+new Date>n)return Fr(e,e.options.workDelay),!0})),t.highlightFrontier=i.line,t.modeFrontier=Math.max(t.modeFrontier,i.line),r.length&&Nr(e,(function(){for(var t=0;t<r.length;t++)ji(e,r[t],"text")}))}}var zr=function(e,t,n){var i=e.display;this.viewport=t,this.visible=or(i,e.doc,t),this.editorIsHidden=!i.wrapper.offsetWidth,this.wrapperHeight=i.wrapper.clientHeight,this.wrapperWidth=i.wrapper.clientWidth,this.oldDisplayWidth=$n(e),this.force=n,this.dims=Ni(e),this.events=[]};function jr(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Qn(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Qn(e)+"px",t.scrollbarsClipped=!0)}function Gr(e){if(e.hasFocus())return null;var t=A(B(e));if(!t||!R(e.display.lineDiv,t))return null;var n={activeElt:t};if(window.getSelection){var i=U(e).getSelection();i.anchorNode&&i.extend&&R(e.display.lineDiv,i.anchorNode)&&(n.anchorNode=i.anchorNode,n.anchorOffset=i.anchorOffset,n.focusNode=i.focusNode,n.focusOffset=i.focusOffset)}return n}function Wr(e){if(e&&e.activeElt&&e.activeElt!=A(F(e.activeElt))&&(e.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&R(document.body,e.anchorNode)&&R(document.body,e.focusNode))){var t=e.activeElt.ownerDocument,n=t.defaultView.getSelection(),i=t.createRange();i.setEnd(e.anchorNode,e.anchorOffset),i.collapse(!1),n.removeAllRanges(),n.addRange(i),n.extend(e.focusNode,e.focusOffset)}}function Hr(e,t){var n=e.display,i=e.doc;if(t.editorIsHidden)return Gi(e),!1;if(!t.force&&t.visible.from>=n.viewFrom&&t.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==qi(e))return!1;Qr(e)&&(Gi(e),t.dims=Ni(e));var r=i.first+i.size,o=Math.max(t.visible.from-e.options.viewportMargin,i.first),s=Math.min(r,t.visible.to+e.options.viewportMargin);n.viewFrom<o&&o-n.viewFrom<20&&(o=Math.max(i.first,n.viewFrom)),n.viewTo>s&&n.viewTo-s<20&&(s=Math.min(r,n.viewTo)),Ot&&(o=sn(e.doc,o),s=an(e.doc,s));var a=o!=n.viewFrom||s!=n.viewTo||n.lastWrapHeight!=t.wrapperHeight||n.lastWrapWidth!=t.wrapperWidth;Hi(e,o,s),n.viewOffset=dn(tt(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var l=qi(e);if(!a&&0==l&&!t.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var c=Gr(e);return l>4&&(n.lineDiv.style.display="none"),Jr(e,n.updateLineNumbers,t.dims),l>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,Wr(c),P(n.cursorDiv),P(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,a&&(n.lastWrapHeight=t.wrapperHeight,n.lastWrapWidth=t.wrapperWidth,Fr(e,400)),n.updateLineNumbers=null,!0}function qr(e,t){for(var n=t.viewport,i=!0;;i=!1){if(i&&e.options.lineWrapping&&t.oldDisplayWidth!=$n(e))i&&(t.visible=or(e.display,e.doc,n));else if(n&&null!=n.top&&(n={top:Math.min(e.doc.height+Xn(e.display)-ei(e),n.top)}),t.visible=or(e.display,e.doc,n),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break;if(!Hr(e,t))break;ir(e);var r=br(e);Yi(e),xr(e,r),Xr(e,r),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function Yr(e,t){var n=new zr(e,t);if(Hr(e,n)){ir(e),qr(e,n);var i=br(e);Yi(e),xr(e,i),Xr(e,i),n.finish()}}function Jr(e,t,n){var i=e.display,r=e.options.lineNumbers,o=i.lineDiv,s=o.firstChild;function a(t){var n=t.nextSibling;return l&&b&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),n}for(var c=i.view,d=i.viewFrom,u=0;u<c.length;u++){var h=c[u];if(h.hidden);else if(h.node&&h.node.parentNode==o){for(;s!=h.node;)s=a(s);var p=r&&null!=t&&t<=d&&h.lineNumber;h.changes&&(H(h.changes,"gutter")>-1&&(p=!1),Nn(e,h,d,n)),p&&(P(h.lineNumber),h.lineNumber.appendChild(document.createTextNode(lt(e.options,d)))),s=h.node.nextSibling}else{var f=Gn(e,h,d,n);o.insertBefore(f,s)}d+=h.size}for(;s;)s=a(s)}function Kr(e){var t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px",An(e,"gutterChanged",e)}function Xr(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Qn(e)+"px"}function Zr(e){var t=e.display,n=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var i=_i(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,o=i+"px",s=0;s<n.length;s++)if(!n[s].hidden){e.options.fixedGutter&&(n[s].gutter&&(n[s].gutter.style.left=o),n[s].gutterBackground&&(n[s].gutterBackground.style.left=o));var a=n[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=i+r+"px")}}function Qr(e){if(!e.options.lineNumbers)return!1;var t=e.doc,n=lt(e.options,t.first+t.size-1),i=e.display;if(n.length!=i.lineNumChars){var r=i.measure.appendChild(M("div",[M("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=r.firstChild.offsetWidth,s=r.offsetWidth-o;return i.lineGutter.style.width="",i.lineNumInnerWidth=Math.max(o,i.lineGutter.offsetWidth-s)+1,i.lineNumWidth=i.lineNumInnerWidth+s,i.lineNumChars=i.lineNumInnerWidth?n.length:-1,i.lineGutter.style.width=i.lineNumWidth+"px",Kr(e.display),!0}return!1}function $r(e,t){for(var n=[],i=!1,r=0;r<e.length;r++){var o=e[r],s=null;if("string"!=typeof o&&(s=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!t)continue;i=!0}n.push({className:o,style:s})}return t&&!i&&n.push({className:"CodeMirror-linenumbers",style:null}),n}function eo(e){var t=e.gutters,n=e.gutterSpecs;P(t),e.lineGutter=null;for(var i=0;i<n.length;++i){var r=n[i],o=r.className,s=r.style,a=t.appendChild(M("div",null,"CodeMirror-gutter "+o));s&&(a.style.cssText=s),"CodeMirror-linenumbers"==o&&(e.lineGutter=a,a.style.width=(e.lineNumWidth||1)+"px")}t.style.display=n.length?"":"none",Kr(e)}function to(e){eo(e.display),zi(e),Zr(e)}function no(e,t,i,r){var o=this;this.input=i,o.scrollbarFiller=M("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=M("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=I("div",null,"CodeMirror-code"),o.selectionDiv=M("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=M("div",null,"CodeMirror-cursors"),o.measure=M("div",null,"CodeMirror-measure"),o.lineMeasure=M("div",null,"CodeMirror-measure"),o.lineSpace=I("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var c=I("div",[o.lineSpace],"CodeMirror-lines");o.mover=M("div",[c],null,"position: relative"),o.sizer=M("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=M("div",null,null,"position: absolute; height: "+q+"px; width: 1px;"),o.gutters=M("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=M("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=M("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),d&&u>=105&&(o.wrapper.style.clipPath="inset(0px)"),o.wrapper.setAttribute("translate","no"),s&&a<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),l||n&&y||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,o.gutterSpecs=$r(r.gutters,r.lineNumbers),eo(o),i.init(o)}zr.prototype.signal=function(e,t){Ee(e,t)&&this.events.push(arguments)},zr.prototype.finish=function(){for(var e=0;e<this.events.length;e++)xe.apply(null,this.events[e])};var io=0,ro=null;function oo(e){var t=e.wheelDeltaX,n=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==n&&e.detail&&e.axis==e.VERTICAL_AXIS?n=e.detail:null==n&&(n=e.wheelDelta),{x:t,y:n}}function so(e){var t=oo(e);return t.x*=ro,t.y*=ro,t}function ao(e,t){d&&102==u&&(null==e.display.chromeScrollHack?e.display.sizer.style.pointerEvents="none":clearTimeout(e.display.chromeScrollHack),e.display.chromeScrollHack=setTimeout((function(){e.display.chromeScrollHack=null,e.display.sizer.style.pointerEvents=""}),100));var i=oo(t),r=i.x,o=i.y,s=ro;0===t.deltaMode&&(r=t.deltaX,o=t.deltaY,s=1);var a=e.display,c=a.scroller,p=c.scrollWidth>c.clientWidth,f=c.scrollHeight>c.clientHeight;if(r&&p||o&&f){if(o&&b&&l)e:for(var g=t.target,m=a.view;g!=c;g=g.parentNode)for(var v=0;v<m.length;v++)if(m[v].node==g){e.display.currentWheelTarget=g;break e}if(r&&!n&&!h&&null!=s)return o&&f&&mr(e,Math.max(0,c.scrollTop+o*s)),yr(e,Math.max(0,c.scrollLeft+r*s)),(!o||o&&f)&&Le(t),void(a.wheelStartX=null);if(o&&null!=s){var y=o*s,S=e.doc.scrollTop,w=S+a.wrapper.clientHeight;y<0?S=Math.max(0,S+y-50):w=Math.min(e.doc.height,w+y+50),Yr(e,{top:S,bottom:w})}io<20&&0!==t.deltaMode&&(null==a.wheelStartX?(a.wheelStartX=c.scrollLeft,a.wheelStartY=c.scrollTop,a.wheelDX=r,a.wheelDY=o,setTimeout((function(){if(null!=a.wheelStartX){var e=c.scrollLeft-a.wheelStartX,t=c.scrollTop-a.wheelStartY,n=t&&a.wheelDY&&t/a.wheelDY||e&&a.wheelDX&&e/a.wheelDX;a.wheelStartX=a.wheelStartY=null,n&&(ro=(ro*io+n)/(io+1),++io)}}),200)):(a.wheelDX+=r,a.wheelDY+=o))}}s?ro=-.53:n?ro=15:d?ro=-.7:p&&(ro=-1/3);var lo=function(e,t){this.ranges=e,this.primIndex=t};lo.prototype.primary=function(){return this.ranges[this.primIndex]},lo.prototype.equals=function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var n=this.ranges[t],i=e.ranges[t];if(!ut(n.anchor,i.anchor)||!ut(n.head,i.head))return!1}return!0},lo.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new co(ht(this.ranges[t].anchor),ht(this.ranges[t].head));return new lo(e,this.primIndex)},lo.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},lo.prototype.contains=function(e,t){t||(t=e);for(var n=0;n<this.ranges.length;n++){var i=this.ranges[n];if(dt(t,i.from())>=0&&dt(e,i.to())<=0)return n}return-1};var co=function(e,t){this.anchor=e,this.head=t};function uo(e,t,n){var i=e&&e.options.selectionsMayTouch,r=t[n];t.sort((function(e,t){return dt(e.from(),t.from())})),n=H(t,r);for(var o=1;o<t.length;o++){var s=t[o],a=t[o-1],l=dt(a.to(),s.from());if(i&&!s.empty()?l>0:l>=0){var c=ft(a.from(),s.from()),d=pt(a.to(),s.to()),u=a.empty()?s.from()==s.head:a.from()==a.head;o<=n&&--n,t.splice(--o,2,new co(u?d:c,u?c:d))}}return new lo(t,n)}function ho(e,t){return new lo([new co(e,t||e)],0)}function po(e){return e.text?ct(e.from.line+e.text.length-1,ee(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function fo(e,t){if(dt(e,t.from)<0)return e;if(dt(e,t.to)<=0)return po(t);var n=e.line+t.text.length-(t.to.line-t.from.line)-1,i=e.ch;return e.line==t.to.line&&(i+=po(t).ch-t.to.ch),ct(n,i)}function go(e,t){for(var n=[],i=0;i<e.sel.ranges.length;i++){var r=e.sel.ranges[i];n.push(new co(fo(r.anchor,t),fo(r.head,t)))}return uo(e.cm,n,e.sel.primIndex)}function mo(e,t,n){return e.line==t.line?ct(n.line,e.ch-t.ch+n.ch):ct(n.line+(e.line-t.line),e.ch)}function vo(e,t,n){for(var i=[],r=ct(e.first,0),o=r,s=0;s<t.length;s++){var a=t[s],l=mo(a.from,r,o),c=mo(po(a),r,o);if(r=a.to,o=c,"around"==n){var d=e.sel.ranges[s],u=dt(d.head,d.anchor)<0;i[s]=new co(u?c:l,u?l:c)}else i[s]=new co(l,l)}return new lo(i,e.sel.primIndex)}function yo(e){e.doc.mode=Je(e.options,e.doc.modeOption),bo(e)}function bo(e){e.doc.iter((function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)})),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Fr(e,100),e.state.modeGen++,e.curOp&&zi(e)}function So(e,t){return 0==t.from.ch&&0==t.to.ch&&""==ee(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function wo(e,t,n,i){function r(e){return n?n[e]:null}function o(e,n,r){fn(e,n,r,i),An(e,"change",e,t)}function s(e,t){for(var n=[],o=e;o<t;++o)n.push(new pn(c[o],r(o),i));return n}var a=t.from,l=t.to,c=t.text,d=tt(e,a.line),u=tt(e,l.line),h=ee(c),p=r(c.length-1),f=l.line-a.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(So(e,t)){var g=s(0,c.length-1);o(u,u.text,p),f&&e.remove(a.line,f),g.length&&e.insert(a.line,g)}else if(d==u)if(1==c.length)o(d,d.text.slice(0,a.ch)+h+d.text.slice(l.ch),p);else{var m=s(1,c.length-1);m.push(new pn(h+d.text.slice(l.ch),p,i)),o(d,d.text.slice(0,a.ch)+c[0],r(0)),e.insert(a.line+1,m)}else if(1==c.length)o(d,d.text.slice(0,a.ch)+c[0]+u.text.slice(l.ch),r(0)),e.remove(a.line+1,f);else{o(d,d.text.slice(0,a.ch)+c[0],r(0)),o(u,h+u.text.slice(l.ch),p);var v=s(1,c.length-1);f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,v)}An(e,"change",e,t)}function xo(e,t,n){function i(e,r,o){if(e.linked)for(var s=0;s<e.linked.length;++s){var a=e.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;n&&!l||(t(a.doc,l),i(a.doc,e,l))}}}i(e,null,!0)}function Co(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,Bi(e),yo(e),ko(e),e.options.direction=t.direction,e.options.lineWrapping||hn(e),e.options.mode=t.modeOption,zi(e)}function ko(e){("rtl"==e.doc.direction?O:L)(e.display.lineDiv,"CodeMirror-rtl")}function Eo(e){Nr(e,(function(){ko(e),zi(e)}))}function To(e){this.done=[],this.undone=[],this.undoDepth=e?e.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e?e.maxGeneration:1}function Lo(e,t){var n={from:ht(t.from),to:po(t),text:nt(e,t.from,t.to)};return Oo(e,n,t.from.line,t.to.line+1),xo(e,(function(e){return Oo(e,n,t.from.line,t.to.line+1)}),!0),n}function Po(e){for(;e.length&&ee(e).ranges;)e.pop()}function Do(e,t){return t?(Po(e.done),ee(e.done)):e.done.length&&!ee(e.done).ranges?ee(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),ee(e.done)):void 0}function Mo(e,t,n,i){var r=e.history;r.undone.length=0;var o,s,a=+new Date;if((r.lastOp==i||r.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&r.lastModTime>a-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(o=Do(r,r.lastOp==i)))s=ee(o.changes),0==dt(t.from,t.to)&&0==dt(t.from,s.to)?s.to=po(t):o.changes.push(Lo(e,t));else{var l=ee(r.done);for(l&&l.ranges||Ao(e.sel,r.done),o={changes:[Lo(e,t)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(n),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=i,r.lastOrigin=r.lastSelOrigin=t.origin,s||xe(e,"historyAdded")}function Io(e,t,n,i){var r=t.charAt(0);return"*"==r||"+"==r&&n.ranges.length==i.ranges.length&&n.somethingSelected()==i.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Ro(e,t,n,i){var r=e.history,o=i&&i.origin;n==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||Io(e,o,ee(r.done),t))?r.done[r.done.length-1]=t:Ao(t,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=n,i&&!1!==i.clearRedo&&Po(r.undone)}function Ao(e,t){var n=ee(t);n&&n.ranges&&n.equals(e)||t.push(e)}function Oo(e,t,n,i){var r=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,n),Math.min(e.first+e.size,i),(function(n){n.markedSpans&&((r||(r=t["spans_"+e.id]={}))[o]=n.markedSpans),++o}))}function No(e){if(!e)return null;for(var t,n=0;n<e.length;++n)e[n].marker.explicitlyCleared?t||(t=e.slice(0,n)):t&&t.push(e[n]);return t?t.length?t:null:e}function _o(e,t){var n=t["spans_"+e.id];if(!n)return null;for(var i=[],r=0;r<t.text.length;++r)i.push(No(n[r]));return i}function Vo(e,t){var n=_o(e,t),i=Gt(e,t);if(!n)return i;if(!i)return n;for(var r=0;r<n.length;++r){var o=n[r],s=i[r];if(o&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else s&&(n[r]=s)}return n}function Bo(e,t,n){for(var i=[],r=0;r<e.length;++r){var o=e[r];if(o.ranges)i.push(n?lo.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];i.push({changes:a});for(var l=0;l<s.length;++l){var c=s[l],d=void 0;if(a.push({from:c.from,to:c.to,text:c.text}),t)for(var u in c)(d=u.match(/^spans_(\d+)$/))&&H(t,Number(d[1]))>-1&&(ee(a)[u]=c[u],delete c[u])}}}return i}function Fo(e,t,n,i){if(i){var r=e.anchor;if(n){var o=dt(t,r)<0;o!=dt(n,r)<0?(r=t,t=n):o!=dt(t,n)<0&&(t=n)}return new co(r,t)}return new co(n||t,t)}function Uo(e,t,n,i,r){null==r&&(r=e.cm&&(e.cm.display.shift||e.extend)),qo(e,new lo([Fo(e.sel.primary(),t,n,r)],0),i)}function zo(e,t,n){for(var i=[],r=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)i[o]=Fo(e.sel.ranges[o],t[o],null,r);qo(e,uo(e.cm,i,e.sel.primIndex),n)}function jo(e,t,n,i){var r=e.sel.ranges.slice(0);r[t]=n,qo(e,uo(e.cm,r,e.sel.primIndex),i)}function Go(e,t,n,i){qo(e,ho(t,n),i)}function Wo(e,t,n){var i={ranges:t.ranges,update:function(t){this.ranges=[];for(var n=0;n<t.length;n++)this.ranges[n]=new co(mt(e,t[n].anchor),mt(e,t[n].head))},origin:n&&n.origin};return xe(e,"beforeSelectionChange",e,i),e.cm&&xe(e.cm,"beforeSelectionChange",e.cm,i),i.ranges!=t.ranges?uo(e.cm,i.ranges,i.ranges.length-1):t}function Ho(e,t,n){var i=e.history.done,r=ee(i);r&&r.ranges?(i[i.length-1]=t,Yo(e,t,n)):qo(e,t,n)}function qo(e,t,n){Yo(e,t,n),Ro(e,e.sel,e.cm?e.cm.curOp.id:NaN,n)}function Yo(e,t,n){(Ee(e,"beforeSelectionChange")||e.cm&&Ee(e.cm,"beforeSelectionChange"))&&(t=Wo(e,t,n));var i=n&&n.bias||(dt(t.primary().head,e.sel.primary().head)<0?-1:1);Jo(e,Xo(e,t,i,!0)),n&&!1===n.scroll||!e.cm||"nocursor"==e.cm.getOption("readOnly")||ur(e.cm)}function Jo(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,ke(e.cm)),An(e,"cursorActivity",e))}function Ko(e){Jo(e,Xo(e,e.sel,null,!1))}function Xo(e,t,n,i){for(var r,o=0;o<t.ranges.length;o++){var s=t.ranges[o],a=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=Qo(e,s.anchor,a&&a.anchor,n,i),c=s.head==s.anchor?l:Qo(e,s.head,a&&a.head,n,i);(r||l!=s.anchor||c!=s.head)&&(r||(r=t.ranges.slice(0,o)),r[o]=new co(l,c))}return r?uo(e.cm,r,t.primIndex):t}function Zo(e,t,n,i,r){var o=tt(e,t.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var a=o.markedSpans[s],l=a.marker,c="selectLeft"in l?!l.selectLeft:l.inclusiveLeft,d="selectRight"in l?!l.selectRight:l.inclusiveRight;if((null==a.from||(c?a.from<=t.ch:a.from<t.ch))&&(null==a.to||(d?a.to>=t.ch:a.to>t.ch))){if(r&&(xe(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(n){var u=l.find(i<0?1:-1),h=void 0;if((i<0?d:c)&&(u=$o(e,u,-i,u&&u.line==t.line?o:null)),u&&u.line==t.line&&(h=dt(u,n))&&(i<0?h<0:h>0))return Zo(e,u,t,i,r)}var p=l.find(i<0?-1:1);return(i<0?c:d)&&(p=$o(e,p,i,p.line==t.line?o:null)),p?Zo(e,p,t,i,r):null}}return t}function Qo(e,t,n,i,r){var o=i||1,s=Zo(e,t,n,o,r)||!r&&Zo(e,t,n,o,!0)||Zo(e,t,n,-o,r)||!r&&Zo(e,t,n,-o,!0);return s||(e.cantEdit=!0,ct(e.first,0))}function $o(e,t,n,i){return n<0&&0==t.ch?t.line>e.first?mt(e,ct(t.line-1)):null:n>0&&t.ch==(i||tt(e,t.line)).text.length?t.line<e.first+e.size-1?ct(t.line+1,0):null:new ct(t.line,t.ch+n)}function es(e){e.setSelection(ct(e.firstLine(),0),ct(e.lastLine()),J)}function ts(e,t,n){var i={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return i.canceled=!0}};return n&&(i.update=function(t,n,r,o){t&&(i.from=mt(e,t)),n&&(i.to=mt(e,n)),r&&(i.text=r),void 0!==o&&(i.origin=o)}),xe(e,"beforeChange",e,i),e.cm&&xe(e.cm,"beforeChange",e.cm,i),i.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:i.from,to:i.to,text:i.text,origin:i.origin}}function ns(e,t,n){if(e.cm){if(!e.cm.curOp)return _r(e.cm,ns)(e,t,n);if(e.cm.state.suppressEdits)return}if(!(Ee(e,"beforeChange")||e.cm&&Ee(e.cm,"beforeChange"))||(t=ts(e,t,!0))){var i=At&&!n&&Ht(e,t.from,t.to);if(i)for(var r=i.length-1;r>=0;--r)is(e,{from:i[r].from,to:i[r].to,text:r?[""]:t.text,origin:t.origin});else is(e,t)}}function is(e,t){if(1!=t.text.length||""!=t.text[0]||0!=dt(t.from,t.to)){var n=go(e,t);Mo(e,t,n,e.cm?e.cm.curOp.id:NaN),ss(e,t,n,Gt(e,t));var i=[];xo(e,(function(e,n){n||-1!=H(i,e.history)||(us(e.history,t),i.push(e.history)),ss(e,t,null,Gt(e,t))}))}}function rs(e,t,n){var i=e.cm&&e.cm.state.suppressEdits;if(!i||n){for(var r,o=e.history,s=e.sel,a="undo"==t?o.done:o.undone,l="undo"==t?o.undone:o.done,c=0;c<a.length&&(r=a[c],n?!r.ranges||r.equals(e.sel):r.ranges);c++);if(c!=a.length){for(o.lastOrigin=o.lastSelOrigin=null;;){if(!(r=a.pop()).ranges){if(i)return void a.push(r);break}if(Ao(r,l),n&&!r.equals(e.sel))return void qo(e,r,{clearRedo:!1});s=r}var d=[];Ao(s,l),l.push({changes:d,generation:o.generation}),o.generation=r.generation||++o.maxGeneration;for(var u=Ee(e,"beforeChange")||e.cm&&Ee(e.cm,"beforeChange"),h=function(n){var i=r.changes[n];if(i.origin=t,u&&!ts(e,i,!1))return a.length=0,{};d.push(Lo(e,i));var o=n?go(e,i):ee(a);ss(e,i,o,Vo(e,i)),!n&&e.cm&&e.cm.scrollIntoView({from:i.from,to:po(i)});var s=[];xo(e,(function(e,t){t||-1!=H(s,e.history)||(us(e.history,i),s.push(e.history)),ss(e,i,null,Vo(e,i))}))},p=r.changes.length-1;p>=0;--p){var f=h(p);if(f)return f.v}}}}function os(e,t){if(0!=t&&(e.first+=t,e.sel=new lo(te(e.sel.ranges,(function(e){return new co(ct(e.anchor.line+t,e.anchor.ch),ct(e.head.line+t,e.head.ch))})),e.sel.primIndex),e.cm)){zi(e.cm,e.first,e.first-t,t);for(var n=e.cm.display,i=n.viewFrom;i<n.viewTo;i++)ji(e.cm,i,"gutter")}}function ss(e,t,n,i){if(e.cm&&!e.cm.curOp)return _r(e.cm,ss)(e,t,n,i);if(t.to.line<e.first)os(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var r=t.text.length-1-(e.first-t.from.line);os(e,r),t={from:ct(e.first,0),to:ct(t.to.line+r,t.to.ch),text:[ee(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:ct(o,tt(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=nt(e,t.from,t.to),n||(n=go(e,t)),e.cm?as(e.cm,t,i):wo(e,t,i),Yo(e,n,J),e.cantEdit&&Qo(e,ct(e.firstLine(),0))&&(e.cantEdit=!1)}}function as(e,t,n){var i=e.doc,r=e.display,o=t.from,s=t.to,a=!1,l=o.line;e.options.lineWrapping||(l=ot(nn(tt(i,o.line))),i.iter(l,s.line+1,(function(e){if(e==r.maxLine)return a=!0,!0}))),i.sel.contains(t.from,t.to)>-1&&ke(e),wo(i,t,n,Vi(e)),e.options.lineWrapping||(i.iter(l,o.line+t.text.length,(function(e){var t=un(e);t>r.maxLineLength&&(r.maxLine=e,r.maxLineLength=t,r.maxLineChanged=!0,a=!1)})),a&&(e.curOp.updateMaxLine=!0)),Rt(i,o.line),Fr(e,400);var c=t.text.length-(s.line-o.line)-1;t.full?zi(e):o.line!=s.line||1!=t.text.length||So(e.doc,t)?zi(e,o.line,s.line+1,c):ji(e,o.line,"text");var d=Ee(e,"changes"),u=Ee(e,"change");if(u||d){var h={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};u&&An(e,"change",e,h),d&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}e.display.selForContextMenu=null}function ls(e,t,n,i,r){var o;i||(i=n),dt(i,n)<0&&(n=(o=[i,n])[0],i=o[1]),"string"==typeof t&&(t=e.splitLines(t)),ns(e,{from:n,to:i,text:t,origin:r})}function cs(e,t,n,i){n<e.line?e.line+=i:t<e.line&&(e.line=t,e.ch=0)}function ds(e,t,n,i){for(var r=0;r<e.length;++r){var o=e[r],s=!0;if(o.ranges){o.copied||((o=e[r]=o.deepCopy()).copied=!0);for(var a=0;a<o.ranges.length;a++)cs(o.ranges[a].anchor,t,n,i),cs(o.ranges[a].head,t,n,i)}else{for(var l=0;l<o.changes.length;++l){var c=o.changes[l];if(n<c.from.line)c.from=ct(c.from.line+i,c.from.ch),c.to=ct(c.to.line+i,c.to.ch);else if(t<=c.to.line){s=!1;break}}s||(e.splice(0,r+1),r=0)}}}function us(e,t){var n=t.from.line,i=t.to.line,r=t.text.length-(i-n)-1;ds(e.done,n,i,r),ds(e.undone,n,i,r)}function hs(e,t,n,i){var r=t,o=t;return"number"==typeof t?o=tt(e,gt(e,t)):r=ot(t),null==r?null:(i(o,r)&&e.cm&&ji(e.cm,r,n),o)}function ps(e){this.lines=e,this.parent=null;for(var t=0,n=0;n<e.length;++n)e[n].parent=this,t+=e[n].height;this.height=t}function fs(e){this.children=e;for(var t=0,n=0,i=0;i<e.length;++i){var r=e[i];t+=r.chunkSize(),n+=r.height,r.parent=this}this.size=t,this.height=n,this.parent=null}co.prototype.from=function(){return ft(this.anchor,this.head)},co.prototype.to=function(){return pt(this.anchor,this.head)},co.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},ps.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var n=e,i=e+t;n<i;++n){var r=this.lines[n];this.height-=r.height,gn(r),An(r,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var i=0;i<t.length;++i)t[i].parent=this},iterN:function(e,t,n){for(var i=e+t;e<i;++e)if(n(this.lines[e]))return!0}},fs.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var n=0;n<this.children.length;++n){var i=this.children[n],r=i.chunkSize();if(e<r){var o=Math.min(t,r-e),s=i.height;if(i.removeInner(e,o),this.height-=s-i.height,r==o&&(this.children.splice(n--,1),i.parent=null),0==(t-=o))break;e=0}else e-=r}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof ps))){var a=[];this.collapse(a),this.children=[new ps(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,n){this.size+=t.length,this.height+=n;for(var i=0;i<this.children.length;++i){var r=this.children[i],o=r.chunkSize();if(e<=o){if(r.insertInner(e,t,n),r.lines&&r.lines.length>50){for(var s=r.lines.length%25+25,a=s;a<r.lines.length;){var l=new ps(r.lines.slice(a,a+=25));r.height-=l.height,this.children.splice(++i,0,l),l.parent=this}r.lines=r.lines.slice(0,s),this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new fs(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var n=H(e.parent.children,e);e.parent.children.splice(n+1,0,t)}else{var i=new fs(e.children);i.parent=e,e.children=[i,t],e=i}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,n){for(var i=0;i<this.children.length;++i){var r=this.children[i],o=r.chunkSize();if(e<o){var s=Math.min(t,o-e);if(r.iterN(e,s,n))return!0;if(0==(t-=s))break;e=0}else e-=o}}};var gs=function(e,t,n){if(n)for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i]);this.doc=e,this.node=t};function ms(e,t,n){dn(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&dr(e,n)}function vs(e,t,n,i){var r=new gs(e,n,i),o=e.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),hs(e,t,"widget",(function(t){var n=t.widgets||(t.widgets=[]);if(null==r.insertAt?n.push(r):n.splice(Math.min(n.length,Math.max(0,r.insertAt)),0,r),r.line=t,o&&!ln(e,t)){var i=dn(t)<e.scrollTop;rt(t,t.height+Yn(r)),i&&dr(o,r.height),o.curOp.forceUpdate=!0}return!0})),o&&An(o,"lineWidgetAdded",o,r,"number"==typeof t?t:ot(t)),r}gs.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,n=this.line,i=ot(n);if(null!=i&&t){for(var r=0;r<t.length;++r)t[r]==this&&t.splice(r--,1);t.length||(n.widgets=null);var o=Yn(this);rt(n,Math.max(0,n.height-o)),e&&(Nr(e,(function(){ms(e,n,-o),ji(e,i,"widget")})),An(e,"lineWidgetCleared",e,this,i))}},gs.prototype.changed=function(){var e=this,t=this.height,n=this.doc.cm,i=this.line;this.height=null;var r=Yn(this)-t;r&&(ln(this.doc,i)||rt(i,i.height+r),n&&Nr(n,(function(){n.curOp.forceUpdate=!0,ms(n,i,r),An(n,"lineWidgetChanged",n,e,ot(i))})))},Te(gs);var ys=0,bs=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++ys};function Ss(e,t,n,i,r){if(i&&i.shared)return xs(e,t,n,i,r);if(e.cm&&!e.cm.curOp)return _r(e.cm,Ss)(e,t,n,i,r);var o=new bs(e,r),s=dt(t,n);if(i&&j(i,o,!1),s>0||0==s&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=I("span",[o.replacedWith],"CodeMirror-widget"),i.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),i.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(tn(e,t.line,t,n,o)||t.line!=n.line&&tn(e,n.line,t,n,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");_t()}o.addToHistory&&Mo(e,{from:t,to:n,origin:"markText"},e.sel,NaN);var a,l=t.line,c=e.cm;if(e.iter(l,n.line+1,(function(i){c&&o.collapsed&&!c.options.lineWrapping&&nn(i)==c.display.maxLine&&(a=!0),o.collapsed&&l!=t.line&&rt(i,0),Ut(i,new Vt(o,l==t.line?t.ch:null,l==n.line?n.ch:null),e.cm&&e.cm.curOp),++l})),o.collapsed&&e.iter(t.line,n.line+1,(function(t){ln(e,t)&&rt(t,0)})),o.clearOnEnter&&be(o,"beforeCursorEnter",(function(){return o.clear()})),o.readOnly&&(Nt(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++ys,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)zi(c,t.line,n.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var d=t.line;d<=n.line;d++)ji(c,d,"text");o.atomic&&Ko(c.doc),An(c,"markerAdded",c,o)}return o}bs.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&Lr(e),Ee(this,"clear")){var n=this.find();n&&An(this,"clear",n.from,n.to)}for(var i=null,r=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=Bt(s.markedSpans,this);e&&!this.collapsed?ji(e,ot(s),"text"):e&&(null!=a.to&&(r=ot(s)),null!=a.from&&(i=ot(s))),s.markedSpans=Ft(s.markedSpans,a),null==a.from&&this.collapsed&&!ln(this.doc,s)&&e&&rt(s,Ai(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var l=0;l<this.lines.length;++l){var c=nn(this.lines[l]),d=un(c);d>e.display.maxLineLength&&(e.display.maxLine=c,e.display.maxLineLength=d,e.display.maxLineChanged=!0)}null!=i&&e&&this.collapsed&&zi(e,i,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Ko(e.doc)),e&&An(e,"markerCleared",e,this,i,r),t&&Pr(e),this.parent&&this.parent.clear()}},bs.prototype.find=function(e,t){var n,i;null==e&&"bookmark"==this.type&&(e=1);for(var r=0;r<this.lines.length;++r){var o=this.lines[r],s=Bt(o.markedSpans,this);if(null!=s.from&&(n=ct(t?o:ot(o),s.from),-1==e))return n;if(null!=s.to&&(i=ct(t?o:ot(o),s.to),1==e))return i}return n&&{from:n,to:i}},bs.prototype.changed=function(){var e=this,t=this.find(-1,!0),n=this,i=this.doc.cm;t&&i&&Nr(i,(function(){var r=t.line,o=ot(t.line),s=oi(i,o);if(s&&(fi(s),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!ln(n.doc,r)&&null!=n.height){var a=n.height;n.height=null;var l=Yn(n)-a;l&&rt(r,r.height+l)}An(i,"markerChanged",i,e)}))},bs.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=H(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},bs.prototype.detachLine=function(e){if(this.lines.splice(H(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Te(bs);var ws=function(e,t){this.markers=e,this.primary=t;for(var n=0;n<e.length;++n)e[n].parent=this};function xs(e,t,n,i,r){(i=j(i)).shared=!1;var o=[Ss(e,t,n,i,r)],s=o[0],a=i.widgetNode;return xo(e,(function(e){a&&(i.widgetNode=a.cloneNode(!0)),o.push(Ss(e,mt(e,t),mt(e,n),i,r));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=ee(o)})),new ws(o,s)}function Cs(e){return e.findMarks(ct(e.first,0),e.clipPos(ct(e.lastLine())),(function(e){return e.parent}))}function ks(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=i.find(),o=e.clipPos(r.from),s=e.clipPos(r.to);if(dt(o,s)){var a=Ss(e,o,s,i.primary,i.primary.type);i.markers.push(a),a.parent=i}}}function Es(e){for(var t=function(t){var n=e[t],i=[n.primary.doc];xo(n.primary.doc,(function(e){return i.push(e)}));for(var r=0;r<n.markers.length;r++){var o=n.markers[r];-1==H(i,o.doc)&&(o.parent=null,n.markers.splice(r--,1))}},n=0;n<e.length;n++)t(n)}ws.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();An(this,"clear")}},ws.prototype.find=function(e,t){return this.primary.find(e,t)},Te(ws);var Ts=0,Ls=function(e,t,n,i,r){if(!(this instanceof Ls))return new Ls(e,t,n,i,r);null==n&&(n=0),fs.call(this,[new ps([new pn("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=n;var o=ct(n,0);this.sel=ho(o),this.history=new To(null),this.id=++Ts,this.modeOption=t,this.lineSep=i,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),wo(this,{from:o,to:o,text:e}),qo(this,ho(o),J)};Ls.prototype=re(fs.prototype,{constructor:Ls,iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,i=0;i<t.length;++i)n+=t[i].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=it(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:Br((function(e){var t=ct(this.first,0),n=this.first+this.size-1;ns(this,{from:t,to:ct(n,tt(this,n).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&hr(this.cm,0,0),qo(this,ho(t),J)})),replaceRange:function(e,t,n,i){ls(this,e,t=mt(this,t),n=n?mt(this,n):t,i)},getRange:function(e,t,n){var i=nt(this,mt(this,e),mt(this,t));return!1===n?i:""===n?i.join(""):i.join(n||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(at(this,e))return tt(this,e)},getLineNumber:function(e){return ot(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=tt(this,e)),nn(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return mt(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Br((function(e,t,n){Go(this,mt(this,"number"==typeof e?ct(e,t||0):e),null,n)})),setSelection:Br((function(e,t,n){Go(this,mt(this,e),mt(this,t||e),n)})),extendSelection:Br((function(e,t,n){Uo(this,mt(this,e),t&&mt(this,t),n)})),extendSelections:Br((function(e,t){zo(this,yt(this,e),t)})),extendSelectionsBy:Br((function(e,t){zo(this,yt(this,te(this.sel.ranges,e)),t)})),setSelections:Br((function(e,t,n){if(e.length){for(var i=[],r=0;r<e.length;r++)i[r]=new co(mt(this,e[r].anchor),mt(this,e[r].head||e[r].anchor));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),qo(this,uo(this.cm,i,t),n)}})),addSelection:Br((function(e,t,n){var i=this.sel.ranges.slice(0);i.push(new co(mt(this,e),mt(this,t||e))),qo(this,uo(this.cm,i,i.length-1),n)})),getSelection:function(e){for(var t,n=this.sel.ranges,i=0;i<n.length;i++){var r=nt(this,n[i].from(),n[i].to());t=t?t.concat(r):r}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],n=this.sel.ranges,i=0;i<n.length;i++){var r=nt(this,n[i].from(),n[i].to());!1!==e&&(r=r.join(e||this.lineSeparator())),t[i]=r}return t},replaceSelection:function(e,t,n){for(var i=[],r=0;r<this.sel.ranges.length;r++)i[r]=e;this.replaceSelections(i,t,n||"+input")},replaceSelections:Br((function(e,t,n){for(var i=[],r=this.sel,o=0;o<r.ranges.length;o++){var s=r.ranges[o];i[o]={from:s.from(),to:s.to(),text:this.splitLines(e[o]),origin:n}}for(var a=t&&"end"!=t&&vo(this,i,t),l=i.length-1;l>=0;l--)ns(this,i[l]);a?Ho(this,a):this.cm&&ur(this.cm)})),undo:Br((function(){rs(this,"undo")})),redo:Br((function(){rs(this,"redo")})),undoSelection:Br((function(){rs(this,"undo",!0)})),redoSelection:Br((function(){rs(this,"redo",!0)})),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,n=0,i=0;i<e.done.length;i++)e.done[i].ranges||++t;for(var r=0;r<e.undone.length;r++)e.undone[r].ranges||++n;return{undo:t,redo:n}},clearHistory:function(){var e=this;this.history=new To(this.history),xo(this,(function(t){return t.history=e.history}),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Bo(this.history.done),undone:Bo(this.history.undone)}},setHistory:function(e){var t=this.history=new To(this.history);t.done=Bo(e.done.slice(0),null,!0),t.undone=Bo(e.undone.slice(0),null,!0)},setGutterMarker:Br((function(e,t,n){return hs(this,e,"gutter",(function(e){var i=e.gutterMarkers||(e.gutterMarkers={});return i[t]=n,!n&&le(i)&&(e.gutterMarkers=null),!0}))})),clearGutter:Br((function(e){var t=this;this.iter((function(n){n.gutterMarkers&&n.gutterMarkers[e]&&hs(t,n,"gutter",(function(){return n.gutterMarkers[e]=null,le(n.gutterMarkers)&&(n.gutterMarkers=null),!0}))}))})),lineInfo:function(e){var t;if("number"==typeof e){if(!at(this,e))return null;if(t=e,!(e=tt(this,e)))return null}else if(null==(t=ot(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:Br((function(e,t,n){return hs(this,e,"gutter"==t?"gutter":"class",(function(e){var i="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass";if(e[i]){if(E(n).test(e[i]))return!1;e[i]+=" "+n}else e[i]=n;return!0}))})),removeLineClass:Br((function(e,t,n){return hs(this,e,"gutter"==t?"gutter":"class",(function(e){var i="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass",r=e[i];if(!r)return!1;if(null==n)e[i]=null;else{var o=r.match(E(n));if(!o)return!1;var s=o.index+o[0].length;e[i]=r.slice(0,o.index)+(o.index&&s!=r.length?" ":"")+r.slice(s)||null}return!0}))})),addLineWidget:Br((function(e,t,n){return vs(this,e,t,n)})),removeLineWidget:function(e){e.clear()},markText:function(e,t,n){return Ss(this,mt(this,e),mt(this,t),n,n&&n.type||"range")},setBookmark:function(e,t){var n={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return Ss(this,e=mt(this,e),e,n,"bookmark")},findMarksAt:function(e){var t=[],n=tt(this,(e=mt(this,e)).line).markedSpans;if(n)for(var i=0;i<n.length;++i){var r=n[i];(null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)&&t.push(r.marker.parent||r.marker)}return t},findMarks:function(e,t,n){e=mt(this,e),t=mt(this,t);var i=[],r=e.line;return this.iter(e.line,t.line+1,(function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];null!=l.to&&r==e.line&&e.ch>=l.to||null==l.from&&r!=e.line||null!=l.from&&r==t.line&&l.from>=t.ch||n&&!n(l.marker)||i.push(l.marker.parent||l.marker)}++r})),i},getAllMarks:function(){var e=[];return this.iter((function(t){var n=t.markedSpans;if(n)for(var i=0;i<n.length;++i)null!=n[i].from&&e.push(n[i].marker)})),e},posFromIndex:function(e){var t,n=this.first,i=this.lineSeparator().length;return this.iter((function(r){var o=r.text.length+i;if(o>e)return t=e,!0;e-=o,++n})),mt(this,ct(n,t))},indexFromPos:function(e){var t=(e=mt(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var n=this.lineSeparator().length;return this.iter(this.first,e.line,(function(e){t+=e.text.length+n})),t},copy:function(e){var t=new Ls(it(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,n=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to);var i=new Ls(it(this,t,n),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(i.history=this.history),(this.linked||(this.linked=[])).push({doc:i,sharedHist:e.sharedHist}),i.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],ks(i,Cs(this)),i},unlinkDoc:function(e){if(e instanceof za&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t)if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this),Es(Cs(this));break}if(e.history==this.history){var n=[e.id];xo(e,(function(e){return n.push(e.id)}),!0),e.history=new To(null),e.history.done=Bo(this.history.done,n),e.history.undone=Bo(this.history.undone,n)}},iterLinkedDocs:function(e){xo(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):Be(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Br((function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter((function(e){return e.order=null})),this.cm&&Eo(this.cm))}))}),Ls.prototype.eachLine=Ls.prototype.iter;var Ps=0;function Ds(e){var t=this;if(Rs(t),!Ce(t,e)&&!Jn(t.display,e)){Le(e),s&&(Ps=+new Date);var n=Fi(t,e,!0),i=e.dataTransfer.files;if(n&&!t.isReadOnly())if(i&&i.length&&window.FileReader&&window.File)for(var r=i.length,o=Array(r),a=0,l=function(){++a==r&&_r(t,(function(){var e={from:n=mt(t.doc,n),to:n,text:t.doc.splitLines(o.filter((function(e){return null!=e})).join(t.doc.lineSeparator())),origin:"paste"};ns(t.doc,e),Ho(t.doc,ho(mt(t.doc,n),mt(t.doc,po(e))))}))()},c=function(e,n){if(t.options.allowDropFileTypes&&-1==H(t.options.allowDropFileTypes,e.type))l();else{var i=new FileReader;i.onerror=function(){return l()},i.onload=function(){var e=i.result;/[\x00-\x08\x0e-\x1f]{2}/.test(e)||(o[n]=e),l()},i.readAsText(e)}},d=0;d<i.length;d++)c(i[d],d);else{if(t.state.draggingText&&t.doc.sel.contains(n)>-1)return t.state.draggingText(e),void setTimeout((function(){return t.display.input.focus()}),20);try{var u=e.dataTransfer.getData("Text");if(u){var h;if(t.state.draggingText&&!t.state.draggingText.copy&&(h=t.listSelections()),Yo(t.doc,ho(n,n)),h)for(var p=0;p<h.length;++p)ls(t.doc,"",h[p].anchor,h[p].head,"drag");t.replaceSelection(u,"around","paste"),t.display.input.focus()}}catch(f){}}}}function Ms(e,t){if(s&&(!e.state.draggingText||+new Date-Ps<100))Me(t);else if(!Ce(e,t)&&!Jn(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!p)){var n=M("img",null,null,"position: fixed; left: 0; top: 0;");n.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",h&&(n.width=n.height=1,e.display.wrapper.appendChild(n),n._top=n.offsetTop),t.dataTransfer.setDragImage(n,0,0),h&&n.parentNode.removeChild(n)}}function Is(e,t){var n=Fi(e,t);if(n){var i=document.createDocumentFragment();Ki(e,n,i),e.display.dragCursor||(e.display.dragCursor=M("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),D(e.display.dragCursor,i)}}function Rs(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function As(e){if(document.getElementsByClassName){for(var t=document.getElementsByClassName("CodeMirror"),n=[],i=0;i<t.length;i++){var r=t[i].CodeMirror;r&&n.push(r)}n.length&&n[0].operation((function(){for(var t=0;t<n.length;t++)e(n[t])}))}}var Os=!1;function Ns(){Os||(_s(),Os=!0)}function _s(){var e;be(window,"resize",(function(){null==e&&(e=setTimeout((function(){e=null,As(Vs)}),100))})),be(window,"blur",(function(){return As(nr)}))}function Vs(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}for(var Bs={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Fs=0;Fs<10;Fs++)Bs[Fs+48]=Bs[Fs+96]=String(Fs);for(var Us=65;Us<=90;Us++)Bs[Us]=String.fromCharCode(Us);for(var zs=1;zs<=12;zs++)Bs[zs+111]=Bs[zs+63235]="F"+zs;var js={};function Gs(e){var t,n,i,r,o=e.split(/-(?!$)/);e=o[o.length-1];for(var s=0;s<o.length-1;s++){var a=o[s];if(/^(cmd|meta|m)$/i.test(a))r=!0;else if(/^a(lt)?$/i.test(a))t=!0;else if(/^(c|ctrl|control)$/i.test(a))n=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);i=!0}}return t&&(e="Alt-"+e),n&&(e="Ctrl-"+e),r&&(e="Cmd-"+e),i&&(e="Shift-"+e),e}function Ws(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];if(/^(name|fallthrough|(de|at)tach)$/.test(n))continue;if("..."==i){delete e[n];continue}for(var r=te(n.split(" "),Gs),o=0;o<r.length;o++){var s=void 0,a=void 0;o==r.length-1?(a=r.join(" "),s=i):(a=r.slice(0,o+1).join(" "),s="...");var l=t[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else t[a]=s}delete e[n]}for(var c in t)e[c]=t[c];return e}function Hs(e,t,n,i){var r=(t=Ks(t)).call?t.call(e,i):t[e];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&n(r))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return Hs(e,t.fallthrough,n,i);for(var o=0;o<t.fallthrough.length;o++){var s=Hs(e,t.fallthrough[o],n,i);if(s)return s}}}function qs(e){var t="string"==typeof e?e:Bs[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function Ys(e,t,n){var i=e;return t.altKey&&"Alt"!=i&&(e="Alt-"+e),(C?t.metaKey:t.ctrlKey)&&"Ctrl"!=i&&(e="Ctrl-"+e),(C?t.ctrlKey:t.metaKey)&&"Mod"!=i&&(e="Cmd-"+e),!n&&t.shiftKey&&"Shift"!=i&&(e="Shift-"+e),e}function Js(e,t){if(h&&34==e.keyCode&&e.char)return!1;var n=Bs[e.keyCode];return null!=n&&!e.altGraphKey&&(3==e.keyCode&&e.code&&(n=e.code),Ys(n,e,t))}function Ks(e){return"string"==typeof e?js[e]:e}function Xs(e,t){for(var n=e.doc.sel.ranges,i=[],r=0;r<n.length;r++){for(var o=t(n[r]);i.length&&dt(o.from,ee(i).to)<=0;){var s=i.pop();if(dt(s.from,o.from)<0){o.from=s.from;break}}i.push(o)}Nr(e,(function(){for(var t=i.length-1;t>=0;t--)ls(e.doc,"",i[t].from,i[t].to,"+delete");ur(e)}))}function Zs(e,t,n){var i=ue(e.text,t+n,n);return i<0||i>e.text.length?null:i}function Qs(e,t,n){var i=Zs(e,t.ch,n);return null==i?null:new ct(t.line,i,n<0?"after":"before")}function $s(e,t,n,i,r){if(e){"rtl"==t.doc.direction&&(r=-r);var o=ve(n,t.doc.direction);if(o){var s,a=r<0?ee(o):o[0],l=r<0==(1==a.level)?"after":"before";if(a.level>0||"rtl"==t.doc.direction){var c=si(t,n);s=r<0?n.text.length-1:0;var d=ai(t,c,s).top;s=he((function(e){return ai(t,c,e).top==d}),r<0==(1==a.level)?a.from:a.to-1,s),"before"==l&&(s=Zs(n,s,1))}else s=r<0?a.to:a.from;return new ct(i,s,l)}}return new ct(i,r<0?n.text.length:0,r<0?"before":"after")}function ea(e,t,n,i){var r=ve(t,e.doc.direction);if(!r)return Qs(t,n,i);n.ch>=t.text.length?(n.ch=t.text.length,n.sticky="before"):n.ch<=0&&(n.ch=0,n.sticky="after");var o=ge(r,n.ch,n.sticky),s=r[o];if("ltr"==e.doc.direction&&s.level%2==0&&(i>0?s.to>n.ch:s.from<n.ch))return Qs(t,n,i);var a,l=function(e,n){return Zs(t,e instanceof ct?e.ch:e,n)},c=function(n){return e.options.lineWrapping?(a=a||si(e,t),Pi(e,t,a,n)):{begin:0,end:t.text.length}},d=c("before"==n.sticky?l(n,-1):n.ch);if("rtl"==e.doc.direction||1==s.level){var u=1==s.level==i<0,h=l(n,u?1:-1);if(null!=h&&(u?h<=s.to&&h<=d.end:h>=s.from&&h>=d.begin)){var p=u?"before":"after";return new ct(n.line,h,p)}}var f=function(e,t,i){for(var o=function(e,t){return t?new ct(n.line,l(e,1),"before"):new ct(n.line,e,"after")};e>=0&&e<r.length;e+=t){var s=r[e],a=t>0==(1!=s.level),c=a?i.begin:l(i.end,-1);if(s.from<=c&&c<s.to)return o(c,a);if(c=a?s.from:l(s.to,-1),i.begin<=c&&c<i.end)return o(c,a)}},g=f(o+i,i,d);if(g)return g;var m=i>0?d.end:l(d.begin,-1);return null==m||i>0&&m==t.text.length||!(g=f(i>0?0:r.length-1,i,c(m)))?null:g}js.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},js.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},js.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},js.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},js.default=b?js.macDefault:js.pcDefault;var ta={selectAll:es,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),J)},killLine:function(e){return Xs(e,(function(t){if(t.empty()){var n=tt(e.doc,t.head.line).text.length;return t.head.ch==n&&t.head.line<e.lastLine()?{from:t.head,to:ct(t.head.line+1,0)}:{from:t.head,to:ct(t.head.line,n)}}return{from:t.from(),to:t.to()}}))},deleteLine:function(e){return Xs(e,(function(t){return{from:ct(t.from().line,0),to:mt(e.doc,ct(t.to().line+1,0))}}))},delLineLeft:function(e){return Xs(e,(function(e){return{from:ct(e.from().line,0),to:e.from()}}))},delWrappedLineLeft:function(e){return Xs(e,(function(t){var n=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:n},"div"),to:t.from()}}))},delWrappedLineRight:function(e){return Xs(e,(function(t){var n=e.charCoords(t.head,"div").top+5,i=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:n},"div");return{from:t.from(),to:i}}))},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(ct(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(ct(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy((function(t){return na(e,t.head.line)}),{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy((function(t){return ra(e,t.head)}),{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy((function(t){return ia(e,t.head.line)}),{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy((function(t){var n=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:n},"div")}),X)},goLineLeft:function(e){return e.extendSelectionsBy((function(t){var n=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:n},"div")}),X)},goLineLeftSmart:function(e){return e.extendSelectionsBy((function(t){var n=e.cursorCoords(t.head,"div").top+5,i=e.coordsChar({left:0,top:n},"div");return i.ch<e.getLine(i.line).search(/\S/)?ra(e,t.head):i}),X)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"codepoint")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],n=e.listSelections(),i=e.options.tabSize,r=0;r<n.length;r++){var o=n[r].from(),s=G(e.getLine(o.line),o.ch,i);t.push($(i-s%i))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return Nr(e,(function(){for(var t=e.listSelections(),n=[],i=0;i<t.length;i++)if(t[i].empty()){var r=t[i].head,o=tt(e.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new ct(r.line,r.ch-1)),r.ch>0)r=new ct(r.line,r.ch+1),e.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),ct(r.line,r.ch-2),r,"+transpose");else if(r.line>e.doc.first){var s=tt(e.doc,r.line-1).text;s&&(r=new ct(r.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+s.charAt(s.length-1),ct(r.line-1,s.length-1),r,"+transpose"))}n.push(new co(r,r))}e.setSelections(n)}))},newlineAndIndent:function(e){return Nr(e,(function(){for(var t=e.listSelections(),n=t.length-1;n>=0;n--)e.replaceRange(e.doc.lineSeparator(),t[n].anchor,t[n].head,"+input");t=e.listSelections();for(var i=0;i<t.length;i++)e.indentLine(t[i].from().line,null,!0);ur(e)}))},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function na(e,t){var n=tt(e.doc,t),i=nn(n);return i!=n&&(t=ot(i)),$s(!0,e,i,t,1)}function ia(e,t){var n=tt(e.doc,t),i=rn(n);return i!=n&&(t=ot(i)),$s(!0,e,n,t,-1)}function ra(e,t){var n=na(e,t.line),i=tt(e.doc,n.line),r=ve(i,e.doc.direction);if(!r||0==r[0].level){var o=Math.max(n.ch,i.text.search(/\S/)),s=t.line==n.line&&t.ch<=o&&t.ch;return ct(n.line,s?0:o,n.sticky)}return n}function oa(e,t,n){if("string"==typeof t&&!(t=ta[t]))return!1;e.display.input.ensurePolled();var i=e.display.shift,r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n&&(e.display.shift=!1),r=t(e)!=Y}finally{e.display.shift=i,e.state.suppressEdits=!1}return r}function sa(e,t,n){for(var i=0;i<e.state.keyMaps.length;i++){var r=Hs(t,e.state.keyMaps[i],n,e);if(r)return r}return e.options.extraKeys&&Hs(t,e.options.extraKeys,n,e)||Hs(t,e.options.keyMap,n,e)}var aa=new W;function la(e,t,n,i){var r=e.state.keySeq;if(r){if(qs(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:aa.set(50,(function(){e.state.keySeq==r&&(e.state.keySeq=null,e.display.input.reset())})),ca(e,r+" "+t,n,i))return!0}return ca(e,t,n,i)}function ca(e,t,n,i){var r=sa(e,t,i);return"multi"==r&&(e.state.keySeq=t),"handled"==r&&An(e,"keyHandled",e,t,n),"handled"!=r&&"multi"!=r||(Le(n),Qi(e)),!!r}function da(e,t){var n=Js(t,!0);return!!n&&(t.shiftKey&&!e.state.keySeq?la(e,"Shift-"+n,t,(function(t){return oa(e,t,!0)}))||la(e,n,t,(function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return oa(e,t)})):la(e,n,t,(function(t){return oa(e,t)})))}function ua(e,t,n){return la(e,"'"+n+"'",t,(function(t){return oa(e,t,!0)}))}var ha=null;function pa(e){var t=this;if((!e.target||e.target==t.display.input.getField())&&(t.curOp.focus=A(B(t)),!Ce(t,e))){s&&a<11&&27==e.keyCode&&(e.returnValue=!1);var i=e.keyCode;t.display.shift=16==i||e.shiftKey;var r=da(t,e);h&&(ha=r?i:null,r||88!=i||Ue||!(b?e.metaKey:e.ctrlKey)||t.replaceSelection("",null,"cut")),n&&!b&&!r&&46==i&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=i||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||fa(t)}}function fa(e){var t=e.display.lineDiv;function n(e){18!=e.keyCode&&e.altKey||(L(t,"CodeMirror-crosshair"),we(document,"keyup",n),we(document,"mouseover",n))}O(t,"CodeMirror-crosshair"),be(document,"keyup",n),be(document,"mouseover",n)}function ga(e){16==e.keyCode&&(this.doc.sel.shift=!1),Ce(this,e)}function ma(e){var t=this;if((!e.target||e.target==t.display.input.getField())&&!(Jn(t.display,e)||Ce(t,e)||e.ctrlKey&&!e.altKey||b&&e.metaKey)){var n=e.keyCode,i=e.charCode;if(h&&n==ha)return ha=null,void Le(e);if(!h||e.which&&!(e.which<10)||!da(t,e)){var r=String.fromCharCode(null==i?n:i);"\b"!=r&&(ua(t,e,r)||t.display.input.onKeyPress(e))}}}var va,ya,ba=400,Sa=function(e,t,n){this.time=e,this.pos=t,this.button=n};function wa(e,t){var n=+new Date;return ya&&ya.compare(n,e,t)?(va=ya=null,"triple"):va&&va.compare(n,e,t)?(ya=new Sa(n,e,t),va=null,"double"):(va=new Sa(n,e,t),ya=null,"single")}function xa(e){var t=this,n=t.display;if(!(Ce(t,e)||n.activeTouch&&n.input.supportsTouch()))if(n.input.ensurePolled(),n.shift=e.shiftKey,Jn(n,e))l||(n.scroller.draggable=!1,setTimeout((function(){return n.scroller.draggable=!0}),100));else if(!Ia(t,e)){var i=Fi(t,e),r=Re(e),o=i?wa(i,r):"single";U(t).focus(),1==r&&t.state.selectingText&&t.state.selectingText(e),i&&Ca(t,r,i,o,e)||(1==r?i?Ea(t,i,o,e):Ie(e)==n.scroller&&Le(e):2==r?(i&&Uo(t.doc,i),setTimeout((function(){return n.input.focus()}),20)):3==r&&(k?t.display.input.onContextMenu(e):er(t)))}}function Ca(e,t,n,i,r){var o="Click";return"double"==i?o="Double"+o:"triple"==i&&(o="Triple"+o),la(e,Ys(o=(1==t?"Left":2==t?"Middle":"Right")+o,r),r,(function(t){if("string"==typeof t&&(t=ta[t]),!t)return!1;var i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i=t(e,n)!=Y}finally{e.state.suppressEdits=!1}return i}))}function ka(e,t,n){var i=e.getOption("configureMouse"),r=i?i(e,t,n):{};if(null==r.unit){var o=S?n.shiftKey&&n.metaKey:n.altKey;r.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==r.extend||e.doc.extend)&&(r.extend=e.doc.extend||n.shiftKey),null==r.addNew&&(r.addNew=b?n.metaKey:n.ctrlKey),null==r.moveOnDrag&&(r.moveOnDrag=!(b?n.altKey:n.ctrlKey)),r}function Ea(e,t,n,i){s?setTimeout(z($i,e),0):e.curOp.focus=A(B(e));var r,o=ka(e,n,i),a=e.doc.sel;e.options.dragDrop&&Ne&&!e.isReadOnly()&&"single"==n&&(r=a.contains(t))>-1&&(dt((r=a.ranges[r]).from(),t)<0||t.xRel>0)&&(dt(r.to(),t)>0||t.xRel<0)?Ta(e,i,t,o):Pa(e,i,t,o)}function Ta(e,t,n,i){var r=e.display,o=!1,c=_r(e,(function(t){l&&(r.scroller.draggable=!1),e.state.draggingText=!1,e.state.delayingBlurEvent&&(e.hasFocus()?e.state.delayingBlurEvent=!1:er(e)),we(r.wrapper.ownerDocument,"mouseup",c),we(r.wrapper.ownerDocument,"mousemove",d),we(r.scroller,"dragstart",u),we(r.scroller,"drop",c),o||(Le(t),i.addNew||Uo(e.doc,n,null,null,i.extend),l&&!p||s&&9==a?setTimeout((function(){r.wrapper.ownerDocument.body.focus({preventScroll:!0}),r.input.focus()}),20):r.input.focus())})),d=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},u=function(){return o=!0};l&&(r.scroller.draggable=!0),e.state.draggingText=c,c.copy=!i.moveOnDrag,be(r.wrapper.ownerDocument,"mouseup",c),be(r.wrapper.ownerDocument,"mousemove",d),be(r.scroller,"dragstart",u),be(r.scroller,"drop",c),e.state.delayingBlurEvent=!0,setTimeout((function(){return r.input.focus()}),20),r.scroller.dragDrop&&r.scroller.dragDrop()}function La(e,t,n){if("char"==n)return new co(t,t);if("word"==n)return e.findWordAt(t);if("line"==n)return new co(ct(t.line,0),mt(e.doc,ct(t.line+1,0)));var i=n(e,t);return new co(i.from,i.to)}function Pa(e,t,n,i){s&&er(e);var r=e.display,o=e.doc;Le(t);var a,l,c=o.sel,d=c.ranges;if(i.addNew&&!i.extend?(l=o.sel.contains(n),a=l>-1?d[l]:new co(n,n)):(a=o.sel.primary(),l=o.sel.primIndex),"rectangle"==i.unit)i.addNew||(a=new co(n,n)),n=Fi(e,t,!0,!0),l=-1;else{var u=La(e,n,i.unit);a=i.extend?Fo(a,u.anchor,u.head,i.extend):u}i.addNew?-1==l?(l=d.length,qo(o,uo(e,d.concat([a]),l),{scroll:!1,origin:"*mouse"})):d.length>1&&d[l].empty()&&"char"==i.unit&&!i.extend?(qo(o,uo(e,d.slice(0,l).concat(d.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),c=o.sel):jo(o,l,a,K):(l=0,qo(o,new lo([a],0),K),c=o.sel);var h=n;function p(t){if(0!=dt(h,t))if(h=t,"rectangle"==i.unit){for(var r=[],s=e.options.tabSize,d=G(tt(o,n.line).text,n.ch,s),u=G(tt(o,t.line).text,t.ch,s),p=Math.min(d,u),f=Math.max(d,u),g=Math.min(n.line,t.line),m=Math.min(e.lastLine(),Math.max(n.line,t.line));g<=m;g++){var v=tt(o,g).text,y=Z(v,p,s);p==f?r.push(new co(ct(g,y),ct(g,y))):v.length>y&&r.push(new co(ct(g,y),ct(g,Z(v,f,s))))}r.length||r.push(new co(n,n)),qo(o,uo(e,c.ranges.slice(0,l).concat(r),l),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var b,S=a,w=La(e,t,i.unit),x=S.anchor;dt(w.anchor,x)>0?(b=w.head,x=ft(S.from(),w.anchor)):(b=w.anchor,x=pt(S.to(),w.head));var C=c.ranges.slice(0);C[l]=Da(e,new co(mt(o,x),b)),qo(o,uo(e,C,l),K)}}var f=r.wrapper.getBoundingClientRect(),g=0;function m(t){var n=++g,s=Fi(e,t,!0,"rectangle"==i.unit);if(s)if(0!=dt(s,h)){e.curOp.focus=A(B(e)),p(s);var a=or(r,o);(s.line>=a.to||s.line<a.from)&&setTimeout(_r(e,(function(){g==n&&m(t)})),150)}else{var l=t.clientY<f.top?-20:t.clientY>f.bottom?20:0;l&&setTimeout(_r(e,(function(){g==n&&(r.scroller.scrollTop+=l,m(t))})),50)}}function v(t){e.state.selectingText=!1,g=1/0,t&&(Le(t),r.input.focus()),we(r.wrapper.ownerDocument,"mousemove",y),we(r.wrapper.ownerDocument,"mouseup",b),o.history.lastSelOrigin=null}var y=_r(e,(function(e){0!==e.buttons&&Re(e)?m(e):v(e)})),b=_r(e,v);e.state.selectingText=b,be(r.wrapper.ownerDocument,"mousemove",y),be(r.wrapper.ownerDocument,"mouseup",b)}function Da(e,t){var n=t.anchor,i=t.head,r=tt(e.doc,n.line);if(0==dt(n,i)&&n.sticky==i.sticky)return t;var o=ve(r);if(!o)return t;var s=ge(o,n.ch,n.sticky),a=o[s];if(a.from!=n.ch&&a.to!=n.ch)return t;var l,c=s+(a.from==n.ch==(1!=a.level)?0:1);if(0==c||c==o.length)return t;if(i.line!=n.line)l=(i.line-n.line)*("ltr"==e.doc.direction?1:-1)>0;else{var d=ge(o,i.ch,i.sticky),u=d-s||(i.ch-n.ch)*(1==a.level?-1:1);l=d==c-1||d==c?u<0:u>0}var h=o[c+(l?-1:0)],p=l==(1==h.level),f=p?h.from:h.to,g=p?"after":"before";return n.ch==f&&n.sticky==g?t:new co(new ct(n.line,f,g),i)}function Ma(e,t,n,i){var r,o;if(t.touches)r=t.touches[0].clientX,o=t.touches[0].clientY;else try{r=t.clientX,o=t.clientY}catch(d){return!1}if(r>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;i&&Le(t);var s=e.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!Ee(e,n))return De(t);o-=a.top-s.viewOffset;for(var l=0;l<e.display.gutterSpecs.length;++l){var c=s.gutters.childNodes[l];if(c&&c.getBoundingClientRect().right>=r)return xe(e,n,e,st(e.doc,o),e.display.gutterSpecs[l].className,t),De(t)}}function Ia(e,t){return Ma(e,t,"gutterClick",!0)}function Ra(e,t){Jn(e.display,t)||Aa(e,t)||Ce(e,t,"contextmenu")||k||e.display.input.onContextMenu(t)}function Aa(e,t){return!!Ee(e,"gutterContextMenu")&&Ma(e,t,"gutterContextMenu",!1)}function Oa(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),mi(e)}Sa.prototype.compare=function(e,t,n){return this.time+ba>e&&0==dt(t,this.pos)&&n==this.button};var Na={toString:function(){return"CodeMirror.Init"}},_a={},Va={};function Ba(e){var t=e.optionHandlers;function n(n,i,r,o){e.defaults[n]=i,r&&(t[n]=o?function(e,t,n){n!=Na&&r(e,t,n)}:r)}e.defineOption=n,e.Init=Na,n("value","",(function(e,t){return e.setValue(t)}),!0),n("mode",null,(function(e,t){e.doc.modeOption=t,yo(e)}),!0),n("indentUnit",2,yo,!0),n("indentWithTabs",!1),n("smartIndent",!0),n("tabSize",4,(function(e){bo(e),mi(e),zi(e)}),!0),n("lineSeparator",null,(function(e,t){if(e.doc.lineSep=t,t){var n=[],i=e.doc.first;e.doc.iter((function(e){for(var r=0;;){var o=e.text.indexOf(t,r);if(-1==o)break;r=o+t.length,n.push(ct(i,o))}i++}));for(var r=n.length-1;r>=0;r--)ls(e.doc,t,n[r],ct(n[r].line,n[r].ch+t.length))}})),n("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,(function(e,t,n){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),n!=Na&&e.refresh()})),n("specialCharPlaceholder",Sn,(function(e){return e.refresh()}),!0),n("electricChars",!0),n("inputStyle",y?"contenteditable":"textarea",(function(){throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),n("spellcheck",!1,(function(e,t){return e.getInputField().spellcheck=t}),!0),n("autocorrect",!1,(function(e,t){return e.getInputField().autocorrect=t}),!0),n("autocapitalize",!1,(function(e,t){return e.getInputField().autocapitalize=t}),!0),n("rtlMoveVisually",!w),n("wholeLineUpdateBefore",!0),n("theme","default",(function(e){Oa(e),to(e)}),!0),n("keyMap","default",(function(e,t,n){var i=Ks(t),r=n!=Na&&Ks(n);r&&r.detach&&r.detach(e,i),i.attach&&i.attach(e,r||null)})),n("extraKeys",null),n("configureMouse",null),n("lineWrapping",!1,Ua,!0),n("gutters",[],(function(e,t){e.display.gutterSpecs=$r(t,e.options.lineNumbers),to(e)}),!0),n("fixedGutter",!0,(function(e,t){e.display.gutters.style.left=t?_i(e.display)+"px":"0",e.refresh()}),!0),n("coverGutterNextToScrollbar",!1,(function(e){return xr(e)}),!0),n("scrollbarStyle","native",(function(e){Er(e),xr(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)}),!0),n("lineNumbers",!1,(function(e,t){e.display.gutterSpecs=$r(e.options.gutters,t),to(e)}),!0),n("firstLineNumber",1,to,!0),n("lineNumberFormatter",(function(e){return e}),to,!0),n("showCursorWhenSelecting",!1,Yi,!0),n("resetSelectionOnContextMenu",!0),n("lineWiseCopyCut",!0),n("pasteLinesPerSelection",!0),n("selectionsMayTouch",!1),n("readOnly",!1,(function(e,t){"nocursor"==t&&(nr(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)})),n("screenReaderLabel",null,(function(e,t){t=""===t?null:t,e.display.input.screenReaderLabelChanged(t)})),n("disableInput",!1,(function(e,t){t||e.display.input.reset()}),!0),n("dragDrop",!0,Fa),n("allowDropFileTypes",null),n("cursorBlinkRate",530),n("cursorScrollMargin",0),n("cursorHeight",1,Yi,!0),n("singleCursorHeightPerLine",!0,Yi,!0),n("workTime",100),n("workDelay",100),n("flattenSpans",!0,bo,!0),n("addModeClass",!1,bo,!0),n("pollInterval",100),n("undoDepth",200,(function(e,t){return e.doc.history.undoDepth=t})),n("historyEventDelay",1250),n("viewportMargin",10,(function(e){return e.refresh()}),!0),n("maxHighlightLength",1e4,bo,!0),n("moveInputWithCursor",!0,(function(e,t){t||e.display.input.resetPosition()})),n("tabindex",null,(function(e,t){return e.display.input.getField().tabIndex=t||""})),n("autofocus",null),n("direction","ltr",(function(e,t){return e.doc.setDirection(t)}),!0),n("phrases",null)}function Fa(e,t,n){if(!t!=!(n&&n!=Na)){var i=e.display.dragFunctions,r=t?be:we;r(e.display.scroller,"dragstart",i.start),r(e.display.scroller,"dragenter",i.enter),r(e.display.scroller,"dragover",i.over),r(e.display.scroller,"dragleave",i.leave),r(e.display.scroller,"drop",i.drop)}}function Ua(e){e.options.lineWrapping?(O(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(L(e.display.wrapper,"CodeMirror-wrap"),hn(e)),Bi(e),zi(e),mi(e),setTimeout((function(){return xr(e)}),100)}function za(e,t){var n=this;if(!(this instanceof za))return new za(e,t);this.options=t=t?j(t):{},j(_a,t,!1);var i=t.value;"string"==typeof i?i=new Ls(i,t.mode,null,t.lineSeparator,t.direction):t.mode&&(i.modeOption=t.mode),this.doc=i;var r=new za.inputStyles[t.inputStyle](this),o=this.display=new no(e,i,r,t);for(var c in o.wrapper.CodeMirror=this,Oa(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Er(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new W,keySeq:null,specialChars:null},t.autofocus&&!y&&o.input.focus(),s&&a<11&&setTimeout((function(){return n.display.input.reset(!0)}),20),ja(this),Ns(),Lr(this),this.curOp.forceUpdate=!0,Co(this,i),t.autofocus&&!y||this.hasFocus()?setTimeout((function(){n.hasFocus()&&!n.state.focused&&tr(n)}),20):nr(this),Va)Va.hasOwnProperty(c)&&Va[c](this,t[c],Na);Qr(this),t.finishInit&&t.finishInit(this);for(var d=0;d<Ga.length;++d)Ga[d](this);Pr(this),l&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function ja(e){var t=e.display;be(t.scroller,"mousedown",_r(e,xa)),be(t.scroller,"dblclick",s&&a<11?_r(e,(function(t){if(!Ce(e,t)){var n=Fi(e,t);if(n&&!Ia(e,t)&&!Jn(e.display,t)){Le(t);var i=e.findWordAt(n);Uo(e.doc,i.anchor,i.head)}}})):function(t){return Ce(e,t)||Le(t)}),be(t.scroller,"contextmenu",(function(t){return Ra(e,t)})),be(t.input.getField(),"contextmenu",(function(n){t.scroller.contains(n.target)||Ra(e,n)}));var n,i={end:0};function r(){t.activeTouch&&(n=setTimeout((function(){return t.activeTouch=null}),1e3),(i=t.activeTouch).end=+new Date)}function o(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function l(e,t){if(null==t.left)return!0;var n=t.left-e.left,i=t.top-e.top;return n*n+i*i>400}be(t.scroller,"touchstart",(function(r){if(!Ce(e,r)&&!o(r)&&!Ia(e,r)){t.input.ensurePolled(),clearTimeout(n);var s=+new Date;t.activeTouch={start:s,moved:!1,prev:s-i.end<=300?i:null},1==r.touches.length&&(t.activeTouch.left=r.touches[0].pageX,t.activeTouch.top=r.touches[0].pageY)}})),be(t.scroller,"touchmove",(function(){t.activeTouch&&(t.activeTouch.moved=!0)})),be(t.scroller,"touchend",(function(n){var i=t.activeTouch;if(i&&!Jn(t,n)&&null!=i.left&&!i.moved&&new Date-i.start<300){var o,s=e.coordsChar(t.activeTouch,"page");o=!i.prev||l(i,i.prev)?new co(s,s):!i.prev.prev||l(i,i.prev.prev)?e.findWordAt(s):new co(ct(s.line,0),mt(e.doc,ct(s.line+1,0))),e.setSelection(o.anchor,o.head),e.focus(),Le(n)}r()})),be(t.scroller,"touchcancel",r),be(t.scroller,"scroll",(function(){t.scroller.clientHeight&&(mr(e,t.scroller.scrollTop),yr(e,t.scroller.scrollLeft,!0),xe(e,"scroll",e))})),be(t.scroller,"mousewheel",(function(t){return ao(e,t)})),be(t.scroller,"DOMMouseScroll",(function(t){return ao(e,t)})),be(t.wrapper,"scroll",(function(){return t.wrapper.scrollTop=t.wrapper.scrollLeft=0})),t.dragFunctions={enter:function(t){Ce(e,t)||Me(t)},over:function(t){Ce(e,t)||(Is(e,t),Me(t))},start:function(t){return Ms(e,t)},drop:_r(e,Ds),leave:function(t){Ce(e,t)||Rs(e)}};var c=t.input.getField();be(c,"keyup",(function(t){return ga.call(e,t)})),be(c,"keydown",_r(e,pa)),be(c,"keypress",_r(e,ma)),be(c,"focus",(function(t){return tr(e,t)})),be(c,"blur",(function(t){return nr(e,t)}))}za.defaults=_a,za.optionHandlers=Va;var Ga=[];function Wa(e,t,n,i){var r,o=e.doc;null==n&&(n="add"),"smart"==n&&(o.mode.indent?r=Ct(e,t).state:n="prev");var s=e.options.tabSize,a=tt(o,t),l=G(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c,d=a.text.match(/^\s*/)[0];if(i||/\S/.test(a.text)){if("smart"==n&&((c=o.mode.indent(r,a.text.slice(d.length),a.text))==Y||c>150)){if(!i)return;n="prev"}}else c=0,n="not";"prev"==n?c=t>o.first?G(tt(o,t-1).text,null,s):0:"add"==n?c=l+e.options.indentUnit:"subtract"==n?c=l-e.options.indentUnit:"number"==typeof n&&(c=l+n),c=Math.max(0,c);var u="",h=0;if(e.options.indentWithTabs)for(var p=Math.floor(c/s);p;--p)h+=s,u+="\t";if(h<c&&(u+=$(c-h)),u!=d)return ls(o,u,ct(t,0),ct(t,d.length),"+input"),a.stateAfter=null,!0;for(var f=0;f<o.sel.ranges.length;f++){var g=o.sel.ranges[f];if(g.head.line==t&&g.head.ch<d.length){var m=ct(t,d.length);jo(o,f,new co(m,m));break}}}za.defineInitHook=function(e){return Ga.push(e)};var Ha=null;function qa(e){Ha=e}function Ya(e,t,n,i,r){var o=e.doc;e.display.shift=!1,i||(i=o.sel);var s=+new Date-200,a="paste"==r||e.state.pasteIncoming>s,l=Be(t),c=null;if(a&&i.ranges.length>1)if(Ha&&Ha.text.join("\n")==t){if(i.ranges.length%Ha.text.length==0){c=[];for(var d=0;d<Ha.text.length;d++)c.push(o.splitLines(Ha.text[d]))}}else l.length==i.ranges.length&&e.options.pasteLinesPerSelection&&(c=te(l,(function(e){return[e]})));for(var u=e.curOp.updateInput,h=i.ranges.length-1;h>=0;h--){var p=i.ranges[h],f=p.from(),g=p.to();p.empty()&&(n&&n>0?f=ct(f.line,f.ch-n):e.state.overwrite&&!a?g=ct(g.line,Math.min(tt(o,g.line).text.length,g.ch+ee(l).length)):a&&Ha&&Ha.lineWise&&Ha.text.join("\n")==l.join("\n")&&(f=g=ct(f.line,0)));var m={from:f,to:g,text:c?c[h%c.length]:l,origin:r||(a?"paste":e.state.cutIncoming>s?"cut":"+input")};ns(e.doc,m),An(e,"inputRead",e,m)}t&&!a&&Ka(e,t),ur(e),e.curOp.updateInput<2&&(e.curOp.updateInput=u),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function Ja(e,t){var n=e.clipboardData&&e.clipboardData.getData("Text");if(n)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||!t.hasFocus()||Nr(t,(function(){return Ya(t,n,0,null,"paste")})),!0}function Ka(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var n=e.doc.sel,i=n.ranges.length-1;i>=0;i--){var r=n.ranges[i];if(!(r.head.ch>100||i&&n.ranges[i-1].head.line==r.head.line)){var o=e.getModeAt(r.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(t.indexOf(o.electricChars.charAt(a))>-1){s=Wa(e,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(tt(e.doc,r.head.line).text.slice(0,r.head.ch))&&(s=Wa(e,r.head.line,"smart"));s&&An(e,"electricInput",e,r.head.line)}}}function Xa(e){for(var t=[],n=[],i=0;i<e.doc.sel.ranges.length;i++){var r=e.doc.sel.ranges[i].head.line,o={anchor:ct(r,0),head:ct(r+1,0)};n.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:n}}function Za(e,t,n,i){e.setAttribute("autocorrect",n?"on":"off"),e.setAttribute("autocapitalize",i?"on":"off"),e.setAttribute("spellcheck",!!t)}function Qa(){var e=M("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),t=M("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return l?e.style.width="1000px":e.setAttribute("wrap","off"),m&&(e.style.border="1px solid black"),t}function $a(e){var t=e.optionHandlers,n=e.helpers={};e.prototype={constructor:e,focus:function(){U(this).focus(),this.display.input.focus()},setOption:function(e,n){var i=this.options,r=i[e];i[e]==n&&"mode"!=e||(i[e]=n,t.hasOwnProperty(e)&&_r(this,t[e])(this,n,r),xe(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](Ks(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(t[n]==e||t[n].name==e)return t.splice(n,1),!0},addOverlay:Vr((function(t,n){var i=t.token?t:e.getMode(this.options,t);if(i.startState)throw new Error("Overlays may not be stateful.");ne(this.state.overlays,{mode:i,modeSpec:t,opaque:n&&n.opaque,priority:n&&n.priority||0},(function(e){return e.priority})),this.state.modeGen++,zi(this)})),removeOverlay:Vr((function(e){for(var t=this.state.overlays,n=0;n<t.length;++n){var i=t[n].modeSpec;if(i==e||"string"==typeof e&&i.name==e)return t.splice(n,1),this.state.modeGen++,void zi(this)}})),indentLine:Vr((function(e,t,n){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),at(this.doc,e)&&Wa(this,e,t,n)})),indentSelection:Vr((function(e){for(var t=this.doc.sel.ranges,n=-1,i=0;i<t.length;i++){var r=t[i];if(r.empty())r.head.line>n&&(Wa(this,r.head.line,e,!0),n=r.head.line,i==this.doc.sel.primIndex&&ur(this));else{var o=r.from(),s=r.to(),a=Math.max(n,o.line);n=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var l=a;l<n;++l)Wa(this,l,e);var c=this.doc.sel.ranges;0==o.ch&&t.length==c.length&&c[i].from().ch>0&&jo(this.doc,i,new co(o,c[i].to()),J)}}})),getTokenAt:function(e,t){return Pt(this,e,t)},getLineTokens:function(e,t){return Pt(this,ct(e),t,!0)},getTokenTypeAt:function(e){e=mt(this.doc,e);var t,n=xt(this,tt(this.doc,e.line)),i=0,r=(n.length-1)/2,o=e.ch;if(0==o)t=n[2];else for(;;){var s=i+r>>1;if((s?n[2*s-1]:0)>=o)r=s;else{if(!(n[2*s+1]<o)){t=n[2*s+2];break}i=s+1}}var a=t?t.indexOf("overlay "):-1;return a<0?t:0==a?null:t.slice(0,a-1)},getModeAt:function(t){var n=this.doc.mode;return n.innerMode?e.innerMode(n,this.getTokenAt(t).state).mode:n},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var i=[];if(!n.hasOwnProperty(t))return i;var r=n[t],o=this.getModeAt(e);if("string"==typeof o[t])r[o[t]]&&i.push(r[o[t]]);else if(o[t])for(var s=0;s<o[t].length;s++){var a=r[o[t][s]];a&&i.push(a)}else o.helperType&&r[o.helperType]?i.push(r[o.helperType]):r[o.name]&&i.push(r[o.name]);for(var l=0;l<r._global.length;l++){var c=r._global[l];c.pred(o,this)&&-1==H(i,c.val)&&i.push(c.val)}return i},getStateAfter:function(e,t){var n=this.doc;return Ct(this,(e=gt(n,null==e?n.first+n.size-1:e))+1,t).state},cursorCoords:function(e,t){var n=this.doc.sel.primary();return Ci(this,null==e?n.head:"object"==typeof e?mt(this.doc,e):e?n.from():n.to(),t||"page")},charCoords:function(e,t){return xi(this,mt(this.doc,e),t||"page")},coordsChar:function(e,t){return Ti(this,(e=wi(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=wi(this,{top:e,left:0},t||"page").top,st(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,n){var i,r=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,r=!0),i=tt(this.doc,e)}else i=e;return Si(this,i,{top:0,left:0},t||"page",n||r).top+(r?this.doc.height-dn(i):0)},defaultTextHeight:function(){return Ai(this.display)},defaultCharWidth:function(){return Oi(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,n,i,r){var o=this.display,s=(e=Ci(this,mt(this.doc,e))).bottom,a=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==i)s=e.top;else if("above"==i||"near"==i){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==i||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>c&&(a=c-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==r?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),n&&lr(this,{left:a,top:s,right:a+t.offsetWidth,bottom:s+t.offsetHeight})},triggerOnKeyDown:Vr(pa),triggerOnKeyPress:Vr(ma),triggerOnKeyUp:ga,triggerOnMouseDown:Vr(xa),execCommand:function(e){if(ta.hasOwnProperty(e))return ta[e].call(null,this)},triggerElectric:Vr((function(e){Ka(this,e)})),findPosH:function(e,t,n,i){var r=1;t<0&&(r=-1,t=-t);for(var o=mt(this.doc,e),s=0;s<t&&!(o=el(this.doc,o,r,n,i)).hitSide;++s);return o},moveH:Vr((function(e,t){var n=this;this.extendSelectionsBy((function(i){return n.display.shift||n.doc.extend||i.empty()?el(n.doc,i.head,e,t,n.options.rtlMoveVisually):e<0?i.from():i.to()}),X)})),deleteH:Vr((function(e,t){var n=this.doc.sel,i=this.doc;n.somethingSelected()?i.replaceSelection("",null,"+delete"):Xs(this,(function(n){var r=el(i,n.head,e,t,!1);return e<0?{from:r,to:n.head}:{from:n.head,to:r}}))})),findPosV:function(e,t,n,i){var r=1,o=i;t<0&&(r=-1,t=-t);for(var s=mt(this.doc,e),a=0;a<t;++a){var l=Ci(this,s,"div");if(null==o?o=l.left:l.left=o,(s=tl(this,l,r,n)).hitSide)break}return s},moveV:Vr((function(e,t){var n=this,i=this.doc,r=[],o=!this.display.shift&&!i.extend&&i.sel.somethingSelected();if(i.extendSelectionsBy((function(s){if(o)return e<0?s.from():s.to();var a=Ci(n,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),r.push(a.left);var l=tl(n,a,e,t);return"page"==t&&s==i.sel.primary()&&dr(n,xi(n,l,"div").top-a.top),l}),X),r.length)for(var s=0;s<i.sel.ranges.length;s++)i.sel.ranges[s].goalColumn=r[s]})),findWordAt:function(e){var t=tt(this.doc,e.line).text,n=e.ch,i=e.ch;if(t){var r=this.getHelper(e,"wordChars");"before"!=e.sticky&&i!=t.length||!n?++i:--n;for(var o=t.charAt(n),s=ae(o,r)?function(e){return ae(e,r)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!ae(e)};n>0&&s(t.charAt(n-1));)--n;for(;i<t.length&&s(t.charAt(i));)++i}return new co(ct(e.line,n),ct(e.line,i))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?O(this.display.cursorDiv,"CodeMirror-overwrite"):L(this.display.cursorDiv,"CodeMirror-overwrite"),xe(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==A(B(this))},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Vr((function(e,t){hr(this,e,t)})),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-Qn(this)-this.display.barHeight,width:e.scrollWidth-Qn(this)-this.display.barWidth,clientHeight:ei(this),clientWidth:$n(this)}},scrollIntoView:Vr((function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:ct(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?pr(this,e):gr(this,e.from,e.to,e.margin)})),setSize:Vr((function(e,t){var n=this,i=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=i(e)),null!=t&&(this.display.wrapper.style.height=i(t)),this.options.lineWrapping&&gi(this);var r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,(function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){ji(n,r,"widget");break}++r})),this.curOp.forceUpdate=!0,xe(this,"refresh",this)})),operation:function(e){return Nr(this,e)},startOperation:function(){return Lr(this)},endOperation:function(){return Pr(this)},refresh:Vr((function(){var e=this.display.cachedTextHeight;zi(this),this.curOp.forceUpdate=!0,mi(this),hr(this,this.doc.scrollLeft,this.doc.scrollTop),Kr(this.display),(null==e||Math.abs(e-Ai(this.display))>.5||this.options.lineWrapping)&&Bi(this),xe(this,"refresh",this)})),swapDoc:Vr((function(e){var t=this.doc;return t.cm=null,this.state.selectingText&&this.state.selectingText(),Co(this,e),mi(this),this.display.input.reset(),hr(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,An(this,"swapDoc",this,t),t})),phrase:function(e){var t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Te(e),e.registerHelper=function(t,i,r){n.hasOwnProperty(t)||(n[t]=e[t]={_global:[]}),n[t][i]=r},e.registerGlobalHelper=function(t,i,r,o){e.registerHelper(t,i,o),n[t]._global.push({pred:r,val:o})}}function el(e,t,n,i,r){var o=t,s=n,a=tt(e,t.line),l=r&&"rtl"==e.direction?-n:n;function c(){var n=t.line+l;return!(n<e.first||n>=e.first+e.size)&&(t=new ct(n,t.ch,t.sticky),a=tt(e,n))}function d(o){var s;if("codepoint"==i){var d=a.text.charCodeAt(t.ch+(n>0?0:-1));if(isNaN(d))s=null;else{var u=n>0?d>=55296&&d<56320:d>=56320&&d<57343;s=new ct(t.line,Math.max(0,Math.min(a.text.length,t.ch+n*(u?2:1))),-n)}}else s=r?ea(e.cm,a,t,n):Qs(a,t,n);if(null==s){if(o||!c())return!1;t=$s(r,e.cm,a,t.line,l)}else t=s;return!0}if("char"==i||"codepoint"==i)d();else if("column"==i)d(!0);else if("word"==i||"group"==i)for(var u=null,h="group"==i,p=e.cm&&e.cm.getHelper(t,"wordChars"),f=!0;!(n<0)||d(!f);f=!1){var g=a.text.charAt(t.ch)||"\n",m=ae(g,p)?"w":h&&"\n"==g?"n":!h||/\s/.test(g)?null:"p";if(!h||f||m||(m="s"),u&&u!=m){n<0&&(n=1,d(),t.sticky="after");break}if(m&&(u=m),n>0&&!d(!f))break}var v=Qo(e,t,o,s,!0);return ut(o,v)&&(v.hitSide=!0),v}function tl(e,t,n,i){var r,o,s=e.doc,a=t.left;if("page"==i){var l=Math.min(e.display.wrapper.clientHeight,U(e).innerHeight||s(e).documentElement.clientHeight),c=Math.max(l-.5*Ai(e.display),3);r=(n>0?t.bottom:t.top)+n*c}else"line"==i&&(r=n>0?t.bottom+3:t.top-3);for(;(o=Ti(e,a,r)).outside;){if(n<0?r<=0:r>=s.height){o.hitSide=!0;break}r+=5*n}return o}var nl=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new W,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function il(e,t){var n=oi(e,t.line);if(!n||n.hidden)return null;var i=tt(e.doc,t.line),r=ni(n,i,t.line),o=ve(i,e.doc.direction),s="left";o&&(s=ge(o,t.ch)%2?"right":"left");var a=di(r.map,t.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function rl(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function ol(e,t){return t&&(e.bad=!0),e}function sl(e,t,n,i,r){var o="",s=!1,a=e.doc.lineSeparator(),l=!1;function c(e){return function(t){return t.id==e}}function d(){s&&(o+=a,l&&(o+=a),s=l=!1)}function u(e){e&&(d(),o+=e)}function h(t){if(1==t.nodeType){var n=t.getAttribute("cm-text");if(n)return void u(n);var o,p=t.getAttribute("cm-marker");if(p){var f=e.findMarks(ct(i,0),ct(r+1,0),c(+p));return void(f.length&&(o=f[0].find(0))&&u(nt(e.doc,o.from,o.to).join(a)))}if("false"==t.getAttribute("contenteditable"))return;var g=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length)return;g&&d();for(var m=0;m<t.childNodes.length;m++)h(t.childNodes[m]);/^(pre|p)$/i.test(t.nodeName)&&(l=!0),g&&(s=!0)}else 3==t.nodeType&&u(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;h(t),t!=n;)t=t.nextSibling,l=!1;return o}function al(e,t,n){var i;if(t==e.display.lineDiv){if(!(i=e.display.lineDiv.childNodes[n]))return ol(e.clipPos(ct(e.display.viewTo-1)),!0);t=null,n=0}else for(i=t;;i=i.parentNode){if(!i||i==e.display.lineDiv)return null;if(i.parentNode&&i.parentNode==e.display.lineDiv)break}for(var r=0;r<e.display.view.length;r++){var o=e.display.view[r];if(o.node==i)return ll(o,t,n)}}function ll(e,t,n){var i=e.text.firstChild,r=!1;if(!t||!R(i,t))return ol(ct(ot(e.line),0),!0);if(t==i&&(r=!0,t=i.childNodes[n],n=0,!t)){var o=e.rest?ee(e.rest):e.line;return ol(ct(ot(o),o.text.length),r)}var s=3==t.nodeType?t:null,a=t;for(s||1!=t.childNodes.length||3!=t.firstChild.nodeType||(s=t.firstChild,n&&(n=s.nodeValue.length));a.parentNode!=i;)a=a.parentNode;var l=e.measure,c=l.maps;function d(t,n,i){for(var r=-1;r<(c?c.length:0);r++)for(var o=r<0?l.map:c[r],s=0;s<o.length;s+=3){var a=o[s+2];if(a==t||a==n){var d=ot(r<0?e.line:e.rest[r]),u=o[s]+i;return(i<0||a!=t)&&(u=o[s+(i?1:0)]),ct(d,u)}}}var u=d(s,a,n);if(u)return ol(u,r);for(var h=a.nextSibling,p=s?s.nodeValue.length-n:0;h;h=h.nextSibling){if(u=d(h,h.firstChild,0))return ol(ct(u.line,u.ch-p),r);p+=h.textContent.length}for(var f=a.previousSibling,g=n;f;f=f.previousSibling){if(u=d(f,f.firstChild,-1))return ol(ct(u.line,u.ch+g),r);g+=f.textContent.length}}nl.prototype.init=function(e){var t=this,n=this,i=n.cm,r=n.div=e.lineDiv;function o(e){for(var t=e.target;t;t=t.parentNode){if(t==r)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(t.className))break}return!1}function s(e){if(o(e)&&!Ce(i,e)){if(i.somethingSelected())qa({lineWise:!1,text:i.getSelections()}),"cut"==e.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;var t=Xa(i);qa({lineWise:!0,text:t.text}),"cut"==e.type&&i.operation((function(){i.setSelections(t.ranges,0,J),i.replaceSelection("",null,"cut")}))}if(e.clipboardData){e.clipboardData.clearData();var s=Ha.text.join("\n");if(e.clipboardData.setData("Text",s),e.clipboardData.getData("Text")==s)return void e.preventDefault()}var a=Qa(),l=a.firstChild;Za(l),i.display.lineSpace.insertBefore(a,i.display.lineSpace.firstChild),l.value=Ha.text.join("\n");var c=A(F(r));_(l),setTimeout((function(){i.display.lineSpace.removeChild(a),c.focus(),c==r&&n.showPrimarySelection()}),50)}}r.contentEditable=!0,Za(r,i.options.spellcheck,i.options.autocorrect,i.options.autocapitalize),be(r,"paste",(function(e){!o(e)||Ce(i,e)||Ja(e,i)||a<=11&&setTimeout(_r(i,(function(){return t.updateFromDOM()})),20)})),be(r,"compositionstart",(function(e){t.composing={data:e.data,done:!1}})),be(r,"compositionupdate",(function(e){t.composing||(t.composing={data:e.data,done:!1})})),be(r,"compositionend",(function(e){t.composing&&(e.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)})),be(r,"touchstart",(function(){return n.forceCompositionEnd()})),be(r,"input",(function(){t.composing||t.readFromDOMSoon()})),be(r,"copy",s),be(r,"cut",s)},nl.prototype.screenReaderLabelChanged=function(e){e?this.div.setAttribute("aria-label",e):this.div.removeAttribute("aria-label")},nl.prototype.prepareSelection=function(){var e=Ji(this.cm,!1);return e.focus=A(F(this.div))==this.div,e},nl.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},nl.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},nl.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,i=t.doc.sel.primary(),r=i.from(),o=i.to();if(t.display.viewTo==t.display.viewFrom||r.line>=t.display.viewTo||o.line<t.display.viewFrom)e.removeAllRanges();else{var s=al(t,e.anchorNode,e.anchorOffset),a=al(t,e.focusNode,e.focusOffset);if(!s||s.bad||!a||a.bad||0!=dt(ft(s,a),r)||0!=dt(pt(s,a),o)){var l=t.display.view,c=r.line>=t.display.viewFrom&&il(t,r)||{node:l[0].measure.map[2],offset:0},d=o.line<t.display.viewTo&&il(t,o);if(!d){var u=l[l.length-1].measure,h=u.maps?u.maps[u.maps.length-1]:u.map;d={node:h[h.length-1],offset:h[h.length-2]-h[h.length-3]}}if(c&&d){var p,f=e.rangeCount&&e.getRangeAt(0);try{p=T(c.node,c.offset,d.offset,d.node)}catch(g){}p&&(!n&&t.state.focused?(e.collapse(c.node,c.offset),p.collapsed||(e.removeAllRanges(),e.addRange(p))):(e.removeAllRanges(),e.addRange(p)),f&&null==e.anchorNode?e.addRange(f):n&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},nl.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation((function(){return e.cm.curOp.selectionChanged=!0}))}),20)},nl.prototype.showMultipleSelections=function(e){D(this.cm.display.cursorDiv,e.cursors),D(this.cm.display.selectionDiv,e.selection)},nl.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},nl.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return R(this.div,t)},nl.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&A(F(this.div))==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())},nl.prototype.blur=function(){this.div.blur()},nl.prototype.getField=function(){return this.div},nl.prototype.supportsTouch=function(){return!0},nl.prototype.receivedFocus=function(){var e=this,t=this;function n(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,n))}this.selectionInEditor()?setTimeout((function(){return e.pollSelection()}),20):Nr(this.cm,(function(){return t.cm.curOp.selectionChanged=!0})),this.polling.set(this.cm.options.pollInterval,n)},nl.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},nl.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=this.getSelection(),t=this.cm;if(v&&d&&this.cm.display.gutterSpecs.length&&rl(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var n=al(t,e.anchorNode,e.anchorOffset),i=al(t,e.focusNode,e.focusOffset);n&&i&&Nr(t,(function(){qo(t.doc,ho(n,i),J),(n.bad||i.bad)&&(t.curOp.selectionChanged=!0)}))}}},nl.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t,n,i=this.cm,r=i.display,o=i.doc.sel.primary(),s=o.from(),a=o.to();if(0==s.ch&&s.line>i.firstLine()&&(s=ct(s.line-1,tt(i.doc,s.line-1).length)),a.ch==tt(i.doc,a.line).text.length&&a.line<i.lastLine()&&(a=ct(a.line+1,0)),s.line<r.viewFrom||a.line>r.viewTo-1)return!1;s.line==r.viewFrom||0==(e=Ui(i,s.line))?(t=ot(r.view[0].line),n=r.view[0].node):(t=ot(r.view[e].line),n=r.view[e-1].node.nextSibling);var l,c,d=Ui(i,a.line);if(d==r.view.length-1?(l=r.viewTo-1,c=r.lineDiv.lastChild):(l=ot(r.view[d+1].line)-1,c=r.view[d+1].node.previousSibling),!n)return!1;for(var u=i.doc.splitLines(sl(i,n,c,t,l)),h=nt(i.doc,ct(t,0),ct(l,tt(i.doc,l).text.length));u.length>1&&h.length>1;)if(ee(u)==ee(h))u.pop(),h.pop(),l--;else{if(u[0]!=h[0])break;u.shift(),h.shift(),t++}for(var p=0,f=0,g=u[0],m=h[0],v=Math.min(g.length,m.length);p<v&&g.charCodeAt(p)==m.charCodeAt(p);)++p;for(var y=ee(u),b=ee(h),S=Math.min(y.length-(1==u.length?p:0),b.length-(1==h.length?p:0));f<S&&y.charCodeAt(y.length-f-1)==b.charCodeAt(b.length-f-1);)++f;if(1==u.length&&1==h.length&&t==s.line)for(;p&&p>s.ch&&y.charCodeAt(y.length-f-1)==b.charCodeAt(b.length-f-1);)p--,f++;u[u.length-1]=y.slice(0,y.length-f).replace(/^\u200b+/,""),u[0]=u[0].slice(p).replace(/\u200b+$/,"");var w=ct(t,p),x=ct(l,h.length?ee(h).length-f:0);return u.length>1||u[0]||dt(w,x)?(ls(i.doc,u,w,x,"+input"),!0):void 0},nl.prototype.ensurePolled=function(){this.forceCompositionEnd()},nl.prototype.reset=function(){this.forceCompositionEnd()},nl.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},nl.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()}),80))},nl.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||Nr(this.cm,(function(){return zi(e.cm)}))},nl.prototype.setUneditable=function(e){e.contentEditable="false"},nl.prototype.onKeyPress=function(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||_r(this.cm,Ya)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},nl.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},nl.prototype.onContextMenu=function(){},nl.prototype.resetPosition=function(){},nl.prototype.needsContentAttribute=!0;var cl=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new W,this.hasSelection=!1,this.composing=null,this.resetting=!1};function dl(e,t){if((t=t?j(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=A(F(e));t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}function i(){e.value=a.getValue()}var r;if(e.form&&(be(e.form,"submit",i),!t.leaveSubmitMethodAlone)){var o=e.form;r=o.submit;try{var s=o.submit=function(){i(),o.submit=r,o.submit(),o.submit=s}}catch(l){}}t.finishInit=function(n){n.save=i,n.getTextArea=function(){return e},n.toTextArea=function(){n.toTextArea=isNaN,i(),e.parentNode.removeChild(n.getWrapperElement()),e.style.display="",e.form&&(we(e.form,"submit",i),t.leaveSubmitMethodAlone||"function"!=typeof e.form.submit||(e.form.submit=r))}},e.style.display="none";var a=za((function(t){return e.parentNode.insertBefore(t,e.nextSibling)}),t);return a}function ul(e){e.off=we,e.on=be,e.wheelEventPixels=so,e.Doc=Ls,e.splitLines=Be,e.countColumn=G,e.findColumn=Z,e.isWordChar=se,e.Pass=Y,e.signal=xe,e.Line=pn,e.changeEnd=po,e.scrollbarModel=kr,e.Pos=ct,e.cmpPos=dt,e.modes=Ge,e.mimeModes=We,e.resolveMode=Ye,e.getMode=Je,e.modeExtensions=Ke,e.extendMode=Xe,e.copyState=Ze,e.startState=$e,e.innerMode=Qe,e.commands=ta,e.keyMap=js,e.keyName=Js,e.isModifierKey=qs,e.lookupKey=Hs,e.normalizeKeyMap=Ws,e.StringStream=et,e.SharedTextMarker=ws,e.TextMarker=bs,e.LineWidget=gs,e.e_preventDefault=Le,e.e_stopPropagation=Pe,e.e_stop=Me,e.addClass=O,e.contains=R,e.rmClass=L,e.keyNames=Bs}cl.prototype.init=function(e){var t=this,n=this,i=this.cm;this.createField(e);var r=this.textarea;function o(e){if(!Ce(i,e)){if(i.somethingSelected())qa({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;var t=Xa(i);qa({lineWise:!0,text:t.text}),"cut"==e.type?i.setSelections(t.ranges,null,J):(n.prevInput="",r.value=t.text.join("\n"),_(r))}"cut"==e.type&&(i.state.cutIncoming=+new Date)}}e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),m&&(r.style.width="0px"),be(r,"input",(function(){s&&a>=9&&t.hasSelection&&(t.hasSelection=null),n.poll()})),be(r,"paste",(function(e){Ce(i,e)||Ja(e,i)||(i.state.pasteIncoming=+new Date,n.fastPoll())})),be(r,"cut",o),be(r,"copy",o),be(e.scroller,"paste",(function(t){if(!Jn(e,t)&&!Ce(i,t)){if(!r.dispatchEvent)return i.state.pasteIncoming=+new Date,void n.focus();var o=new Event("paste");o.clipboardData=t.clipboardData,r.dispatchEvent(o)}})),be(e.lineSpace,"selectstart",(function(t){Jn(e,t)||Le(t)})),be(r,"compositionstart",(function(){var e=i.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}})),be(r,"compositionend",(function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)}))},cl.prototype.createField=function(e){this.wrapper=Qa(),this.textarea=this.wrapper.firstChild;var t=this.cm.options;Za(this.textarea,t.spellcheck,t.autocorrect,t.autocapitalize)},cl.prototype.screenReaderLabelChanged=function(e){e?this.textarea.setAttribute("aria-label",e):this.textarea.removeAttribute("aria-label")},cl.prototype.prepareSelection=function(){var e=this.cm,t=e.display,n=e.doc,i=Ji(e);if(e.options.moveInputWithCursor){var r=Ci(e,n.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();i.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+s.top-o.top)),i.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+s.left-o.left))}return i},cl.prototype.showSelection=function(e){var t=this.cm.display;D(t.cursorDiv,e.cursors),D(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},cl.prototype.reset=function(e){if(!(this.contextMenuPending||this.composing&&e)){var t=this.cm;if(this.resetting=!0,t.somethingSelected()){this.prevInput="";var n=t.getSelection();this.textarea.value=n,t.state.focused&&_(this.textarea),s&&a>=9&&(this.hasSelection=n)}else e||(this.prevInput=this.textarea.value="",s&&a>=9&&(this.hasSelection=null));this.resetting=!1}},cl.prototype.getField=function(){return this.textarea},cl.prototype.supportsTouch=function(){return!1},cl.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!y||A(F(this.textarea))!=this.textarea))try{this.textarea.focus()}catch(e){}},cl.prototype.blur=function(){this.textarea.blur()},cl.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},cl.prototype.receivedFocus=function(){this.slowPoll()},cl.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,(function(){e.poll(),e.cm.state.focused&&e.slowPoll()}))},cl.prototype.fastPoll=function(){var e=!1,t=this;function n(){t.poll()||e?(t.pollingFast=!1,t.slowPoll()):(e=!0,t.polling.set(60,n))}t.pollingFast=!0,t.polling.set(20,n)},cl.prototype.poll=function(){var e=this,t=this.cm,n=this.textarea,i=this.prevInput;if(this.contextMenuPending||this.resetting||!t.state.focused||Fe(n)&&!i&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var r=n.value;if(r==i&&!t.somethingSelected())return!1;if(s&&a>=9&&this.hasSelection===r||b&&/[\uf700-\uf7ff]/.test(r))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=r.charCodeAt(0);if(8203!=o||i||(i="\u200b"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,c=Math.min(i.length,r.length);l<c&&i.charCodeAt(l)==r.charCodeAt(l);)++l;return Nr(t,(function(){Ya(t,r.slice(l),i.length-l,null,e.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?n.value=e.prevInput="":e.prevInput=r,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))})),!0},cl.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},cl.prototype.onKeyPress=function(){s&&a>=9&&(this.hasSelection=null),this.fastPoll()},cl.prototype.onContextMenu=function(e){var t=this,n=t.cm,i=n.display,r=t.textarea;t.contextMenuPending&&t.contextMenuPending();var o=Fi(n,e),c=i.scroller.scrollTop;if(o&&!h){n.options.resetSelectionOnContextMenu&&-1==n.doc.sel.contains(o)&&_r(n,qo)(n.doc,ho(o),J);var d,u=r.style.cssText,p=t.wrapper.style.cssText,f=t.wrapper.offsetParent.getBoundingClientRect();if(t.wrapper.style.cssText="position: static",r.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-f.top-5)+"px; left: "+(e.clientX-f.left-5)+"px;\n      z-index: 1000; background: "+(s?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",l&&(d=r.ownerDocument.defaultView.scrollY),i.input.focus(),l&&r.ownerDocument.defaultView.scrollTo(null,d),i.input.reset(),n.somethingSelected()||(r.value=t.prevInput=" "),t.contextMenuPending=v,i.selForContextMenu=n.doc.sel,clearTimeout(i.detectingSelectAll),s&&a>=9&&m(),k){Me(e);var g=function(){we(window,"mouseup",g),setTimeout(v,20)};be(window,"mouseup",g)}else setTimeout(v,50)}function m(){if(null!=r.selectionStart){var e=n.somethingSelected(),o="\u200b"+(e?r.value:"");r.value="\u21da",r.value=o,t.prevInput=e?"":"\u200b",r.selectionStart=1,r.selectionEnd=o.length,i.selForContextMenu=n.doc.sel}}function v(){if(t.contextMenuPending==v&&(t.contextMenuPending=!1,t.wrapper.style.cssText=p,r.style.cssText=u,s&&a<9&&i.scrollbars.setScrollTop(i.scroller.scrollTop=c),null!=r.selectionStart)){(!s||s&&a<9)&&m();var e=0,o=function(){i.selForContextMenu==n.doc.sel&&0==r.selectionStart&&r.selectionEnd>0&&"\u200b"==t.prevInput?_r(n,es)(n):e++<10?i.detectingSelectAll=setTimeout(o,500):(i.selForContextMenu=null,i.input.reset())};i.detectingSelectAll=setTimeout(o,200)}}},cl.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e,this.textarea.readOnly=!!e},cl.prototype.setUneditable=function(){},cl.prototype.needsContentAttribute=!1,Ba(za),$a(za);var hl="iter insert remove copy getEditor constructor".split(" ");for(var pl in Ls.prototype)Ls.prototype.hasOwnProperty(pl)&&H(hl,pl)<0&&(za.prototype[pl]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ls.prototype[pl]));return Te(Ls),za.inputStyles={textarea:cl,contenteditable:nl},za.defineMode=function(e){za.defaults.mode||"null"==e||(za.defaults.mode=e),He.apply(this,arguments)},za.defineMIME=qe,za.defineMode("null",(function(){return{token:function(e){return e.skipToEnd()}}})),za.defineMIME("text/plain","null"),za.defineExtension=function(e,t){za.prototype[e]=t},za.defineDocExtension=function(e,t){Ls.prototype[e]=t},za.fromTextArea=dl,ul(za),za.version="5.65.18",za}()},9402:(e,t,n)=>{var i;(i=n(7323)).defineMode("javascript",(function(e,t){var n,r,o=e.indentUnit,s=t.statementIndent,a=t.jsonld,l=t.json||a,c=!1!==t.trackScope,d=t.typescript,u=t.wordCharacters||/[\w$\xa1-\uffff]/,h=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),i=e("keyword c"),r=e("keyword d"),o=e("operator"),s={type:"atom",style:"atom"};return{if:e("if"),while:t,with:t,else:n,do:n,try:n,finally:n,return:r,break:r,continue:r,new:e("new"),delete:i,void:i,throw:i,debugger:e("debugger"),var:e("var"),const:e("var"),let:e("var"),function:e("function"),catch:e("catch"),for:e("for"),switch:e("switch"),case:e("case"),default:e("default"),in:o,typeof:o,instanceof:o,true:s,false:s,null:s,undefined:s,NaN:s,Infinity:s,this:e("this"),class:e("class"),super:e("atom"),yield:i,export:e("export"),import:e("import"),extends:i,await:i}}(),p=/[+\-*&%=<>!?|~^@]/,f=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function g(e){for(var t,n=!1,i=!1;null!=(t=e.next());){if(!n){if("/"==t&&!i)return;"["==t?i=!0:i&&"]"==t&&(i=!1)}n=!n&&"\\"==t}}function m(e,t,i){return n=e,r=i,t}function v(e,t){var n=e.next();if('"'==n||"'"==n)return t.tokenize=y(n),t.tokenize(e,t);if("."==n&&e.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return m("number","number");if("."==n&&e.match(".."))return m("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(n))return m(n);if("="==n&&e.eat(">"))return m("=>","operator");if("0"==n&&e.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return m("number","number");if(/\d/.test(n))return e.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),m("number","number");if("/"==n)return e.eat("*")?(t.tokenize=b,b(e,t)):e.eat("/")?(e.skipToEnd(),m("comment","comment")):rt(e,t,1)?(g(e),e.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),m("regexp","string-2")):(e.eat("="),m("operator","operator",e.current()));if("`"==n)return t.tokenize=S,S(e,t);if("#"==n&&"!"==e.peek())return e.skipToEnd(),m("meta","meta");if("#"==n&&e.eatWhile(u))return m("variable","property");if("<"==n&&e.match("!--")||"-"==n&&e.match("->")&&!/\S/.test(e.string.slice(0,e.start)))return e.skipToEnd(),m("comment","comment");if(p.test(n))return">"==n&&t.lexical&&">"==t.lexical.type||(e.eat("=")?"!"!=n&&"="!=n||e.eat("="):/[<>*+\-|&?]/.test(n)&&(e.eat(n),">"==n&&e.eat(n))),"?"==n&&e.eat(".")?m("."):m("operator","operator",e.current());if(u.test(n)){e.eatWhile(u);var i=e.current();if("."!=t.lastType){if(h.propertyIsEnumerable(i)){var r=h[i];return m(r.type,r.style,i)}if("async"==i&&e.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return m("async","keyword",i)}return m("variable","variable",i)}}function y(e){return function(t,n){var i,r=!1;if(a&&"@"==t.peek()&&t.match(f))return n.tokenize=v,m("jsonld-keyword","meta");for(;null!=(i=t.next())&&(i!=e||r);)r=!r&&"\\"==i;return r||(n.tokenize=v),m("string","string")}}function b(e,t){for(var n,i=!1;n=e.next();){if("/"==n&&i){t.tokenize=v;break}i="*"==n}return m("comment","comment")}function S(e,t){for(var n,i=!1;null!=(n=e.next());){if(!i&&("`"==n||"$"==n&&e.eat("{"))){t.tokenize=v;break}i=!i&&"\\"==n}return m("quasi","string-2",e.current())}var w="([{}])";function x(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var n=e.string.indexOf("=>",e.start);if(!(n<0)){if(d){var i=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,n));i&&(n=i.index)}for(var r=0,o=!1,s=n-1;s>=0;--s){var a=e.string.charAt(s),l=w.indexOf(a);if(l>=0&&l<3){if(!r){++s;break}if(0==--r){"("==a&&(o=!0);break}}else if(l>=3&&l<6)++r;else if(u.test(a))o=!0;else if(/["'\/`]/.test(a))for(;;--s){if(0==s)return;if(e.string.charAt(s-1)==a&&"\\"!=e.string.charAt(s-2)){s--;break}}else if(o&&!r){++s;break}}o&&!r&&(t.fatArrowAt=s)}}var C={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function k(e,t,n,i,r,o){this.indented=e,this.column=t,this.type=n,this.prev=r,this.info=o,null!=i&&(this.align=i)}function E(e,t){if(!c)return!1;for(var n=e.localVars;n;n=n.next)if(n.name==t)return!0;for(var i=e.context;i;i=i.prev)for(n=i.vars;n;n=n.next)if(n.name==t)return!0}function T(e,t,n,i,r){var o=e.cc;for(L.state=e,L.stream=r,L.marked=null,L.cc=o,L.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;)if((o.length?o.pop():l?H:G)(n,i)){for(;o.length&&o[o.length-1].lex;)o.pop()();return L.marked?L.marked:"variable"==n&&E(e,i)?"variable-2":t}}var L={state:null,column:null,marked:null,cc:null};function P(){for(var e=arguments.length-1;e>=0;e--)L.cc.push(arguments[e])}function D(){return P.apply(null,arguments),!0}function M(e,t){for(var n=t;n;n=n.next)if(n.name==e)return!0;return!1}function I(e){var n=L.state;if(L.marked="def",c){if(n.context)if("var"==n.lexical.info&&n.context&&n.context.block){var i=R(e,n.context);if(null!=i)return void(n.context=i)}else if(!M(e,n.localVars))return void(n.localVars=new N(e,n.localVars));t.globalVars&&!M(e,n.globalVars)&&(n.globalVars=new N(e,n.globalVars))}}function R(e,t){if(t){if(t.block){var n=R(e,t.prev);return n?n==t.prev?t:new O(n,t.vars,!0):null}return M(e,t.vars)?t:new O(t.prev,new N(e,t.vars),!1)}return null}function A(e){return"public"==e||"private"==e||"protected"==e||"abstract"==e||"readonly"==e}function O(e,t,n){this.prev=e,this.vars=t,this.block=n}function N(e,t){this.name=e,this.next=t}var _=new N("this",new N("arguments",null));function V(){L.state.context=new O(L.state.context,L.state.localVars,!1),L.state.localVars=_}function B(){L.state.context=new O(L.state.context,L.state.localVars,!0),L.state.localVars=null}function F(){L.state.localVars=L.state.context.vars,L.state.context=L.state.context.prev}function U(e,t){var n=function(){var n=L.state,i=n.indented;if("stat"==n.lexical.type)i=n.lexical.indented;else for(var r=n.lexical;r&&")"==r.type&&r.align;r=r.prev)i=r.indented;n.lexical=new k(i,L.stream.column(),e,null,n.lexical,t)};return n.lex=!0,n}function z(){var e=L.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function j(e){function t(n){return n==e?D():";"==e||"}"==n||")"==n||"]"==n?P():D(t)}return t}function G(e,t){return"var"==e?D(U("vardef",t),Pe,j(";"),z):"keyword a"==e?D(U("form"),Y,G,z):"keyword b"==e?D(U("form"),G,z):"keyword d"==e?L.stream.match(/^\s*$/,!1)?D():D(U("stat"),K,j(";"),z):"debugger"==e?D(j(";")):"{"==e?D(U("}"),B,he,z,F):";"==e?D():"if"==e?("else"==L.state.lexical.info&&L.state.cc[L.state.cc.length-1]==z&&L.state.cc.pop()(),D(U("form"),Y,G,z,Oe)):"function"==e?D(Be):"for"==e?D(U("form"),B,Ne,G,F,z):"class"==e||d&&"interface"==t?(L.marked="keyword",D(U("form","class"==e?e:t),Ge,z)):"variable"==e?d&&"declare"==t?(L.marked="keyword",D(G)):d&&("module"==t||"enum"==t||"type"==t)&&L.stream.match(/^\s*\w/,!1)?(L.marked="keyword","enum"==t?D(tt):"type"==t?D(Ue,j("operator"),ve,j(";")):D(U("form"),De,j("{"),U("}"),he,z,z)):d&&"namespace"==t?(L.marked="keyword",D(U("form"),H,G,z)):d&&"abstract"==t?(L.marked="keyword",D(G)):D(U("stat"),oe):"switch"==e?D(U("form"),Y,j("{"),U("}","switch"),B,he,z,z,F):"case"==e?D(H,j(":")):"default"==e?D(j(":")):"catch"==e?D(U("form"),V,W,G,z,F):"export"==e?D(U("stat"),Ye,z):"import"==e?D(U("stat"),Ke,z):"async"==e?D(G):"@"==t?D(H,G):P(U("stat"),H,j(";"),z)}function W(e){if("("==e)return D(ze,j(")"))}function H(e,t){return J(e,t,!1)}function q(e,t){return J(e,t,!0)}function Y(e){return"("!=e?P():D(U(")"),K,j(")"),z)}function J(e,t,n){if(L.state.fatArrowAt==L.stream.start){var i=n?te:ee;if("("==e)return D(V,U(")"),de(ze,")"),z,j("=>"),i,F);if("variable"==e)return P(V,De,j("=>"),i,F)}var r=n?Z:X;return C.hasOwnProperty(e)?D(r):"function"==e?D(Be,r):"class"==e||d&&"interface"==t?(L.marked="keyword",D(U("form"),je,z)):"keyword c"==e||"async"==e?D(n?q:H):"("==e?D(U(")"),K,j(")"),z,r):"operator"==e||"spread"==e?D(n?q:H):"["==e?D(U("]"),et,z,r):"{"==e?ue(ae,"}",null,r):"quasi"==e?P(Q,r):"new"==e?D(ne(n)):D()}function K(e){return e.match(/[;\}\)\],]/)?P():P(H)}function X(e,t){return","==e?D(K):Z(e,t,!1)}function Z(e,t,n){var i=0==n?X:Z,r=0==n?H:q;return"=>"==e?D(V,n?te:ee,F):"operator"==e?/\+\+|--/.test(t)||d&&"!"==t?D(i):d&&"<"==t&&L.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?D(U(">"),de(ve,">"),z,i):"?"==t?D(H,j(":"),r):D(r):"quasi"==e?P(Q,i):";"!=e?"("==e?ue(q,")","call",i):"."==e?D(se,i):"["==e?D(U("]"),K,j("]"),z,i):d&&"as"==t?(L.marked="keyword",D(ve,i)):"regexp"==e?(L.state.lastType=L.marked="operator",L.stream.backUp(L.stream.pos-L.stream.start-1),D(r)):void 0:void 0}function Q(e,t){return"quasi"!=e?P():"${"!=t.slice(t.length-2)?D(Q):D(K,$)}function $(e){if("}"==e)return L.marked="string-2",L.state.tokenize=S,D(Q)}function ee(e){return x(L.stream,L.state),P("{"==e?G:H)}function te(e){return x(L.stream,L.state),P("{"==e?G:q)}function ne(e){return function(t){return"."==t?D(e?re:ie):"variable"==t&&d?D(Ee,e?Z:X):P(e?q:H)}}function ie(e,t){if("target"==t)return L.marked="keyword",D(X)}function re(e,t){if("target"==t)return L.marked="keyword",D(Z)}function oe(e){return":"==e?D(z,G):P(X,j(";"),z)}function se(e){if("variable"==e)return L.marked="property",D()}function ae(e,t){return"async"==e?(L.marked="property",D(ae)):"variable"==e||"keyword"==L.style?(L.marked="property","get"==t||"set"==t?D(le):(d&&L.state.fatArrowAt==L.stream.start&&(n=L.stream.match(/^\s*:\s*/,!1))&&(L.state.fatArrowAt=L.stream.pos+n[0].length),D(ce))):"number"==e||"string"==e?(L.marked=a?"property":L.style+" property",D(ce)):"jsonld-keyword"==e?D(ce):d&&A(t)?(L.marked="keyword",D(ae)):"["==e?D(H,pe,j("]"),ce):"spread"==e?D(q,ce):"*"==t?(L.marked="keyword",D(ae)):":"==e?P(ce):void 0;var n}function le(e){return"variable"!=e?P(ce):(L.marked="property",D(Be))}function ce(e){return":"==e?D(q):"("==e?P(Be):void 0}function de(e,t,n){function i(r,o){if(n?n.indexOf(r)>-1:","==r){var s=L.state.lexical;return"call"==s.info&&(s.pos=(s.pos||0)+1),D((function(n,i){return n==t||i==t?P():P(e)}),i)}return r==t||o==t?D():n&&n.indexOf(";")>-1?P(e):D(j(t))}return function(n,r){return n==t||r==t?D():P(e,i)}}function ue(e,t,n){for(var i=3;i<arguments.length;i++)L.cc.push(arguments[i]);return D(U(t,n),de(e,t),z)}function he(e){return"}"==e?D():P(G,he)}function pe(e,t){if(d){if(":"==e)return D(ve);if("?"==t)return D(pe)}}function fe(e,t){if(d&&(":"==e||"in"==t))return D(ve)}function ge(e){if(d&&":"==e)return L.stream.match(/^\s*\w+\s+is\b/,!1)?D(H,me,ve):D(ve)}function me(e,t){if("is"==t)return L.marked="keyword",D()}function ve(e,t){return"keyof"==t||"typeof"==t||"infer"==t||"readonly"==t?(L.marked="keyword",D("typeof"==t?q:ve)):"variable"==e||"void"==t?(L.marked="type",D(ke)):"|"==t||"&"==t?D(ve):"string"==e||"number"==e||"atom"==e?D(ke):"["==e?D(U("]"),de(ve,"]",","),z,ke):"{"==e?D(U("}"),be,z,ke):"("==e?D(de(Ce,")"),ye,ke):"<"==e?D(de(ve,">"),ve):"quasi"==e?P(we,ke):void 0}function ye(e){if("=>"==e)return D(ve)}function be(e){return e.match(/[\}\)\]]/)?D():","==e||";"==e?D(be):P(Se,be)}function Se(e,t){return"variable"==e||"keyword"==L.style?(L.marked="property",D(Se)):"?"==t||"number"==e||"string"==e?D(Se):":"==e?D(ve):"["==e?D(j("variable"),fe,j("]"),Se):"("==e?P(Fe,Se):e.match(/[;\}\)\],]/)?void 0:D()}function we(e,t){return"quasi"!=e?P():"${"!=t.slice(t.length-2)?D(we):D(ve,xe)}function xe(e){if("}"==e)return L.marked="string-2",L.state.tokenize=S,D(we)}function Ce(e,t){return"variable"==e&&L.stream.match(/^\s*[?:]/,!1)||"?"==t?D(Ce):":"==e?D(ve):"spread"==e?D(Ce):P(ve)}function ke(e,t){return"<"==t?D(U(">"),de(ve,">"),z,ke):"|"==t||"."==e||"&"==t?D(ve):"["==e?D(ve,j("]"),ke):"extends"==t||"implements"==t?(L.marked="keyword",D(ve)):"?"==t?D(ve,j(":"),ve):void 0}function Ee(e,t){if("<"==t)return D(U(">"),de(ve,">"),z,ke)}function Te(){return P(ve,Le)}function Le(e,t){if("="==t)return D(ve)}function Pe(e,t){return"enum"==t?(L.marked="keyword",D(tt)):P(De,pe,Re,Ae)}function De(e,t){return d&&A(t)?(L.marked="keyword",D(De)):"variable"==e?(I(t),D()):"spread"==e?D(De):"["==e?ue(Ie,"]"):"{"==e?ue(Me,"}"):void 0}function Me(e,t){return"variable"!=e||L.stream.match(/^\s*:/,!1)?("variable"==e&&(L.marked="property"),"spread"==e?D(De):"}"==e?P():"["==e?D(H,j("]"),j(":"),Me):D(j(":"),De,Re)):(I(t),D(Re))}function Ie(){return P(De,Re)}function Re(e,t){if("="==t)return D(q)}function Ae(e){if(","==e)return D(Pe)}function Oe(e,t){if("keyword b"==e&&"else"==t)return D(U("form","else"),G,z)}function Ne(e,t){return"await"==t?D(Ne):"("==e?D(U(")"),_e,z):void 0}function _e(e){return"var"==e?D(Pe,Ve):"variable"==e?D(Ve):P(Ve)}function Ve(e,t){return")"==e?D():";"==e?D(Ve):"in"==t||"of"==t?(L.marked="keyword",D(H,Ve)):P(H,Ve)}function Be(e,t){return"*"==t?(L.marked="keyword",D(Be)):"variable"==e?(I(t),D(Be)):"("==e?D(V,U(")"),de(ze,")"),z,ge,G,F):d&&"<"==t?D(U(">"),de(Te,">"),z,Be):void 0}function Fe(e,t){return"*"==t?(L.marked="keyword",D(Fe)):"variable"==e?(I(t),D(Fe)):"("==e?D(V,U(")"),de(ze,")"),z,ge,F):d&&"<"==t?D(U(">"),de(Te,">"),z,Fe):void 0}function Ue(e,t){return"keyword"==e||"variable"==e?(L.marked="type",D(Ue)):"<"==t?D(U(">"),de(Te,">"),z):void 0}function ze(e,t){return"@"==t&&D(H,ze),"spread"==e?D(ze):d&&A(t)?(L.marked="keyword",D(ze)):d&&"this"==e?D(pe,Re):P(De,pe,Re)}function je(e,t){return"variable"==e?Ge(e,t):We(e,t)}function Ge(e,t){if("variable"==e)return I(t),D(We)}function We(e,t){return"<"==t?D(U(">"),de(Te,">"),z,We):"extends"==t||"implements"==t||d&&","==e?("implements"==t&&(L.marked="keyword"),D(d?ve:H,We)):"{"==e?D(U("}"),He,z):void 0}function He(e,t){return"async"==e||"variable"==e&&("static"==t||"get"==t||"set"==t||d&&A(t))&&L.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1)?(L.marked="keyword",D(He)):"variable"==e||"keyword"==L.style?(L.marked="property",D(qe,He)):"number"==e||"string"==e?D(qe,He):"["==e?D(H,pe,j("]"),qe,He):"*"==t?(L.marked="keyword",D(He)):d&&"("==e?P(Fe,He):";"==e||","==e?D(He):"}"==e?D():"@"==t?D(H,He):void 0}function qe(e,t){if("!"==t)return D(qe);if("?"==t)return D(qe);if(":"==e)return D(ve,Re);if("="==t)return D(q);var n=L.state.lexical.prev;return P(n&&"interface"==n.info?Fe:Be)}function Ye(e,t){return"*"==t?(L.marked="keyword",D($e,j(";"))):"default"==t?(L.marked="keyword",D(H,j(";"))):"{"==e?D(de(Je,"}"),$e,j(";")):P(G)}function Je(e,t){return"as"==t?(L.marked="keyword",D(j("variable"))):"variable"==e?P(q,Je):void 0}function Ke(e){return"string"==e?D():"("==e?P(H):"."==e?P(X):P(Xe,Ze,$e)}function Xe(e,t){return"{"==e?ue(Xe,"}"):("variable"==e&&I(t),"*"==t&&(L.marked="keyword"),D(Qe))}function Ze(e){if(","==e)return D(Xe,Ze)}function Qe(e,t){if("as"==t)return L.marked="keyword",D(Xe)}function $e(e,t){if("from"==t)return L.marked="keyword",D(H)}function et(e){return"]"==e?D():P(de(q,"]"))}function tt(){return P(U("form"),De,j("{"),U("}"),de(nt,"}"),z,z)}function nt(){return P(De,Re)}function it(e,t){return"operator"==e.lastType||","==e.lastType||p.test(t.charAt(0))||/[,.]/.test(t.charAt(0))}function rt(e,t,n){return t.tokenize==v&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(t.lastType)||"quasi"==t.lastType&&/\{\s*$/.test(e.string.slice(0,e.pos-(n||0)))}return V.lex=B.lex=!0,F.lex=!0,z.lex=!0,{startState:function(e){var n={tokenize:v,lastType:"sof",cc:[],lexical:new k((e||0)-o,0,"block",!1),localVars:t.localVars,context:t.localVars&&new O(null,null,!1),indented:e||0};return t.globalVars&&"object"==typeof t.globalVars&&(n.globalVars=t.globalVars),n},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),x(e,t)),t.tokenize!=b&&e.eatSpace())return null;var i=t.tokenize(e,t);return"comment"==n?i:(t.lastType="operator"!=n||"++"!=r&&"--"!=r?n:"incdec",T(t,i,n,r,e))},indent:function(e,n){if(e.tokenize==b||e.tokenize==S)return i.Pass;if(e.tokenize!=v)return 0;var r,a=n&&n.charAt(0),l=e.lexical;if(!/^\s*else\b/.test(n))for(var c=e.cc.length-1;c>=0;--c){var d=e.cc[c];if(d==z)l=l.prev;else if(d!=Oe&&d!=F)break}for(;("stat"==l.type||"form"==l.type)&&("}"==a||(r=e.cc[e.cc.length-1])&&(r==X||r==Z)&&!/^[,\.=+\-*:?[\(]/.test(n));)l=l.prev;s&&")"==l.type&&"stat"==l.prev.type&&(l=l.prev);var u=l.type,h=a==u;return"vardef"==u?l.indented+("operator"==e.lastType||","==e.lastType?l.info.length+1:0):"form"==u&&"{"==a?l.indented:"form"==u?l.indented+o:"stat"==u?l.indented+(it(e,n)?s||o:0):"switch"!=l.info||h||0==t.doubleIndentSwitch?l.align?l.column+(h?0:1):l.indented+(h?0:o):l.indented+(/^(?:case|default)\b/.test(n)?o:2*o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:rt,skipExpression:function(e){T(e,"atom","atom","true",new i.StringStream("",2,null))}}})),i.registerHelper("wordChars","javascript",/[\w$]/),i.defineMIME("text/javascript","javascript"),i.defineMIME("text/ecmascript","javascript"),i.defineMIME("application/javascript","javascript"),i.defineMIME("application/x-javascript","javascript"),i.defineMIME("application/ecmascript","javascript"),i.defineMIME("application/json",{name:"javascript",json:!0}),i.defineMIME("application/x-json",{name:"javascript",json:!0}),i.defineMIME("application/manifest+json",{name:"javascript",json:!0}),i.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),i.defineMIME("text/typescript",{name:"javascript",typescript:!0}),i.defineMIME("application/typescript",{name:"javascript",typescript:!0})},8471:e=>{e.exports=function(e){function t(e){for(var t={},n=e.split(" "),i=0;i<n.length;++i)t[n[i]]=!0;return t}e.defineMode("glsl",(function(e,r){var o,s=e.indentUnit,a=r.keywords||t(n),l=r.builtins||t(i),c=r.blockKeywords||t("case do else for if switch while struct"),d=r.atoms||t("null"),u=r.hooks||{},h=r.multiLineStrings,p=/[+\-*&%=<>!?|\/]/;function f(e,t){var n,i=e.next();if(u[i]){var r=u[i](e,t);if(!1!==r)return r}if('"'==i||"'"==i)return t.tokenize=(n=i,function(e,t){for(var i,r=!1,o=!1;null!=(i=e.next());){if(i==n&&!r){o=!0;break}r=!r&&"\\"==i}return(o||!r&&!h)&&(t.tokenize=f),"string"}),t.tokenize(e,t);if(/[\[\]{}\(\),;\:\.]/.test(i))return o=i,"bracket";if(/\d/.test(i))return e.eatWhile(/[\w\.]/),"number";if("/"==i){if(e.eat("*"))return t.tokenize=g,g(e,t);if(e.eat("/"))return e.skipToEnd(),"comment"}if("#"==i)return e.eatWhile(/[\S]+/),e.eatWhile(/[\s]+/),e.eatWhile(/[\S]+/),e.eatWhile(/[\s]+/),"comment";if(p.test(i))return e.eatWhile(p),"operator";e.eatWhile(/[\w\$_]/);var s=e.current();return a.propertyIsEnumerable(s)?(c.propertyIsEnumerable(s)&&(o="newstatement"),"keyword"):l.propertyIsEnumerable(s)?"builtin":d.propertyIsEnumerable(s)?"atom":"word"}function g(e,t){for(var n,i=!1;n=e.next();){if("/"==n&&i){t.tokenize=f;break}i="*"==n}return"comment"}function m(e,t,n,i,r){this.indented=e,this.column=t,this.type=n,this.align=i,this.prev=r}function v(e,t,n){return e.context=new m(e.indented,t,n,null,e.context)}function y(e){var t=e.context.type;return")"!=t&&"]"!=t&&"}"!=t||(e.indented=e.context.indented),e.context=e.context.prev}return{startState:function(e){return{tokenize:null,context:new m((e||0)-s,0,"top",!1),indented:0,startOfLine:!0}},token:function(e,t){var n=t.context;if(e.sol()&&(null==n.align&&(n.align=!1),t.indented=e.indentation(),t.startOfLine=!0),e.eatSpace())return null;o=null;var i=(t.tokenize||f)(e,t);if("comment"==i||"meta"==i)return i;if(null==n.align&&(n.align=!0),";"!=o&&":"!=o||"statement"!=n.type)if("{"==o)v(t,e.column(),"}");else if("["==o)v(t,e.column(),"]");else if("("==o)v(t,e.column(),")");else if("}"==o){for(;"statement"==n.type;)n=y(t);for("}"==n.type&&(n=y(t));"statement"==n.type;)n=y(t)}else o==n.type?y(t):("}"==n.type||"top"==n.type||"statement"==n.type&&"newstatement"==o)&&v(t,e.column(),"statement");else y(t);return t.startOfLine=!1,i},indent:function(e,t){if(e.tokenize!=f&&null!=e.tokenize)return 0;var n=t&&t.charAt(0),i=e.context,r=n==i.type;return"statement"==i.type?i.indented+("{"==n?0:s):i.align?i.column+(r?0:1):i.indented+(r?0:s)},electricChars:"{}"}}));var n="attribute const uniform varying break continue do for while if else in out inout float int void bool true false lowp mediump highp precision invariant discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler2D samplerCube struct gl_FragCoord gl_FragColor",i="radians degrees sin cos tan asin acos atan pow exp log exp2 log2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not dFdx dFdy fwidth texture2D texture2DProj texture2DLod texture2DProjLod textureCube textureCubeLod require export";function r(e,t){return!!t.startOfLine&&(e.skipToEnd(),"meta")}e.defineMIME("text/x-glsl",{name:"glsl",keywords:t(n),builtins:t(i),blockKeywords:t("case do else for if switch while struct"),atoms:t("null"),hooks:{"#":r}})}},4635:(e,t,n)=>{var i=n(4759).Symbol;e.exports=i},2022:(e,t,n)=>{var i=n(4635),r=n(1581),o=n(5336),s=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?r(e):o(e)}},6914:(e,t,n)=>{var i=n(8798),r=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(r,""):e}},6658:(e,t,n)=>{var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=i},1581:(e,t,n)=>{var i=n(4635),r=Object.prototype,o=r.hasOwnProperty,s=r.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(l){}var r=s.call(e);return i&&(t?e[a]=n:delete e[a]),r}},5336:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},4759:(e,t,n)=>{var i=n(6658),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();e.exports=o},8798:e=>{var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},5491:(e,t,n)=>{var i=n(4567),r=n(4378),o=n(2588),s=Math.max,a=Math.min;e.exports=function(e,t,n){var l,c,d,u,h,p,f=0,g=!1,m=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=l,i=c;return l=c=void 0,f=t,u=e.apply(i,n)}function b(e){var n=e-p;return void 0===p||n>=t||n<0||m&&e-f>=d}function S(){var e=r();if(b(e))return w(e);h=setTimeout(S,function(e){var n=t-(e-p);return m?a(n,d-(e-f)):n}(e))}function w(e){return h=void 0,v&&l?y(e):(l=c=void 0,u)}function x(){var e=r(),n=b(e);if(l=arguments,c=this,p=e,n){if(void 0===h)return function(e){return f=e,h=setTimeout(S,t),g?y(e):u}(p);if(m)return clearTimeout(h),h=setTimeout(S,t),y(p)}return void 0===h&&(h=setTimeout(S,t)),u}return t=o(t)||0,i(n)&&(g=!!n.leading,d=(m="maxWait"in n)?s(o(n.maxWait)||0,t):d,v="trailing"in n?!!n.trailing:v),x.cancel=function(){void 0!==h&&clearTimeout(h),f=0,l=p=c=h=void 0},x.flush=function(){return void 0===h?u:w(r())},x}},4567:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},9248:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},184:(e,t,n)=>{var i=n(2022),r=n(9248);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==i(e)}},4378:(e,t,n)=>{var i=n(4759);e.exports=function(){return i.Date.now()}},492:(e,t,n)=>{var i=n(5491),r=n(4567);e.exports=function(e,t,n){var o=!0,s=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return r(n)&&(o="leading"in n?!!n.leading:o,s="trailing"in n?!!n.trailing:s),i(e,t,{leading:o,maxWait:t,trailing:s})}},2588:(e,t,n)=>{var i=n(6914),r=n(4567),o=n(184),s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var n=a.test(e);return n||l.test(e)?c(e.slice(2),n?2:8):s.test(e)?NaN:+e}},6470:e=>{var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(r){return!1}}()?Object.assign:function(e,r){for(var o,s,a=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var c in o=Object(arguments[l]))n.call(o,c)&&(a[c]=o[c]);if(t){s=t(o);for(var d=0;d<s.length;d++)i.call(o,s[d])&&(a[s[d]]=o[s[d]])}}return a}},3488:(e,t,n)=>{var i=n(3959);function r(){}function o(){}o.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,o,s){if(s!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:r};return n.PropTypes=n,n}},1942:(e,t,n)=>{e.exports=n(3488)()},3959:e=>{e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},8345:(e,t,n)=>{var i=n(9950),r=n(6470),o=n(5340);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(s(227));function a(e,t,n,i,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var l=!1,c=null,d=!1,u=null,h={onError:function(e){l=!0,c=e}};function p(e,t,n,i,r,o,s,d,u){l=!1,c=null,a.apply(h,arguments)}var f=null,g=null,m=null;function v(e,t,n){var i=e.type||"unknown-event";e.currentTarget=m(n),function(e,t,n,i,r,o,a,h,f){if(p.apply(this,arguments),l){if(!l)throw Error(s(198));var g=c;l=!1,c=null,d||(d=!0,u=g)}}(i,t,void 0,e),e.currentTarget=null}var y=null,b={};function S(){if(y)for(var e in b){var t=b[e],n=y.indexOf(e);if(!(-1<n))throw Error(s(96,e));if(!x[n]){if(!t.extractEvents)throw Error(s(97,e));for(var i in x[n]=t,n=t.eventTypes){var r=void 0,o=n[i],a=t,l=i;if(C.hasOwnProperty(l))throw Error(s(99,l));C[l]=o;var c=o.phasedRegistrationNames;if(c){for(r in c)c.hasOwnProperty(r)&&w(c[r],a,l);r=!0}else o.registrationName?(w(o.registrationName,a,l),r=!0):r=!1;if(!r)throw Error(s(98,i,e))}}}}function w(e,t,n){if(k[e])throw Error(s(100,e));k[e]=t,E[e]=t.eventTypes[n].dependencies}var x=[],C={},k={},E={};function T(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var i=e[t];if(!b.hasOwnProperty(t)||b[t]!==i){if(b[t])throw Error(s(102,t));b[t]=i,n=!0}}n&&S()}var L=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),P=null,D=null,M=null;function I(e){if(e=g(e)){if("function"!==typeof P)throw Error(s(280));var t=e.stateNode;t&&(t=f(t),P(e.stateNode,e.type,t))}}function R(e){D?M?M.push(e):M=[e]:D=e}function A(){if(D){var e=D,t=M;if(M=D=null,I(e),t)for(e=0;e<t.length;e++)I(t[e])}}function O(e,t){return e(t)}function N(e,t,n,i,r){return e(t,n,i,r)}function _(){}var V=O,B=!1,F=!1;function U(){null===D&&null===M||(_(),A())}function z(e,t,n){if(F)return e(t,n);F=!0;try{return V(e,t,n)}finally{F=!1,U()}}var j=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,G=Object.prototype.hasOwnProperty,W={},H={};function q(e,t,n,i,r,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o}var Y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){Y[e]=new q(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];Y[t]=new q(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){Y[e]=new q(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){Y[e]=new q(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){Y[e]=new q(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){Y[e]=new q(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){Y[e]=new q(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){Y[e]=new q(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){Y[e]=new q(e,5,!1,e.toLowerCase(),null,!1)}));var J=/[\-:]([a-z])/g;function K(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(J,K);Y[t]=new q(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(J,K);Y[t]=new q(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(J,K);Y[t]=new q(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){Y[e]=new q(e,1,!1,e.toLowerCase(),null,!1)})),Y.xlinkHref=new q("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){Y[e]=new q(e,1,!1,e.toLowerCase(),null,!0)}));var X=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Z(e,t,n,i){var r=Y.hasOwnProperty(t)?Y[t]:null;(null!==r?0===r.type:!i&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!G.call(H,e)||!G.call(W,e)&&(j.test(e)?H[e]=!0:(W[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}X.hasOwnProperty("ReactCurrentDispatcher")||(X.ReactCurrentDispatcher={current:null}),X.hasOwnProperty("ReactCurrentBatchConfig")||(X.ReactCurrentBatchConfig={suspense:null});var Q=/^(.*)[\\\/]/,$="function"===typeof Symbol&&Symbol.for,ee=$?Symbol.for("react.element"):60103,te=$?Symbol.for("react.portal"):60106,ne=$?Symbol.for("react.fragment"):60107,ie=$?Symbol.for("react.strict_mode"):60108,re=$?Symbol.for("react.profiler"):60114,oe=$?Symbol.for("react.provider"):60109,se=$?Symbol.for("react.context"):60110,ae=$?Symbol.for("react.concurrent_mode"):60111,le=$?Symbol.for("react.forward_ref"):60112,ce=$?Symbol.for("react.suspense"):60113,de=$?Symbol.for("react.suspense_list"):60120,ue=$?Symbol.for("react.memo"):60115,he=$?Symbol.for("react.lazy"):60116,pe=$?Symbol.for("react.block"):60121,fe="function"===typeof Symbol&&Symbol.iterator;function ge(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=fe&&e[fe]||e["@@iterator"])?e:null}function me(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case ne:return"Fragment";case te:return"Portal";case re:return"Profiler";case ie:return"StrictMode";case ce:return"Suspense";case de:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case se:return"Context.Consumer";case oe:return"Context.Provider";case le:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case ue:return me(e.type);case pe:return me(e.render);case he:if(e=1===e._status?e._result:null)return me(e)}return null}function ve(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var i=e._debugOwner,r=e._debugSource,o=me(e.type);n=null,i&&(n=me(i.type)),i=o,o="",r?o=" (at "+r.fileName.replace(Q,"")+":"+r.lineNumber+")":n&&(o=" (created by "+n+")"),n="\n    in "+(i||"Unknown")+o}t+=n,e=e.return}while(e);return t}function ye(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function be(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Se(e){e._valueTracker||(e._valueTracker=function(e){var t=be(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function we(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=be(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function xe(e,t){var n=t.checked;return r({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Ce(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=ye(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function ke(e,t){null!=(t=t.checked)&&Z(e,"checked",t,!1)}function Ee(e,t){ke(e,t);var n=ye(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?Le(e,t.type,n):t.hasOwnProperty("defaultValue")&&Le(e,t.type,ye(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Te(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Le(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Pe(e,t){return e=r({children:void 0},t),(t=function(e){var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function De(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+ye(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function Me(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return r({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:ye(n)}}function Re(e,t){var n=ye(t.value),i=ye(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function Ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var Oe="http://www.w3.org/1999/xhtml",Ne="http://www.w3.org/2000/svg";function _e(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ve(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?_e(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Be,Fe,Ue=(Fe=function(e,t){if(e.namespaceURI!==Ne||"innerHTML"in e)e.innerHTML=t;else{for((Be=Be||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Be.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return Fe(e,t)}))}:Fe);function ze(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function je(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ge={animationend:je("Animation","AnimationEnd"),animationiteration:je("Animation","AnimationIteration"),animationstart:je("Animation","AnimationStart"),transitionend:je("Transition","TransitionEnd")},We={},He={};function qe(e){if(We[e])return We[e];if(!Ge[e])return e;var t,n=Ge[e];for(t in n)if(n.hasOwnProperty(t)&&t in He)return We[e]=n[t];return e}L&&(He=document.createElement("div").style,"AnimationEvent"in window||(delete Ge.animationend.animation,delete Ge.animationiteration.animation,delete Ge.animationstart.animation),"TransitionEvent"in window||delete Ge.transitionend.transition);var Ye=qe("animationend"),Je=qe("animationiteration"),Ke=qe("animationstart"),Xe=qe("transitionend"),Ze="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qe=new("function"===typeof WeakMap?WeakMap:Map);function $e(e){var t=Qe.get(e);return void 0===t&&(t=new Map,Qe.set(e,t)),t}function et(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function tt(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function nt(e){if(et(e)!==e)throw Error(s(188))}function it(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=et(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return nt(r),e;if(o===i)return nt(r),t;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=o;break}if(l===i){a=!0,i=r,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,i=r;break}if(l===i){a=!0,i=o,n=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function rt(e,t){if(null==t)throw Error(s(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function ot(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var st=null;function at(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var i=0;i<t.length&&!e.isPropagationStopped();i++)v(e,t[i],n[i]);else t&&v(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function lt(e){if(null!==e&&(st=rt(st,e)),e=st,st=null,e){if(ot(e,at),st)throw Error(s(95));if(d)throw e=u,d=!1,u=null,e}}function ct(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function dt(e){if(!L)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"===typeof t[e]),t}var ut=[];function ht(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>ut.length&&ut.push(e)}function pt(e,t,n,i){if(ut.length){var r=ut.pop();return r.topLevelType=e,r.eventSystemFlags=i,r.nativeEvent=t,r.targetInst=n,r}return{topLevelType:e,eventSystemFlags:i,nativeEvent:t,targetInst:n,ancestors:[]}}function ft(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var i=n;if(3===i.tag)i=i.stateNode.containerInfo;else{for(;i.return;)i=i.return;i=3!==i.tag?null:i.stateNode.containerInfo}if(!i)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=An(i)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var r=ct(e.nativeEvent);i=e.topLevelType;var o=e.nativeEvent,s=e.eventSystemFlags;0===n&&(s|=64);for(var a=null,l=0;l<x.length;l++){var c=x[l];c&&(c=c.extractEvents(i,t,o,r,s))&&(a=rt(a,c))}lt(a)}}function gt(e,t,n){if(!n.has(e)){switch(e){case"scroll":Kt(t,"scroll",!0);break;case"focus":case"blur":Kt(t,"focus",!0),Kt(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":dt(e)&&Kt(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Ze.indexOf(e)&&Jt(e,t)}n.set(e,null)}}var mt,vt,yt,bt=!1,St=[],wt=null,xt=null,Ct=null,kt=new Map,Et=new Map,Tt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Pt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Dt(e,t,n,i,r){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:r,container:i}}function Mt(e,t){switch(e){case"focus":case"blur":wt=null;break;case"dragenter":case"dragleave":xt=null;break;case"mouseover":case"mouseout":Ct=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Et.delete(t.pointerId)}}function It(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e=Dt(t,n,i,r,o),null!==t&&(null!==(t=On(t))&&vt(t)),e):(e.eventSystemFlags|=i,e)}function Rt(e){var t=An(e.target);if(null!==t){var n=et(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=tt(n)))return e.blockedOn=t,void o.unstable_runWithPriority(e.priority,(function(){yt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function At(e){if(null!==e.blockedOn)return!1;var t=$t(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=On(t);return null!==n&&vt(n),e.blockedOn=t,!1}return!0}function Ot(e,t,n){At(e)&&n.delete(t)}function Nt(){for(bt=!1;0<St.length;){var e=St[0];if(null!==e.blockedOn){null!==(e=On(e.blockedOn))&&mt(e);break}var t=$t(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:St.shift()}null!==wt&&At(wt)&&(wt=null),null!==xt&&At(xt)&&(xt=null),null!==Ct&&At(Ct)&&(Ct=null),kt.forEach(Ot),Et.forEach(Ot)}function _t(e,t){e.blockedOn===t&&(e.blockedOn=null,bt||(bt=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Nt)))}function Vt(e){function t(t){return _t(t,e)}if(0<St.length){_t(St[0],e);for(var n=1;n<St.length;n++){var i=St[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==wt&&_t(wt,e),null!==xt&&_t(xt,e),null!==Ct&&_t(Ct,e),kt.forEach(t),Et.forEach(t),n=0;n<Tt.length;n++)(i=Tt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Tt.length&&null===(n=Tt[0]).blockedOn;)Rt(n),null===n.blockedOn&&Tt.shift()}var Bt={},Ft=new Map,Ut=new Map,zt=["abort","abort",Ye,"animationEnd",Je,"animationIteration",Ke,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Xe,"transitionEnd","waiting","waiting"];function jt(e,t){for(var n=0;n<e.length;n+=2){var i=e[n],r=e[n+1],o="on"+(r[0].toUpperCase()+r.slice(1));o={phasedRegistrationNames:{bubbled:o,captured:o+"Capture"},dependencies:[i],eventPriority:t},Ut.set(i,t),Ft.set(i,o),Bt[r]=o}}jt("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),jt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),jt(zt,2);for(var Gt="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Wt=0;Wt<Gt.length;Wt++)Ut.set(Gt[Wt],0);var Ht=o.unstable_UserBlockingPriority,qt=o.unstable_runWithPriority,Yt=!0;function Jt(e,t){Kt(t,e,!1)}function Kt(e,t,n){var i=Ut.get(t);switch(void 0===i?2:i){case 0:i=Xt.bind(null,t,1,e);break;case 1:i=Zt.bind(null,t,1,e);break;default:i=Qt.bind(null,t,1,e)}n?e.addEventListener(t,i,!0):e.addEventListener(t,i,!1)}function Xt(e,t,n,i){B||_();var r=Qt,o=B;B=!0;try{N(r,e,t,n,i)}finally{(B=o)||U()}}function Zt(e,t,n,i){qt(Ht,Qt.bind(null,e,t,n,i))}function Qt(e,t,n,i){if(Yt)if(0<St.length&&-1<Lt.indexOf(e))e=Dt(null,e,t,n,i),St.push(e);else{var r=$t(e,t,n,i);if(null===r)Mt(e,i);else if(-1<Lt.indexOf(e))e=Dt(r,e,t,n,i),St.push(e);else if(!function(e,t,n,i,r){switch(t){case"focus":return wt=It(wt,e,t,n,i,r),!0;case"dragenter":return xt=It(xt,e,t,n,i,r),!0;case"mouseover":return Ct=It(Ct,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return kt.set(o,It(kt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Et.set(o,It(Et.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i)){Mt(e,i),e=pt(e,i,null,t);try{z(ft,e)}finally{ht(e)}}}}function $t(e,t,n,i){if(null!==(n=An(n=ct(i)))){var r=et(n);if(null===r)n=null;else{var o=r.tag;if(13===o){if(null!==(n=tt(r)))return n;n=null}else if(3===o){if(r.stateNode.hydrate)return 3===r.tag?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}e=pt(e,i,n,t);try{z(ft,e)}finally{ht(e)}return null}var en={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tn=["Webkit","ms","Moz","O"];function nn(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||en.hasOwnProperty(e)&&en[e]?(""+t).trim():t+"px"}function rn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=nn(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(en).forEach((function(e){tn.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),en[t]=en[e]}))}));var on=r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sn(e,t){if(t){if(on[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62,""))}}function an(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ln=Oe;function cn(e,t){var n=$e(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=E[t];for(var i=0;i<t.length;i++)gt(t[i],e,n)}function dn(){}function un(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function hn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function pn(e,t){var n,i=hn(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=hn(i)}}function fn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function gn(){for(var e=window,t=un();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=un((e=t.contentWindow).document)}return t}function mn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var vn="$",yn="/$",bn="$?",Sn="$!",wn=null,xn=null;function Cn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function kn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var En="function"===typeof setTimeout?setTimeout:void 0,Tn="function"===typeof clearTimeout?clearTimeout:void 0;function Ln(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Pn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if(n===vn||n===Sn||n===bn){if(0===t)return e;t--}else n===yn&&t++}e=e.previousSibling}return null}var Dn=Math.random().toString(36).slice(2),Mn="__reactInternalInstance$"+Dn,In="__reactEventHandlers$"+Dn,Rn="__reactContainere$"+Dn;function An(e){var t=e[Mn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Rn]||n[Mn]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Pn(e);null!==e;){if(n=e[Mn])return n;e=Pn(e)}return t}n=(e=n).parentNode}return null}function On(e){return!(e=e[Mn]||e[Rn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Nn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function _n(e){return e[In]||null}function Vn(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function Bn(e,t){var n=e.stateNode;if(!n)return null;var i=f(n);if(!i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}function Fn(e,t,n){(t=Bn(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function Un(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=Vn(t);for(t=n.length;0<t--;)Fn(n[t],"captured",e);for(t=0;t<n.length;t++)Fn(n[t],"bubbled",e)}}function zn(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=Bn(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function jn(e){e&&e.dispatchConfig.registrationName&&zn(e._targetInst,null,e)}function Gn(e){ot(e,Un)}var Wn=null,Hn=null,qn=null;function Yn(){if(qn)return qn;var e,t,n=Hn,i=n.length,r="value"in Wn?Wn.value:Wn.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return qn=r.slice(e,1<t?1-t:void 0)}function Jn(){return!0}function Kn(){return!1}function Xn(e,t,n,i){for(var r in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(r)&&((t=e[r])?this[r]=t(n):"target"===r?this.target=i:this[r]=n[r]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Jn:Kn,this.isPropagationStopped=Kn,this}function Zn(e,t,n,i){if(this.eventPool.length){var r=this.eventPool.pop();return this.call(r,e,t,n,i),r}return new this(e,t,n,i)}function Qn(e){if(!(e instanceof this))throw Error(s(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function $n(e){e.eventPool=[],e.getPooled=Zn,e.release=Qn}r(Xn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Jn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Jn)},persist:function(){this.isPersistent=Jn},isPersistent:Kn,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Kn,this._dispatchInstances=this._dispatchListeners=null}}),Xn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Xn.extend=function(e){function t(){}function n(){return i.apply(this,arguments)}var i=this;t.prototype=i.prototype;var o=new t;return r(o,n.prototype),n.prototype=o,n.prototype.constructor=n,n.Interface=r({},i.Interface,e),n.extend=i.extend,$n(n),n},$n(Xn);var ei=Xn.extend({data:null}),ti=Xn.extend({data:null}),ni=[9,13,27,32],ii=L&&"CompositionEvent"in window,ri=null;L&&"documentMode"in document&&(ri=document.documentMode);var oi=L&&"TextEvent"in window&&!ri,si=L&&(!ii||ri&&8<ri&&11>=ri),ai=String.fromCharCode(32),li={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},ci=!1;function di(e,t){switch(e){case"keyup":return-1!==ni.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function ui(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var hi=!1;var pi={eventTypes:li,extractEvents:function(e,t,n,i){var r;if(ii)e:{switch(e){case"compositionstart":var o=li.compositionStart;break e;case"compositionend":o=li.compositionEnd;break e;case"compositionupdate":o=li.compositionUpdate;break e}o=void 0}else hi?di(e,n)&&(o=li.compositionEnd):"keydown"===e&&229===n.keyCode&&(o=li.compositionStart);return o?(si&&"ko"!==n.locale&&(hi||o!==li.compositionStart?o===li.compositionEnd&&hi&&(r=Yn()):(Hn="value"in(Wn=i)?Wn.value:Wn.textContent,hi=!0)),o=ei.getPooled(o,t,n,i),r?o.data=r:null!==(r=ui(n))&&(o.data=r),Gn(o),r=o):r=null,(e=oi?function(e,t){switch(e){case"compositionend":return ui(t);case"keypress":return 32!==t.which?null:(ci=!0,ai);case"textInput":return(e=t.data)===ai&&ci?null:e;default:return null}}(e,n):function(e,t){if(hi)return"compositionend"===e||!ii&&di(e,t)?(e=Yn(),qn=Hn=Wn=null,hi=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return si&&"ko"!==t.locale?null:t.data}}(e,n))?((t=ti.getPooled(li.beforeInput,t,n,i)).data=e,Gn(t)):t=null,null===r?t:null===t?r:[r,t]}},fi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!fi[e.type]:"textarea"===t}var mi={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function vi(e,t,n){return(e=Xn.getPooled(mi.change,e,t,n)).type="change",R(n),Gn(e),e}var yi=null,bi=null;function Si(e){lt(e)}function wi(e){if(we(Nn(e)))return e}function xi(e,t){if("change"===e)return t}var Ci=!1;function ki(){yi&&(yi.detachEvent("onpropertychange",Ei),bi=yi=null)}function Ei(e){if("value"===e.propertyName&&wi(bi))if(e=vi(bi,e,ct(e)),B)lt(e);else{B=!0;try{O(Si,e)}finally{B=!1,U()}}}function Ti(e,t,n){"focus"===e?(ki(),bi=n,(yi=t).attachEvent("onpropertychange",Ei)):"blur"===e&&ki()}function Li(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return wi(bi)}function Pi(e,t){if("click"===e)return wi(t)}function Di(e,t){if("input"===e||"change"===e)return wi(t)}L&&(Ci=dt("input")&&(!document.documentMode||9<document.documentMode));var Mi={eventTypes:mi,_isInputEventSupported:Ci,extractEvents:function(e,t,n,i){var r=t?Nn(t):window,o=r.nodeName&&r.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===r.type)var s=xi;else if(gi(r))if(Ci)s=Di;else{s=Li;var a=Ti}else(o=r.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===r.type||"radio"===r.type)&&(s=Pi);if(s&&(s=s(e,t)))return vi(s,n,i);a&&a(e,r,t),"blur"===e&&(e=r._wrapperState)&&e.controlled&&"number"===r.type&&Le(r,"number",r.value)}},Ii=Xn.extend({view:null,detail:null}),Ri={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ai(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Ri[e])&&!!t[e]}function Oi(){return Ai}var Ni=0,_i=0,Vi=!1,Bi=!1,Fi=Ii.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Oi,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Ni;return Ni=e.screenX,Vi?"mousemove"===e.type?e.screenX-t:0:(Vi=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=_i;return _i=e.screenY,Bi?"mousemove"===e.type?e.screenY-t:0:(Bi=!0,0)}}),Ui=Fi.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),zi={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},ji={eventTypes:zi,extractEvents:function(e,t,n,i,r){var o="mouseover"===e||"pointerover"===e,s="mouseout"===e||"pointerout"===e;if(o&&0===(32&r)&&(n.relatedTarget||n.fromElement)||!s&&!o)return null;(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,s)?(s=t,null!==(t=(t=n.relatedTarget||n.toElement)?An(t):null)&&(t!==et(t)||5!==t.tag&&6!==t.tag)&&(t=null)):s=null;if(s===t)return null;if("mouseout"===e||"mouseover"===e)var a=Fi,l=zi.mouseLeave,c=zi.mouseEnter,d="mouse";else"pointerout"!==e&&"pointerover"!==e||(a=Ui,l=zi.pointerLeave,c=zi.pointerEnter,d="pointer");if(e=null==s?o:Nn(s),o=null==t?o:Nn(t),(l=a.getPooled(l,s,n,i)).type=d+"leave",l.target=e,l.relatedTarget=o,(n=a.getPooled(c,t,n,i)).type=d+"enter",n.target=o,n.relatedTarget=e,d=t,(i=s)&&d)e:{for(c=d,s=0,e=a=i;e;e=Vn(e))s++;for(e=0,t=c;t;t=Vn(t))e++;for(;0<s-e;)a=Vn(a),s--;for(;0<e-s;)c=Vn(c),e--;for(;s--;){if(a===c||a===c.alternate)break e;a=Vn(a),c=Vn(c)}a=null}else a=null;for(c=a,a=[];i&&i!==c&&(null===(s=i.alternate)||s!==c);)a.push(i),i=Vn(i);for(i=[];d&&d!==c&&(null===(s=d.alternate)||s!==c);)i.push(d),d=Vn(d);for(d=0;d<a.length;d++)zn(a[d],"bubbled",l);for(d=i.length;0<d--;)zn(i[d],"captured",n);return 0===(64&r)?[l]:[l,n]}};var Gi="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Wi=Object.prototype.hasOwnProperty;function Hi(e,t){if(Gi(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!Wi.call(t,n[i])||!Gi(e[n[i]],t[n[i]]))return!1;return!0}var qi=L&&"documentMode"in document&&11>=document.documentMode,Yi={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Ji=null,Ki=null,Xi=null,Zi=!1;function Qi(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Zi||null==Ji||Ji!==un(n)?null:("selectionStart"in(n=Ji)&&mn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Xi&&Hi(Xi,n)?null:(Xi=n,(e=Xn.getPooled(Yi.select,Ki,e,t)).type="select",e.target=Ji,Gn(e),e))}var $i={eventTypes:Yi,extractEvents:function(e,t,n,i,r,o){if(!(o=!(r=o||(i.window===i?i.document:9===i.nodeType?i:i.ownerDocument)))){e:{r=$e(r),o=E.onSelect;for(var s=0;s<o.length;s++)if(!r.has(o[s])){r=!1;break e}r=!0}o=!r}if(o)return null;switch(r=t?Nn(t):window,e){case"focus":(gi(r)||"true"===r.contentEditable)&&(Ji=r,Ki=t,Xi=null);break;case"blur":Xi=Ki=Ji=null;break;case"mousedown":Zi=!0;break;case"contextmenu":case"mouseup":case"dragend":return Zi=!1,Qi(n,i);case"selectionchange":if(qi)break;case"keydown":case"keyup":return Qi(n,i)}return null}},er=Xn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),tr=Xn.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),nr=Ii.extend({relatedTarget:null});function ir(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var rr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},or={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sr=Ii.extend({key:function(e){if(e.key){var t=rr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ir(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?or[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Oi,charCode:function(e){return"keypress"===e.type?ir(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ir(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ar=Fi.extend({dataTransfer:null}),lr=Ii.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Oi}),cr=Xn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),dr=Fi.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),ur={eventTypes:Bt,extractEvents:function(e,t,n,i){var r=Ft.get(e);if(!r)return null;switch(e){case"keypress":if(0===ir(n))return null;case"keydown":case"keyup":e=sr;break;case"blur":case"focus":e=nr;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Fi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=ar;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=lr;break;case Ye:case Je:case Ke:e=er;break;case Xe:e=cr;break;case"scroll":e=Ii;break;case"wheel":e=dr;break;case"copy":case"cut":case"paste":e=tr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Ui;break;default:e=Xn}return Gn(t=e.getPooled(r,t,n,i)),t}};if(y)throw Error(s(101));y=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),S(),f=_n,g=On,m=Nn,T({SimpleEventPlugin:ur,EnterLeaveEventPlugin:ji,ChangeEventPlugin:Mi,SelectEventPlugin:$i,BeforeInputEventPlugin:pi});var hr=[],pr=-1;function fr(e){0>pr||(e.current=hr[pr],hr[pr]=null,pr--)}function gr(e,t){pr++,hr[pr]=e.current,e.current=t}var mr={},vr={current:mr},yr={current:!1},br=mr;function Sr(e,t){var n=e.type.contextTypes;if(!n)return mr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function wr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function xr(){fr(yr),fr(vr)}function Cr(e,t,n){if(vr.current!==mr)throw Error(s(168));gr(vr,t),gr(yr,n)}function kr(e,t,n){var i=e.stateNode;if(e=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var o in i=i.getChildContext())if(!(o in e))throw Error(s(108,me(t)||"Unknown",o));return r({},n,{},i)}function Er(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||mr,br=vr.current,gr(vr,e),gr(yr,yr.current),!0}function Tr(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=kr(e,t,br),i.__reactInternalMemoizedMergedChildContext=e,fr(yr),fr(vr),gr(vr,e)):fr(yr),gr(yr,n)}var Lr=o.unstable_runWithPriority,Pr=o.unstable_scheduleCallback,Dr=o.unstable_cancelCallback,Mr=o.unstable_requestPaint,Ir=o.unstable_now,Rr=o.unstable_getCurrentPriorityLevel,Ar=o.unstable_ImmediatePriority,Or=o.unstable_UserBlockingPriority,Nr=o.unstable_NormalPriority,_r=o.unstable_LowPriority,Vr=o.unstable_IdlePriority,Br={},Fr=o.unstable_shouldYield,Ur=void 0!==Mr?Mr:function(){},zr=null,jr=null,Gr=!1,Wr=Ir(),Hr=1e4>Wr?Ir:function(){return Ir()-Wr};function qr(){switch(Rr()){case Ar:return 99;case Or:return 98;case Nr:return 97;case _r:return 96;case Vr:return 95;default:throw Error(s(332))}}function Yr(e){switch(e){case 99:return Ar;case 98:return Or;case 97:return Nr;case 96:return _r;case 95:return Vr;default:throw Error(s(332))}}function Jr(e,t){return e=Yr(e),Lr(e,t)}function Kr(e,t,n){return e=Yr(e),Pr(e,t,n)}function Xr(e){return null===zr?(zr=[e],jr=Pr(Ar,Qr)):zr.push(e),Br}function Zr(){if(null!==jr){var e=jr;jr=null,Dr(e)}Qr()}function Qr(){if(!Gr&&null!==zr){Gr=!0;var e=0;try{var t=zr;Jr(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),zr=null}catch(n){throw null!==zr&&(zr=zr.slice(e+1)),Pr(Ar,Zr),n}finally{Gr=!1}}}function $r(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function eo(e,t){if(e&&e.defaultProps)for(var n in t=r({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var to={current:null},no=null,io=null,ro=null;function oo(){ro=io=no=null}function so(e){var t=to.current;fr(to),e.type._context._currentValue=t}function ao(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function lo(e,t){no=e,ro=io=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(_s=!0),e.firstContext=null)}function co(e,t){if(ro!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(ro=e,t=1073741823),t={context:e,observedBits:t,next:null},null===io){if(null===no)throw Error(s(308));io=t,no.dependencies={expirationTime:0,firstContext:t,responders:null}}else io=io.next=t;return e._currentValue}var uo=!1;function ho(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function po(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function fo(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function go(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function mo(e,t){var n=e.alternate;null!==n&&po(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function vo(e,t,n,i){var o=e.updateQueue;uo=!1;var s=o.baseQueue,a=o.shared.pending;if(null!==a){if(null!==s){var l=s.next;s.next=a.next,a.next=l}s=a,o.shared.pending=null,null!==(l=e.alternate)&&(null!==(l=l.updateQueue)&&(l.baseQueue=a))}if(null!==s){l=s.next;var c=o.baseState,d=0,u=null,h=null,p=null;if(null!==l)for(var f=l;;){if((a=f.expirationTime)<i){var g={expirationTime:f.expirationTime,suspenseConfig:f.suspenseConfig,tag:f.tag,payload:f.payload,callback:f.callback,next:null};null===p?(h=p=g,u=c):p=p.next=g,a>d&&(d=a)}else{null!==p&&(p=p.next={expirationTime:1073741823,suspenseConfig:f.suspenseConfig,tag:f.tag,payload:f.payload,callback:f.callback,next:null}),xl(a,f.suspenseConfig);e:{var m=e,v=f;switch(a=t,g=n,v.tag){case 1:if("function"===typeof(m=v.payload)){c=m.call(g,c,a);break e}c=m;break e;case 3:m.effectTag=-4097&m.effectTag|64;case 0:if(null===(a="function"===typeof(m=v.payload)?m.call(g,c,a):m)||void 0===a)break e;c=r({},c,a);break e;case 2:uo=!0}}null!==f.callback&&(e.effectTag|=32,null===(a=o.effects)?o.effects=[f]:a.push(f))}if(null===(f=f.next)||f===l){if(null===(a=o.shared.pending))break;f=s.next=a.next,a.next=l,o.baseQueue=s=a,o.shared.pending=null}}null===p?u=c:p.next=h,o.baseState=u,o.baseQueue=p,Cl(d),e.expirationTime=d,e.memoizedState=c}}function yo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=r,r=n,"function"!==typeof i)throw Error(s(191,i));i.call(r)}}}var bo=X.ReactCurrentBatchConfig,So=(new i.Component).refs;function wo(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:r({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var xo={isMounted:function(e){return!!(e=e._reactInternalFiber)&&et(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var i=cl(),r=bo.suspense;(r=fo(i=dl(i,e,r),r)).payload=t,void 0!==n&&null!==n&&(r.callback=n),go(e,r),ul(e,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var i=cl(),r=bo.suspense;(r=fo(i=dl(i,e,r),r)).tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),go(e,r),ul(e,i)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=cl(),i=bo.suspense;(i=fo(n=dl(n,e,i),i)).tag=2,void 0!==t&&null!==t&&(i.callback=t),go(e,i),ul(e,n)}};function Co(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!Hi(n,i)||!Hi(r,o))}function ko(e,t,n){var i=!1,r=mr,o=t.contextType;return"object"===typeof o&&null!==o?o=co(o):(r=wr(t)?br:vr.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?Sr(e,r):mr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=xo,e.stateNode=t,t._reactInternalFiber=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Eo(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&xo.enqueueReplaceState(t,t.state,null)}function To(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=So,ho(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=co(o):(o=wr(t)?br:vr.current,r.context=Sr(e,o)),vo(e,n,r,i),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(wo(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&xo.enqueueReplaceState(r,r.state,null),vo(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.effectTag|=4)}var Lo=Array.isArray;function Po(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===r?t.ref:(t=function(e){var t=i.refs;t===So&&(t=i.refs={}),null===e?delete t[r]:t[r]=e},t._stringRef=r,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function Do(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Mo(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Gl(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.effectTag=2,n):i:(t.effectTag=2,n):n}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=ql(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){return null!==t&&t.elementType===n.type?((i=r(t,n.props)).ref=Po(e,t,n),i.return=e,i):((i=Wl(n.type,n.key,n.props,null,e.mode,i)).ref=Po(e,t,n),i.return=e,i)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Yl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,i,o){return null===t||7!==t.tag?((t=Hl(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=ql(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case ee:return(n=Wl(t.type,t.key,t.props,null,e.mode,n)).ref=Po(e,null,t),n.return=e,n;case te:return(t=Yl(t,e.mode,n)).return=e,t}if(Lo(t)||ge(t))return(t=Hl(t,e.mode,n,null)).return=e,t;Do(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===r?n.type===ne?u(e,t,n.props.children,i,r):c(e,t,n,i):null;case te:return n.key===r?d(e,t,n,i):null}if(Lo(n)||ge(n))return null!==r?null:u(e,t,n,i,null);Do(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case ee:return e=e.get(null===i.key?n:i.key)||null,i.type===ne?u(t,e,i.props.children,r,i.key):c(t,e,i,r);case te:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r)}if(Lo(i)||ge(i))return u(t,e=e.get(n)||null,i,r,null);Do(t,i)}return null}function g(r,s,a,l){for(var c=null,d=null,u=s,g=s=0,m=null;null!==u&&g<a.length;g++){u.index>g?(m=u,u=null):m=u.sibling;var v=p(r,u,a[g],l);if(null===v){null===u&&(u=m);break}e&&u&&null===v.alternate&&t(r,u),s=o(v,s,g),null===d?c=v:d.sibling=v,d=v,u=m}if(g===a.length)return n(r,u),c;if(null===u){for(;g<a.length;g++)null!==(u=h(r,a[g],l))&&(s=o(u,s,g),null===d?c=u:d.sibling=u,d=u);return c}for(u=i(r,u);g<a.length;g++)null!==(m=f(u,r,g,a[g],l))&&(e&&null!==m.alternate&&u.delete(null===m.key?g:m.key),s=o(m,s,g),null===d?c=m:d.sibling=m,d=m);return e&&u.forEach((function(e){return t(r,e)})),c}function m(r,a,l,c){var d=ge(l);if("function"!==typeof d)throw Error(s(150));if(null==(l=d.call(l)))throw Error(s(151));for(var u=d=null,g=a,m=a=0,v=null,y=l.next();null!==g&&!y.done;m++,y=l.next()){g.index>m?(v=g,g=null):v=g.sibling;var b=p(r,g,y.value,c);if(null===b){null===g&&(g=v);break}e&&g&&null===b.alternate&&t(r,g),a=o(b,a,m),null===u?d=b:u.sibling=b,u=b,g=v}if(y.done)return n(r,g),d;if(null===g){for(;!y.done;m++,y=l.next())null!==(y=h(r,y.value,c))&&(a=o(y,a,m),null===u?d=y:u.sibling=y,u=y);return d}for(g=i(r,g);!y.done;m++,y=l.next())null!==(y=f(g,r,m,y.value,c))&&(e&&null!==y.alternate&&g.delete(null===y.key?m:y.key),a=o(y,a,m),null===u?d=y:u.sibling=y,u=y);return e&&g.forEach((function(e){return t(r,e)})),d}return function(e,i,o,l){var c="object"===typeof o&&null!==o&&o.type===ne&&null===o.key;c&&(o=o.props.children);var d="object"===typeof o&&null!==o;if(d)switch(o.$$typeof){case ee:e:{for(d=o.key,c=i;null!==c;){if(c.key===d){if(7===c.tag){if(o.type===ne){n(e,c.sibling),(i=r(c,o.props.children)).return=e,e=i;break e}}else if(c.elementType===o.type){n(e,c.sibling),(i=r(c,o.props)).ref=Po(e,c,o),i.return=e,e=i;break e}n(e,c);break}t(e,c),c=c.sibling}o.type===ne?((i=Hl(o.props.children,e.mode,l,o.key)).return=e,e=i):((l=Wl(o.type,o.key,o.props,null,e.mode,l)).ref=Po(e,i,o),l.return=e,e=l)}return a(e);case te:e:{for(c=o.key;null!==i;){if(i.key===c){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(e,i.sibling),(i=r(i,o.children||[])).return=e,e=i;break e}n(e,i);break}t(e,i),i=i.sibling}(i=Yl(o,e.mode,l)).return=e,e=i}return a(e)}if("string"===typeof o||"number"===typeof o)return o=""+o,null!==i&&6===i.tag?(n(e,i.sibling),(i=r(i,o)).return=e,e=i):(n(e,i),(i=ql(o,e.mode,l)).return=e,e=i),a(e);if(Lo(o))return g(e,i,o,l);if(ge(o))return m(e,i,o,l);if(d&&Do(e,o),"undefined"===typeof o&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(s(152,e.displayName||e.name||"Component"))}return n(e,i)}}var Io=Mo(!0),Ro=Mo(!1),Ao={},Oo={current:Ao},No={current:Ao},_o={current:Ao};function Vo(e){if(e===Ao)throw Error(s(174));return e}function Bo(e,t){switch(gr(_o,t),gr(No,e),gr(Oo,Ao),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ve(null,"");break;default:t=Ve(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}fr(Oo),gr(Oo,t)}function Fo(){fr(Oo),fr(No),fr(_o)}function Uo(e){Vo(_o.current);var t=Vo(Oo.current),n=Ve(t,e.type);t!==n&&(gr(No,e),gr(Oo,n))}function zo(e){No.current===e&&(fr(Oo),fr(No))}var jo={current:0};function Go(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||n.data===bn||n.data===Sn))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Wo(e,t){return{responder:e,props:t}}var Ho=X.ReactCurrentDispatcher,qo=X.ReactCurrentBatchConfig,Yo=0,Jo=null,Ko=null,Xo=null,Zo=!1;function Qo(){throw Error(s(321))}function $o(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Gi(e[n],t[n]))return!1;return!0}function es(e,t,n,i,r,o){if(Yo=o,Jo=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,Ho.current=null===e||null===e.memoizedState?Cs:ks,e=n(i,r),t.expirationTime===Yo){o=0;do{if(t.expirationTime=0,!(25>o))throw Error(s(301));o+=1,Xo=Ko=null,t.updateQueue=null,Ho.current=Es,e=n(i,r)}while(t.expirationTime===Yo)}if(Ho.current=xs,t=null!==Ko&&null!==Ko.next,Yo=0,Xo=Ko=Jo=null,Zo=!1,t)throw Error(s(300));return e}function ts(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Xo?Jo.memoizedState=Xo=e:Xo=Xo.next=e,Xo}function ns(){if(null===Ko){var e=Jo.alternate;e=null!==e?e.memoizedState:null}else e=Ko.next;var t=null===Xo?Jo.memoizedState:Xo.next;if(null!==t)Xo=t,Ko=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Ko=e).memoizedState,baseState:Ko.baseState,baseQueue:Ko.baseQueue,queue:Ko.queue,next:null},null===Xo?Jo.memoizedState=Xo=e:Xo=Xo.next=e}return Xo}function is(e,t){return"function"===typeof t?t(e):t}function rs(e){var t=ns(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=Ko,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(null!==r){r=r.next,i=i.baseState;var l=a=o=null,c=r;do{var d=c.expirationTime;if(d<Yo){var u={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=u,o=i):l=l.next=u,d>Jo.expirationTime&&(Jo.expirationTime=d,Cl(d))}else null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),xl(d,c.suspenseConfig),i=c.eagerReducer===e?c.eagerState:e(i,c.action);c=c.next}while(null!==c&&c!==r);null===l?o=i:l.next=a,Gi(i,t.memoizedState)||(_s=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=l,n.lastRenderedState=i}return[t.memoizedState,n.dispatch]}function os(e){var t=ns(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);Gi(o,t.memoizedState)||(_s=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function ss(e){var t=ts();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:is,lastRenderedState:e}).dispatch=ws.bind(null,Jo,e),[t.memoizedState,e]}function as(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=Jo.updateQueue)?(t={lastEffect:null},Jo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function ls(){return ns().memoizedState}function cs(e,t,n,i){var r=ts();Jo.effectTag|=e,r.memoizedState=as(1|t,n,void 0,void 0===i?null:i)}function ds(e,t,n,i){var r=ns();i=void 0===i?null:i;var o=void 0;if(null!==Ko){var s=Ko.memoizedState;if(o=s.destroy,null!==i&&$o(i,s.deps))return void as(t,n,o,i)}Jo.effectTag|=e,r.memoizedState=as(1|t,n,o,i)}function us(e,t){return cs(516,4,e,t)}function hs(e,t){return ds(516,4,e,t)}function ps(e,t){return ds(4,2,e,t)}function fs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function gs(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ds(4,2,fs.bind(null,t,e),n)}function ms(){}function vs(e,t){return ts().memoizedState=[e,void 0===t?null:t],e}function ys(e,t){var n=ns();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&$o(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function bs(e,t){var n=ns();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&$o(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ss(e,t,n){var i=qr();Jr(98>i?98:i,(function(){e(!0)})),Jr(97<i?97:i,(function(){var i=qo.suspense;qo.suspense=void 0===t?null:t;try{e(!1),n()}finally{qo.suspense=i}}))}function ws(e,t,n){var i=cl(),r=bo.suspense;r={expirationTime:i=dl(i,e,r),suspenseConfig:r,action:n,eagerReducer:null,eagerState:null,next:null};var o=t.pending;if(null===o?r.next=r:(r.next=o.next,o.next=r),t.pending=r,o=e.alternate,e===Jo||null!==o&&o===Jo)Zo=!0,r.expirationTime=Yo,Jo.expirationTime=Yo;else{if(0===e.expirationTime&&(null===o||0===o.expirationTime)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.eagerReducer=o,r.eagerState=a,Gi(a,s))return}catch(l){}ul(e,i)}}var xs={readContext:co,useCallback:Qo,useContext:Qo,useEffect:Qo,useImperativeHandle:Qo,useLayoutEffect:Qo,useMemo:Qo,useReducer:Qo,useRef:Qo,useState:Qo,useDebugValue:Qo,useResponder:Qo,useDeferredValue:Qo,useTransition:Qo},Cs={readContext:co,useCallback:vs,useContext:co,useEffect:us,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,cs(4,2,fs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return cs(4,2,e,t)},useMemo:function(e,t){var n=ts();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ts();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e=(e=i.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=ws.bind(null,Jo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ts().memoizedState=e},useState:ss,useDebugValue:ms,useResponder:Wo,useDeferredValue:function(e,t){var n=ss(e),i=n[0],r=n[1];return us((function(){var n=qo.suspense;qo.suspense=void 0===t?null:t;try{r(e)}finally{qo.suspense=n}}),[e,t]),i},useTransition:function(e){var t=ss(!1),n=t[0];return t=t[1],[vs(Ss.bind(null,t,e),[t,e]),n]}},ks={readContext:co,useCallback:ys,useContext:co,useEffect:hs,useImperativeHandle:gs,useLayoutEffect:ps,useMemo:bs,useReducer:rs,useRef:ls,useState:function(){return rs(is)},useDebugValue:ms,useResponder:Wo,useDeferredValue:function(e,t){var n=rs(is),i=n[0],r=n[1];return hs((function(){var n=qo.suspense;qo.suspense=void 0===t?null:t;try{r(e)}finally{qo.suspense=n}}),[e,t]),i},useTransition:function(e){var t=rs(is),n=t[0];return t=t[1],[ys(Ss.bind(null,t,e),[t,e]),n]}},Es={readContext:co,useCallback:ys,useContext:co,useEffect:hs,useImperativeHandle:gs,useLayoutEffect:ps,useMemo:bs,useReducer:os,useRef:ls,useState:function(){return os(is)},useDebugValue:ms,useResponder:Wo,useDeferredValue:function(e,t){var n=os(is),i=n[0],r=n[1];return hs((function(){var n=qo.suspense;qo.suspense=void 0===t?null:t;try{r(e)}finally{qo.suspense=n}}),[e,t]),i},useTransition:function(e){var t=os(is),n=t[0];return t=t[1],[ys(Ss.bind(null,t,e),[t,e]),n]}},Ts=null,Ls=null,Ps=!1;function Ds(e,t){var n=zl(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ms(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Is(e){if(Ps){var t=Ls;if(t){var n=t;if(!Ms(e,t)){if(!(t=Ln(n.nextSibling))||!Ms(e,t))return e.effectTag=-1025&e.effectTag|2,Ps=!1,void(Ts=e);Ds(Ts,n)}Ts=e,Ls=Ln(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Ps=!1,Ts=e}}function Rs(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Ts=e}function As(e){if(e!==Ts)return!1;if(!Ps)return Rs(e),Ps=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!kn(t,e.memoizedProps))for(t=Ls;t;)Ds(e,t),t=Ln(t.nextSibling);if(Rs(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if(n===yn){if(0===t){Ls=Ln(e.nextSibling);break e}t--}else n!==vn&&n!==Sn&&n!==bn||t++}e=e.nextSibling}Ls=null}}else Ls=Ts?Ln(e.stateNode.nextSibling):null;return!0}function Os(){Ls=Ts=null,Ps=!1}var Ns=X.ReactCurrentOwner,_s=!1;function Vs(e,t,n,i){t.child=null===e?Ro(t,null,n,i):Io(t,e.child,n,i)}function Bs(e,t,n,i,r){n=n.render;var o=t.ref;return lo(t,r),i=es(e,t,n,i,o,r),null===e||_s?(t.effectTag|=1,Vs(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),ta(e,t,r))}function Fs(e,t,n,i,r,o){if(null===e){var s=n.type;return"function"!==typeof s||jl(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Wl(n.type,null,i,null,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Us(e,t,s,i,r,o))}return s=e.child,r<o&&(r=s.memoizedProps,(n=null!==(n=n.compare)?n:Hi)(r,i)&&e.ref===t.ref)?ta(e,t,o):(t.effectTag|=1,(e=Gl(s,i)).ref=t.ref,e.return=t,t.child=e)}function Us(e,t,n,i,r,o){return null!==e&&Hi(e.memoizedProps,i)&&e.ref===t.ref&&(_s=!1,r<o)?(t.expirationTime=e.expirationTime,ta(e,t,o)):js(e,t,n,i,o)}function zs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function js(e,t,n,i,r){var o=wr(n)?br:vr.current;return o=Sr(t,o),lo(t,r),n=es(e,t,n,i,o,r),null===e||_s?(t.effectTag|=1,Vs(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),ta(e,t,r))}function Gs(e,t,n,i,r){if(wr(n)){var o=!0;Er(t)}else o=!1;if(lo(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),ko(t,n,i),To(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=co(c):c=Sr(t,c=wr(n)?br:vr.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof s.getSnapshotBeforeUpdate;u||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==i||l!==c)&&Eo(t,s,i,c),uo=!1;var h=t.memoizedState;s.state=h,vo(t,i,s,r),l=t.memoizedState,a!==i||h!==l||yr.current||uo?("function"===typeof d&&(wo(t,n,d,i),l=t.memoizedState),(a=uo||Co(t,n,a,i,h,l,c))?(u||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.effectTag|=4)):("function"===typeof s.componentDidMount&&(t.effectTag|=4),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=c,i=a):("function"===typeof s.componentDidMount&&(t.effectTag|=4),i=!1)}else s=t.stateNode,po(e,t),a=t.memoizedProps,s.props=t.type===t.elementType?a:eo(t.type,a),l=s.context,"object"===typeof(c=n.contextType)&&null!==c?c=co(c):c=Sr(t,c=wr(n)?br:vr.current),(u="function"===typeof(d=n.getDerivedStateFromProps)||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==i||l!==c)&&Eo(t,s,i,c),uo=!1,l=t.memoizedState,s.state=l,vo(t,i,s,r),h=t.memoizedState,a!==i||l!==h||yr.current||uo?("function"===typeof d&&(wo(t,n,d,i),h=t.memoizedState),(d=uo||Co(t,n,a,i,l,h,c))?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(i,h,c),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,h,c)),"function"===typeof s.componentDidUpdate&&(t.effectTag|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),t.memoizedProps=i,t.memoizedState=h),s.props=i,s.state=h,s.context=c,i=d):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),i=!1);return Ws(e,t,n,i,o,r)}function Ws(e,t,n,i,r,o){zs(e,t);var s=0!==(64&t.effectTag);if(!i&&!s)return r&&Tr(t,n,!1),ta(e,t,o);i=t.stateNode,Ns.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.effectTag|=1,null!==e&&s?(t.child=Io(t,e.child,null,o),t.child=Io(t,null,a,o)):Vs(e,t,a,o),t.memoizedState=i.state,r&&Tr(t,n,!0),t.child}function Hs(e){var t=e.stateNode;t.pendingContext?Cr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Cr(0,t.context,!1),Bo(e,t.containerInfo)}var qs,Ys,Js,Ks,Xs={dehydrated:null,retryTime:0};function Zs(e,t,n){var i,r=t.mode,o=t.pendingProps,s=jo.current,a=!1;if((i=0!==(64&t.effectTag))||(i=0!==(2&s)&&(null===e||null!==e.memoizedState)),i?(a=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(s|=1),gr(jo,1&s),null===e){if(void 0!==o.fallback&&Is(t),a){if(a=o.fallback,(o=Hl(null,r,0,null)).return=t,0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=Hl(a,r,n,null)).return=t,o.sibling=n,t.memoizedState=Xs,t.child=o,n}return r=o.children,t.memoizedState=null,t.child=Ro(t,null,r,n)}if(null!==e.memoizedState){if(r=(e=e.child).sibling,a){if(o=o.fallback,(n=Gl(e,e.pendingProps)).return=t,0===(2&t.mode)&&(a=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=a;null!==a;)a.return=n,a=a.sibling;return(r=Gl(r,o)).return=t,n.sibling=r,n.childExpirationTime=0,t.memoizedState=Xs,t.child=n,r}return n=Io(t,e.child,o.children,n),t.memoizedState=null,t.child=n}if(e=e.child,a){if(a=o.fallback,(o=Hl(null,r,0,null)).return=t,o.child=e,null!==e&&(e.return=o),0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=Hl(a,r,n,null)).return=t,o.sibling=n,n.effectTag|=2,o.childExpirationTime=0,t.memoizedState=Xs,t.child=o,n}return t.memoizedState=null,t.child=Io(t,e,o.children,n)}function Qs(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),ao(e.return,t)}function $s(e,t,n,i,r,o){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailExpiration:0,tailMode:r,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailExpiration=0,s.tailMode=r,s.lastEffect=o)}function ea(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(Vs(e,t,i.children,n),0!==(2&(i=jo.current)))i=1&i|2,t.effectTag|=64;else{if(null!==e&&0!==(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qs(e,n);else if(19===e.tag)Qs(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(gr(jo,i),0===(2&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===Go(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),$s(t,!1,r,n,o,t.lastEffect);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Go(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}$s(t,!0,n,null,o,t.lastEffect);break;case"together":$s(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ta(e,t,n){null!==e&&(t.dependencies=e.dependencies);var i=t.expirationTime;if(0!==i&&Cl(i),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Gl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Gl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function na(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function ia(e,t,n){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return wr(t.type)&&xr(),null;case 3:return Fo(),fr(yr),fr(vr),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!As(t)||(t.effectTag|=4),Ys(t),null;case 5:zo(t),n=Vo(_o.current);var o=t.type;if(null!==e&&null!=t.stateNode)Js(e,t,o,i,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!i){if(null===t.stateNode)throw Error(s(166));return null}if(e=Vo(Oo.current),As(t)){i=t.stateNode,o=t.type;var a=t.memoizedProps;switch(i[Mn]=t,i[In]=a,o){case"iframe":case"object":case"embed":Jt("load",i);break;case"video":case"audio":for(e=0;e<Ze.length;e++)Jt(Ze[e],i);break;case"source":Jt("error",i);break;case"img":case"image":case"link":Jt("error",i),Jt("load",i);break;case"form":Jt("reset",i),Jt("submit",i);break;case"details":Jt("toggle",i);break;case"input":Ce(i,a),Jt("invalid",i),cn(n,"onChange");break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Jt("invalid",i),cn(n,"onChange");break;case"textarea":Ie(i,a),Jt("invalid",i),cn(n,"onChange")}for(var l in sn(o,a),e=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?i.textContent!==c&&(e=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(e=["children",""+c]):k.hasOwnProperty(l)&&null!=c&&cn(n,l)}switch(o){case"input":Se(i),Te(i,a,!0);break;case"textarea":Se(i),Ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=dn)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(l=9===n.nodeType?n:n.ownerDocument,e===ln&&(e=_e(o)),e===ln?"script"===o?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(o,{is:i.is}):(e=l.createElement(o),"select"===o&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,o),e[Mn]=t,e[In]=i,qs(e,t,!1,!1),t.stateNode=e,l=an(o,i),o){case"iframe":case"object":case"embed":Jt("load",e),c=i;break;case"video":case"audio":for(c=0;c<Ze.length;c++)Jt(Ze[c],e);c=i;break;case"source":Jt("error",e),c=i;break;case"img":case"image":case"link":Jt("error",e),Jt("load",e),c=i;break;case"form":Jt("reset",e),Jt("submit",e),c=i;break;case"details":Jt("toggle",e),c=i;break;case"input":Ce(e,i),c=xe(e,i),Jt("invalid",e),cn(n,"onChange");break;case"option":c=Pe(e,i);break;case"select":e._wrapperState={wasMultiple:!!i.multiple},c=r({},i,{value:void 0}),Jt("invalid",e),cn(n,"onChange");break;case"textarea":Ie(e,i),c=Me(e,i),Jt("invalid",e),cn(n,"onChange");break;default:c=i}sn(o,c);var d=c;for(a in d)if(d.hasOwnProperty(a)){var u=d[a];"style"===a?rn(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&Ue(e,u):"children"===a?"string"===typeof u?("textarea"!==o||""!==u)&&ze(e,u):"number"===typeof u&&ze(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(k.hasOwnProperty(a)?null!=u&&cn(n,a):null!=u&&Z(e,a,u,l))}switch(o){case"input":Se(e),Te(e,i,!1);break;case"textarea":Se(e),Ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+ye(i.value));break;case"select":e.multiple=!!i.multiple,null!=(n=i.value)?De(e,!!i.multiple,n,!1):null!=i.defaultValue&&De(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof c.onClick&&(e.onclick=dn)}Cn(o,i)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)Ks(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));n=Vo(_o.current),Vo(Oo.current),As(t)?(n=t.stateNode,i=t.memoizedProps,n[Mn]=t,n.nodeValue!==i&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[Mn]=t,t.stateNode=n)}return null;case 13:return fr(jo),i=t.memoizedState,0!==(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==i,i=!1,null===e?void 0!==t.memoizedProps.fallback&&As(t):(i=null!==(o=e.memoizedState),n||null===o||null!==(o=e.child.sibling)&&(null!==(a=t.firstEffect)?(t.firstEffect=o,o.nextEffect=a):(t.firstEffect=t.lastEffect=o,o.nextEffect=null),o.effectTag=8)),n&&!i&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&jo.current)?Ga===Aa&&(Ga=_a):(Ga!==Aa&&Ga!==_a||(Ga=Va),0!==Ja&&null!==Ua&&(Xl(Ua,ja),Zl(Ua,Ja)))),(n||i)&&(t.effectTag|=4),null);case 4:return Fo(),Ys(t),null;case 10:return so(t),null;case 19:if(fr(jo),null===(i=t.memoizedState))return null;if(o=0!==(64&t.effectTag),null===(a=i.rendering)){if(o)na(i,!1);else if(Ga!==Aa||null!==e&&0!==(64&e.effectTag))for(a=t.child;null!==a;){if(null!==(e=Go(a))){for(t.effectTag|=64,na(i,!1),null!==(o=e.updateQueue)&&(t.updateQueue=o,t.effectTag|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=t.child;null!==i;)a=n,(o=i).effectTag&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,null===(e=o.alternate)?(o.childExpirationTime=0,o.expirationTime=a,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null):(o.childExpirationTime=e.childExpirationTime,o.expirationTime=e.expirationTime,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,a=e.dependencies,o.dependencies=null===a?null:{expirationTime:a.expirationTime,firstContext:a.firstContext,responders:a.responders}),i=i.sibling;return gr(jo,1&jo.current|2),t.child}a=a.sibling}}else{if(!o)if(null!==(e=Go(a))){if(t.effectTag|=64,o=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),na(i,!0),null===i.tail&&"hidden"===i.tailMode&&!a.alternate)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*Hr()-i.renderingStartTime>i.tailExpiration&&1<n&&(t.effectTag|=64,o=!0,na(i,!1),t.expirationTime=t.childExpirationTime=n-1);i.isBackwards?(a.sibling=t.child,t.child=a):(null!==(n=i.last)?n.sibling=a:t.child=a,i.last=a)}return null!==i.tail?(0===i.tailExpiration&&(i.tailExpiration=Hr()+500),n=i.tail,i.rendering=n,i.tail=n.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=Hr(),n.sibling=null,t=jo.current,gr(jo,o?1&t|2:1&t),n):null}throw Error(s(156,t.tag))}function ra(e){switch(e.tag){case 1:wr(e.type)&&xr();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Fo(),fr(yr),fr(vr),0!==(64&(t=e.effectTag)))throw Error(s(285));return e.effectTag=-4097&t|64,e;case 5:return zo(e),null;case 13:return fr(jo),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return fr(jo),null;case 4:return Fo(),null;case 10:return so(e),null;default:return null}}function oa(e,t){return{value:e,source:t,stack:ve(t)}}qs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ys=function(){},Js=function(e,t,n,i,o){var s=e.memoizedProps;if(s!==i){var a,l,c=t.stateNode;switch(Vo(Oo.current),e=null,n){case"input":s=xe(c,s),i=xe(c,i),e=[];break;case"option":s=Pe(c,s),i=Pe(c,i),e=[];break;case"select":s=r({},s,{value:void 0}),i=r({},i,{value:void 0}),e=[];break;case"textarea":s=Me(c,s),i=Me(c,i),e=[];break;default:"function"!==typeof s.onClick&&"function"===typeof i.onClick&&(c.onclick=dn)}for(a in sn(n,i),n=null,s)if(!i.hasOwnProperty(a)&&s.hasOwnProperty(a)&&null!=s[a])if("style"===a)for(l in c=s[a])c.hasOwnProperty(l)&&(n||(n={}),n[l]="");else"dangerouslySetInnerHTML"!==a&&"children"!==a&&"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(k.hasOwnProperty(a)?e||(e=[]):(e=e||[]).push(a,null));for(a in i){var d=i[a];if(c=null!=s?s[a]:void 0,i.hasOwnProperty(a)&&d!==c&&(null!=d||null!=c))if("style"===a)if(c){for(l in c)!c.hasOwnProperty(l)||d&&d.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in d)d.hasOwnProperty(l)&&c[l]!==d[l]&&(n||(n={}),n[l]=d[l])}else n||(e||(e=[]),e.push(a,n)),n=d;else"dangerouslySetInnerHTML"===a?(d=d?d.__html:void 0,c=c?c.__html:void 0,null!=d&&c!==d&&(e=e||[]).push(a,d)):"children"===a?c===d||"string"!==typeof d&&"number"!==typeof d||(e=e||[]).push(a,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&(k.hasOwnProperty(a)?(null!=d&&cn(o,a),e||c===d||(e=[])):(e=e||[]).push(a,d))}n&&(e=e||[]).push("style",n),o=e,(t.updateQueue=o)&&(t.effectTag|=4)}},Ks=function(e,t,n,i){n!==i&&(t.effectTag|=4)};var sa="function"===typeof WeakSet?WeakSet:Set;function aa(e,t){var n=t.source,i=t.stack;null===i&&null!==n&&(i=ve(n)),null!==n&&me(n.type),t=t.value,null!==e&&1===e.tag&&me(e.type);try{console.error(t)}catch(r){setTimeout((function(){throw r}))}}function la(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Nl(e,n)}else t.current=null}function ca(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 3:case 5:case 6:case 4:case 17:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,i=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:eo(t.type,n),i),e.__reactInternalSnapshotBeforeUpdate=t}return}throw Error(s(163))}function da(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.destroy;n.destroy=void 0,void 0!==i&&i()}n=n.next}while(n!==t)}}function ua(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ha(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void ua(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var i=n.elementType===n.type?t.memoizedProps:eo(n.type,t.memoizedProps);e.componentDidUpdate(i,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&yo(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:case 1:e=n.child.stateNode}yo(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&Cn(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Vt(n)))))}throw Error(s(163))}function pa(e,t,n){switch("function"===typeof Fl&&Fl(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e.next;Jr(97<n?97:n,(function(){var e=i;do{var n=e.destroy;if(void 0!==n){var r=t;try{n()}catch(o){Nl(r,o)}}e=e.next}while(e!==i)}))}break;case 1:la(t),"function"===typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(n){Nl(e,n)}}(t,n);break;case 5:la(t);break;case 4:ba(e,t,n)}}function fa(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&fa(t)}function ga(e){return 5===e.tag||3===e.tag||4===e.tag}function ma(e){e:{for(var t=e.return;null!==t;){if(ga(t)){var n=t;break e}t=t.return}throw Error(s(160))}switch(t=n.stateNode,n.tag){case 5:var i=!1;break;case 3:case 4:t=t.containerInfo,i=!0;break;default:throw Error(s(161))}16&n.effectTag&&(ze(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ga(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}i?va(e,n,t):ya(e,n,t)}function va(e,t,n){var i=e.tag,r=5===i||6===i;if(r)e=r?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=dn));else if(4!==i&&null!==(e=e.child))for(va(e,t,n),e=e.sibling;null!==e;)va(e,t,n),e=e.sibling}function ya(e,t,n){var i=e.tag,r=5===i||6===i;if(r)e=r?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ya(e,t,n),e=e.sibling;null!==e;)ya(e,t,n),e=e.sibling}function ba(e,t,n){for(var i,r,o=t,a=!1;;){if(!a){a=o.return;e:for(;;){if(null===a)throw Error(s(160));switch(i=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:i=i.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===o.tag||6===o.tag){e:for(var l=e,c=o,d=n,u=c;;)if(pa(l,u,d),null!==u.child&&4!==u.tag)u.child.return=u,u=u.child;else{if(u===c)break e;for(;null===u.sibling;){if(null===u.return||u.return===c)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}r?(l=i,c=o.stateNode,8===l.nodeType?l.parentNode.removeChild(c):l.removeChild(c)):i.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){i=o.stateNode.containerInfo,r=!0,o.child.return=o,o=o.child;continue}}else if(pa(e,o,n),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(a=!1)}o.sibling.return=o.return,o=o.sibling}}function Sa(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void da(3,t);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps,r=null!==e?e.memoizedProps:i;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[In]=i,"input"===e&&"radio"===i.type&&null!=i.name&&ke(n,i),an(e,r),t=an(e,i),r=0;r<o.length;r+=2){var a=o[r],l=o[r+1];"style"===a?rn(n,l):"dangerouslySetInnerHTML"===a?Ue(n,l):"children"===a?ze(n,l):Z(n,a,l,t)}switch(e){case"input":Ee(n,i);break;case"textarea":Re(n,i);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,null!=(e=i.value)?De(n,!!i.multiple,e,!1):t!==!!i.multiple&&(null!=i.defaultValue?De(n,!!i.multiple,i.defaultValue,!0):De(n,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(s(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Vt(t.containerInfo)));case 13:if(n=t,null===t.memoizedState?i=!1:(i=!0,n=t.child,Xa=Hr()),null!==n)e:for(e=n;;){if(5===e.tag)o=e.stateNode,i?"function"===typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,r=void 0!==(r=e.memoizedProps.style)&&null!==r&&r.hasOwnProperty("display")?r.display:null,o.style.display=nn("display",r));else if(6===e.tag)e.stateNode.nodeValue=i?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void wa(t);case 19:return void wa(t)}throw Error(s(163))}function wa(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new sa),t.forEach((function(t){var i=Vl.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}var xa="function"===typeof WeakMap?WeakMap:Map;function Ca(e,t,n){(n=fo(n,null)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){$a||($a=!0,el=i),aa(e,t)},n}function ka(e,t,n){(n=fo(n,null)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return aa(e,t),i(r)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){"function"!==typeof i&&(null===tl?tl=new Set([this]):tl.add(this),aa(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var Ea,Ta=Math.ceil,La=X.ReactCurrentDispatcher,Pa=X.ReactCurrentOwner,Da=0,Ma=8,Ia=16,Ra=32,Aa=0,Oa=1,Na=2,_a=3,Va=4,Ba=5,Fa=Da,Ua=null,za=null,ja=0,Ga=Aa,Wa=null,Ha=1073741823,qa=1073741823,Ya=null,Ja=0,Ka=!1,Xa=0,Za=500,Qa=null,$a=!1,el=null,tl=null,nl=!1,il=null,rl=90,ol=null,sl=0,al=null,ll=0;function cl(){return(Fa&(Ia|Ra))!==Da?1073741821-(Hr()/10|0):0!==ll?ll:ll=1073741821-(Hr()/10|0)}function dl(e,t,n){if(0===(2&(t=t.mode)))return 1073741823;var i=qr();if(0===(4&t))return 99===i?1073741823:1073741822;if((Fa&Ia)!==Da)return ja;if(null!==n)e=$r(e,0|n.timeoutMs||5e3,250);else switch(i){case 99:e=1073741823;break;case 98:e=$r(e,150,100);break;case 97:case 96:e=$r(e,5e3,250);break;case 95:e=2;break;default:throw Error(s(326))}return null!==Ua&&e===ja&&--e,e}function ul(e,t){if(50<sl)throw sl=0,al=null,Error(s(185));if(null!==(e=hl(e,t))){var n=qr();1073741823===t?(Fa&Ma)!==Da&&(Fa&(Ia|Ra))===Da?ml(e):(fl(e),Fa===Da&&Zr()):fl(e),(4&Fa)===Da||98!==n&&99!==n||(null===ol?ol=new Map([[e,t]]):(void 0===(n=ol.get(e))||n>t)&&ol.set(e,t))}}function hl(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var i=e.return,r=null;if(null===i&&3===e.tag)r=e.stateNode;else for(;null!==i;){if(n=i.alternate,i.childExpirationTime<t&&(i.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===i.return&&3===i.tag){r=i.stateNode;break}i=i.return}return null!==r&&(Ua===r&&(Cl(t),Ga===Va&&Xl(r,ja)),Zl(r,t)),r}function pl(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!Kl(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function fl(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Xr(ml.bind(null,e));else{var t=pl(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var i=cl();if(1073741823===t?i=99:1===t||2===t?i=95:i=0>=(i=10*(1073741821-t)-10*(1073741821-i))?99:250>=i?98:5250>=i?97:95,null!==n){var r=e.callbackPriority;if(e.callbackExpirationTime===t&&r>=i)return;n!==Br&&Dr(n)}e.callbackExpirationTime=t,e.callbackPriority=i,t=1073741823===t?Xr(ml.bind(null,e)):Kr(i,gl.bind(null,e),{timeout:10*(1073741821-t)-Hr()}),e.callbackNode=t}}}function gl(e,t){if(ll=0,t)return Ql(e,t=cl()),fl(e),null;var n=pl(e);if(0!==n){if(t=e.callbackNode,(Fa&(Ia|Ra))!==Da)throw Error(s(327));if(Rl(),e===Ua&&n===ja||bl(e,n),null!==za){var i=Fa;Fa|=Ia;for(var r=wl();;)try{El();break}catch(l){Sl(e,l)}if(oo(),Fa=i,La.current=r,Ga===Oa)throw t=Wa,bl(e,n),Xl(e,n),fl(e),t;if(null===za)switch(r=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,i=Ga,Ua=null,i){case Aa:case Oa:throw Error(s(345));case Na:Ql(e,2<n?2:n);break;case _a:if(Xl(e,n),n===(i=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=Pl(r)),1073741823===Ha&&10<(r=Xa+Za-Hr())){if(Ka){var o=e.lastPingedTime;if(0===o||o>=n){e.lastPingedTime=n,bl(e,n);break}}if(0!==(o=pl(e))&&o!==n)break;if(0!==i&&i!==n){e.lastPingedTime=i;break}e.timeoutHandle=En(Dl.bind(null,e),r);break}Dl(e);break;case Va:if(Xl(e,n),n===(i=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=Pl(r)),Ka&&(0===(r=e.lastPingedTime)||r>=n)){e.lastPingedTime=n,bl(e,n);break}if(0!==(r=pl(e))&&r!==n)break;if(0!==i&&i!==n){e.lastPingedTime=i;break}if(1073741823!==qa?i=10*(1073741821-qa)-Hr():1073741823===Ha?i=0:(i=10*(1073741821-Ha)-5e3,0>(i=(r=Hr())-i)&&(i=0),(n=10*(1073741821-n)-r)<(i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ta(i/1960))-i)&&(i=n)),10<i){e.timeoutHandle=En(Dl.bind(null,e),i);break}Dl(e);break;case Ba:if(1073741823!==Ha&&null!==Ya){o=Ha;var a=Ya;if(0>=(i=0|a.busyMinDurationMs)?i=0:(r=0|a.busyDelayMs,i=(o=Hr()-(10*(1073741821-o)-(0|a.timeoutMs||5e3)))<=r?0:r+i-o),10<i){Xl(e,n),e.timeoutHandle=En(Dl.bind(null,e),i);break}}Dl(e);break;default:throw Error(s(329))}if(fl(e),e.callbackNode===t)return gl.bind(null,e)}}return null}function ml(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,(Fa&(Ia|Ra))!==Da)throw Error(s(327));if(Rl(),e===Ua&&t===ja||bl(e,t),null!==za){var n=Fa;Fa|=Ia;for(var i=wl();;)try{kl();break}catch(r){Sl(e,r)}if(oo(),Fa=n,La.current=i,Ga===Oa)throw n=Wa,bl(e,t),Xl(e,t),fl(e),n;if(null!==za)throw Error(s(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Ua=null,Dl(e),fl(e)}return null}function vl(e,t){var n=Fa;Fa|=1;try{return e(t)}finally{(Fa=n)===Da&&Zr()}}function yl(e,t){var n=Fa;Fa&=-2,Fa|=Ma;try{return e(t)}finally{(Fa=n)===Da&&Zr()}}function bl(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Tn(n)),null!==za)for(n=za.return;null!==n;){var i=n;switch(i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&xr();break;case 3:Fo(),fr(yr),fr(vr);break;case 5:zo(i);break;case 4:Fo();break;case 13:case 19:fr(jo);break;case 10:so(i)}n=n.return}Ua=e,za=Gl(e.current,null),ja=t,Ga=Aa,Wa=null,qa=Ha=1073741823,Ya=null,Ja=0,Ka=!1}function Sl(e,t){for(;;){try{if(oo(),Ho.current=xs,Zo)for(var n=Jo.memoizedState;null!==n;){var i=n.queue;null!==i&&(i.pending=null),n=n.next}if(Yo=0,Xo=Ko=Jo=null,Zo=!1,null===za||null===za.return)return Ga=Oa,Wa=t,za=null;e:{var r=e,o=za.return,s=za,a=t;if(t=ja,s.effectTag|=2048,s.firstEffect=s.lastEffect=null,null!==a&&"object"===typeof a&&"function"===typeof a.then){var l=a;if(0===(2&s.mode)){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.expirationTime=c.expirationTime):(s.updateQueue=null,s.memoizedState=null)}var d=0!==(1&jo.current),u=o;do{var h;if(h=13===u.tag){var p=u.memoizedState;if(null!==p)h=null!==p.dehydrated;else{var f=u.memoizedProps;h=void 0!==f.fallback&&(!0!==f.unstable_avoidThisFallback||!d)}}if(h){var g=u.updateQueue;if(null===g){var m=new Set;m.add(l),u.updateQueue=m}else g.add(l);if(0===(2&u.mode)){if(u.effectTag|=64,s.effectTag&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var v=fo(1073741823,null);v.tag=2,go(s,v)}s.expirationTime=1073741823;break e}a=void 0,s=t;var y=r.pingCache;if(null===y?(y=r.pingCache=new xa,a=new Set,y.set(l,a)):void 0===(a=y.get(l))&&(a=new Set,y.set(l,a)),!a.has(s)){a.add(s);var b=_l.bind(null,r,l,s);l.then(b,b)}u.effectTag|=4096,u.expirationTime=t;break e}u=u.return}while(null!==u);a=Error((me(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+ve(s))}Ga!==Ba&&(Ga=Na),a=oa(a,s),u=o;do{switch(u.tag){case 3:l=a,u.effectTag|=4096,u.expirationTime=t,mo(u,Ca(u,l,t));break e;case 1:l=a;var S=u.type,w=u.stateNode;if(0===(64&u.effectTag)&&("function"===typeof S.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===tl||!tl.has(w)))){u.effectTag|=4096,u.expirationTime=t,mo(u,ka(u,l,t));break e}}u=u.return}while(null!==u)}za=Ll(za)}catch(x){t=x;continue}break}}function wl(){var e=La.current;return La.current=xs,null===e?xs:e}function xl(e,t){e<Ha&&2<e&&(Ha=e),null!==t&&e<qa&&2<e&&(qa=e,Ya=t)}function Cl(e){e>Ja&&(Ja=e)}function kl(){for(;null!==za;)za=Tl(za)}function El(){for(;null!==za&&!Fr();)za=Tl(za)}function Tl(e){var t=Ea(e.alternate,e,ja);return e.memoizedProps=e.pendingProps,null===t&&(t=Ll(e)),Pa.current=null,t}function Ll(e){za=e;do{var t=za.alternate;if(e=za.return,0===(2048&za.effectTag)){if(t=ia(t,za,ja),1===ja||1!==za.childExpirationTime){for(var n=0,i=za.child;null!==i;){var r=i.expirationTime,o=i.childExpirationTime;r>n&&(n=r),o>n&&(n=o),i=i.sibling}za.childExpirationTime=n}if(null!==t)return t;null!==e&&0===(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=za.firstEffect),null!==za.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=za.firstEffect),e.lastEffect=za.lastEffect),1<za.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=za:e.firstEffect=za,e.lastEffect=za))}else{if(null!==(t=ra(za)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=za.sibling))return t;za=e}while(null!==za);return Ga===Aa&&(Ga=Ba),null}function Pl(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function Dl(e){var t=qr();return Jr(99,Ml.bind(null,e,t)),null}function Ml(e,t){do{Rl()}while(null!==il);if((Fa&(Ia|Ra))!==Da)throw Error(s(327));var n=e.finishedWork,i=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var r=Pl(n);if(e.firstPendingTime=r,i<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:i<=e.firstSuspendedTime&&(e.firstSuspendedTime=i-1),i<=e.lastPingedTime&&(e.lastPingedTime=0),i<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Ua&&(za=Ua=null,ja=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){var o=Fa;Fa|=Ra,Pa.current=null,wn=Yt;var a=gn();if(mn(a)){if("selectionStart"in a)var l={start:a.selectionStart,end:a.selectionEnd};else e:{var c=(l=(l=a.ownerDocument)&&l.defaultView||window).getSelection&&l.getSelection();if(c&&0!==c.rangeCount){l=c.anchorNode;var d=c.anchorOffset,u=c.focusNode;c=c.focusOffset;try{l.nodeType,u.nodeType}catch(T){l=null;break e}var h=0,p=-1,f=-1,g=0,m=0,v=a,y=null;t:for(;;){for(var b;v!==l||0!==d&&3!==v.nodeType||(p=h+d),v!==u||0!==c&&3!==v.nodeType||(f=h+c),3===v.nodeType&&(h+=v.nodeValue.length),null!==(b=v.firstChild);)y=v,v=b;for(;;){if(v===a)break t;if(y===l&&++g===d&&(p=h),y===u&&++m===c&&(f=h),null!==(b=v.nextSibling))break;y=(v=y).parentNode}v=b}l=-1===p||-1===f?null:{start:p,end:f}}else l=null}l=l||{start:0,end:0}}else l=null;xn={activeElementDetached:null,focusedElem:a,selectionRange:l},Yt=!1,Qa=r;do{try{Il()}catch(T){if(null===Qa)throw Error(s(330));Nl(Qa,T),Qa=Qa.nextEffect}}while(null!==Qa);Qa=r;do{try{for(a=e,l=t;null!==Qa;){var S=Qa.effectTag;if(16&S&&ze(Qa.stateNode,""),128&S){var w=Qa.alternate;if(null!==w){var x=w.ref;null!==x&&("function"===typeof x?x(null):x.current=null)}}switch(1038&S){case 2:ma(Qa),Qa.effectTag&=-3;break;case 6:ma(Qa),Qa.effectTag&=-3,Sa(Qa.alternate,Qa);break;case 1024:Qa.effectTag&=-1025;break;case 1028:Qa.effectTag&=-1025,Sa(Qa.alternate,Qa);break;case 4:Sa(Qa.alternate,Qa);break;case 8:ba(a,d=Qa,l),fa(d)}Qa=Qa.nextEffect}}catch(T){if(null===Qa)throw Error(s(330));Nl(Qa,T),Qa=Qa.nextEffect}}while(null!==Qa);if(x=xn,w=gn(),S=x.focusedElem,l=x.selectionRange,w!==S&&S&&S.ownerDocument&&fn(S.ownerDocument.documentElement,S)){null!==l&&mn(S)&&(w=l.start,void 0===(x=l.end)&&(x=w),"selectionStart"in S?(S.selectionStart=w,S.selectionEnd=Math.min(x,S.value.length)):(x=(w=S.ownerDocument||document)&&w.defaultView||window).getSelection&&(x=x.getSelection(),d=S.textContent.length,a=Math.min(l.start,d),l=void 0===l.end?a:Math.min(l.end,d),!x.extend&&a>l&&(d=l,l=a,a=d),d=pn(S,a),u=pn(S,l),d&&u&&(1!==x.rangeCount||x.anchorNode!==d.node||x.anchorOffset!==d.offset||x.focusNode!==u.node||x.focusOffset!==u.offset)&&((w=w.createRange()).setStart(d.node,d.offset),x.removeAllRanges(),a>l?(x.addRange(w),x.extend(u.node,u.offset)):(w.setEnd(u.node,u.offset),x.addRange(w))))),w=[];for(x=S;x=x.parentNode;)1===x.nodeType&&w.push({element:x,left:x.scrollLeft,top:x.scrollTop});for("function"===typeof S.focus&&S.focus(),S=0;S<w.length;S++)(x=w[S]).element.scrollLeft=x.left,x.element.scrollTop=x.top}Yt=!!wn,xn=wn=null,e.current=n,Qa=r;do{try{for(S=e;null!==Qa;){var C=Qa.effectTag;if(36&C&&ha(S,Qa.alternate,Qa),128&C){w=void 0;var k=Qa.ref;if(null!==k){var E=Qa.stateNode;Qa.tag,w=E,"function"===typeof k?k(w):k.current=w}}Qa=Qa.nextEffect}}catch(T){if(null===Qa)throw Error(s(330));Nl(Qa,T),Qa=Qa.nextEffect}}while(null!==Qa);Qa=null,Ur(),Fa=o}else e.current=n;if(nl)nl=!1,il=e,rl=t;else for(Qa=r;null!==Qa;)t=Qa.nextEffect,Qa.nextEffect=null,Qa=t;if(0===(t=e.firstPendingTime)&&(tl=null),1073741823===t?e===al?sl++:(sl=0,al=e):sl=0,"function"===typeof Bl&&Bl(n.stateNode,i),fl(e),$a)throw $a=!1,e=el,el=null,e;return(Fa&Ma)!==Da||Zr(),null}function Il(){for(;null!==Qa;){var e=Qa.effectTag;0!==(256&e)&&ca(Qa.alternate,Qa),0===(512&e)||nl||(nl=!0,Kr(97,(function(){return Rl(),null}))),Qa=Qa.nextEffect}}function Rl(){if(90!==rl){var e=97<rl?97:rl;return rl=90,Jr(e,Al)}}function Al(){if(null===il)return!1;var e=il;if(il=null,(Fa&(Ia|Ra))!==Da)throw Error(s(331));var t=Fa;for(Fa|=Ra,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!==(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:da(5,n),ua(5,n)}}catch(i){if(null===e)throw Error(s(330));Nl(e,i)}n=e.nextEffect,e.nextEffect=null,e=n}return Fa=t,Zr(),!0}function Ol(e,t,n){go(e,t=Ca(e,t=oa(n,t),1073741823)),null!==(e=hl(e,1073741823))&&fl(e)}function Nl(e,t){if(3===e.tag)Ol(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Ol(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===tl||!tl.has(i))){go(n,e=ka(n,e=oa(t,e),1073741823)),null!==(n=hl(n,1073741823))&&fl(n);break}}n=n.return}}function _l(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),Ua===e&&ja===n?Ga===Va||Ga===_a&&1073741823===Ha&&Hr()-Xa<Za?bl(e,ja):Ka=!0:Kl(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,fl(e)))}function Vl(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(t=dl(t=cl(),e,null)),null!==(e=hl(e,t))&&fl(e)}Ea=function(e,t,n){var i=t.expirationTime;if(null!==e){var r=t.pendingProps;if(e.memoizedProps!==r||yr.current)_s=!0;else{if(i<n){switch(_s=!1,t.tag){case 3:Hs(t),Os();break;case 5:if(Uo(t),4&t.mode&&1!==n&&r.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:wr(t.type)&&Er(t);break;case 4:Bo(t,t.stateNode.containerInfo);break;case 10:i=t.memoizedProps.value,r=t.type._context,gr(to,r._currentValue),r._currentValue=i;break;case 13:if(null!==t.memoizedState)return 0!==(i=t.child.childExpirationTime)&&i>=n?Zs(e,t,n):(gr(jo,1&jo.current),null!==(t=ta(e,t,n))?t.sibling:null);gr(jo,1&jo.current);break;case 19:if(i=t.childExpirationTime>=n,0!==(64&e.effectTag)){if(i)return ea(e,t,n);t.effectTag|=64}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null),gr(jo,jo.current),!i)return null}return ta(e,t,n)}_s=!1}}else _s=!1;switch(t.expirationTime=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,r=Sr(t,vr.current),lo(t,n),r=es(null,t,i,e,r,n),t.effectTag|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,wr(i)){var o=!0;Er(t)}else o=!1;t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,ho(t);var a=i.getDerivedStateFromProps;"function"===typeof a&&wo(t,i,a,e),r.updater=xo,t.stateNode=r,r._reactInternalFiber=t,To(t,i,e,n),t=Ws(null,t,i,!0,o,n)}else t.tag=0,Vs(null,t,r,n),t=t.child;return t;case 16:e:{if(r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(r),1!==r._status)throw r._result;switch(r=r._result,t.type=r,o=t.tag=function(e){if("function"===typeof e)return jl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===le)return 11;if(e===ue)return 14}return 2}(r),e=eo(r,e),o){case 0:t=js(null,t,r,e,n);break e;case 1:t=Gs(null,t,r,e,n);break e;case 11:t=Bs(null,t,r,e,n);break e;case 14:t=Fs(null,t,r,eo(r.type,e),i,n);break e}throw Error(s(306,r,""))}return t;case 0:return i=t.type,r=t.pendingProps,js(e,t,i,r=t.elementType===i?r:eo(i,r),n);case 1:return i=t.type,r=t.pendingProps,Gs(e,t,i,r=t.elementType===i?r:eo(i,r),n);case 3:if(Hs(t),i=t.updateQueue,null===e||null===i)throw Error(s(282));if(i=t.pendingProps,r=null!==(r=t.memoizedState)?r.element:null,po(e,t),vo(t,i,null,n),(i=t.memoizedState.element)===r)Os(),t=ta(e,t,n);else{if((r=t.stateNode.hydrate)&&(Ls=Ln(t.stateNode.containerInfo.firstChild),Ts=t,r=Ps=!0),r)for(n=Ro(t,null,i,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else Vs(e,t,i,n),Os();t=t.child}return t;case 5:return Uo(t),null===e&&Is(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,a=r.children,kn(i,r)?a=null:null!==o&&kn(i,o)&&(t.effectTag|=16),zs(e,t),4&t.mode&&1!==n&&r.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Vs(e,t,a,n),t=t.child),t;case 6:return null===e&&Is(t),null;case 13:return Zs(e,t,n);case 4:return Bo(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Io(t,null,i,n):Vs(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Bs(e,t,i,r=t.elementType===i?r:eo(i,r),n);case 7:return Vs(e,t,t.pendingProps,n),t.child;case 8:case 12:return Vs(e,t,t.pendingProps.children,n),t.child;case 10:e:{i=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value;var l=t.type._context;if(gr(to,l._currentValue),l._currentValue=o,null!==a)if(l=a.value,0===(o=Gi(l,o)?0:0|("function"===typeof i._calculateChangedBits?i._calculateChangedBits(l,o):1073741823))){if(a.children===r.children&&!yr.current){t=ta(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var d=c.firstContext;null!==d;){if(d.context===i&&0!==(d.observedBits&o)){1===l.tag&&((d=fo(n,null)).tag=2,go(l,d)),l.expirationTime<n&&(l.expirationTime=n),null!==(d=l.alternate)&&d.expirationTime<n&&(d.expirationTime=n),ao(l.return,n),c.expirationTime<n&&(c.expirationTime=n);break}d=d.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}Vs(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=(o=t.pendingProps).children,lo(t,n),i=i(r=co(r,o.unstable_observedBits)),t.effectTag|=1,Vs(e,t,i,n),t.child;case 14:return o=eo(r=t.type,t.pendingProps),Fs(e,t,r,o=eo(r.type,o),i,n);case 15:return Us(e,t,t.type,t.pendingProps,i,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:eo(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,wr(i)?(e=!0,Er(t)):e=!1,lo(t,n),ko(t,i,r),To(t,i,r,n),Ws(null,t,i,!0,e,n);case 19:return ea(e,t,n)}throw Error(s(156,t.tag))};var Bl=null,Fl=null;function Ul(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function zl(e,t,n,i){return new Ul(e,t,n,i)}function jl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gl(e,t){var n=e.alternate;return null===n?((n=zl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Wl(e,t,n,i,r,o){var a=2;if(i=e,"function"===typeof e)jl(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case ne:return Hl(n.children,r,o,t);case ae:a=8,r|=7;break;case ie:a=8,r|=1;break;case re:return(e=zl(12,n,t,8|r)).elementType=re,e.type=re,e.expirationTime=o,e;case ce:return(e=zl(13,n,t,r)).type=ce,e.elementType=ce,e.expirationTime=o,e;case de:return(e=zl(19,n,t,r)).elementType=de,e.expirationTime=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case oe:a=10;break e;case se:a=9;break e;case le:a=11;break e;case ue:a=14;break e;case he:a=16,i=null;break e;case pe:a=22;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=zl(a,n,t,r)).elementType=e,t.type=i,t.expirationTime=o,t}function Hl(e,t,n,i){return(e=zl(7,e,i,t)).expirationTime=n,e}function ql(e,t,n){return(e=zl(6,e,null,t)).expirationTime=n,e}function Yl(e,t,n){return(t=zl(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Jl(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kl(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function Xl(e,t){var n=e.firstSuspendedTime,i=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(i>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Zl(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Ql(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function $l(e,t,n,i){var r=t.current,o=cl(),a=bo.suspense;o=dl(o,r,a);e:if(n){t:{if(et(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(s(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(wr(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(s(171))}if(1===n.tag){var c=n.type;if(wr(c)){n=kr(n,c,l);break e}}n=l}else n=mr;return null===t.context?t.context=n:t.pendingContext=n,(t=fo(o,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),go(r,t),ul(r,o),o}function ec(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function tc(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function nc(e,t){tc(e,t),(e=e.alternate)&&tc(e,t)}function ic(e,t,n){var i=new Jl(e,t,n=null!=n&&!0===n.hydrate),r=zl(3,null,null,2===t?7:1===t?3:0);i.current=r,r.stateNode=i,ho(r),e[Rn]=i.current,n&&0!==t&&function(e,t){var n=$e(t);Lt.forEach((function(e){gt(e,t,n)})),Pt.forEach((function(e){gt(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=i}function rc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function oc(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o._internalRoot;if("function"===typeof r){var a=r;r=function(){var e=ec(s);a.call(e)}}$l(t,s,e,r)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new ic(e,0,t?{hydrate:!0}:void 0)}(n,i),s=o._internalRoot,"function"===typeof r){var l=r;r=function(){var e=ec(s);l.call(e)}}yl((function(){$l(t,s,e,r)}))}return ec(s)}function sc(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!rc(t))throw Error(s(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:te,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}ic.prototype.render=function(e){$l(e,this._internalRoot,null,null)},ic.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;$l(null,e,null,(function(){t[Rn]=null}))},mt=function(e){if(13===e.tag){var t=$r(cl(),150,100);ul(e,t),nc(e,t)}},vt=function(e){13===e.tag&&(ul(e,3),nc(e,3))},yt=function(e){if(13===e.tag){var t=cl();ul(e,t=dl(t,e,null)),nc(e,t)}},P=function(e,t,n){switch(t){case"input":if(Ee(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=_n(i);if(!r)throw Error(s(90));we(i),Ee(i,r)}}}break;case"textarea":Re(e,n);break;case"select":null!=(t=n.value)&&De(e,!!n.multiple,t,!1)}},O=vl,N=function(e,t,n,i,r){var o=Fa;Fa|=4;try{return Jr(98,e.bind(null,t,n,i,r))}finally{(Fa=o)===Da&&Zr()}},_=function(){(Fa&(1|Ia|Ra))===Da&&(function(){if(null!==ol){var e=ol;ol=null,e.forEach((function(e,t){Ql(t,e),fl(t)})),Zr()}}(),Rl())},V=function(e,t){var n=Fa;Fa|=2;try{return e(t)}finally{(Fa=n)===Da&&Zr()}};var ac={Events:[On,Nn,_n,T,C,Gn,function(e){ot(e,jn)},R,A,Qt,lt,Rl,{current:!1}]};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Bl=function(e){try{t.onCommitFiberRoot(n,e,void 0,64===(64&e.current.effectTag))}catch(i){}},Fl=function(e){try{t.onCommitFiberUnmount(n,e)}catch(i){}}}catch(i){}})(r({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:X.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=it(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:An,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ac,t.createPortal=sc,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return e=null===(e=it(t))?null:e.stateNode},t.flushSync=function(e,t){if((Fa&(Ia|Ra))!==Da)throw Error(s(187));var n=Fa;Fa|=1;try{return Jr(99,e.bind(null,t))}finally{Fa=n,Zr()}},t.hydrate=function(e,t,n){if(!rc(t))throw Error(s(200));return oc(null,e,t,!0,n)},t.render=function(e,t,n){if(!rc(t))throw Error(s(200));return oc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!rc(e))throw Error(s(40));return!!e._reactRootContainer&&(yl((function(){oc(null,null,e,!1,(function(){e._reactRootContainer=null,e[Rn]=null}))})),!0)},t.unstable_batchedUpdates=vl,t.unstable_createPortal=function(e,t){return sc(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!rc(n))throw Error(s(200));if(null==e||void 0===e._reactInternalFiber)throw Error(s(38));return oc(e,t,n,!1,i)},t.version="16.14.0"},7119:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(8345)},2654:(e,t,n)=>{var i=n(9950),r=60103;if("function"===typeof Symbol&&Symbol.for){var o=Symbol.for;r=o("react.element"),o("react.fragment")}var s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,o={},c=null,d=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:d,props:o,_owner:s.current}}t.jsx=c},2049:(e,t,n)=>{var i=n(6470),r="function"===typeof Symbol&&Symbol.for,o=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,c=r?Symbol.for("react.profiler"):60114,d=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,h=r?Symbol.for("react.forward_ref"):60112,p=r?Symbol.for("react.suspense"):60113,f=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,m="function"===typeof Symbol&&Symbol.iterator;function v(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function S(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||y}function w(){}function x(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||y}S.prototype.isReactComponent={},S.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(v(85));this.updater.enqueueSetState(this,e,t,"setState")},S.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=S.prototype;var C=x.prototype=new w;C.constructor=x,i(C,S.prototype),C.isPureReactComponent=!0;var k={current:null},E=Object.prototype.hasOwnProperty,T={key:!0,ref:!0,__self:!0,__source:!0};function L(e,t,n){var i,r={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)E.call(t,i)&&!T.hasOwnProperty(i)&&(r[i]=t[i]);var l=arguments.length-2;if(1===l)r.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===r[i]&&(r[i]=l[i]);return{$$typeof:o,type:e,key:s,ref:a,props:r,_owner:k.current}}function P(e){return"object"===typeof e&&null!==e&&e.$$typeof===o}var D=/\/+/g,M=[];function I(e,t,n,i){if(M.length){var r=M.pop();return r.result=e,r.keyPrefix=t,r.func=n,r.context=i,r.count=0,r}return{result:e,keyPrefix:t,func:n,context:i,count:0}}function R(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>M.length&&M.push(e)}function A(e,t,n,i){var r=typeof e;"undefined"!==r&&"boolean"!==r||(e=null);var a=!1;if(null===e)a=!0;else switch(r){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case o:case s:a=!0}}if(a)return n(i,e,""===t?"."+N(e,0):t),1;if(a=0,t=""===t?".":t+":",Array.isArray(e))for(var l=0;l<e.length;l++){var c=t+N(r=e[l],l);a+=A(r,c,n,i)}else if(null===e||"object"!==typeof e?c=null:c="function"===typeof(c=m&&e[m]||e["@@iterator"])?c:null,"function"===typeof c)for(e=c.call(e),l=0;!(r=e.next()).done;)a+=A(r=r.value,c=t+N(r,l++),n,i);else if("object"===r)throw n=""+e,Error(v(31,"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,""));return a}function O(e,t,n){return null==e?0:A(e,"",t,n)}function N(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function _(e,t){e.func.call(e.context,t,e.count++)}function V(e,t,n){var i=e.result,r=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?B(e,i,n,(function(e){return e})):null!=e&&(P(e)&&(e=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,r+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(D,"$&/")+"/")+n)),i.push(e))}function B(e,t,n,i,r){var o="";null!=n&&(o=(""+n).replace(D,"$&/")+"/"),O(e,V,t=I(t,o,i,r)),R(t)}var F={current:null};function U(){var e=F.current;if(null===e)throw Error(v(321));return e}var z={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:k,IsSomeRendererActing:{current:!1},assign:i};t.Children={map:function(e,t,n){if(null==e)return e;var i=[];return B(e,i,null,t,n),i},forEach:function(e,t,n){if(null==e)return e;O(e,_,t=I(null,null,t,n)),R(t)},count:function(e){return O(e,(function(){return null}),null)},toArray:function(e){var t=[];return B(e,t,null,(function(e){return e})),t},only:function(e){if(!P(e))throw Error(v(143));return e}},t.Component=S,t.Fragment=a,t.Profiler=c,t.PureComponent=x,t.StrictMode=l,t.Suspense=p,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(v(267,e));var r=i({},e.props),s=e.key,a=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,l=k.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(d in t)E.call(t,d)&&!T.hasOwnProperty(d)&&(r[d]=void 0===t[d]&&void 0!==c?c[d]:t[d])}var d=arguments.length-2;if(1===d)r.children=n;else if(1<d){c=Array(d);for(var u=0;u<d;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:o,type:e.type,key:s,ref:a,props:r,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:u,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:d,_context:e},e.Consumer=e},t.createElement=L,t.createFactory=function(e){var t=L.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:h,render:e}},t.isValidElement=P,t.lazy=function(e){return{$$typeof:g,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return U().useCallback(e,t)},t.useContext=function(e,t){return U().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return U().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return U().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return U().useLayoutEffect(e,t)},t.useMemo=function(e,t){return U().useMemo(e,t)},t.useReducer=function(e,t,n){return U().useReducer(e,t,n)},t.useRef=function(e){return U().useRef(e)},t.useState=function(e){return U().useState(e)},t.version="16.14.0"},9950:(e,t,n)=>{e.exports=n(2049)},4414:(e,t,n)=>{e.exports=n(2654)},1761:(e,t)=>{var n,i,r,o,s;if("undefined"===typeof window||"function"!==typeof MessageChannel){var a=null,l=null,c=function(){if(null!==a)try{var e=t.unstable_now();a(!0,e),a=null}catch(n){throw setTimeout(c,0),n}},d=Date.now();t.unstable_now=function(){return Date.now()-d},n=function(e){null!==a?setTimeout(n,0,e):(a=e,setTimeout(c,0))},i=function(e,t){l=setTimeout(e,t)},r=function(){clearTimeout(l)},o=function(){return!1},s=t.unstable_forceFrameRate=function(){}}else{var u=window.performance,h=window.Date,p=window.setTimeout,f=window.clearTimeout;if("undefined"!==typeof console){var g=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof g&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"===typeof u&&"function"===typeof u.now)t.unstable_now=function(){return u.now()};else{var m=h.now();t.unstable_now=function(){return h.now()-m}}var v=!1,y=null,b=-1,S=5,w=0;o=function(){return t.unstable_now()>=w},s=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):S=0<e?Math.floor(1e3/e):5};var x=new MessageChannel,C=x.port2;x.port1.onmessage=function(){if(null!==y){var e=t.unstable_now();w=e+S;try{y(!0,e)?C.postMessage(null):(v=!1,y=null)}catch(n){throw C.postMessage(null),n}}else v=!1},n=function(e){y=e,v||(v=!0,C.postMessage(null))},i=function(e,n){b=p((function(){e(t.unstable_now())}),n)},r=function(){f(b),b=-1}}function k(e,t){var n=e.length;e.push(t);e:for(;;){var i=n-1>>>1,r=e[i];if(!(void 0!==r&&0<L(r,t)))break e;e[i]=t,e[n]=r,n=i}}function E(e){return void 0===(e=e[0])?null:e}function T(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length;i<r;){var o=2*(i+1)-1,s=e[o],a=o+1,l=e[a];if(void 0!==s&&0>L(s,n))void 0!==l&&0>L(l,s)?(e[i]=l,e[a]=n,i=a):(e[i]=s,e[o]=n,i=o);else{if(!(void 0!==l&&0>L(l,n)))break e;e[i]=l,e[a]=n,i=a}}}return t}return null}function L(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var P=[],D=[],M=1,I=null,R=3,A=!1,O=!1,N=!1;function _(e){for(var t=E(D);null!==t;){if(null===t.callback)T(D);else{if(!(t.startTime<=e))break;T(D),t.sortIndex=t.expirationTime,k(P,t)}t=E(D)}}function V(e){if(N=!1,_(e),!O)if(null!==E(P))O=!0,n(B);else{var t=E(D);null!==t&&i(V,t.startTime-e)}}function B(e,n){O=!1,N&&(N=!1,r()),A=!0;var s=R;try{for(_(n),I=E(P);null!==I&&(!(I.expirationTime>n)||e&&!o());){var a=I.callback;if(null!==a){I.callback=null,R=I.priorityLevel;var l=a(I.expirationTime<=n);n=t.unstable_now(),"function"===typeof l?I.callback=l:I===E(P)&&T(P),_(n)}else T(P);I=E(P)}if(null!==I)var c=!0;else{var d=E(D);null!==d&&i(V,d.startTime-n),c=!1}return c}finally{I=null,R=s,A=!1}}function F(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var U=s;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){O||A||(O=!0,n(B))},t.unstable_getCurrentPriorityLevel=function(){return R},t.unstable_getFirstCallbackNode=function(){return E(P)},t.unstable_next=function(e){switch(R){case 1:case 2:case 3:var t=3;break;default:t=R}var n=R;R=t;try{return e()}finally{R=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=U,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=R;R=e;try{return t()}finally{R=n}},t.unstable_scheduleCallback=function(e,o,s){var a=t.unstable_now();if("object"===typeof s&&null!==s){var l=s.delay;l="number"===typeof l&&0<l?a+l:a,s="number"===typeof s.timeout?s.timeout:F(e)}else s=F(e),l=a;return e={id:M++,callback:o,priorityLevel:e,startTime:l,expirationTime:s=l+s,sortIndex:-1},l>a?(e.sortIndex=l,k(D,e),null===E(P)&&e===E(D)&&(N?r():N=!0,i(V,l-a))):(e.sortIndex=s,k(P,e),O||A||(O=!0,n(B))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();_(e);var n=E(P);return n!==I&&null!==I&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<I.expirationTime||o()},t.unstable_wrapCallback=function(e){var t=R;return function(){var n=R;R=t;try{return e.apply(this,arguments)}finally{R=n}}}},5340:(e,t,n)=>{e.exports=n(1761)},3111:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="arrowLeftIconTitle"><path d="M9 6l-6 6 6 6"></path><path d="M21 12H4"></path><path stroke-linecap="round" d="M3 12h1"></path></svg>'},1234:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="arrowRightIconTitle"><path d="M15 18l6-6-6-6"></path><path d="M3 12h17"></path><path stroke-linecap="round" d="M21 12h-1"></path></svg>'},1963:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="arrowUpIconTitle"><path d="M18 9l-6-6-6 6"></path><path d="M12 21V4"></path><path stroke-linecap="round" d="M12 3v1"></path></svg>'},7331:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="binIconTitle"><path d="M19 6L5 6M14 5L10 5M6 10L6 20C6 20.6666667 6.33333333 21 7 21 7.66666667 21 11 21 17 21 17.6666667 21 18 20.6666667 18 20 18 19.3333333 18 16 18 10"></path></svg>'},5556:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="closeIconTitle"><path d="M6.34314575 6.34314575L17.6568542 17.6568542M6.34314575 17.6568542L17.6568542 6.34314575"></path></svg>'},3732:e=>{e.exports='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-labelledby="controlsAltIconTitle"><circle cx="9" cy="6" r="2"></circle><path d="M4 6H7"></path><path d="M11 6H20"></path><circle cx="9" cy="18" r="2"></circle><path d="M4 18H7"></path><path d="M11 18H20"></path><circle cx="15" cy="12" r="2"></circle><path d="M4 12H13"></path><path d="M17 12L20 12"></path></svg>'},6247:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="copyIconTitle"><rect width="12" height="14" x="8" y="7"></rect><polyline points="16 3 4 3 4 17"></polyline></svg>'},9230:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="cursorIconTitle"><polygon points="7 20 7 4 19 16 12 16 7 21"></polygon></svg>'},2667:e=>{e.exports='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-labelledby="eyeCrossedIconTitle"><path d="M22 12C22 12 19 18 12 18C5 18 2 12 2 12C2 12 5 6 12 6C19 6 22 12 22 12Z"></path><circle cx="12" cy="12" r="3"></circle><path d="M3 21L20 4"></path></svg>'},2383:e=>{e.exports='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-labelledby="eyeIconTitle"><path d="M22 12C22 12 19 18 12 18C5 18 2 12 2 12C2 12 5 6 12 6C19 6 22 12 22 12Z"></path><circle cx="12" cy="12" r="3"></circle></svg>'},4254:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="filterIconTitle"><path d="M10 12.261L4.028 3.972h16L14 12.329V17l-4 3z"></path></svg>'},4702:e=>{e.exports='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-labelledby="layersIconTitle"><path d="M12 4L20 8.00004L12 12L4 8.00004L12 4Z"></path><path d="M20 12L12 16L4 12"></path><path d="M20 16L12 20L4 16"></path></svg>'},5016:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="listIconTitle"><path d="M10 7L18 7M10 12L18 12M10 17L18 17"></path><line x1="7" y1="7" x2="7" y2="7"></line><line x1="7" y1="12" x2="7" y2="12"></line><line x1="7" y1="17" x2="7" y2="17"></line></svg>'},4093:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="maximiseIconTitle"><polyline points="21 16 21 21 16 21"></polyline><polyline points="8 21 3 21 3 16"></polyline><polyline points="16 3 21 3 21 8"></polyline><polyline points="3 8 3 3 8 3"></polyline></svg>'},5792:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="plusIconTitle"><path d="M20 12L4 12M12 4L12 20"></path></svg>'},8905:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="refreshIconTitle"><polyline points="22 12 19 15 16 12"></polyline><path d="M11,20 C6.581722,20 3,16.418278 3,12 C3,7.581722 6.581722,4 11,4 C15.418278,4 19,7.581722 19,12 L19,14"></path></svg>'},7053:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="rotateIconTitle"><path d="M22 12l-3 3-3-3"></path><path d="M2 12l3-3 3 3"></path><path d="M19.016 14v-1.95A7.05 7.05 0 0 0 8 6.22"></path><path d="M16.016 17.845A7.05 7.05 0 0 1 5 12.015V10"></path><path stroke-linecap="round" d="M5 10V9"></path><path stroke-linecap="round" d="M19 15v-1"></path></svg>'},6679:e=>{e.exports='<svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-labelledby="settingsIconTitle"><path d="M5.03506429,12.7050339 C5.01187484,12.4731696 5,12.2379716 5,12 C5,11.7620284 5.01187484,11.5268304 5.03506429,11.2949661 L3.20577137,9.23205081 L5.20577137,5.76794919 L7.9069713,6.32070904 C8.28729123,6.0461342 8.69629298,5.80882212 9.12862533,5.61412402 L10,3 L14,3 L14.8713747,5.61412402 C15.303707,5.80882212 15.7127088,6.0461342 16.0930287,6.32070904 L18.7942286,5.76794919 L20.7942286,9.23205081 L18.9649357,11.2949661 C18.9881252,11.5268304 19,11.7620284 19,12 C19,12.2379716 18.9881252,12.4731696 18.9649357,12.7050339 L20.7942286,14.7679492 L18.7942286,18.2320508 L16.0930287,17.679291 C15.7127088,17.9538658 15.303707,18.1911779 14.8713747,18.385876 L14,21 L10,21 L9.12862533,18.385876 C8.69629298,18.1911779 8.28729123,17.9538658 7.9069713,17.679291 L5.20577137,18.2320508 L3.20577137,14.7679492 L5.03506429,12.7050339 Z"></path><circle cx="12" cy="12" r="1"></circle></svg>'},7528:(e,t,n)=>{function i(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}n.d(t,{A:()=>i})}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};n.d(i,{q:()=>l});var r=n(9950),o=n(8077),s=n(4414);const a={layers:{greyscale:{type:"image",source:"dvid://https://flyem.dvid.io/ab6e610d4fe140aba0e030645a1d7229/grayscalejpeg"},segmentation:{type:"segmentation",source:"dvid://https://flyem.dvid.io/d925633ed0974da78e2bb5cf38d01f4d/segmentation",segments:[]}},perspectiveZoom:50,navigation:{zoomFactor:8},segments:[]};const l=function(e){let{viewerState:t=a,brainMapsClientId:n="NOT_A_VALID_ID"}=e;return(0,s.jsx)("div",{className:"App",children:(0,s.jsx)(o.Ay,{viewerState:t,brainMapsClientId:n})})};n(7119).render((0,s.jsx)(r.StrictMode,{children:(0,s.jsx)(l,{})}),document.getElementById("root"));var c=i.q;export{c as NeuroglancerViewer};
//# sourceMappingURL=neuroglancer.bundle.js.map